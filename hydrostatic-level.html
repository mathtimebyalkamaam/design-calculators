<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydrostatic Level Calculator - Design Calculators - Instrumentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #3b8e3e);
            --reset-button-bg: #FFC107; /* Yellow for reset */
            --reset-button-hover-bg: #E0A800; /* Darker yellow */
            --clear-button-bg: #007bff; /* Blue for clear */
            --clear-button-hover-bg: #0056b3; /* Darker blue */
            --liquid-color: #3498db; /* Blue for liquid */
            --liquid-color-dark: #2980b9; /* Darker blue for liquid */
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #446688;
            --button-gradient: linear-gradient(45deg, #3b8e3e, #4CAF50);
            --button-hover-gradient: linear-gradient(45deg, #4CAF50, #5cb85c);
            --reset-button-bg: #FFD700; /* Gold/Yellow for dark mode reset */
            --reset-button-hover-bg: #DAA520; /* Darker gold/yellow */
            --clear-button-bg: #17a2b8; /* Cyan for dark mode clear */
            --clear-button-hover-bg: #138496;
            --liquid-color: #6dd5ed; /* Lighter blue for dark mode liquid */
            --liquid-color-dark: #2193b0; /* Darker blue for dark mode liquid */
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-color), #e0e0e0);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.3s;
            width: fit-content; 
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px; /* Default margin for form groups */
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg); /* Use card-bg for input background */
            color: var(--text-color);
            box-sizing: border-box; /* Ensure padding doesn't increase width */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
            gap: 20px; /* Gap between grid items */
            margin-bottom: 0; /* Handled by form-group margin */
        }
        
        .calculate-btn {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 12px 30px; /* Increased padding for better appearance */
            border-radius: 25px; /* More rounded */
            cursor: pointer;
            font-size: 1.1em; /* Slightly larger font */
            font-weight: bold;
            margin-top: 25px; /* More space above button */
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto; /* Allow button to size based on content and padding */
            min-width: 220px; /* Ensure a minimum width for consistency */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .calculate-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02); /* Lift and slightly scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }

        .reset-btn {
            background-color: var(--reset-button-bg);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 25px;
            margin-left: 15px; /* Space from calculate button */
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .reset-btn:hover {
            background-color: var(--reset-button-hover-bg);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .clear-results-btn {
            background-color: var(--clear-button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .clear-results-btn:hover {
            background-color: var(--clear-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For animation */
            transform: translateY(20px); /* Initial state for animation */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners apply to table content */
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color); /* Highlight row on hover */
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--hover-color);
            border-radius: 4px;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: color 0.3s;
        }

        .info-icon:hover {
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px); /* Initial state for tooltip animation */
            font-size: 0.85em;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: flex; /* Use flex for centering text */
            align-items: center;
            justify-content: center;
            min-width: 250px; /* Ensure it's wide enough */
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* More space */
            font-size: 0.95em;
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px; /* More space */
            text-align: center;
            font-size: 1.2em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif; /* A font suitable for mathematical formulas */
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 12px 10px; /* Increased padding */
            background-color: var(--hover-color);
            border-radius: 6px; /* More rounded */
            margin: 15px 0; /* More space */
            overflow-x: auto; /* Allow horizontal scrolling for long formulas */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace; /* Monospace for steps */
            background-color: var(--hover-color);
            padding: 8px 15px; /* Increased padding */
            border-radius: 4px; /* More rounded */
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-break: break-word; /* Break long words */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px; /* Increased margin */
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
        }

        /* Style for centering the button */
        .button-wrapper {
            display: flex;
            justify-content: center; /* Center the button horizontally */
            width: 100%; /* Ensure it takes full width to center effectively */
            padding-top: 20px; /* Add more spacing above the button */
        }

        /* Animation for input fields on focus */
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4); /* Green glow, slightly more pronounced */
            outline: none;
            animation: pulse 0.8s infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4);
            }
            to {
                box-shadow: 0 0 0 8px rgba(76, 175, 80, 0.2); /* Softer pulse */
            }
        }

        /* Specific styles for DP Level Calculator */
        .unit-system-selector, .density-input-selector, .system-type-selector {
            margin-bottom: 20px;
            background-color: var(--hover-color);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        .unit-system-selector label, .density-input-selector label, .system-type-selector label {
            font-weight: bold;
            color: var(--text-color);
        }
        .density-input-selector input[type="radio"], .system-type-selector input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }

        #density-input-group, #specific-gravity-input-group, #vapor-pressure-group {
            display: none; /* Hidden by default */
            margin-top: 15px;
            border-top: 1px dashed var(--border-color);
            padding-top: 15px;
        }
        #density-input-group.active, #specific-gravity-input-group.active, #vapor-pressure-group.active {
            display: block;
        }

        /* Tank Visualization */
        .tank-visualization-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--bg-color);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            flex-direction: column;
        }

        .tank-svg {
            width: 150px;
            height: 250px;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            position: relative;
            overflow: hidden; /* Ensure liquid doesn't overflow */
            background-color: #f0f0f0; /* Empty tank background */
        }

        .tank-liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, var(--liquid-color-dark), var(--liquid-color));
            transition: height 1.5s ease-out; /* Smooth animation for liquid level */
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .tank-level-label {
            margin-top: 10px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Instrumentation</h1>
            <p class="subtitle">Smart Tools for Modern Instrumentation Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <a href="indexInst.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </div>
        
        <div class="tool-container">
            <h2>Hydrostatic Level Calculator</h2>
            
            <div class="tool-description">
                <p>This professional tool calculates the liquid level based on measured pressure head, fluid density, and local gravity. It is fundamental for understanding hydrostatic pressure and its application in level measurement across all industries worldwide.</p>
            </div>
        
            <div class="calculator-form">
                <form id="hydrostatic-level-form">
                    <!-- Unit System Selection -->
                    <div class="form-section unit-system-selector">
                        <label for="unit-system">Select Unit System:</label>
                        <select id="unit-system" required>
                            <option value="metric">Metric (m, Pa, kg/m³)</option>
                            <option value="imperial">Imperial (ft, psi, lb/ft³)</option>
                        </select>
                    </div>

                    <!-- System Type Selection -->
                    <div class="form-section system-type-selector">
                        <h3>System Type</h3>
                        <label>
                            <input type="radio" name="system-type" value="open" checked> Open to Atmosphere
                        </label>
                        <label>
                            <input type="radio" name="system-type" value="closed"> Closed/Pressurized Tank
                        </label>
                    </div>

                    <!-- Input Parameters -->
                    <div class="form-section">
                        <h3>Measurement Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="measured-pressure" id="label-measured-pressure">Measured Pressure (P) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-measured-pressure">The measured hydrostatic pressure at the bottom of the liquid column (absolute pressure if closed system, gauge pressure if open).</span></span></label>
                                <input type="number" id="measured-pressure" step="0.01" value="9806.65" required>
                            </div>
                            <div class="form-group" id="vapor-pressure-group">
                                <label for="vapor-pressure" id="label-vapor-pressure">Vapor Pressure (P<sub>vapor</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-vapor-pressure">The pressure of the vapor space above the liquid in a closed tank.</span></span></label>
                                <input type="number" id="vapor-pressure" step="0.01" value="0.0" required>
                            </div>
                            <div class="form-group">
                                <label for="fluid-temperature" id="label-fluid-temperature">Fluid Temperature <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-fluid-temperature">The operating temperature of the fluid. Important for accurate density.</span></span></label>
                                <input type="number" id="fluid-temperature" step="0.1" value="25.0" required>
                            </div>
                            <div class="form-group">
                                <label for="max-level" id="label-max-level">Maximum Tank Level (H<sub>max</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-max-level">The maximum possible liquid level in the tank, used for visualization scaling.</span></span></label>
                                <input type="number" id="max-level" step="0.01" value="2.0" required>
                            </div>
                            <div class="form-group">
                                <label for="local-gravity" id="label-local-gravity">Local Gravity (g) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-local-gravity">The local acceleration due to gravity at your location. Standard is 9.80665 m/s² or 32.174 ft/s².</span></span></label>
                                <input type="number" id="local-gravity" step="0.001" value="9.80665" required>
                            </div>
                        </div>
                    </div>

                    <!-- Fluid Density Input Method -->
                    <div class="form-section density-input-selector">
                        <h3>Fluid Density Input Method</h3>
                        <label>
                            <input type="radio" name="density-input-method" value="density" checked> Direct Density
                        </label>
                        <label>
                            <input type="radio" name="density-input-method" value="specific-gravity"> Specific Gravity (SG)
                        </label>
                    </div>

                    <div class="form-section">
                        <div class="form-row">
                            <div class="form-group" id="density-input-group" class="active">
                                <label for="fluid-density" id="label-fluid-density-actual">Fluid Density (ρ<sub>fluid</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-fluid-density-actual">The density of the liquid at operating conditions.</span></span></label>
                                <input type="number" id="fluid-density" step="0.01" value="1000.0" required>
                            </div>
                            <div class="form-group" id="specific-gravity-input-group">
                                <label for="specific-gravity" id="label-specific-gravity">Specific Gravity (SG) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-specific-gravity">The ratio of the fluid's density to the density of a reference fluid (usually water at 4°C for liquids). This value should be at the operating temperature.</span></span></label>
                                <input type="number" id="specific-gravity" step="0.001" value="1.0" required>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-level-btn" class="calculate-btn">Calculate Level</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Level Calculation Results</h3>
                <div class="tank-visualization-container">
                    <div class="tank-svg">
                        <div class="tank-liquid" style="height: 0%;"></div>
                    </div>
                    <p class="tank-level-label">Current Level: <span id="current-level-display">0.00</span></p>
                </div>
                <div id="calculation-details">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
                </div>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Instrumentation!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Instrumentation! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const unitSystemSelect = document.getElementById('unit-system');
            const densityInputMethodRadios = document.querySelectorAll('input[name="density-input-method"]');
            const systemTypeRadios = document.querySelectorAll('input[name="system-type"]');

            const fluidDensityInput = document.getElementById('fluid-density');
            const specificGravityInput = document.getElementById('specific-gravity');
            const measuredPressureInput = document.getElementById('measured-pressure');
            const fluidTemperatureInput = document.getElementById('fluid-temperature');
            const maxLevelInput = document.getElementById('max-level');
            const localGravityInput = document.getElementById('local-gravity');
            const vaporPressureInput = document.getElementById('vapor-pressure');

            const densityInputGroup = document.getElementById('density-input-group');
            const specificGravityInputGroup = document.getElementById('specific-gravity-input-group');
            const vaporPressureGroup = document.getElementById('vapor-pressure-group');

            const labelFluidDensityActual = document.getElementById('label-fluid-density-actual');
            const labelSpecificGravity = document.getElementById('label-specific-gravity');
            const labelMeasuredPressure = document.getElementById('label-measured-pressure');
            const labelFluidTemperature = document.getElementById('label-fluid-temperature');
            const labelMaxLevel = document.getElementById('label-max-level');
            const labelLocalGravity = document.getElementById('label-local-gravity');
            const labelVaporPressure = document.getElementById('label-vapor-pressure');

            const calculateLevelBtn = document.getElementById('calculate-level-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            const tankLiquid = document.querySelector('.tank-liquid');
            const currentLevelDisplay = document.getElementById('current-level-display');

            // Constants
            const GRAVITY_SI_DEFAULT = 9.80665; // m/s²
            const GRAVITY_IMPERIAL_DEFAULT = 32.174; // ft/s²
            const WATER_DENSITY_SI_REF = 1000; // kg/m³ (water at 4°C)
            const WATER_DENSITY_IMPERIAL_REF = 62.43; // lb/ft³ (water at 4°C)

            // Default values for resetting form (Metric)
            const defaultValues = {
                'unit-system': 'metric',
                'density-input-method': 'density',
                'system-type': 'open',
                'fluid-density': 1000.0, // kg/m³
                'specific-gravity': 1.0,
                'measured-pressure': 9806.65, // Pa (for 1m water)
                'fluid-temperature': 25.0, // °C
                'max-level': 2.0, // m
                'local-gravity': GRAVITY_SI_DEFAULT,
                'vapor-pressure': 0.0
            };

            // Unit configurations
            const unitsConfig = {
                'metric': {
                    length: { label: 'm', tooltip: 'meters', toSI: 1 },
                    pressure: { label: 'Pa', tooltip: 'Pascals', toSI: 1 },
                    density: { label: 'kg/m³', tooltip: 'kilograms per cubic meter', toSI: 1 },
                    temperature: { label: '°C', tooltip: 'Celsius' },
                    gravity_unit: 'm/s²',
                    waterDensityRef: WATER_DENSITY_SI_REF,
                    levelPrecision: 3,
                    pressurePrecision: 2,
                    densityPrecision: 2,
                    tempPrecision: 1,
                    gravityPrecision: 3
                },
                'imperial': {
                    length: { label: 'ft', tooltip: 'feet', toSI: 0.3048 }, // ft to meters
                    pressure: { label: 'psi', tooltip: 'pounds per square inch', toSI: 6894.76 }, // psi to Pa
                    density: { label: 'lb/ft³', tooltip: 'pounds per cubic foot', toSI: 16.0185 }, // lb/ft³ to kg/m³
                    temperature: { label: '°F', tooltip: 'Fahrenheit' },
                    gravity_unit: 'ft/s²',
                    waterDensityRef: WATER_DENSITY_IMPERIAL_REF,
                    levelPrecision: 2,
                    pressurePrecision: 2,
                    densityPrecision: 2,
                    tempPrecision: 1,
                    gravityPrecision: 3
                }
            };

            // Helper function to add rows to the result table
            function addResultRow(parameter, value) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
            }

            // Event Listeners
            unitSystemSelect.addEventListener('change', updateUnitLabelsAndTooltips);
            densityInputMethodRadios.forEach(radio => radio.addEventListener('change', updateDensityInputMethodVisibility));
            systemTypeRadios.forEach(radio => radio.addEventListener('change', updateSystemTypeVisibility));
            calculateLevelBtn.addEventListener('click', calculateLevel);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            // Initial setup
            updateUnitLabelsAndTooltips(); // Update labels based on initial system
            updateDensityInputMethodVisibility(); // Show/hide density/SG input fields
            updateSystemTypeVisibility(); // Show/hide vapor pressure input
            
            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            function updateUnitLabelsAndTooltips() {
                const selectedSystem = unitSystemSelect.value;
                const config = unitsConfig[selectedSystem];
                const densityInputMethod = document.querySelector('input[name="density-input-method"]:checked').value;
                const systemType = document.querySelector('input[name="system-type"]:checked').value;

                labelMeasuredPressure.innerHTML = `Measured Pressure (P) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The measured hydrostatic pressure at the bottom of the liquid column (absolute pressure if closed system, gauge pressure if open). Unit: ${config.pressure.tooltip}.</span></span>`;
                labelFluidTemperature.innerHTML = `Fluid Temperature <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The operating temperature of the fluid. Important for accurate density. Unit: ${config.temperature.tooltip}.</span></span>`;
                labelMaxLevel.innerHTML = `Maximum Tank Level (H<sub>max</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum possible liquid level in the tank, used for visualization scaling. Unit: ${config.length.tooltip}.</span></span>`;
                labelLocalGravity.innerHTML = `Local Gravity (g) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The local acceleration due to gravity at your location. Standard is ${GRAVITY_SI_DEFAULT} m/s² or ${GRAVITY_IMPERIAL_DEFAULT} ft/s². Unit: ${config.gravity_unit}.</span></span>`;

                if (densityInputMethod === 'density') {
                    labelFluidDensityActual.innerHTML = `Fluid Density (ρ<sub>fluid</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The density of the liquid at operating conditions. Unit: ${config.density.tooltip}.</span></span>`;
                } else {
                    labelSpecificGravity.innerHTML = `Specific Gravity (SG) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The ratio of the fluid's density to the density of a reference fluid (usually water at 4°C for liquids). This value should be at the operating temperature. Unit: Dimensionless.</span></span>`;
                }

                if (systemType === 'closed') {
                    labelVaporPressure.innerHTML = `Vapor Pressure (P<sub>vapor</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The pressure of the vapor space above the liquid in a closed tank. Unit: ${config.pressure.tooltip}.</span></span>`;
                }
                
                // Update input placeholders
                measuredPressureInput.placeholder = `e.g., 9806.65 ${config.pressure.label}`;
                fluidTemperatureInput.placeholder = `e.g., 25.0 ${config.temperature.label}`;
                maxLevelInput.placeholder = `e.g., 2.0 ${config.length.label}`;
                localGravityInput.placeholder = `e.g., ${config.gravity_unit === 'm/s²' ? GRAVITY_SI_DEFAULT : GRAVITY_IMPERIAL_DEFAULT}`;
                fluidDensityInput.placeholder = `e.g., 1000 ${config.density.label}`;
                specificGravityInput.placeholder = `e.g., 1.0`;
                vaporPressureInput.placeholder = `e.g., 0.0 ${config.pressure.label}`;

                // Update default gravity value based on unit system
                if (selectedSystem === 'metric') {
                    localGravityInput.value = GRAVITY_SI_DEFAULT;
                } else {
                    localGravityInput.value = GRAVITY_IMPERIAL_DEFAULT;
                }
            }

            function updateDensityInputMethodVisibility() {
                const selectedMethod = document.querySelector('input[name="density-input-method"]:checked').value;
                if (selectedMethod === 'density') {
                    densityInputGroup.classList.add('active');
                    specificGravityInputGroup.classList.remove('active');
                    fluidDensityInput.setAttribute('required', 'required');
                    specificGravityInput.removeAttribute('required');
                } else {
                    densityInputGroup.classList.remove('active');
                    specificGravityInputGroup.classList.add('active');
                    fluidDensityInput.removeAttribute('required');
                    specificGravityInput.setAttribute('required', 'required');
                }
                updateUnitLabelsAndTooltips(); // Update labels after visibility change
                clearResults(); // Clear results when input method changes
            }

            function updateSystemTypeVisibility() {
                const selectedSystemType = document.querySelector('input[name="system-type"]:checked').value;
                if (selectedSystemType === 'closed') {
                    vaporPressureGroup.classList.add('active');
                    vaporPressureInput.setAttribute('required', 'required');
                } else {
                    vaporPressureGroup.classList.remove('active');
                    vaporPressureInput.removeAttribute('required');
                    vaporPressureInput.value = defaultValues['vapor-pressure']; // Reset vapor pressure
                }
                updateUnitLabelsAndTooltips(); // Update labels after visibility change
                clearResults(); // Clear results when system type changes
            }

            function clearResults() {
                resultContainer.classList.remove('show');
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                standardReference.innerHTML = '';
                tankLiquid.style.height = '0%'; // Reset liquid animation
                currentLevelDisplay.textContent = '0.00'; // Reset displayed level
                displayMessage("Results cleared.", "info");
            }

            function resetForm() {
                unitSystemSelect.value = defaultValues['unit-system'];
                
                // Reset radio buttons and trigger their change events
                document.querySelector(`input[name="density-input-method"][value="${defaultValues['density-input-method']}"]`).checked = true;
                updateDensityInputMethodVisibility();

                document.querySelector(`input[name="system-type"][value="${defaultValues['system-type']}"]`).checked = true;
                updateSystemTypeVisibility();

                fluidDensityInput.value = defaultValues['fluid-density'];
                specificGravityInput.value = defaultValues['specific-gravity'];
                measuredPressureInput.value = defaultValues['measured-pressure'];
                fluidTemperatureInput.value = defaultValues['fluid-temperature'];
                maxLevelInput.value = defaultValues['max-level'];
                localGravityInput.value = defaultValues['local-gravity'];
                vaporPressureInput.value = defaultValues['vapor-pressure'];
                
                clearResults(); // Clear results again after inputs are reset
                displayMessage("Form reset to default values (Metric).", "info");
            }

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    messageBox.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        padding: 15px 25px;
                        border-radius: 8px;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                        z-index: 1000;
                        font-weight: bold;
                        color: white;
                        opacity: 0;
                        transition: opacity 0.5s ease-in-out, transform 0.3s ease-out;
                        display: flex; /* Use flex for centering text */
                        align-items: center;
                        justify-content: center;
                        min-width: 250px; /* Ensure it's wide enough */
                    `;
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; /* Red */
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; /* Amber */
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745'; /* Green */
                }
                messageBox.style.opacity = 1;
                messageBox.style.transform = 'translateX(-50%) translateY(0)'; // Bring to position

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)'; // Fade out and move up
                }, 5000);
            }

            function calculateLevel() {
                clearResults(); // Clear previous results
                const selectedSystem = unitSystemSelect.value;
                const config = unitsConfig[selectedSystem];

                let fluidDensity_input = parseFloat(fluidDensityInput.value);
                let specificGravity_input = parseFloat(specificGravityInput.value);
                let measuredPressure = parseFloat(measuredPressureInput.value);
                let fluidTemperature = parseFloat(fluidTemperatureInput.value); // For context/display
                let maxLevel = parseFloat(maxLevelInput.value);
                let localGravity = parseFloat(localGravityInput.value);
                let vaporPressure = parseFloat(vaporPressureInput.value);

                const densityInputMethod = document.querySelector('input[name="density-input-method"]:checked').value;
                const systemType = document.querySelector('input[name="system-type"]:checked').value;

                // Input Validation
                if (densityInputMethod === 'density' && (isNaN(fluidDensity_input) || fluidDensity_input <= 0)) {
                    displayMessage("Please enter a valid positive Fluid Density.", "error");
                    return;
                }
                if (densityInputMethod === 'specific-gravity' && (isNaN(specificGravity_input) || specificGravity_input <= 0)) {
                    displayMessage("Please enter a valid positive Specific Gravity.", "error");
                    return;
                }
                if (isNaN(measuredPressure)) {
                    displayMessage("Please enter a valid Measured Pressure.", "error");
                    return;
                }
                if (isNaN(fluidTemperature)) {
                    displayMessage("Please enter a valid Fluid Temperature.", "error");
                    return;
                }
                if (isNaN(maxLevel) || maxLevel <= 0) {
                    displayMessage("Please enter a valid positive Maximum Tank Level.", "error");
                    return;
                }
                if (isNaN(localGravity) || localGravity <= 0) {
                    displayMessage("Please enter a valid positive Local Gravity.", "error");
                    return;
                }
                if (systemType === 'closed' && isNaN(vaporPressure)) {
                    displayMessage("Please enter a valid Vapor Pressure for a closed system.", "error");
                    return;
                }

                // Determine fluid density in SI units
                let fluidDensity_si;
                let fluidDensity_display_val; // Value in selected unit system
                let fluidDensity_display_unit; // Unit in selected unit system

                if (densityInputMethod === 'density') {
                    fluidDensity_si = fluidDensity_input * config.density.toSI;
                    fluidDensity_display_val = fluidDensity_input.toFixed(config.densityPrecision);
                    fluidDensity_display_unit = config.density.label;
                } else {
                    fluidDensity_si = specificGravity_input * config.waterDensityRef * config.density.toSI;
                    fluidDensity_display_val = specificGravity_input.toFixed(3);
                    fluidDensity_display_unit = 'SG';
                }

                // Convert other inputs to SI units for calculation
                let measuredPressure_si = measuredPressure * config.pressure.toSI;
                let vaporPressure_si = vaporPressure * config.pressure.toSI;
                let maxLevel_si = maxLevel * config.length.toSI;
                let localGravity_si = localGravity * (selectedSystem === 'imperial' ? 0.3048 : 1); // Convert imperial gravity to m/s² if needed

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>Unit System:</strong> ${selectedSystem.toUpperCase()}</p>`;
                calculationHtml += `<p><strong>System Type:</strong> ${systemType === 'open' ? 'Open to Atmosphere' : 'Closed/Pressurized Tank'}</p>`;
                
                calculationHtml += `<p><strong>1. Input Parameters and Unit Conversions:</strong></p>`;
                calculationHtml += `<p>All input values are first converted to the International System of Units (SI) for consistent calculation, then converted back for display.</p>`;
                calculationHtml += `<p class="calculation-step">Fluid Density (ρ<sub>fluid</sub>) = ${fluidDensity_display_val} ${fluidDensity_display_unit} = ${fluidDensity_si.toFixed(3)} kg/m³</p>`;
                calculationHtml += `<p class="calculation-step">Measured Pressure (P) = ${measuredPressure.toFixed(config.pressurePrecision)} ${config.pressure.label} = ${measuredPressure_si.toFixed(2)} Pa</p>`;
                if (systemType === 'closed') {
                    calculationHtml += `<p class="calculation-step">Vapor Pressure (P<sub>vapor</sub>) = ${vaporPressure.toFixed(config.pressurePrecision)} ${config.pressure.label} = ${vaporPressure_si.toFixed(2)} Pa</p>`;
                }
                calculationHtml += `<p class="calculation-step">Fluid Temperature = ${fluidTemperature.toFixed(config.tempPrecision)} ${config.temperature.label}</p>`;
                calculationHtml += `<p class="calculation-step">Maximum Tank Level (H<sub>max</sub>) = ${maxLevel.toFixed(config.levelPrecision)} ${config.length.label} = ${maxLevel_si.toFixed(3)} m</p>`;
                calculationHtml += `<p class="calculation-step">Local Acceleration due to Gravity (g) = ${localGravity.toFixed(config.gravityPrecision)} ${config.gravity_unit} = ${localGravity_si.toFixed(3)} m/s²</p>`;

                let effectivePressure_si = measuredPressure_si;
                if (systemType === 'closed') {
                    effectivePressure_si = measuredPressure_si - vaporPressure_si;
                    calculationHtml += `<p><strong>2. Effective Hydrostatic Pressure Calculation:</strong></p>`;
                    calculationHtml += `<p>For a closed/pressurized tank, the vapor pressure above the liquid must be subtracted from the total measured pressure to determine the true hydrostatic pressure exerted by the liquid column.</p>`;
                    calculationHtml += `<p class="formula">P<sub>effective</sub> = P<sub>measured</sub> - P<sub>vapor</sub></p>`;
                    calculationHtml += `<p class="calculation-step">P<sub>effective</sub> = ${measuredPressure_si.toFixed(2)} Pa - ${vaporPressure_si.toFixed(2)} Pa = ${effectivePressure_si.toFixed(2)} Pa</p>`;
                } else {
                    calculationHtml += `<p><strong>2. Effective Hydrostatic Pressure:</strong></p>`;
                    calculationHtml += `<p>For an open tank, the measured pressure directly represents the hydrostatic pressure of the liquid column.</p>`;
                    calculationHtml += `<p class="calculation-step">P<sub>effective</sub> = P<sub>measured</sub> = ${effectivePressure_si.toFixed(2)} Pa</p>`;
                }

                // Core Hydrostatic Level Formula: Level = Pressure / (Fluid Density * g)
                let calculatedLevel_si = effectivePressure_si / (fluidDensity_si * localGravity_si);
                
                calculationHtml += `<p><strong>3. Hydrostatic Level Calculation:</strong></p>`;
                calculationHtml += `<p>The liquid level is calculated using the fundamental hydrostatic pressure formula, which relates pressure to the height of a fluid column, its density, and the acceleration due to gravity.</p>`;
                calculationHtml += `<p class="formula">Level = P<sub>effective</sub> / (ρ<sub>fluid</sub> &times; g)</p>`;
                calculationHtml += `<p class="calculation-step">Level = ${effectivePressure_si.toFixed(2)} Pa / (${fluidDensity_si.toFixed(3)} kg/m³ &times; ${localGravity_si.toFixed(3)} m/s²)</p>`;
                calculationHtml += `<p class="calculation-step">Level = ${calculatedLevel_si.toFixed(3)} m</p>`;

                // Convert final level back to selected unit system for display
                let finalLevel_display = calculatedLevel_si / config.length.toSI;

                // Ensure level doesn't go below zero or above max level (for visualization purposes)
                if (finalLevel_display < 0) {
                    finalLevel_display = 0;
                    displayMessage("Calculated level is below zero. Displaying 0.", "warning");
                } else if (finalLevel_display > maxLevel) {
                    finalLevel_display = maxLevel;
                    displayMessage("Calculated level exceeds maximum tank level. Displaying maximum level.", "warning");
                }

                calculationHtml += `<p><strong>4. Final Result:</strong></p>`;
                calculationHtml += `<p>The calculated level in the selected unit system.</p>`;
                calculationHtml += `<p class="calculation-step">Final Level (${config.length.label}) = Calculated Level (SI) / Unit Conversion Factor</p>`;
                calculationHtml += `<p class="calculation-step">Final Level = ${calculatedLevel_si.toFixed(3)} m / ${config.length.toSI.toFixed(4)} = ${finalLevel_display.toFixed(config.levelPrecision)} ${config.length.label}</p>`;


                // Display Results in table
                resultTableBody.innerHTML = '';
                addResultRow("Fluid Density Input", `${fluidDensity_display_val} ${fluidDensity_display_unit}`);
                addResultRow("Fluid Density (Calculated)", `${fluidDensity_si.toFixed(3)} kg/m³`);
                addResultRow("Fluid Temperature", `${fluidTemperature.toFixed(config.tempPrecision)} ${config.temperature.label}`);
                addResultRow("Measured Pressure (P)", `${measuredPressure.toFixed(config.pressurePrecision)} ${config.pressure.label}`);
                if (systemType === 'closed') {
                    addResultRow("Vapor Pressure (P<sub>vapor</sub>)", `${vaporPressure.toFixed(config.pressurePrecision)} ${config.pressure.label}`);
                }
                addResultRow("Maximum Tank Level (H<sub>max</sub>)", `${maxLevel.toFixed(config.levelPrecision)} ${config.length.label}`);
                addResultRow("Local Gravity (g)", `${localGravity.toFixed(config.gravityPrecision)} ${config.gravity_unit}`);
                addResultRow("System Type", systemType === 'open' ? 'Open to Atmosphere' : 'Closed/Pressurized');
                addResultRow("<strong>Calculated Level</strong>", `<strong>${finalLevel_display.toFixed(config.levelPrecision)} ${config.length.label}</strong>`);
                
                // Update Tank Visualization
                const tankHeightPx = 250; // Max height of the SVG tank in pixels
                
                // Calculate the actual liquid height in pixels based on the finalLevel_si relative to the max level
                let liquidHeightPx = (calculatedLevel_si / maxLevel_si) * tankHeightPx;
                liquidHeightPx = Math.max(0, Math.min(tankHeightPx, liquidHeightPx)); // Clamp between 0 and tankHeightPx

                tankLiquid.style.height = `${liquidHeightPx}px`;
                currentLevelDisplay.textContent = `${finalLevel_display.toFixed(config.levelPrecision)} ${config.length.label}`;


                standardRefText = `
                    <h4>International Standards Compliance:</h4>
                    <p>This calculator adheres to the fundamental principles of hydrostatic level measurement, which are widely recognized and applied in various international standards and recommended practices for instrumentation:</p>
                    <ul>
                        <li><strong>ISO 1:2016: Geometrical product specifications (GPS) - Standard reference temperature for geometrical product specification and verification.</strong> While not directly about level, it underpins the importance of temperature in measurement, which affects fluid density.</li>
                        <li><strong>ISO 4126: Safety devices for protection against excessive pressure.</strong> Understanding hydrostatic pressure is fundamental to safe tank operation and design, which direct pressure-to-level conversion relates to.</li>
                        <li><strong>General Principles of Fluid Mechanics and Hydrostatics:</strong> The core calculations are based on fundamental principles such as Pascal's Law and the hydrostatic pressure equation (P = ρgh), which are universal in fluid mechanics and taught in engineering curricula worldwide.</li>
                        <li><strong>Industry Best Practices:</strong> The use of accurate fluid density, local gravity values, and compensation for vapor pressure are standard industry practices for precise hydrostatic level measurement in various industrial scenarios.</li>
                    </ul>
                    <p>This tool provides accurate calculations based on these widely accepted engineering principles and industry practices. For critical applications, always refer to the latest official standards documents, manufacturer's specifications for pressure transmitters, and consult with a qualified instrumentation and control professional.</p>
                `;
                standardReference.innerHTML = standardRefText;

                calculationDetailsDiv.innerHTML = calculationHtml; // Insert detailed steps
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    calculationDetailsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to calculation details
                }, 10);
            }

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>


