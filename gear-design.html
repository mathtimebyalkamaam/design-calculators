<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mechanical Gear Design Calculator (AGMA) - Professional Edition</title>
<meta name="description" content="A professional tool for designing spur, helical, and bevel gears based on AGMA standards, providing detailed, step-by-step calculations for engineers and students.">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-23Y1V450SR');
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
MathJax = {
tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]},
svg: {fontCache: 'global'}
}
</script>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<style>
/* Base Styles */
:root {
--primary-color: #1E3A8A; /* Professional Dark Blue */
--secondary-color: #2563EB; /* Bright Blue */
--accent-color: #F59E0B; /* Warm Amber */
--bg-color: #F8FAFC;
--card-bg: #FFFFFF;
--text-color: #4B5563;
--heading-color: #111827;
--footer-bg: #0F172A;
--border-color: #E2E8F0;
--gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
--gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
--card-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 5px 10px rgba(0, 0, 0, 0.04);
--hover-color: #eef2ff;
--button-hover-shadow: 0 7px 20px rgba(37, 99, 235, 0.4);
--highlight-bg: rgba(245, 158, 11, 0.15);
--success-color: #10B981;
--fail-color: #EF4444;
--warning-color: #F59E0B;
}

body.dark-mode {
--primary-color: #10B981;
--secondary-color: #34D399;
--bg-color: #0F172A;
--card-bg: #1E293B;
--text-color: #CBD5E1;
--heading-color: #F1F5F9;
--footer-bg: #020617;
--border-color: #334155;
--highlight-bg: rgba(16, 185, 129, 0.2);
--hover-color: #334155;
--button-hover-shadow: 0 7px 20px rgba(16, 185, 129, 0.3);
}

html { scroll-behavior: smooth; }

body {
font-family: 'Inter', sans-serif;
background-color: var(--bg-color);
color: var(--text-color);
line-height: 1.8;
transition: background-color 0.3s, color 0.3s;
overflow-x: hidden;
margin: 0;
padding: 0;
}

.container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }
.content-container { max-width: 1200px; margin: 0 auto; padding: 20px; }

/* --- NEW HEADER STYLES --- */
.header {
background: var(--gradient-primary);
color: white;
padding: 24px 0;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.navbar {
display: flex;
justify-content: space-between;
align-items: center;
}

.logo-container {
display: flex;
align-items: center;
gap: 16px;
text-decoration: none;
color: white;
}

.logo { height: 56px; } /* Added for logo if one is used */

.logo-text {
font-size: 1.75rem;
font-weight: 800;
font-family: 'Montserrat', sans-serif;
}

.nav-links {
display: flex;
gap: 24px;
list-style: none;
margin: 0;
padding: 0;
}

.nav-links a {
color: white;
text-decoration: none;
font-weight: 500;
transition: all 0.3s;
}

.nav-links a:hover {
color: var(--accent-color);
transform: translateY(-2px);
}

.theme-toggle {
display: flex;
align-items: center;
gap: 12px;
}

.theme-toggle .icon {
color: white;
font-size: 1.2rem;
}

.switch {
position: relative;
display: inline-block;
width: 56px;
height: 30px;
}

.switch input { opacity: 0; width: 0; height: 0; }

.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: rgba(0,0,0,0.2);
transition: .4s;
border-radius: 30px;
}

.slider:before {
position: absolute;
content: "";
height: 22px;
width: 22px;
left: 4px;
bottom: 4px;
background-color: white;
transition: .4s;
border-radius: 50%;
}

input:checked + .slider { background-color: var(--accent-color); }
input:checked + .slider:before { transform: translateX(26px); }
/* --- END OF NEW HEADER STYLES --- */


main { padding: 40px 0; }

/* START: Calculator Specific Styles */
.tool-container {
background-color: var(--card-bg);
border-radius: 12px; /* Increased rounding */
padding: 30px;
box-shadow: var(--card-shadow);
margin-bottom: 30px;
}

.tool-container h2 {
color: var(--primary-color);
border-bottom: 3px solid var(--primary-color);
padding-bottom: 15px;
margin-top: 0;
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
font-size: 1.8rem;
}

/* Added styles for new content */
.tool-container h3 {
color: var(--primary-color);
margin-top: 25px;
font-family: 'Montserrat', sans-serif;
}
.tool-container p {
margin-bottom: 15px;
}
.tool-container ul, .tool-container ol {
padding-left: 20px;
margin-bottom: 15px;
}
.tool-container li {
margin-bottom: 10px;
}
.tool-container h4 {
color: var(--secondary-color);
margin-top: 20px;
font-family: 'Montserrat', sans-serif;
}
/* End of added styles */


.tool-description {
margin-bottom: 25px;
color: var(--text-color);
font-size: 1.1rem;
background-color: var(--hover-color);
border-radius: 8px;
padding: 20px;
border-left: 5px solid var(--primary-color);
}

.back-button {
display: inline-block;
background-color: var(--primary-color);
color: white;
padding: 12px 20px;
border-radius: 8px; /* Rounded corners */
text-decoration: none;
margin-bottom: 25px;
transition: background-color 0.3s, transform 0.2s;
font-weight: 600;
}

.back-button:hover {
background-color: var(--secondary-color);
transform: translateY(-2px);
}

.calculator-form {
background-color: var(--card-bg);
border-radius: 8px;
padding: 25px;
margin-top: 25px;
box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

.form-section-header {
font-size: 1.2rem;
font-weight: 700;
color: var(--primary-color);
margin-top: 25px;
margin-bottom: 15px;
padding-bottom: 8px;
border-bottom: 2px solid var(--border-color);
}


.form-group {
margin-bottom: 20px;
}

.form-group label {
display: flex; /* Use flex to align icon */
align-items: center;
margin-bottom: 8px;
font-weight: 600;
color: var(--heading-color);
}

.form-group input, .form-group select {
width: 100%;
padding: 12px;
border: 1px solid var(--border-color);
border-radius: 5px;
background-color: var(--bg-color);
color: var(--text-color);
box-sizing: border-box;
transition: border-color 0.3s, box-shadow 0.3s;
font-size: 1rem;
}

.form-group input:focus, .form-group select:focus {
border-color: var(--primary-color);
box-shadow: 0 0 8px rgba(30, 58, 138, 0.3);
outline: none;
}

.form-row {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 20px;
}

.calculate-btn {
background: var(--gradient-primary);
color: white;
border: none;
padding: 15px 25px;
border-radius: 8px;
cursor: pointer;
font-size: 1.2rem;
font-weight: 700;
font-family: 'Montserrat', sans-serif;
margin-top: 25px;
transition: transform 0.2s, box-shadow 0.3s;
position: relative;
overflow: hidden;
width: 100%;
}

.calculate-btn:hover {
transform: translateY(-3px);
box-shadow: var(--button-hover-shadow);
}

.calculate-btn .ripple {
position: absolute;
border-radius: 50%;
background-color: rgba(255, 255, 255, 0.7);
animation: ripple-effect 0.6s linear forwards;
transform: scale(0);
pointer-events: none;
}

@keyframes ripple-effect {
to {
transform: scale(4);
opacity: 0;
}
}

.result-container {
margin-top: 40px;
padding: 25px;
border-radius: 12px;
background-color: var(--card-bg);
box-shadow: var(--card-shadow);
display: none;
opacity: 0;
transform: translateY(30px);
transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}

.result-container.show {
display: block;
opacity: 1;
transform: translateY(0);
}

.result-container h3 {
color: var(--primary-color);
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
font-size: 1.8rem;
text-align: center;
}

.calculation-step-container {
margin-bottom: 20px;
border: 1px solid var(--border-color);
border-radius: 8px;
overflow: hidden;
opacity: 0;
transform: translateX(-20px);
animation: fadeInSlideIn 0.5s ease-out forwards;
transition: box-shadow 0.3s;
}

.calculation-step-container:nth-child(odd) {
background-color: var(--hover-color);
}

.step-header {
background-color: var(--hover-color);
padding: 15px 20px;
font-weight: 700;
font-size: 1.1rem;
color: var(--heading-color);
border-bottom: 1px solid var(--border-color);
cursor: pointer;
display: flex;
justify-content: space-between;
align-items: center;
}

body.dark-mode .calculation-step-container:nth-child(odd) {
background-color: #1a2433; /* Darker hover for odd steps */
}
body.dark-mode .step-header {
background-color: #2a3b52; /* Darker header */
}

.step-content {
padding: 20px;
display: block; /* Show by default */
}

.step-content p.formula {
font-family: 'Times New Roman', serif;
font-style: italic;
font-size: 1.2em;
text-align: center;
padding: 12px;
background-color: var(--bg-color);
border: 1px solid var(--border-color);
border-radius: 4px;
margin: 15px 0;
overflow-x: auto;
color: var(--text-color);
}

.step-content p.calculation {
font-family: 'Courier New', monospace;
background-color: var(--bg-color);
padding: 10px 15px;
border-radius: 3px;
margin-bottom: 10px;
color: var(--text-color);
word-wrap: break-word;
border-left: 3px solid var(--secondary-color);
}

.step-content .final-result {
font-weight: 700;
color: var(--primary-color);
background: var(--highlight-bg);
padding: 12px;
border-radius: 4px;
text-align: center;
margin-top: 15px;
font-size: 1.1rem;
}

.recommendations {
margin-top: 30px;
padding: 20px;
border: 2px solid var(--border-color);
border-radius: 8px;
background-color: var(--bg-color);
}

.recommendations h4 {
color: var(--secondary-color);
margin-top: 0;
font-family: 'Montserrat', sans-serif;
}

.recommendations ul {
padding-left: 20px;
}

.recommendations ul li {
margin-bottom: 10px;
}

.info-icon {
color: var(--secondary-color);
margin-left: 8px;
cursor: help;
font-size: 0.9em;
}

.tooltip {
position: relative;
display: inline-block;
}

.tooltip .tooltiptext {
visibility: hidden;
width: 280px;
background-color: #333;
color: #fff;
text-align: center;
border-radius: 6px;
padding: 10px;
position: absolute;
z-index: 10;
bottom: 135%;
left: 50%;
margin-left: -140px;
opacity: 0;
transition: opacity 0.3s;
font-weight: normal;
font-size: 0.9rem;
line-height: 1.4;
}

.tooltip:hover .tooltiptext {
visibility: visible;
opacity: 1;
}

#custom-message-box {
position: fixed;
top: 20px;
left: 50%;
transform: translateX(-50%);
padding: 15px 25px;
border-radius: 8px;
box-shadow: 0 4px 10px rgba(0,0,0,0.2);
z-index: 1000;
font-weight: bold;
color: white;
opacity: 0;
visibility: hidden;
transition: opacity 0.5s ease-in-out, visibility 0.5s;
}

#custom-message-box.show {
opacity: 1;
visibility: visible;
}

@keyframes fadeInSlideIn {
from {
opacity: 0;
transform: translateX(-20px);
}
to {
opacity: 1;
transform: translateX(0);
}
}

/* NEW STYLES FOR ENHANCED FEATURES */
.advanced-factors-section {
margin-top: 25px;
padding: 20px;
border: 1px solid var(--border-color);
border-radius: 8px;
background-color: var(--hover-color);
}

.advanced-factors-section h4 {
color: var(--primary-color);
margin-top: 0;
font-family: 'Montserrat', sans-serif;
}

.geometry-visualization {
margin-top: 30px;
padding: 20px;
border: 1px solid var(--border-color);
border-radius: 8px;
background-color: var(--card-bg);
}

.geometry-visualization h4 {
color: var(--primary-color);
margin-top: 0;
font-family: 'Montserrat', sans-serif;
text-align: center;
}

#gear-geometry-canvas {
width: 100%;
height: 300px;
border: 1px solid var(--border-color);
border-radius: 5px;
background-color: var(--bg-color);
}

.stress-analysis {
margin-top: 30px;
padding: 20px;
border: 1px solid var(--border-color);
border-radius: 8px;
background-color: var(--card-bg);
}

.stress-analysis h4 {
color: var(--primary-color);
margin-top: 0;
font-family: 'Montserrat', sans-serif;
}

.stress-item {
margin-bottom: 15px;
padding: 15px;
border-radius: 5px;
background-color: var(--hover-color);
}

.stress-item.critical {
border-left: 4px solid var(--fail-color);
}

.stress-item.warning {
border-left: 4px solid var(--warning-color);
}

.stress-item.info {
border-left: 4px solid var(--success-color);
}

.stress-item h5 {
margin-top: 0;
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 8px;
color: var(--heading-color);
}

.stress-item p {
margin: 0;
color: var(--text-color);
}

.export-section {
margin-top: 25px;
text-align: center;
}

.export-btn {
background-color: var(--secondary-color);
color: white;
border: none;
padding: 12px 20px;
border-radius: 8px;
cursor: pointer;
font-weight: 600;
transition: background-color 0.3s, transform 0.2s;
display: inline-flex;
align-items: center;
gap: 8px;
}

.export-btn:hover {
background-color: var(--primary-color);
transform: translateY(-2px);
}

.failure-analysis {
margin-top: 30px;
padding: 20px;
border: 1px solid var(--border-color);
border-radius: 8px;
background-color: var(--card-bg);
}

.failure-analysis h4 {
color: var(--primary-color);
margin-top: 0;
font-family: 'Montserrat', sans-serif;
}

.failure-item {
margin-bottom: 15px;
padding: 15px;
border-radius: 5px;
background-color: var(--hover-color);
}

.failure-item.critical {
border-left: 4px solid var(--fail-color);
}

.failure-item.warning {
border-left: 4px solid var(--warning-color);
}

.failure-item.info {
border-left: 4px solid var(--success-color);
}

.failure-item h5 {
margin-top: 0;
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 8px;
color: var(--heading-color);
}

.failure-item p {
margin: 0;
color: var(--text-color);
}
/* END: Calculator Specific Styles */


/* --- NEW FOOTER STYLES --- */
footer {
background: var(--gradient-dark);
color: #CBD5E1;
padding: 50px 0 20px 0;
}

.footer-content {
display: flex;
justify-content: space-between;
flex-wrap: wrap;
gap: 40px;
margin-bottom: 30px;
}

.footer-col {
flex: 1;
min-width: 200px;
}

.footer-col h4 {
color: white;
margin-bottom: 15px;
font-weight: 700;
}

.footer-col ul {
list-style: none;
padding: 0;
margin: 0;
}

.footer-col ul li {
margin-bottom: 10px;
}

.footer-col a {
color: #CBD5E1;
text-decoration: none;
transition: all 0.3s;
}

.footer-col a:hover {
color: var(--accent-color);
transform: translateX(3px);
}

.footer-disclaimer {
text-align: center;
margin: 30px auto;
padding-top: 25px;
border-top: 1px solid #334155;
max-width: 800px;
font-size: 0.9rem;
line-height: 1.6;
}

.footer-bottom {
text-align: center;
padding-top: 20px;
font-size: 0.9rem;
color: #94A3B8;
}

.creator-name {
color: var(--secondary-color);
font-weight: bold;
}

.social-buttons {
display: flex;
gap: 12px;
margin-top: 15px;
}

.social-btn {
width: 40px;
height: 40px;
display: flex;
justify-content: center;
align-items: center;
color: white;
border-radius: 50%;
text-decoration: none;
transition: all 0.3s;
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.social-btn:hover {
transform: translateY(-4px) scale(1.1);
box-shadow: 0 8px 16px rgba(0,0,0,0.3);
}

.social-btn.linkedin { background-color: #0A66C2; }
.social-btn.youtube { background-color: #FF0000; }
.social-btn.twitter { background-color: #1DA1F2; }
.social-btn.facebook { background-color: #1877F2; }
.social-btn.whatsapp { background-color: #25D366; }
/* --- END OF NEW FOOTER STYLES --- */


@media (max-width: 768px) {
.navbar { flex-direction: column; gap: 24px; }
.nav-links { flex-direction: column; gap: 12px; text-align: center; }
.form-row { grid-template-columns: 1fr; }
.container { padding: 0 15px; }
.content-container { padding: 0 15px; }
.tool-container { padding: 20px; }
.tooltip .tooltiptext { width: 200px; margin-left: -100px; }
.footer-content { flex-direction: column; }
}
</style>
</head>
<body>

<!-- HEADER (Replaced from new file) -->
<header class="header">
<div class="container">
<nav class="navbar">
<a href="/" class="logo-container">
<span class="logo-text">Design Calculators</span>
</a>
<ul class="nav-links">
<li><a href="/">Home</a></li>
<li><a href='/articles'>Articles</a></li>
<li><a href='/indexmech'>Mechanical</a></li>
<li><a href='/indexele'>Electrical</a></li>
<li><a href='/indexinst'>Instrumentation</a></li>
</ul>
<div class="theme-toggle">
<i class="fas fa-sun icon"></i>
<label class="switch">
<input type="checkbox" id="theme-switch">
<span class="slider"></span>
</label>
<i class="fas fa-moon icon"></i>
</div>
</nav>
</div>
</header>

<main class="content-container">
<div class="tool-container">
<h2>Mechanical Gear Design Calculator (AGMA)</h2>
<div class="tool-description">
<p>This calculator provides a step-by-step approach to designing Spur, Helical, and Bevel gears based on fundamental AGMA principles. Enter your initial parameters to determine the required geometry and analyze the gear set's strength against bending and pitting failures.</p>
</div>
<div class="calculator-form">
<form id="gear-design-form">

<!-- Gear Type Selection -->
<div class="form-section-header">1. Basic Design Parameters</div>
<div class="form-row">
<div class="form-group">
<label for="gear-type">Gear Type</label>
<select id="gear-type" required>
<option value="spur" selected>Spur Gear</option>
<option value="helical">Helical Gear</option>
<option value="bevel">Bevel Gear</option>
</select>
</div>
<div class="form-group">
<label for="pressure-angle">Pressure Angle, &phi; (degrees) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Standard values are 14.5°, 20°, 25°. 20° is most common.</span></span></label>
<input type="number" id="pressure-angle" value="20" min="14.5" max="25" step="0.5" required>
</div>
</div>

<!-- Input Parameters -->
<div class="form-row">
<div class="form-group">
<label for="power">Power (kW) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The power to be transmitted by the gear set.</span></span></label>
<input type="number" id="power" value="10" min="0.1" step="0.1" required>
</div>
<div class="form-group">
<label for="pinion-speed">Pinion Speed (RPM) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Rotational speed of the smaller gear (pinion).</span></span></label>
<input type="number" id="pinion-speed" value="1500" min="1" step="10" required>
</div>
<div class="form-group">
<label for="gear-ratio">Gear Ratio (i) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ratio of the gear speed to the pinion speed (must be > 1).</span></span></label>
<input type="number" id="gear-ratio" value="3" min="1.01" step="0.1" required>
</div>
</div>

<!-- Helical/Bevel Specific -->
<div class="form-row" id="helical-bevel-inputs">
<div class="form-group" id="helix-angle-group">
<label for="helix-angle">Helix Angle, &psi; (degrees) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">For helical gears, typically 15° to 30°.</span></span></label>
<input type="number" id="helix-angle" value="20" min="5" max="45" step="1">
</div>
<div class="form-group" id="shaft-angle-group">
<label for="shaft-angle">Shaft Angle, &Sigma; (degrees) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">For bevel gears, the angle between shafts. 90° is standard.</span></span></label>
<input type="number" id="shaft-angle" value="90" min="10" max="150" step="1">
</div>
</div>

<!-- Material and Strength Parameters -->
<div class="form-section-header">2. Material & Strength</div>
<div class="form-row">
<div class="form-group">
<label for="material-strength">Allowable Bending Stress, S<sub>at_base</sub> (MPa) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Base allowable *bending* stress for the gear material (e.g., Carburized Steel: 380-450 MPa).</span></span></label>
<input type="number" id="material-strength" value="400" min="50" step="10" required>
</div>
<div class="form-group">
<label for="surface-hardness">Surface Hardness (BHN) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Brinell Hardness Number for the gear material. Used to estimate allowable *contact* stress.</span></span></label>
<input type="number" id="surface-hardness" value="300" min="100" step="10" required>
</div>
<div class="form-group">
<label for="elastic-coefficient">Elastic Coefficient, C<sub>p</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">From AGMA 2001-D04, Table 13-10. 191 MPa<sup>0.5</sup> is for Steel/Steel.</span></span></label>
<input type="number" id="elastic-coefficient" value="191" min="100" step="1" required>
</div>
</div>

<!-- Design Factors -->
<div class="form-section-header">3. AGMA Industrial Factors (AGMA 2001-D04)</div>
<div class="advanced-factors-section" style="padding-top: 0;">
<div class="form-row">
<div class="form-group">
<label for="overload-factor">Overload Factor, K<sub>o</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Accounts for shock and load duration (e.g., 1.0 for uniform, 1.5 for moderate shock, 2.0 for heavy shock).</span></span></label>
<input type="number" id="overload-factor" value="1.5" min="1" max="3" step="0.1" required>
</div>
<div class="form-group">
<label for="dynamic-factor">Dynamic Factor, K<sub>v</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Accounts for internal dynamic effects (e.g., 1.1 for high quality, 1.3 for commercial).</span></span></label>
<select id="dynamic-factor">
<option value="1.0">Precision gears (Q > 10), low speed</option>
<option value="1.1" selected>High quality gears (Q=8-9), moderate speed</option>
<option value="1.3">Commercial quality (Q=6-7), moderate speed</option>
<option value="1.6">Low quality gears (Q < 6), high speed</option>
</select>
</div>
<div class="form-group">
<label for="load-distribution">Load Distribution, K<sub>m</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Accounts for non-uniform load distribution (AGMA 2001-D04)</span></span></label>
<select id="load-distribution">
<option value="1.0">Accurate mounting, low bearing clearance</option>
<option value="1.1" selected>Normal industrial practice</option>
<option value="1.3">Less rigid mountings, less accurate gears</option>
<option value="1.6">Non-rigid mountings, poor accuracy</option>
</select>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="reliability-factor">Reliability Factor, K<sub>R</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Based on required reliability (AGMA 2001-D04)</span></span></label>
<select id="reliability-factor">
<option value="0.70">50% Reliability</option>
<option value="0.80">90% Reliability</option>
<option value="1.00" selected>99% Reliability</option>
<option value="1.25">99.9% Reliability</option>
<option value="1.50">99.99% Reliability</option>
</select>
</div>
<div class="form-group">
<label for="temperature-factor">Temperature Factor, K<sub>T</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Based on operating temperature (AGMA 2001-D04)</span></span></label>
<select id="temperature-factor">
<option value="1.00" selected>Up to 120°C (250°F)</option>
<option value="1.05">120-150°C (250-300°F)</option>
<option value="1.10">150-175°C (300-350°F)</option>
<option value="1.15">175-200°C (350-400°F)</option>
<option value="1.25">Above 200°C (400°F)</option>
</select>
</div>
<div class="form-group">
<label for="factor-of-safety">Required Factor of Safety (FoS) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Desired factor of safety for both bending and wear. Typically 1.5 to 2.5.</span></span></label>
<input type="number" id="factor-of-safety" value="2" min="1.2" max="4" step="0.1" required>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="bending-geometry-factor">Bending Geometry Factor, J <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">From AGMA 2001-D04. 0.35 is a good estimate for a 20T pinion, 20° PA.</span></span></label>
<input type="number" id="bending-geometry-factor" value="0.35" min="0.1" max="0.8" step="0.01" required>
</div>
<div class="form-group">
<label for="pitting-geometry-factor">Pitting Geometry Factor, I <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">From AGMA 2001-D04. 0.10 is a good estimate for a 20T pinion, 3:1 ratio, 20° PA.</span></span></label>
<input type="number" id="pitting-geometry-factor" value="0.10" min="0.05" max="0.3" step="0.01" required>
</div>
<div class="form-group">
<label for="hardness-ratio-factor">Hardness Ratio Factor, C<sub>H</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">1.0 if pinion/gear hardness is similar. Can be > 1.0 if pinion is much harder.</span></span></label>
<input type="number" id="hardness-ratio-factor" value="1.0" min="1.0" max="1.2" step="0.01" required>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="bending-life-factor">Bending Life Factor, Y<sub>N</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">1.0 for 10^7 cycles. Increase for shorter life, decrease for longer (e.g., 0.85 for 10^9 cycles).</span></span></label>
<input type="number" id="bending-life-factor" value="1.0" min="0.5" max="2.5" step="0.01" required>
</div>
<div class="form-group">
<label for="pitting-life-factor">Pitting Life Factor, Z<sub>N</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">1.0 for 10^7 cycles. Increase for shorter life, decrease for longer (e.g., 0.85 for 10^9 cycles).</span></span></label>
<input type="number" id="pitting-life-factor" value="1.0" min="0.5" max="2.5" step="0.01" required>
</div>
</div>

</div>

<button type="button" id="calculate-btn" class="calculate-btn">Calculate Gear Design</button>
</form>
</div>
<div id="result-container" class="result-container">
<h3>Step-by-Step Design Calculation</h3>
<div id="calculation-steps"><!-- Calculation steps will be dynamically inserted here --></div>

<div class="geometry-visualization">
<h4>Gear Geometry Visualization</h4>
<canvas id="gear-geometry-canvas"></canvas>
</div>

<div class="stress-analysis">
<h4>Stress Analysis Results</h4>
<div id="stress-analysis-content">
<!-- Stress analysis will be dynamically inserted here -->
</div>
</div>

<div class="failure-analysis">
<h4>Failure Mode Analysis</h4>
<div id="failure-analysis-content">
<!-- Failure analysis will be dynamically inserted here -->
</div>
</div>

<div class="recommendations">
<h4>Applicable Standards & Recommendations</h4>
<div id="recommendations-content">
<!-- Recommendations will be dynamically inserted here -->
</div>
</div>

<div class="export-section">
<button id="export-report" class="export-btn"><i class="fas fa-file-pdf"></i> Export Calculation Report</button>
</div>
</div>
</div>


<!-- START: NEW 800+ WORD EDUCATIONAL CONTENT -->
<div class="tool-container" style="margin-top: 40px;">
<h2>The Industrial Heartbeat: A Deep-Dive into Gear Design</h2>

<h3 style="color: var(--primary-color); margin-top: 25px;">Why Gears are the Unsung Heroes of Modern Industry</h3>
<p>From the colossal gearboxes driving ship propellers to the microscopic gears in a surgical robot, these toothed wheels are the fundamental components of power transmission. Their primary function is simple to state but incredibly complex to execute: to transmit torque and motion, precisely and reliably, often changing the speed, direction, or axis of rotation. A modern wind turbine, for example, relies on a massive planetary gearbox to convert the slow, high-torque rotation of the blades (around 15 RPM) into the high-speed rotation (over 1,500 RPM) required by the generator. The failure of a single gear tooth in that gearbox can bring a multi-million-dollar asset to a standstill. This calculator is designed to analyze the two primary ways a gear fails: by breaking a tooth (bending fatigue) or by wearing out its surface (pitting).</p>

<h3 style="color: var(--primary-color); margin-top: 25px;">The Language of Precision: Key International Standards (AGMA, ISO)</h3>
<p>A professional gear design is not a guess; it's a calculation based on globally accepted standards that ensure reliability and interoperability. Without these, a gearbox built in Germany wouldn't work with a motor built in Japan. This tool's logic is based on the principles from these key documents:</p>
<ul>
<li><strong>AGMA 2001-D04 (Spur & Helical):</strong> This is the North American "bible" for gear design, titled "Fundamental Rating Factors and Calculation Methods for Involute Spur and Helical Gear Teeth." It provides the comprehensive, factor-based methodology for calculating the two critical stresses: <strong>Bending Stress (&sigma;<sub>b</sub>)</strong> and <strong>Contact Stress (&sigma;<sub>c</sub>)</strong>. This calculator uses the core formulas from this standard.</li>
<li><strong>ISO 6336 (Spur & Helical):</strong> This is the International Organization for Standardization's equivalent to AGMA 2001. While the factors and formulas look different, the underlying physics and end results are very similar. It is the dominant standard in Europe and much of Asia.</li>
<li><strong>AGMA 2003-B97 / ISO 10300 (Bevel Gears):</strong> Bevel gears are geometrically more complex, and these standards provide the specific methods to account for their tapered shape and the forces that try to push them apart.</li>
<li><strong>AGMA 9005 (Lubrication):</strong> A gear's life is not just about the metal; it's about the microscopic film of oil that separates the teeth. This standard dictates the type, viscosity, and application method of the lubricant, which is critical for preventing scoring (a catastrophic failure from metal-to-metal welding) and managing temperature (K<sub>T</sub>).</li>
</ul>

<h3 style="color: var(--primary-color); margin-top: 25px;">The Two Battles Every Gear Must Win: Bending vs. Pitting</h3>
<p>Every gear in operation is fighting a war on two fronts simultaneously. A design is only successful if it wins *both* battles for its entire required life.</p>

<h4>1. Bending Failure (The "Snap"):</h4>
<p>This is a catastrophic failure where a gear tooth breaks off at its base (the root). Think of bending a paperclip back and forth until it snaps. The load on the tooth acts like a lever, creating maximum tensile stress at the root.
<ul>
<li><strong>What it is:</strong> A high-cycle fatigue crack that starts at the root and propagates until the tooth breaks off.</li>
<li><strong>The Formula:</strong> This is calculated as <strong>Bending Stress (&sigma;<sub>b</sub>)</strong>.</li>
<li><strong>Key Factors:</strong>
    <ul>
    <li><strong>J (Geometry Factor):</strong> This is one of the most important factors. It describes the *shape* of the tooth. A thick, stubby tooth has a high J-factor and is very strong in bending, while a tall, thin tooth has a low J-factor.</li>
    <li><strong>Y<sub>N</sub> (Life Factor):</strong> This factor adjusts the material's strength based on the required number of cycles. If you only need 100,000 cycles, you can allow a much higher stress than if you need 10 billion cycles.</li>
    <li><strong>K<sub>m</sub> (Load Distribution):</strong> This accounts for "real-world" problems. If the shafts deflect, the gear will only be making contact on one edge, concentrating the entire load and skyrocketing the bending stress.</li>
    </ul>
</li>
</ul>
</p>

<h4>2. Pitting Failure (The "Wear"):</h4>
<p>This is a "durability" failure of the gear's surface. Instead of snapping, the surface of the tooth flakes away, creating small pits. This is also a fatigue failure, but it's driven by the immense compressive stress where the two curved surfaces of the teeth roll and slide against each other.
<ul>
<li><strong>What it is:</strong> A surface fatigue failure that starts as microscopic cracks and grows into visible pits, destroying the tooth profile, causing noise, and eventually leading to tooth breakage.</li>
<li><strong>The Formula:</strong> This is calculated as <strong>Contact Stress (&sigma;<sub>c</sub>)</strong>.</li>
<li><strong>Key Factors:</strong>
    <ul>
    <li><strong>I (Geometry Factor):</strong> This factor describes the *curvature* of the two teeth at the point of contact. Two flat surfaces would have a low stress, while two sharp points would have an infinite stress. This factor quantifies the "gentleness" of the contact.</li>
    <li><strong>Z<sub>N</sub> (Life Factor):</b> Similar to the bending life factor, this adjusts the surface strength based on the required life.</li>
    <li><strong>C<sub>p</sub> (Elastic Coefficient):</strong> This factor is purely about the materials. Steel on steel is very stiff and creates a small, high-stress contact patch. Steel on bronze would deform more, creating a larger, lower-stress patch.</li>
    <li><strong>C<sub>H</sub> (Hardness Ratio):</strong> This is a "bonus" factor. If you make the pinion (the smaller gear) significantly harder than the gear, it will "run in" and smooth the gear's surface, increasing the pitting life of the *pair*.</li>
    </ul>
</li>
</ul>
<strong>In most industrial designs (like gearboxes for pumps, conveyors, or turbines), pitting resistance (Contact Stress) is the primary design driver.</strong> The gear is often "sized" to have just enough pitting life, and then the bending strength is checked to ensure it's also safe.</p>

<h3 style="color: var(--primary-color); margin-top: 25px;">Beyond the Tooth: Critical Quality & Validation Checks</h3>
<p>A design on paper is worthless until it's manufactured correctly. In an industrial setting, validation is paramount.</p>
<ol>
<li><strong>Material Certification:</strong> The design is *based* on the material. The manufacturer must provide certification that the steel is the correct grade (e.g., 4140, 4340, 9310 steel) and has the correct alloy composition.</li>
<li><strong>Heat Treatment:</strong> This is what gives the gear its strength. The process (e.g., carburizing, nitriding, through-hardening) is precisely controlled to achieve the target <strong>Surface Hardness (BHN or HRC)</strong> and core toughness. A single mistake here can make a gear fail in hours instead of years.</li>
<li><strong>Tooth Profile & Lead Check:</strong> A specialized CMM (Coordinate Measuring Machine) traces the exact profile of the gear tooth and compares it to the perfect theoretical shape. This check ensures the "AGMA Quality Number" (like Q9 or Q11) is met, which directly impacts the Dynamic Factor (K<sub>v</sub>).</li>
<li><strong>Contact Pattern Check:</strong> The gears are assembled, coated with a thin layer of Prussian blue dye, and rolled together. The pattern wiped off in the dye shows *exactly* where the teeth are touching. This is the ultimate validation of the Load Distribution (K<sub>m</sub>), proving the load is centered on the tooth and not on an edge.</li>
<li><strong>Backlash Measurement:</strong> The "wiggle room" or gap between teeth is measured. Too little, and the gears will bind and overheat. Too much, and they will slam into each other on every rotation, causing high dynamic loads.</li>
</ol>

<h3 style="color: var(--primary-color); margin-top: 25px;">Latest Trends & Innovations in Gearing</h3>
<p>The humble gear is still evolving at a rapid pace, driven by demands for more power in smaller, quieter, and lighter packages.</p>
<ul>
<li><strong>Advanced Materials:</strong> Designers are moving beyond traditional steels to Austempered Ductile Iron (ADI), which offers a good combination of strength and low cost, as well as powdered metal components for complex shapes. In high-performance applications, engineering plastics (like PEEK) and composites are used for lightweight, low-noise operation.</li>
<li><strong>Surface Engineering:</strong> The "next frontier" is in surface treatment. Superfinishing (or "isotropic finishing") polishes the gear to a mirror-like state, dramatically reducing friction and increasing pitting life. Specialized coatings like DLC (Diamond-Like Carbon) or TiN (Titanium Nitride) are used to create ultra-hard, low-friction surfaces for extreme applications.</li>
<li><strong>Asymmetric Tooth Profiles:</strong> For applications that only ever rotate in one direction (like a pump or turbine), engineers are designing gears with different profiles on the "drive" side and the "coast" side. The drive side is optimized for maximum bending and pitting strength, while the coast side is just there to maintain contact. This can increase power density by 15-30%.</li>
<li><strong>Digital Twins & Simulation:</strong> Instead of just using 1D formulas (like in this calculator), engineers now build a complete 3D "Digital Twin" of the gearbox in software. They use Finite Element Analysis (FEA) and multi-body dynamics to simulate the exact stress on every part of the tooth, predict noise and vibration (NVH), analyze lubrication flow, and run through a lifetime of cycles in just a few hours.</li>
</ul>
</div>
<!-- END: NEW 800+ WORD EDUCATIONAL CONTENT -->

</main>

<!-- FOOTER (Replaced from new file) -->
<footer>
<div class="container">
<div class="footer-content">
<div class="footer-col">
<h4>Design Calculators</h4>
<p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
<div class="social-buttons">
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin"><i class="fab fa-linkedin-in"></i></a>
<a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube"><i class="fab fa-youtube"></i></a>
<a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter"><i class="fab fa-twitter"></i></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook"><i class="fab fa-facebook-f"></i></a>
<a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"><i class="fab fa-whatsapp"></i></a>
</div>
</div>
<div class="footer-col">
<h4>Quick Links</h4>
<ul>
<li><a href="/">Home</a></li>
<li><a href='/indexele'>Electrical</a></li>
<li><a href='/indexmech'>Mechanical</a></li>
<li><a href='/indexinst'>Instrumentation</a></li>
</ul>
</div>
<div class="footer-col">
<h4>Resources</h4>
<ul>
<li><a href='/about'>About Us</a></li>
<li><a href='/contact'>Contact</a></li>
<li><a href='/faq'>FAQ</a></li>
<li><a href='/privacy-policy'>Privacy Policy</a></li>
<li><a href='/terms-of-service'>Terms of Service</a></li>
</ul>
</div>
<div class="footer-col">
<h4>More</h4>
<ul>
<li><a href='/articles'>Articles & Blog</a></li>
<li><a href='/sitemap2'>Sitemap</a></li>
<li><a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer">YouTube Channel</a></li>
</ul>
</div>
</div>

<div class="footer-disclaimer">
<!-- Updated Disclaimer -->
<p> All tools are for guidance only and should not replace professional engineering judgment. Results must be verified by a qualified professional against project requirements and local codes. </p>
</div>

<div class="footer-bottom">
<p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
</div>
</div>
</footer>

<div id="custom-message-box"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
// --- FORM ELEMENTS ---
const gearTypeSelect = document.getElementById('gear-type');
const helixAngleGroup = document.getElementById('helix-angle-group');
const shaftAngleGroup = document.getElementById('shaft-angle-group');
const calculateBtn = document.getElementById('calculate-btn');
const resultContainer = document.getElementById('result-container');
const calculationStepsDiv = document.getElementById('calculation-steps');
const recommendationsDiv = document.getElementById('recommendations-content');
const stressAnalysisDiv = document.getElementById('stress-analysis-content');
const failureAnalysisDiv = document.getElementById('failure-analysis-content');
const exportReportBtn = document.getElementById('export-report');

// Canvas for gear visualization
const canvas = document.getElementById('gear-geometry-canvas');
const ctx = canvas.getContext('2d');

// Set canvas dimensions
canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;

// --- HELPER FUNCTIONS ---
const toRad = (deg) => deg * Math.PI / 180;
const toDeg = (rad) => rad * 180 / Math.PI;

// --- UI LOGIC ---
function toggleInputs() {
const gearType = gearTypeSelect.value;
helixAngleGroup.style.display = gearType === 'helical' ? 'block' : 'none';
shaftAngleGroup.style.display = gearType === 'bevel' ? 'block' : 'none';
}

gearTypeSelect.addEventListener('change', toggleInputs);
toggleInputs(); // Initial call

calculateBtn.addEventListener('click', (e) => {
const ripple = document.createElement('span');
const rect = calculateBtn.getBoundingClientRect();
const diameter = Math.max(calculateBtn.clientWidth, calculateBtn.clientHeight);
const radius = diameter / 2;
ripple.style.width = ripple.style.height = `${diameter}px`;
ripple.style.left = `${e.clientX - (rect.left + radius)}px`;
ripple.style.top = `${e.clientY - (rect.top + radius)}px`;
ripple.classList.add('ripple');
calculateBtn.appendChild(ripple);
ripple.addEventListener('animationend', () => ripple.remove());

if (validateInputs()) {
performCalculation();
}
});

function validateInputs() {
// Simple validation for required fields
const inputs = document.querySelectorAll('#gear-design-form [required]');
for (const input of inputs) {
if (!input.value) {
displayMessage(`Error: "${input.previousElementSibling.textContent || input.labels[0].textContent}" cannot be empty.`, "error");
input.focus();
return false;
}
if (parseFloat(input.value) <= 0) {
if (input.id === 'gear-ratio' && parseFloat(input.value) <= 1) {
displayMessage(`Error: Gear Ratio must be greater than 1.`, "error");
input.focus();
return false;
} else if (input.id !== 'gear-ratio') {
displayMessage(`Error: "${input.previousElementSibling.textContent || input.labels[0].textContent}" must be positive.`, "error");
input.focus();
return false;
}
}
}
return true;
}

// --- CALCULATION LOGIC (UPGRADED TO AGMA) ---
function performCalculation() {
// 1. Get all inputs
const inputs = {
gearType: gearTypeSelect.value,
P: parseFloat(document.getElementById('power').value), // kW
n_p: parseFloat(document.getElementById('pinion-speed').value), // RPM
i: parseFloat(document.getElementById('gear-ratio').value),
phi_deg: parseFloat(document.getElementById('pressure-angle').value),
psi_deg: gearTypeSelect.value === 'helical' ? parseFloat(document.getElementById('helix-angle').value) : 0,
Sigma_deg: gearTypeSelect.value === 'bevel' ? parseFloat(document.getElementById('shaft-angle').value) : 90,
Sat_base: parseFloat(document.getElementById('material-strength').value), // MPa
BHN: parseFloat(document.getElementById('surface-hardness').value),
Cp: parseFloat(document.getElementById('elastic-coefficient').value),
Ko: parseFloat(document.getElementById('overload-factor').value),
FoS_req: parseFloat(document.getElementById('factor-of-safety').value),
KR: parseFloat(document.getElementById('reliability-factor').value),
KT: parseFloat(document.getElementById('temperature-factor').value),
Km: parseFloat(document.getElementById('load-distribution').value),
Kv: parseFloat(document.getElementById('dynamic-factor').value),
J: parseFloat(document.getElementById('bending-geometry-factor').value),
I: parseFloat(document.getElementById('pitting-geometry-factor').value),
CH: parseFloat(document.getElementById('hardness-ratio-factor').value),
YN: parseFloat(document.getElementById('bending-life-factor').value),
ZN: parseFloat(document.getElementById('pitting-life-factor').value)
};

calculationStepsDiv.innerHTML = '';
stressAnalysisDiv.innerHTML = '';
failureAnalysisDiv.innerHTML = '';

const phi_rad = toRad(inputs.phi_deg);
const psi_rad = toRad(inputs.psi_deg);

// --- Step 1: Initial Torque ---
const T_p = (inputs.P * 1000 * 60) / (2 * Math.PI * inputs.n_p); // Pinion Torque in N-m
addCalculationStep(1, 'Input Torque (T_p)',
'$$T_p = \\frac{P \\times 1000 \\times 60}{2 \\pi n_p}$$',
`$$T_p = \\frac{${inputs.P} \\times 1000 \\times 60}{2 \\pi \\times ${inputs.n_p}}$$`,
`Pinion Torque (T_p) = ${T_p.toFixed(2)} N-m`);

// --- Step 2: Initial Sizing (Teeth & Module) ---
let Zp = inputs.gearType === 'bevel' ? Math.max(15, 20 / (Math.sin(toRad(inputs.Sigma_deg / (1 + inputs.i))))) : 18; // Assume number of teeth on pinion
Zp = Math.round(Zp);
const Zg = Math.round(Zp * inputs.i); // Number of teeth on gear

// Estimate module 'm' based on torque and allowable *bending* stress
// This is a rough starting point
let m_cubed_term = (2 * T_p * 1000 * inputs.Ko * inputs.Km) / (inputs.Sat_base * inputs.Kv * 10 * Zp * inputs.J);
if (inputs.gearType === 'helical') {
m_cubed_term /= Math.cos(psi_rad);
}
let m = Math.pow(m_cubed_term, 1/3);

// Standardize module
const standardModules = [1, 1.25, 1.5, 2, 2.5, 3, 4, 5, 6, 8, 10, 12, 16, 20];
m = standardModules.find(sm => sm >= m) || standardModules[standardModules.length - 1];
const b = 10 * m; // Face width (assume b = 10*m)

addCalculationStep(2, 'Initial Geometry Sizing (Teeth & Module)',
'Estimate minimum number of teeth (Zp). Calculate required module (m) based on bending strength.',
`Assumed Pinion Teeth (Zp) = ${Zp}<br>Calculated Gear Teeth (Zg) = ${Zg}<br>Calculated minimum module ≈ ${m.toFixed(2)} mm.<br>Selecting next standard module.`,
`Zp = ${Zp}, Zg = ${Zg}<br>Standard Module (m) = ${m} mm<br>Face Width (b) = ${b} mm`);

// --- Step 3: Gear Geometry & Velocity ---
const d_p = m * Zp / (inputs.gearType === 'helical' ? Math.cos(psi_rad) : 1);
const d_g = m * Zg / (inputs.gearType === 'helical' ? Math.cos(psi_rad) : 1);
const center_distance = (d_p + d_g) / 2;
const v = (Math.PI * d_p * inputs.n_p) / (60 * 1000); // Pitch line velocity in m/s

addCalculationStep(3, 'Main Gear Dimensions & Velocity',
'$$d_p = m Z_p$$ $$d_g = m Z_g$$ $$v = \\frac{\\pi d_p n_p}{60,000}$$',
`dp = ${m} * ${Zp} = ${d_p.toFixed(2)} mm<br>dg = ${m} * ${Zg} = ${d_g.toFixed(2)} mm<br>a = ${center_distance.toFixed(2)} mm<br>v = (π * ${d_p.toFixed(2)} * ${inputs.n_p}) / 60000 = ${v.toFixed(2)} m/s`,
`Pinion Pitch Diameter (dp) = ${d_p.toFixed(2)} mm<br>Pitch Line Velocity (v) = ${v.toFixed(2)} m/s`);

// --- Step 4: Load Calculation ---
const Wt = (inputs.P * 1000) / v; // Tangential force in N
const Fr = Wt * Math.tan(phi_rad); // Radial force (for spur)
const Fa = Wt * Math.tan(psi_rad); // Axial force (for helical)

let forcesText = `Wt = (${inputs.P} * 1000) / ${v.toFixed(2)} = ${Wt.toFixed(2)} N`;
if (inputs.gearType === 'spur') {
forcesText += `<br>Fr = ${Wt.toFixed(2)} * tan(${inputs.phi_deg}°) = ${Fr.toFixed(2)} N`;
} else if (inputs.gearType === 'helical') {
forcesText += `<br>Fa = ${Wt.toFixed(2)} * tan(${inputs.psi_deg}°) = ${Fa.toFixed(2)} N`;
}

addCalculationStep(4, 'Transmitted Load (Wt)',
'$$W_t = \\frac{P \\times 1000}{v}$$',
forcesText,
`Tangential Load (Wt) = ${Wt.toFixed(2)} N`);

// --- Step 5: AGMA Bending Stress ---
// sigma_b = Wt * Ko * Kv * Km * (1 / (b * m * J)) * KT * KR (Note: 1/m = P_d / pi, m is metric)
// The formula in AGMA is Wt * Ko * Kv * Km * Pd / (F * J)
// Pd = 25.4 / m (diametral pitch)
// F = b (face width)
// Let's use the metric version: sigma_b = Wt * Ko * Kv * Km * (1 / (b * m_t * J)) * KT * KR
// where m_t is transverse module (which is just 'm' for spur, m_n / cos(psi) for helical)
// The J factor is for transverse plane.
// Let's use the provided 'm' as the transverse module for simplicity.
// A more correct formula uses metric module m_n
// For Helical: m_t = m_n / cos(psi). But we sized m based on d_p = m*Zp / cos(psi).
// This implies our 'm' is already the normal module (m_n). Let's assume m = m_n.
// d_p = m_n * Zp / cos(psi).
// Let's assume the input J factor is in the normal plane.
// sigma_b = Wt * Ko * Kv * Km / (b * m * J) * KT * KR
// This seems to be the most consistent interpretation.
const sigma_b = (Wt * inputs.Ko * inputs.Kv * inputs.Km) / (b * m * inputs.J) * inputs.KT * inputs.KR;

addCalculationStep(5, 'AGMA Bending Stress (σ_b)',
'$$\\sigma_b = \\frac{W_t K_o K_v K_m}{b m J} K_T K_R$$',
`σ_b = (${Wt.toFixed(2)} * ${inputs.Ko} * ${inputs.Kv} * ${inputs.Km}) / (${b} * ${m} * ${inputs.J}) * ${inputs.KT} * ${inputs.KR}`,
`Induced Bending Stress (σ_b) = ${sigma_b.toFixed(2)} MPa`);

// --- Step 6: AGMA Allowable Bending Stress & FoS ---
const Sat = inputs.Sat_base * (inputs.YN / (inputs.KT * inputs.KR));
const FoS_bending = Sat / sigma_b;
let b_check_result = FoS_bending >= inputs.FoS_req ? "SAFE" : "FAIL";

addCalculationStep(6, 'AGMA Allowable Bending Stress (S_at) & FoS',
'$$S_{at} = S_{at,base} \\frac{Y_N}{K_T K_R}$$ $$FoS_b = \\frac{S_{at}}{\\sigma_b}$$',
`Allowable Bending Stress (S_at) = ${inputs.Sat_base} * (${inputs.YN} / (${inputs.KT} * ${inputs.KR})) = ${Sat.toFixed(2)} MPa<br>Factor of Safety (Bending) = ${Sat.toFixed(2)} / ${sigma_b.toFixed(2)} = ${FoS_bending.toFixed(2)}`,
`Allowable Bending Stress (S_at) = ${Sat.toFixed(2)} MPa<br>Bending FoS = ${FoS_bending.toFixed(2)} (Req: ${inputs.FoS_req}) [${b_check_result}]`);

// --- Step 7: AGMA Contact Stress (σ_c) ---
// sigma_c = Cp * sqrt(Wt * Ko * Kv * Km / (b * d_p * I) * CH * KT * KR)
// This is slightly simplified. Let's use it.
const sigma_c_term = (Wt * inputs.Ko * inputs.Kv * inputs.Km) / (b * d_p * inputs.I) * inputs.CH * inputs.KT * inputs.KR;
const sigma_c = inputs.Cp * Math.sqrt(sigma_c_term);

addCalculationStep(7, 'AGMA Contact Stress (σ_c)',
'$$\\sigma_c = C_p \\sqrt{\\frac{W_t K_o K_v K_m}{b d_p I} C_H K_T K_R}$$',
`Term inside sqrt = (${Wt.toFixed(2)} * ${inputs.Ko} * ...) / (${b} * ${d_p.toFixed(2)} * ${inputs.I}) * ... = ${sigma_c_term.toFixed(2)}<br>σ_c = ${inputs.Cp} * sqrt(${sigma_c_term.toFixed(2)})`,
`Induced Contact Stress (σ_c) = ${sigma_c.toFixed(2)} MPa`);

// --- Step 8: AGMA Allowable Contact Stress & FoS ---
const Sac_base = 2.8 * inputs.BHN - 69; // (MPa) Approximation
const Sac = Sac_base * (inputs.ZN * inputs.CH / (inputs.KT * inputs.KR));
const FoS_pitting = Math.pow((Sac / sigma_c), 2);
let w_check_result = FoS_pitting >= inputs.FoS_req ? "SAFE" : "FAIL";

addCalculationStep(8, 'AGMA Allowable Contact Stress (S_ac) & FoS',
'$$S_{ac,base} \\approx 2.8 \\times BHN - 69$$ $$S_{ac} = S_{ac,base} \\frac{Z_N C_H}{K_T K_R}$$ $$FoS_c = (\\frac{S_{ac}}{\\sigma_c})^2$$',
`Base Allowable Contact Stress (S_ac,base) ≈ ${Sac_base.toFixed(2)} MPa<br>Allowable Contact Stress (S_ac) = ${Sac_base.toFixed(2)} * (...) = ${Sac.toFixed(2)} MPa<br>Factor of Safety (Pitting) = (${Sac.toFixed(2)} / ${sigma_c.toFixed(2)})^2`,
`Allowable Contact Stress (S_ac) = ${Sac.toFixed(2)} MPa<br>Pitting FoS = ${FoS_pitting.toFixed(2)} (Req: ${inputs.FoS_req}) [${w_check_result}]`);

// --- Final Rendering ---
if (window.MathJax) {
try {
window.MathJax.typesetPromise([calculationStepsDiv]);
} catch (e) {
console.error("MathJax typesetting error: ", e);
}
}
resultContainer.classList.add('show');
setTimeout(() => resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }), 300);

// Draw gear visualization
drawGearVisualization(d_p, d_g, Zp, Zg, inputs.gearType);

// Perform stress analysis
performStressAnalysis(inputs, sigma_b, sigma_c, FoS_bending, FoS_pitting, Sat, Sac);

// Perform failure analysis
performFailureAnalysis(inputs, Wt, d_p, v, FoS_bending, FoS_pitting);

// --- Recommendations ---
recommendationsDiv.innerHTML = `
<ul>
<li><strong>AGMA 2001-D04:</strong> This is the primary standard for the 'Fundamental Rating Factors and Calculation Methods for Involute Spur and Helical Gear Teeth'. The factors used (K, Y, Z, I, J) are key components of this standard.</li>
<li><strong>AGMA 2003-B97:</strong> For the bevel gear design, refer to this standard, 'Rating the Pitting Resistance and Bending Strength of Bevel Gear Teeth'.</li>
<li><strong>Material Selection:</strong> The selected material must have an allowable bending stress (S<sub>at</sub>) of at least <strong>${sigma_b.toFixed(2)} MPa</strong> and an allowable contact stress (S<sub>ac</sub>) of at least <strong>${sigma_c.toFixed(2)} MPa</strong> (when FoS=1).</li>
<li><strong>Design Iteration:</strong> If the design is not safe (FAIL), consider the following:
<ul>
<li><strong>To Fix Bending (FoS_b):</strong> Increase module (m), increase face width (b), select a stronger material (higher S<sub>at_base</sub>), or use a better geometry (higher J-factor).</li>
<li><strong>To Fix Pitting (FoS_c):</strong> Increase pinion diameter (d_p via module or Zp), increase face width (b), increase surface hardness (BHN), or use a better geometry (higher I-factor).</li>
</ul>
</li>
<li><strong>Factor Validation:</strong> The 'J' and 'I' factors are estimates. For a final design, these must be calculated precisely from AGMA charts based on exact tooth counts, addendum, and helix angle.</li>
</ul>`;
}

function addCalculationStep(step, title, formula, calculation, result) {
const stepDiv = document.createElement('div');
stepDiv.className = 'calculation-step-container';
stepDiv.style.animationDelay = `${step * 0.05}s`;

let content = `<div class="step-header"><span><strong>Step ${step}:</strong> ${title}</span></div>
<div class="step-content">`;
if (formula) content += `<p class="formula">${formula}</p>`;
if (calculation) content += `<p class="calculation">${calculation}</p>`;
if (result) content += `<p class="final-result">${result}</p>`;
content += `</div>`;

stepDiv.innerHTML = content;
calculationStepsDiv.appendChild(stepDiv);
}

function drawGearVisualization(d_p, d_g, Zp, Zg, gearType) {
// Clear canvas
ctx.clearRect(0, 0, canvas.width, canvas.height);
ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--card-bg');
ctx.fillRect(0, 0, canvas.width, canvas.height);


// Scale factors for visualization
const totalDiameter = d_p + d_g;
const scale = Math.min(canvas.width / (totalDiameter * 1.1), canvas.height / (Math.max(d_p, d_g) * 1.2));
const centerX = canvas.width / 2;
const centerY = canvas.height / 2;
const center_dist_scaled = (d_p + d_g) / 2 * scale;

const pinionX = centerX - d_g / 2 * scale;
const gearX = centerX + d_p / 2 * scale;
const pinionR = d_p / 2 * scale;
const gearR = d_g / 2 * scale;

ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--secondary-color');
ctx.lineWidth = 2;

// Pinion
ctx.beginPath();
ctx.arc(pinionX, centerY, pinionR, 0, 2 * Math.PI);
ctx.stroke();

// Gear
ctx.beginPath();
ctx.arc(gearX, centerY, gearR, 0, 2 * Math.PI);
ctx.stroke();

// Add labels
ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--heading-color');
ctx.font = '14px Inter';
ctx.textAlign = 'center';
ctx.fillText(`Pinion (${Zp} teeth)`, pinionX, centerY - pinionR - 15);
ctx.fillText(`Gear (${Zg} teeth)`, gearX, centerY - gearR - 15);

// Add dimensions
ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--text-color');
ctx.setLineDash([5, 3]);
ctx.beginPath();
ctx.moveTo(pinionX, centerY);
ctx.lineTo(gearX, centerY);
ctx.stroke();
ctx.setLineDash([]);

ctx.fillText(`${((d_p + d_g)/2).toFixed(2)} mm`, centerX, centerY + 20);

// Add gear type indicator
ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--accent-color');
ctx.font = 'bold 16px Montserrat';
ctx.fillText(`${gearType.charAt(0).toUpperCase() + gearType.slice(1)} Gear Set`, centerX, 30);
}

function performStressAnalysis(inputs, sigma_b, sigma_c, FoS_bending, FoS_pitting, Sat, Sac) {
let analysisHTML = '';

// Bending stress analysis
if (FoS_bending >= inputs.FoS_req) {
analysisHTML += `
<div class="stress-item info">
<h5><i class="fas fa-check-circle"></i> Bending Stress: SAFE</h5>
<p>Induced: <strong>${sigma_b.toFixed(2)} MPa</strong> | Allowable: <strong>${Sat.toFixed(2)} MPa</strong><br>
Factor of Safety = <strong>${FoS_bending.toFixed(2)}</strong> (Required: ${inputs.FoS_req})</p>
</div>
`;
} else if (FoS_bending >= 1.0) {
analysisHTML += `
<div class="stress-item warning">
<h5><i class="fas fa-exclamation-circle"></i> Bending Stress: WARNING</h5>
<p>Induced: <strong>${sigma_b.toFixed(2)} MPa</strong> | Allowable: <strong>${Sat.toFixed(2)} MPa</strong><br>
Factor of Safety = <strong>${FoS_bending.toFixed(2)}</strong> (Below required FoS of ${inputs.FoS_req} but > 1.0)</p>
</div>
`;
} else {
analysisHTML += `
<div class="stress-item critical">
<h5><i class="fas fa-exclamation-triangle"></i> Bending Stress: CRITICAL (FAIL)</h5>
<p>Induced: <strong>${sigma_b.toFixed(2)} MPa</strong> | Allowable: <strong>${Sat.toFixed(2)} MPa</strong><br>
Factor of Safety = <strong>${FoS_bending.toFixed(2)}</strong> (Below 1.0 - static failure is likely)</p>
</div>
`;
}

// Contact stress analysis
if (FoS_pitting >= inputs.FoS_req) {
analysisHTML += `
<div class="stress-item info">
<h5><i class="fas fa-check-circle"></i> Contact Stress: SAFE</h5>
<p>Induced: <strong>${sigma_c.toFixed(2)} MPa</strong> | Allowable: <strong>${Sac.toFixed(2)} MPa</strong><br>
Factor of Safety = <strong>${FoS_pitting.toFixed(2)}</strong> (Required: ${inputs.FoS_req})</p>
</div>
`;
} else if (FoS_pitting >= 1.0) {
analysisHTML += `
<div class="stress-item warning">
<h5><i class="fas fa-exclamation-circle"></i> Contact Stress: WARNING</h5>
<p>Induced: <strong>${sigma_c.toFixed(2)} MPa</strong> | Allowable: <strong>${Sac.toFixed(2)} MPa</strong><br>
Factor of Safety = <strong>${FoS_pitting.toFixed(2)}</strong> (Below required FoS of ${inputs.FoS_req} but > 1.0)</p>
</div>
`;
} else {
analysisHTML += `
<div class="stress-item critical">
<h5><i class="fas fa-exclamation-triangle"></i> Contact Stress: CRITICAL (FAIL)</h5>
<p>Induced: <strong>${sigma_c.toFixed(2)} MPa</strong> | Allowable: <strong>${Sac.toFixed(2)} MPa</strong><br>
Factor of Safety = <strong>${FoS_pitting.toFixed(2)}</strong> (Below 1.0 - pitting failure is likely)</p>
</div>
`;
}

stressAnalysisDiv.innerHTML = analysisHTML;
}

function performFailureAnalysis(inputs, Wt, d_p, v, FoS_bending, FoS_pitting) {
let analysisHTML = '';

// Check for tooth bending fatigue
if (FoS_bending < 1.0) {
analysisHTML += `
<div class="failure-item critical">
<h5><i class="fas fa-exclamation-triangle"></i> High Risk of Tooth Bending Failure</h5>
<p>The bending safety factor (${FoS_bending.toFixed(2)}) is below 1.0. This indicates a high probability of tooth breakage under load. Redesign is required.</p>
</div>
`;
} else if (FoS_bending < inputs.FoS_req) {
analysisHTML += `
<div class="failure-item warning">
<h5><i class="fas fa-exclamation-circle"></i> Moderate Risk of Tooth Bending Fatigue</h5>
<p>The bending safety factor (${FoS_bending.toFixed(2)}) is below the required ${inputs.FoS_req}. While not an immediate failure, reliability is compromised and fatigue life will be shorter than desired.</p>
</div>
`;
}

// Check for surface pitting
if (FoS_pitting < 1.0) {
analysisHTML += `
<div class="failure-item critical">
<h5><i class="fas fa-exclamation-triangle"></i> High Risk of Surface Pitting</h5>
<p>The contact safety factor (${FoS_pitting.toFixed(2)}) is below 1.0. Surface pitting will likely occur early in the gear's service life, leading to noise, vibration, and eventual failure.</p>
</div>
`;
} else if (FoS_pitting < inputs.FoS_req) {
analysisHTML += `
<div class="failure-item warning">
<h5><i class="fas fa-exclamation-circle"></i> Moderate Risk of Surface Pitting</h5>
<p>The contact safety factor (${FoS_pitting.toFixed(2)}) is below the required ${inputs.FoS_req}. This is the most common design constraint. Durability will be limited. Consider increasing hardness or gear size.</p>
</div>
`;
}

// Check for speed limitations
const pitch_line_velocity_limit = inputs.gearType === 'spur' ? 25 : 50; // m/s
if (v > pitch_line_velocity_limit) {
analysisHTML += `
<div class="failure-item warning">
<h5><i class="fas fa-tachometer-alt"></i> High Speed Operation</h5>
<p>The pitch line velocity (${v.toFixed(2)} m/s) is high for ${inputs.gearType} gears. The selected Dynamic Factor (K<sub>v</sub> = ${inputs.Kv}) must be appropriate for this speed, implying high-precision (AGMA Q10+) gears.</p>
</div>
`;
}

if (analysisHTML === '') {
analysisHTML = `
<div class="failure-item info">
<h5><i class="fas fa-check-circle"></i> No Critical Failure Modes Identified</h5>
<p>The gear design appears robust. Both bending (FoS = ${FoS_bending.toFixed(2)}) and contact (FoS = ${FoS_pitting.toFixed(2)}) safety factors meet or exceed the required value of ${inputs.FoS_req}.</p>
</div>
`;
}

failureAnalysisDiv.innerHTML = analysisHTML;
}


function displayMessage(message, type = "info") {
const messageBox = document.getElementById('custom-message-box');
messageBox.textContent = message;
messageBox.className = 'show';

if (type === "error") {
messageBox.style.backgroundColor = 'var(--fail-color)';
messageBox.style.color = 'white';
} else if (type === "warning") {
messageBox.style.backgroundColor = 'var(--warning-color)';
messageBox.style.color = 'white';
} else { // success
messageBox.style.backgroundColor = 'var(--success-color)';
messageBox.style.color = 'white';
}

setTimeout(() => {
messageBox.classList.remove('show');
}, 5000);
}

// Export functionality
exportReportBtn.addEventListener('click', function() {
displayMessage("Export feature would generate a detailed PDF report in a full implementation", "info");
// In a real implementation, this would use a library like jsPDF to generate a report
});
});

// --- Theme Toggle (from new file) ---
document.addEventListener('DOMContentLoaded', () => {
const themeSwitch = document.getElementById('theme-switch');
const body = document.body;
// Check local storage for theme
const currentTheme = localStorage.getItem('theme');
if (currentTheme === 'dark-mode') {
body.classList.add('dark-mode');
themeSwitch.checked = true;
}

themeSwitch.addEventListener('change', () => {
if (themeSwitch.checked) {
body.classList.add('dark-mode');
localStorage.setItem('theme', 'dark-mode');
} else {
body.classList.remove('dark-mode');
localStorage.setItem('theme', 'light-mode');
}
});
});
</script>
</body>
</html>
