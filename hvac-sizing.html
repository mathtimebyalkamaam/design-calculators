<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');      
</script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Sizing - Design Calculators - Electrical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #3b8e3e);
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #446688;
            --button-gradient: linear-gradient(45deg, #3b8e3e, #4CAF50);
            --button-hover-gradient: linear-gradient(45deg, #4CAF50, #5cb85c);
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-color), #e0e0e0);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.3s;
            width: fit-content; 
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px; /* Default margin for form groups */
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg); /* Use card-bg for input background */
            color: var(--text-color);
            box-sizing: border-box; /* Ensure padding doesn't increase width */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
            gap: 20px; /* Gap between grid items */
            margin-bottom: 0; /* Handled by form-group margin */
        }
        
        .calculate-btn {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 12px 30px; /* Increased padding for better appearance */
            border-radius: 25px; /* More rounded */
            cursor: pointer;
            font-size: 1.1em; /* Slightly larger font */
            font-weight: bold;
            margin-top: 25px; /* More space above button */
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto; /* Allow button to size based on content and padding */
            min-width: 220px; /* Ensure a minimum width for consistency */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .calculate-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02); /* Lift and slightly scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For animation */
            transform: translateY(20px); /* Initial state for animation */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners apply to table content */
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color); /* Highlight row on hover */
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--hover-color);
            border-radius: 4px;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: color 0.3s;
        }

        .info-icon:hover {
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px); /* Initial state for tooltip animation */
            font-size: 0.85em;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: flex; /* Use flex for centering text */
            align-items: center;
            justify-content: center;
            min-width: 250px; /* Ensure it's wide enough */
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* More space */
            font-size: 0.95em;
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px; /* More space */
            text-align: center;
            font-size: 1.2em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif; /* A font suitable for mathematical formulas */
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 12px 10px; /* Increased padding */
            background-color: var(--hover-color);
            border-radius: 6px; /* More rounded */
            margin: 15px 0; /* More space */
            overflow-x: auto; /* Allow horizontal scrolling for long formulas */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace; /* Monospace for steps */
            background-color: var(--hover-color);
            padding: 8px 15px; /* Increased padding */
            border-radius: 4px; /* More rounded */
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-break: break-word; /* Break long words */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px; /* Increased margin */
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
        }

        /* Style for centering the button */
        .button-wrapper {
            display: flex;
            justify-content: center; /* Center the button horizontally */
            width: 100%; /* Ensure it takes full width to center effectively */
            padding-top: 20px; /* Add more spacing above the button */
        }

        /* Animation for input fields on focus */
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4); /* Green glow, slightly more pronounced */
            outline: none;
            animation: pulse 0.8s infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4);
            }
            to {
                box-shadow: 0 0 0 8px rgba(76, 175, 80, 0.2); /* Softer pulse */
            }
        }

        /* Styles for dynamically added UPS units */
        .ups-unit {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: var(--card-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative; /* For remove button positioning */
            transition: all 0.3s ease-in-out;
            animation: fadeInScale 0.3s ease-out;
        }

        .ups-unit:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .ups-unit h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .remove-unit-btn {
            background-color: #dc3545; /* Red */
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.3s, transform 0.2s;
        }

        .remove-unit-btn:hover {
            background-color: #c82333;
            transform: scale(1.05);
        }

        .add-unit-btn {
            background-color: #007bff; /* Blue */
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: background-color 0.3s, transform 0.2s;
            display: block; /* Make it a block element to take full width of its container */
            width: fit-content; /* Adjust width to content */
            margin-left: auto; /* Center the button */
            margin-right: auto; /* Center the button */
        }

        .add-unit-btn:hover {
            background-color: #0056b3;
            transform: scale(1.02);
        }

        /* Animation for new unit addition */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .hidden {
            display: none;
        }

        /* Unit Selector Styling */
        .unit-selector {
            text-align: right;
            margin-bottom: 15px;
            color: var(--text-color);
        }
        .unit-selector label {
            font-weight: bold;
            margin-right: 10px;
        }
        .unit-selector select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .unit-selector select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.3);
            outline: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy — Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Changed back-button to be in its own container for independent centering -->
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </div>
        
        <div class="tool-container">
            <h2>HVAC Sizing Calculator for UPS/Inverter Rooms</h2>
            
            <div class="tool-description">
                <p>This calculator helps determine the required cooling capacity (HVAC size) for rooms housing Uninterruptible Power Supplies (UPS) or Inverter Drives. It considers heat gains from equipment, lighting, occupants, building fabric, and solar radiation, following industry-standard principles outlined by organizations such as <a href="https://www.ashrae.org/" target="_blank">ASHRAE (American Society of Heating, Refrigerating and Air-Conditioning Engineers)</a>, <a href="https://www.iso.org/" target="_blank">ISO (International Organization for Standardization)</a>, and <a href="https://www.cibse.org/" target="_blank">CIBSE (Chartered Institution of Building Services Engineers)</a>.</p>
            </div>
        
            <div class="calculator-form">
                <form id="hvac-sizing-form">
                    <div class="unit-selector">
                        <label for="unit-system">Select Units:</label>
                        <select id="unit-system">
                            <option value="metric">Metric (m, °C, W)</option>
                            <option value="imperial">Imperial (ft, °F, BTU/hr)</option>
                        </select>
                    </div>

                    <!-- Room Dimensions -->
                    <div class="form-section">
                        <h3>Room Dimensions</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="room-length" id="label-room-length">Room Length (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-room-length">Length of the room in meters.</span></span></label>
                                <input type="number" id="room-length" min="0.1" step="0.1" value="5" required>
                            </div>
                            <div class="form-group">
                                <label for="room-width" id="label-room-width">Room Width (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-room-width">Width of the room in meters.</span></span></label>
                                <input type="number" id="room-width" min="0.1" step="0.1" value="4" required>
                            </div>
                            <div class="form-group">
                                <label for="room-height" id="label-room-height">Room Height (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-room-height">Height of the room in meters.</span></span></label>
                                <input type="number" id="room-height" min="0.1" step="0.1" value="3" required>
                            </div>
                        </div>
                    </div>

                    <!-- UPS/Inverter Heat Dissipation -->
                    <div class="form-section">
                        <h3>UPS/Inverter Heat Dissipation</h3>
                        <p class="tool-description">
                            For multiple UPS/Inverter units, add each unit separately. If you have manufacturer's heat dissipation data for multiple units, sum them up and enter the total value if you choose "Enter Manufacturer's Data" for a single unit.
                        </p>
                        <div id="ups-units-container">
                            <!-- Default/First UPS unit -->
                            <div class="ups-unit" data-unit-id="1">
                                <h4>UPS/Inverter Unit 1 <button type="button" class="remove-unit-btn" data-unit-id="1"><i class="fas fa-times"></i> Remove</button></h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="ups-heat-input-method-1">Heat Input Method <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Choose how to input UPS/Inverter heat: calculate from parameters or enter manufacturer's data.</span></span></label>
                                        <select id="ups-heat-input-method-1" class="ups-heat-input-method">
                                            <option value="calculate">Calculate from Parameters</option>
                                            <option value="manual">Enter Manufacturer's Data</option>
                                        </select>
                                    </div>
                                </div>

                                <div id="ups-parameters-fields-1" class="ups-parameters-fields">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="ups-rated-power-kva-1" class="label-ups-rated-power-kva">Rated Power (kVA) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext tooltip-ups-rated-power-kva">The maximum rated output power of this UPS or Inverter in kVA.</span></span></label>
                                            <input type="number" id="ups-rated-power-kva-1" min="0.1" step="0.1" value="10" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="ups-load-percentage-1" class="label-ups-load-percentage">Load (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext tooltip-ups-load-percentage">The typical operational load percentage of this UPS/Inverter.</span></span></label>
                                            <input type="number" id="ups-load-percentage-1" min="0" max="100" step="1" value="80" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="ups-efficiency-at-load-1" class="label-ups-efficiency-at-load">Efficiency (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext tooltip-ups-efficiency-at-load">The efficiency of this UPS/Inverter at the specified load. This determines heat loss.</span></span></label>
                                            <input type="number" id="ups-efficiency-at-load-1" min="0.1" max="100" step="0.1" value="95" required>
                                        </div>
                                    </div>
                                </div>

                                <div id="ups-manual-heat-fields-1" class="ups-manual-heat-fields hidden">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="ups-manufacturer-heat-1" class="label-ups-manufacturer-heat">Manufacturer's Heat Load (W) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext tooltip-ups-manufacturer-heat">Direct heat dissipation value provided by the manufacturer for this unit in Watts. If you have multiple units and are entering combined data, sum them here.</span></span></label>
                                            <input type="number" id="ups-manufacturer-heat-1" min="0" step="1" value="1000" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" id="add-ups-unit-btn" class="add-unit-btn"><i class="fas fa-plus"></i> Add UPS/Inverter Unit</button>
                    </div>

                    <!-- Internal Heat Gains -->
                    <div class="form-section">
                        <h3>Internal Heat Gains</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lighting-power-density" id="label-lighting-power-density">Lighting Power Density (W/m²) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-lighting-power-density">Typical heat gain from lighting per square meter of floor area.</span></span></label>
                                <input type="number" id="lighting-power-density" min="0" step="0.1" value="10" required>
                            </div>
                            <div class="form-group">
                                <label for="num-people" id="label-num-people">Number of Occupants <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-num-people">Number of people typically present in the room. Each person generates sensible and latent heat.</span></span></label>
                                <input type="number" id="num-people" min="0" step="1" value="1" required>
                            </div>
                            <div class="form-group">
                                <label for="other-equipment-heat" id="label-other-equipment-heat">Other Equipment Heat Gain (W) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-other-equipment-heat">Total heat dissipated by other equipment (e.g., servers, monitors) in Watts.</span></span></label>
                                <input type="number" id="other-equipment-heat" min="0" step="1" value="500" required>
                            </div>
                        </div>
                    </div>

                    <!-- External Heat Gains (Fabric & Solar) -->
                    <div class="form-section">
                        <h3>External Heat Gains (Fabric & Solar)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="wall-u-value" id="label-wall-u-value">Wall U-Value (W/m²K) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-wall-u-value">Overall heat transfer coefficient for walls. Lower values mean better insulation.</span></span></label>
                                <input type="number" id="wall-u-value" min="0.01" step="0.01" value="0.5" required>
                            </div>
                            <div class="form-group">
                                <label for="roof-u-value" id="label-roof-u-value">Roof U-Value (W/m²K) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-roof-u-value">Overall heat transfer coefficient for the roof.</span></span></label>
                                <input type="number" id="roof-u-value" min="0.01" step="0.01" value="0.3" required>
                            </div>
                            <div class="form-group">
                                <label for="floor-u-value" id="label-floor-u-value">Floor U-Value (W/m²K) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-floor-u-value">Overall heat transfer coefficient for the floor.</span></span></label>
                                <input type="number" id="floor-u-value" min="0.01" step="0.01" value="0.5" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="window-area" id="label-window-area">Window Area (m²) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-window-area">Total area of windows exposed to sunlight. Set to 0 if no windows.</span></span></label>
                                <input type="number" id="window-area" min="0" step="0.1" value="0" required>
                            </div>
                            <div class="form-group">
                                <label for="window-shgc" id="label-window-shgc">Window SHGC <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-window-shgc">Solar Heat Gain Coefficient for windows (0 to 1). Lower is better for reducing solar gain.</span></span></label>
                                <input type="number" id="window-shgc" min="0" max="1" step="0.01" value="0.5" required>
                            </div>
                            <div class="form-group">
                                <label for="solar-radiation-factor" id="label-solar-radiation-factor">Peak Solar Radiation (W/m²) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-solar-radiation-factor">Peak solar radiation incident on windows. Varies by location and time of day.</span></span></label>
                                <input type="number" id="solar-radiation-factor" min="0" step="1" value="200" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="door-area" id="label-door-area">Door Area (m²) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-door-area">Total area of doors exposed to ambient conditions.</span></span></label>
                                <input type="number" id="door-area" min="0" step="0.1" value="2" required>
                            </div>
                            <div class="form-group">
                                <label for="door-u-value" id="label-door-u-value">Door U-Value (W/m²K) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-door-u-value">Overall heat transfer coefficient for doors.</span></span></label>
                                <input type="number" id="door-u-value" min="0.01" step="0.01" value="2.0" required>
                            </div>
                        </div>
                    </div>

                    <!-- Environmental Conditions & Infiltration -->
                    <div class="form-section">
                        <h3>Environmental Conditions & Infiltration</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="desired-room-temp" id="label-desired-room-temp">Desired Room Temp (°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-desired-room-temp">The target temperature to maintain inside the room.</span></span></label>
                                <input type="number" id="desired-room-temp" value="22" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="ambient-temp-hvac" id="label-ambient-temp-hvac">Ambient Temp (°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-ambient-temp-hvac">The maximum expected outdoor ambient temperature.</span></span></label>
                                <input type="number" id="ambient-temp-hvac" value="35" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="infiltration-ach" id="label-infiltration-ach">Air Changes per Hour (ACH) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-infiltration-ach">Number of times the room's air volume is replaced per hour due to infiltration/ventilation. Typical values: 0.5 (well-sealed) to 2 (less sealed).</span></span></label>
                                <input type="number" id="infiltration-ach" min="0" step="0.1" value="0.5" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ambient-rh" id="label-ambient-rh">Ambient Relative Humidity (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-ambient-rh">The relative humidity of the outdoor ambient air.</span></span></label>
                                <input type="number" id="ambient-rh" min="0" max="100" step="1" value="70" required>
                            </div>
                            <div class="form-group">
                                <label for="desired-rh" id="label-desired-rh">Desired Room Relative Humidity (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-desired-rh">The target relative humidity to maintain inside the room.</span></span></label>
                                <input type="number" id="desired-rh" min="0" max="100" step="1" value="50" required>
                            </div>
                        </div>
                    </div>

                    <!-- Safety Factor -->
                    <div class="form-section">
                        <h3>Safety Factor</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="safety-factor">Safety Factor (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">An additional percentage added to the calculated load to account for uncertainties, future growth, and peak conditions. Typical values are 10-20%.</span></span></label>
                                <input type="number" id="safety-factor" min="0" step="1" value="15" required>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-hvac-btn" class="calculate-btn">Calculate HVAC Size</button>
                        <button type="button" id="reset-form-btn" class="add-unit-btn" style="margin-left: 15px;"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>HVAC Sizing Results</h3>
                <div id="calculation-details">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                
                <p>Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Electrical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Electrical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateHvacBtn = document.getElementById('calculate-hvac-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const unitSystemSelect = document.getElementById('unit-system');

            const upsUnitsContainer = document.getElementById('ups-units-container');
            const addUpsUnitBtn = document.getElementById('add-ups-unit-btn');
            let unitCounter = 1; // To keep track of unique IDs for multiple units

            // Store default values for resetting
            const defaultValues = {
                'room-length': 5, 'room-width': 4, 'room-height': 3,
                'lighting-power-density': 10, 'num-people': 1, 'other-equipment-heat': 500,
                'wall-u-value': 0.5, 'roof-u-value': 0.3, 'floor-u-value': 0.5,
                'window-area': 0, 'window-shgc': 0.5, 'solar-radiation-factor': 200,
                'door-area': 2, 'door-u-value': 2.0,
                'desired-room-temp': 22, 'ambient-temp-hvac': 35, 'infiltration-ach': 0.5,
                'ambient-rh': 70, 'desired-rh': 50, 'safety-factor': 15
            };

            const defaultUpsUnitValues = {
                'ups-rated-power-kva': 10, 'ups-load-percentage': 80, 'ups-efficiency-at-load': 95,
                'ups-manufacturer-heat': 1000
            };

            // Conversion Factors (Metric to Imperial)
            const CONVERSION_FACTORS = {
                m_to_ft: 3.28084,
                sqm_to_sqft: 10.7639,
                cubm_to_cubft: 35.3147,
                W_to_BTUhr: 3.41214,
                Wm2K_to_BTUhr_sqft_F: 0.17611, // 1 W/m²K = 0.17611 BTU/hr·ft²·°F
                kg_to_lb: 2.20462,
                J_per_kgK_to_BTU_per_lbF: 0.000238846, // 1 J/kgK = 0.000238846 BTU/lb°F
                J_per_kg_to_BTU_per_lb: 0.000429923, // 1 J/kg = 0.000429923 BTU/lb
                TR_to_kW: 3.517,
                TR_to_BTUhr: 12000
            };

            // Labels and Tooltips for dynamic updating
            const unitSensitiveElements = {
                labels: {
                    'room-length': { metric: 'Room Length (m)', imperial: 'Room Length (ft)' },
                    'room-width': { metric: 'Room Width (m)', imperial: 'Room Width (ft)' },
                    'room-height': { metric: 'Room Height (m)', imperial: 'Room Height (ft)' },
                    'lighting-power-density': { metric: 'Lighting Power Density (W/m²)', imperial: 'Lighting Power Density (BTU/hr/ft²)' },
                    'other-equipment-heat': { metric: 'Other Equipment Heat Gain (W)', imperial: 'Other Equipment Heat Gain (BTU/hr)' },
                    'wall-u-value': { metric: 'Wall U-Value (W/m²K)', imperial: 'Wall U-Value (BTU/hr·ft²·°F)' },
                    'roof-u-value': { metric: 'Roof U-Value (W/m²K)', imperial: 'Roof U-Value (BTU/hr·ft²·°F)' },
                    'floor-u-value': { metric: 'Floor U-Value (W/m²K)', imperial: 'Floor U-Value (BTU/hr·ft²·°F)' },
                    'window-area': { metric: 'Window Area (m²)', imperial: 'Window Area (ft²)' },
                    'solar-radiation-factor': { metric: 'Peak Solar Radiation (W/m²)', imperial: 'Peak Solar Radiation (BTU/hr/ft²)' },
                    'door-area': { metric: 'Door Area (m²)', imperial: 'Door Area (ft²)' },
                    'door-u-value': { metric: 'Door U-Value (W/m²K)', imperial: 'Door U-Value (BTU/hr·ft²·°F)' },
                    'desired-room-temp': { metric: 'Desired Room Temp (°C)', imperial: 'Desired Room Temp (°F)' },
                    'ambient-temp-hvac': { metric: 'Ambient Temp (°C)', imperial: 'Ambient Temp (°F)' },
                    'ups-manufacturer-heat': { metric: 'Manufacturer\'s Heat Load (W)', imperial: 'Manufacturer\'s Heat Load (BTU/hr)' }
                },
                tooltips: {
                    'room-length': { metric: 'Length of the room in meters.', imperial: 'Length of the room in feet.' },
                    'room-width': { metric: 'Width of the room in meters.', imperial: 'Width of the room in feet.' },
                    'room-height': { metric: 'Height of the room in meters.', imperial: 'Height of the room in feet.' },
                    'lighting-power-density': { metric: 'Typical heat gain from lighting per square meter of floor area.', imperial: 'Typical heat gain from lighting per square foot of floor area.' },
                    'other-equipment-heat': { metric: 'Total heat dissipated by other equipment (e.g., servers, monitors) in Watts.', imperial: 'Total heat dissipated by other equipment (e.g., servers, monitors) in BTU/hr.' },
                    'wall-u-value': { metric: 'Overall heat transfer coefficient for walls. Lower values mean better insulation.', imperial: 'Overall heat transfer coefficient for walls. Lower values mean better insulation.' },
                    'roof-u-value': { metric: 'Overall heat transfer coefficient for the roof.', imperial: 'Overall heat transfer coefficient for the roof.' },
                    'floor-u-value': { metric: 'Overall heat transfer coefficient for the floor.', imperial: 'Overall heat transfer coefficient for the floor.' },
                    'window-area': { metric: 'Total area of windows exposed to sunlight. Set to 0 if no windows.', imperial: 'Total area of windows exposed to sunlight. Set to 0 if no windows.' },
                    'solar-radiation-factor': { metric: 'Peak solar radiation incident on windows. Varies by location and time of day.', imperial: 'Peak solar radiation incident on windows. Varies by location and time of day.' },
                    'door-area': { metric: 'Total area of doors exposed to ambient conditions.', imperial: 'Total area of doors exposed to ambient conditions.' },
                    'door-u-value': { metric: 'Overall heat transfer coefficient for doors.', imperial: 'Overall heat transfer coefficient for doors.' },
                    'desired-room-temp': { metric: 'The target temperature to maintain inside the room.', imperial: 'The target temperature to maintain inside the room.' },
                    'ambient-temp-hvac': { metric: 'The maximum expected outdoor ambient temperature.', imperial: 'The maximum expected outdoor ambient temperature.' },
                    'infiltration-ach': { metric: 'Number of times the room\'s air volume is replaced per hour due to infiltration/ventilation. Typical values: 0.5 (well-sealed) to 2 (less sealed).', imperial: 'Number of times the room\'s air volume is replaced per hour due to infiltration/ventilation. Typical values: 0.5 (well-sealed) to 2 (less sealed).' },
                    'ambient-rh': { metric: 'The relative humidity of the outdoor ambient air.', imperial: 'The relative humidity of the outdoor ambient air.' },
                    'desired-rh': { metric: 'The target relative humidity to maintain inside the room.', imperial: 'The target relative humidity to maintain inside the room.' },
                    'safety-factor': { metric: 'An additional percentage added to the calculated load to account for uncertainties, future growth, and peak conditions. Typical values are 10-20%.', imperial: 'An additional percentage added to the calculated load to account for uncertainties, future growth, and peak conditions. Typical values are 10-20%.' },
                    'ups-rated-power-kva': { metric: 'The maximum rated output power of this UPS or Inverter in kVA.', imperial: 'The maximum rated output power of this UPS or Inverter in kVA.' },
                    'ups-load-percentage': { metric: 'The typical operational load percentage of this UPS/Inverter.', imperial: 'The typical operational load percentage of this UPS/Inverter.' },
                    'ups-efficiency-at-load': { metric: 'The efficiency of this UPS/Inverter at the specified load. This determines heat loss.', imperial: 'The efficiency of this UPS/Inverter at the specified load. This determines heat loss.' },
                    'ups-manufacturer-heat': { metric: 'Direct heat dissipation value provided by the manufacturer for this unit in Watts. If you have multiple units and are entering combined data, sum them here.', imperial: 'Direct heat dissipation value provided by the manufacturer for this unit in BTU/hr. If you have multiple units and are entering combined data, sum them here.' }
                }
            };

            // Template for a new UPS unit
            const upsUnitTemplate = `
                <div class="ups-unit" data-unit-id="{UNIT_ID}">
                    <h4>UPS/Inverter Unit {UNIT_ID} <button type="button" class="remove-unit-btn" data-unit-id="{UNIT_ID}"><i class="fas fa-times"></i> Remove</button></h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ups-heat-input-method-{UNIT_ID}">Heat Input Method <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Choose how to input UPS/Inverter heat: calculate from parameters or enter manufacturer's data.</span></span></label>
                            <select id="ups-heat-input-method-{UNIT_ID}" class="ups-heat-input-method">
                                <option value="calculate">Calculate from Parameters</option>
                                <option value="manual">Enter Manufacturer's Data</option>
                            </select>
                        </div>
                    </div>

                    <div id="ups-parameters-fields-{UNIT_ID}" class="ups-parameters-fields">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ups-rated-power-kva-{UNIT_ID}" class="label-ups-rated-power-kva">Rated Power (kVA) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext tooltip-ups-rated-power-kva">The maximum rated output power of this UPS or Inverter in kVA.</span></span></label>
                                <input type="number" id="ups-rated-power-kva-{UNIT_ID}" min="0.1" step="0.1" value="10" required>
                            </div>
                            <div class="form-group">
                                <label for="ups-load-percentage-{UNIT_ID}" class="label-ups-load-percentage">Load (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext tooltip-ups-load-percentage">The typical operational load percentage of this UPS/Inverter.</span></span></label>
                                <input type="number" id="ups-load-percentage-{UNIT_ID}" min="0" max="100" step="1" value="80" required>
                            </div>
                            <div class="form-group">
                                <label for="ups-efficiency-at-load-{UNIT_ID}" class="label-ups-efficiency-at-load">Efficiency (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext tooltip-ups-efficiency-at-load">The efficiency of this UPS/Inverter at the specified load. This determines heat loss.</span></span></label>
                                <input type="number" id="ups-efficiency-at-load-{UNIT_ID}" min="0.1" max="100" step="0.1" value="95" required>
                            </div>
                        </div>
                    </div>

                    <div id="ups-manual-heat-fields-{UNIT_ID}" class="ups-manual-heat-fields hidden">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ups-manufacturer-heat-{UNIT_ID}" class="label-ups-manufacturer-heat">Manufacturer's Heat Load (W) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext tooltip-ups-manufacturer-heat">Direct heat dissipation value provided by the manufacturer for this unit in Watts. If you have multiple units and are entering combined data, sum them here.</span></span></label>
                                <input type="number" id="ups-manufacturer-heat-{UNIT_ID}" min="0" step="1" value="1000" required>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Function to add a new UPS unit
            function addUpsUnit() {
                unitCounter++;
                const newUnitHtml = upsUnitTemplate.replace(/{UNIT_ID}/g, unitCounter);
                const newUnitDiv = document.createElement('div');
                newUnitDiv.innerHTML = newUnitHtml;
                upsUnitsContainer.appendChild(newUnitDiv.firstElementChild); // Append the div itself

                // Re-attach event listeners for the new unit's elements
                const newUnitElement = upsUnitsContainer.querySelector(`[data-unit-id="${unitCounter}"]`);
                const newSelect = newUnitElement.querySelector(`.ups-heat-input-method`);
                newSelect.addEventListener('change', () => toggleUpsHeatInputFields(newUnitElement));
                
                const removeBtn = newUnitElement.querySelector(`.remove-unit-btn`);
                removeBtn.addEventListener('click', () => removeUpsUnit(newUnitElement));

                // Initialize the visibility for the new unit
                toggleUpsHeatInputFields(newUnitElement);
                updateUnitLabelsAndTooltips(unitSystemSelect.value); // Update units for new unit
            }

            // Function to remove a UPS unit
            function removeUpsUnit(unitElement) {
                if (upsUnitsContainer.children.length > 1) { // Ensure at least one unit remains
                    unitElement.remove();
                } else {
                    displayMessage("At least one UPS/Inverter unit must be present.", "warning");
                }
            }

            // Function to toggle UPS heat input fields for a specific unit
            function toggleUpsHeatInputFields(unitElement) {
                const selectElement = unitElement.querySelector('.ups-heat-input-method');
                const paramsFields = unitElement.querySelector('.ups-parameters-fields');
                const manualFields = unitElement.querySelector('.ups-manual-heat-fields');

                if (selectElement.value === 'calculate') {
                    paramsFields.classList.remove('hidden');
                    manualFields.classList.add('hidden');
                    Array.from(paramsFields.querySelectorAll('input')).forEach(input => input.disabled = false);
                    Array.from(manualFields.querySelectorAll('input')).forEach(input => input.disabled = true);
                } else {
                    paramsFields.classList.add('hidden');
                    manualFields.classList.remove('hidden');
                    Array.from(paramsFields.querySelectorAll('input')).forEach(input => input.disabled = true);
                    Array.from(manualFields.querySelectorAll('input')).forEach(input => input.disabled = false);
                }
            }

            // Function to update all labels and tooltips based on selected unit system
            function updateUnitLabelsAndTooltips(unitSystem) {
                // Update general labels and tooltips
                for (const id in unitSensitiveElements.labels) {
                    const labelElement = document.getElementById(`label-${id}`);
                    const tooltipElement = document.getElementById(`tooltip-${id}`);
                    if (labelElement) labelElement.textContent = unitSensitiveElements.labels[id][unitSystem];
                    if (tooltipElement) tooltipElement.textContent = unitSensitiveElements.tooltips[id][unitSystem];
                }

                // Update UPS unit specific labels and tooltips
                upsUnitsContainer.querySelectorAll('.ups-unit').forEach(unitElement => {
                    const unitId = unitElement.dataset.unitId;
                    for (const key of ['ups-rated-power-kva', 'ups-load-percentage', 'ups-efficiency-at-load', 'ups-manufacturer-heat']) {
                        const labelElement = unitElement.querySelector(`.label-${key}`);
                        const tooltipElement = unitElement.querySelector(`.tooltip-${key}`);
                        if (labelElement && unitSensitiveElements.labels[key]) {
                             labelElement.innerHTML = unitSensitiveElements.labels[key][unitSystem] + ` <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">${unitSensitiveElements.tooltips[key][unitSystem]}</span></span>`;
                        }
                    }
                });

                // Update input step and values if changing units
                const currentUnit = unitSystemSelect.value;
                const inputsToConvert = [
                    { id: 'room-length', factor: CONVERSION_FACTORS.m_to_ft, defaultMetric: defaultValues['room-length'] },
                    { id: 'room-width', factor: CONVERSION_FACTORS.m_to_ft, defaultMetric: defaultValues['room-width'] },
                    { id: 'room-height', factor: CONVERSION_FACTORS.m_to_ft, defaultMetric: defaultValues['room-height'] },
                    { id: 'lighting-power-density', factor: CONVERSION_FACTORS.W_to_BTUhr / CONVERSION_FACTORS.sqm_to_sqft, defaultMetric: defaultValues['lighting-power-density'] },
                    { id: 'other-equipment-heat', factor: CONVERSION_FACTORS.W_to_BTUhr, defaultMetric: defaultValues['other-equipment-heat'] },
                    { id: 'wall-u-value', factor: CONVERSION_FACTORS.Wm2K_to_BTUhr_sqft_F, defaultMetric: defaultValues['wall-u-value'] },
                    { id: 'roof-u-value', factor: CONVERSION_FACTORS.Wm2K_to_BTUhr_sqft_F, defaultMetric: defaultValues['roof-u-value'] },
                    { id: 'floor-u-value', factor: CONVERSION_FACTORS.Wm2K_to_BTUhr_sqft_F, defaultMetric: defaultValues['floor-u-value'] },
                    { id: 'window-area', factor: CONVERSION_FACTORS.sqm_to_sqft, defaultMetric: defaultValues['window-area'] },
                    { id: 'solar-radiation-factor', factor: CONVERSION_FACTORS.W_to_BTUhr / CONVERSION_FACTORS.sqm_to_sqft, defaultMetric: defaultValues['solar-radiation-factor'] },
                    { id: 'door-area', factor: CONVERSION_FACTORS.sqm_to_sqft, defaultMetric: defaultValues['door-area'] },
                    { id: 'door-u-value', factor: CONVERSION_FACTORS.Wm2K_to_BTUhr_sqft_F, defaultMetric: defaultValues['door-u-value'] },
                    { id: 'desired-room-temp', convertTemp: true, defaultMetric: defaultValues['desired-room-temp'] },
                    { id: 'ambient-temp-hvac', convertTemp: true, defaultMetric: defaultValues['ambient-temp-hvac'] },
                ];

                inputsToConvert.forEach(item => {
                    const inputElement = document.getElementById(item.id);
                    if (inputElement) {
                        let currentValue = parseFloat(inputElement.value);
                        let newValue;

                        if (unitSystem === 'imperial') {
                            if (item.convertTemp) {
                                newValue = (currentValue * 9/5) + 32; // C to F
                            } else {
                                newValue = currentValue * item.factor;
                            }
                            inputElement.step = item.id.includes('temp') ? '0.1' : (item.id.includes('area') ? '1' : '0.01'); // Adjust step for imperial
                        } else { // metric
                            if (item.convertTemp) {
                                newValue = (currentValue - 32) * 5/9; // F to C
                            } else {
                                newValue = currentValue / item.factor;
                            }
                            inputElement.step = item.id.includes('temp') ? '0.1' : (item.id.includes('area') ? '0.1' : '0.01'); // Adjust step for metric
                        }
                        inputElement.value = newValue.toFixed(item.id.includes('temp') ? 1 : 2); // Keep consistent decimal places
                    }
                });

                // Handle UPS manufacturer heat input separately as it's dynamic
                upsUnitsContainer.querySelectorAll('.ups-unit').forEach(unitElement => {
                    const unitId = unitElement.dataset.unitId;
                    const manualHeatInput = unitElement.querySelector(`#ups-manufacturer-heat-${unitId}`);
                    if (manualHeatInput && manualHeatInput.disabled === false) { // Only convert if visible and enabled
                        let currentValue = parseFloat(manualHeatInput.value);
                        let newValue;
                        if (unitSystem === 'imperial') {
                            newValue = currentValue * CONVERSION_FACTORS.W_to_BTUhr;
                        } else {
                            newValue = currentValue / CONVERSION_FACTORS.W_to_BTUhr;
                        }
                        manualHeatInput.value = newValue.toFixed(0); // Heat load usually integer
                    }
                });
            }

            // Initial setup for the first UPS unit
            const initialUnit = upsUnitsContainer.querySelector('[data-unit-id="1"]');
            const initialSelect = initialUnit.querySelector('.ups-heat-input-method');
            initialSelect.addEventListener('change', () => toggleUpsHeatInputFields(initialUnit));
            const initialRemoveBtn = initialUnit.querySelector('.remove-unit-btn');
            initialRemoveBtn.addEventListener('click', () => removeUpsUnit(initialUnit));
            toggleUpsHeatInputFields(initialUnit); // Set initial state

            addUpsUnitBtn.addEventListener('click', addUpsUnit);
            calculateHvacBtn.addEventListener('click', calculateHVAC);
            resetFormBtn.addEventListener('click', resetForm);
            unitSystemSelect.addEventListener('change', (event) => updateUnitLabelsAndTooltips(event.target.value));


            function resetForm() {
                // Reset standard inputs
                for (const id in defaultValues) {
                    const input = document.getElementById(id);
                    if (input) {
                        input.value = defaultValues[id];
                    }
                }

                // Remove all but the first UPS unit
                const existingUpsUnits = upsUnitsContainer.querySelectorAll('.ups-unit');
                for (let i = 1; i < existingUpsUnits.length; i++) {
                    existingUpsUnits[i].remove();
                }
                // Reset the first UPS unit's values and method
                const firstUnit = upsUnitsContainer.querySelector('[data-unit-id="1"]');
                firstUnit.querySelector('.ups-heat-input-method').value = 'calculate';
                firstUnit.querySelector(`#ups-rated-power-kva-1`).value = defaultUpsUnitValues['ups-rated-power-kva'];
                firstUnit.querySelector(`#ups-load-percentage-1`).value = defaultUpsUnitValues['ups-load-percentage'];
                firstUnit.querySelector(`#ups-efficiency-at-load-1`).value = defaultUpsUnitValues['ups-efficiency-at-load'];
                firstUnit.querySelector(`#ups-manufacturer-heat-1`).value = defaultUpsUnitValues['ups-manufacturer-heat'];
                toggleUpsHeatInputFields(firstUnit); // Ensure fields are correctly shown/hidden

                unitCounter = 1; // Reset unit counter

                // Reset unit system to Metric
                unitSystemSelect.value = 'metric';
                updateUnitLabelsAndTooltips('metric'); // Apply metric units

                // Clear results
                resultContainer.classList.remove('show');
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                standardReference.innerHTML = '';

                displayMessage("Form reset to default values.", "info");
            }


            // Function to calculate saturation vapor pressure (kPa) using Antoine equation approximation for water
            function calculateSaturationVaporPressure(tempC) {
                // Simplified Antoine equation coefficients for water (valid approx 0-100 C)
                // log10(P_kPa) = A - B / (C + T_C)
                // A = 5.204, B = 1733.926, C = 233.426 (for P in mmHg, T in C)
                // Convert to kPa: 1 mmHg = 0.133322 kPa
                // Or use a direct formula for kPa:
                return 0.6108 * Math.exp((17.27 * tempC) / (tempC + 237.3));
            }

            // Function to calculate humidity ratio (kg water / kg dry air)
            function calculateHumidityRatio(tempC, relativeHumidityPercent, atmosphericPressurekPa = 101.325) {
                const Pws = calculateSaturationVaporPressure(tempC); // Saturation vapor pressure in kPa
                const Pw = (relativeHumidityPercent / 100) * Pws; // Partial pressure of water vapor in kPa
                
                // Humidity Ratio (W) = 0.622 * Pw / (Patm - Pw)
                // 0.622 is the ratio of molecular weight of water to dry air (18.015 / 28.964)
                if (atmosphericPressurekPa <= Pw) {
                    // This condition means air is saturated or super-saturated, or input is invalid
                    return 0.0; // Or handle as an error
                }
                return 0.622 * Pw / (atmosphericPressurekPa - Pw);
            }


            function calculateHVAC() {
                const currentUnitSystem = unitSystemSelect.value;

                // 1. Get all inputs and convert to Metric for calculation
                let roomLength = parseFloat(document.getElementById('room-length').value);
                let roomWidth = parseFloat(document.getElementById('room-width').value);
                let roomHeight = parseFloat(document.getElementById('room-height').value);

                let lightingPowerDensity = parseFloat(document.getElementById('lighting-power-density').value);
                const numPeople = parseInt(document.getElementById('num-people').value);
                let otherEquipmentHeat = parseFloat(document.getElementById('other-equipment-heat').value);

                let wallUValue = parseFloat(document.getElementById('wall-u-value').value);
                let roofUValue = parseFloat(document.getElementById('roof-u-value').value);
                let floorUValue = parseFloat(document.getElementById('floor-u-value').value);
                let windowArea = parseFloat(document.getElementById('window-area').value);
                const windowSHGC = parseFloat(document.getElementById('window-shgc').value);
                let solarRadiationFactor = parseFloat(document.getElementById('solar-radiation-factor').value);
                let doorArea = parseFloat(document.getElementById('door-area').value);
                let doorUValue = parseFloat(document.getElementById('door-u-value').value);

                let desiredRoomTemp = parseFloat(document.getElementById('desired-room-temp').value);
                let ambientTempHVAC = parseFloat(document.getElementById('ambient-temp-hvac').value);
                const infiltrationACH = parseFloat(document.getElementById('infiltration-ach').value);
                const ambientRH = parseFloat(document.getElementById('ambient-rh').value);
                const desiredRH = parseFloat(document.getElementById('desired-rh').value);
                const safetyFactor = parseFloat(document.getElementById('safety-factor').value);

                // Convert inputs from Imperial to Metric if necessary
                if (currentUnitSystem === 'imperial') {
                    roomLength /= CONVERSION_FACTORS.m_to_ft;
                    roomWidth /= CONVERSION_FACTORS.m_to_ft;
                    roomHeight /= CONVERSION_FACTORS.m_to_ft;
                    lightingPowerDensity /= (CONVERSION_FACTORS.W_to_BTUhr / CONVERSION_FACTORS.sqm_to_sqft); // BTU/hr/ft2 to W/m2
                    otherEquipmentHeat /= CONVERSION_FACTORS.W_to_BTUhr; // BTU/hr to W
                    wallUValue /= CONVERSION_FACTORS.Wm2K_to_BTUhr_sqft_F; // BTU/hr·ft²·°F to W/m²K
                    roofUValue /= CONVERSION_FACTORS.Wm2K_to_BTUhr_sqft_F;
                    floorUValue /= CONVERSION_FACTORS.Wm2K_to_BTUhr_sqft_F;
                    windowArea /= CONVERSION_FACTORS.sqm_to_sqft;
                    solarRadiationFactor /= (CONVERSION_FACTORS.W_to_BTUhr / CONVERSION_FACTORS.sqm_to_sqft); // BTU/hr/ft2 to W/m2
                    doorArea /= CONVERSION_FACTORS.sqm_to_sqft;
                    doorUValue /= CONVERSION_FACTORS.Wm2K_to_BTUhr_sqft_F;
                    desiredRoomTemp = (desiredRoomTemp - 32) * 5/9; // F to C
                    ambientTempHVAC = (ambientTempHVAC - 32) * 5/9; // F to C
                }

                // Input Validation for other fields
                if (isNaN(roomLength) || isNaN(roomWidth) || isNaN(roomHeight) || roomLength <= 0 || roomWidth <= 0 || roomHeight <= 0) {
                    displayMessage("Please enter valid positive room dimensions.", "error");
                    return;
                }
                if (isNaN(lightingPowerDensity) || lightingPowerDensity < 0 || isNaN(numPeople) || numPeople < 0 || isNaN(otherEquipmentHeat) || otherEquipmentHeat < 0) {
                    displayMessage("Please enter valid positive numbers for internal heat gains (Lighting, People, Other Equipment).", "error");
                    return;
                }
                if (isNaN(wallUValue) || wallUValue < 0 || isNaN(roofUValue) || roofUValue < 0 || isNaN(floorUValue) || floorUValue < 0 || isNaN(windowArea) || windowArea < 0 || isNaN(windowSHGC) || windowSHGC < 0 || windowSHGC > 1 || isNaN(solarRadiationFactor) || solarRadiationFactor < 0 || isNaN(doorArea) || doorArea < 0 || isNaN(doorUValue) || doorUValue < 0) {
                    displayMessage("Please enter valid positive numbers for external heat gains (U-Values, Areas, SHGC, Solar Factor).", "error");
                    return;
                }
                if (isNaN(desiredRoomTemp) || isNaN(ambientTempHVAC) || isNaN(infiltrationACH) || infiltrationACH < 0 || isNaN(ambientRH) || ambientRH < 0 || ambientRH > 100 || isNaN(desiredRH) || desiredRH < 0 || desiredRH > 100 || isNaN(safetyFactor) || safetyFactor < 0) {
                    displayMessage("Please enter valid numbers for environmental conditions (temperatures, ACH, RH) and safety factor (>= 0).", "error");
                    return;
                }

                // Initialize total UPS heat sensible
                let total_Q_ups_sensible = 0;
                let upsCalculationDetails = '';
                let upsUnitCount = 0;

                const upsUnits = upsUnitsContainer.querySelectorAll('.ups-unit');
                if (upsUnits.length === 0) {
                    displayMessage("Please add at least one UPS/Inverter unit.", "error");
                    return;
                }

                for (let i = 0; i < upsUnits.length; i++) {
                    const unitElement = upsUnits[i];
                    upsUnitCount++;
                    const unitId = unitElement.dataset.unitId;
                    const upsHeatMethod = unitElement.querySelector(`.ups-heat-input-method`).value;
                    let currentUnitHeat = 0;

                    if (upsHeatMethod === 'calculate') {
                        const upsRatedPowerKVA = parseFloat(unitElement.querySelector(`#ups-rated-power-kva-${unitId}`).value);
                        const upsLoadPercentage = parseFloat(unitElement.querySelector(`#ups-load-percentage-${unitId}`).value);
                        const upsEfficiencyAtLoad = parseFloat(unitElement.querySelector(`#ups-efficiency-at-load-${unitId}`).value);

                        if (isNaN(upsRatedPowerKVA) || isNaN(upsLoadPercentage) || isNaN(upsEfficiencyAtLoad) || upsRatedPowerKVA < 0 || upsLoadPercentage < 0 || upsLoadPercentage > 100 || upsEfficiencyAtLoad <= 0 || upsEfficiencyAtLoad > 100) {
                            displayMessage(`Please enter valid parameters for UPS/Inverter Unit ${upsUnitCount}. (Power > 0, Load 0-100%, Efficiency > 0-100%)`, "error");
                            return; // Stop calculation if validation fails for any unit
                        }
                        const upsOutputKW = upsRatedPowerKVA * (upsLoadPercentage / 100) * 0.8; // Assuming 0.8 power factor for the load
                        currentUnitHeat = upsOutputKW * 1000 * (100 / upsEfficiencyAtLoad - 1);
                        upsCalculationDetails += `<p class="calculation-step"><strong>Unit ${upsUnitCount} (Calculated):</strong> UPS Output kW (at load) = ${upsRatedPowerKVA.toFixed(2)} kVA x (${upsLoadPercentage}/100) x 0.8 = ${upsOutputKW.toFixed(2)} kW</p>`;
                        upsCalculationDetails += `<p class="calculation-step">Q<sub>UPS Unit ${upsUnitCount}</sub> = ${upsOutputKW.toFixed(2)} kW x 1000 W/kW x (100 / ${upsEfficiencyAtLoad} - 1) = ${currentUnitHeat.toFixed(2)} W</p>`;
                    } else { // manual
                        let upsManufacturerHeat = parseFloat(unitElement.querySelector(`#ups-manufacturer-heat-${unitId}`).value);
                        if (isNaN(upsManufacturerHeat) || upsManufacturerHeat < 0) {
                            displayMessage(`Please enter a valid non-negative value for Manufacturer's Heat Load for UPS/Inverter Unit ${upsUnitCount}.`, "error");
                            return; // Stop calculation if validation fails for any unit
                        }
                        if (currentUnitSystem === 'imperial') {
                            upsManufacturerHeat /= CONVERSION_FACTORS.W_to_BTUhr; // BTU/hr to W
                        }
                        currentUnitHeat = upsManufacturerHeat;
                        upsCalculationDetails += `<p class="calculation-step"><strong>Unit ${upsUnitCount} (Manufacturer Data):</strong> Q<sub>UPS Unit ${upsUnitCount}</sub> = ${currentUnitHeat.toFixed(2)} W</p>`;
                    }
                    total_Q_ups_sensible += currentUnitHeat;
                }

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                let standardRefText = '';
                resultTableBody.innerHTML = ''; // Clear previous results
                resultContainer.classList.remove('show'); // Hide previous results for animation

                // Helper function to add rows to the result table
                function addResultRow(parameter, value) {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.innerHTML = parameter;
                    valueCell.innerHTML = value;
                }

                // Constants (already in Metric for calculation)
                const sensibleHeatPerPerson = 75; // W/person (ASHRAE typical for sedentary)
                const latentHeatPerPerson = 55; // W/person (ASHRAE typical for sedentary)
                const airDensity = 1.2; // kg/m³ at standard conditions (approx. 20°C, 1 atm)
                const specificHeatOfAir = 1006; // J/kgK (approx. for dry air)
                const latentHeatOfVaporization = 2450 * 1000; // J/kg (approx. at 25°C, 2450 kJ/kg)

                // 2. Room Geometry Calculations
                const roomVolume = roomLength * roomWidth * roomHeight;
                const roomFloorArea = roomLength * roomWidth;
                const roomWallArea = 2 * (roomLength + roomWidth) * roomHeight;
                const roomRoofArea = roomLength * roomWidth;

                calculationHtml += `<p><strong>1. Room Geometry:</strong></p>`;
                calculationHtml += `<p class="formula">Volume = L &times; W &times; H</p>`;
                calculationHtml += `<p class="formula">Floor Area = L &times; W</p>`;
                calculationHtml += `<p class="formula">Wall Area = 2 &times; (L + W) &times; H</p>`;
                calculationHtml += `<p class="formula">Roof Area = L &times; W</p>`;
                calculationHtml += `<p class="calculation-step">Volume = ${roomLength.toFixed(2)} m x ${roomWidth.toFixed(2)} m x ${roomHeight.toFixed(2)} m = ${roomVolume.toFixed(2)} m<sup>3</sup></p>`;
                calculationHtml += `<p class="calculation-step">Floor Area = ${roomLength.toFixed(2)} m x ${roomWidth.toFixed(2)} m = ${roomFloorArea.toFixed(2)} m<sup>2</sup></p>`;
                calculationHtml += `<p class="calculation-step">Wall Area = 2 x (${roomLength.toFixed(2)} m + ${roomWidth.toFixed(2)} m) x ${roomHeight.toFixed(2)} m = ${roomWallArea.toFixed(2)} m<sup>2</sup></p>`;
                calculationHtml += `<p class="calculation-step">Roof Area = ${roomLength.toFixed(2)} m x ${roomWidth.toFixed(2)} m = ${roomRoofArea.toFixed(2)} m<sup>2</sup></p>`;


                // 3. UPS/Inverter Heat Dissipation (Sensible)
                calculationHtml += `<p><strong>2. UPS/Inverter Heat Dissipation (Sensible):</strong></p>`;
                calculationHtml += upsCalculationDetails; // Add the accumulated details from the loop
                calculationHtml += `<p class="calculation-step"><strong>Total UPS/Inverter Heat Dissipation = ${total_Q_ups_sensible.toFixed(2)} W</strong></p>`;


                // 4. Lighting Heat Gain (Sensible)
                const Q_lights_sensible = roomFloorArea * lightingPowerDensity;
                calculationHtml += `<p><strong>3. Lighting Heat Gain (Sensible):</strong></p>`;
                calculationHtml += `<p class="formula">Q<sub>Lights</sub> = Floor Area &times; Lighting Power Density</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Lights</sub> = ${roomFloorArea.toFixed(2)} m<sup>2</sup> x ${lightingPowerDensity.toFixed(2)} W/m<sup>2</sup> = ${Q_lights_sensible.toFixed(2)} W</p>`;

                // 5. Occupancy Heat Gain (Sensible & Latent)
                const Q_people_sensible = numPeople * sensibleHeatPerPerson;
                const Q_people_latent = numPeople * latentHeatPerPerson;
                calculationHtml += `<p><strong>4. Occupancy Heat Gain (Sensible & Latent):</strong></p>`;
                calculationHtml += `<p>Heat generated by human occupants, consisting of both sensible (temperature-raising) and latent (humidity-raising) components.</p>`;
                calculationHtml += `<p class="formula">Q<sub>People, Sensible</sub> = Number of People &times; Sensible Heat per Person</p>`;
                calculationHtml += `<p class="formula">Q<sub>People, Latent</sub> = Number of People &times; Latent Heat per Person</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>People, Sensible</sub> = ${numPeople} x ${sensibleHeatPerPerson} W/person = ${Q_people_sensible.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>People, Latent</sub> = ${numPeople} x ${latentHeatPerPerson} W/person = ${Q_people_latent.toFixed(2)} W</p>`;

                // 6. Other Equipment Heat Gain (Sensible)
                const Q_other_equipment_sensible = otherEquipmentHeat;
                calculationHtml += `<p><strong>5. Other Equipment Heat Gain (Sensible):</strong></p>`;
                calculationHtml += `<p>Heat dissipated by any other electrical equipment in the room.</p>`;
                calculationHtml += `<p class="formula">Q<sub>Other Equipment</sub> = Direct Input (W)</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Other Equipment</sub> = ${Q_other_equipment_sensible.toFixed(2)} W</p>`;

                // 7. Fabric Heat Gain (Sensible)
                const deltaT = ambientTempHVAC - desiredRoomTemp;
                const Q_walls_sensible = wallUValue * roomWallArea * deltaT;
                const Q_roof_sensible = roofUValue * roomRoofArea * deltaT;
                const Q_floor_sensible = floorUValue * roomFloorArea * deltaT;
                const Q_doors_sensible = doorUValue * doorArea * deltaT;
                const Q_fabric_sensible = Q_walls_sensible + Q_roof_sensible + Q_floor_sensible + Q_doors_sensible;

                calculationHtml += `<p><strong>6. Fabric Heat Gain (Sensible):</strong></p>`;
                calculationHtml += `<p>Heat transfer through walls, roof, floor, and doors due to temperature difference between ambient and desired room temperature.</p>`;
                calculationHtml += `<p class="formula">Q<sub>Fabric</sub> = U &times; A &times; (T<sub>Ambient</sub> - T<sub>Room</sub>)</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Walls</sub> = ${wallUValue.toFixed(2)} W/m²K x ${roomWallArea.toFixed(2)} m² x (${ambientTempHVAC.toFixed(1)} - ${desiredRoomTemp.toFixed(1)}) °C = ${Q_walls_sensible.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Roof</sub> = ${roofUValue.toFixed(2)} W/m²K x ${roomRoofArea.toFixed(2)} m² x (${ambientTempHVAC.toFixed(1)} - ${desiredRoomTemp.toFixed(1)}) °C = ${Q_roof_sensible.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Floor</sub> = ${floorUValue.toFixed(2)} W/m²K x ${roomFloorArea.toFixed(2)} m² x (${ambientTempHVAC.toFixed(1)} - ${desiredRoomTemp.toFixed(1)}) °C = ${Q_floor_sensible.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Doors</sub> = ${doorUValue.toFixed(2)} W/m²K x ${doorArea.toFixed(2)} m² x (${ambientTempHVAC.toFixed(1)} - ${desiredRoomTemp.toFixed(1)}) °C = ${Q_doors_sensible.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Total Q<sub>Fabric</sub> = ${Q_fabric_sensible.toFixed(2)} W</p>`;

                // 8. Solar Heat Gain (Sensible)
                const Q_solar_sensible = windowArea * windowSHGC * solarRadiationFactor;
                calculationHtml += `<p><strong>7. Solar Heat Gain (Sensible):</strong></p>`;
                calculationHtml += `<p>Heat gain through windows due to direct solar radiation.</p>`;
                calculationHtml += `<p class="formula">Q<sub>Solar</sub> = Window Area &times; SHGC &times; Solar Radiation Factor</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Solar</sub> = ${windowArea.toFixed(2)} m² x ${windowSHGC} x ${solarRadiationFactor.toFixed(2)} W/m² = ${Q_solar_sensible.toFixed(2)} W</p>`;

                // 9. Infiltration Heat Gain (Sensible & Latent)
                const airFlowRate_m3_per_s = (roomVolume * infiltrationACH) / 3600; // m³/s
                const airMassFlowRate_kg_per_s = airFlowRate_m3_per_s * airDensity; // kg/s

                const W_ambient = calculateHumidityRatio(ambientTempHVAC, ambientRH);
                const W_desired = calculateHumidityRatio(desiredRoomTemp, desiredRH);

                const Q_infiltration_sensible = airMassFlowRate_kg_per_s * specificHeatOfAir * (ambientTempHVAC - desiredRoomTemp);
                const Q_infiltration_latent = airMassFlowRate_kg_per_s * (W_ambient - W_desired) * latentHeatOfVaporization;

                calculationHtml += `<p><strong>8. Infiltration Heat Gain (Sensible & Latent):</strong></p>`;
                calculationHtml += `<p>Heat gain due to unconditioned outside air leaking into the room, including both sensible (temperature) and latent (moisture) components.</p>`;
                calculationHtml += `<p class="formula">Q<sub>Infiltration, Sensible</sub> = Mass Flow Rate<sub>air</sub> &times; c<sub>p,air</sub> &times; (T<sub>Ambient</sub> - T<sub>Room</sub>)</p>`;
                calculationHtml += `<p class="formula">Q<sub>Infiltration, Latent</sub> = Mass Flow Rate<sub>air</sub> &times; (W<sub>Ambient</sub> - W<sub>Room</sub>) &times; h<sub>fg</sub></p>`;
                calculationHtml += `<p class="calculation-step">Air Flow Rate (volume) = (${roomVolume.toFixed(2)} m<sup>3</sup> x ${infiltrationACH} ACH) / 3600 s/hr = ${airFlowRate_m3_per_s.toFixed(4)} m<sup>3</sup>/s</p>`;
                calculationHtml += `<p class="calculation-step">Air Mass Flow Rate = ${airFlowRate_m3_per_s.toFixed(4)} kg/s</p>`;
                calculationHtml += `<p class="calculation-step">Humidity Ratio (Ambient) = ${W_ambient.toFixed(5)} kg<sub>water</sub>/kg<sub>dry air</sub></p>`;
                calculationHtml += `<p class="calculation-step">Humidity Ratio (Desired) = ${W_desired.toFixed(5)} kg<sub>water</sub>/kg<sub>dry air</sub></p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Infiltration, Sensible</sub> = ${airMassFlowRate_kg_per_s.toFixed(4)} kg/s x ${specificHeatOfAir} J/kgK x (${ambientTempHVAC.toFixed(1)} - ${desiredRoomTemp.toFixed(1)}) °C = ${Q_infiltration_sensible.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>Infiltration, Latent</sub> = ${airMassFlowRate_kg_per_s.toFixed(4)} kg/s x (${W_ambient.toFixed(5)} - ${W_desired.toFixed(5)}) x ${latentHeatOfVaporization.toFixed(0)} J/kg = ${Q_infiltration_latent.toFixed(2)} W</p>`;


                // 10. Total Heat Loads
                let totalSensibleLoad = total_Q_ups_sensible + Q_lights_sensible + Q_people_sensible + Q_other_equipment_sensible + Q_fabric_sensible + Q_solar_sensible + Q_infiltration_sensible;
                let totalLatentLoad = Q_people_latent + Q_infiltration_latent;
                let totalCoolingLoadWatts = totalSensibleLoad + totalLatentLoad;
                
                // Calculate Sensible Heat Ratio (SHR)
                const sensibleHeatRatio = totalCoolingLoadWatts > 0 ? (totalSensibleLoad / totalCoolingLoadWatts) : 0;

                // Apply Safety Factor
                const rawTotalSensibleLoad = totalSensibleLoad;
                const rawTotalCoolingLoadWatts = totalCoolingLoadWatts;

                totalSensibleLoad *= (1 + safetyFactor / 100);
                totalCoolingLoadWatts *= (1 + safetyFactor / 100);

                let totalCoolingLoadKW = totalCoolingLoadWatts / 1000;
                let totalCoolingLoadBTUhr = totalCoolingLoadWatts * CONVERSION_FACTORS.W_to_BTUhr; // Convert to BTU/hr
                let totalCoolingLoadTR = totalCoolingLoadBTUhr / CONVERSION_FACTORS.TR_to_BTUhr; // Convert to Tons of Refrigeration

                calculationHtml += `<p><strong>9. Total Cooling Load (Before Safety Factor):</strong></p>`;
                calculationHtml += `<p class="formula">Total Sensible Load = &sum; Q<sub>Sensible</sub></p>`;
                calculationHtml += `<p class="formula">Total Latent Load = &sum; Q<sub>Latent</sub></p>`;
                calculationHtml += `<p class="formula">Total Cooling Load = Total Sensible Load + Total Latent Load</p>`;
                calculationHtml += `<p class="calculation-step">Total Sensible Load (Raw) = ${rawTotalSensibleLoad.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Total Latent Load = ${totalLatentLoad.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Total Cooling Load (Raw) = ${rawTotalCoolingLoadWatts.toFixed(2)} W</p>`;

                calculationHtml += `<p><strong>10. Applying Safety Factor:</strong></p>`;
                calculationHtml += `<p>A safety factor is applied to the calculated load to account for uncertainties, future growth, and peak conditions. This is a critical step in professional HVAC design.</p>`;
                calculationHtml += `<p class="formula">Final Load = Raw Load &times; (1 + Safety Factor / 100)</p>`;
                calculationHtml += `<p class="calculation-step">Final Total Sensible Load = ${totalSensibleLoad.toFixed(2)} W</p>`;
                calculationHtml += `<p class="calculation-step">Final Total Cooling Load = ${totalCoolingLoadWatts.toFixed(2)} W</p>`;
                
                // Display Results
                calculationDetailsDiv.innerHTML = calculationHtml;

                resultTableBody.innerHTML = '';
                addResultRow("Room Volume", `${currentUnitSystem === 'metric' ? roomVolume.toFixed(2) + ' m³' : (roomVolume * CONVERSION_FACTORS.cubm_to_cubft).toFixed(2) + ' ft³'}`);
                addResultRow("Total UPS/Inverter Heat Dissipation", `${currentUnitSystem === 'metric' ? total_Q_ups_sensible.toFixed(2) + ' W' : (total_Q_ups_sensible * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("Lighting Heat Gain", `${currentUnitSystem === 'metric' ? Q_lights_sensible.toFixed(2) + ' W' : (Q_lights_sensible * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("Occupancy Sensible Heat", `${currentUnitSystem === 'metric' ? Q_people_sensible.toFixed(2) + ' W' : (Q_people_sensible * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("Occupancy Latent Heat", `${currentUnitSystem === 'metric' ? Q_people_latent.toFixed(2) + ' W' : (Q_people_latent * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("Other Equipment Heat", `${currentUnitSystem === 'metric' ? Q_other_equipment_sensible.toFixed(2) + ' W' : (Q_other_equipment_sensible * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("Fabric Heat Gain", `${currentUnitSystem === 'metric' ? Q_fabric_sensible.toFixed(2) + ' W' : (Q_fabric_sensible * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("Solar Heat Gain", `${currentUnitSystem === 'metric' ? Q_solar_sensible.toFixed(2) + ' W' : (Q_solar_sensible * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("Infiltration Sensible Heat", `${currentUnitSystem === 'metric' ? Q_infiltration_sensible.toFixed(2) + ' W' : (Q_infiltration_sensible * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("Infiltration Latent Heat", `${currentUnitSystem === 'metric' ? Q_infiltration_latent.toFixed(2) + ' W' : (Q_infiltration_latent * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}`);
                addResultRow("<strong>Total Sensible Load (with Safety Factor)</strong>", `<strong>${currentUnitSystem === 'metric' ? totalSensibleLoad.toFixed(2) + ' W' : (totalSensibleLoad * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}</strong>`);
                addResultRow("<strong>Total Latent Load</strong>", `<strong>${currentUnitSystem === 'metric' ? totalLatentLoad.toFixed(2) + ' W' : (totalLatentLoad * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}</strong>`);
                addResultRow("<strong>Total Cooling Load (with Safety Factor)</strong>", `<strong>${currentUnitSystem === 'metric' ? totalCoolingLoadWatts.toFixed(2) + ' W' : (totalCoolingLoadWatts * CONVERSION_FACTORS.W_to_BTUhr).toFixed(2) + ' BTU/hr'}</strong>`);
                addResultRow("<strong>Required Cooling Capacity</strong>", `<strong>${currentUnitSystem === 'metric' ? totalCoolingLoadKW.toFixed(2) + ' kW' : (totalCoolingLoadKW * CONVERSION_FACTORS.TR_to_kW * CONVERSION_FACTORS.W_to_BTUhr / 1000).toFixed(2) + ' kW'}</strong>`); // Ensure kW is always kW, TR is TR
                addResultRow("<strong>Required Cooling Capacity</strong>", `<strong>${totalCoolingLoadBTUhr.toFixed(2)} BTU/hr</strong>`);
                addResultRow("<strong>Required Cooling Capacity (Tons of Refrigeration)</strong>", `<strong>${totalCoolingLoadTR.toFixed(2)} TR</strong>`);
                addResultRow("<strong>Sensible Heat Ratio (SHR)</strong>", `<strong>${sensibleHeatRatio.toFixed(3)}</strong>`); // SHR is dimensionless

                standardRefText = "HVAC sizing calculations for critical environments like UPS/Inverter rooms are based on fundamental principles of thermodynamics and heat transfer, as outlined by international standards and guidelines from organizations such as <a href=\"https://www.ashrae.org/\" target=\"_blank\">ASHRAE (American Society of Heating, Refrigerating and Air-Conditioning Engineers)</a>, <a href=\"https://www.iso.org/\" target=\"_blank\">ISO (International Organization for Standardization)</a>, and <a href=\"https://www.cibse.org/\" target=\"_blank\">CIBSE (Chartered Institution of Building Services Engineers)</a>. These standards provide methodologies for calculating heat gains from various sources and determining the required cooling capacity. This tool provides an estimate; always refer to the complete official standards and consult with a qualified HVAC engineer for final design and safety verification.";
                standardReference.innerHTML = standardRefText;

                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    resultContainer.scrollIntoView({ behavior: 'smooth' });
                }, 10);
            }

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    messageBox.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        padding: 15px 25px;
                        border-radius: 8px;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                        z-index: 1000;
                        font-weight: bold;
                        color: white;
                        opacity: 0;
                        transition: opacity 0.5s ease-in-out, transform 0.3s ease-out;
                        display: flex; /* Use flex for centering text */
                        align-items: center;
                        justify-content: center;
                        min-width: 250px; /* Ensure it's wide enough */
                    `;
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; /* Red */
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; /* Amber */
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745'; /* Green */
                }
                messageBox.style.opacity = 1;
                messageBox.style.transform = 'translateX(-50%) translateY(0)'; // Bring to position

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)'; // Fade out and move up
                }, 5000);
            }

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            // Initial unit display
            updateUnitLabelsAndTooltips(unitSystemSelect.value);
        });
    </script>
</body>

</html>


