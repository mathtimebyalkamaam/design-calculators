<!DOCTYPE html>
<html lang="en">

<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
        crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>

    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heavy Industry Insulation Resistance Calculator (Megger) - IEEE/NETA</title>
    <meta name="description"
        content="Commercial-grade Insulation Resistance (Megger) Calculator for Heavy Industry. Sizing for Generators, Transformers, Cables, and Switchgear. Features IEEE 43-2013 Temp Correction, NETA MTS Acceptance, and Guard Terminal guidance.">
    <meta name="keywords"
        content="megger calculator, insulation resistance formula, polarization index analysis, dar calculation, ieee 43-2013 temperature correction, neta mts acceptance criteria, generator insulation test, transformer megger values, heavy industry electrical testing">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/insulationcalc" />

    <!-- JSON-LD Schema: Software Application -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Industrial Insulation Resistance Analyzer",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "A professional engineering tool for evaluating insulation integrity in heavy industrial equipment. Performs rigorous temperature correction and standards-based acceptance testing per IEEE and NETA.",
      "featureList": "IEEE 43-2013 Correction, NETA MTS 2019 Limits, PI/DAR Forensics, Generator/Transformer Specifics",
      "author": {
        "@type": "Organization",
        "name": "Design Calculators"
      }
    }
    </script>

    <!-- JSON-LD Schema: FAQ Page -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        { "@type": "Question", "name": "Why do I need to temperature correct Megger readings?", "acceptedAnswer": { "@type": "Answer", "text": "Insulation resistance is inversely proportional to temperature. For every 10°C rise in temperature, the resistance typically halves. To compare measurements taken at different times or against standards (usually based on 40°C or 20°C), you must normalize the readings using the temperature coefficient." } },
        { "@type": "Question", "name": "What is the Polarization Index (PI)?", "acceptedAnswer": { "@type": "Answer", "text": "PI is the ratio of the 10-minute resistance reading to the 1-minute reading (R10 / R1). It measures how well the insulation absorbs charge. A high PI indicates healthy, clean, and dry insulation, while a PI close to 1 suggests contamination or moisture." } },
        { "@type": "Question", "name": "What is an acceptable PI value?", "acceptedAnswer": { "@type": "Answer", "text": "Per IEEE 43, a PI of greater than 2.0 is generally recommended for Class F/H insulation systems. A value below 1.0 indicates immediate failure (conductive path). Values between 1.0 and 2.0 may be acceptable depending on the equipment age and type." } },
        { "@type": "Question", "name": "What represents a 'Good' DAR value?", "acceptedAnswer": { "@type": "Answer", "text": "Dielectric Absorption Ratio (DAR) is the ratio of 60s/30s readings. A DAR < 1.25 is questionable, 1.25-1.6 is Adequate, and > 1.6 is Good. It is useful for tests where a full 10-minute PI test is not feasible." } },
        { "@type": "Question", "name": "How do I choose the Test Voltage?", "acceptedAnswer": { "@type": "Answer", "text": "Test voltage depends on the equipment's nameplate rating. Common guidelines (NETA MTS): 250V rated -> 500V test; 600V rated -> 1000V test; 5kV rated -> 2500V test. Never exceed the manufacturer's recommended test voltage to avoid damaging insulation." } },
        { "@type": "Question", "name": "What is the '1 Megohm per kV' rule?", "acceptedAnswer": { "@type": "Answer", "text": "It is an old rule of thumb stating the minimum resistance should be 1 MΩ for every 1000V of operating voltage, plus 1 MΩ. While useful for a quick check, modern standards (IEEE 43-2000) often require strictly 100 MΩ for most form-wound motors regardless of voltage." } },
        { "@type": "Question", "name": "Should I discharge the equipment after testing?", "acceptedAnswer": { "@type": "Answer", "text": "YES. Insulation acts as a capacitor and stores lethal charge during a DC test. You must discharge the winding through a bleed resistor or ground stick for at least 4 times the duration of the test before touching it." } },
        { "@type": "Question", "name": "Can humidity affect my readings?", "acceptedAnswer": { "@type": "Answer", "text": "Yes, surface moisture can create leakage paths that lower the resistance reading significantly. If the temperature is near the Dew Point, condensation forms. PI is generally less affected by temperature but heavily affected by moisture." } },
        { "@type": "Question", "name": "What does a 'brittle' insulation mean?", "acceptedAnswer": { "@type": "Answer", "text": "In the context of PI, extremely high values (e.g., > 5.0) in older asphalt-mica insulation *might* indicate the insulation has become dry and brittle, potentially cracking under mechanical stress, though modern epoxy-mica systems naturally have high PIs." } },
        { "@type": "Question", "name": "Does this calculator follow NETA or IEEE?", "acceptedAnswer": { "@type": "Answer", "text": "This tool integrates logic from both. It uses IEEE 43-2013 for Rotating Machinery temperature correction and NETA MTS-2019 for Cable and Transformer minimum acceptance values." } }
      ]
    }
    </script>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial) --- */
        :root {
            --primary: #1E3A8A;
            /* Dark Blue */
            --secondary: #2563EB;
            /* Bright Blue */
            --accent: #F59E0B;
            /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #334155;
            --heading: #0F172A;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --input-bg: #FFFFFF;
        }

        body.dark-mode {
            --primary: #3B82F6;
            --secondary: #60A5FA;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #E2E8F0;
            --heading: #F8FAFC;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #FBBF24;
            --input-bg: #334155;
        }

        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: -0.5px;
        }

        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #DBEAFE;
            font-weight: 500;
        }

        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            opacity: 0.9;
        }

        .nav-links a:hover {
            opacity: 1;
            transform: translateY(-1px);
        }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .switch {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--success);
            border-color: var(--success);
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        /* Main Content */
        main {
            padding: 40px 0;
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card h2 {
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.75rem;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        h4 {
            color: var(--heading);
            font-size: 1.1rem;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        /* Tool Switcher */
        .tool-switcher {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tool-btn {
            background: var(--card);
            border: 2px solid var(--border);
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-btn:hover {
            border-color: var(--secondary);
            transform: translateY(-2px);
        }

        .tool-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }

        /* Module Containers */
        .tool-module {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .tool-module.active {
            display: block;
        }

        /* Results Big Display */
        .result-box {
            text-align: center;
            padding: 25px;
            background: var(--card);
            border: 2px solid var(--primary);
            border-radius: 12px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .result-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--grad);
        }

        .main-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            font-family: 'Montserrat', sans-serif;
            margin: 10px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .sub-value {
            font-size: 1.1rem;
            color: var(--text);
            opacity: 0.9;
            font-weight: 500;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Calculation Steps Styling */
        .calc-steps {
            text-align: left;
            margin-top: 25px;
            background: var(--bg);
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.03);
        }

        .calc-steps h4 {
            margin-top: 0;
            color: var(--primary);
            font-family: 'Inter', sans-serif;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        .calc-steps strong {
            color: var(--heading);
        }

        .step-block {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .step-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .step-title {
            font-weight: 700;
            color: var(--secondary);
            display: block;
            margin-bottom: 5px;
            font-family: 'Inter', sans-serif;
        }

        /* Visualizer */
        .viz-container {
            height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px;
        }

        canvas {
            max-height: 100%;
            max-width: 100%;
        }

        /* Buttons (Shared) */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(37, 99, 235, 0.35);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text);
            box-shadow: none;
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.3s;
            display: none;
        }

        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Educational Section */
        .education-section {
            padding: 40px;
        }

        .article-content {
            font-family: 'Inter', sans-serif;
            color: var(--text);
        }

        .article-block {
            margin-bottom: 40px;
        }

        .article-block h3 {
            color: var(--primary);
            border-left: 5px solid var(--accent);
            padding-left: 15px;
            margin-bottom: 20px;
            font-size: 1.4rem;
            margin-top: 0;
        }

        .article-block h4 {
            color: var(--heading);
            margin-top: 25px;
            margin-bottom: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            border-bottom: none;
        }

        .article-block p {
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: justify;
        }

        .article-block ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .article-block li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .highlight-box {
            background: rgba(37, 99, 235, 0.05);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .formula {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.1rem;
            border: 1px solid var(--border);
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        /* FAQ Accordion */
        .faq-item {
            border-bottom: 1px solid var(--border);
            padding: 15px 0;
        }

        .faq-question {
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--heading);
            transition: color 0.2s;
        }

        .faq-question:hover {
            color: var(--primary);
        }

        .faq-answer {
            display: none;
            margin-top: 10px;
            color: var(--text);
            line-height: 1.7;
            text-align: justify;
        }

        .faq-item.active .faq-answer {
            display: block;
            animation: fadeIn 0.3s;
        }

        .faq-icon {
            transition: transform 0.3s;
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

        /* Results Grid */
        .res-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media(max-width:768px) {
            .res-grid {
                grid-template-columns: 1fr;
            }
        }

        .res-item {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .res-label {
            font-size: 0.85rem;
            color: var(--text);
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .res-val {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--heading);
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #94A3B8;
            padding: 60px 0 30px 0;
            margin-top: 80px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-col {
            flex: 1;
            min-width: 200px;
        }

        .footer-col h4 {
            color: white;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-col li {
            margin-bottom: 12px;
        }

        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-col a:hover {
            color: var(--accent);
        }

        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        /* Social Buttons Styling */
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .social-btn:hover {
            transform: translateY(-4px);
        }

        .social-btn.linkedin {
            background-color: #0A66C2;
        }

        .social-btn.youtube {
            background-color: #FF0000;
        }

        .social-btn.twitter {
            background-color: #1DA1F2;
        }

        .social-btn.facebook {
            background-color: #1877F2;
        }

        .social-btn.whatsapp {
            background-color: #25D366;
        }

        .footer-disclaimer {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 900px;
            margin: 0 auto;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.85rem;
        }

        .hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 20px;
            }

            .nav-links {
                flex-direction: column;
                width: 100%;
                text-align: center;
            }

            .tool-switcher {
                flex-direction: column;
            }
        }
    </style>
    <style>
        /* Core Header Styles */
        .header {
            background: var(--gradient-primary, linear-gradient(135deg, #1E3A8A, #2563EB));
            color: white;
            padding: 10px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1000;
            overflow: visible !important;
        }

        .header .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            position: relative;
        }

        .header .logo-container {
            display: flex !important;
            align-items: center !important;
            gap: 12px !important;
            text-decoration: none;
            color: white;
        }

        .header .logo {
            height: 48px !important;
            width: auto;
            object-fit: contain;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: #ffffff;
            margin-bottom: 2px;
            white-space: nowrap;
            font-family: 'Montserrat', sans-serif;
        }

        .logo-text-group {
            display: flex;
            flex-direction: column;
            justify-content: center;
            line-height: 1.1;
        }

        .logo-subtitle {
            font-size: 0.7rem !important;
            color: rgba(255, 255, 255, 0.85) !important;
            font-weight: 500;
            margin: 0 !important;
            line-height: 1.2;
            max-width: 250px;
            white-space: normal;
        }

        .header .nav-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header .nav-links {
            display: flex;
            gap: 25px;
            list-style: none;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .header .nav-links li {
            margin: 0;
            position: relative;
            display: inline-block;
        }

        .header .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            opacity: 0.9;
        }

        .header .nav-links a:hover {
            opacity: 1;
            transform: translateY(-1px);
        }

        .header .theme-toggle {
            margin-left: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            z-index: 1000;
        }

        /* Mega Menu Styles */
        .nav-links .dropbtn {
            cursor: pointer;
            padding: 10px 0;
            display: inline-block;
        }

        .nav-links .dropbtn i {
            font-size: 0.8em;
            margin-left: 4px;
            opacity: 0.7;
            transition: transform 0.3s;
        }

        .nav-links .nav-item:hover .dropbtn i {
            transform: rotate(180deg);
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: var(--card-bg, #ffffff);
            width: 600px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 2000;
            border-radius: 12px;
            padding: 20px;
            top: 100%;
            margin-top: 5px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease-in-out;
            border-top: 4px solid var(--secondary-color, #2563EB);
        }

        .nav-links .nav-item:hover .dropdown-content {
            display: block;
            opacity: 1;
            visibility: visible;
        }

        .dropdown-content .row {
            display: flex;
            gap: 20px;
        }

        .dropdown-content .column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dropdown-content a {
            color: var(--text-color, #4B5563) !important;
            padding: 6px 8px;
            text-decoration: none;
            display: block;
            font-size: 0.9rem !important;
            border-radius: 6px;
            transition: background 0.2s, color 0.2s;
            font-weight: 400 !important;
            line-height: 1.4;
        }

        .dropdown-content a:hover {
            background-color: var(--hover-color, #F1F5F9);
            color: var(--primary-color, #1E3A8A) !important;
            transform: translateX(4px);
        }

        .mega-menu-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color, #E2E8F0);
            text-align: center;
        }

        .mega-menu-footer .view-all-btn {
            display: inline-block;
            color: var(--primary-color, #1E3A8A) !important;
            font-weight: 700 !important;
            font-size: 0.95rem !important;
        }

        /* Dark Mode Overrides */
        body.dark-mode .dropdown-content {
            background-color: var(--card-bg, #1E293B);
            border-color: var(--secondary-color, #34D399);
        }

        body.dark-mode .dropdown-content a {
            color: var(--text-color, #CBD5E1) !important;
        }

        body.dark-mode .dropdown-content a:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--primary-color, #10B981) !important;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .mobile-menu-toggle {
                display: block;
            }

            .header .nav-menu {
                display: flex;
            }

            .nav-links {
                position: fixed;
                top: 0;
                left: -100%;
                width: 280px;
                height: 100vh;
                background: var(--gradient-dark, #0F172A);
                flex-direction: column;
                padding: 100px 30px 30px;
                gap: 24px;
                transition: left 0.4s ease-in-out;
                box-shadow: 4px 0 12px rgba(0, 0, 0, 0.3);
                z-index: 999;
                align-items: flex-start;
            }

            .nav-links.active {
                left: 0;
            }

            .nav-links a {
                width: 100%;
                padding: 12px 16px;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.05);
                display: block;
            }

            .dropdown-content {
                position: static;
                width: 100%;
                box-shadow: none;
                transform: none;
                display: none !important;
                padding: 0 0 0 15px;
                background: transparent;
                border: none;
            }

            .nav-links .nav-item:hover .dropdown-content {
                display: block !important;
                opacity: 1;
                visibility: visible;
            }

            .dropdown-content .row {
                flex-direction: column;
                gap: 0;
            }

            .nav-links .nav-item {
                display: block;
                width: 100%;
            }

            .nav-links .dropbtn {
                width: 100%;
                display: flex;
                justify-content: space-between;
            }

            .header .logo-text {
                font-size: 1.1rem;
            }

            .header .logo {
                height: 40px;
            }
        }
    </style>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <div id="message-box" class="message-box"></div>

    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-microchip"></i> Heavy Industry Insulation Resistance Calculator</h2>
            <div class="tool-description">
                <p>Commercial-grade diagnostics for <strong>Generators</strong>, <strong>Transformers</strong>,
                    <strong>HV Cables</strong>, and <strong>Switchgear</strong>. Performs rigorous temperature
                    correction to standard reference values (40°C/20°C) per <strong>IEEE 43</strong> and validates
                    against <strong>NETA MTS</strong> acceptance criteria.
                </p>
            </div>

            <!-- Tool Switcher -->
            <div class="tool-switcher">
                <button class="tool-btn active" onclick="switchTool('spot')"><i class="fas fa-thermometer-half"></i> IR
                    Spot Test (Temp Corrected)</button>
                <button class="tool-btn" onclick="switchTool('pi')"><i class="fas fa-stopwatch"></i> PI / DAR
                    Analysis</button>
            </div>

            <!-- Visualizer -->
            <div class="viz-container">
                <canvas id="irChart"></canvas>
            </div>

            <!-- MODULE 1: IR SPOT TEST & TEMP CORRECTION -->
            <div id="mod-spot" class="tool-module active">
                <div class="form-row">
                    <div class="form-group">
                        <label>Asset Class</label>
                        <select id="eq-type" onchange="updateEqType()">
                            <option value="generator">Generator / Motor (IEEE 43)</option>
                            <option value="trans_oil">Transformer - Liquid Filled (NETA/C57)</option>
                            <option value="trans_dry">Transformer - Dry Type (NETA)</option>
                            <option value="cable">Power Cable (ICEA/NETA)</option>
                            <option value="switchgear">Switchgear / Bus (NETA)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Rated Voltage (L-L) [V]</label>
                        <input type="number" id="inp-volts" value="4160" step="10">
                    </div>
                    <div class="form-group">
                        <label>Applied Test Voltage [V]</label>
                        <select id="inp-test-volts">
                            <option value="500">500 V DC (For < 1kV)</option>
                            <option value="1000">1000 V DC (For 600V-2.4kV)</option>
                            <option value="2500">2500 V DC (For 2.4kV-5kV)</option>
                            <option value="5000">5000 V DC (For > 5kV)</option>
                            <option value="10000">10000 V DC (High Potential)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>1-Min Resistance Reading [MΩ]</label>
                        <input type="number" id="inp-res" value="1500" step="1">
                    </div>
                    <div class="form-group">
                        <label>Winding/Insulation Temp [°C]</label>
                        <input type="number" id="inp-temp" value="28" step="1">
                    </div>
                    <div class="form-group">
                        <label>Correction Base Temp</label>
                        <select id="inp-base-temp">
                            <option value="40">40°C (Rotating Machinery)</option>
                            <option value="20">20°C (Cables/Transformers)</option>
                        </select>
                    </div>
                </div>

                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcSpot()">Run Forensic Analysis</button>
                </div>
            </div>

            <!-- MODULE 2: PI / DAR CALCULATOR -->
            <div id="mod-pi" class="tool-module">
                <div class="form-row">
                    <div class="form-group">
                        <label>30 Second Reading [MΩ]</label>
                        <input type="number" id="pi-30s" value="500">
                    </div>
                    <div class="form-group">
                        <label>60 Second Reading [MΩ]</label>
                        <input type="number" id="pi-60s" value="800">
                    </div>
                    <div class="form-group">
                        <label>10 Minute Reading [MΩ]</label>
                        <input type="number" id="pi-10m" value="2400">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Insulation Class (IEEE 43)</label>
                        <select id="pi-class">
                            <option value="A">Class A (Old)</option>
                            <option value="B">Class B (Standard)</option>
                            <option value="F">Class F (Most Industrial)</option>
                            <option value="H">Class H (High Temp)</option>
                        </select>
                    </div>
                </div>

                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcPI()">Calculate Ratios</button>
                </div>
            </div>

            <!-- RESULTS -->
            <div class="result-box" id="main-result" style="display:none;">
                <div class="sub-value" id="res-subtitle">Analysis Result</div>
                <div id="res-main" class="main-value">--</div>
                <div id="res-status" class="sub-value" style="font-weight:bold; margin-top:5px;"></div>

                <div class="res-grid">
                    <div class="res-item">
                        <div class="res-label" id="lbl-1">Corrected Resistance</div>
                        <div class="res-val" id="val-1">--</div>
                    </div>
                    <div class="res-item">
                        <div class="res-label" id="lbl-2">Minimum Allowed</div>
                        <div class="res-val" id="val-2">--</div>
                    </div>
                    <div class="res-item">
                        <div class="res-label" id="lbl-3">Temp Factor (Kt)</div>
                        <div class="res-val" id="val-3">--</div>
                    </div>
                    <div class="res-item">
                        <div class="res-label" id="lbl-4">Reference Standard</div>
                        <div class="res-val" id="val-4">--</div>
                    </div>
                </div>

                <div class="calc-steps" id="calc-steps-box"></div>
            </div>

            <div class="button-wrapper" style="margin-top:40px;">
                <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download Test
                    Report</button>
            </div>
        </div>

        <!-- EDUCATIONAL SECTION -->
        <div class="card education-section" style="margin-top: 40px;">
            <h2><i class="fas fa-book-open"></i> Heavy Industry Engineering Guide: Insulation Testing</h2>
            <div class="article-content">

                <div class="article-block">
                    <h3>1. Dielectric Theory & Equivalent Circuit</h3>
                    <p>In heavy industrial electrical systems, insulation is not a perfect barrier; it behaves as a
                        complex circuit component. When a DC voltage is applied (Megger test), the current flowing into
                        the insulation ($I_{total}$) is the sum of three distinct components:</p>
                    <ul>
                        <li><strong>Capacitive Current ($I_C$):</strong> High initial surge that charges the capacitance
                            between the conductor and ground. Decays to near zero typically within seconds.</li>
                        <li><strong>Absorption Current ($I_A$):</strong> Caused by the reorientation of polar molecules
                            within the dielectric material. This current decays slowly over minutes (up to 10 minutes or
                            more). This phenomenon enables the Polarization Index (PI) test.</li>
                        <li><strong>Leakage Current ($I_L$):</strong> The steady-state current that flows through the
                            insulation volume and over its surface (creepage). This is the primary indicator of
                            insulation quality. If $I_L$ is high, it indicates moisture, contamination, or
                            carbonization.</li>
                    </ul>
                </div>

                <div class="article-block">
                    <h3>2. IEEE 43-2013 Temperature Correction</h3>
                    <p>Resistance ($R$) is inversely proportional to Temperature ($T$). For most industrial insulation
                        classes (B, F, H), the resistance <strong>halves</strong> for every 10°C rise in temperature. To
                        trend data effectively, all spot readings must be corrected to a base temperature (usually 40°C
                        for rotating machines).</p>
                    <div class="formula">
                        $$ R_{40C} = R_t \times K_t $$
                        $$ K_t = 0.5^{(40 - T_{test})/10} $$
                    </div>
                    <p><strong>Note for Transformers:</strong> Liquid-filled transformers behave differently. The
                        correction factors are often derived from empirical curves in IEEE C57.12.90, but the 10°C rule
                        is acceptable for field estimation.</p>
                </div>

                <div class="article-block">
                    <h3>3. The "Guard" Terminal Explained</h3>
                    <p>On industrial Meggers (>5kV), you will see a third terminal marked <strong>G (Guard)</strong>.
                        This is critical for testing high-voltage bushings and cables.</p>
                    <p><strong>Function:</strong> The Guard terminal shunts surface leakage current <em>away</em> from
                        the measurement circuit. Without the Guard, surface moisture or dirt on a bushing porcelain can
                        cause a false "Fail" reading by allowing current to bypass the internal insulation. Connecting
                        the Guard wire to a bare wire wrapped around the surface insulation forces that leakage current
                        to bypass the ammeter, giving you the true volume resistance of the insulation.</p>
                </div>

                <div class="article-block">
                    <h3>4. Step Voltage Testing</h3>
                    <p>For HV generators and motors (>2300V), a simple Spot reading may not reveal aging. A <strong>Step
                            Voltage Test</strong> applies voltage in steps (e.g., 1kV, 2kV, 3kV, ... up to Max Test V)
                        for 1 minute each. If the resistance drops significantly as voltage increases, it indicates
                        <strong>insulation voids, cracks, or instability</strong> that might arc over during operation.
                        Ideally, resistance should remain flat regardless of voltage stress.
                    </p>
                </div>

                <div class="article-block">
                    <h3>5. Safety: Discharge & Arc Flash</h3>
                    <p><strong>Lethal Hazard:</strong> Insulation stores energy like a capacitor ($E = 0.5 C V^2$).
                        After a 10-minute PI test on a large hydro generator stator, the stored energy can be lethal.
                    </p>
                    <p><strong>Protocol:</strong> You must discharge the winding through a resistive ground stick for at
                        least <strong>4 times the duration of the test</strong>. If you tested for 10 minutes, discharge
                        for 40 minutes before removing leads. Never disconnect the lead while the test is active; this
                        can draw a massive DC arc.</p>
                </div>

                <div class="article-block">
                    <h3>6. Frequently Asked Questions (FAQ)</h3>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">1. Why do I need to temperature correct
                            Megger readings? <i class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Insulation resistance is inversely proportional to temperature. For
                            every 10°C rise in temperature, the resistance typically halves. To compare measurements
                            taken at different times or against standards (usually based on 40°C or 20°C), you must
                            normalize the readings using the temperature coefficient.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">2. What is the Polarization Index (PI)? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">PI is the ratio of the 10-minute resistance reading to the 1-minute
                            reading (R10 / R1). It measures how well the insulation absorbs charge. A high PI indicates
                            healthy, clean, and dry insulation, while a PI close to 1 suggests contamination or
                            moisture.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">3. What is an acceptable PI value? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Per IEEE 43, a PI of greater than 2.0 is generally recommended for Class
                            F/H insulation systems. A value below 1.0 indicates immediate failure (conductive path).
                            Values between 1.0 and 2.0 may be acceptable depending on the equipment age and type.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">4. What represents a 'Good' DAR value? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Dielectric Absorption Ratio (DAR) is the ratio of 60s/30s readings. A
                            DAR < 1.25 is questionable, 1.25-1.6 is Adequate, and> 1.6 is Good. It is useful for tests
                                where a full 10-minute PI test is not feasible.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">5. How do I choose the Test Voltage? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Test voltage depends on the equipment's nameplate rating. Common
                            guidelines (NETA MTS): 250V rated -> 500V test; 600V rated -> 1000V test; 5kV rated -> 2500V
                            test. Never exceed the manufacturer's recommended test voltage to avoid damaging insulation.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">6. What is the '1 Megohm per kV' rule? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">It is an old rule of thumb stating the minimum resistance should be 1 MΩ
                            for every 1000V of operating voltage, plus 1 MΩ. While useful for a quick check, modern
                            standards (IEEE 43-2000) often require strictly 100 MΩ for most form-wound motors regardless
                            of voltage.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">7. Should I discharge the equipment after
                            testing? <i class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">YES. Insulation acts as a capacitor and stores lethal charge during a DC
                            test. You must discharge the winding through a bleed resistor or ground stick for at least 4
                            times the duration of the test before touching it.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">8. Can humidity affect my readings? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Yes, surface moisture can create leakage paths that lower the resistance
                            reading significantly. If the temperature is near the Dew Point, condensation forms. PI is
                            generally less affected by temperature but heavily affected by moisture.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">9. What does a 'brittle' insulation mean? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">In the context of PI, extremely high values (e.g., > 5.0) in older
                            asphalt-mica insulation *might* indicate the insulation has become dry and brittle,
                            potentially cracking under mechanical stress, though modern epoxy-mica systems naturally
                            have high PIs.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">10. Does this calculator follow NETA or
                            IEEE? <i class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">This tool integrates logic from both. It uses IEEE 43-2013 for Rotating
                            Machinery temperature correction and NETA MTS-2019 for Cable and Transformer minimum
                            acceptance values.</div>
                    </div>

                </div>
            </div>
        </div>
    </main>

        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let lastResult = {};
        let myChart = null;

        // UI Logic
        document.addEventListener('DOMContentLoaded', () => {
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if (themeSwitch) {
                themeSwitch.addEventListener('change', function () {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
            initChart();
        });

        function switchTool(toolId) {
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.querySelectorAll('.tool-module').forEach(m => m.classList.remove('active'));
            document.getElementById('mod-' + toolId).classList.add('active');
            document.getElementById('main-result').style.display = 'none';
        }

        function toggleFaq(element) {
            const item = element.parentElement;
            item.classList.toggle('active');
        }

        function updateEqType() {
            const type = document.getElementById('eq-type').value;
            const baseSelect = document.getElementById('inp-base-temp');
            // Logic: Rotating machines standardized to 40C. Others often 20C.
            if (type === 'generator') {
                baseSelect.value = "40";
            } else {
                baseSelect.value = "20";
            }
        }

        function initChart() {
            const ctx = document.getElementById('irChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Measured (Corrected)', 'Minimum Required'],
                    datasets: [{
                        label: 'Resistance (MΩ)',
                        data: [0, 0],
                        backgroundColor: ['#2563EB', '#DC2626'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Test Evaluation' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Resistance (MΩ)' } }
                    }
                }
            });
        }

        // --- MATH ENGINE ---

        function calcSpot() {
            const type = document.getElementById('eq-type').value;
            const volts = parseFloat(document.getElementById('inp-volts').value);
            const measured = parseFloat(document.getElementById('inp-res').value);
            const temp = parseFloat(document.getElementById('inp-temp').value);
            const baseTemp = parseFloat(document.getElementById('inp-base-temp').value);

            if (measured <= 0 || volts <= 0) return alert("Invalid Inputs");

            // 1. Temp Correction (IEEE 43-2013 Logic)
            // Resistance halves for every 10C rise (approx).
            // R_corrected = R_measured * 2^((T_test - T_base) / 10)
            // Note: If Test > Base, Factor > 1. Correct. (Hot reading is low, must be boosted to match cold base).

            const exponent = (temp - baseTemp) / 10;
            const Kt = Math.pow(2, exponent);
            const corrected = measured * Kt;

            // 2. Minimum Criteria Logic (Forensic)
            let minReq = 0;
            let standardName = "";
            let criteriaText = "";

            if (type === 'generator') {
                // IEEE 43-2013
                // Form wound (most industrial >1kV): 100 Megohm
                // Random wound (<1kV): 5 Megohm
                // Pre-1970 or Field Rule: kV + 1
                if (volts < 1000) {
                    minReq = 5;
                    criteriaText = "IEEE 43 Table 4: Random Wound Stators < 1kV";
                } else {
                    minReq = 100;
                    criteriaText = "IEEE 43 Table 4: Form Wound Stators > 1kV";
                }
                standardName = "IEEE 43-2013";
            }
            else if (type === 'cable') {
                // NETA MTS 2019 Table 100.1
                // < 1000V: 100 MΩ
                // 1001-5000V: 1000 MΩ
                // 5001-15000V: 5000 MΩ
                // > 15000V: 100,000 MΩ (Generic guidance, often manufacturer specific)
                if (volts <= 1000) minReq = 100;
                else if (volts <= 5000) minReq = 1000;
                else if (volts <= 15000) minReq = 5000;
                else minReq = 100000;
                standardName = "ANSI/NETA MTS-2019 Table 100.1";
                criteriaText = `Cables Rated ${volts}V`;
            }
            else if (type === 'trans_oil') {
                // NETA MTS Table 100.5 (Liquid Filled)
                // Voltage Class specific.
                // 1.2kV class: 1000M
                // 5kV class: 1000M
                // 15kV class: 5000M
                if (volts <= 1200) minReq = 1000;
                else if (volts <= 5000) minReq = 1000;
                else if (volts <= 15000) minReq = 5000;
                else minReq = 10000; // >15kV
                standardName = "NETA MTS Table 100.5";
                criteriaText = "Liquid-Filled Transformer Acceptance";
            }
            else if (type === 'trans_dry') {
                // NETA MTS Table 100.10 (Dry Type) - lower than oil
                // < 600V: 500M
                // 601-5000V: 5000M
                // 5001-15000V: 25000M
                if (volts <= 600) minReq = 500;
                else if (volts <= 5000) minReq = 5000;
                else minReq = 25000;
                standardName = "NETA MTS Table 100.10";
                criteriaText = "Dry-Type Transformer Coils";
            }
            else { // Switchgear
                // NETA MTS Table 100.1
                // Similar to cables usually
                if (volts <= 1000) minReq = 100;
                else if (volts <= 5000) minReq = 1000;
                else minReq = 5000;
                standardName = "NETA MTS Table 100.1";
                criteriaText = "Switchgear Bus Insulation";
            }

            const status = corrected >= minReq ? "PASS" : "FAIL / INVESTIGATE";
            const color = corrected >= minReq ? "#10B981" : "#DC2626";

            // Render Results
            document.getElementById('main-result').style.display = 'block';
            document.getElementById('res-subtitle').innerText = "Forensic Analysis Result";
            document.getElementById('res-main').innerText = `${corrected.toFixed(1)} MΩ`;
            document.getElementById('res-main').style.color = color;
            document.getElementById('res-status').innerText = `${status}`;
            document.getElementById('res-status').style.color = color;

            document.getElementById('lbl-1').innerText = `Corrected @ ${baseTemp}°C`;
            document.getElementById('val-1').innerText = `${corrected.toFixed(1)} MΩ`;

            document.getElementById('lbl-2').innerText = `Standard Limit`;
            document.getElementById('val-2').innerText = `${minReq} MΩ`;

            document.getElementById('lbl-3').innerText = `Temp Coeff ($K_t$)`;
            document.getElementById('val-3').innerText = Kt.toFixed(3);

            document.getElementById('lbl-4').innerText = `Governing Standard`;
            document.getElementById('val-4').innerText = standardName;

            let steps = `<h4>Forensic Calculation Breakdown</h4>`;
            steps += `<div class="step-block">
                <span class="step-title">Step 1: Environmental Normalization</span>
                <strong>Objective:</strong> Convert field reading to standard reference temp (${baseTemp}°C).<br>
                Field Conditions: Measured ${measured} MΩ @ ${temp}°C.<br>
                Formula (IEEE 43 approx): $K_t = 2^{(T_{test} - T_{base})/10}$<br>
                Substitution: $K_t = 2^{(${temp} - ${baseTemp})/10} = 2^{${exponent}} = \\mathbf{${Kt.toFixed(3)}}$<br>
                Result: $R_{corrected} = ${measured} \\times ${Kt.toFixed(3)} = \\mathbf{${corrected.toFixed(1)} \\text{ M}\\Omega}$
            </div>`;
            steps += `<div class="step-block">
                <span class="step-title">Step 2: Standards Compliance Check</span>
                <strong>Standard:</strong> ${standardName}<br>
                <strong>Criteria Rule:</strong> ${criteriaText}<br>
                <strong>Limit:</strong> Must be $\\ge ${minReq} \\text{ M}\\Omega$<br>
                <strong>Evaluation:</strong> ${corrected.toFixed(1)} ${corrected >= minReq ? '>=' : '<'} ${minReq}<br>
                <strong>Verdict:</strong> <span style="color:${color}; font-weight:bold;">${status}</span>
            </div>`;

            document.getElementById('calc-steps-box').innerHTML = steps;
            if (window.MathJax) window.MathJax.typesetPromise();

            // Chart
            myChart.data.datasets[0].data = [corrected, minReq];
            myChart.data.datasets[0].backgroundColor = [color, '#64748B'];
            myChart.update();

            lastResult = { type: 'spot', corrected, minReq, measured, steps, status, standardName };
        }

        function calcPI() {
            const r30 = parseFloat(document.getElementById('pi-30s').value);
            const r60 = parseFloat(document.getElementById('pi-60s').value);
            const r10m = parseFloat(document.getElementById('pi-10m').value);

            if (!r30 || !r60 || !r10m) return alert("Please enter all 3 readings.");

            const dar = r60 / r30;
            const pi = r10m / r60;

            let piStatus = "", piColor = "";
            let piExplanation = "";
            // PI Limits (IEEE 43-2013 Table 3)
            if (pi < 1.0) {
                piStatus = "FAILED (Danger)";
                piColor = "#DC2626";
                piExplanation = "Conductive path exists. Insulation failure likely imminent.";
            }
            else if (pi < 2.0) {
                piStatus = "Questionable";
                piColor = "#F59E0B";
                piExplanation = "Acceptable only for older Class A/B. Fail for modern Class F.";
            }
            else if (pi < 4.0) {
                piStatus = "PASS (Good)";
                piColor = "#10B981";
                piExplanation = "Insulation is clean and dry. Absorption current is decaying normally.";
            }
            else {
                piStatus = "Excellent / Brittle?";
                piColor = "#10B981";
                piExplanation = "Very dry. *Note: Extremely high PI (>5) in asphalt-mica may indicate brittleness.";
            }

            let darStatus = "", darColor = "";
            if (dar < 1.25) { darStatus = "Poor"; darColor = "#DC2626"; }
            else if (dar < 1.6) { darStatus = "Adequate"; darColor = "#F59E0B"; }
            else { darStatus = "Good"; darColor = "#10B981"; }

            // Render
            document.getElementById('main-result').style.display = 'block';
            document.getElementById('res-subtitle').innerText = "Polarization Index (PI) Result";
            document.getElementById('res-main').innerText = `PI: ${pi.toFixed(2)}`;
            document.getElementById('res-main').style.color = piColor;
            document.getElementById('res-status').innerText = piStatus;
            document.getElementById('res-status').style.color = piColor;

            document.getElementById('lbl-1').innerText = "DAR Ratio";
            document.getElementById('val-1').innerText = `${dar.toFixed(2)} (${darStatus})`;
            document.getElementById('val-1').style.color = darColor;

            document.getElementById('lbl-2').innerText = "Insulation Condition";
            document.getElementById('val-2').innerText = pi > 2 ? "Dry & Healthy" : "Moisture/Contamination";

            document.getElementById('lbl-3').innerText = "Absorption Trend";
            document.getElementById('val-3').innerText = r10m > r60 ? "Rising (Normal)" : "Flat (Resistive Leakage)";

            document.getElementById('lbl-4').innerText = "Raw Measurement";
            document.getElementById('val-4').innerText = `${r10m} MΩ (at 10m)`;

            let steps = `<h4>Diagnostic Logic</h4>`;
            steps += `<div class="step-block">
                <span class="step-title">Step 1: Dielectric Absorption Ratio (DAR)</span>
                $$ DAR = \\frac{R_{60s}}{R_{30s}} = \\frac{${r60}}{${r30}} = \\mathbf{${dar.toFixed(2)}} $$
                <strong>Diagnostic:</strong> <span style="color:${darColor}">${darStatus}</span>. (Target > 1.6 for modern insulation).
            </div>`;
            steps += `<div class="step-block">
                <span class="step-title">Step 2: Polarization Index (PI)</span>
                $$ PI = \\frac{R_{10m}}{R_{1m}} = \\frac{${r10m}}{${r60}} = \\mathbf{${pi.toFixed(2)}} $$
                <strong>Diagnostic:</strong> <span style="color:${piColor}">${piStatus}</span> per IEEE 43.<br>
                <em>Implication: ${piExplanation}</em>
            </div>`;

            document.getElementById('calc-steps-box').innerHTML = steps;
            if (window.MathJax) window.MathJax.typesetPromise();

            // Chart: Trend
            myChart.data.labels = ['30s', '60s', '10m'];
            myChart.data.datasets[0].label = "Resistance Profile (MΩ)";
            myChart.data.datasets[0].data = [r30, r60, r10m];
            myChart.data.datasets[0].backgroundColor = piColor;
            myChart.update();

            lastResult = { type: 'pi', pi, dar, steps, status: piStatus };
        }

        function generatePDF() {
            if (!lastResult.steps) { alert("Calculate first!"); return; }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(18); doc.setTextColor(30, 58, 138);
            doc.text("Heavy Industry Insulation Test Report", 14, 20);

            doc.setFontSize(12); doc.setTextColor(0);
            doc.text(`Analysis Type: ${lastResult.type === 'spot' ? 'Spot IR & Temp Correction' : 'PI / DAR Profile'}`, 14, 40);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 14, 50);

            doc.setDrawColor(30, 58, 138);
            doc.setLineWidth(0.5);
            doc.line(14, 55, 196, 55);

            if (lastResult.type === 'spot') {
                doc.setFontSize(14);
                doc.text(`Corrected Resistance: ${lastResult.corrected.toFixed(1)} MΩ`, 14, 65);
                doc.text(`Compliance Status: ${lastResult.status}`, 14, 75);
                doc.setFontSize(10);
                doc.text(`Standard Applied: ${lastResult.standardName}`, 14, 82);
                doc.text(`(Raw Reading: ${lastResult.measured} MΩ vs Limit: ${lastResult.minReq} MΩ)`, 14, 88);
            } else {
                doc.setFontSize(14);
                doc.text(`Polarization Index (PI): ${lastResult.pi.toFixed(2)}`, 14, 65);
                doc.text(`DAR Ratio: ${lastResult.dar.toFixed(2)}`, 14, 75);
                doc.text(`Condition: ${lastResult.status}`, 14, 85);
            }

            const stepsText = document.getElementById('calc-steps-box').innerText;
            const split = doc.splitTextToSize(stepsText, 180);
            doc.text(split, 14, 100);

            doc.save('Industrial_Megger_Report.pdf');
        }
    </script>
    <script src="/main.js"></script>
</body>

</html>
