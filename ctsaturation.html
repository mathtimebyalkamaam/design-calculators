<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CT Saturation & Knee Point Calculator - Protection Engineering</title>
    <link rel="canonical" href="https://designcalculators.co.in/ctsaturation.html" />
    <meta name="description" content="Commercial-grade CT Saturation Calculator. Analyze Knee Point Voltage, Time-to-Saturate, and Transient Performance for ANSI/IEC Current Transformers. Includes Excitation Curves and Waveform distortion visualization.">
    <meta name="keywords" content="ct saturation calculator, knee point voltage, current transformer, IEEE C57.13, IEC 61869, ALF, instrument security factor, protection relay, electrical engineering tools">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js for Plots -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Identical to Reference) --- */
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
            
            /* Commercial Grade Additions */
            --input-bg: #F1F5F9;
            --text-light: #64748b;
            --font-mono: 'Roboto Mono', monospace;
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
            --input-bg: #0f172a;
            --text-light: #94a3b8;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-bottom: none;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            font-size: 1rem;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        
        .tool-description { padding: 20px 0; background: transparent; color: var(--text); font-size: 1rem; }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: var(--font-mono);
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
             box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Input Sections (Grouping) */
        .input-section {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 25px 20px 20px 20px;
            margin-bottom: 24px;
            position: relative;
        }
        .section-title {
            position: absolute;
            top: -12px;
            left: 16px;
            background: var(--card);
            padding: 0 10px;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid var(--border);
            border-radius: 4px;
        }
        body.dark-mode .section-title { background: var(--card); }

        /* Tooltips */
        .info-icon { color: var(--secondary); cursor: help; font-size: 0.9em; opacity: 0.7; transition: opacity 0.2s; }
        .info-icon:hover { opacity: 1; }
        .tooltip-container { position: relative; display: inline-block; }
        .tooltip-container .tooltip-text {
            visibility: hidden; width: 260px; background-color: #333; color: #fff; text-align: left;
            border-radius: 6px; padding: 10px; position: absolute; z-index: 100; bottom: 135%; left: 50%;
            transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; font-size: 0.8rem;
            line-height: 1.4; font-weight: 400; box-shadow: 0 4px 10px rgba(0,0,0,0.2); pointer-events: none;
        }
        .tooltip-container .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent;
        }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }

        /* Buttons */
        .btn {
            background: var(--grad); color: white; border: none; padding: 16px 30px; border-radius: 8px;
            cursor: pointer; font-size: 1.1rem; font-weight: 700; box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s; width: 100%; display: inline-flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4); }
        .button-wrapper { display: flex; justify-content: center; width: 100%; padding-top: 15px; gap: 15px; }
        
        /* Input Action Button (Small) */
        .btn-action {
            background: var(--bg); border: 1px solid var(--border); color: var(--secondary); 
            padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;
            cursor: pointer; transition: all 0.2s; margin-left: 8px; display: inline-block;
        }
        .btn-action:hover { background: var(--secondary); color: white; border-color: var(--secondary); }

        /* Presets */
        .preset-container { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .preset-btn {
            padding: 8px 12px; font-size: 0.85rem; border: 1px solid var(--border); background: var(--card);
            border-radius: 20px; cursor: pointer; transition: all 0.2s; color: var(--text); display: flex; align-items: center; gap: 5px;
        }
        .preset-btn:hover { background: var(--bg); border-color: var(--secondary); color: var(--secondary); }

        /* Results Layout */
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start; }
        @media (max-width: 1024px) { .results-grid { grid-template-columns: 1fr; } }

        .results-table { width: 100%; border-collapse: collapse; margin-top: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 8px; overflow: hidden; }
        .results-table th, .results-table td { padding: 14px; text-align: left; border-bottom: 1px solid var(--border); }
        .results-table th { background: var(--grad); color: white; font-weight: 700; }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child { font-weight: 600; color: var(--heading); }

        /* Status Badges */
        .status-badge { padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block; }
        .status-pass { background: #dcfce7; color: #166534; }
        .status-warn { background: #fef9c3; color: #854d0e; }
        .status-fail { background: #fee2e2; color: #991b1b; }

        /* Chart Container */
        .chart-container {
            background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 15px; position: relative; height: 300px; width: 100%;
        }

        /* Educational Content (Article Style) */
        .education-section { margin-top: 50px; }
        .tech-article { display: grid; grid-template-columns: 250px 1fr; gap: 40px; align-items: start; }
        @media (max-width: 800px) { .tech-article { grid-template-columns: 1fr; } }
        
        .toc-sticky { position: sticky; top: 20px; background: var(--bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border); }
        .toc-sticky h4 { margin-top: 0; color: var(--primary); border-bottom: 2px solid var(--border); padding-bottom: 10px; }
        .toc-sticky ul { list-style: none; padding: 0; margin: 0; }
        .toc-sticky li { margin-bottom: 8px; }
        .toc-sticky a { text-decoration: none; color: var(--text); font-size: 0.95rem; transition: color 0.2s; display: block; padding: 4px 0; }
        .toc-sticky a:hover { color: var(--secondary); transform: translateX(5px); }

        .article-content h3 { color: var(--secondary); font-family: 'Montserrat', sans-serif; font-size: 1.5rem; margin-top: 40px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .article-content h3:first-child { margin-top: 0; }
        .article-content p { line-height: 1.8; margin-bottom: 20px; font-size: 1.05rem; color: var(--text); }
        .article-content ul { line-height: 1.8; padding-left: 20px; margin-bottom: 20px; color: var(--text); }
        .article-content li { margin-bottom: 10px; }
        
        .highlight-box { background: var(--input-bg); border-left: 5px solid var(--accent); padding: 20px; border-radius: 0 8px 8px 0; margin: 25px 0; }
        .highlight-box h4 { margin: 0 0 10px 0; color: var(--accent); font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg); border-left: 3px solid var(--accent); padding: 15px; margin: 12px 0; font-size: 1.1rem; border-radius: 4px; font-family: 'Courier New', monospace; overflow-x: auto; color: var(--heading);
        }
        .calculation-step {
            font-family: 'Courier New', monospace; background-color: rgba(0,0,0,0.03); padding: 15px; border-radius: 4px;
            margin-bottom: 15px; border-left: 4px solid var(--success); font-size: 0.95rem; line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(255,255,255,0.05); }

        /* Message Box */
        .message-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 16px 28px; border-radius: 8px; box-shadow: 0 6px 16px rgba(0,0,0,0.25); z-index: 10000; font-weight: 600; color: white; opacity: 0; transition: all 0.4s; display: none; }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(3px); }
        .modal-content { background-color: var(--card); margin: 10% auto; padding: 25px; border: 1px solid var(--border); width: 90%; max-width: 500px; border-radius: 12px; box-shadow: var(--shadow-lg); position: relative; }
        .close { color: var(--text-light); float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: var(--danger); }

        /* Footer (Strictly Preserved) */
        footer { background: var(--grad-dark); color: #CBD5E1; padding: 50px 0 20px 0; margin-top: 60px; }
        .footer-content { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 40px; margin-bottom: 30px; }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn { width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; color: white; border-radius: 50%; font-size: 1.1rem; transition: transform 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer { text-align: center; padding-top: 25px; border-top: 1px solid #334155; max-width: 800px; margin: 0 auto; font-size: 0.9rem; }
        .footer-bottom { text-align: center; padding-top: 20px; font-size: 0.9rem; color: #94A3B8; }

        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .results-grid { grid-template-columns: 1fr; }
        }
    </style>
    <link rel="stylesheet" href="styles.css">
    <meta property="og:title" content="CT Saturation & Knee Point Calculator - Protection Engineering">
    <meta property="og:description" content="Commercial-grade CT Saturation Calculator. Analyze Knee Point Voltage, Time-to-Saturate, and Transient Performance for ANSI/IEC Current Transformers. Includes Excitation Curves and Waveform distortion visualization.">
</head>
<body>

    <div id="message-box" class="message-box"></div>
    
    <!-- Lead Calc Modal -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 style="margin-top:0;">Calculate Lead Resistance</h3>
            <div class="form-group">
                <label>Wire Gauge</label>
                <select id="modal-awg">
                    <option value="2.5">2.5 mm² (0.00741 Ω/m)</option>
                    <option value="4.0">4.0 mm² (0.00461 Ω/m)</option>
                    <option value="6.0">6.0 mm² (0.00308 Ω/m)</option>
                    <option value="10">10 AWG (0.00328 Ω/m)</option>
                    <option value="12">12 AWG (0.00521 Ω/m)</option>
                </select>
            </div>
            <div class="form-group" style="margin-top:15px;">
                <label>One-Way Distance (m)</label>
                <input type="number" id="modal-len" value="50">
            </div>
            <button class="btn" style="margin-top:20px;" onclick="applyLeadCalc()">Apply Resistance</button>
        </div>
    </div>

    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-bolt"></i> CT Saturation & Knee Point Analyzer</h2>
            
            <div class="tool-description">
                <p>Commercial-grade Protection Engineering tool. Calculates <strong>Knee Point Voltage ($V_k$)</strong>, <strong>Time-to-Saturate ($t_{sat}$)</strong>, and simulates waveform distortion. Supports ANSI (C-Class) and IEC (P/TPX) standards with transient remanence analysis.</p>
            </div>

            <div class="calculator-form">
                <form id="ct-form">
                    
                    <div class="form-group">
                        <label>Quick Load Presets:</label>
                        <div class="preset-container" style="margin-bottom: 0;">
                            <button type="button" class="preset-btn" onclick="loadPreset('trans')"><i class="fas fa-tower-cell"></i> Transmission Line (High X/R)</button>
                            <button type="button" class="preset-btn" onclick="loadPreset('gen')"><i class="fas fa-charging-station"></i> Generator Diff. (C800)</button>
                            <button type="button" class="preset-btn" onclick="loadPreset('dist')"><i class="fas fa-city"></i> Distribution Feeder (5P20)</button>
                        </div>
                    </div>

                    <!-- CT RATINGS -->
                    <div class="input-section">
                        <div class="section-title">1. Current Transformer Data</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Standard Class (Auto-Fill)</label>
                                <select id="ct-std" onchange="applyCTClass()">
                                    <option value="custom">Custom / Manual</option>
                                    <option value="C100">ANSI C100 (100V, ~0.1Ω)</option>
                                    <option value="C200">ANSI C200 (200V, ~0.2Ω)</option>
                                    <option value="C400">ANSI C400 (400V, ~0.4Ω)</option>
                                    <option value="C800">ANSI C800 (800V, ~0.8Ω)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>CT Ratio (Pri:Sec)</label>
                                <div style="display:flex; gap:5px; align-items: center;">
                                    <input type="number" id="ct-pri" value="2000" style="width: 60%">
                                    <span>:</span>
                                    <input type="number" id="ct-sec" value="5" style="width: 30%">
                                </div>
                            </div>
                        </div>
                        <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                            <div class="form-group">
                                <label>Knee Point ($V_k$) <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Saturation voltage. ANSI C400 = 400V. IEC 5P20 = 20 x Sec_In x (Rct+Rb).</span></div></label>
                                <input type="number" id="ct-vk" value="400">
                            </div>
                            <div class="form-group">
                                <label>Sec. Resistance ($R_{ct}$) <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Internal winding resistance of the CT at 75°C.</span></div></label>
                                <input type="number" id="ct-r" value="2.5" step="0.1">
                            </div>
                             <div class="form-group">
                                <label>Remanence Flux ($K_{rem}$) <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Residual flux factor (0 to 0.8). High for closed iron cores (TPS), low for gapped (TPZ).</span></div></label>
                                <input type="number" id="ct-krem" value="0" step="0.1" max="0.9">
                            </div>
                        </div>
                        <div class="form-row">
                             <div class="form-group">
                                <label>Rated ALF / ISF (Optional) <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Rated Accuracy Limit Factor (e.g., 20 for 5P20) or Instrument Security Factor (FS 5). Used to calculate actual dynamic limit.</span></div></label>
                                <input type="number" id="ct-alf-rated" value="20" step="1">
                            </div>
                             <div class="form-group">
                                <label>Rated Burden (VA) <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Rated burden capacity (e.g. 15VA, 30VA). Used for ALF conversion.</span></div></label>
                                <input type="number" id="ct-va-rated" value="15" step="1">
                            </div>
                        </div>
                    </div>

                    <!-- SYSTEM FAULT -->
                    <div class="input-section">
                        <div class="section-title">2. System Fault Data</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Max Fault Current ($I_f$) (kA)</label>
                                <input type="number" id="sys-if" value="40" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>System X/R Ratio <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Determines DC offset decay time. $T_p = (X/R) / (2\pi f)$.</span></div></label>
                                <input type="number" id="sys-xr" value="20" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Frequency (Hz)</label>
                                <select id="sys-freq"><option value="50">50 Hz</option><option value="60">60 Hz</option></select>
                            </div>
                        </div>
                    </div>

                    <!-- BURDEN -->
                    <div class="input-section">
                        <div class="section-title">3. Connected Burden</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Relay Burden ($R_{relay}$) (Ω)</label>
                                <input type="number" id="bur-relay" value="0.1" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Lead Resistance ($R_{lead}$) (Ω) 
                                    <span class="btn-action" onclick="openLeadModal()">Calculate</span>
                                    <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Total loop resistance of wires from CT to Relay. $R = 2 \times L \times \rho/A$.</span></div>
                                </label>
                                <input type="number" id="bur-lead" value="0.5" step="0.01">
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Analyze Saturation</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Analysis Results</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Performance Metrics</h4>
                        <table class="results-table">
                            <thead>
                                <tr><th>Parameter</th><th>Value</th><th>Status</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Secondary Fault Current ($I_{sec}$)</td>
                                    <td id="res-isec" class="font-mono">0.00 A</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Total Burden ($Z_{total}$)</td>
                                    <td id="res-zb" class="font-mono">0.00 Ω</td>
                                    <td>-</td>
                                </tr>
                                <!-- Added row here to fix JS Error -->
                                <tr>
                                    <td>Required Voltage ($V_{req}$)</td>
                                    <td id="res-vreq" class="font-mono">0.00 V</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Actual ALF (Dynamic)</td>
                                    <td id="res-alf" class="font-mono">0.00</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Saturation Factor ($K_s$)</td>
                                    <td id="res-ks" class="font-mono">0.00</td>
                                    <td id="badge-ks"><span class="status-badge status-pass">OK</span></td>
                                </tr>
                                <tr>
                                    <td>Transient Factor ($K_{tf}$)</td>
                                    <td id="res-ktf" class="font-mono">0.00</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Time to Saturate ($t_{sat}$)</td>
                                    <td id="res-tsat" class="font-mono">∞ ms</td>
                                    <td id="badge-tsat">-</td>
                                </tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; font-size: 0.9rem; background: var(--bg); padding: 10px; border-radius: 6px;">
                            <strong>Diagnosis:</strong> <span id="diagnosis-text">Enter parameters to calculate.</span>
                        </div>
                    </div>

                    <!-- Right Col: Charts -->
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div>
                            <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 10px;">Excitation Curve (Log-Log)</h4>
                            <div class="chart-container">
                                <canvas id="exciteChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 10px;">Output Waveform (Distortion)</h4>
                            <div class="chart-container" style="height: 200px;">
                                <canvas id="waveChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Calculation Details</h4>
                <div id="calculation-details"></div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT -->
        <div class="education-section card">
            <div class="card-header" style="margin-bottom:25px;">
                <h2><i class="fas fa-book-reader"></i> Technical Deep Dive: CT Saturation</h2>
            </div>
            
            <div class="tech-article">
                <!-- TOC -->
                <div class="toc-sticky">
                    <h4>Table of Contents</h4>
                    <ul>
                        <li><a href="#physics">1. Physics of Saturation</a></li>
                        <li><a href="#transient">2. The DC Offset Killer</a></li>
                        <li><a href="#remanence">3. Remanence: The Hidden Risk</a></li>
                        <li><a href="#alf">4. Accuracy Limit Factor (ALF)</a></li>
                        <li><a href="#time">5. Time-to-Saturate Importance</a></li>
                        <li><a href="#standards">6. IEEE vs IEC Standards</a></li>
                    </ul>
                </div>

                <!-- Content -->
                <div class="article-content">
                    <div id="physics">
                        <h3>1. Physics of Saturation: The Magnetic Funnel</h3>
                        <p>A Current Transformer (CT) works like a magnetic funnel. It transfers energy from the primary high-current conductor to the secondary circuit via a magnetic core (usually iron). Think of the core flux density ($B$) as water flowing through a pipe.</p>
                        <p><strong>Saturation</strong> occurs when the "pipe" is full. The iron core cannot carry any more magnetic flux. When this happens, the coupling between primary and secondary breaks down. The secondary output current drops to zero (or near zero) for parts of the cycle, resulting in a distorted, "chopped" waveform.</p>
                        <p>The limit is defined by the <strong>Knee Point Voltage ($V_k$)</strong>. If the voltage required to push the fault current through the secondary burden ($V_{req} = I_{sec} \times Z_b$) exceeds $V_k$, the CT saturates.</p>
                    </div>

                    <div id="transient">
                        <h3>2. The DC Offset Killer</h3>
                        <p>AC Faults are rarely pure sine waves. Because inductance opposes current change, a fault happening at voltage zero creates a massive <strong>DC Offset</strong> in the current to maintain flux continuity. This DC component decays exponentially based on the System X/R ratio.</p>
                        <div class="highlight-box">
                            <h4><i class="fas fa-exclamation-triangle"></i> Transient Dimensioning Factor ($K_{td}$)</h4>
                            <p>The DC flux adds to the AC flux. To avoid saturation during a fully offset fault, the CT must be sized vastly larger than for steady-state. The theoretical max flux is $(1 + X/R)$ times the AC flux. For a system with X/R=20, the CT needs to be <strong>21 times larger</strong> to avoid transient saturation completely!</p>
                        </div>
                    </div>

                    <div id="remanence">
                        <h3>3. Remanence: The Hidden Risk</h3>
                        <p>Iron cores have "memory". If a fault is cleared while flux is high, magnetic domains may remain aligned, leaving <strong>Remanent Flux ($\Psi_r$)</strong> trapped in the core. This reduces the available headroom for the next fault.</p>
                        <p>If an autoreclose operation occurs onto a fault with the same polarity, the core starts with, say, 80% flux already used up. Saturation happens almost instantly ($< 2ms$). 
                        <br><strong>Solution:</strong> Use gapped cores (IEC Class TPY, TPZ) which have low remanence ($K_{rem} < 10\%$).</p>
                    </div>

                    <div id="alf">
                        <h3>4. Accuracy Limit Factor (ALF)</h3>
                        <p>For IEC protection CTs (e.g., 5P20), the ALF defines how many times the rated current the CT can handle before error exceeds 5%. However, the <strong>Rated ALF</strong> is valid only at <strong>Rated Burden</strong>. If your connected burden is lower than rated, the <strong>Actual ALF</strong> increases significantly:</p>
                        <div class="formula">$$ ALF_{actual} = ALF_{rated} \times \frac{S_{rated} + S_{internal}}{S_{actual} + S_{internal}} $$</div>
                        <p>A CT rated 5P20 at 30VA might effectively perform as 5P40 if only 10VA of burden is connected.</p>
                    </div>

                    <div id="time">
                        <h3>5. Time-to-Saturate ($t_{sat}$)</h3>
                        <p>Relays don't trip instantly; they need measurement time (e.g., 1 cycle or 20ms). Even if a CT saturates, it's acceptable <strong>IF</strong> it saturates <em>after</em> the relay has made its decision.</p>
                        <p>This calculator estimates $t_{sat}$. If $t_{sat} > \text{Relay Time}$, the protection is secure. If $t_{sat} < 5ms$, differential relays may misoperate (trip incorrectly) due to the distorted waveform looking like an internal fault.</p>
                    </div>

                    <div id="standards">
                        <h3>6. Applicable Standards</h3>
                        <ul>
                            <li><strong>IEEE C57.13 (ANSI):</strong> Defines "C" class (e.g., C400). Knee point is defined at 45° tangent on log-log curve. Focuses on terminal voltage capability.</li>
                            <li><strong>IEC 61869-2 (formerly 60044):</strong> Defines "P" class (e.g., 5P20). Knee point is where 10% voltage increase causes 50% current increase. Includes TPX (closed core), TPY (gapped), TPZ (linear) for transient performance.</li>
                            <li><strong>IEEE C37.110:</strong> Guide for the Application of Current Transformers Used for Protective Relaying Purposes (Source of the $t_{sat}$ formulas).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Theme
        const themeSwitch = document.getElementById('theme-switch');
        if (themeSwitch && localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeSwitch.checked = true;
        }
        if(themeSwitch) {
            themeSwitch.addEventListener('change', function() {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('theme', this.checked ? 'dark' : 'light');
            });
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            if (!messageBox) return;
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        // Modal Logic
        function openLeadModal() { document.getElementById('leadModal').style.display = 'block'; }
        function closeModal() { document.getElementById('leadModal').style.display = 'none'; }
        window.onclick = function(event) { if(event.target == document.getElementById('leadModal')) closeModal(); }
        
        function applyLeadCalc() {
            const r_per_m_map = {
                "2.5": 0.00741, "4.0": 0.00461, "6.0": 0.00308, 
                "10": 0.00328, "12": 0.00521
            };
            const awg = document.getElementById('modal-awg').value;
            const len = parseFloat(document.getElementById('modal-len').value);
            if(len > 0) {
                const r = 2 * len * r_per_m_map[awg]; // Round trip
                document.getElementById('bur-lead').value = r.toFixed(3);
                closeModal();
                displayMessage(`Lead Resistance ${r.toFixed(3)}Ω applied.`);
            }
        }

        function applyCTClass() {
            const cls = document.getElementById('ct-std').value;
            if(cls === 'custom') return;
            
            const data = {
                'C100': {vk: 100, r: 0.1},
                'C200': {vk: 200, r: 0.2},
                'C400': {vk: 400, r: 0.4},
                'C800': {vk: 800, r: 0.8}
            };
            if(data[cls]) {
                document.getElementById('ct-vk').value = data[cls].vk;
                document.getElementById('ct-r').value = data[cls].r;
            }
        }

        function loadPreset(key) {
            const s = {
                'trans': {pri:2000, sec:5, vk:800, rct:4, krem:0.8, if:40, xr:30, f:60, rb:0.5, rl:1.0},
                'gen': {pri:5000, sec:5, vk:400, rct:2, krem:0.1, if:60, xr:40, f:50, rb:0.2, rl:0.3},
                'dist': {pri:600, sec:5, vk:100, rct:0.5, krem:0, if:12, xr:10, f:50, rb:0.1, rl:0.2}
            };
            const d = s[key];
            if(d) {
                document.getElementById('ct-pri').value = d.pri;
                document.getElementById('ct-sec').value = d.sec;
                document.getElementById('ct-vk').value = d.vk;
                document.getElementById('ct-r').value = d.rct;
                document.getElementById('ct-krem').value = d.krem;
                document.getElementById('sys-if').value = d.if;
                document.getElementById('sys-xr').value = d.xr;
                document.getElementById('sys-freq').value = d.f;
                document.getElementById('bur-relay').value = d.rb;
                document.getElementById('bur-lead').value = d.rl;
                displayMessage("Scenario Loaded", "success");
            }
        }

        // --- CALCULATION ENGINE ---
        let exciteChart = null;
        let waveChart = null;

        document.getElementById('calculate-btn').addEventListener('click', function() {
            // 1. Inputs
            const ratioPri = parseFloat(document.getElementById('ct-pri').value);
            const ratioSec = parseFloat(document.getElementById('ct-sec').value);
            const Vk = parseFloat(document.getElementById('ct-vk').value);
            const Rct = parseFloat(document.getElementById('ct-r').value);
            const Krem = parseFloat(document.getElementById('ct-krem').value);
            
            const alfRated = parseFloat(document.getElementById('ct-alf-rated').value);
            const vaRated = parseFloat(document.getElementById('ct-va-rated').value);

            const If_kA = parseFloat(document.getElementById('sys-if').value);
            const XR = parseFloat(document.getElementById('sys-xr').value);
            const Freq = parseFloat(document.getElementById('sys-freq').value);
            const Rb = parseFloat(document.getElementById('bur-relay').value);
            const Rl = parseFloat(document.getElementById('bur-lead').value);

            if([ratioPri, Vk, If_kA].some(x => x<=0)) return displayMessage("Check inputs", "error");

            // 2. Core Math
            const If = If_kA * 1000;
            const Isec = If * (ratioSec / ratioPri);
            const Z_ext = Rb + Rl;
            const Z_total = Rct + Z_ext;
            
            // Voltages
            const V_resistive = Isec * Z_total; // Steady state AC requirement
            
            // Saturation Factor Ks = Vk / V_resistive
            const Ks = Vk / V_resistive;
            
            // Transient Factor Ktf needed to avoid saturation
            const requirement = (XR + 1) / (1 - Krem);
            
            // Actual ALF Calculation (IEC 61869)
            // ALF_act = ALF_rat * ( (S_rat + S_int) / (S_act + S_int) )
            // S_int = I_sn^2 * Rct
            // S_act = I_sn^2 * Z_ext
            // I_sn is nominal secondary (e.g. 5A)
            const S_int = Math.pow(ratioSec, 2) * Rct;
            const S_act = Math.pow(ratioSec, 2) * Z_ext;
            // If rated VA is given, S_rated = vaRated. Else assume based on Vk? Better use input.
            const S_rated = vaRated;
            
            const ALF_act = alfRated * ( (S_rated + S_int) / (S_act + S_int) );

            // Time to Saturate (IEEE C37.110 simplified approximation)
            const omega = 2 * Math.PI * Freq;
            const Tp = XR / omega; // Primary Time constant
            let tsat = 9999; // Infinite
            
            if (Ks < requirement) {
                // Approximation for t_sat when saturation is inevitable
                const num = XR * V_resistive;
                const den = (XR * V_resistive) - (Vk*(1-Krem) - V_resistive);
                if (den <= 0) tsat = 0; 
                else tsat = Tp * Math.log(num / den);
            }

            const tsat_ms = tsat * 1000;

            // 3. Render Text
            const setVal = (id, v) => document.getElementById(id).textContent = v;
            setVal('res-isec', Isec.toFixed(1) + " A");
            setVal('res-zb', Z_total.toFixed(3) + " Ω");
            setVal('res-vreq', V_resistive.toFixed(1) + " V");
            setVal('res-ks', Ks.toFixed(2));
            setVal('res-ktf', requirement.toFixed(2));
            setVal('res-tsat', tsat > 100 ? ">100 ms" : tsat_ms.toFixed(2) + " ms");
            setVal('res-alf', ALF_act.toFixed(1));

            // Badges & Diagnosis
            const badgeKs = document.getElementById('badge-ks');
            const badgeTs = document.getElementById('badge-tsat');
            const diag = document.getElementById('diagnosis-text');
            
            if(Ks < 1) {
                badgeKs.innerHTML = '<span class="status-badge status-fail">FAIL</span>';
                diag.innerHTML = "<strong>Critical Failure:</strong> CT saturates even in steady state AC. Increase CT Ratio or reduce burden.";
                diag.style.color = "var(--danger)";
            } else if (Ks < requirement) {
                badgeKs.innerHTML = '<span class="status-badge status-warn">TRANSIENT SAT</span>';
                const timeClass = tsat_ms < 3 ? "status-fail" : (tsat_ms < 15 ? "status-warn" : "status-pass");
                badgeTs.innerHTML = `<span class="status-badge ${timeClass}">${tsat > 100 ? ">100" : tsat_ms.toFixed(1)} ms</span>`;
                diag.innerHTML = `<strong>Transient Saturation:</strong> CT will saturate in ${tsat_ms.toFixed(1)} ms. Actual ALF is ${ALF_act.toFixed(1)}.`;
                diag.style.color = "#854d0e";
            } else {
                badgeKs.innerHTML = '<span class="status-badge status-pass">PASS</span>';
                badgeTs.innerHTML = '<span class="status-badge status-pass">NO SAT</span>';
                diag.innerHTML = `<strong>Design Secure:</strong> CT handles full DC offset. Actual dynamic limit (ALF) is ${ALF_act.toFixed(1)}.`;
                diag.style.color = "var(--success)";
            }

            // 4. Math Steps
            const math = (t) => `$$${t}$$`;
            let html = `<div class="calculation-step">`;
            html += `<strong>1. Secondary Burden & Current:</strong><br>`;
            html += math(`I_{sec} = I_{pri} \\times \\frac{${ratioSec}}{${ratioPri}} = ${Isec.toFixed(1)} \\text{ A}`);
            html += math(`V_{steady} = I_{sec} \\times (R_{ct} + R_{ext}) = ${Isec.toFixed(1)} \\times ${Z_total.toFixed(2)} = \\mathbf{${V_resistive.toFixed(1)} \\text{ V}}`);
            html += `</div>`;

            html += `<div class="calculation-step">`;
            html += `<strong>2. Dynamic ALF Calculation:</strong><br>`;
            html += math(`ALF_{act} = ${alfRated} \\times \\frac{${S_rated} + ${S_int.toFixed(2)}}{${S_act.toFixed(2)} + ${S_int.toFixed(2)}} = \\mathbf{${ALF_act.toFixed(2)}}`);
            html += `</div>`;

            html += `<div class="calculation-step">`;
            html += `<strong>3. Saturation Check (IEEE C37.110):</strong><br>`;
            html += math(`K_s = \\frac{V_k}{V_{steady}} = \\frac{${Vk}}{${V_resistive.toFixed(1)}} = \\mathbf{${Ks.toFixed(2)}}`);
            html += math(`K_{req} = \\frac{1 + X/R}{1 - K_{rem}} = \\frac{1 + ${XR}}{1 - ${Krem}} = \\mathbf{${requirement.toFixed(2)}}`);
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;
            
            // 5. Charts
            drawExcitation(Vk, 0.1); 
            drawWaveform(tsat, Freq);

            // 6. Show
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise();
            document.getElementById('result-container').scrollIntoView({behavior:'smooth'});
        });

        function drawExcitation(Vk, Ie_knee) {
            const ctx = document.getElementById('exciteChart').getContext('2d');
            if(exciteChart) exciteChart.destroy();
            
            const pts = [];
            for(let v = Vk*0.1; v < Vk*1.5; v+=Vk*0.05) {
                let i = 0;
                if(v < Vk) i = Ie_knee * Math.pow(v/Vk, 1); 
                else i = Ie_knee * Math.pow(v/Vk, 8); 
                pts.push({x: i, y: v});
            }

            exciteChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Excitation Curve',
                        data: pts,
                        showLine: true,
                        borderColor: '#2563EB',
                        backgroundColor: 'rgba(37,99,235,0.1)'
                    }, {
                        label: 'Knee Point',
                        data: [{x: Ie_knee, y: Vk}],
                        backgroundColor: '#DC2626',
                        pointRadius: 6
                    }]
                },
                options: {
                    scales: {
                        x: { type: 'logarithmic', title: {display:true, text:'Exciting Current (A)'} },
                        y: { type: 'logarithmic', title: {display:true, text:'Secondary Voltage (V)'} }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function drawWaveform(tsat, freq) {
            const ctx = document.getElementById('waveChart').getContext('2d');
            if(waveChart) waveChart.destroy();

            const labels = [];
            const ideal = [];
            const sat = [];
            const w = 2 * Math.PI * freq;
            
            for(let t=0; t<0.05; t+=0.0005) { 
                labels.push((t*1000).toFixed(1));
                const sine = Math.sin(w*t);
                ideal.push(sine);
                
                let val = sine;
                if(tsat < 0.01) {
                   const limit = Math.max(0.2, tsat * 50); 
                   if(val > limit) val = limit;
                   if(val < -limit) val = -limit;
                }
                sat.push(val);
            }

            waveChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Ideal Secondary', data: ideal, borderColor: '#9CA3AF', borderWidth: 1, borderDash:[5,5], pointRadius:0 },
                        { label: 'Saturated Output', data: sat, borderColor: '#DC2626', borderWidth: 2, pointRadius:0 }
                    ]
                },
                options: {
                    scales: {
                        x: { title: {display:true, text:'Time (ms)'}, ticks:{maxTicksLimit:10} },
                        y: { title: {display:true, text:'Current (pu)'} }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
    </script>
</body>
</html>
