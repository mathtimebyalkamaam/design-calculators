<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Industrial Spring Design Calculator (Helical Compression) - Pro Edition</title>
<meta name="description" content="A professional, industrial-grade calculator for designing helical compression springs, featuring detailed stress analysis, buckling checks, and fatigue safety factors.">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-23Y1V450SR');
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
MathJax = {
tex: {
inlineMath: [['$', '$'], ['\KATEX_INLINE_OPEN', '\KATEX_INLINE_CLOSE']]
},
svg: {
fontCache: 'global'
}
};
</script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<style>
:root {
--primary-color: #1E3A8A;
--secondary-color: #2563EB;
--accent-color: #F59E0B;
--bg-color: #F8FAFC;
--card-bg: #FFFFFF;
--text-color: #4B5563;
--heading-color: #111827;
--footer-bg: #0F172A;
--border-color: #E2E8F0;
--gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
--gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
--card-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 5px 10px rgba(0, 0, 0, 0.04);
--hover-color: #eef2ff;
--button-hover-shadow: 0 7px 20px rgba(37, 99, 235, 0.4);
--highlight-bg: rgba(245, 158, 11, 0.15);
--success-color: #10B981;
--fail-color: #EF4444;
--warning-color: #F59E0B;
}
body.dark-mode {
--primary-color: #10B981;
--secondary-color: #34D399;
--bg-color: #0F172A;
--card-bg: #1E293B;
--text-color: #CBD5E1;
--heading-color: #F1F5F9;
--footer-bg: #020617;
--border-color: #334155;
--highlight-bg: rgba(16, 185, 129, 0.2);
--hover-color: #334155;
--button-hover-shadow: 0 7px 20px rgba(16, 185, 129, 0.3);
}
html { 
scroll-behavior: smooth;
}
body {
font-family: 'Inter', sans-serif;
background-color: var(--bg-color);
color: var(--text-color);
line-height: 1.8;
transition: background-color 0.3s, color 0.3s;
overflow-x: hidden;
margin: 0;
padding: 0;
}
.container { 
max-width: 1280px; 
margin: 0 auto; 
padding: 0 24px; 
}
.content-container {
max-width: 1100px;
margin: 0 auto;
padding: 20px;
}
.header {
background: var(--gradient-primary);
color: white;
padding: 24px 0;
position: relative;
overflow: hidden;
box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.navbar { 
display: flex; 
justify-content: space-between;
align-items: center; 
}
.logo-container { 
display: flex; 
align-items: center; 
gap: 16px; 
text-decoration: none; 
color: white; 
}
.logo-text {
font-size: 1.75rem;
font-weight: 800;
font-family: 'Montserrat', sans-serif;
}
.theme-toggle { 
display: flex; 
align-items: center; 
gap: 12px;
}
.theme-toggle .icon { 
color: white; 
font-size: 1.2rem; 
}
.switch { 
position: relative; 
display: inline-block; 
width: 56px; 
height: 30px;
}
.switch input { 
opacity: 0; 
width: 0; 
height: 0; 
}
.slider { 
position: absolute; 
cursor: pointer; 
top: 0; 
left: 0;
right: 0; 
bottom: 0; 
background-color: rgba(0,0,0,0.2); 
transition: .4s; 
border-radius: 30px; 
}
.slider:before { 
position: absolute; 
content: ""; 
height: 22px; 
width: 22px;
left: 4px; 
bottom: 4px; 
background-color: white; 
transition: .4s; 
border-radius: 50%; 
}
input:checked + .slider { 
background-color: var(--accent-color);
}
input:checked + .slider:before { 
transform: translateX(26px); 
}
main { 
padding: 40px 0; 
}
.tool-container {
background-color: var(--card-bg);
border-radius: 12px;
padding: 30px;
box-shadow: var(--card-shadow);
margin-bottom: 30px;
}
.tool-container h2 {
color: var(--primary-color);
border-bottom: 3px solid var(--primary-color);
padding-bottom: 15px;
margin-top: 0;
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
}
.intro-section {
background-color: var(--hover-color);
border-radius: 8px;
padding: 25px;
margin-bottom: 30px;
border-left: 5px solid var(--primary-color);
}
.intro-section h3 {
margin-top: 0;
color: var(--primary-color);
font-family: 'Montserrat', sans-serif;
}
.intro-section p {
color: var(--text-color);
}
.back-button {
display: inline-block;
background-color: var(--primary-color);
color: white;
padding: 12px 20px;
border-radius: 5px;
text-decoration: none;
margin-bottom: 25px;
transition: background-color 0.3s, transform 0.2s;
font-weight: 600;
}
.back-button:hover {
background-color: var(--secondary-color);
transform: translateY(-2px);
}
.calculator-form {
background-color: var(--card-bg);
border-radius: 8px;
padding: 25px;
margin-top: 25px;
box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}
.form-section-header {
font-size: 1.2rem;
font-weight: 700;
color: var(--primary-color);
margin-top: 25px;
margin-bottom: 15px;
padding-bottom: 8px;
border-bottom: 2px solid var(--border-color);
}
.form-group {
margin-bottom: 20px;
}
.form-group label {
display: flex;
align-items: center;
margin-bottom: 8px;
font-weight: 600;
color: var(--heading-color);
}
.form-group input, .form-group select {
width: 100%;
padding: 12px;
border: 1px solid var(--border-color);
border-radius: 5px;
background-color: var(--bg-color);
color: var(--text-color);
box-sizing: border-box;
transition: border-color 0.3s, box-shadow 0.3s;
font-size: 1rem;
}
.form-group input:focus, .form-group select:focus {
border-color: var(--primary-color);
box-shadow: 0 0 8px rgba(30, 58, 138, 0.3);
outline: none;
}
.form-row {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
gap: 20px;
}
.calculate-btn {
background: var(--gradient-primary);
color: white;
border: none;
padding: 15px 25px;
border-radius: 8px;
cursor: pointer;
font-size: 1.2rem;
font-weight: 700;
font-family: 'Montserrat', sans-serif;
margin-top: 25px;
transition: transform 0.2s, box-shadow 0.3s;
position: relative;
overflow: hidden;
width: 100%;
}
.calculate-btn:hover {
transform: translateY(-3px);
box-shadow: var(--button-hover-shadow);
}
.calculate-btn .ripple {
position: absolute;
border-radius: 50%;
background-color: rgba(255, 255, 255, 0.7);
animation: ripple-effect 0.6s linear forwards;
transform: scale(0);
pointer-events: none;
}
@keyframes ripple-effect {
to {
transform: scale(4);
opacity: 0;
}
}
.result-container {
margin-top: 40px;
padding: 25px;
border-radius: 12px;
background-color: var(--card-bg);
box-shadow: var(--card-shadow);
display: none;
opacity: 0;
transform: translateY(30px);
transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}
.result-container.show {
display: block;
opacity: 1;
transform: translateY(0);
}
.result-container h3 {
color: var(--primary-color);
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
font-size: 1.8rem;
text-align: center;
}
.calculation-step-container {
margin-bottom: 20px;
border: 1px solid var(--border-color);
border-radius: 8px;
overflow: hidden;
opacity: 0;
animation: fadeInSlideUp 0.5s ease-out forwards;
transition: box-shadow 0.3s;
}
.calculation-step-container:hover {
box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}
.step-header {
background-color: var(--hover-color);
padding: 15px 20px;
font-weight: 700;
font-size: 1.1rem;
color: var(--heading-color);
border-bottom: 1px solid var(--border-color);
display: flex;
justify-content: space-between;
align-items: center;
}
.step-content {
padding: 20px;
display: block;
border-top: 1px solid var(--border-color);
}
.step-content p.formula {
font-family: 'Times New Roman', serif;
font-style: italic;
font-size: 1.1em;
text-align: center;
padding: 12px;
background-color: var(--bg-color);
border: 1px solid var(--border-color);
border-radius: 4px;
margin: 15px 0;
overflow-x: auto;
color: var(--text-color);
}
.step-content p.calculation {
font-family: 'Courier New', monospace;
background-color: var(--bg-color);
padding: 10px 15px;
border-radius: 3px;
margin-bottom: 10px;
color: var(--text-color);
word-wrap: break-word;
border-left: 3px solid var(--secondary-color);
}
.step-content .final-result {
font-weight: 700;
color: var(--primary-color);
background: var(--highlight-bg);
padding: 12px;
border-radius: 4px;
text-align: center;
margin-top: 15px;
font-size: 1.1rem;
}
.final-verdict {
padding: 20px;
border-radius: 8px;
text-align: center;
font-size: 1.5rem;
font-weight: 700;
font-family: 'Montserrat', sans-serif;
margin-top: 20px;
}
.final-verdict.safe {
background-color: var(--success-color);
color: white;
}
.final-verdict.fail {
background-color: var(--fail-color);
color: white;
}
.final-verdict.warning {
background-color: var(--warning-color);
color: white;
}
.recommendations {
margin-top: 30px;
padding: 20px;
border: 2px solid var(--border-color);
border-radius: 8px;
background-color: var(--bg-color);
}
.recommendations h4 {
color: var(--secondary-color);
margin-top: 0;
font-family: 'Montserrat', sans-serif;
}
.recommendations ul {
padding-left: 20px;
}
.recommendations ul li {
margin-bottom: 10px;
}
.info-icon {
color: var(--secondary-color);
margin-left: 8px;
cursor: help;
font-size: 0.9em;
}
.tooltip {
position: relative;
display: inline-block;
}
.tooltip .tooltiptext {
visibility: hidden;
width: 280px;
background-color: #333;
color: #fff;
text-align: center;
border-radius: 6px;
padding: 10px;
position: absolute;
z-index: 10;
bottom: 135%;
left: 50%;
margin-left: -140px;
opacity: 0;
transition: opacity 0.3s;
font-weight: normal;
font-size: 0.9rem;
}
.tooltip:hover .tooltiptext {
visibility: visible;
opacity: 1;
}
#custom-message-box {
position: fixed;
top: 20px;
left: 50%;
transform: translateX(-50%);
padding: 15px 25px;
border-radius: 8px;
box-shadow: 0 4px 10px rgba(0,0,0,0.2);
z-index: 1000;
font-weight: bold;
color: white;
opacity: 0;
visibility: hidden;
transition: opacity 0.5s ease-in-out, visibility 0.5s;
}
#custom-message-box.show {
opacity: 1;
visibility: visible;
}
.summary-table {
width: 100%;
margin: 20px 0;
border-collapse: collapse;
}
.summary-table th,
.summary-table td {
padding: 12px;
text-align: left;
border: 1px solid var(--border-color);
}
.summary-table th {
background-color: var(--hover-color);
font-weight: 600;
color: var(--heading-color);
}
.summary-table td {
background-color: var(--bg-color);
}
.pass-indicator {
display: inline-block;
padding: 4px 12px;
border-radius: 4px;
font-weight: 600;
font-size: 0.9rem;
}
.pass-indicator.pass {
background-color: var(--success-color);
color: white;
}
.pass-indicator.fail {
background-color: var(--fail-color);
color: white;
}
.pass-indicator.warning {
background-color: var(--warning-color);
color: white;
}
@keyframes fadeInSlideUp {
from {
opacity: 0;
transform: translateY(20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
footer { 
background: var(--gradient-dark);
color: #CBD5E1;
padding: 80px 0 30px 0; 
}
.footer-grid { 
display: grid; 
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
gap: 40px; 
}
.footer-col h4 { 
font-size: 1.2rem;
color: white; 
margin-bottom: 1.5rem; 
font-weight: 700;
}
.footer-col ul { list-style: none; padding: 0; }
.footer-col ul li { margin-bottom: 1rem; }
.footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
.footer-col a:hover { color: var(--accent-color); }
.footer-disclaimer {
text-align: center;
margin: 40px auto;
padding-top: 40px;
border-top: 1px solid #334155;
max-width: 800px;
}
.footer-bottom { 
text-align: center; 
padding-top: 20px; 
font-size: 0.9rem; 
color: #94A3B8;
}
.footer-bottom a {
color: #CBD5E1; 
text-decoration: none; 
transition: color 0.3s;
}
.footer-bottom a:hover {
color: var(--accent-color);
text-decoration: underline;
}
.creator-name { 
color: var(--secondary-color); 
font-weight: bold; 
}
@media (max-width: 768px) {
.navbar { 
flex-direction: column;
gap: 24px; 
}
.form-row {
grid-template-columns: 1fr;
}
.container, .content-container {
padding: 15px;
}
.tool-container {
padding: 20px;
}
.tooltip .tooltiptext {
width: 200px;
margin-left: -100px;
}
}
</style>
</head>
<body>

<header class="header">
<div class="container">
<nav class="navbar">
<a href="/" class="logo-container">
<span class="logo-text">⚙ Design Calculators</span>
</a>
<div class="theme-toggle">
<i class="fas fa-sun icon"></i>
<label class="switch">
<input type="checkbox" id="theme-switch">
<span class="slider"></span>
</label>
<i class="fas fa-moon icon"></i>
</div>
</nav>
</div>
</header>

<main class="content-container">
<a class='back-button' href="/indexmech"><i class="fas fa-arrow-left"></i> Back to Tools</a>
<div class="tool-container">
<h2>🔩 Industrial Spring Design Calculator (Helical Compression)</h2>

<div class="intro-section">
<h3>🎯 The Science of Stored Energy</h3>
<p>Helical compression springs are fundamental mechanical components used in countless applications, from ballpoint pens to automotive suspensions. Their function is to store mechanical energy when compressed and release it when the load is removed. Designing a spring is a precise engineering task; it must provide the correct force at specific lengths, endure stress without failing, and fit within the physical constraints of an assembly.</p>
<h3>⚡ Engineering a Reliable Spring</h3>
<p>A successful spring design balances geometry, material properties, and loading conditions. This professional-grade calculator provides a complete analysis, determining not just the spring rate but also critical safety parameters. It calculates shear stress using the <strong>Wahl Correction Factor</strong> for accuracy, checks for the possibility of buckling in long springs, evaluates fatigue life using the <strong>Modified Goodman Criterion</strong>, and includes <strong>set removal</strong> considerations for real-world performance.</p>
</div>

<div class="calculator-form">
<form id="spring-form">

<div class="form-section-header">📐 Material & Geometry</div>
<div class="form-row">
<div class="form-group">
<label for="material-type">Spring Material</label>
<select id="material-type" required>
<option value="A228" selected>Music Wire (ASTM A228) - Premium Quality</option>
<option value="A227">Hard Drawn Wire (ASTM A227) - General Purpose</option>
<option value="A229">Oil Tempered Wire (ASTM A229) - High Stress</option>
<option value="A231">Chrome Vanadium (ASTM A231) - High Temp</option>
<option value="A313">Stainless Steel 302 (ASTM A313) - Corrosion Resistant</option>
<option value="A313-316">Stainless Steel 316 (ASTM A313) - Marine Grade</option>
<option value="Inconel">Inconel X-750 - Extreme Temperature</option>
<option value="Phosphor">Phosphor Bronze - Electrical Applications</option>
</select>
</div>
<div class="form-group">
<label for="wire-diameter">Wire Diameter, d (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The diameter of the spring wire. Typical range: 0.2 - 20 mm</span></span></label>
<input type="number" id="wire-diameter" value="2.5" min="0.1" step="0.01" required>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="outer-diameter">Outer Diameter, D<sub>o</sub> (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The overall outer diameter of the spring coils.</span></span></label>
<input type="number" id="outer-diameter" value="20" min="1" step="0.1" required>
</div>
<div class="form-group">
<label for="end-type">End Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Affects total coils and solid length. Squared & Ground provides the most stable seating surface.</span></span></label>
<select id="end-type" required>
<option value="squared-ground" selected>Squared and Ground (Most Common)</option>
<option value="squared">Squared Only</option>
<option value="plain-ground">Plain and Ground</option>
<option value="plain">Plain Ends</option>
</select>
</div>
</div>

<div class="form-section-header">⚡ Loading & Operational Lengths</div>
<div class="form-row">
<div class="form-group">
<label for="force-1">Force 1, F₁ (N) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The first known operating force on the spring (e.g., minimum load or preload).</span></span></label>
<input type="number" id="force-1" value="50" min="0" step="0.1" required>
</div>
<div class="form-group">
<label for="length-1">Length at Force 1, L₁ (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The compressed length of the spring when Force 1 is applied.</span></span></label>
<input type="number" id="length-1" value="55" min="1" step="0.1" required>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="force-2">Force 2, F₂ (N) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The second known operating force (must be greater than Force 1).</span></span></label>
<input type="number" id="force-2" value="200" min="1" step="0.1" required>
</div>
<div class="form-group">
<label for="length-2">Length at Force 2, L₂ (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The compressed length of the spring when Force 2 is applied (must be less than Length 1).</span></span></label>
<input type="number" id="length-2" value="40" min="1" step="0.1" required>
</div>
</div>

<div class="form-section-header">🔧 Advanced Parameters</div>
<div class="form-row">
<div class="form-group">
<label for="application-type">Application Type</label>
<select id="application-type">
<option value="static" selected>Static Loading (Minimal Cycling)</option>
<option value="average">Average Service (< 10⁴ cycles)</option>
<option value="light">Light Dynamic Service (10⁴ - 10⁵ cycles)</option>
<option value="severe">Severe Cyclic Service (> 10⁵ cycles)</option>
</select>
</div>
<div class="form-group">
<label for="temp">Operating Temperature (°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Temperature affects material properties significantly.</span></span></label>
<input type="number" id="temp" value="20" min="-200" max="800" step="5">
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="surface-condition">Surface Condition</label>
<select id="surface-condition">
<option value="peened" selected>Shot Peened (Highest Fatigue Strength)</option>
<option value="removed">Set Removed (Standard)</option>
<option value="not-removed">As-Manufactured (Not Set Removed)</option>
</select>
</div>
<div class="form-group">
<label for="reliability">Required Reliability <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Higher reliability requires larger safety factors.</span></span></label>
<select id="reliability">
<option value="0.90">90% (General Applications)</option>
<option value="0.95">95% (Important Applications)</option>
<option value="0.99" selected>99% (Critical Applications)</option>
<option value="0.999">99.9% (Safety-Critical)</option>
</select>
</div>
</div>

<button type="button" id="calculate-btn" class="calculate-btn">🔬 Design & Analyze Spring</button>
</form>
</div>
<div id="result-container" class="result-container">
<h3>📊 Complete Spring Design Analysis</h3>
<div id="calculation-steps"></div>
<div class="recommendations">
<h4>📋 Design Summary & Recommendations</h4>
<div id="recommendations-content"></div>
</div>
</div>
</div>
</main>

<footer>
<div class="container">
<div class="footer-grid">
<div class="footer-col">
<h4>⚡ Quick Links</h4>
<ul>
<li><a href="/indexele">Electrical Tools</a></li>
<li><a href="/indexmech">Mechanical Tools</a></li>
<li><a href="/indexinst">Instrumentation Tools</a></li>
<li><a href="blog.html">Blog & Articles</a></li>
</ul>
</div>
<div class="footer-col">
<h4>📜 Legal</h4>
<ul>
<li><a href="/privacy-policy">Privacy Policy</a></li>
<li><a href="/terms-of-service">Terms of Service</a></li>
<li><a href="/sitemap2">Sitemap</a></li>
</ul>
</div>
<div class="footer-col">
<h4>ℹ About</h4>
<ul>
<li><a href="/about">About Us</a></li>
<li><a href="/contact">Contact Us</a></li>
<li><a href="/faq">FAQ</a></li>
</ul>
</div>
</div>
<div class="footer-disclaimer">
<h4>⚠ Professional Disclaimer</h4>
<p>All calculations are based on standard engineering formulas and published material properties. Results are for preliminary design guidance only and should be validated by a qualified professional engineer. Always verify critical spring designs through physical testing and analysis per applicable standards (ASME, DIN, ISO). The calculator assumes ideal conditions and may not account for all real-world factors.</p>
</div>
<div class="footer-bottom">
<p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
</div>
</div>
</footer>

<div id="custom-message-box"></div>

<script>
// ============================================================================
// INDUSTRIAL SPRING DESIGN CALCULATOR - PROFESSIONAL EDITION
// Based on: Shigley's Mechanical Engineering Design, ASME Standards, DIN 2095
// ============================================================================

document.addEventListener('DOMContentLoaded', function() {
const calculateBtn = document.getElementById('calculate-btn');
const resultContainer = document.getElementById('result-container');
const calculationStepsDiv = document.getElementById('calculation-steps');
const recommendationsDiv = document.getElementById('recommendations-content');
    
// ============================================================================
// MATERIAL DATABASE - Industry Standard Properties
// ============================================================================
const materialData = {
'A228': { 
G: 81.7, // Shear Modulus (GPa)
E: 207, // Young's Modulus (GPa)
A: 2211, // Tensile strength coefficient (MPa)
b: -0.145, // Exponent for wire diameter (mm)
name: 'Music Wire (ASTM A228)',
density: 7850, // kg/m³
maxTemp: 120, // °C
Se_percent: 0.50, // Endurance limit ratio
surfaceFactor: 0.85,
reliability: { 0.90: 1.0, 0.95: 0.868, 0.99: 0.814, 0.999: 0.753 }
},
'A227': { 
G: 79.3, 
E: 207,
A: 1783, 
b: -0.190,
name: 'Hard Drawn Wire (ASTM A227)',
density: 7850,
maxTemp: 120,
Se_percent: 0.42,
surfaceFactor: 0.77,
reliability: { 0.90: 1.0, 0.95: 0.868, 0.99: 0.814, 0.999: 0.753 }
},
'A229': { 
G: 79.3, 
E: 207,
A: 1855, 
b: -0.187,
name: 'Oil Tempered Wire (ASTM A229)',
density: 7850,
maxTemp: 180,
Se_percent: 0.45,
surfaceFactor: 0.83,
reliability: { 0.90: 1.0, 0.95: 0.868, 0.99: 0.814, 0.999: 0.753 }
},
'A231': { 
G: 77.2, 
E: 207,
A: 1909, 
b: -0.146,
name: 'Chrome Vanadium (ASTM A231)',
density: 7850,
maxTemp: 220,
Se_percent: 0.47,
surfaceFactor: 0.88,
reliability: { 0.90: 1.0, 0.95: 0.868, 0.99: 0.814, 0.999: 0.753 }
},
'A313': { 
G: 69.0, 
E: 193,
A: 1867, 
b: -0.146,
name: 'Stainless Steel 302 (ASTM A313)',
density: 8000,
maxTemp: 260,
Se_percent: 0.35,
surfaceFactor: 0.50,
reliability: { 0.90: 1.0, 0.95: 0.868, 0.99: 0.814, 0.999: 0.753 }
},
'A313-316': { 
G: 69.0, 
E: 193,
A: 1867, 
b: -0.146,
name: 'Stainless Steel 316 (ASTM A313)',
density: 8000,
maxTemp: 260,
Se_percent: 0.35,
surfaceFactor: 0.50,
reliability: { 0.90: 1.0, 0.95: 0.868, 0.99: 0.814, 0.999: 0.753 }
},
'Inconel': { 
G: 75.8, 
E: 214,
A: 2085, 
b: -0.130,
name: 'Inconel X-750',
density: 8280,
maxTemp: 650,
Se_percent: 0.40,
surfaceFactor: 0.82,
reliability: { 0.90: 1.0, 0.95: 0.868, 0.99: 0.814, 0.999: 0.753 }
},
'Phosphor': { 
G: 41.4, 
E: 110,
A: 913, 
b: -0.064,
name: 'Phosphor Bronze',
density: 8860,
maxTemp: 100,
Se_percent: 0.35,
surfaceFactor: 0.65,
reliability: { 0.90: 1.0, 0.95: 0.868, 0.99: 0.814, 0.999: 0.753 }
}
};

// ============================================================================
// END TYPE COEFFICIENTS
// ============================================================================
const endTypeData = {
'squared-ground': { 
coils: 2, 
name: 'Squared and Ground',
effectiveCoils: 0, // Inactive coils
buckling: 0.5 // End fixity coefficient
},
'squared': { 
coils: 2, 
name: 'Squared',
effectiveCoils: 1,
buckling: 0.707
},
'plain-ground': { 
coils: 1, 
name: 'Plain and Ground',
effectiveCoils: 1,
buckling: 0.707
},
'plain': { 
coils: 0, 
name: 'Plain Ends',
effectiveCoils: 2,
buckling: 1.0
}
};

// ============================================================================
// BUTTON RIPPLE EFFECT
// ============================================================================
calculateBtn.addEventListener('click', (e) => {
const ripple = document.createElement('span');
const rect = calculateBtn.getBoundingClientRect();
const diameter = Math.max(calculateBtn.clientWidth, calculateBtn.clientHeight);
const radius = diameter / 2;
ripple.style.width = ripple.style.height = `${diameter}px`;
ripple.style.left = `${e.clientX - rect.left - radius}px`;
ripple.style.top = `${e.clientY - rect.top - radius}px`;
ripple.classList.add('ripple');
calculateBtn.appendChild(ripple);
ripple.addEventListener('animationend', () => ripple.remove());
        
if (validateInputs()) {
performCalculation();
}
});

// ============================================================================
// INPUT VALIDATION
// ============================================================================
function validateInputs() {
// Check required fields
const requiredInputs = document.querySelectorAll('#spring-form [required]');
for (let input of requiredInputs) {
if (!input.value || input.value === '') {
const label = input.labels[0].textContent.split('(')[0].trim();
displayMessage(`❌ Error: "${label}" is required.`, "error");
input.focus();
return false;
}
}

// Get all input values
const d = parseFloat(document.getElementById('wire-diameter').value);
const Do = parseFloat(document.getElementById('outer-diameter').value);
const F1 = parseFloat(document.getElementById('force-1').value);
const L1 = parseFloat(document.getElementById('length-1').value);
const F2 = parseFloat(document.getElementById('force-2').value);
const L2 = parseFloat(document.getElementById('length-2').value);

// Validation checks
if (isNaN(d) || d <= 0) {
displayMessage('❌ Wire diameter must be a positive number.', 'error');
return false;
}
if (isNaN(Do) || Do <= 0) {
displayMessage('❌ Outer diameter must be a positive number.', 'error');
return false;
}
if (Do <= d) {
displayMessage('❌ Outer diameter must be greater than wire diameter.', 'error');
return false;
}
if ((Do - d) / d < 3) {
displayMessage('⚠️ Warning: Spring index will be less than 3, which is extremely difficult to manufacture.', 'warning');
}
if (F2 <= F1) {
displayMessage('❌ Force 2 must be greater than Force 1.', 'error');
return false;
}
if (L1 <= L2) {
displayMessage('❌ Length 1 must be greater than Length 2 (spring compresses from L1 to L2).', 'error');
return false;
}
if (F1 < 0) {
displayMessage('❌ Force 1 cannot be negative.', 'error');
return false;
}

return true;
}

// ============================================================================
// MAIN CALCULATION ENGINE
// ============================================================================
function performCalculation() {
try {
// Clear previous results
calculationStepsDiv.innerHTML = '';
recommendationsDiv.innerHTML = '';

// Gather inputs
const inputs = {
materialKey: document.getElementById('material-type').value,
d: parseFloat(document.getElementById('wire-diameter').value),
Do: parseFloat(document.getElementById('outer-diameter').value),
endType: document.getElementById('end-type').value,
F1: parseFloat(document.getElementById('force-1').value),
L1: parseFloat(document.getElementById('length-1').value),
F2: parseFloat(document.getElementById('force-2').value),
L2: parseFloat(document.getElementById('length-2').value),
applicationType: document.getElementById('application-type').value,
temp: parseFloat(document.getElementById('temp').value),
surfaceCondition: document.getElementById('surface-condition').value,
reliability: parseFloat(document.getElementById('reliability').value)
};

const material = materialData[inputs.materialKey];
const endType = endTypeData[inputs.endType];

// Initialize results object
let results = {
warnings: [],
failures: [],
passes: []
};

// =====================================================================
// STEP 1: BASIC GEOMETRIC PARAMETERS
// =====================================================================
const D = inputs.Do - inputs.d; // Mean diameter (mm)
const C = D / inputs.d; // Spring index

addCalculationStep(1, '📐 Basic Geometric Parameters', 
`$$D = D_o - d$$
$$C = \\frac{D}{d}$$`,
`Mean Coil Diameter: D = ${inputs.Do} - ${inputs.d} = <strong>${D.toFixed(3)} mm</strong><br>
Spring Index: C = ${D.toFixed(3)} / ${inputs.d} = <strong>${C.toFixed(3)}</strong><br><br>
<em>The spring index C is a critical parameter that affects manufacturability and stress.<br>
Recommended range: 4 ≤ C ≤ 12</em>`,
`D = ${D.toFixed(3)} mm | C = ${C.toFixed(3)}`);

// Check spring index
if (C < 4) {
results.warnings.push('Spring index C < 4: Difficult to manufacture, high forming stresses.');
} else if (C > 12) {
results.warnings.push('Spring index C > 12: Spring may be prone to tangling and buckling.');
} else {
results.passes.push(`Spring index C = ${C.toFixed(2)} is within optimal range (4-12).`);
}

// =====================================================================
// STEP 2: SPRING RATE CALCULATION
// =====================================================================
const k = (inputs.F2 - inputs.F1) / (inputs.L1 - inputs.L2); // N/mm

addCalculationStep(2, '⚡ Spring Rate (Stiffness)', 
`$$k = \\frac{F_2 - F_1}{L_1 - L_2}$$`,
`Spring Rate: k = (${inputs.F2} - ${inputs.F1}) / (${inputs.L1} - ${inputs.L2})<br>
k = ${(inputs.F2 - inputs.F1).toFixed(3)} / ${(inputs.L1 - inputs.L2).toFixed(3)}`,
`k = ${k.toFixed(4)} N/mm`);

// =====================================================================
// STEP 3: TEMPERATURE-CORRECTED MATERIAL PROPERTIES
// =====================================================================
const tempFactor = calculateTemperatureFactor(material, inputs.temp);
const G = material.G * tempFactor.shearModulus; // Temperature-corrected shear modulus (GPa)
const E = material.E * tempFactor.youngsModulus; // Temperature-corrected Young's modulus (GPa)

let tempWarning = '';
if (inputs.temp > material.maxTemp) {
tempWarning = `<br><strong>⚠️ WARNING:</strong> Operating temperature (${inputs.temp}°C) exceeds recommended maximum (${material.maxTemp}°C) for ${material.name}.`;
results.failures.push(`Temperature ${inputs.temp}°C exceeds material limit ${material.maxTemp}°C`);
} else if (inputs.temp < -40) {
tempWarning = `<br><strong>⚠️ WARNING:</strong> Low temperature operation may affect ductility.`;
results.warnings.push(`Low temperature operation (${inputs.temp}°C) - verify material ductility.`);
}

addCalculationStep(3, '🌡️ Temperature-Corrected Material Properties', 
`Temperature effects on modulus: multiplicative factor based on temperature`,
`Material: <strong>${material.name}</strong><br>
Operating Temperature: ${inputs.temp}°C (Max recommended: ${material.maxTemp}°C)<br>
Shear Modulus (G) at ${inputs.temp}°C: ${G.toFixed(2)} GPa (20°C value: ${material.G} GPa)<br>
Young's Modulus (E) at ${inputs.temp}°C: ${E.toFixed(2)} GPa (20°C value: ${material.E} GPa)<br>
Temperature Factor: ${(tempFactor.shearModulus * 100).toFixed(1)}% of room temperature value${tempWarning}`,
`G = ${G.toFixed(2)} GPa | E = ${E.toFixed(2)} GPa`);

// =====================================================================
// STEP 4: NUMBER OF ACTIVE COILS
// =====================================================================
const G_MPa = G * 1000; // Convert GPa to MPa
const Na = (G_MPa * Math.pow(inputs.d, 4)) / (8 * Math.pow(D, 3) * k);
const Nt = Na + endType.coils;

addCalculationStep(4, '🔄 Number of Coils', 
`$$N_a = \\frac{G d^4}{8 D^3 k}$$
$$N_t = N_a + N_{ends}$$`,
`Active Coils: N<sub>a</sub> = (${G_MPa} × ${inputs.d}<sup>4</sup>) / (8 × ${D.toFixed(3)}<sup>3</sup> × ${k.toFixed(4)})<br>
N<sub>a</sub> = ${(G_MPa * Math.pow(inputs.d, 4)).toFixed(2)} / ${(8 * Math.pow(D, 3) * k).toFixed(2)}<br>
N<sub>a</sub> = ${Na.toFixed(3)} coils<br><br>
End Type: <strong>${endType.name}</strong> adds ${endType.coils} coils<br>
Total Coils: N<sub>t</sub> = ${Na.toFixed(3)} + ${endType.coils}`,
`N<sub>a</sub> = ${Na.toFixed(2)} | N<sub>t</sub> = ${Nt.toFixed(2)} coils`);

if (Na < 3) {
results.warnings.push(`Low number of active coils (${Na.toFixed(1)}): Spring rate may be inconsistent.`);
}

// =====================================================================
// STEP 5: FREE LENGTH AND SOLID HEIGHT
// =====================================================================
const y1 = inputs.F1 / k; // Deflection at F1
const L0 = inputs.L1 + y1; // Free length
const Ls = inputs.d * Nt; // Solid height
const y_solid = L0 - Ls; // Maximum deflection to solid
const F_solid = k * y_solid; // Force at solid height

addCalculationStep(5, '📏 Length Analysis', 
`$$L_0 = L_1 + \\frac{F_1}{k}$$
$$L_s = d \\times N_t$$
$$y_{solid} = L_0 - L_s$$
$$F_{solid} = k \\times y_{solid}$$`,
`Deflection at Force 1: y<sub>1</sub> = ${inputs.F1} / ${k.toFixed(4)} = ${y1.toFixed(3)} mm<br>
Free Length: L<sub>0</sub> = ${inputs.L1} + ${y1.toFixed(3)} = <strong>${L0.toFixed(3)} mm</strong><br>
Solid Height: L<sub>s</sub> = ${inputs.d} × ${Nt.toFixed(2)} = <strong>${Ls.toFixed(3)} mm</strong><br>
Maximum Deflection: y<sub>solid</sub> = ${L0.toFixed(3)} - ${Ls.toFixed(3)} = ${y_solid.toFixed(3)} mm<br>
Force at Solid: F<sub>solid</sub> = ${k.toFixed(4)} × ${y_solid.toFixed(3)} = <strong>${F_solid.toFixed(2)} N</strong>`,
`L<sub>0</sub> = ${L0.toFixed(2)} mm | L<sub>s</sub> = ${Ls.toFixed(2)} mm | F<sub>solid</sub> = ${F_solid.toFixed(1)} N`);

// Check clash allowance
const clash_allowance = inputs.L2 - Ls;
if (clash_allowance < 1) {
results.failures.push(`Insufficient clash allowance: ${clash_allowance.toFixed(2)} mm (minimum 1 mm recommended).`);
} else if (clash_allowance < 2) {
results.warnings.push(`Low clash allowance: ${clash_allowance.toFixed(2)} mm (2-3 mm recommended).`);
} else {
results.passes.push(`Clash allowance: ${clash_allowance.toFixed(2)} mm - adequate.`);
}

// =====================================================================
// STEP 6: WAHL CORRECTION FACTOR
// =====================================================================
const Kw = ((4 * C - 1) / (4 * C - 4)) + (0.615 / C);
const Ks = (4 * C + 2) / (4 * C - 3); // Static stress correction (for comparison)

addCalculationStep(6, '🔧 Wahl Correction Factor', 
`$$K_w = \\frac{4C - 1}{4C - 4} + \\frac{0.615}{C}$$`,
`The Wahl factor accounts for stress concentration due to curvature and direct shear.<br><br>
K<sub>w</sub> = (4 × ${C.toFixed(3)} - 1) / (4 × ${C.toFixed(3)} - 4) + 0.615 / ${C.toFixed(3)}<br>
K<sub>w</sub> = ${((4 * C - 1) / (4 * C - 4)).toFixed(4)} + ${(0.615 / C).toFixed(4)}<br>
<br>For reference: K<sub>s</sub> (Bergsträsser) = ${Ks.toFixed(4)}`,
`K<sub>w</sub> = ${Kw.toFixed(4)}`);

// =====================================================================
// STEP 7: SHEAR STRESS ANALYSIS
// =====================================================================
const tau_1 = Kw * (8 * inputs.F1 * D) / (Math.PI * Math.pow(inputs.d, 3)); // Stress at F1 (MPa)
const tau_2 = Kw * (8 * inputs.F2 * D) / (Math.PI * Math.pow(inputs.d, 3)); // Stress at F2 (MPa)
const tau_solid = Kw * (8 * F_solid * D) / (Math.PI * Math.pow(inputs.d, 3)); // Stress at solid (MPa)
const tau_mean = (tau_1 + tau_2) / 2; // Mean stress
const tau_alt = (tau_2 - tau_1) / 2; // Alternating stress

addCalculationStep(7, '📊 Shear Stress Analysis', 
`$$\\tau = K_w \\frac{8 F D}{\\pi d^3}$$`,
`<strong>Stress at Force 1 (F<sub>1</sub> = ${inputs.F1} N):</strong><br>
τ<sub>1</sub> = ${Kw.toFixed(4)} × (8 × ${inputs.F1} × ${D.toFixed(3)}) / (π × ${inputs.d}<sup>3</sup>)<br>
τ<sub>1</sub> = <strong>${tau_1.toFixed(2)} MPa</strong><br><br>

<strong>Stress at Force 2 (F<sub>2</sub> = ${inputs.F2} N):</strong><br>
τ<sub>2</sub> = ${Kw.toFixed(4)} × (8 × ${inputs.F2} × ${D.toFixed(3)}) / (π × ${inputs.d}<sup>3</sup>)<br>
τ<sub>2</sub> = <strong>${tau_2.toFixed(2)} MPa</strong><br><br>

<strong>Stress at Solid Height (F<sub>solid</sub> = ${F_solid.toFixed(2)} N):</strong><br>
τ<sub>solid</sub> = ${Kw.toFixed(4)} × (8 × ${F_solid.toFixed(2)} × ${D.toFixed(3)}) / (π × ${inputs.d}<sup>3</sup>)<br>
τ<sub>solid</sub> = <strong>${tau_solid.toFixed(2)} MPa</strong><br><br>

<strong>For Fatigue Analysis:</strong><br>
Mean Stress: τ<sub>m</sub> = (${tau_1.toFixed(2)} + ${tau_2.toFixed(2)}) / 2 = ${tau_mean.toFixed(2)} MPa<br>
Alternating Stress: τ<sub>a</sub> = (${tau_2.toFixed(2)} - ${tau_1.toFixed(2)}) / 2 = ${tau_alt.toFixed(2)} MPa`,
`τ<sub>1</sub> = ${tau_1.toFixed(1)} MPa | τ<sub>2</sub> = ${tau_2.toFixed(1)} MPa | τ<sub>solid</sub> = ${tau_solid.toFixed(1)} MPa`);

// =====================================================================
// STEP 8: MATERIAL STRENGTH PROPERTIES
// =====================================================================
const Sut = material.A * Math.pow(inputs.d, material.b) * tempFactor.tensileStrength;
const Ssy = 0.577 * Sut; // Shear yield strength (von Mises criterion)
const Ssu = 0.67 * Sut; // Ultimate shear strength

// Set removal - springs are typically compressed to solid height during manufacturing
const setRemovalFactor = inputs.surfaceCondition === 'not-removed' ? 1.0 : 1.15;
const Ssy_corrected = Ssy * setRemovalFactor;

addCalculationStep(8, '💪 Material Strength Properties', 
`$$S_{ut} = A \\cdot d^b \\cdot f_{temp}$$
$$S_{sy} = 0.577 \\cdot S_{ut}$$
$$S_{su} = 0.67 \\cdot S_{ut}$$`,
`<strong>Ultimate Tensile Strength:</strong><br>
S<sub>ut</sub> = ${material.A} × ${inputs.d}<sup>${material.b}</sup> × ${tempFactor.tensileStrength.toFixed(3)}<br>
S<sub>ut</sub> = <strong>${Sut.toFixed(2)} MPa</strong><br><br>

<strong>Torsional Yield Strength (von Mises):</strong><br>
S<sub>sy</sub> = 0.577 × ${Sut.toFixed(2)} = ${Ssy.toFixed(2)} MPa<br>
Surface Condition: <strong>${inputs.surfaceCondition}</strong><br>
Set Removal Factor: ${setRemovalFactor}<br>
S<sub>sy,corrected</sub> = <strong>${Ssy_corrected.toFixed(2)} MPa</strong><br><br>

<strong>Ultimate Shear Strength:</strong><br>
S<sub>su</sub> = 0.67 × ${Sut.toFixed(2)} = <strong>${Ssu.toFixed(2)} MPa</strong>`,
`S<sub>ut</sub> = ${Sut.toFixed(0)} MPa | S<sub>sy</sub> = ${Ssy_corrected.toFixed(0)} MPa`);

// =====================================================================
// STEP 9: STATIC SAFETY FACTORS
// =====================================================================
const FS_1 = Ssy_corrected / tau_1;
const FS_2 = Ssy_corrected / tau_2;
const FS_solid = Ssy_corrected / tau_solid;

// Determine required safety factor based on application
let requiredFS = 1.2; // Minimum for static loading
if (inputs.applicationType === 'severe') requiredFS = 2.0;
else if (inputs.applicationType === 'light') requiredFS = 1.5;
else if (inputs.applicationType === 'average') requiredFS = 1.3;

let fs_status = '';
let fs_class = '';
if (FS_solid < 1.0) {
fs_status = '❌ FAIL - Yielding will occur at solid height';
fs_class = 'fail';
results.failures.push(`Factor of safety at solid height (${FS_solid.toFixed(2)}) < 1.0 - Spring will yield!`);
} else if (FS_solid < requiredFS) {
fs_status = `⚠️ WARNING - Factor of safety below recommended minimum (${requiredFS})`;
fs_class = 'warning';
results.warnings.push(`Factor of safety at solid height (${FS_solid.toFixed(2)}) below recommended (${requiredFS}).`);
} else {
fs_status = '✅ PASS - Adequate safety factor';
fs_class = 'pass';
results.passes.push(`Factor of safety at solid height: ${FS_solid.toFixed(2)} (required: ${requiredFS}).`);
}

addCalculationStep(9, '🛡️ Static Safety Factors', 
`$$FS = \\frac{S_{sy}}{\\tau}$$`,
`<strong>Factor of Safety at Force 1:</strong><br>
FS<sub>1</sub> = ${Ssy_corrected.toFixed(2)} / ${tau_1.toFixed(2)} = <strong>${FS_1.toFixed(2)}</strong><br><br>

<strong>Factor of Safety at Force 2 (Working Load):</strong><br>
FS<sub>2</sub> = ${Ssy_corrected.toFixed(2)} / ${tau_2.toFixed(2)} = <strong>${FS_2.toFixed(2)}</strong><br><br>

<strong>Factor of Safety at Solid Height:</strong><br>
FS<sub>solid</sub> = ${Ssy_corrected.toFixed(2)} / ${tau_solid.toFixed(2)} = <strong>${FS_solid.toFixed(2)}</strong><br><br>

Application Type: <strong>${inputs.applicationType}</strong><br>
Required Minimum FS: <strong>${requiredFS}</strong><br><br>

<span class="pass-indicator ${fs_class}">${fs_status}</span>`,
`FS<sub>solid</sub> = ${FS_solid.toFixed(2)} (Required: ${requiredFS})`);

// =====================================================================
// STEP 10: FATIGUE ANALYSIS (Modified Goodman Criterion)
// =====================================================================
if (inputs.applicationType !== 'static') {
// Calculate endurance limit in shear
const Se_base = material.Se_percent * Ssu; // Base endurance limit
const ka = material.surfaceFactor; // Surface finish factor
let kb = 1.0; // Size factor (conservative for springs)
if (inputs.d > 10) kb = 0.85;
else if (inputs.d > 5) kb = 0.9;
const kc = 1.0; // Load factor (already in shear)
const kd = tempFactor.enduranceLimit; // Temperature factor
const ke = material.reliability[inputs.reliability]; // Reliability factor

// Apply shot peening benefit
let kf = 1.0; // Miscellaneous effects factor
if (inputs.surfaceCondition === 'peened') {
kf = 1.4; // Shot peening can increase fatigue strength by 40%
}

const Se = Se_base * ka * kb * kc * kd * ke * kf;

// Modified Goodman criterion
const Ssa = 1 / ((tau_alt / Se) + (tau_mean / Ssu));
const FS_fatigue = Ssa / tau_alt;

let fatigue_status = '';
let fatigue_class = '';
if (FS_fatigue < 1.0) {
fatigue_status = '❌ FAIL - Fatigue failure expected';
fatigue_class = 'fail';
results.failures.push(`Fatigue factor of safety (${FS_fatigue.toFixed(2)}) < 1.0 - Fatigue failure likely!`);
} else if (FS_fatigue < 1.5) {
fatigue_status = '⚠️ WARNING - Low fatigue safety margin';
fatigue_class = 'warning';
results.warnings.push(`Fatigue factor of safety (${FS_fatigue.toFixed(2)}) is low.`);
} else {
fatigue_status = '✅ PASS - Adequate fatigue life expected';
fatigue_class = 'pass';
results.passes.push(`Fatigue factor of safety: ${FS_fatigue.toFixed(2)}.`);
}

// Estimate fatigue life using Basquin's equation
const fatigueLifeCycles = estimateFatigueLife(tau_alt, tau_mean, Se, Ssu);

addCalculationStep(10, '♾️ Fatigue Life Analysis (Modified Goodman)', 
`$$S_e = S_{e,base} \\cdot k_a \\cdot k_b \\cdot k_c \\cdot k_d \\cdot k_e \\cdot k_f$$
$$\\frac{\\tau_a}{S_e} + \\frac{\\tau_m}{S_{su}} = \\frac{1}{FS_{fatigue}}$$`,
`<strong>Endurance Limit Calculation:</strong><br>
Base Endurance Limit: S<sub>e,base</sub> = ${material.Se_percent} × ${Ssu.toFixed(2)} = ${Se_base.toFixed(2)} MPa<br>
Surface Factor (k<sub>a</sub>): ${ka.toFixed(3)}<br>
Size Factor (k<sub>b</sub>): ${kb.toFixed(3)}<br>
Load Factor (k<sub>c</sub>): ${kc.toFixed(3)}<br>
Temperature Factor (k<sub>d</sub>): ${kd.toFixed(3)}<br>
Reliability Factor (k<sub>e</sub>) for ${(inputs.reliability * 100).toFixed(1)}%: ${ke.toFixed(3)}<br>
Miscellaneous Factor (k<sub>f</sub>) [${inputs.surfaceCondition}]: ${kf.toFixed(3)}<br>
<strong>Corrected Endurance Limit: S<sub>e</sub> = ${Se.toFixed(2)} MPa</strong><br><br>

<strong>Modified Goodman Analysis:</strong><br>
Alternating Stress: τ<sub>a</sub> = ${tau_alt.toFixed(2)} MPa<br>
Mean Stress: τ<sub>m</sub> = ${tau_mean.toFixed(2)} MPa<br>
Ultimate Shear Strength: S<sub>su</sub> = ${Ssu.toFixed(2)} MPa<br><br>

Safe Alternating Stress: S<sub>sa</sub> = 1 / ((${tau_alt.toFixed(2)} / ${Se.toFixed(2)}) + (${tau_mean.toFixed(2)} / ${Ssu.toFixed(2)}))<br>
S<sub>sa</sub> = ${Ssa.toFixed(2)} MPa<br><br>

<strong>Fatigue Factor of Safety:</strong><br>
FS<sub>fatigue</sub> = ${Ssa.toFixed(2)} / ${tau_alt.toFixed(2)} = <strong>${FS_fatigue.toFixed(2)}</strong><br><br>

<strong>Estimated Fatigue Life:</strong> ${fatigueLifeCycles}<br><br>

<span class="pass-indicator ${fatigue_class}">${fatigue_status}</span>`,
`FS<sub>fatigue</sub> = ${FS_fatigue.toFixed(2)} | Life: ${fatigueLifeCycles}`);
}

// =====================================================================
// STEP 11: BUCKLING STABILITY ANALYSIS
// =====================================================================
const slenderness = L0 / D;
const nu = 0.3; // Poisson's ratio for steel
const v = (E * 1000) / (2 * G * 1000 * (1 + nu)); // Should be ~1

// Critical length ratio from standard buckling curves
// Based on end fixity coefficient
let lambda_crit;
if (endType.buckling === 0.5) lambda_crit = 5.26; // Fixed-fixed
else if (endType.buckling === 0.707) lambda_crit = 2.63; // Fixed-hinged
else lambda_crit = 1.05; // Hinged-hinged

// Actual critical buckling length
const Lcrit = lambda_crit * D;
const buckling_ratio = L0 / Lcrit;

let buckling_status = '';
let buckling_class = '';
let buckling_recommendation = '';

if (slenderness > lambda_crit) {
const deflection_at_buckling = (L0 - Lcrit) / slenderness;
if (buckling_ratio > 1.5) {
buckling_status = '❌ CRITICAL - Spring WILL buckle under load';
buckling_class = 'fail';
buckling_recommendation = 'Spring MUST be guided in a hole or over a rod. Consider reducing free length or increasing mean diameter.';
results.failures.push(`Buckling ratio ${buckling_ratio.toFixed(2)} > 1.5 - Spring requires guidance!`);
} else {
buckling_status = '⚠️ WARNING - Spring may buckle under certain conditions';
buckling_class = 'warning';
buckling_recommendation = 'Spring should be guided for reliable operation. Consider design optimization.';
results.warnings.push(`Buckling ratio ${buckling_ratio.toFixed(2)} - guidance recommended.`);
}
} else {
buckling_status = '✅ PASS - Spring is stable against buckling';
buckling_class = 'pass';
buckling_recommendation = 'No guidance required for buckling stability.';
results.passes.push(`Buckling ratio ${buckling_ratio.toFixed(2)} < 1.0 - stable design.`);
}

addCalculationStep(11, '📐 Buckling Stability Analysis', 
`$$\\lambda = \\frac{L_0}{D}$$
$$\\lambda_{crit} = f(end\\ type)$$`,
`<strong>Slenderness Ratio:</strong><br>
λ = L<sub>0</sub> / D = ${L0.toFixed(2)} / ${D.toFixed(3)} = <strong>${slenderness.toFixed(3)}</strong><br><br>

<strong>End Condition:</strong> ${endType.name}<br>
End Fixity Coefficient: α = ${endType.buckling}<br>
Critical Slenderness Ratio: λ<sub>crit</sub> = <strong>${lambda_crit.toFixed(2)}</strong><br>
Critical Length: L<sub>crit</sub> = ${lambda_crit.toFixed(2)} × ${D.toFixed(3)} = <strong>${Lcrit.toFixed(2)} mm</strong><br><br>

<strong>Buckling Ratio:</strong> L<sub>0</sub> / L<sub>crit</sub> = ${L0.toFixed(2)} / ${Lcrit.toFixed(2)} = <strong>${buckling_ratio.toFixed(3)}</strong><br>
(Ratio > 1.0 indicates potential buckling)<br><br>

<span class="pass-indicator ${buckling_class}">${buckling_status}</span><br><br>

<strong>Recommendation:</strong> ${buckling_recommendation}`,
`λ = ${slenderness.toFixed(2)} | λ<sub>crit</sub> = ${lambda_crit.toFixed(2)} | Ratio = ${buckling_ratio.toFixed(2)}`);

// =====================================================================
// STEP 12: NATURAL FREQUENCY & SURGE ANALYSIS
// =====================================================================
const volume = (Math.PI / 4) * Math.pow(inputs.d, 2) * Math.PI * D * Na / 1000; // cm³
const mass = volume * material.density / 1000000; // kg
const freq_fundamental = (1 / (2 * Math.PI)) * Math.sqrt((k * 1000) / mass); // Hz

// Surge frequency (first natural frequency of spring itself)
const freq_surge = (0.5 / Na) * Math.sqrt((G * 1000) / material.density) * (inputs.d / Math.pow(D, 2)) * 1000000; // Hz

let freq_status = '';
let freq_class = '';
if (freq_surge < freq_fundamental * 15) {
freq_status = '⚠️ WARNING - Potential resonance issues';
freq_class = 'warning';
results.warnings.push(`Surge frequency (${freq_surge.toFixed(0)} Hz) may interfere with operating frequency.`);
} else {
freq_status = '✅ PASS - Adequate frequency separation';
freq_class = 'pass';
results.passes.push(`Surge frequency (${freq_surge.toFixed(0)} Hz) is well separated from natural frequency.`);
}

addCalculationStep(12, '🌊 Natural Frequency & Surge Analysis', 
`$$f_n = \\frac{1}{2\\pi} \\sqrt{\\frac{k}{m}}$$
$$f_{surge} \\approx \\frac{0.5}{N_a} \\sqrt{\\frac{G}{\\rho}} \\frac{d}{D^2}$$`,
`<strong>Spring Mass Calculation:</strong><br>
Wire Volume: ${volume.toFixed(4)} cm³<br>
Material Density: ${material.density} kg/m³<br>
Spring Mass: m = <strong>${mass.toFixed(6)} kg</strong><br><br>

<strong>Fundamental Natural Frequency:</strong><br>
f<sub>n</sub> = (1 / 2π) × √(${(k * 1000).toFixed(2)} / ${mass.toFixed(6)})<br>
f<sub>n</sub> = <strong>${freq_fundamental.toFixed(2)} Hz</strong><br><br>

<strong>Surge Frequency (First Mode):</strong><br>
f<sub>surge</sub> = (0.5 / ${Na.toFixed(2)}) × √(${G * 1000} / ${material.density}) × (${inputs.d} / ${D.toFixed(3)}²)<br>
f<sub>surge</sub> = <strong>${freq_surge.toFixed(2)} Hz</strong><br><br>

To avoid resonance, operating frequency should be < f<sub>surge</sub> / 15 = ${(freq_surge / 15).toFixed(2)} Hz<br><br>

<span class="pass-indicator ${freq_class}">${freq_status}</span>`,
`f<sub>n</sub> = ${freq_fundamental.toFixed(1)} Hz | f<sub>surge</sub> = ${freq_surge.toFixed(1)} Hz`);

// =====================================================================
// STEP 13: ENERGY STORAGE CAPACITY
// =====================================================================
const U_max = 0.5 * k * Math.pow(y_solid, 2); // Maximum energy at solid height (N·mm = mJ)
const U_working = 0.5 * k * Math.pow((inputs.L1 - inputs.L2), 2); // Energy in working range

addCalculationStep(13, '⚡ Energy Storage Capacity', 
`$$U = \\frac{1}{2} k y^2$$`,
`<strong>Energy in Working Range:</strong><br>
Deflection: y = ${inputs.L1} - ${inputs.L2} = ${(inputs.L1 - inputs.L2).toFixed(3)} mm<br>
U<sub>working</sub> = 0.5 × ${k.toFixed(4)} × ${Math.pow((inputs.L1 - inputs.L2), 2).toFixed(3)}<br>
U<sub>working</sub> = <strong>${U_working.toFixed(2)} N·mm (mJ)</strong><br><br>

<strong>Maximum Energy Storage (at solid):</strong><br>
Deflection: y<sub>max</sub> = ${y_solid.toFixed(3)} mm<br>
U<sub>max</sub> = 0.5 × ${k.toFixed(4)} × ${Math.pow(y_solid, 2).toFixed(3)}<br>
U<sub>max</sub> = <strong>${U_max.toFixed(2)} N·mm (mJ)</strong><br>
= ${(U_max / 1000).toFixed(4)} J`,
`U<sub>working</sub> = ${U_working.toFixed(1)} mJ | U<sub>max</sub> = ${U_max.toFixed(1)} mJ`);

// =====================================================================
// FINAL DESIGN VERDICT
// =====================================================================
let overall_verdict = '';
let overall_class = '';

if (results.failures.length > 0) {
overall_verdict = '❌ DESIGN FAILS - Critical issues must be resolved';
overall_class = 'fail';
} else if (results.warnings.length > 0) {
overall_verdict = '⚠️ DESIGN ACCEPTABLE WITH WARNINGS - Review recommendations';
overall_class = 'warning';
} else {
overall_verdict = '✅ DESIGN PASSES - All criteria met successfully';
overall_class = 'safe';
}

const verdictDiv = document.createElement('div');
verdictDiv.className = `final-verdict ${overall_class}`;
verdictDiv.innerHTML = `
<div style="font-size: 1.8rem; margin-bottom: 15px;">${overall_verdict}</div>
<div style="font-size: 1rem; font-weight: normal; margin-top: 10px;">
${results.passes.length} checks passed | 
${results.warnings.length} warnings | 
${results.failures.length} failures
</div>
`;
calculationStepsDiv.appendChild(verdictDiv);

// =====================================================================
// DESIGN SUMMARY TABLE
// =====================================================================
const summaryHTML = `
<h4 style="margin-top: 30px; color: var(--primary-color);">📋 Design Summary Table</h4>
<table class="summary-table">
<thead>
<tr>
<th>Parameter</th>
<th>Symbol</th>
<th>Value</th>
<th>Units</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Material</td>
<td>-</td>
<td>${material.name}</td>
<td>-</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Wire Diameter</td>
<td>d</td>
<td>${inputs.d.toFixed(3)}</td>
<td>mm</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Outer Diameter</td>
<td>D<sub>o</sub></td>
<td>${inputs.Do.toFixed(3)}</td>
<td>mm</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Mean Diameter</td>
<td>D</td>
<td>${D.toFixed(3)}</td>
<td>mm</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Spring Index</td>
<td>C</td>
<td>${C.toFixed(3)}</td>
<td>-</td>
<td><span class="pass-indicator ${C >= 4 && C <= 12 ? 'pass' : 'warning'}">${C >= 4 && C <= 12 ? '✓' : '⚠'}</span></td>
</tr>
<tr>
<td>Active Coils</td>
<td>N<sub>a</sub></td>
<td>${Na.toFixed(2)}</td>
<td>coils</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Total Coils</td>
<td>N<sub>t</sub></td>
<td>${Nt.toFixed(2)}</td>
<td>coils</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Spring Rate</td>
<td>k</td>
<td>${k.toFixed(4)}</td>
<td>N/mm</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Free Length</td>
<td>L<sub>0</sub></td>
<td>${L0.toFixed(3)}</td>
<td>mm</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Solid Height</td>
<td>L<sub>s</sub></td>
<td>${Ls.toFixed(3)}</td>
<td>mm</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Force at Solid</td>
<td>F<sub>solid</sub></td>
<td>${F_solid.toFixed(2)}</td>
<td>N</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Max Shear Stress</td>
<td>τ<sub>max</sub></td>
<td>${tau_solid.toFixed(2)}</td>
<td>MPa</td>
<td><span class="pass-indicator ${tau_solid < Ssy_corrected ? 'pass' : 'fail'}">${tau_solid < Ssy_corrected ? '✓' : '✗'}</span></td>
</tr>
<tr>
<td>Yield Strength</td>
<td>S<sub>sy</sub></td>
<td>${Ssy_corrected.toFixed(2)}</td>
<td>MPa</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Safety Factor (Solid)</td>
<td>FS<sub>solid</sub></td>
<td>${FS_solid.toFixed(2)}</td>
<td>-</td>
<td><span class="pass-indicator ${FS_solid >= requiredFS ? 'pass' : (FS_solid >= 1.0 ? 'warning' : 'fail')}">${FS_solid >= requiredFS ? '✓' : (FS_solid >= 1.0 ? '⚠' : '✗')}</span></td>
</tr>
${inputs.applicationType !== 'static' ? `
<tr>
<td>Fatigue Safety Factor</td>
<td>FS<sub>fatigue</sub></td>
<td>${FS_fatigue ? FS_fatigue.toFixed(2) : 'N/A'}</td>
<td>-</td>
<td><span class="pass-indicator ${FS_fatigue >= 1.5 ? 'pass' : (FS_fatigue >= 1.0 ? 'warning' : 'fail')}">${FS_fatigue >= 1.5 ? '✓' : (FS_fatigue >= 1.0 ? '⚠' : '✗')}</span></td>
</tr>
` : ''}
<tr>
<td>Buckling Ratio</td>
<td>L<sub>0</sub>/L<sub>crit</sub></td>
<td>${buckling_ratio.toFixed(3)}</td>
<td>-</td>
<td><span class="pass-indicator ${buckling_ratio < 1.0 ? 'pass' : (buckling_ratio < 1.5 ? 'warning' : 'fail')}">${buckling_ratio < 1.0 ? '✓' : (buckling_ratio < 1.5 ? '⚠' : '✗')}</span></td>
</tr>
<tr>
<td>Natural Frequency</td>
<td>f<sub>n</sub></td>
<td>${freq_fundamental.toFixed(2)}</td>
<td>Hz</td>
<td><span class="pass-indicator pass">✓</span></td>
</tr>
<tr>
<td>Surge Frequency</td>
<td>f<sub>surge</sub></td>
<td>${freq_surge.toFixed(2)}</td>
<td>Hz</td>
<td><span class="pass-indicator ${freq_surge > freq_fundamental * 15 ? 'pass' : 'warning'}">${freq_surge > freq_fundamental * 15 ? '✓' : '⚠'}</span></td>
</tr>
</tbody>
</table>
`;

const summaryDiv = document.createElement('div');
summaryDiv.innerHTML = summaryHTML;
calculationStepsDiv.appendChild(summaryDiv);

// =====================================================================
// RECOMMENDATIONS
// =====================================================================
let recommendationsHTML = '<ul>';

// Add all passes
if (results.passes.length > 0) {
recommendationsHTML += '<li><strong style="color: var(--success-color);">✅ Successful Checks:</strong><ul>';
results.passes.forEach(pass => {
recommendationsHTML += `<li>${pass}</li>`;
});
recommendationsHTML += '</ul></li>';
}

// Add all warnings
if (results.warnings.length > 0) {
recommendationsHTML += '<li><strong style="color: var(--warning-color);">⚠️ Warnings (Review Recommended):</strong><ul>';
results.warnings.forEach(warning => {
recommendationsHTML += `<li>${warning}</li>`;
});
recommendationsHTML += '</ul></li>';
}

// Add all failures
if (results.failures.length > 0) {
recommendationsHTML += '<li><strong style="color: var(--fail-color);">❌ Critical Issues (Must Fix):</strong><ul>';
results.failures.forEach(failure => {
recommendationsHTML += `<li>${failure}</li>`;
});
recommendationsHTML += '</ul></li>';
}

// General recommendations
recommendationsHTML += `
<li><strong>📐 Manufacturing Tolerances:</strong>
<ul>
<li>Wire diameter tolerance: ±${(inputs.d * 0.02).toFixed(3)} mm (±2%)</li>
<li>Spring rate tolerance: ±${(k * 0.10).toFixed(4)} N/mm (±10%)</li>
<li>Free length tolerance: ±${(L0 * 0.015).toFixed(2)} mm (±1.5%)</li>
</ul>
</li>
<li><strong>📋 Applicable Standards:</strong>
<ul>
<li>DIN 2095 - Helical Compression Springs (Quality Requirements)</li>
<li>ASME B18.29.1 - Helical Springs: Compression & Extension</li>
<li>ISO 2162 - Technical Product Documentation - Springs</li>
<li>SAE HS 795 - Aerospace Springs</li>
</ul>
</li>
<li><strong>🔧 Installation Guidelines:</strong>
<ul>
<li>Clash allowance between L₂ and L<sub>s</sub>: ${clash_allowance.toFixed(2)} mm</li>
<li>Maximum recommended deflection: ${(y_solid * 0.8).toFixed(2)} mm (80% of solid)</li>
<li>Preload force (F₁): ${inputs.F1} N at length ${inputs.L1} mm</li>
${buckling_ratio > 1.0 ? `<li><strong>⚠️ Spring requires guidance:</strong> Install over a rod (ID = ${(inputs.Do + 1).toFixed(1)} mm min.) or in a hole (OD = ${(inputs.Do - inputs.d - 1).toFixed(1)} mm max.)</li>` : ''}
</ul>
</li>
<li><strong>🎯 Optimization Suggestions:</strong>
<ul>
${C < 4 ? '<li>Increase mean diameter or decrease wire diameter to improve spring index.</li>' : ''}
${C > 12 ? '<li>Decrease mean diameter or increase wire diameter to improve spring index.</li>' : ''}
${FS_solid < requiredFS ? '<li>Consider increasing wire diameter, changing material, or reducing operating force.</li>' : ''}
${buckling_ratio > 1.0 ? '<li>Reduce free length, increase mean diameter, or change end type to improve buckling stability.</li>' : ''}
${inputs.applicationType !== 'static' && FS_fatigue < 1.5 ? '<li>Consider shot peening, set removal, or reducing stress range to improve fatigue life.</li>' : ''}
</ul>
</li>
<li><strong>🔬 Testing Recommendations:</strong>
<ul>
<li>Verify spring rate by load testing at 3 points between F₁ and F₂</li>
<li>Measure solid height under compression</li>
<li>Verify free length after set removal (if applicable)</li>
${inputs.applicationType !== 'static' ? '<li>Perform fatigue testing for critical applications (minimum 10,000 cycles)</li>' : ''}
<li>Check for squareness: deviation should not exceed ${(D * 0.02).toFixed(2)} mm</li>
</ul>
</li>
`;

recommendationsHTML += '</ul>';
recommendationsDiv.innerHTML = recommendationsHTML;

// Typeset MathJax and show results
if (window.MathJax) {
MathJax.typesetPromise([calculationStepsDiv]).catch((err) => console.error('MathJax error:', err));
}
        
resultContainer.classList.add('show');
setTimeout(() => {
resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
}, 300);

} catch (error) {
console.error('Calculation error:', error);
displayMessage(`Calculation error: ${error.message}. Please check your inputs and try again.`, 'error');
}
}

// ============================================================================
// HELPER FUNCTION: TEMPERATURE CORRECTION FACTOR
// ============================================================================
function calculateTemperatureFactor(material, temp) {
const T = temp + 273.15; // Convert to Kelvin
const T0 = 293.15; // Room temperature (20°C)
    
let shearModulus = 1.0;
let youngsModulus = 1.0;
let tensileStrength = 1.0;
let enduranceLimit = 1.0;
    
if (temp > 20) {
// High temperature degradation
const tempRise = temp - 20;
        
if (material.name.includes('Inconel')) {
// Inconel maintains strength better at high temp
shearModulus = 1.0 - (tempRise * 0.0002);
tensileStrength = 1.0 - (tempRise * 0.0003);
enduranceLimit = 1.0 - (tempRise * 0.0004);
} else if (material.name.includes('Stainless')) {
shearModulus = 1.0 - (tempRise * 0.0003);
tensileStrength = 1.0 - (tempRise * 0.0005);
enduranceLimit = 1.0 - (tempRise * 0.0007);
} else {
// Carbon steel alloys
shearModulus = 1.0 - (tempRise * 0.0004);
tensileStrength = 1.0 - (tempRise * 0.0008);
enduranceLimit = 1.0 - (tempRise * 0.001);
}
} else if (temp < 20) {
// Low temperature - slight increase in strength but reduced ductility
const tempDrop = 20 - temp;
shearModulus = 1.0 + (tempDrop * 0.0001);
tensileStrength = 1.0 + (tempDrop * 0.0002);
enduranceLimit = 1.0; // Conservative - no benefit for fatigue
}
    
// Ensure factors don't go negative or exceed reasonable bounds
shearModulus = Math.max(0.3, Math.min(1.1, shearModulus));
youngsModulus = shearModulus; // Approximate
tensileStrength = Math.max(0.3, Math.min(1.1, tensileStrength));
enduranceLimit = Math.max(0.3, Math.min(1.0, enduranceLimit));
    
return {
shearModulus,
youngsModulus,
tensileStrength,
enduranceLimit
};
}

// ============================================================================
// HELPER FUNCTION: ESTIMATE FATIGUE LIFE
// ============================================================================
function estimateFatigueLife(tau_alt, tau_mean, Se, Ssu) {
// Using Basquin's equation: Nf = (Sf / tau_alt)^(1/b)
// where b is the fatigue strength exponent (typically -0.1 to -0.15 for springs)
    
const b = -0.12; // Typical for spring steels
    
// Goodman correction for mean stress effect
const tau_eq = tau_alt / (1 - (tau_mean / Ssu));
    
if (tau_eq >= Se) {
return 'Limited life (< 10³ cycles)';
}
    
const Nf = Math.pow((Se / tau_eq), (1 / b));
    
if (Nf >= 1e9) return '> 10⁹ cycles (Infinite life)';
else if (Nf >= 1e6) return `${(Nf / 1e6).toFixed(1)} × 10⁶ cycles`;
else if (Nf >= 1e3) return `${(Nf / 1e3).toFixed(1)} × 10³ cycles`;
else return `${Nf.toFixed(0)} cycles (Low cycle fatigue)`;
}

// ============================================================================
// HELPER FUNCTION: ADD CALCULATION STEP
// ============================================================================
function addCalculationStep(step, title, formula, calculation, result) {
const stepContainer = document.createElement('div');
stepContainer.className = 'calculation-step-container';
stepContainer.style.animationDelay = `${step * 0.1}s`;
    
let content = `
<div class="step-header">
<span><strong>Step ${step}:</strong> ${title}</span>
</div>
<div class="step-content">
`;
    
if (formula) {
content += `<p class="formula">${formula}</p>`;
}
    
if (calculation) {
content += `<div style="margin: 15px 0;">${calculation}</div>`;
}
    
if (result) {
content += `<p class="final-result"><strong>Result:</strong> ${result}</p>`;
}
    
content += `</div>`;
stepContainer.innerHTML = content;
calculationStepsDiv.appendChild(stepContainer);
}

// ============================================================================
// HELPER FUNCTION: DISPLAY MESSAGE
// ============================================================================
function displayMessage(message, type = "error") {
const messageBox = document.getElementById('custom-message-box');
messageBox.textContent = message;
messageBox.className = 'show';
    
if (type === "error") {
messageBox.style.backgroundColor = 'var(--fail-color)';
messageBox.style.color = 'white';
} else if (type === "warning") {
messageBox.style.backgroundColor = 'var(--warning-color)';
messageBox.style.color = 'white';
} else {
messageBox.style.backgroundColor = 'var(--success-color)';
messageBox.style.color = 'white';
}
    
setTimeout(() => {
messageBox.classList.remove('show');
}, 5000);
}
});

// ============================================================================
// THEME TOGGLE
// ============================================================================
document.addEventListener('DOMContentLoaded', () => {
const themeSwitch = document.getElementById('theme-switch');
const body = document.body;
const currentTheme = localStorage.getItem('theme');
    
if (currentTheme === 'dark-mode') {
body.classList.add('dark-mode');
themeSwitch.checked = true;
}
    
themeSwitch.addEventListener('change', () => {
if (themeSwitch.checked) {
body.classList.add('dark-mode');
localStorage.setItem('theme', 'dark-mode');
} else {
body.classList.remove('dark-mode');
localStorage.setItem('theme', 'light-mode');
}
});
});
</script>
</body>
</html>
