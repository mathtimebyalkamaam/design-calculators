<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Industrial Spring Design Calculator (Helical Compression) - Pro Edition</title>
<meta name="description" content="A professional, industrial-grade calculator for designing helical compression springs, featuring detailed stress analysis, buckling checks, and fatigue safety factors.">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
<script async src="https://www.googlesyndication.com/pagead/js/adsbygoogle.js?id=G-23Y1V450SR"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-23Y1V450SR');
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
// IMPORTANT: MathJax configuration MUST come BEFORE the script that loads MathJax.
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\KATEX_INLINE_OPEN', '\KATEX_INLINE_CLOSE']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<style>
:root {
--primary-color: #1E3A8A; /* Professional Dark Blue */
--secondary-color: #2563EB; /* Bright Blue */
--accent-color: #F59E0B; /* Warm Amber */
--bg-color: #F8FAFC;
--card-bg: #FFFFFF;
--text-color: #4B5563;
--heading-color: #111827;
--footer-bg: #0F172A;
--border-color: #E2E8F0;
--gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
--gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
--card-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 5px 10px rgba(0, 0, 0, 0.04);
--hover-color: #eef2ff;
--button-hover-shadow: 0 7px 20px rgba(37, 99, 235, 0.4);
--highlight-bg: rgba(245, 158, 11, 0.15);
--success-color: #10B981;
--fail-color: #EF4444;
--warning-color: #F59E0B;
}
body.dark-mode {
--primary-color: #10B981;
--secondary-color: #34D399;
--bg-color: #0F172A;
--card-bg: #1E293B;
--text-color: #CBD5E1;
--heading-color: #F1F5F9;
--footer-bg: #020617;
--border-color: #334155;
--highlight-bg: rgba(16, 185, 129, 0.2);
--hover-color: #334155;
--button-hover-shadow: 0 7px 20px rgba(16, 185, 129, 0.3);
}
html { 
scroll-behavior: smooth;
}
body {
font-family: 'Inter', sans-serif;
background-color: var(--bg-color);
color: var(--text-color);
line-height: 1.8;
transition: background-color 0.3s, color 0.3s;
overflow-x: hidden;
margin: 0;
padding: 0;
}
.container { 
max-width: 1280px; 
margin: 0 auto; 
padding: 0 24px; 
}
.content-container {
max-width: 1100px;
margin: 0 auto;
padding: 20px;
}
.header {
background: var(--gradient-primary);
color: white;
padding: 24px 0;
position: relative;
overflow: hidden;
box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.navbar { 
display: flex; 
justify-content: space-between;
align-items: center; 
}
.logo-container { 
display: flex; 
align-items: center; 
gap: 16px; 
text-decoration: none; 
color: white; 
}
.logo-text {
font-size: 1.75rem;
font-weight: 800;
font-family: 'Montserrat', sans-serif;
}
.theme-toggle { 
display: flex; 
align-items: center; 
gap: 12px;
}
.theme-toggle .icon { 
color: white; 
font-size: 1.2rem; 
}
.switch { 
position: relative; 
display: inline-block; 
width: 56px; 
height: 30px;
}
.switch input { 
opacity: 0; 
width: 0; 
height: 0; 
}
.slider { 
position: absolute; 
cursor: pointer; 
top: 0; 
left: 0;
right: 0; 
bottom: 0; 
background-color: rgba(0,0,0,0.2); 
transition: .4s; 
border-radius: 30px; 
}
.slider:before { 
position: absolute; 
content: ""; 
height: 22px; 
width: 22px;
left: 4px; 
bottom: 4px; 
background-color: white; 
transition: .4s; 
border-radius: 50%; 
}
input:checked + .slider { 
background-color: var(--accent-color);
}
input:checked + .slider:before { 
transform: translateX(26px); 
}
main { 
padding: 40px 0; 
}
.tool-container {
background-color: var(--card-bg);
border-radius: 12px;
padding: 30px;
box-shadow: var(--card-shadow);
margin-bottom: 30px;
}
.tool-container h2 {
color: var(--primary-color);
border-bottom: 3px solid var(--primary-color);
padding-bottom: 15px;
margin-top: 0;
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
}
.intro-section {
    background-color: var(--hover-color);
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 30px;
    border-left: 5px solid var(--primary-color);
}
.intro-section h3 {
    margin-top: 0;
    color: var(--primary-color);
    font-family: 'Montserrat', sans-serif;
}
.intro-section p {
    color: var(--text-color);
}
.back-button {
display: inline-block;
background-color: var(--primary-color);
color: white;
padding: 12px 20px;
border-radius: 5px;
text-decoration: none;
margin-bottom: 25px;
transition: background-color 0.3s, transform 0.2s;
font-weight: 600;
}
.back-button:hover {
background-color: var(--secondary-color);
transform: translateY(-2px);
}
.calculator-form {
background-color: var(--card-bg);
border-radius: 8px;
padding: 25px;
margin-top: 25px;
box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}
.form-section-header {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-top: 25px;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--border-color);
}
.form-group {
margin-bottom: 20px;
}
.form-group label {
display: flex;
align-items: center;
margin-bottom: 8px;
font-weight: 600;
color: var(--heading-color);
}
.form-group input, .form-group select {
width: 100%;
padding: 12px;
border: 1px solid var(--border-color);
border-radius: 5px;
background-color: var(--bg-color);
color: var(--text-color);
box-sizing: border-box;
transition: border-color 0.3s, box-shadow 0.3s;
font-size: 1rem;
}
.form-group input:focus, .form-group select:focus {
border-color: var(--primary-color);
box-shadow: 0 0 8px rgba(30, 58, 138, 0.3);
outline: none;
}
.form-row {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
gap: 20px;
}
.calculate-btn {
background: var(--gradient-primary);
color: white;
border: none;
padding: 15px 25px;
border-radius: 8px;
cursor: pointer;
font-size: 1.2rem;
font-weight: 700;
font-family: 'Montserrat', sans-serif;
margin-top: 25px;
transition: transform 0.2s, box-shadow 0.3s;
position: relative;
overflow: hidden;
width: 100%;
}
.calculate-btn:hover {
transform: translateY(-3px);
box-shadow: var(--button-hover-shadow);
}
.calculate-btn .ripple {
position: absolute;
border-radius: 50%;
background-color: rgba(255, 255, 255, 0.7);
animation: ripple-effect 0.6s linear forwards;
transform: scale(0);
pointer-events: none;
}
@keyframes ripple-effect {
to {
transform: scale(4);
opacity: 0;
}
}
.result-container {
margin-top: 40px;
padding: 25px;
border-radius: 12px;
background-color: var(--card-bg);
box-shadow: var(--card-shadow);
display: none;
opacity: 0;
transform: translateY(30px);
transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}
.result-container.show {
display: block;
opacity: 1;
transform: translateY(0);
}
.result-container h3 {
color: var(--primary-color);
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
font-size: 1.8rem;
text-align: center;
}
.calculation-step-container {
margin-bottom: 20px;
border: 1px solid var(--border-color);
border-radius: 8px;
overflow: hidden;
opacity: 0;
animation: fadeInSlideUp 0.5s ease-out forwards;
transition: box-shadow 0.3s;
}
.calculation-step-container:hover {
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}
.step-header {
background-color: var(--hover-color);
padding: 15px 20px;
font-weight: 700;
font-size: 1.1rem;
color: var(--heading-color);
border-bottom: 1px solid var(--border-color);
display: flex;
justify-content: space-between;
align-items: center;
}
.step-content {
padding: 20px;
display: block;
border-top: 1px solid var(--border-color);
}
.step-content p.formula {
font-family: 'Times New Roman', serif;
font-style: italic;
font-size: 1.1em;
text-align: center;
padding: 15px;
background-color: var(--bg-color);
border: 1px solid var(--border-color);
border-radius: 4px;
margin: 15px 0;
overflow-x: auto;
color: var(--text-color);
}
.step-content p.calculation {
font-family: 'Courier New', monospace;
background-color: var(--bg-color);
padding: 12px 15px;
border-radius: 3px;
margin-bottom: 10px;
color: var(--text-color);
word-wrap: break-word;
border-left: 3px solid var(--secondary-color);
line-height: 1.8;
}
.step-content .final-result {
font-weight: 700;
color: var(--primary-color);
background: var(--highlight-bg);
padding: 15px;
border-radius: 4px;
text-align: center;
margin-top: 15px;
font-size: 1.2rem;
}
.final-verdict {
    padding: 25px;
    border-radius: 8px;
    text-align: center;
    font-size: 1.5rem;
    font-weight: 700;
    font-family: 'Montserrat', sans-serif;
    margin-top: 25px;
    animation: fadeInSlideUp 0.5s ease-out forwards;
}
.final-verdict.safe {
    background-color: var(--success-color);
    color: white;
}
.final-verdict.fail {
    background-color: var(--fail-color);
    color: white;
}
.final-verdict.warning {
    background-color: var(--warning-color);
    color: white;
}
.recommendations {
margin-top: 30px;
padding: 20px;
border: 2px solid var(--border-color);
border-radius: 8px;
background-color: var(--bg-color);
}
.recommendations h4 {
color: var(--secondary-color);
margin-top: 0;
font-family: 'Montserrat', sans-serif;
}
.recommendations ul {
padding-left: 20px;
}
.recommendations ul li {
margin-bottom: 12px;
line-height: 1.6;
}
.info-icon {
color: var(--secondary-color);
margin-left: 8px;
cursor: help;
font-size: 0.9em;
}
.tooltip {
position: relative;
display: inline-block;
}
.tooltip .tooltiptext {
visibility: hidden;
width: 280px;
background-color: #333;
color: #fff;
text-align: center;
border-radius: 6px;
padding: 10px;
position: absolute;
z-index: 10;
bottom: 135%;
left: 50%;
margin-left: -140px;
opacity: 0;
transition: opacity 0.3s;
font-weight: normal;
font-size: 0.9rem;
}
.tooltip:hover .tooltiptext {
visibility: visible;
opacity: 1;
}
#custom-message-box {
position: fixed;
top: 20px;
left: 50%;
transform: translateX(-50%);
padding: 15px 25px;
border-radius: 8px;
box-shadow: 0 4px 10px rgba(0,0,0,0.2);
z-index: 1000;
font-weight: bold;
color: white;
opacity: 0;
visibility: hidden;
transition: opacity 0.5s ease-in-out, visibility 0.5s;
}
#custom-message-box.show {
    opacity: 1;
    visibility: visible;
}
@keyframes fadeInSlideUp {
from {
opacity: 0;
transform: translateY(20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
footer { 
background: var(--gradient-dark);
color: #CBD5E1;
padding: 80px 0 30px 0; 
}
.footer-grid { 
display: grid; 
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
gap: 40px; 
}
.footer-col h4 { 
font-size: 1.2rem;
color: white; 
margin-bottom: 1.5rem; 
font-weight: 700;
}
.footer-col ul { list-style: none; padding: 0; }
.footer-col ul li { margin-bottom: 1rem; }
.footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
.footer-col a:hover { color: var(--accent-color); }
.footer-disclaimer {
text-align: center;
margin: 40px auto;
padding-top: 40px;
border-top: 1px solid #334155;
max-width: 800px;
}
.footer-bottom { 
text-align: center; 
padding-top: 20px; 
font-size: 0.9rem; 
color: #94A3B8;
}
.footer-bottom a {
color: #CBD5E1; 
text-decoration: none; 
transition: color 0.3s;
}
.footer-bottom a:hover {
color: var(--accent-color);
text-decoration: underline;
}
.creator-name { 
color: var(--secondary-color); 
font-weight: bold; 
}
@media (max-width: 768px) {
.navbar { 
flex-direction: column;
gap: 24px; 
}
.form-row {
grid-template-columns: 1fr;
}
.container, .content-container {
padding: 15px;
}
.tool-container {
padding: 20px;
}
}
</style>
</head>
<body>

<header class="header">
<div class="container">
<nav class="navbar">
<a href="/" class="logo-container">
<span class="logo-text"> Design Calculators </span>
</a>
<div class="theme-toggle">
<i class="fas fa-sun icon"></i>
<label class="switch">
<input type="checkbox" id="theme-switch">
<span class="slider"></span>
</label>
<i class="fas fa-moon icon"></i>
</div>
</nav>
</div>
</header>

<main class="content-container">
<a class='back-button' href="/indexmech"><i class="fas fa-arrow-left"></i> Back to Tools</a>
<div class="tool-container">
<h2>Industrial Spring Design Calculator (Helical Compression)</h2>

<div class="intro-section">
    <h3>The Science of Stored Energy</h3>
    <p>Helical compression springs are fundamental mechanical components used in countless applications, from ballpoint pens to automotive suspensions. Their function is to store mechanical energy when compressed and release it when the load is removed. Designing a spring is a precise engineering task; it must provide the correct force at specific lengths, endure stress without failing, and fit within the physical constraints of an assembly.</p>
    <h3>Engineering a Reliable Spring</h3>
    <p>A successful spring design balances geometry, material properties, and loading conditions. This professional-grade calculator provides a complete analysis, determining not just the spring rate but also critical safety parameters. It calculates shear stress using the **Wahl Correction Factor** for accuracy, checks for the possibility of buckling in long springs, and evaluates the design against material strength limits to ensure reliability and a long service life.</p>
</div>

<div class="calculator-form">
<form id="spring-form">

<div class="form-section-header">Material & Geometry</div>
<div class="form-row">
    <div class="form-group">
        <label for="material-type">Spring Material</label>
        <select id="material-type" required>
            <option value="A228" selected>Music Wire (ASTM A228)</option>
            <option value="A227">Hard Drawn (ASTM A227)</option>
            <option value="A229">Oil Tempered (ASTM A229)</option>
            <option value="A231">Chrome Vanadium (ASTM A231)</option>
            <option value="A313">Stainless Steel 302 (ASTM A313)</option>
        </select>
    </div>
    <div class="form-group">
        <label for="wire-diameter">Wire Diameter, d (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The diameter of the spring wire.</span></span></label>
        <input type="number" id="wire-diameter" value="2.5" min="0.1" step="0.1" required>
    </div>
</div>
<div class="form-row">
    <div class="form-group">
        <label for="outer-diameter">Outer Diameter, D<sub>o</sub> (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The overall outer diameter of the spring coils.</span></span></label>
        <input type="number" id="outer-diameter" value="20" min="1" step="0.5" required>
    </div>
    <div class="form-group">
        <label for="end-type">End Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Affects total coils and solid length. Squared & Ground provides the most stable seating surface.</span></span></label>
        <select id="end-type" required>
            <option value="squared-ground" selected>Squared and Ground</option>
            <option value="squared">Squared Only</option>
            <option value="plain-ground">Plain and Ground</option>
            <option value="plain">Plain Ends</option>
        </select>
    </div>
</div>

<div class="form-section-header">Loading & Operational Lengths</div>
<div class="form-row">
    <div class="form-group">
        <label for="force-1">Force 1, F₁ (N) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The first known operating force on the spring (e.g., preload).</span></span></label>
        <input type="number" id="force-1" value="30" min="0" step="5" required>
    </div>
    <div class="form-group">
        <label for="length-1">Length at Force 1, L₁ (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The compressed length of the spring when Force 1 is applied.</span></span></label>
        <input type="number" id="length-1" value="55" min="1" step="1" required>
    </div>
</div>
<div class="form-row">
    <div class="form-group">
        <label for="force-2">Force 2, F₂ (N) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The second known operating force (must be greater than Force 1).</span></span></label>
        <input type="number" id="force-2" value="120" min="1" step="5" required>
    </div>
    <div class="form-group">
        <label for="length-2">Length at Force 2, L₂ (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The compressed length of the spring when Force 2 is applied (must be less than Length 1).</span></span></label>
        <input type="number" id="length-2" value="40" min="1" step="1" required>
    </div>
</div>

<button type="button" id="calculate-btn" class="calculate-btn">Design & Analyze Spring</button>
</form>
</div>
<div id="result-container" class="result-container">
<h3>Spring Design Step-by-Step Analysis</h3>
<div id="calculation-steps">
<!-- Calculation steps will be dynamically inserted here -->
</div>
<div class="recommendations">
<h4>Applicable Standards & Recommendations</h4>
<div id="recommendations-content">
<!-- Recommendations will be dynamically inserted here -->
</div>
</div>
</div>
</div>
</main>

<footer>
<div class="container">
<div class="footer-grid">
<div class="footer-col">
<h4> Quick Links </h4>
<ul>
<li><a href="/indexele"> Electrical Tools </a></li>
<li><a href="/indexmech"> Mechanical Tools </a></li>
<li><a href="/indexinst"> Instrumentation Tools </a></li>
<li><a href="blog.html"> Blog & Articles </a></li>
</ul>
</div>
<div class="footer-col">
<h4> Legal </h4>
<ul>
<li><a href="/privacy-policy"> Privacy Policy </a></li>
<li><a href="/terms-of-service"> Terms of Service </a></li>
<li><a href="/sitemap2"> Sitemap </a></li>
</ul>
</div>
<div class="footer-col">
<h4> About </h4>
<ul>
<li><a href="/about"> About Us </a></li>
<li><a href="/contact"> Contact Us </a></li>
<li><a href="/faq"> FAQ </a></li>
</ul>
</div>
</div>
<div class="footer-disclaimer">
<h4> Disclaimer </h4>
<p> All tools are for guidance only and should not replace professional engineering judgment. Results must be verified by a qualified professional against project requirements and local codes. </p>
</div>
<div class="footer-bottom">
<p> &copy; 2025 Design Calculators. Created by <span class="creator-name"> A Sharma </span> . All rights reserved. </p>
</div>
</div>
</footer>

<div id="custom-message-box"></div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const calculateBtn = document.getElementById('calculate-btn');
    const resultContainer = document.getElementById('result-container');
    const calculationStepsDiv = document.getElementById('calculation-steps');
    const recommendationsDiv = document.getElementById('recommendations-content');
    
    // Spring Material Data: G (Shear Modulus, GPa), A & b for Sut = A * d^b (d in mm, Sut in MPa)
    const materialData = {
        'A228': { G: 81.7, A: 2211, b: -0.145, name: 'Music Wire (ASTM A228)' },
        'A227': { G: 79.3, A: 1783, b: -0.190, name: 'Hard Drawn (ASTM A227)' },
        'A229': { G: 79.3, A: 1867, b: -0.148, name: 'Oil Tempered (ASTM A229)' },
        'A231': { G: 77.2, A: 1831, b: -0.143, name: 'Chrome Vanadium (ASTM A231)' },
        'A313': { G: 69.0, A: 1867, b: -0.146, name: 'Stainless Steel 302 (ASTM A313)' },
    };

    calculateBtn.addEventListener('click', (e) => {
        // Ripple effect
        const ripple = document.createElement('span');
        const rect = calculateBtn.getBoundingClientRect();
        const diameter = Math.max(calculateBtn.clientWidth, calculateBtn.clientHeight);
        const radius = diameter / 2;
        ripple.style.width = ripple.style.height = `${diameter}px`;
        ripple.style.left = `${e.clientX - rect.left - radius}px`;
        ripple.style.top = `${e.clientY - rect.top - radius}px`;
        ripple.classList.add('ripple');
        calculateBtn.appendChild(ripple);
        ripple.addEventListener('animationend', () => ripple.remove());
        
        if (validateInputs()) {
            performCalculation();
        }
    });

    function validateInputs() {
        let isValid = true;
        const inputs = document.querySelectorAll('#spring-form [required]');
        
        for (let input of inputs) {
            if (!input.value || input.value === '') {
                const labelText = input.labels && input.labels[0] ? input.labels[0].textContent.split('(')[0].trim() : 'A field';
                displayMessage(`Error: "${labelText}" is required.`, "error");
                input.focus();
                return false;
            }
        }

        const f1 = parseFloat(document.getElementById('force-1').value);
        const l1 = parseFloat(document.getElementById('length-1').value);
        const f2 = parseFloat(document.getElementById('force-2').value);
        const l2 = parseFloat(document.getElementById('length-2').value);
        const d = parseFloat(document.getElementById('wire-diameter').value);
        const Do = parseFloat(document.getElementById('outer-diameter').value);

        if (f2 <= f1) { 
            displayMessage('Error: Force 2 (F₂) must be greater than Force 1 (F₁).', 'error'); 
            return false; 
        }
        if (l2 >= l1) { 
            displayMessage('Error: Length at Force 2 (L₂) must be less than Length at Force 1 (L₁).', 'error'); 
            return false; 
        }
        if (Do <= d) { 
            displayMessage('Error: Outer Diameter must be greater than Wire Diameter.', 'error'); 
            return false; 
        }
        if (d <= 0) {
            displayMessage('Error: Wire Diameter must be positive.', 'error');
            return false;
        }

        return true;
    }

    function performCalculation() {
        const inputs = {
            materialKey: document.getElementById('material-type').value,
            d: parseFloat(document.getElementById('wire-diameter').value),
            Do: parseFloat(document.getElementById('outer-diameter').value),
            endType: document.getElementById('end-type').value,
            F1: parseFloat(document.getElementById('force-1').value),
            L1: parseFloat(document.getElementById('length-1').value),
            F2: parseFloat(document.getElementById('force-2').value),
            L2: parseFloat(document.getElementById('length-2').value),
        };
        
        const material = materialData[inputs.materialKey];
        calculationStepsDiv.innerHTML = '';
        
        // --- Step 1: Calculate Mean Diameter and Spring Index ---
        const D = inputs.Do - inputs.d;
        const C = D / inputs.d;
        
        addCalculationStep(
            1, 
            'Calculate Mean Diameter (D) and Spring Index (C)', 
            `$$D = D_o - d$$
             $$C = \\frac{D}{d}$$`,
            `Mean Coil Diameter (D) = ${inputs.Do.toFixed(2)} - ${inputs.d.toFixed(2)} = <strong>${D.toFixed(3)} mm</strong><br><br>
             Spring Index (C) = ${D.toFixed(3)} / ${inputs.d.toFixed(2)} = <strong>${C.toFixed(3)}</strong><br><br>
             <em>Note: Recommended range for C is 4 to 12 for manufacturability.</em>`,
            `D = ${D.toFixed(3)} mm<br>C = ${C.toFixed(3)}`
        );
        
        if (C < 4) {
            displayMessage('Warning: Spring Index (C = ' + C.toFixed(2) + ') is below 4. This may cause manufacturing difficulties and high stress concentration.', 'warning');
        } else if (C > 12) {
            displayMessage('Warning: Spring Index (C = ' + C.toFixed(2) + ') is above 12. The spring may be prone to tangling and buckling.', 'warning');
        }

        // --- Step 2: Calculate Spring Rate ---
        const k = (inputs.F2 - inputs.F1) / (inputs.L1 - inputs.L2);
        
        addCalculationStep(
            2, 
            'Calculate Spring Rate (k)', 
            `$$k = \\frac{F_2 - F_1}{L_1 - L_2}$$`,
            `Spring Rate (k) = (${inputs.F2} - ${inputs.F1}) / (${inputs.L1} - ${inputs.L2})<br>
             Spring Rate (k) = ${(inputs.F2 - inputs.F1).toFixed(2)} / ${(inputs.L1 - inputs.L2).toFixed(2)}`,
            `k = ${k.toFixed(4)} N/mm`
        );

        // --- Step 3: Calculate Number of Active Coils ---
        const G_MPa = material.G * 1000; // Convert GPa to MPa
        const Na = (G_MPa * Math.pow(inputs.d, 4)) / (8 * Math.pow(D, 3) * k);
        
        addCalculationStep(
            3, 
            'Calculate Number of Active Coils (Nₐ)', 
            `$$N_a = \\frac{G \\cdot d^4}{8 \\cdot D^3 \\cdot k}$$`,
            `Shear Modulus (G) = ${G_MPa.toFixed(0)} MPa for ${material.name}<br><br>
             Active Coils (Nₐ) = (${G_MPa.toFixed(0)} × ${inputs.d.toFixed(2)}⁴) / (8 × ${D.toFixed(3)}³ × ${k.toFixed(4)})<br>
             Active Coils (Nₐ) = ${(G_MPa * Math.pow(inputs.d, 4)).toFixed(2)} / ${(8 * Math.pow(D, 3) * k).toFixed(2)}`,
            `Nₐ = ${Na.toFixed(3)} coils`
        );

        // --- Step 4: Calculate Total Coils Based on End Type ---
        let Nt;
        let endCoilsAdded;
        let ntFormula;
        
        switch(inputs.endType) {
            case 'squared-ground':
                Nt = Na + 2;
                endCoilsAdded = 2;
                ntFormula = 'N_t = N_a + 2';
                break;
            case 'squared':
                Nt = Na + 2;
                endCoilsAdded = 2;
                ntFormula = 'N_t = N_a + 2';
                break;
            case 'plain-ground':
                Nt = Na + 1;
                endCoilsAdded = 1;
                ntFormula = 'N_t = N_a + 1';
                break;
            case 'plain':
                Nt = Na;
                endCoilsAdded = 0;
                ntFormula = 'N_t = N_a';
                break;
        }

        addCalculationStep(
            4, 
            'Calculate Total Coils (Nₜ) Based on End Type', 
            `$$${ntFormula}$$`,
            `End Type: <strong>${inputs.endType}</strong><br>
             Inactive coils added = ${endCoilsAdded}<br><br>
             Total Coils (Nₜ) = ${Na.toFixed(3)} + ${endCoilsAdded}`,
            `Nₜ = ${Nt.toFixed(3)} coils`
        );

        // --- Step 5: Calculate Free Length and Solid Length ---
        const y1 = inputs.F1 / k;
        const L0 = inputs.L1 + y1;
        
        let Ls;
        let lsFormula;
        let lsCalc;
        
        switch(inputs.endType) {
            case 'squared-ground':
                Ls = Nt * inputs.d;
                lsFormula = 'L_s = N_t \\cdot d';
                lsCalc = `${Nt.toFixed(3)} × ${inputs.d.toFixed(2)}`;
                break;
            case 'squared':
                Ls = (Nt + 1) * inputs.d;
                lsFormula = 'L_s = (N_t + 1) \\cdot d';
                lsCalc = `(${Nt.toFixed(3)} + 1) × ${inputs.d.toFixed(2)}`;
                break;
            case 'plain-ground':
                Ls = (Nt + 1) * inputs.d;
                lsFormula = 'L_s = (N_t + 1) \\cdot d';
                lsCalc = `(${Nt.toFixed(3)} + 1) × ${inputs.d.toFixed(2)}`;
                break;
            case 'plain':
                Ls = (Nt + 1) * inputs.d;
                lsFormula = 'L_s = (N_t + 1) \\cdot d';
                lsCalc = `(${Nt.toFixed(3)} + 1) × ${inputs.d.toFixed(2)}`;
                break;
        }

        addCalculationStep(
            5, 
            'Calculate Free Length (L₀) and Solid Length (Lₛ)', 
            `$$L_0 = L_1 + \\frac{F_1}{k}$$
             $$${lsFormula}$$`,
            `Deflection at F₁ = ${inputs.F1} / ${k.toFixed(4)} = ${y1.toFixed(3)} mm<br><br>
             Free Length (L₀) = ${inputs.L1} + ${y1.toFixed(3)} = <strong>${L0.toFixed(3)} mm</strong><br><br>
             Solid Length (Lₛ) = ${lsCalc} = <strong>${Ls.toFixed(3)} mm</strong>`,
            `L₀ = ${L0.toFixed(3)} mm<br>Lₛ = ${Ls.toFixed(3)} mm`
        );

        // --- Step 6: Calculate Deflection and Force at Solid ---
        const y_max = L0 - Ls;
        const F_solid = y_max > 0 ? k * y_max : 0;

        addCalculationStep(
            6, 
            'Calculate Maximum Deflection and Force at Solid Length', 
            `$$y_{max} = L_0 - L_s$$
             $$F_{solid} = k \\cdot y_{max}$$`,
            `Maximum Deflection (yₘₐₓ) = ${L0.toFixed(3)} - ${Ls.toFixed(3)} = <strong>${y_max.toFixed(3)} mm</strong><br><br>
             Force at Solid (Fₛₒₗᵢ) = ${k.toFixed(4)} × ${y_max.toFixed(3)}`,
            `yₘₐₓ = ${y_max.toFixed(3)} mm<br>Fₛₒₗᵢ = ${F_solid.toFixed(2)} N`
        );

        // --- Step 7: Calculate Wahl Correction Factor ---
        const Kw = ((4 * C - 1) / (4 * C - 4)) + (0.615 / C);
        
        addCalculationStep(
            7, 
            'Calculate Wahl Correction Factor (Kw)', 
            `$$K_w = \\frac{4C - 1}{4C - 4} + \\frac{0.615}{C}$$`,
            `Wahl Factor (Kw) = [(4 × ${C.toFixed(3)} - 1) / (4 × ${C.toFixed(3)} - 4)] + (0.615 / ${C.toFixed(3)})<br>
             Kw = [${(4 * C - 1).toFixed(3)} / ${(4 * C - 4).toFixed(3)}] + ${(0.615 / C).toFixed(4)}<br>
             Kw = ${((4 * C - 1) / (4 * C - 4)).toFixed(4)} + ${(0.615 / C).toFixed(4)}`,
            `Kw = ${Kw.toFixed(4)}`
        );

        // --- Step 8: Calculate Shear Stress at Operating Force 2 ---
        const tau_2 = Kw * (8 * inputs.F2 * D) / (Math.PI * Math.pow(inputs.d, 3));
        
        addCalculationStep(
            8, 
            'Calculate Shear Stress at Force 2 (τ₂)', 
            `$$\\tau = K_w \\cdot \\frac{8 \\cdot F \\cdot D}{\\pi \\cdot d^3}$$`,
            `Shear Stress at F₂ (τ₂) = ${Kw.toFixed(4)} × (8 × ${inputs.F2} × ${D.toFixed(3)}) / (π × ${inputs.d.toFixed(2)}³)<br>
             τ₂ = ${Kw.toFixed(4)} × ${(8 * inputs.F2 * D).toFixed(2)} / ${(Math.PI * Math.pow(inputs.d, 3)).toFixed(4)}`,
            `τ₂ = ${tau_2.toFixed(2)} MPa`
        );

        // --- Step 9: Calculate Shear Stress at Solid Length ---
        const tau_solid = F_solid > 0 ? Kw * (8 * F_solid * D) / (Math.PI * Math.pow(inputs.d, 3)) : 0;
        
        addCalculationStep(
            9, 
            'Calculate Shear Stress at Solid Length (τₛₒₗᵢ)', 
            `$$\\tau_{solid} = K_w \\cdot \\frac{8 \\cdot F_{solid} \\cdot D}{\\pi \\cdot d^3}$$`,
            `Shear Stress at Solid (τₛₒₗᵢ) = ${Kw.toFixed(4)} × (8 × ${F_solid.toFixed(2)} × ${D.toFixed(3)}) / (π × ${inputs.d.toFixed(2)}³)<br>
             τₛₒₗᵢ = ${Kw.toFixed(4)} × ${(8 * F_solid * D).toFixed(2)} / ${(Math.PI * Math.pow(inputs.d, 3)).toFixed(4)}`,
            `τₛₒₗᵢ = ${tau_solid.toFixed(2)} MPa`
        );

        // --- Step 10: Calculate Material Strength ---
        const Sut = material.A * Math.pow(inputs.d, material.b);
        const Ssy = 0.45 * Sut; // Typical approximation for torsional yield strength
        
        addCalculationStep(
            10, 
            'Calculate Material Ultimate Tensile Strength (Sᵤₜ) and Shear Yield Strength (Sₛᵧ)', 
            `$$S_{ut} = A \\cdot d^b$$
             $$S_{sy} = 0.45 \\cdot S_{ut}$$`,
            `For ${material.name}:<br>
             A = ${material.A} MPa, b = ${material.b}<br><br>
             Ultimate Tensile Strength (Sᵤₜ) = ${material.A} × ${inputs.d.toFixed(2)}^(${material.b})<br>
             Sᵤₜ = ${Sut.toFixed(2)} MPa<br><br>
             Shear Yield Strength (Sₛᵧ) ≈ 0.45 × ${Sut.toFixed(2)}`,
            `Sᵤₜ = ${Sut.toFixed(2)} MPa<br>Sₛᵧ = ${Ssy.toFixed(2)} MPa`
        );

        // --- Step 11: Calculate Factor of Safety ---
        const FS_2 = tau_2 > 0 ? Ssy / tau_2 : Infinity;
        const FS_solid = tau_solid > 0 ? Ssy / tau_solid : Infinity;
        
        addCalculationStep(
            11, 
            'Calculate Factor of Safety (FS)', 
            `$$FS = \\frac{S_{sy}}{\\tau}$$`,
            `Factor of Safety at F₂:<br>
             FS₂ = ${Ssy.toFixed(2)} / ${tau_2.toFixed(2)} = <strong>${FS_2.toFixed(3)}</strong><br><br>
             Factor of Safety at Solid Length:<br>
             FSₛₒₗᵢ = ${Ssy.toFixed(2)} / ${tau_solid.toFixed(2)} = <strong>${FS_solid.toFixed(3)}</strong><br><br>
             <em>Note: Recommended FS ≥ 1.5 for static loading, ≥ 2.0 for dynamic loading.</em>`,
            `FS at F₂ = ${FS_2.toFixed(3)}<br>FS at Solid = ${FS_solid.toFixed(3)}`
        );

        // --- Step 12: Buckling Check ---
        const slenderness = L0 / D;
        let buckling_critical_ratio;
        
        // Critical slenderness ratio depends on end conditions
        switch(inputs.endType) {
            case 'squared-ground':
                buckling_critical_ratio = 2.63; // Both ends fixed
                break;
            case 'squared':
                buckling_critical_ratio = 3.0; // Both ends supported
                break;
            default:
                buckling_critical_ratio = 4.0; // One or both ends free
                break;
        }
        
        const buckling_safe = slenderness < buckling_critical_ratio;
        
        addCalculationStep(
            12, 
            'Buckling Stability Check', 
            `$$\\lambda = \\frac{L_0}{D}$$`,
            `Slenderness Ratio (λ) = ${L0.toFixed(3)} / ${D.toFixed(3)} = <strong>${slenderness.toFixed(3)}</strong><br><br>
             Critical Slenderness Ratio for '${inputs.endType}' end condition ≈ ${buckling_critical_ratio}<br><br>
             ${buckling_safe ? 
               '<span style="color: var(--success-color); font-weight: bold;">✓ Buckling Check: PASS - Spring is stable</span>' : 
               '<span style="color: var(--fail-color); font-weight: bold;">✗ Buckling Check: FAIL - Spring may buckle. Consider using a guide rod or tube.</span>'}`,
            `λ = ${slenderness.toFixed(3)} ${buckling_safe ? '< ' + buckling_critical_ratio + ' (Safe)' : '≥ ' + buckling_critical_ratio + ' (Unsafe)'}`
        );

        // --- Final Verdict ---
        let verdict_text = "";
        let verdict_class = "";
        let design_issues = [];

        if (FS_solid < 1.0) {
            design_issues.push("Critical failure: Spring will yield when compressed to solid length");
            verdict_class = "fail";
        } else if (FS_solid < 1.2) {
            design_issues.push("Insufficient safety factor at solid length (< 1.2)");
            verdict_class = "warning";
        }

        if (FS_2 < 1.5) {
            design_issues.push("Low safety factor at operating Force 2 (< 1.5)");
            if (verdict_class !== "fail") verdict_class = "warning";
        }

        if (!buckling_safe) {
            design_issues.push("Spring is prone to buckling - requires guidance");
            if (verdict_class !== "fail") verdict_class = "warning";
        }

        if (inputs.L2 <= Ls) {
            design_issues.push("Operating length L₂ is at or below solid length - spring will clash");
            verdict_class = "fail";
        }

        const clash_allowance = inputs.L2 - Ls;
        const recommended_clash = 0.15 * (inputs.L1 - inputs.L2); // 15% of working deflection
        
        if (clash_allowance < recommended_clash && clash_allowance > 0) {
            design_issues.push(`Insufficient clash allowance (${clash_allowance.toFixed(2)} mm, recommend ≥ ${recommended_clash.toFixed(2)} mm)`);
            if (verdict_class !== "fail" && verdict_class !== "warning") verdict_class = "warning";
        }

        if (design_issues.length === 0) {
            verdict_text = "✓ Design is SAFE and meets all criteria";
            verdict_class = "safe";
        } else if (verdict_class === "fail") {
            verdict_text = "✗ Design FAILS - Critical issues found:<br>" + design_issues.join("<br>");
        } else {
            verdict_text = "⚠ Design has WARNINGS - Review recommended:<br>" + design_issues.join("<br>");
        }

        const verdictDiv = document.createElement('div');
        verdictDiv.className = `final-verdict ${verdict_class}`;
        verdictDiv.innerHTML = verdict_text;
        calculationStepsDiv.appendChild(verdictDiv);

        // Render MathJax
        try {
            if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                window.MathJax.typesetPromise([calculationStepsDiv]).catch((err) => console.error('MathJax error:', err));
            } else if (window.MathJax && typeof window.MathJax.typeset === 'function') {
                window.MathJax.typeset([calculationStepsDiv]);
            }
        } catch (e) {
            console.error("MathJax rendering error:", e);
        }
        
        // Show results
        resultContainer.classList.add('show');
        setTimeout(() => resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }), 300);
        
        // Generate recommendations
        recommendationsDiv.innerHTML = `
            <ul>
                <li><strong>Safety Factor Analysis:</strong> FS at operating load F₂ = <strong>${FS_2.toFixed(2)}</strong>, FS at solid length = <strong>${FS_solid.toFixed(2)}</strong>. For static applications, FS ≥ 1.5 is recommended; for dynamic/cyclic loading, FS ≥ 2.0 is preferred.</li>
                
                <li><strong>Buckling Stability:</strong> Slenderness ratio λ = <strong>${slenderness.toFixed(2)}</strong>. ${buckling_safe ? 'The spring is stable and should not buckle under axial loading.' : 'The spring is too slender and may buckle. Use a guide rod (ID spring) or guide tube (OD spring).'}</li>
                
                <li><strong>Spring Index (C):</strong> C = <strong>${C.toFixed(2)}</strong>. ${C >= 4 && C <= 12 ? 'This is within the recommended manufacturing range (4-12).' : C < 4 ? 'This is below the recommended range. The spring will be difficult to manufacture and may have high residual stresses.' : 'This is above the recommended range. The spring may tangle during handling and operation.'}</li>
                
                <li><strong>Clash Allowance:</strong> Gap between operating length L₂ and solid length Lₛ = <strong>${clash_allowance.toFixed(2)} mm</strong>. Recommended minimum = <strong>${recommended_clash.toFixed(2)} mm</strong> (15% of working deflection). ${clash_allowance >= recommended_clash ? 'Adequate clearance provided.' : 'Consider increasing this gap to prevent accidental coil contact.'}</li>
                
                <li><strong>Stress Levels:</strong> Maximum shear stress at solid = <strong>${tau_solid.toFixed(2)} MPa</strong> vs. material shear yield strength = <strong>${Ssy.toFixed(2)} MPa</strong>. ${tau_solid < 0.7 * Ssy ? 'Stress level is conservative.' : tau_solid < Ssy ? 'Stress level is acceptable but approaching limits.' : 'Stress exceeds material capability - redesign required.'}</li>
                
                <li><strong>Material Selection:</strong> ${material.name} with Sᵤₜ ≈ <strong>${Sut.toFixed(0)} MPa</strong> for d = ${inputs.d} mm. Consider material with higher strength or increase wire diameter if safety factors are inadequate.</li>
                
                <li><strong>Standards Reference:</strong> This design follows principles from ASTM standards and Shigley's Mechanical Engineering Design. Always verify critical springs with physical testing and consult manufacturer's capabilities.</li>
            </ul>
        `;
    }
    
    function addCalculationStep(step, title, formula, calculation, result) {
        const stepContainer = document.createElement('div');
        stepContainer.className = 'calculation-step-container';
        stepContainer.style.animationDelay = `${step * 0.05}s`;
        
        let content = `
            <div class="step-header">
                <span>Step ${step}: ${title}</span>
            </div>
            <div class="step-content">`;
        
        if (formula) {
            content += `<p class="formula">${formula}</p>`;
        }
        
        if (calculation) {
            content += `<p class="calculation">${calculation}</p>`;
        }
        
        if (result) {
            content += `<div class="final-result">${result}</div>`;
        }
        
        content += `</div>`;
        
        stepContainer.innerHTML = content;
        calculationStepsDiv.appendChild(stepContainer);
    }

    function displayMessage(message, type = "error") {
        const messageBox = document.getElementById('custom-message-box');
        messageBox.textContent = message;
        messageBox.className = 'show';
        
        if (type === "error") {
            messageBox.style.backgroundColor = 'var(--fail-color)';
            messageBox.style.color = 'white';
        } else if (type === "warning") {
            messageBox.style.backgroundColor = 'var(--warning-color)';
            messageBox.style.color = 'white';
        } else {
            messageBox.style.backgroundColor = 'var(--success-color)';
            messageBox.style.color = 'white';
        }
        
        setTimeout(() => { 
            messageBox.classList.remove('show'); 
        }, 5000);
    }
});

// Theme Toggle
document.addEventListener('DOMContentLoaded', () => {
    const themeSwitch = document.getElementById('theme-switch');
    const body = document.body;
    const currentTheme = localStorage.getItem('theme');
    
    if (currentTheme) {
        body.classList.add(currentTheme);
        if (currentTheme === 'dark-mode') {
            themeSwitch.checked = true;
        }
    }
    
    themeSwitch.addEventListener('change', () => {
        if (themeSwitch.checked) {
            body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark-mode');
        } else {
            body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light-mode');
        }
    });
});
</script>
</body>
</html>
