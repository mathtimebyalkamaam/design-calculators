<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neutral Earth Fault Current - Design Calculators - Electrical</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional calculator for Neutral Earth Fault Current in Solidly, Resistive, and Isolated (Unearthed) systems using Symmetrical Components (Z1, Z2, Z0) per IEEE & IEC standards.">
    <meta name="keywords" content="earth fault current, fault current calculator, symmetrical components, Z1, Z2, Z0, resistive earthing, solid earthing, isolated system, ieee 80, iec 60909">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/neutral-earth-fault-current.html" />

    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for LaTeX rendering -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
        /* Base Theme Variables from perfect.txt */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber/Yellow */
            --success: #10B981; /* Green */
            --danger: #DC2626; /* Red */
            --warning: #F59E0B; /* Amber/Yellow */
            --bg: #F8FAFC; /* Light Grey BG */
            --card: #FFFFFF; /* White Card */
            --text: #4B5563; /* Medium Grey Text */
            --heading: #111827; /* Dark Grey/Black Heading */
            --footer-bg: #0F172A; /* Very Dark Blue Footer */
            --border: #E2E8F0; /* Light Grey Border */
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
            --form-row-gap: 25px; /* Added for consistency */
        }

        /* Dark Mode Variables from perfect.txt */
        body.dark-mode {
            --primary: #10B981; /* Green */
            --secondary: #34D399; /* Lighter Green */
            --bg: #0F172A; /* Dark Blue BG */
            --card: #1E293B; /* Lighter Dark Blue Card */
            --text: #CBD5E1; /* Light Grey Text */
            --heading: #F1F5F9; /* White Heading */
            --footer-bg: #020617; /* Black Footer */
            --border: #334155; /* Medium Dark Border */
        }

        /* General Body Styling from perfect.txt */
        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container { 
            max-width: 1280px; 
            margin: 0 auto; 
            padding: 0 24px; 
        }

        /* Header & Nav from perfect.txt */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .theme-toggle i {
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Main Content & Cards from perfect.txt */
        main { 
            padding: 40px 0; 
            flex: 1;
        }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .card h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .card p {
            font-size: 1.05rem;
        }
        
        /* ADAPTED CALCULATOR STYLES */
        .tool-description {
            margin-bottom: 30px;
            color: var(--text);
            font-size: 1.1em;
            text-align: justify;
        }
        .calculator-form {
            background-color: var(--card);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
            font-size: 1.05em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
             box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--form-row-gap);
            margin-bottom: 15px;
        }
        
        /* Button Styles from perfect.txt, adapted */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }

        /* Result Container */
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card);
            box-shadow: var(--shadow);
            display: none;
            opacity: 0;
            transition: opacity 0.6s ease-out;
            border: 1px solid var(--border);
        }
        .result-container.show {
            display: block;
            opacity: 1;
        }
        .result-container h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
        }
        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .result-table th {
            background: var(--bg);
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            font-size: 0.95em;
        }
        .result-table tbody tr:nth-child(even) {
            background-color: var(--bg);
        }
        body.dark-mode .result-table tbody tr:nth-child(even) {
            background-color: #2c3e50;
        }
        .result-table tbody tr:hover {
            background-color: #eef2f7;
        }
        body.dark-mode .result-table tbody tr:hover {
            background-color: #334155;
        }
        
        /* Calculation Details */
        #calculation-details {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 1.05em;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
        }
        #calculation-details h4 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.4em;
            text-align: center;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.3em;
            text-align: center;
            padding: 12px 0;
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px dashed var(--primary);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--card);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid var(--accent);
            overflow-x: auto;
        }
        body.dark-mode #calculation-details p.calculation-step {
            background-color: var(--bg);
        }
        #calculation-details ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
            padding-left: 25px;
            position: relative;
        }
        #calculation-details ul li::before {
            content: "\f058";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: var(--success);
            position: absolute;
            left: 0;
            top: 2px;
        }

        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 8px;
            cursor: help;
            font-size: 0.9em;
            transition: transform 0.2s ease-in-out;
        }
        .info-icon:hover {
            transform: scale(1.2);
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            font-size: 0.85em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Custom message box */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        #custom-message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }
        
        /* Animation for input group visibility change */
        .hidden-input {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }

        /* Educational Section (from perfect.txt) */
        .education-section {
            margin-top: 40px;
        }
        .education-section h2 {
            font-size: 1.8rem;
        }
        .education-section h3 {
            font-size: 1.5rem;
            color: var(--primary);
        }
        .education-section p, .education-section li {
            line-height: 1.8;
            font-size: 1.05rem;
            color: var(--text);
        }
        .education-section ul {
            padding-left: 25px;
            margin-top: 10px;
        }
        .education-section strong {
            color: var(--heading);
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h3 {
            color: var(--danger);
            margin-top: 0;
            font-size: 1.4rem;
        }
        .summary-box {
            background: linear-gradient(135deg, rgba(30,58,138,0.1), rgba(30,58,138,0.05));
            border-left: 5px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .summary-box h4 {
            color: var(--primary);
            margin-top: 0;
            font-size: 1.3rem;
        }
        body.dark-mode .summary-box h4 {
            color: var(--secondary);
        }


        /* Footer from perfect.txt */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col li {
            margin-bottom: 8px;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="custom-message-box"></div>

    <!-- New Header from perfect.txt -->
    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <!-- Back button removed as requested -->
                
        <div class="card">
            <h2><i class="fas fa-bolt"></i> Neutral Earth Fault Current Calculator</h2>
                        
            <div class="tool-description">
                <p>This calculator determines the neutral earth fault current for three common earthing systems: Solidly Earthed, Resistive Earthed, and Isolated/Unearthed systems. It uses the **Symmetrical Component Method** (Z1, Z2, Z0) for accurate Single-Line-to-Ground (SLG) fault analysis, which is crucial for the proper design of earthing systems, selection of protective devices, and ensuring safety in electrical installations. This tool adheres to fundamental principles outlined in **IEC 60909**, **IEEE Std 80 (Guide for Safety in AC Substation Grounding)**, and **IEEE Std 141 (Red Book)**.</p>
            </div>
                    
            <div class="calculator-form">
                <form id="neutral-earth-fault-form">
                    <!-- System Type and Voltage -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="system-type">Earthing System Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the earthing system. This will show the required impedance inputs for that system.</span></span></label>
                            <select id="system-type" required>
                                <option value="solid">Solidly Earthed System</option>
                                <option value="resistive">Resistive Earthed System</option>
                                <option value="isolated">Isolated/Unearthed System</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="system-voltage">System Line-to-Line Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The nominal line-to-line voltage of the three-phase system (e.g., 400, 4160, 11000).</span></span></label>
                            <input type="number" id="system-voltage" min="1" step="1" value="400" required>
                        </div>
                    </div>
                    
                    <!-- Sequence Impedance Inputs (Used by Solid & Resistive) -->
                    <div id="sequence-impedance-inputs" class="form-row">
                        <div class="form-group">
                            <label for="source-positive-resistance">Positive Sequence Resistance (R1,source in &Omega;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The resistive component of the positive-sequence impedance (Z1) from the source.</span></span></label>
                            <input type="number" id="source-positive-resistance" min="0" step="0.001" value="0.005" required>
                        </div>
                        <div class="form-group">
                            <label for="source-positive-reactance">Positive Sequence Reactance (X1,source in &Omega;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The reactive component of the positive-sequence impedance (Z1) from the source.</span></span></label>
                            <input type="number" id="source-positive-reactance" min="0" step="0.001" value="0.02" required>
                        </div>
                        <div class="form-group">
                            <label for="source-negative-resistance">Negative Sequence Resistance (R2,source in &Omega;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Often equal to R1 for transformers and cables.</span></span></label>
                            <input type="number" id="source-negative-resistance" min="0" step="0.001" value="0.005" required>
                        </div>
                        <div class="form-group">
                            <label for="source-negative-reactance">Negative Sequence Reactance (X2,source in &Omega;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Often equal to X1 for transformers and cables.</span></span></label>
                            <input type="number" id="source-negative-reactance" min="0" step="0.001" value="0.02" required>
                        </div>
                    </div>

                    <!-- Zero Sequence & Resistor Inputs (Specific to Solid/Resistive) -->
                    <div id="zero-sequence-inputs" class="form-row">
                        <div class="form-group">
                            <label for="source-zero-resistance">Zero Sequence Resistance (R0,source in &Omega;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The resistive component of the zero-sequence impedance (Z0) from the source.</span></span></label>
                            <input type="number" id="source-zero-resistance" min="0" step="0.001" value="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="source-zero-reactance">Zero Sequence Reactance (X0,source in &Omega;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The reactive component of the zero-sequence impedance (Z0) from the source.</span></span></label>
                            <input type="number" id="source-zero-reactance" min="0" step="0.001" value="0.05" required>
                        </div>
                    </div>

                    <!-- Inputs for Resistive Earthed System -->
                    <div id="resistive-earthed-inputs" class="form-row hidden-input">
                        <div class="form-group">
                            <label for="neutral-resistor-resistance">Neutral Earthing Resistance (RN in &Omega;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Resistance of the neutral grounding resistor. This value is critical for limiting the fault current.</span></span></label>
                            <input type="number" id="neutral-resistor-resistance" min="0.1" step="0.1" value="10" required>
                        </div>
                        <div class="form-group">
                             <!-- This empty div helps maintain the 2-column layout when only one input is in this row -->
                        </div>
                    </div>

                    <!-- Inputs for Isolated/Unearthed System -->
                    <div id="isolated-earthed-inputs" class="form-row hidden-input">
                        <div class="form-group">
                            <label for="total-system-capacitance">System Phase-to-Earth Capacitance (C_ph in &mu;F) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The *per-phase* capacitance to earth of the entire system (cables, windings, etc.). E.g., 0.1-1.0 &mu;F per km of cable.</span></span></label>
                            <input type="number" id="total-system-capacitance" min="0.01" step="0.01" value="0.5" required>
                        </div>
                        <div class="form-group">
                            <label for="system-frequency">System Frequency (Hz) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The operating frequency of the electrical system (50 or 60 Hz).</span></span></label>
                            <select id="system-frequency" required>
                                <option value="50">50 Hz</option>
                                <option value="60">60 Hz</option>
                            </select>
                        </div>
                    </div>
                                        
                    <button type="button" id="calculate-fault-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Fault Current</button>
                </form>
            </div>
        </div>
                        
        <!-- Results Container -->
        <div id="result-container" class="result-container">
            <h3><i class="fas fa-clipboard-check"></i> Calculation Results</h3>
            
            <!-- Calculation Details (Dynamic) -->
            <div id="calculation-details">
                <!-- Calculation steps and formulas will be inserted here -->
            </div>
            
            <!-- Result Table (Dynamic) -->
            <table class="result-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    <!-- Results will be dynamically inserted here -->
                </tbody>
            </table>
            
            <!-- Standard Reference / Importance (Dynamic) -->
            <div id="standard-reference" style="margin-top: 25px;">
                <!-- Standard reference text and importance explanation will be inserted here -->
            </div>
        </div>

        <!-- NEWLY ADDED STATIC EDUCATIONAL SECTION -->
        <div class="card education-section">
            <h2><i class="fas fa-book-reader"></i> Professional Insights: Why is Earth Fault Current Critical?</h2>
            <p>The calculation of the Single-Line-to-Ground (SLG) fault current, often called the "earth fault current," is arguably the most important calculation for ensuring the safety and reliability of an electrical power system. Its magnitude dictates everything from personnel safety design to equipment selection. This tool uses the **Symmetrical Component Method** (`Z1`, `Z2`, `Z0`), the industry-standard approach mandated by standards like **IEC 60909** and **IEEE 141 (Red Book)** for accurate analysis.</p>

            <h3>1. Personnel Safety (Touch & Step Potentials)</h3>
            <p>When a fault current flows into the earth, it creates a "voltage gradient" in the soil around the grounding system. This creates two lethal hazards:</p>
            <ul>
                <li><strong>Touch Voltage ($$V_{touch}$$):</strong> The voltage difference between a person's hand (touching a faulted metal structure) and their feet.</li>
                <li><strong>Step Voltage ($$V_{step}$$):</strong> The voltage difference between a person's two feet as they take a step near the fault.</li>
            </ul>
            <p>A high fault current (as seen in *Solidly Earthed* systems) can produce extremely high and lethal touch/step potentials. The entire science of substation grounding design, as detailed in **IEEE Std 80**, is dedicated to building a grounding grid that controls these voltage gradients to keep them below safe human tolerance limits during a fault.</p>

            <h3>2. Equipment Protection & Damage Prevention</h3>
            <p>Fault current is pure destructive energy. The thermal (heating) damage to equipment is proportional to **`I²t`** (current squared times time). 
            A massive, uncontrolled fault current (e.g., 25,000 Amps) from a *Solidly Earthed* system can melt busbars, destroy transformer windings, and vaporize cable insulation in milliseconds. 
            This is why *Resistive Earthing* exists. By inserting a resistor, the fault current is deliberately limited (e.g., to 400A or 5A), which starves the fault of destructive energy, preventing catastrophic damage.</p>

            <h3>3. Protective Device Coordination & Selection</h3>
            <p>Your protective devices (relays, circuit breakers) must be able to "see" and "interrupt" the fault current.</p>
            <ul>
                <li><strong>Solidly Earthed:</strong> Protection must be extremely fast (e.g., 3-5 cycles) to clear the massive fault before `I²t` damage occurs.</li>
                <li><strong>Resistive Earthed:</strong> The fault current is *too low* for standard overcurrent relays. This system *requires* specific, sensitive ground fault relays (e.g., 51N) set to detect the intentionally limited current (e.g., 5A - 400A).</li>
                <li><strong>Isolated (Unearthed):</strong> The fault current (e.g., < 1A) is *too small* for any standard relay. These systems *must* use "Ground Fault Detectors" (GFDs) or Insulation Monitoring Devices (IMDs) that alarm on the fault, as they cannot automatically trip.</li>
            </ul>

            <div class="danger-box">
                <h3><i class="fas fa-exclamation-triangle"></i> The Hazard of Isolated Systems: Transient Overvoltages</h3>
                <p>While *Isolated (Unearthed)* systems seem safe due to their low fault current, they hide a severe danger. An intermittent (or "arcing") ground fault can create a resonance condition with the system's natural phase-to-ground capacitance. This resonance can cause **Transient Overvoltages** that are **5 to 6 times** the normal system voltage.</p>
                <p>These overvoltages can puncture insulation and destroy motors, cables, and transformers across the *entire* system, even on healthy phases. *High-Resistance Earthing* (a type of Resistive Earthing) is the definitive solution to this problem, as the resistor "damps" these overvoltages, providing stability while keeping fault current low.</p>
            </div>

            <h3>Summary of Earthing Systems</h3>
            <div class="summary-box">
                <h4><strong>1. Solidly Earthed (e.g., TN Systems)</strong></h4>
                <p><strong>Fault Current:</strong> Very High (1,000s of Amps).<br/>
                   <strong>Pros:</strong> Fast, simple protection; stable voltage.<br/>
                   <strong>Cons:</strong> Extreme arc flash hazard, severe equipment damage, high touch/step potentials.</p>
            </div>
            <div class="summary-box">
                <h4><strong>2. Resistive Earthed (Low or High Resistance)</strong></h4>
                <p><strong>Fault Current:</strong> Limited (e.g., 5A to 400A).<br/>
                   <strong>Pros:</strong> Drastically reduces arc flash/damage, eliminates transient overvoltages, allows for sensitive fault detection.<br/>
                   <strong>Cons:</strong> Requires specific ground fault relays.</p>
            </div>
            <div class="summary-box">
                <h4><strong>3. Isolated / Unearthed (e.g., IT Systems)</strong></h4>
                <p><strong>Fault Current:</strong> Very Low (e.g., < 1A), purely capacitive.<br/>
                   <strong>Pros:</strong> High service continuity (can run with one fault).<br/>
                   <strong>Cons:</strong> Highly susceptible to transient overvoltages, faults are hard to locate.</p>
            </div>
        </div>
    </main>

    <!-- New Footer from perfect.txt -->
        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>
        
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const systemTypeSelect = document.getElementById('system-type');
            const sequenceImpedanceInputs = document.getElementById('sequence-impedance-inputs');
            const zeroSequenceInputs = document.getElementById('zero-sequence-inputs');
            const resistiveEarthedInputs = document.getElementById('resistive-earthed-inputs');
            const isolatedEarthedInputs = document.getElementById('isolated-earthed-inputs');

            const calculateBtn = document.getElementById('calculate-fault-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                messageBox.style.display = 'block';

                if (type === "error") {
                    messageBox.style.backgroundColor = 'var(--danger)';
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = 'var(--warning)';
                    messageBox.style.color = '#111827';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                    messageBox.style.color = 'white';
                }
                messageBox.style.opacity = 1;

                if (messageBox.timeoutId) {
                    clearTimeout(messageBox.timeoutId);
                }
                messageBox.timeoutId = setTimeout(() => {
                    messageBox.style.opacity = 0;
                    setTimeout(() => { messageBox.style.display = 'none';}, 500);
                }, 5000);
            }

            // Function to toggle input visibility based on system type
            function toggleInputVisibility() {
                const selectedType = systemTypeSelect.value;
                
                // Hide all optional sections first
                sequenceImpedanceInputs.classList.add('hidden-input');
                zeroSequenceInputs.classList.add('hidden-input');
                resistiveEarthedInputs.classList.add('hidden-input');
                isolatedEarthedInputs.classList.add('hidden-input');

                // Remove 'required' from all inputs in optional sections
                document.querySelectorAll('#sequence-impedance-inputs input, #zero-sequence-inputs input, #resistive-earthed-inputs input, #isolated-earthed-inputs input')
                    .forEach(input => input.removeAttribute('required'));

                // Show sections and add 'required' based on selection
                if (selectedType === 'solid' || selectedType === 'resistive') {
                    sequenceImpedanceInputs.classList.remove('hidden-input');
                    zeroSequenceInputs.classList.remove('hidden-input');
                    
                    document.querySelectorAll('#sequence-impedance-inputs input, #zero-sequence-inputs input')
                        .forEach(input => input.setAttribute('required', 'true'));

                    if (selectedType === 'resistive') {
                        resistiveEarthedInputs.classList.remove('hidden-input');
                        document.getElementById('neutral-resistor-resistance').setAttribute('required', 'true');
                    }
                } else if (selectedType === 'isolated') {
                    isolatedEarthedInputs.classList.remove('hidden-input');
                    document.querySelectorAll('#isolated-earthed-inputs input, #isolated-earthed-inputs select')
                        .forEach(input => input.setAttribute('required', 'true'));
                }
            }

            // Initial call to set correct visibility on page load
            toggleInputVisibility();
            systemTypeSelect.addEventListener('change', toggleInputVisibility);

            calculateBtn.addEventListener('click', function() {
                try {
                    const systemType = systemTypeSelect.value;
                    const systemVoltage = parseFloat(document.getElementById('system-voltage').value);
                    if (isNaN(systemVoltage) || systemVoltage <= 0) {
                        throw new Error("Please enter a valid positive System Line-to-Line Voltage.");
                    }
                    const phaseVoltage = systemVoltage / Math.sqrt(3);

                    let faultCurrent = 0;
                    let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                    let importanceText = '';

                    calculationHtml += `<p><strong>Given Parameters:</strong></p>`;
                    calculationHtml += `<ul>                    <li>System Type: ${systemType.charAt(0).toUpperCase() + systemType.slice(1)} Earthed System</li>                    <li>System Line-to-Line Voltage ($$V_{L-L}$$): ${systemVoltage.toFixed(2)} V</li>                    <li>Phase-to-Neutral Voltage ($$V_{L-N} = V_{L-L} / \\sqrt{3}$$): ${phaseVoltage.toFixed(2)} V</li>                </ul>`;

                    if (systemType === 'solid' || systemType === 'resistive') {
                        const R1 = parseFloat(document.getElementById('source-positive-resistance').value);
                        const X1 = parseFloat(document.getElementById('source-positive-reactance').value);
                        const R2 = parseFloat(document.getElementById('source-negative-resistance').value);
                        const X2 = parseFloat(document.getElementById('source-negative-reactance').value);
                        const R0 = parseFloat(document.getElementById('source-zero-resistance').value);
                        const X0 = parseFloat(document.getElementById('source-zero-reactance').value);

                        if ([R1, X1, R2, X2, R0, X0].some(isNaN) || [R1, X1, R2, X2, R0, X0].some(v => v < 0)) {
                            throw new Error("Please enter valid non-negative values for all sequence impedances.");
                        }

                        let R_total, X_total, Z_total, Rn = 0;
                        calculationHtml += `<ul>                        <li>Positive Sequence Impedance ($$Z_1$$): ${R1.toFixed(3)} + j${X1.toFixed(3)} &Omega;</li>                        <li>Negative Sequence Impedance ($$Z_2$$): ${R2.toFixed(3)} + j${X2.toFixed(3)} &Omega;</li>                        <li>Source Zero Sequence Impedance ($$Z_{0,source}$$): ${R0.toFixed(3)} + j${X0.toFixed(3)} &Omega;</li>                    </ul>`;

                        if (systemType === 'solid') {
                            R_total = R1 + R2 + R0;
                            X_total = X1 + X2 + X0;
                            Z_total = Math.sqrt(R_total * R_total + X_total * X_total);

                            if (Z_total === 0) {
                                faultCurrent = Infinity;
                                displayMessage("Total impedance is zero, indicating an extremely high (infinite) fault current. Please check inputs.", "warning");
                            } else {
                                faultCurrent = (3 * phaseVoltage) / Z_total;
                            }

                            calculationHtml += `<p><strong>Calculation for Solidly Earthed System:</strong></p>`;
                            calculationHtml += `<p>For a Single-Line-to-Ground (SLG) fault, the neutral fault current ($$I_f$$) is 3 times the zero-sequence current ($$I_0$$). The total impedance in the fault loop is the sum of the sequence impedances.</p>`;
                            calculationHtml += `<p class="formula">$$Z_{total} = Z_1 + Z_2 + Z_0$$</p>`;
                            calculationHtml += `<p class="formula">$$I_f = 3 \\times I_0 = \\frac{3 \\times V_{L-N}}{Z_1 + Z_2 + Z_0}$$</p>`;
                            calculationHtml += `<ul>                        <li>Total Resistance ($$R_{total} = R_1 + R_2 + R_0$$): ${R_total.toFixed(3)} &Omega;</li>                        <li>Total Reactance ($$X_{total} = X_1 + X_2 + X_0$$): ${X_total.toFixed(3)} &Omega;</li>                        <li>Total Impedance ($$|Z_{total}|$$): ${Z_total.toFixed(3)} &Omega;</li>                    </ul>`;
                            calculationHtml += `<p class="calculation-step">$$I_f = (3 \\times ${phaseVoltage.toFixed(2)}) / ${Z_total.toFixed(3)} = ${faultCurrent === Infinity ? "\\text{Infinite}" : faultCurrent.toFixed(2)} \\text{ A}$$</p>`;
                            
                            importanceText = `<h3>Importance (Solidly Earthed System):</h3>
                                <p>In solidly earthed systems, the earth fault current is very high, often comparable to three-phase faults. This is crucial for:</p>
                                <ul>                            
                                    <li><strong>Rapid Protection:</strong> High current allows fast operation of breakers/fuses, isolating the fault and minimizing damage.</li>
                                    <li><strong>Safety Hazard:</strong> This massive current creates extremely dangerous touch and step voltages, requiring a robust grounding grid (per IEEE 80) to ensure personnel safety.</li>
                                </ul>`;
                        
                        } else if (systemType === 'resistive') {
                            Rn = parseFloat(document.getElementById('neutral-resistor-resistance').value);
                            if (isNaN(Rn) || Rn <= 0) {
                                throw new Error("Please enter a valid positive Neutral Earthing Resistance (Rn).");
                            }

                            // The neutral resistor impedance (Rn) appears as 3*Rn in the zero-sequence network
                            R_total = R1 + R2 + R0 + (3 * Rn);
                            X_total = X1 + X2 + X0;
                            Z_total = Math.sqrt(R_total * R_total + X_total * X_total);
                            
                            faultCurrent = (3 * phaseVoltage) / Z_total;

                            calculationHtml += `<ul><li>Neutral Earthing Resistor ($$R_N$$): ${Rn.toFixed(2)} &Omega;</li></ul>`;
                            calculationHtml += `<p><strong>Calculation for Resistive Earthed System:</strong></p>`;
                            calculationHtml += `<p>The neutral earthing resistor ($$R_N$$) is added to the zero-sequence network as $$3R_N$$. This value dominates the impedance to limit the fault current.</p>`;
                            calculationHtml += `<p class="formula">$$Z_{total} = Z_1 + Z_2 + Z_0 + 3R_N$$</p>`;
                            calculationHtml += `<p class="formula">$$I_f = \\frac{3 \\times V_{L-N}}{Z_1 + Z_2 + Z_0 + 3R_N}$$</p>`;
                            calculationHtml += `<ul>                        <li>Total Resistance ($$R_{total} = R_1 + R_2 + R_0 + 3R_N$$): ${R_total.toFixed(3)} &Omega;</li>                        <li>Total Reactance ($$X_{total} = X_1 + X_2 + X_0$$): ${X_total.toFixed(3)} &Omega;</li>                        <li>Total Impedance ($$|Z_{total}|$$): ${Z_total.toFixed(3)} &Omega;</li>                    </ul>`;
                            calculationHtml += `<p class="calculation-step">$$I_f = (3 \\times ${phaseVoltage.toFixed(2)}) / ${Z_total.toFixed(3)} = ${faultCurrent.toFixed(2)} \\text{ A}$$</p>`;

                            importanceText = `<h3>Importance (Resistive Earthed System):</h3>
                                <p>Resistive earthing limits the fault current to a safe level (e.g., 5-400A). This is crucial for:</p>
                                <ul>                            
                                    <li><strong>Equipment Protection:</strong> Prevents massive damage (melting, warping) from high fault currents.</li>
                                    <li><strong>Arc Flash Reduction:</strong> Drastically lowers the incident energy, improving personnel safety.</li>
                                    <li><strong>Overvoltage Control:</strong> Damps transient overvoltages that plague isolated systems.</li>
                                </ul>`;
                        }

                        // Populate results table for Solid/Resistive
                        resultTableBody.innerHTML = '';
                        addResultRow("Earthing System Type", systemType.charAt(0).toUpperCase() + systemType.slice(1));
                        addResultRow("System Line-to-Line Voltage", systemVoltage.toFixed(2) + " V");
                        addResultRow("Phase-to-Neutral Voltage ($$V_{L-N}$$)", phaseVoltage.toFixed(2) + " V");
                        addResultRow("Positive Sequence Impedance ($$Z_1$$)", `${R1.toFixed(3)} + j${X1.toFixed(3)} &Omega;`);
                        addResultRow("Negative Sequence Impedance ($$Z_2$$)", `${R2.toFixed(3)} + j${X2.toFixed(3)} &Omega;`);
                        addResultRow("Source Zero Sequence Impedance ($$Z_{0,source}$$)", `${R0.toFixed(3)} + j${X0.toFixed(3)} &Omega;`);
                        if (systemType === 'resistive') {
                            addResultRow("Neutral Resistor ($$R_N$$)", `${Rn.toFixed(2)} &Omega;`);
                            addResultRow("Total Fault Loop Impedance ($$Z_{total}$$)", `${Z_total.toFixed(3)} &Omega;`);
                        } else {
                            addResultRow("Total Fault Loop Impedance ($$Z_{total}$$)", `${Z_total.toFixed(3)} &Omega;`);
                        }
                        addResultRow("<strong>Calculated Earth Fault Current ($$I_f$$)</strong>", `<strong>${faultCurrent === Infinity ? "Very High" : faultCurrent.toFixed(2) + " A"}</strong>`);

                    } else if (systemType === 'isolated') {
                        const totalSystemCapacitance = parseFloat(document.getElementById('total-system-capacitance').value); // in microfarads
                        const systemFrequency = parseFloat(document.getElementById('system-frequency').value);

                        if (isNaN(totalSystemCapacitance) || totalSystemCapacitance <= 0) {
                            throw new Error("Please enter a valid positive Phase-to-Earth Capacitance.");
                        }
                        if (isNaN(systemFrequency) || (systemFrequency !== 50 && systemFrequency !== 60)) {
                            throw new Error("Please enter a valid System Frequency (50 or 60 Hz).");
                        }

                        const capacitanceFarads = totalSystemCapacitance * 1e-6; // convert µF to F
                        const omega = 2 * Math.PI * systemFrequency;
                        const Xc_ph = 1 / (omega * capacitanceFarads);
                        
                        // For a balanced system, the fault current is 3 * Vph / Xc_total, where Xc_total is the zero-sequence capacitive impedance.
                        // Xc0 = 1 / (j * 3 * w * C_ph). If = 3 * I0. I0 = Vph / (Z1 + Z2 + Xc0).
                        // A standard, accepted formula is If = 3 * Vph * w * C_ph
                        faultCurrent = 3 * omega * capacitanceFarads * phaseVoltage;

                        calculationHtml += `<p><strong>Calculation for Isolated/Unearthed System:</strong></p>`;
                        calculationHtml += `<p>In an isolated system, the fault current is capacitive, flowing through the system's phase-to-earth capacitance ($$C_{ph}$$). The fault current is the sum of the currents from the two healthy phases.</p>`;
                        calculationHtml += `<p class="formula">$$I_f = 3 \\times V_{L-N} \\times (2 \\pi f \\times C_{ph})$$</p>`;
                        calculationHtml += `<ul>                        <li>Phase-to-Earth Capacitance ($$C_{ph}$$): ${totalSystemCapacitance.toFixed(2)} &mu;F (${capacitanceFarads.toExponential(2)} F)</li>                        <li>System Frequency ($$f$$): ${systemFrequency.toFixed(0)} Hz</li>                        <li>Angular Frequency ($$\\omega = 2\\pi f$$): ${omega.toFixed(2)} rad/s</li>                    </ul>`;
                        calculationHtml += `<p class="calculation-step">$$I_f = 3 \\times ${phaseVoltage.toFixed(2)} \\times (2 \\pi \\times ${systemFrequency.toFixed(0)} \\times ${capacitanceFarads.toExponential(2)}) = ${faultCurrent.toFixed(3)} \\text{ A}$$</p>`;
                        
                        importanceText = `<h3>Importance (Isolated System):</h3>
                            <p>Isolated systems have very low fault currents, which is key for:</p>
                            <ul>                            
                                <li><strong>Service Continuity:</strong> The system can often continue to run with a single fault, allowing for a planned shutdown.</li>
                                <li><strong>Overvoltage Risk:</strong> This is the main danger. Arcing faults can cause transient overvoltages 5-6x normal, destroying insulation system-wide.</li>
                                <li><strong>Fault Detection:</strong> The current is too low for relays, requiring special ground fault detectors (GFDs) or insulation monitors (IMDs).</li>
                            </ul>`;
                        
                        // Populate results table for Isolated
                        resultTableBody.innerHTML = '';
                        addResultRow("Earthing System Type", systemType.charAt(0).toUpperCase() + systemType.slice(1));
                        addResultRow("System Line-to-Line Voltage", systemVoltage.toFixed(2) + " V");
                        addResultRow("Phase-to-Neutral Voltage ($$V_{L-N}$$)", phaseVoltage.toFixed(2) + " V");
                        addResultRow("Phase-to-Earth Capacitance ($$C_{ph}$$)", totalSystemCapacitance.toFixed(2) + " &mu;F");
                        addResultRow("System Frequency ($$f$$)", systemFrequency.toFixed(0) + " Hz");
                        addResultRow("<strong>Calculated Capacitive Fault Current ($$I_f$$)</strong>", `<strong>${faultCurrent.toFixed(3)} A</strong>`);
                    }

                    calculationDetailsDiv.innerHTML = calculationHtml;
                    standardReference.innerHTML = importanceText;

                    if (window.MathJax) {
                        window.MathJax.typesetPromise([calculationDetailsDiv, standardReference, resultTableBody]);
                    }

                    resultContainer.style.display = 'block';
                    setTimeout(() => {
                        resultContainer.classList.add('show');
                        resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 50);

                } catch (e) {
                    displayMessage(e.message, "error");
                    // Hide results on error
                    resultContainer.classList.remove('show');
                    setTimeout(() => { resultContainer.style.display = 'none'; }, 500);
                }
            });

            function addResultRow(parameter, value) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
            }

            // Theme switch logic (from perfect.txt)
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>

