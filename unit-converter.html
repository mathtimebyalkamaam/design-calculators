<!DOCTYPE html>
<html lang="en">
<head>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');   
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electrical Unit Converter - Design Calculators</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom CSS variables for theme */
        :root {
            --primary-color: #3b82f6; /* Blue */
            --secondary-color: #2563eb; /* Darker Blue */
            --text-color: #333;
            --bg-color: #f0f4f8; /* Light background */
            --card-bg: #ffffff;
            --border-color: #cbd5e1;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e8f0;
        }

        .dark-mode {
            --primary-color: #60a5fa; /* Light Blue for Header in Dark Mode */
            --secondary-color: #3b82f6; /* Blue */
            --text-color: #e2e8f0; /* Light text for general body */
            --bg-color: #1a202c; /* Dark background */
            --card-bg: #2d3748; /* Darker card background */
            --border-color: #4a5568;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --hover-color: #4a5568;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            background-color: var(--primary-color);
            color: white; /* Default white for header text */
            padding: 1.5rem 0;
            text-align: center;
            position: relative;
        }

        header .container {
            position: relative;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Specific text color for header in dark mode for better contrast */
        .dark-mode header h1,
        .dark-mode header .subtitle {
            color: #1a202c; /* Dark text to contrast with lighter primary-color in dark mode */
        }

        .theme-toggle {
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Switch for theme toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--secondary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--secondary-color);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .light-icon, .dark-icon {
            color: white;
        }

        .container {
            max-width: 1024px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 1rem;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            color: var(--primary-color);
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s;
        }

        .back-button:hover {
            color: var(--secondary-color);
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color); /* Ensure visibility in dark mode */
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-row .form-group {
            flex: 1 1 200px; /* Allows items to wrap naturally */
        }

        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .calculate-btn:hover {
            background-color: var(--secondary-color);
        }

        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        /* Ensure H3 is visible in dark mode */
        .dark-mode .result-container h3 {
            color: white; /* Explicitly set to white for visibility */
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .result-table th {
            background-color: var(--hover-color);
        }

        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position the tooltip above the text */
            left: 50%;
            margin-left: -100px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        footer {
            margin-top: 2rem;
            padding: 1.5rem 0;
            background-color: var(--card-bg);
            color: var(--text-color);
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .social-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .linkedin { background-color: #0077B5; }
        .facebook { background-color: #3b5998; }
        .twitter { background-color: #00acee; }
        .whatsapp { background-color: #25D366; }
        .reddit { background-color: #FF4500; }

        /* Modal styling */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s;
        }

        .modal.show {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .reset-btn {
            background-color: #6b7280; /* Gray for reset */
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.3s;
            margin-left: 10px;
        }

        .reset-btn:hover {
            background-color: #4b5563; /* Darker gray */
        }

        /* Styles for detailed calculation steps */
        .detailed-calculations {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--hover-color); /* A lighter background for contrast */
            color: var(--text-color); /* Ensure text visibility */
        }

        .dark-mode .detailed-calculations {
            background-color: #3a475a; /* Darker background for contrast in dark mode */
            border-color: #6a7a8f;
        }

        .detailed-calculations h4 {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary-color); /* Highlight heading */
        }
        .dark-mode .detailed-calculations h4 {
            color: var(--primary-color); /* Use lighter primary color in dark mode */
        }

        .detailed-calculations p {
            margin-bottom: 5px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .detailed-calculations strong {
            color: var(--secondary-color); /* Highlight key terms in formulas */
        }
        .dark-mode .detailed-calculations strong {
            color: var(--primary-color); /* Use lighter primary color for highlights in dark mode */
        }

        /* MathJax rendered formulas will have the desired styling */
        .formula-display {
            font-family: 'Courier New', Courier, monospace;
            background-color: rgba(0,0,0,0.05);
            padding: 2px 5px;
            border-radius: 3px;
            display: block; /* Block level for formulas for better readability */
            margin: 5px 0;
            font-size: 0.95em;
            overflow-x: auto; /* Allow horizontal scrolling for long formulas */
        }
        .dark-mode .formula-display {
            background-color: rgba(255,255,255,0.05);
        }

        .calculation-step {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .detailed-calculations .calculation-step:last-child {
            border-bottom: none; /* No border after the last step */
        }
    </style>
    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                processHtmlClass: 'math-content', // Process elements with this class
                ignoreHtmlClass: 'no-mathjax'      // Ignore elements with this class
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="antialiased">
    <header>
        <div class="container">
            <h1 class="text-3xl font-bold">Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy — Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container py-8">
        <a href="indexEle.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Tools
        </a>
        
        <div class="tool-container mt-8 p-6">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Electrical Unit Converter</h2>
            
            <div class="tool-description mb-6 text-gray-600 dark:text-gray-400">
                <p>Convert between various electrical units used in design and engineering calculations. Select a category, enter your value and units, and get instant conversions. Detailed calculation steps are provided for enhanced understanding.</p>
            </div>
            
            <div class="converter-form">
                <form id="unit-converter-form">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Input Parameters</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conversion-category">Conversion Category <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the type of electrical quantity to convert (e.g., Power, Voltage).</span></span></label>
                            <select id="conversion-category" required>
                                <option value="">Select a category</option>
                                <option value="power">Power</option>
                                <option value="voltage">Voltage</option>
                                <option value="current">Current</option>
                                <option value="resistance">Resistance</option>
                                <option value="capacitance">Capacitance</option>
                                <option value="inductance">Inductance</option>
                                <option value="energy">Energy</option>
                                <option value="frequency">Frequency</option>
                                <option value="conductance">Conductance</option>
                                <option value="charge">Charge</option>
                                <option value="magnetic_flux">Magnetic Flux</option>
                                <option value="magnetic_field_strength">Magnetic Field Strength</option>
                                <option value="magnetic_flux_density">Magnetic Flux Density</option>
                                <option value="temperature">Temperature</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="value-to-convert">Value <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the numerical value you wish to convert.</span></span></label>
                            <input type="number" id="value-to-convert" min="0" step="any" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="from-unit">From Unit <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The original unit of the value you entered.</span></span></label>
                            <select id="from-unit" required disabled>
                                <option value="">Select a unit</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="to-unit">To Unit <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The desired unit for conversion.</span></span></label>
                            <select id="to-unit" required disabled>
                                <option value="">Select a unit</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" id="power-factor-group" style="display: none;">
                        <label for="power-factor">Power Factor (PF) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Required for kVA &harr; kW conversions (0.01 to 1.0).</span></span></label>
                        <input type="number" id="power-factor" min="0.01" max="1" step="0.01" value="0.8">
                    </div>
                    
                    <button type="button" id="convert-btn" class="calculate-btn">Convert Unit</button>
                    <button type="button" id="reset-btn" class="reset-btn">Reset</button>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Conversion Result</h3>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be inserted here -->
                    </tbody>
                </table>
                <!-- Detailed calculations section -->
                <div id="detailed-calculations" class="detailed-calculations mt-6 math-content">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Detailed Calculation Steps</h3>
                    <!-- Detailed calculation steps will be dynamically inserted here -->
                </div>
                <div class="standard-reference" id="standard-reference">
                    <p>Conversions are based on standard electrical formulas and SI unit definitions. For more information, refer to international standards such as: <br>
                    - <strong>IEEE Std 260.1:</strong> Standard for Use of the International System of Units (SI) in Electrical and Electronic Practice. <br>
                    - <strong>IEC 60050:</strong> International Electrotechnical Vocabulary (IEV) - Provides definitions for electrical and electronic terms and units.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                
                <p class="text-sm">Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit mt-4">
                <p class="text-sm">Created by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share mt-4">
                <h3 class="text-lg font-semibold">Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Custom Modal for Alerts -->
    <div id="custom-alert-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-alert-modal">&times;</span>
            <p id="alert-message"></p>
            <button class="calculate-btn mt-4" id="ok-alert-button">OK</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeSwitch = document.getElementById('theme-switch');
            const body = document.body;

            // Apply saved theme preference or default to light mode
            if (localStorage.getItem('theme') === 'dark') {
                body.classList.add('dark-mode');
                themeSwitch.checked = true;
            } else {
                body.classList.remove('dark-mode');
                themeSwitch.checked = false;
            }

            // Theme toggle functionality
            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    body.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                } else {
                    body.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                }
            });

            const conversionCategorySelect = document.getElementById('conversion-category');
            const valueToConvertInput = document.getElementById('value-to-convert');
            const fromUnitSelect = document.getElementById('from-unit');
            const toUnitSelect = document.getElementById('to-unit');
            const powerFactorGroup = document.getElementById('power-factor-group');
            const powerFactorInput = document.getElementById('power-factor');
            const convertBtn = document.getElementById('convert-btn');
            const resetBtn = document.getElementById('reset-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const detailedCalculationsDiv = document.getElementById('detailed-calculations');

            // Custom Alert Modal elements
            const customAlertModal = document.getElementById('custom-alert-modal');
            const alertMessage = document.getElementById('alert-message');
            const closeAlertModalBtn = document.getElementById('close-alert-modal');
            const okAlertButton = document.getElementById('ok-alert-button');

            // Function to show custom alert
            function showCustomAlert(message) {
                alertMessage.textContent = message;
                customAlertModal.classList.add('show');
            }

            // Function to hide custom alert
            function hideCustomAlert() {
                customAlertModal.classList.remove('show');
            }

            closeAlertModalBtn.addEventListener('click', hideCustomAlert);
            okAlertButton.addEventListener('click', hideCustomAlert);
            customAlertModal.addEventListener('click', (e) => {
                if (e.target === customAlertModal) {
                    hideCustomAlert();
                }
            });

            // Define conversion units and their functions
            const units = {
                power: {
                    displayName: "Power (kW, kVA, W, hp, BTU/hr, VA, MW, MVA)",
                    options: [
                        { value: 'w', text: 'Watts (W)' },
                        { value: 'kw', text: 'Kilowatts (kW)' },
                        { value: 'mw', text: 'Megawatts (MW)' },
                        { value: 'va', text: 'Volt-Amperes (VA)' },
                        { value: 'kva', text: 'Kilovolt-Amperes (kVA)' },
                        { value: 'mva', text: 'Megavolt-Amperes (MVA)' },
                        { value: 'hp', text: 'Horsepower (hp)' },
                        { value: 'btu_hr', text: 'BTU/hr' }
                    ],
                    convert: function(value, from, to, pf = 1) {
                        let baseValueWatts; // Convert to Watts first for real power calculations
                        const steps = [];

                        // Step 1: Convert 'from' unit to base Watts (Real Power) or VA (Apparent Power)
                        let initialUnitText = getUnitText(from, 'power');
                        let intermediateValue;
                        let stepFormula = '';
                        let stepCalculation = '';

                        if (from === 'w') {
                            baseValueWatts = value;
                            steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} W. No conversion needed to base unit (Watts).`
                            });
                        } else if (from === 'kw') {
                            baseValueWatts = value * 1000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Watts`,
                                formula: `$\\text{W} = \\text{kW} \\cdot 1000$`,
                                calculation: `${value.toFixed(6)} kW \\cdot 1000 = ${baseValueWatts.toFixed(6)} W`
                            });
                        } else if (from === 'mw') {
                            baseValueWatts = value * 1000000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Watts`,
                                formula: `$\\text{W} = \\text{MW} \\cdot 10^6$`,
                                calculation: `${value.toFixed(6)} MW \\cdot 1000000 = ${baseValueWatts.toFixed(6)} W`
                            });
                        } else if (from === 'va' || from === 'kva' || from === 'mva') {
                            let baseVAPower;
                            if (from === 'va') baseVAPower = value;
                            else if (from === 'kva') baseVAPower = value * 1000;
                            else if (from === 'mva') baseVAPower = value * 1000000;

                            baseValueWatts = baseVAPower * pf; // Convert Apparent Power to Real Power
                            
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Watts (Real Power)`,
                                formula: `$\\text{W} = \\text{VA} \\cdot \\text{PF}$`,
                                calculation: `${baseVAPower.toFixed(6)} ${initialUnitText} \\cdot ${pf.toFixed(2)} = ${baseValueWatts.toFixed(6)} W`
                            });
                        } else if (from === 'hp') {
                            baseValueWatts = value * 745.7;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Watts`,
                                formula: `$\\text{W} = \\text{hp} \\cdot 745.7$`,
                                calculation: `${value.toFixed(6)} hp \\cdot 745.7 = ${baseValueWatts.toFixed(6)} W`
                            });
                        } else if (from === 'btu_hr') {
                            baseValueWatts = value * 0.293071;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Watts`,
                                formula: `$\\text{W} = \\text{BTU/hr} \\cdot 0.293071$`,
                                calculation: `${value.toFixed(6)} BTU/hr \\cdot 0.293071 = ${baseValueWatts.toFixed(6)} W`
                            });
                        } else { return { convertedValue: null, steps: [] }; } // Should not happen with proper validation

                        // Step 2: Convert from base Watts (Real Power) to 'to' unit
                        let finalValue;
                        let targetUnitText = getUnitText(to, 'power');
                        
                        if (to === 'w') {
                            finalValue = baseValueWatts;
                            steps.push({
                                title: `Step 2: Final Result in Watts`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} W.`
                            });
                        } else if (to === 'kw') {
                            finalValue = baseValueWatts / 1000;
                            steps.push({
                                title: `Step 2: Convert Watts to ${targetUnitText}`,
                                formula: `$\\text{kW} = \\frac{\\text{W}}{1000}$`,
                                calculation: `${baseValueWatts.toFixed(6)} W / 1000 = ${finalValue.toFixed(6)} kW`
                            });
                        } else if (to === 'mw') {
                            finalValue = baseValueWatts / 1000000;
                            steps.push({
                                title: `Step 2: Convert Watts to ${targetUnitText}`,
                                formula: `$\\text{MW} = \\frac{\\text{W}}{10^6}$`,
                                calculation: `${baseValueWatts.toFixed(6)} W / 1000000 = ${finalValue.toFixed(6)} MW`
                            });
                        } else if (to === 'va' || to === 'kva' || to === 'mva') {
                            let baseVAPower = baseValueWatts / pf; // Convert Real Power to Apparent Power
                            if (to === 'va') finalValue = baseVAPower;
                            else if (to === 'kva') finalValue = baseVAPower / 1000;
                            else if (to === 'mva') finalValue = baseVAPower / 1000000;
                            
                            steps.push({
                                title: `Step 2: Convert Watts (Real Power) to ${targetUnitText}`,
                                formula: `$\\text{VA} = \\frac{\\text{W}}{\\text{PF}}$`,
                                calculation: `${baseValueWatts.toFixed(6)} W / ${pf.toFixed(2)} = ${baseVAPower.toFixed(6)} VA \\rightarrow ${finalValue.toFixed(6)} ${targetUnitText}`
                            });
                        } else if (to === 'hp') {
                            finalValue = baseValueWatts / 745.7;
                            steps.push({
                                title: `Step 2: Convert Watts to ${targetUnitText}`,
                                formula: `$\\text{hp} = \\frac{\\text{W}}{745.7}$`,
                                calculation: `${baseValueWatts.toFixed(6)} W / 745.7 = ${finalValue.toFixed(6)} hp`
                            });
                        } else if (to === 'btu_hr') {
                            finalValue = baseValueWatts / 0.293071;
                            steps.push({
                                title: `Step 2: Convert Watts to ${targetUnitText}`,
                                formula: `$\\text{BTU/hr} = \\frac{\\text{W}}{0.293071}$`,
                                calculation: `${baseValueWatts.toFixed(6)} W / 0.293071 = ${finalValue.toFixed(6)} BTU/hr`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                voltage: {
                    displayName: "Voltage (V, mV, kV)",
                    options: [
                        { value: 'v', text: 'Volts (V)' },
                        { value: 'mv', text: 'Millivolts (mV)' },
                        { value: 'kv', text: 'Kilovolts (kV)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueVolts;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'voltage');
                        let targetUnitText = getUnitText(to, 'voltage');

                        if (from === 'v') {
                            baseValueVolts = value;
                            steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} V. No conversion needed to base unit (Volts).`
                            });
                        } else if (from === 'mv') {
                            baseValueVolts = value / 1000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Volts`,
                                formula: `$\\text{V} = \\frac{\\text{mV}}{1000}$`,
                                calculation: `${value.toFixed(6)} mV / 1000 = ${baseValueVolts.toFixed(6)} V`
                            });
                        } else if (from === 'kv') {
                            baseValueVolts = value * 1000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Volts`,
                                formula: `$\\text{V} = \\text{kV} \\cdot 1000$`,
                                calculation: `${value.toFixed(6)} kV \\cdot 1000 = ${baseValueVolts.toFixed(6)} V`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'v') {
                            finalValue = baseValueVolts;
                            steps.push({
                                title: `Step 2: Final Result in Volts`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} V.`
                            });
                        } else if (to === 'mv') {
                            finalValue = baseValueVolts * 1000;
                            steps.push({
                                title: `Step 2: Convert Volts to ${targetUnitText}`,
                                formula: `$\\text{mV} = \\text{V} \\cdot 1000$`,
                                calculation: `${baseValueVolts.toFixed(6)} V \\cdot 1000 = ${finalValue.toFixed(6)} mV`
                            });
                        } else if (to === 'kv') {
                            finalValue = baseValueVolts / 1000;
                            steps.push({
                                title: `Step 2: Convert Volts to ${targetUnitText}`,
                                formula: `$\\text{kV} = \\frac{\\text{V}}{1000}$`,
                                calculation: `${baseValueVolts.toFixed(6)} V / 1000 = ${finalValue.toFixed(6)} kV`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                current: {
                    displayName: "Current (A, mA, kA)",
                    options: [
                        { value: 'a', text: 'Amperes (A)' },
                        { value: 'ma', text: 'Milliamperes (mA)' },
                        { value: 'ka', text: 'Kiloamperes (kA)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueAmps;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'current');
                        let targetUnitText = getUnitText(to, 'current');

                        if (from === 'a') {
                            baseValueAmps = value;
                            steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} A. No conversion needed to base unit (Amperes).`
                            });
                        } else if (from === 'ma') {
                            baseValueAmps = value / 1000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Amperes`,
                                formula: `$\\text{A} = \\frac{\\text{mA}}{1000}$`,
                                calculation: `${value.toFixed(6)} mA / 1000 = ${baseValueAmps.toFixed(6)} A`
                            });
                        } else if (from === 'ka') {
                            baseValueAmps = value * 1000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Amperes`,
                                formula: `$\\text{A} = \\text{kA} \\cdot 1000$`,
                                calculation: `${value.toFixed(6)} kA \\cdot 1000 = ${baseValueAmps.toFixed(6)} A`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'a') {
                            finalValue = baseValueAmps;
                             steps.push({
                                title: `Step 2: Final Result in Amperes`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} A.`
                            });
                        } else if (to === 'ma') {
                            finalValue = baseValueAmps * 1000;
                            steps.push({
                                title: `Step 2: Convert Amperes to ${targetUnitText}`,
                                formula: `$\\text{mA} = \\text{A} \\cdot 1000$`,
                                calculation: `${baseValueAmps.toFixed(6)} A \\cdot 1000 = ${finalValue.toFixed(6)} mA`
                            });
                        } else if (to === 'ka') {
                            finalValue = baseValueAmps / 1000;
                            steps.push({
                                title: `Step 2: Convert Amperes to ${targetUnitText}`,
                                formula: `$\\text{kA} = \\frac{\\text{A}}{1000}$`,
                                calculation: `${baseValueAmps.toFixed(6)} A / 1000 = ${finalValue.toFixed(6)} kA`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                resistance: {
                    displayName: "Resistance (Ω, kΩ, MΩ, mΩ)",
                    options: [
                        { value: 'ohm', text: 'Ohms (Ω)' },
                        { value: 'milliohm', text: 'Milliohms (mΩ)' },
                        { value: 'kohm', text: 'Kilo-ohms (kΩ)' },
                        { value: 'mohm', text: 'Mega-ohms (MΩ)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueOhms;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'resistance');
                        let targetUnitText = getUnitText(to, 'resistance');

                        if (from === 'ohm') {
                            baseValueOhms = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} Ω. No conversion needed to base unit (Ohms).`
                            });
                        } else if (from === 'milliohm') {
                            baseValueOhms = value / 1000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Ohms`,
                                formula: `$\\Omega = \\frac{\\text{m}\\Omega}{1000}$`,
                                calculation: `${value.toFixed(6)} mΩ / 1000 = ${baseValueOhms.toFixed(6)} Ω`
                            });
                        } else if (from === 'kohm') {
                            baseValueOhms = value * 1000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Ohms`,
                                formula: `$\\Omega = \\text{k}\\Omega \\cdot 1000$`,
                                calculation: `${value.toFixed(6)} kΩ \\cdot 1000 = ${baseValueOhms.toFixed(6)} Ω`
                            });
                        } else if (from === 'mohm') {
                            baseValueOhms = value * 1000000;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Ohms`,
                                formula: `$\\Omega = \\text{M}\\Omega \\cdot 10^6$`,
                                calculation: `${value.toFixed(6)} MΩ \\cdot 1000000 = ${baseValueOhms.toFixed(6)} Ω`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'ohm') {
                            finalValue = baseValueOhms;
                            steps.push({
                                title: `Step 2: Final Result in Ohms`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} Ω.`
                            });
                        } else if (to === 'milliohm') {
                            finalValue = baseValueOhms * 1000;
                            steps.push({
                                title: `Step 2: Convert Ohms to ${targetUnitText}`,
                                formula: `$\\text{m}\\Omega = \\Omega \\cdot 1000$`,
                                calculation: `${baseValueOhms.toFixed(6)} Ω \\cdot 1000 = ${finalValue.toFixed(6)} mΩ`
                            });
                        } else if (to === 'kohm') {
                            finalValue = baseValueOhms / 1000;
                            steps.push({
                                title: `Step 2: Convert Ohms to ${targetUnitText}`,
                                formula: `$\\text{k}\\Omega = \\frac{\\Omega}{1000}$`,
                                calculation: `${baseValueOhms.toFixed(6)} Ω / 1000 = ${finalValue.toFixed(6)} kΩ`
                            });
                        } else if (to === 'mohm') {
                            finalValue = baseValueOhms / 1000000;
                            steps.push({
                                title: `Step 2: Convert Ohms to ${targetUnitText}`,
                                formula: `$\\text{M}\\Omega = \\frac{\\Omega}{10^6}$`,
                                calculation: `${baseValueOhms.toFixed(6)} Ω / 1000000 = ${finalValue.toFixed(6)} MΩ`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                capacitance: {
                    displayName: "Capacitance (F, µF, nF, pF)",
                    options: [
                        { value: 'f', text: 'Farad (F)' },
                        { value: 'uf', text: 'Microfarad (µF)' },
                        { value: 'nf', text: 'Nanofarad (nF)' },
                        { value: 'pf', text: 'Picofarad (pF)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueFarads;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'capacitance');
                        let targetUnitText = getUnitText(to, 'capacitance');

                        if (from === 'f') {
                            baseValueFarads = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(12)} F. No conversion needed to base unit (Farads).`
                            });
                        } else if (from === 'uf') {
                            baseValueFarads = value * 1e-6;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Farads`,
                                formula: `$\\text{F} = \\mu\\text{F} \\cdot 10^{-6}$`,
                                calculation: `${value.toFixed(6)} µF \\cdot 0.000001 = ${baseValueFarads.toFixed(12)} F`
                            });
                        } else if (from === 'nf') {
                            baseValueFarads = value * 1e-9;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Farads`,
                                formula: `$\\text{F} = \\text{nF} \\cdot 10^{-9}$`,
                                calculation: `${value.toFixed(6)} nF \\cdot 0.000000001 = ${baseValueFarads.toFixed(12)} F`
                            });
                        } else if (from === 'pf') {
                            baseValueFarads = value * 1e-12;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Farads`,
                                formula: `$\\text{F} = \\text{pF} \\cdot 10^{-12}$`,
                                calculation: `${value.toFixed(6)} pF \\cdot 0.000000000001 = ${baseValueFarads.toFixed(12)} F`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'f') {
                            finalValue = baseValueFarads;
                            steps.push({
                                title: `Step 2: Final Result in Farads`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(12)} F.`
                            });
                        } else if (to === 'uf') {
                            finalValue = baseValueFarads / 1e-6;
                            steps.push({
                                title: `Step 2: Convert Farads to ${targetUnitText}`,
                                formula: `$\\mu\\text{F} = \\frac{\\text{F}}{10^{-6}}$`,
                                calculation: `${baseValueFarads.toFixed(12)} F / 0.000001 = ${finalValue.toFixed(6)} µF`
                            });
                        } else if (to === 'nf') {
                            finalValue = baseValueFarads / 1e-9;
                            steps.push({
                                title: `Step 2: Convert Farads to ${targetUnitText}`,
                                formula: `$\\text{nF} = \\frac{\\text{F}}{10^{-9}}$`,
                                calculation: `${baseValueFarads.toFixed(12)} F / 0.000000001 = ${finalValue.toFixed(6)} nF`
                            });
                        } else if (to === 'pf') {
                            finalValue = baseValueFarads / 1e-12;
                            steps.push({
                                title: `Step 2: Convert Farads to ${targetUnitText}`,
                                formula: `$\\text{pF} = \\frac{\\text{F}}{10^{-12}}$`,
                                calculation: `${baseValueFarads.toFixed(12)} F / 0.000000000001 = ${finalValue.toFixed(6)} pF`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                inductance: {
                    displayName: "Inductance (H, mH, µH, nH)",
                    options: [
                        { value: 'h', text: 'Henry (H)' },
                        { value: 'mh', text: 'Millihenry (mH)' },
                        { value: 'uh', text: 'Microhenry (µH)' },
                        { value: 'nh', text: 'Nanohenry (nH)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueHenrys;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'inductance');
                        let targetUnitText = getUnitText(to, 'inductance');

                        if (from === 'h') {
                            baseValueHenrys = value;
                            steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(9)} H. No conversion needed to base unit (Henrys).`
                            });
                        } else if (from === 'mh') {
                            baseValueHenrys = value * 1e-3;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Henrys`,
                                formula: `$\\text{H} = \\text{mH} \\cdot 10^{-3}$`,
                                calculation: `${value.toFixed(6)} mH \\cdot 0.001 = ${baseValueHenrys.toFixed(9)} H`
                            });
                        } else if (from === 'uh') {
                            baseValueHenrys = value * 1e-6;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Henrys`,
                                formula: `$\\text{H} = \\mu\\text{H} \\cdot 10^{-6}$`,
                                calculation: `${value.toFixed(6)} µH \\cdot 0.000001 = ${baseValueHenrys.toFixed(9)} H`
                            });
                        } else if (from === 'nh') {
                            baseValueHenrys = value * 1e-9;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Henrys`,
                                formula: `$\\text{H} = \\text{nH} \\cdot 10^{-9}$`,
                                calculation: `${value.toFixed(6)} nH \\cdot 0.000000001 = ${baseValueHenrys.toFixed(9)} H`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'h') {
                            finalValue = baseValueHenrys;
                             steps.push({
                                title: `Step 2: Final Result in Henrys`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(9)} H.`
                            });
                        } else if (to === 'mh') {
                            finalValue = baseValueHenrys / 1e-3;
                            steps.push({
                                title: `Step 2: Convert Henrys to ${targetUnitText}`,
                                formula: `$\\text{mH} = \\frac{\\text{H}}{10^{-3}}$`,
                                calculation: `${baseValueHenrys.toFixed(9)} H / 0.001 = ${finalValue.toFixed(6)} mH`
                            });
                        } else if (to === 'uh') {
                            finalValue = baseValueHenrys / 1e-6;
                            steps.push({
                                title: `Step 2: Convert Henrys to ${targetUnitText}`,
                                formula: `$\\mu\\text{H} = \\frac{\\text{H}}{10^{-6}}$`,
                                calculation: `${baseValueHenrys.toFixed(9)} H / 0.000001 = ${finalValue.toFixed(6)} µH`
                            });
                        } else if (to === 'nh') {
                            finalValue = baseValueHenrys / 1e-9;
                            steps.push({
                                title: `Step 2: Convert Henrys to ${targetUnitText}`,
                                formula: `$\\text{nH} = \\frac{\\text{H}}{10^{-9}}$`,
                                calculation: `${baseValueHenrys.toFixed(9)} H / 0.000000001 = ${finalValue.toFixed(6)} nH`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                energy: {
                    displayName: "Energy (J, kWh, Wh, BTU)",
                    options: [
                        { value: 'j', text: 'Joule (J)' },
                        { value: 'wh', text: 'Watt-hour (Wh)' },
                        { value: 'kwh', text: 'Kilowatt-hour (kWh)' },
                        { value: 'btu', text: 'British Thermal Unit (BTU)'}
                    ],
                    convert: function(value, from, to) {
                        let baseValueJoules;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'energy');
                        let targetUnitText = getUnitText(to, 'energy');

                        if (from === 'j') {
                            baseValueJoules = value;
                            steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} J. No conversion needed to base unit (Joules).`
                            });
                        } else if (from === 'wh') {
                            baseValueJoules = value * 3600;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Joules`,
                                formula: `$\\text{J} = \\text{Wh} \\cdot 3600$`,
                                calculation: `${value.toFixed(6)} Wh \\cdot 3600 = ${baseValueJoules.toFixed(6)} J`
                            });
                        } else if (from === 'kwh') {
                            baseValueJoules = value * 3.6e6;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Joules`,
                                formula: `$\\text{J} = \\text{kWh} \\cdot 3.6 \\cdot 10^6$`,
                                calculation: `${value.toFixed(6)} kWh \\cdot 3600000 = ${baseValueJoules.toFixed(6)} J`
                            });
                        } else if (from === 'btu') {
                            baseValueJoules = value * 1055.06;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Joules`,
                                formula: `$\\text{J} = \\text{BTU} \\cdot 1055.06$`,
                                calculation: `${value.toFixed(6)} BTU \\cdot 1055.06 = ${baseValueJoules.toFixed(6)} J`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'j') {
                            finalValue = baseValueJoules;
                             steps.push({
                                title: `Step 2: Final Result in Joules`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} J.`
                            });
                        } else if (to === 'wh') {
                            finalValue = baseValueJoules / 3600;
                            steps.push({
                                title: `Step 2: Convert Joules to ${targetUnitText}`,
                                formula: `$\\text{Wh} = \\frac{\\text{J}}{3600}$`,
                                calculation: `${baseValueJoules.toFixed(6)} J / 3600 = ${finalValue.toFixed(6)} Wh`
                            });
                        } else if (to === 'kwh') {
                            finalValue = baseValueJoules / 3.6e6;
                            steps.push({
                                title: `Step 2: Convert Joules to ${targetUnitText}`,
                                formula: `$\\text{kWh} = \\frac{\\text{J}}{3.6 \\cdot 10^6}$`,
                                calculation: `${baseValueJoules.toFixed(6)} J / 3600000 = ${finalValue.toFixed(6)} kWh`
                            });
                        } else if (to === 'btu') {
                            finalValue = baseValueJoules / 1055.06;
                            steps.push({
                                title: `Step 2: Convert Joules to ${targetUnitText}`,
                                formula: `$\\text{BTU} = \\frac{\\text{J}}{1055.06}$`,
                                calculation: `${baseValueJoules.toFixed(6)} J / 1055.06 = ${finalValue.toFixed(6)} BTU`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                frequency: {
                    displayName: "Frequency (Hz, kHz, MHz, GHz)",
                    options: [
                        { value: 'hz', text: 'Hertz (Hz)' },
                        { value: 'khz', text: 'Kilohertz (kHz)' },
                        { value: 'mhz', text: 'Megahertz (MHz)' },
                        { value: 'ghz', text: 'Gigahertz (GHz)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueHz;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'frequency');
                        let targetUnitText = getUnitText(to, 'frequency');

                        if (from === 'hz') {
                            baseValueHz = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} Hz. No conversion needed to base unit (Hertz).`
                            });
                        } else if (from === 'khz') {
                            baseValueHz = value * 1e3;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Hertz`,
                                formula: `$\\text{Hz} = \\text{kHz} \\cdot 10^3$`,
                                calculation: `${value.toFixed(6)} kHz \\cdot 1000 = ${baseValueHz.toFixed(6)} Hz`
                            });
                        } else if (from === 'mhz') {
                            baseValueHz = value * 1e6;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Hertz`,
                                formula: `$\\text{Hz} = \\text{MHz} \\cdot 10^6$`,
                                calculation: `${value.toFixed(6)} MHz \\cdot 1000000 = ${baseValueHz.toFixed(6)} Hz`
                            });
                        } else if (from === 'ghz') {
                            baseValueHz = value * 1e9;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Hertz`,
                                formula: `$\\text{Hz} = \\text{GHz} \\cdot 10^9$`,
                                calculation: `${value.toFixed(6)} GHz \\cdot 1000000000 = ${baseValueHz.toFixed(6)} Hz`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'hz') {
                            finalValue = baseValueHz;
                            steps.push({
                                title: `Step 2: Final Result in Hertz`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} Hz.`
                            });
                        } else if (to === 'khz') {
                            finalValue = baseValueHz / 1e3;
                            steps.push({
                                title: `Step 2: Convert Hertz to ${targetUnitText}`,
                                formula: `$\\text{kHz} = \\frac{\\text{Hz}}{10^3}$`,
                                calculation: `${baseValueHz.toFixed(6)} Hz / 1000 = ${finalValue.toFixed(6)} kHz`
                            });
                        } else if (to === 'mhz') {
                            finalValue = baseValueHz / 1e6;
                            steps.push({
                                title: `Step 2: Convert Hertz to ${targetUnitText}`,
                                formula: `$\\text{MHz} = \\frac{\\text{Hz}}{10^6}$`,
                                calculation: `${baseValueHz.toFixed(6)} Hz / 1000000 = ${finalValue.toFixed(6)} MHz`
                            });
                        } else if (to === 'ghz') {
                            finalValue = baseValueHz / 1e9;
                            steps.push({
                                title: `Step 2: Convert Hertz to ${targetUnitText}`,
                                formula: `$\\text{GHz} = \\frac{\\text{Hz}}{10^9}$`,
                                calculation: `${baseValueHz.toFixed(6)} Hz / 1000000000 = ${finalValue.toFixed(6)} GHz`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                conductance: {
                    displayName: "Conductance (S, mS, µS, mho)",
                    options: [
                        { value: 's', text: 'Siemens (S)' },
                        { value: 'ms', text: 'MilliSiemens (mS)' },
                        { value: 'us', text: 'MicroSiemens (µS)' },
                        { value: 'mho', text: 'Mho (℧)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueSiemens;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'conductance');
                        let targetUnitText = getUnitText(to, 'conductance');

                        if (from === 's') {
                            baseValueSiemens = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} S. No conversion needed to base unit (Siemens).`
                            });
                        } else if (from === 'ms') {
                            baseValueSiemens = value * 1e-3;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Siemens`,
                                formula: `$\\text{S} = \\text{mS} \\cdot 10^{-3}$`,
                                calculation: `${value.toFixed(6)} mS \\cdot 0.001 = ${baseValueSiemens.toFixed(6)} S`
                            });
                        } else if (from === 'us') {
                            baseValueSiemens = value * 1e-6;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Siemens`,
                                formula: `$\\text{S} = \\mu\\text{S} \\cdot 10^{-6}$`,
                                calculation: `${value.toFixed(6)} µS \\cdot 0.000001 = ${baseValueSiemens.toFixed(6)} S`
                            });
                        } else if (from === 'mho') {
                            baseValueSiemens = value; // 1 mho = 1 Siemens
                            steps.push({
                                title: `Step 1: Initial Value`,
                                formula: `$\\text{S} = \\text{mho}$`,
                                calculation: `Initial value is ${value.toFixed(6)} mho. 1 mho is equivalent to 1 Siemens, so base value is ${baseValueSiemens.toFixed(6)} S.`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 's') {
                            finalValue = baseValueSiemens;
                             steps.push({
                                title: `Step 2: Final Result in Siemens`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} S.`
                            });
                        } else if (to === 'ms') {
                            finalValue = baseValueSiemens / 1e-3;
                            steps.push({
                                title: `Step 2: Convert Siemens to ${targetUnitText}`,
                                formula: `$\\text{mS} = \\frac{\\text{S}}{10^{-3}}$`,
                                calculation: `${baseValueSiemens.toFixed(6)} S / 0.001 = ${finalValue.toFixed(6)} mS`
                            });
                        } else if (to === 'us') {
                            finalValue = baseValueSiemens / 1e-6;
                            steps.push({
                                title: `Step 2: Convert Siemens to ${targetUnitText}`,
                                formula: `$\\mu\\text{S} = \\frac{\\text{S}}{10^{-6}}$`,
                                calculation: `${baseValueSiemens.toFixed(6)} S / 0.000001 = ${finalValue.toFixed(6)} µS`
                            });
                        } else if (to === 'mho') {
                            finalValue = baseValueSiemens;
                            steps.push({
                                title: `Step 2: Convert Siemens to ${targetUnitText}`,
                                formula: `$\\text{mho} = \\text{S}$`,
                                calculation: `${baseValueSiemens.toFixed(6)} S = ${finalValue.toFixed(6)} mho`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                charge: {
                    displayName: "Charge (C, mC, µC, nC, pC)",
                    options: [
                        { value: 'c', text: 'Coulomb (C)' },
                        { value: 'mc', text: 'MilliCoulomb (mC)' },
                        { value: 'uc', text: 'MicroCoulomb (µC)' },
                        { value: 'nc', text: 'NanoCoulomb (nC)' },
                        { value: 'pc', text: 'PicoCoulomb (pC)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueCoulombs;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'charge');
                        let targetUnitText = getUnitText(to, 'charge');

                        if (from === 'c') {
                            baseValueCoulombs = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(12)} C. No conversion needed to base unit (Coulombs).`
                            });
                        } else if (from === 'mc') {
                            baseValueCoulombs = value * 1e-3;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Coulombs`,
                                formula: `$\\text{C} = \\text{mC} \\cdot 10^{-3}$`,
                                calculation: `${value.toFixed(6)} mC \\cdot 0.001 = ${baseValueCoulombs.toFixed(12)} C`
                            });
                        } else if (from === 'uc') {
                            baseValueCoulombs = value * 1e-6;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Coulombs`,
                                formula: `$\\text{C} = \\mu\\text{C} \\cdot 10^{-6}$`,
                                calculation: `${value.toFixed(6)} µC \\cdot 0.000001 = ${baseValueCoulombs.toFixed(12)} C`
                            });
                        } else if (from === 'nc') {
                            baseValueCoulombs = value * 1e-9;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Coulombs`,
                                formula: `$\\text{C} = \\text{nC} \\cdot 10^{-9}$`,
                                calculation: `${value.toFixed(6)} nC \\cdot 0.000000001 = ${baseValueCoulombs.toFixed(12)} C`
                            });
                        } else if (from === 'pc') {
                            baseValueCoulombs = value * 1e-12;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Coulombs`,
                                formula: `$\\text{C} = \\text{pC} \\cdot 10^{-12}$`,
                                calculation: `${value.toFixed(6)} pC \\cdot 0.000000000001 = ${baseValueCoulombs.toFixed(12)} C`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'c') {
                            finalValue = baseValueCoulombs;
                             steps.push({
                                title: `Step 2: Final Result in Coulombs`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(12)} C.`
                            });
                        } else if (to === 'mc') {
                            finalValue = baseValueCoulombs / 1e-3;
                            steps.push({
                                title: `Step 2: Convert Coulombs to ${targetUnitText}`,
                                formula: `$\\text{mC} = \\frac{\\text{C}}{10^{-3}}$`,
                                calculation: `${baseValueCoulombs.toFixed(12)} C / 0.001 = ${finalValue.toFixed(6)} mC`
                            });
                        } else if (to === 'uc') {
                            finalValue = baseValueCoulombs / 1e-6;
                            steps.push({
                                title: `Step 2: Convert Coulombs to ${targetUnitText}`,
                                formula: `$\\mu\\text{C} = \\frac{\\text{C}}{10^{-6}}$`,
                                calculation: `${baseValueCoulombs.toFixed(12)} C / 0.000001 = ${finalValue.toFixed(6)} µC`
                            });
                        } else if (to === 'nc') {
                            finalValue = baseValueCoulombs / 1e-9;
                            steps.push({
                                title: `Step 2: Convert Coulombs to ${targetUnitText}`,
                                formula: `$\\text{nC} = \\frac{\\text{C}}{10^{-9}}$`,
                                calculation: `${baseValueCoulombs.toFixed(12)} C / 0.000000001 = ${finalValue.toFixed(6)} nC`
                            });
                        } else if (to === 'pc') {
                            finalValue = baseValueCoulombs / 1e-12;
                            steps.push({
                                title: `Step 2: Convert Coulombs to ${targetUnitText}`,
                                formula: `$\\text{pC} = \\frac{\\text{C}}{10^{-12}}$`,
                                calculation: `${baseValueCoulombs.toFixed(12)} C / 0.000000000001 = ${finalValue.toFixed(6)} pC`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                magnetic_flux: {
                    displayName: "Magnetic Flux (Wb, Mx)",
                    options: [
                        { value: 'wb', text: 'Weber (Wb)' },
                        { value: 'mx', text: 'Maxwell (Mx)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueWebers;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'magnetic_flux');
                        let targetUnitText = getUnitText(to, 'magnetic_flux');

                        if (from === 'wb') {
                            baseValueWebers = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(10)} Wb. No conversion needed to base unit (Webers).`
                            });
                        } else if (from === 'mx') {
                            baseValueWebers = value * 1e-8;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Webers`,
                                formula: `$\\text{Wb} = \\text{Mx} \\cdot 10^{-8}$`,
                                calculation: `${value.toFixed(6)} Mx \\cdot 0.00000001 = ${baseValueWebers.toFixed(10)} Wb`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'wb') {
                            finalValue = baseValueWebers;
                             steps.push({
                                title: `Step 2: Final Result in Webers`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(10)} Wb.`
                            });
                        } else if (to === 'mx') {
                            finalValue = baseValueWebers / 1e-8;
                            steps.push({
                                title: `Step 2: Convert Webers to ${targetUnitText}`,
                                formula: `$\\text{Mx} = \\frac{\\text{Wb}}{10^{-8}}$`,
                                calculation: `${baseValueWebers.toFixed(10)} Wb / 0.00000001 = ${finalValue.toFixed(6)} Mx`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                magnetic_field_strength: {
                    displayName: "Magnetic Field Strength (A/m, Oe)",
                    options: [
                        { value: 'at_m', text: 'Ampere-turn/meter (AT/m)' },
                        { value: 'oe', text: 'Oersted (Oe)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueAmpsPerMeter;
                        const OE_TO_AT_M = 1000 / (4 * Math.PI); // 1 Oersted = (1000 / 4π) A/m ≈ 79.57747 A/m
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'magnetic_field_strength');
                        let targetUnitText = getUnitText(to, 'magnetic_field_strength');

                        if (from === 'at_m') {
                            baseValueAmpsPerMeter = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} AT/m. No conversion needed to base unit (Ampere-turn/meter).`
                            });
                        } else if (from === 'oe') {
                            baseValueAmpsPerMeter = value * OE_TO_AT_M;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Ampere-turn/meter`,
                                formula: `$\\text{AT/m} = \\text{Oe} \\cdot \\frac{1000}{4\\pi}$`,
                                calculation: `${value.toFixed(6)} Oe \\cdot ${OE_TO_AT_M.toFixed(5)} = ${baseValueAmpsPerMeter.toFixed(6)} AT/m`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'at_m') {
                            finalValue = baseValueAmpsPerMeter;
                             steps.push({
                                title: `Step 2: Final Result in Ampere-turn/meter`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} AT/m.`
                            });
                        } else if (to === 'oe') {
                            finalValue = baseValueAmpsPerMeter / OE_TO_AT_M;
                            steps.push({
                                title: `Step 2: Convert Ampere-turn/meter to ${targetUnitText}`,
                                formula: `$\\text{Oe} = \\frac{\\text{AT/m}}{\\frac{1000}{4\\pi}}$`,
                                calculation: `${baseValueAmpsPerMeter.toFixed(6)} AT/m / ${OE_TO_AT_M.toFixed(5)} = ${finalValue.toFixed(6)} Oe`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                magnetic_flux_density: {
                    displayName: "Magnetic Flux Density (T, G)",
                    options: [
                        { value: 't', text: 'Tesla (T)' },
                        { value: 'g', text: 'Gauss (G)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueTeslas;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'magnetic_flux_density');
                        let targetUnitText = getUnitText(to, 'magnetic_flux_density');

                        if (from === 't') {
                            baseValueTeslas = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(6)} T. No conversion needed to base unit (Tesla).`
                            });
                        } else if (from === 'g') {
                            baseValueTeslas = value * 1e-4;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Tesla`,
                                formula: `$\\text{T} = \\text{G} \\cdot 10^{-4}$`,
                                calculation: `${value.toFixed(6)} G \\cdot 0.0001 = ${baseValueTeslas.toFixed(6)} T`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 't') {
                            finalValue = baseValueTeslas;
                             steps.push({
                                title: `Step 2: Final Result in Tesla`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(6)} T.`
                            });
                        } else if (to === 'g') {
                            finalValue = baseValueTeslas / 1e-4;
                            steps.push({
                                title: `Step 2: Convert Tesla to ${targetUnitText}`,
                                formula: `$\\text{G} = \\frac{\\text{T}}{10^{-4}}$`,
                                calculation: `${baseValueTeslas.toFixed(6)} T / 0.0001 = ${finalValue.toFixed(6)} G`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                },
                temperature: {
                    displayName: "Temperature (°C, °F, K)",
                    options: [
                        { value: 'celsius', text: 'Celsius (°C)' },
                        { value: 'fahrenheit', text: 'Fahrenheit (°F)' },
                        { value: 'kelvin', text: 'Kelvin (K)' }
                    ],
                    convert: function(value, from, to) {
                        let baseValueCelsius;
                        const steps = [];
                        let initialUnitText = getUnitText(from, 'temperature');
                        let targetUnitText = getUnitText(to, 'temperature');

                        if (from === 'celsius') {
                            baseValueCelsius = value;
                             steps.push({
                                title: `Step 1: Initial Value`,
                                formula: '',
                                calculation: `Initial value is ${value.toFixed(2)} °C. No conversion needed to base unit (Celsius).`
                            });
                        } else if (from === 'fahrenheit') {
                            baseValueCelsius = (value - 32) * 5/9;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Celsius`,
                                formula: `$\\text{°C} = (\\text{°F} - 32) \\cdot \\frac{5}{9}$`,
                                calculation: `(${value.toFixed(2)} °F - 32) \\cdot 5/9 = ${baseValueCelsius.toFixed(2)} °C`
                            });
                        } else if (from === 'kelvin') {
                            baseValueCelsius = value - 273.15;
                            steps.push({
                                title: `Step 1: Convert ${initialUnitText} to Celsius`,
                                formula: `$\\text{°C} = \\text{K} - 273.15$`,
                                calculation: `${value.toFixed(2)} K - 273.15 = ${baseValueCelsius.toFixed(2)} °C`
                            });
                        } else { return { convertedValue: null, steps: [] }; }

                        let finalValue;
                        if (to === 'celsius') {
                            finalValue = baseValueCelsius;
                             steps.push({
                                title: `Step 2: Final Result in Celsius`,
                                formula: '',
                                calculation: `Converted value is ${finalValue.toFixed(2)} °C.`
                            });
                        } else if (to === 'fahrenheit') {
                            finalValue = (baseValueCelsius * 9/5) + 32;
                            steps.push({
                                title: `Step 2: Convert Celsius to ${targetUnitText}`,
                                formula: `$\\text{°F} = (\\text{°C} \\cdot \\frac{9}{5}) + 32$`,
                                calculation: `(${baseValueCelsius.toFixed(2)} °C \\cdot 9/5) + 32 = ${finalValue.toFixed(2)} °F`
                            });
                        } else if (to === 'kelvin') {
                            finalValue = baseValueCelsius + 273.15;
                            steps.push({
                                title: `Step 2: Convert Celsius to ${targetUnitText}`,
                                formula: `$\\text{K} = \\text{°C} + 273.15$`,
                                calculation: `${baseValueCelsius.toFixed(2)} °C + 273.15 = ${finalValue.toFixed(2)} K`
                            });
                        } else { return { convertedValue: null, steps: [] }; }
                        return { convertedValue: finalValue, steps: steps };
                    }
                }
            };

            // Populate unit dropdowns based on selected category
            conversionCategorySelect.addEventListener('change', function() {
                const category = this.value;
                const selectedCategory = units[category];

                // Clear existing options
                fromUnitSelect.innerHTML = '<option value="">Select a unit</option>';
                toUnitSelect.innerHTML = '<option value="">Select a unit</option>';

                if (selectedCategory) {
                    selectedCategory.options.forEach(unit => {
                        const optionFrom = document.createElement('option');
                        optionFrom.value = unit.value;
                        optionFrom.textContent = unit.text;
                        fromUnitSelect.appendChild(optionFrom);

                        const optionTo = document.createElement('option');
                        optionTo.value = unit.value;
                        optionTo.textContent = unit.text;
                        toUnitSelect.appendChild(optionTo);
                    });
                    fromUnitSelect.disabled = false;
                    toUnitSelect.disabled = false;

                    // Show/hide power factor based on category and selected units
                    if (category === 'power') {
                        powerFactorGroup.style.display = 'block';
                        powerFactorInput.required = true;
                    } else {
                        powerFactorGroup.style.display = 'none';
                        powerFactorInput.required = false;
                    }
                } else {
                    fromUnitSelect.disabled = true;
                    toUnitSelect.disabled = true;
                    powerFactorGroup.style.display = 'none';
                    powerFactorInput.required = false;
                }
                resultContainer.style.display = 'none'; // Hide results when category changes
                detailedCalculationsDiv.innerHTML = '<h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Detailed Calculation Steps</h3>'; // Clear detailed steps
            });

            convertBtn.addEventListener('click', function() {
                const category = conversionCategorySelect.value;
                const value = parseFloat(valueToConvertInput.value);
                const fromUnit = fromUnitSelect.value;
                const toUnit = toUnitSelect.value;
                const powerFactor = parseFloat(powerFactorInput.value);

                // Input validation
                if (!category || isNaN(value) || !fromUnit || !toUnit) {
                    showCustomAlert("Please fill in all required fields (Category, Value, From Unit, To Unit).");
                    return;
                }
                if (value < 0 && category !== 'temperature') { // Allow negative temps
                    showCustomAlert("Please enter a non-negative value for conversion.");
                    return;
                }
                if (category === 'power' && (fromUnit.includes('va') || fromUnit.includes('VA') || toUnit.includes('va') || toUnit.includes('VA')) && (isNaN(powerFactor) || powerFactor <= 0 || powerFactor > 1)) {
                    showCustomAlert("Please enter a valid Power Factor between 0.01 and 1.0 for kVA/MVA/VA conversions.");
                    return;
                }
                if (fromUnit === toUnit) {
                    showCustomAlert("Please select different 'From' and 'To' units for conversion.");
                    return;
                }

                const selectedCategory = units[category];
                let conversionResult; // This will hold { convertedValue, steps }

                try {
                    // Check if power factor is needed for the specific power conversion
                    const requiresPF = (fromUnit.includes('va') || fromUnit.includes('VA') || toUnit.includes('va') || toUnit.includes('VA')) && category === 'power';

                    if (requiresPF) {
                        conversionResult = selectedCategory.convert(value, fromUnit, toUnit, powerFactor);
                    } else {
                        conversionResult = selectedCategory.convert(value, fromUnit, toUnit);
                    }

                    if (conversionResult.convertedValue === null) {
                        showCustomAlert("Conversion not supported for the selected units.");
                        return;
                    }

                    // Display summary results
                    resultTableBody.innerHTML = '';
                    addResultRow("Original Value", `${value} ${getUnitText(fromUnit, category)}`);
                    addResultRow("Converted Value", `${conversionResult.convertedValue.toFixed(6)} ${getUnitText(toUnit, category)}`);

                    if (requiresPF) {
                        addResultRow("Power Factor Used", powerFactor.toFixed(2));
                    }

                    // Display detailed calculations
                    detailedCalculationsDiv.innerHTML = '<h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Detailed Calculation Steps</h3>';
                    conversionResult.steps.forEach(step => {
                        addDetailedCalculationStep(step.title, step.formula, step.calculation);
                    });


                    resultContainer.style.display = 'block';
                    resultContainer.scrollIntoView({ behavior: 'smooth' });

                    // IMPORTANT: Tell MathJax to re-render the newly added content after a small delay
                    if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                        setTimeout(() => {
                            window.MathJax.typesetPromise([detailedCalculationsDiv])
                                .catch((err) => console.error('MathJax typesetting failed:', err));
                        }, 50); 
                    }

                } catch (error) {
                    console.error("Conversion error:", error);
                    showCustomAlert("An error occurred during conversion. Please check your inputs.");
                }
            });

            // Reset button functionality
            resetBtn.addEventListener('click', function() {
                document.getElementById('unit-converter-form').reset();
                fromUnitSelect.innerHTML = '<option value="">Select a unit</option>';
                toUnitSelect.innerHTML = '<option value="">Select a unit</option>';
                fromUnitSelect.disabled = true;
                toUnitSelect.disabled = true;
                powerFactorGroup.style.display = 'none';
                powerFactorInput.required = false;
                resultContainer.style.display = 'none';
                resultTableBody.innerHTML = '';
                detailedCalculationsDiv.innerHTML = '<h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Detailed Calculation Steps</h3>'; // Clear detailed steps
            });

            // Helper function to get display text for a unit
            function getUnitText(unitValue, category) {
                const categoryOptions = units[category]?.options;
                if (categoryOptions) {
                    const unit = categoryOptions.find(opt => opt.value === unitValue);
                    return unit ? unit.text : unitValue;
                }
                return unitValue;
            }
            
            // Helper function to add a row to the result table
            function addResultRow(parameter, value) {
                const row = document.createElement('tr');
                
                const paramCell = document.createElement('td');
                paramCell.textContent = parameter;
                paramCell.classList.add('font-medium');
                
                const valueCell = document.createElement('td');
                valueCell.textContent = value;
                
                row.appendChild(paramCell);
                row.appendChild(valueCell);
                
                resultTableBody.appendChild(row);
            }

            // Helper function to add a detailed calculation step
            function addDetailedCalculationStep(stepTitle, formulaText, calculationText) {
                const stepDiv = document.createElement('div');
                stepDiv.classList.add('calculation-step');

                const titleElem = document.createElement('h4');
                titleElem.textContent = stepTitle;
                stepDiv.appendChild(titleElem);

                if (formulaText) {
                    const formulaElem = document.createElement('p');
                    formulaElem.classList.add('formula-display');
                    formulaElem.innerHTML = formulaText; 
                    stepDiv.appendChild(formulaElem);
                }

                if (calculationText) {
                    const calcElem = document.createElement('p');
                    // No 'formula-display' class here as it's not a formula, just text
                    calcElem.textContent = "Calculation: " + calculationText; 
                    stepDiv.appendChild(calcElem);
                }
                detailedCalculationsDiv.appendChild(stepDiv);
            }
        });
    </script>
</body>
</html>
