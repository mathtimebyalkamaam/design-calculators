<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lighting Load - Design Calculators - Electrical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #3b8e3e);
            --reset-button-bg: #FFC107; /* Yellow for reset */
            --reset-button-hover-bg: #E0A800; /* Darker yellow */
            --clear-button-bg: #007bff; /* Blue for clear */
            --clear-button-hover-bg: #0056b3; /* Darker blue */
            --ok-color: #28a745; /* Green for OK status */
            --error-color: #dc3545; /* Red for error status */
            --warning-color: #ffc107; /* Amber for warnings */
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #446688;
            --button-gradient: linear-gradient(45deg, #3b8e3e, #4CAF50);
            --button-hover-gradient: linear-gradient(45deg, #4CAF50, #5cb85c);
            --reset-button-bg: #FFD700; /* Gold/Yellow for dark mode reset */
            --reset-button-hover-bg: #DAA520; /* Darker gold/yellow */
            --clear-button-bg: #17a2b8; /* Cyan for dark mode clear */
            --clear-button-hover-bg: #138496;
            --ok-color: #5cb85c;
            --error-color: #e74c3c;
            --warning-color: #DAA520;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-color), #e0e0e0);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.3s;
            width: fit-content; 
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px; /* Default margin for form groups */
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg); /* Use card-bg for input background */
            color: var(--text-color);
            box-sizing: border-box; /* Ensure padding doesn't increase width */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
            gap: 20px; /* Gap between grid items */
            margin-bottom: 0; /* Handled by form-group margin */
        }
        
        .calculate-btn {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 12px 30px; /* Increased padding for better appearance */
            border-radius: 25px; /* More rounded */
            cursor: pointer;
            font-size: 1.1em; /* Slightly larger font */
            font-weight: bold;
            margin-top: 25px; /* More space above button */
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto; /* Allow button to size based on content and padding */
            min-width: 220px; /* Ensure a minimum width for consistency */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .calculate-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02); /* Lift and slightly scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }

        .reset-btn {
            background-color: var(--reset-button-bg);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 25px;
            margin-left: 15px; /* Space from calculate button */
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .reset-btn:hover {
            background-color: var(--reset-button-hover-bg);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .clear-results-btn {
            background-color: var(--clear-button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .clear-results-btn:hover {
            background-color: var(--clear-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For animation */
            transform: translateY(20px); /* Initial state for animation */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners apply to table content */
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color); /* Highlight row on hover */
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--hover-color);
            border-radius: 4px;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: color 0.3s;
        }

        .info-icon:hover {
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px); /* Initial state for tooltip animation */
            font-size: 0.85em;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: flex; /* Use flex for centering text */
            align-items: center;
            justify-content: center;
            min-width: 250px;
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* More space */
            font-size: 0.95em;
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px; /* More space */
            text-align: center;
            font-size: 1.2em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif; /* A font suitable for mathematical formulas */
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 12px 10px; /* Increased padding */
            background-color: var(--hover-color);
            border-radius: 6px; /* More rounded */
            margin: 15px 0; /* More space */
            overflow-x: auto; /* Allow horizontal scrolling for long formulas */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace; /* Monospace for steps */
            background-color: var(--hover-color);
            padding: 8px 15px; /* Increased padding */
            border-radius: 4px; /* More rounded */
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-break: break-word; /* Break long words */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px; /* Increased margin */
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
        }

        /* Style for centering the button */
        .button-wrapper {
            display: flex;
            justify-content: center; /* Center the button horizontally */
            width: 100%; /* Ensure it takes full width to center effectively */
            padding-top: 20px; /* Add more spacing above the button */
        }

        /* Animation for input fields on focus */
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4); /* Green glow, slightly more pronounced */
            outline: none;
            animation: pulse 0.8s infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4);
            }
            to {
                box-shadow: 0 0 0 8px rgba(76, 175, 80, 0.2); /* Softer pulse */
            }
        }
        /* Specific styles for Lighting Load Calculator */
        #lighting-guidance-section {
            display: none; /* Hidden by default */
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        #lighting-guidance-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        #lighting-guidance-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }
        #lighting-guidance-section p, #lighting-guidance-section ul {
            font-size: 0.9em;
            color: var(--text-color);
        }
        #lighting-guidance-section strong {
            color: var(--primary-color);
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            header h1 {
                font-size: 2em;
            }

            .form-row {
                grid-template-columns: 1fr; /* Stack columns on small screens */
            }

            .calculate-btn, .reset-btn {
                width: 100%;
                margin-left: 0;
                margin-top: 15px;
            }

            .button-wrapper {
                flex-direction: column; /* Stack buttons vertically */
                align-items: center; /* Center stacked buttons */
            }

            .theme-toggle {
                position: static; /* Remove absolute positioning on small screens */
                justify-content: center;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Smart Tools for Modern Electrical Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </div>
        
        <div class="tool-container">
            <h2>Lighting Load Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator assists electrical engineers in determining illumination requirements, luminaire spacing, and estimating lighting circuit loads for various indoor and outdoor spaces. It provides guidance based on common lighting design principles and international standards.</p>
                <p style="font-weight: bold; color: var(--error-color);">Disclaimer: This tool provides preliminary calculations for guidance only. Actual lighting design requires detailed photometric analysis, consideration of specific luminaire data, and adherence to local codes and project-specific requirements. Always consult relevant standards and qualified lighting designers or engineers for final designs.</p>
            </div>
        
            <div class="calculator-form">
                <form id="lighting-calculator-form">
                    <!-- Area Details -->
                    <div class="form-section">
                        <h3>Area Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="area-type">Area Type / Application <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the type of area or specific lighting application. This influences recommended illuminance levels and relevant inputs.</span></span></label>
                                <select id="area-type" required>
                                    <option value="office_general">Office - General Work Area</option>
                                    <option value="office_drawing">Office - Drawing/CAD Work</option>
                                    <option value="warehouse_storage">Warehouse - General Storage</option>
                                    <option value="warehouse_aisle">Warehouse - Aisle (High Rack)</option>
                                    <option value="industrial_shed_general">Industrial Shed - General</option>
                                    <option value="industrial_shed_fine_work">Industrial Shed - Fine Work</option>
                                    <option value="industrial_laboratory">Industrial - Laboratory</option>
                                    <option value="industrial_workshop">Industrial - Workshop</option>
                                    <option value="industrial_plant_area">Industrial - Plant Area (General)</option>
                                    <option value="retail_store_general">Retail Store - General</option>
                                    <option value="retail_store_display">Retail Store - Display Area</option>
                                    <option value="residential_living_room">Residential - Living Room</option>
                                    <option value="residential_kitchen">Residential - Kitchen</option>
                                    <option value="residential_bedroom">Residential - Bedroom</option>
                                    <option value="outdoor_pathway">Outdoor - Pathway/Walkway</option>
                                    <option value="outdoor_parking">Outdoor - Parking Area</option>
                                    <option value="outdoor_road">Outdoor - Road/Street Lighting</option>
                                    <option value="outdoor_security">Outdoor - Security Lighting (Perimeter)</option>
                                    <option value="fire_station_apparatus_bay">Fire Station - Apparatus Bay</option>
                                    <option value="emergency_exit">Emergency - Exit Route</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="room-length">Area Length (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The longest dimension of the area in meters.</span></span></label>
                                <input type="number" id="room-length" step="0.1" min="1" value="10" required>
                            </div>
                            <div class="form-group">
                                <label for="room-width">Area Width (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The shortest dimension of the area in meters.</span></span></label>
                                <input type="number" id="room-width" step="0.1" min="1" value="8" required>
                            </div>
                            <div class="form-group" id="room-height-group">
                                <label for="room-height">Room Height (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The height from the floor to the ceiling in meters (for indoor areas).</span></span></label>
                                <input type="number" id="room-height" step="0.1" min="2" value="3" required>
                            </div>
                            <div class="form-group" id="mounting-height-group">
                                <label for="mounting-height">Luminaire Mounting Height (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The height from the floor (or ground) to the bottom of the luminaire. Crucial for spacing and uniformity.</span></span></label>
                                <input type="number" id="mounting-height" step="0.1" min="1" value="2.7" required>
                            </div>
                            <div class="form-group" id="pole-height-group" style="display: none;">
                                <label for="pole-height">Pole Height (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The height of the lighting pole from the ground (for outdoor areas).</span></span></label>
                                <input type="number" id="pole-height" step="0.1" min="3" value="8" required>
                            </div>
                            <div class="form-group">
                                <label for="working-plane-height">Working Plane Height (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The height above the floor/ground where the main task is performed (e.g., desk height, ground level for outdoor). Typical: 0.75m - 0.85m for indoor tasks, 0m for outdoor.</span></span></label>
                                <input type="number" id="working-plane-height" step="0.01" min="0" value="0.8" required>
                            </div>
                            <div class="form-group">
                                <label for="light-loss-factor">Light Loss Factor (LLF) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Combines lamp lumen depreciation, luminaire dirt depreciation, and other factors. Accounts for light reduction over time. Typical: 0.65 - 0.85.</span></span></label>
                                <input type="number" id="light-loss-factor" step="0.01" min="0.5" max="1.0" value="0.8" required>
                            </div>
                        </div>
                    </div>

                    <!-- Surface Reflectances (Indoor Only) -->
                    <div class="form-section" id="reflectance-section">
                        <h3>Surface Reflectances (%) (Indoor Areas)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ceiling-reflectance">Ceiling Reflectance (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Percentage of light reflected by the ceiling surface. Typical: 70-90% for white/light colors.</span></span></label>
                                <input type="number" id="ceiling-reflectance" step="1" min="0" max="100" value="80" required>
                            </div>
                            <div class="form-group">
                                <label for="wall-reflectance">Wall Reflectance (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Percentage of light reflected by the wall surfaces. Typical: 50-70% for light colors.</span></span></label>
                                <input type="number" id="wall-reflectance" step="1" min="0" max="100" value="60" required>
                            </div>
                            <div class="form-group">
                                <label for="floor-reflectance">Floor Reflectance (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Percentage of light reflected by the floor surface. Typical: 20-30% for medium colors.</span></span></label>
                                <input type="number" id="floor-reflectance" step="1" min="0" max="100" value="20" required>
                            </div>
                        </div>
                    </div>

                    <!-- Illumination Requirements & Luminaire Details -->
                    <div class="form-section">
                        <h3>Illumination & Luminaire Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="required-illuminance">Required Illuminance (Lux) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The average illuminance level required on the working plane. This value is suggested based on Area Type, but can be adjusted.</span></span></label>
                                <input type="number" id="required-illuminance" step="1" min="1" value="500" required>
                            </div>
                            <div class="form-group">
                                <label for="luminaire-type">Luminaire Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select a common luminaire type. This influences typical Coefficient of Utilization (CU) values and general application.</span></span></label>
                                <select id="luminaire-type" required>
                                    <option value="led_panel">LED Panel (Recessed/Surface)</option>
                                    <option value="fluorescent_troffer">Fluorescent Troffer (Recessed)</option>
                                    <option value="led_downlight">LED Downlight</option>
                                    <option value="high_bay_led">High Bay LED (Industrial/Warehouse)</option>
                                    <option value="linear_fluorescent">Linear Fluorescent (Suspended)</option>
                                    <option value="outdoor_area_light">Outdoor Area/Street Light</option>
                                    <option value="floodlight">Floodlight (Security/Facade)</option>
                                    <option value="residential_fixture">Residential Fixture (General)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="luminaire-distribution">Luminaire Light Distribution <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Describes how light is spread from the luminaire. Important for uniformity and spacing.</span></span></label>
                                <select id="luminaire-distribution" required>
                                    <option value="general">General/Symmetric</option>
                                    <option value="narrow">Narrow Beam</option>
                                    <option value="wide">Wide Beam</option>
                                    <option value="asymmetric">Asymmetric</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="luminous-flux-per-luminaire">Luminous Flux per Luminaire (lm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total light output (lumens) from a single luminaire. Obtain from manufacturer's datasheet.</span></span></label>
                                <input type="number" id="luminous-flux-per-luminaire" step="1" min="1" value="3500" required>
                            </div>
                            <div class="form-group">
                                <label for="wattage-per-luminaire">Wattage per Luminaire (W) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Electrical power consumption of a single luminaire in Watts. Obtain from manufacturer's datasheet.</span></span></label>
                                <input type="number" id="wattage-per-luminaire" step="0.1" min="1" value="30" required>
                            </div>
                            <div class="form-group">
                                <label for="luminaire-power-factor">Luminaire Power Factor (PF) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Electrical power factor of the luminaire. Typical: 0.9 - 0.99 for modern LED drivers.</span></span></label>
                                <input type="number" id="luminaire-power-factor" step="0.01" min="0.5" max="1.0" value="0.95" required>
                            </div>
                        </div>
                    </div>

                    <!-- Electrical System Details -->
                    <div class="form-section">
                        <h3>Electrical System Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="supply-voltage">Supply Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Nominal line-to-neutral or line-to-line voltage of the electrical supply.</span></span></label>
                                <input type="number" id="supply-voltage" step="1" min="100" value="230" required>
                            </div>
                            <div class="form-group">
                                <label for="phase-type">Phase Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select single-phase or three-phase supply for load calculation.</span></span></label>
                                <select id="phase-type" required>
                                    <option value="single_phase">Single Phase</option>
                                    <option value="three_phase">Three Phase</option>
                                </select>
                            </div>
                             <div class="form-group">
                                <label for="diversity-factor">Diversity Factor (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The ratio of the sum of the maximum demands of the sub-circuits to the maximum demand of the main circuit. Accounts for non-simultaneous use of all lights. Typical: 80-100%.</span></span></label>
                                <input type="number" id="diversity-factor" step="1" min="50" max="100" value="100" required>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="calculate-btn">Calculate Lighting Load</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Calculated Lighting Parameters</h3>
                <div id="calculation-details">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Calculated Value</th>
                            <th>Unit</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
                </div>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>This calculator provides preliminary calculations for guidance only. Actual lighting design requires detailed photometric analysis, consideration of specific luminaire data, and adherence to local codes and project-specific requirements. Always consult relevant standards and qualified lighting designers or engineers for final designs.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Electrical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Electrical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Input elements
            const areaTypeInput = document.getElementById('area-type');
            const roomLengthInput = document.getElementById('room-length');
            const roomWidthInput = document.getElementById('room-width');
            const roomHeightInput = document.getElementById('room-height');
            const mountingHeightInput = document.getElementById('mounting-height');
            const poleHeightInput = document.getElementById('pole-height');
            const workingPlaneHeightInput = document.getElementById('working-plane-height');
            const lightLossFactorInput = document.getElementById('light-loss-factor');
            const ceilingReflectanceInput = document.getElementById('ceiling-reflectance');
            const wallReflectanceInput = document.getElementById('wall-reflectance');
            const floorReflectanceInput = document.getElementById('floor-reflectance');
            const requiredIlluminanceInput = document.getElementById('required-illuminance');
            const luminaireTypeInput = document.getElementById('luminaire-type');
            const luminaireDistributionInput = document.getElementById('luminaire-distribution');
            const luminousFluxPerLuminaireInput = document.getElementById('luminous-flux-per-luminaire');
            const wattagePerLuminaireInput = document.getElementById('wattage-per-luminaire');
            const luminairePowerFactorInput = document.getElementById('luminaire-power-factor');
            const supplyVoltageInput = document.getElementById('supply-voltage');
            const phaseTypeInput = document.getElementById('phase-type');
            const diversityFactorInput = document.getElementById('diversity-factor');

            // Conditional input sections
            const roomHeightGroup = document.getElementById('room-height-group');
            const mountingHeightGroup = document.getElementById('mounting-height-group');
            const poleHeightGroup = document.getElementById('pole-height-group');
            const reflectanceSection = document.getElementById('reflectance-section');

            // Buttons and result containers
            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            // Default values for resetting form
            const defaultValues = {
                'area-type': 'office_general',
                'room-length': 10,
                'room-width': 8,
                'room-height': 3,
                'mounting-height': 2.7,
                'pole-height': 8,
                'working-plane-height': 0.8,
                'light-loss-factor': 0.8,
                'ceiling-reflectance': 80,
                'wall-reflectance': 60,
                'floor-reflectance': 20,
                'required-illuminance': 500,
                'luminaire-type': 'led_panel',
                'luminaire-distribution': 'general',
                'luminous-flux-per-luminaire': 3500,
                'wattage-per-luminaire': 30,
                'luminaire-power-factor': 0.95,
                'supply-voltage': 230,
                'phase-type': 'single_phase',
                'diversity-factor': 100
            };

            // Recommended Illuminance Levels (Lux) based on ISO 8995-1 / CIE S 008/E and other standards
            // These are typical values and can vary based on specific task and country standards.
            const recommendedIlluminance = {
                'office_general': 500, // General office work
                'office_drawing': 750, // Detailed drawing, CAD
                'warehouse_storage': 100, // General storage, infrequent use
                'warehouse_aisle': 200, // Aisle with high racks
                'industrial_shed_general': 200, // General assembly, rough work
                'industrial_shed_fine_work': 500, // Fine assembly, inspection
                'industrial_laboratory': 500, // Laboratories, precision work
                'industrial_workshop': 300, // Workshops, general tasks
                'industrial_plant_area': 150, // General plant areas, walkways
                'retail_store_general': 300, // General circulation area
                'retail_store_display': 750, // Display areas, accent lighting
                'residential_living_room': 150, // Living rooms, general
                'residential_kitchen': 300, // Kitchens, task lighting
                'residential_bedroom': 100, // Bedrooms, general
                'outdoor_pathway': 20, // Pedestrian pathways, walkways
                'outdoor_parking': 50, // Parking areas, general
                'outdoor_road': 30, // Roads (main roads can be higher, residential lower)
                'outdoor_security': 100, // Perimeter security, critical areas
                'fire_station_apparatus_bay': 300, // Fire station apparatus bays
                'emergency_exit': 50 // Emergency exit routes (minimum)
            };

            // Helper function to add rows to the result table
            function addResultRow(parameter, value, unit, notes = '') {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                const unitCell = row.insertCell();
                const notesCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
                unitCell.innerHTML = unit;
                notesCell.innerHTML = notes;
            }

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    messageBox.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        padding: 15px 25px;
                        border-radius: 8px;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                        z-index: 1000;
                        font-weight: bold;
                        color: white;
                        opacity: 0;
                        transition: opacity 0.5s ease-in-out, transform 0.3s ease-out;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        min-width: 250px;
                    `;
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; /* Red */
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; /* Amber */
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745'; /* Green */
                }
                messageBox.style.opacity = 1;
                messageBox.style.transform = 'translateX(-50%) translateY(0)';

                setTimeout(() => {
                    messageBox.style.opacity = 0;
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)';
                }, 5000);
            }

            function clearResults() {
                resultContainer.classList.remove('show');
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                standardReference.innerHTML = '';
                displayMessage("Results cleared.", "info");
            }

            function resetForm() {
                for (const key in defaultValues) {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = defaultValues[key];
                    }
                }
                updateInputFieldsVisibility(); // Reset visibility based on default
                clearResults();
                displayMessage("Form reset to default values.", "info");
            }

            // Function to dynamically show/hide input fields and suggest illuminance
            function updateInputFieldsVisibility() {
                const areaType = areaTypeInput.value;
                const isOutdoor = areaType.startsWith('outdoor_') || areaType.startsWith('emergency_') || areaType.startsWith('fire_station_apparatus_bay');
                const isResidential = areaType.startsWith('residential_');

                // Update required illuminance based on area type
                requiredIlluminanceInput.value = recommendedIlluminance[areaType] || 500; // Default to 500 if not found

                // Toggle visibility of room height, mounting height, pole height, and reflectances
                if (isOutdoor) {
                    roomHeightGroup.style.display = 'none';
                    roomHeightInput.removeAttribute('required');
                    mountingHeightGroup.style.display = 'none'; // Mounting height is subsumed by pole height for outdoor
                    mountingHeightInput.removeAttribute('required');
                    poleHeightGroup.style.display = 'block';
                    poleHeightInput.setAttribute('required', 'true');
                    reflectanceSection.style.display = 'none'; // Reflectances not directly used for outdoor lumen method
                    ceilingReflectanceInput.removeAttribute('required');
                    wallReflectanceInput.removeAttribute('required');
                    floorReflectanceInput.removeAttribute('required');
                    // Set working plane height to 0 for outdoor by default, or 0.8 for fire station bay
                    workingPlaneHeightInput.value = (areaType === 'fire_station_apparatus_bay') ? 0.8 : 0;
                } else {
                    roomHeightGroup.style.display = 'block';
                    roomHeightInput.setAttribute('required', 'true');
                    mountingHeightGroup.style.display = 'block';
                    mountingHeightInput.setAttribute('required', 'true');
                    poleHeightGroup.style.display = 'none';
                    poleHeightInput.removeAttribute('required');
                    reflectanceSection.style.display = 'block';
                    ceilingReflectanceInput.setAttribute('required', 'true');
                    wallReflectanceInput.setAttribute('required', 'true');
                    floorReflectanceInput.setAttribute('required', 'true');
                    // Reset working plane height to default for indoor
                    workingPlaneHeightInput.value = defaultValues['working-plane-height'];
                }

                // Adjust luminaire type dropdown options based on indoor/outdoor/residential
                const currentLuminaireType = luminaireTypeInput.value;
                luminaireTypeInput.innerHTML = ''; // Clear existing options

                if (isOutdoor) {
                    const outdoorOptions = [
                        { value: 'outdoor_area_light', text: 'Outdoor Area/Street Light' },
                        { value: 'floodlight', text: 'Floodlight (Security/Facade)' },
                        { value: 'high_bay_led', text: 'High Bay LED (for large outdoor areas)' }, // Can be used for high pole outdoor
                        { value: 'residential_fixture', text: 'Residential Fixture (Outdoor)' } // For residential outdoor areas
                    ];
                    outdoorOptions.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.value;
                        opt.textContent = option.text;
                        luminaireTypeInput.appendChild(opt);
                    });
                    // Set a default outdoor luminaire type if current one is not suitable
                    if (!['outdoor_area_light', 'floodlight', 'high_bay_led', 'residential_fixture'].includes(currentLuminaireType)) {
                        luminaireTypeInput.value = 'outdoor_area_light';
                    } else {
                        luminaireTypeInput.value = currentLuminaireType;
                    }
                } else if (isResidential) {
                     const residentialOptions = [
                        { value: 'residential_fixture', text: 'Residential Fixture (General)' },
                        { value: 'led_downlight', text: 'LED Downlight' },
                        { value: 'led_panel', text: 'LED Panel (Recessed/Surface)' }
                    ];
                    residentialOptions.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.value;
                        opt.textContent = option.text;
                        luminaireTypeInput.appendChild(opt);
                    });
                    if (!['residential_fixture', 'led_downlight', 'led_panel'].includes(currentLuminaireType)) {
                        luminaireTypeInput.value = 'residential_fixture';
                    } else {
                        luminaireTypeInput.value = currentLuminaireType;
                    }

                } else { // Industrial/Commercial Indoor
                    const indoorOptions = [
                        { value: 'led_panel', text: 'LED Panel (Recessed/Surface)' },
                        { value: 'fluorescent_troffer', text: 'Fluorescent Troffer (Recessed)' },
                        { value: 'led_downlight', text: 'LED Downlight' },
                        { value: 'high_bay_led', text: 'High Bay LED (Industrial/Warehouse)' },
                        { value: 'linear_fluorescent', text: 'Linear Fluorescent (Suspended)' }
                    ];
                    indoorOptions.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.value;
                        opt.textContent = option.text;
                        luminaireTypeInput.appendChild(opt);
                    });
                     // Set a default indoor luminaire type if current one is not suitable
                    if (!['led_panel', 'fluorescent_troffer', 'led_downlight', 'high_bay_led', 'linear_fluorescent'].includes(currentLuminaireType)) {
                        luminaireTypeInput.value = 'led_panel';
                    } else {
                        luminaireTypeInput.value = currentLuminaireType;
                    }
                }
            }

            // ** NEW: More refined CU Lookup Table **
            // This table provides estimated CU values based on Room Cavity Ratio (RCR) and reflectances.
            // Values are illustrative and simplified. Real CU tables are much more detailed.
            // Reflectance categories:
            // C: Ceiling (H=High >70%, M=Medium 50-70%, L=Low <50%)
            // W: Wall (H=High >70%, M=Medium 50-70%, L=Low <50%)
            // F: Floor (M=Medium >20%, L=Low <20%)
            const cuLookupTable = {
                // General/Symmetric Distribution (typical for LED panels, troffers, general high bays)
                "general": {
                    "H_H_M": [0.80, 0.75, 0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35], // RCR 0-9
                    "H_H_L": [0.78, 0.73, 0.68, 0.63, 0.58, 0.53, 0.48, 0.43, 0.38, 0.33],
                    "H_M_M": [0.75, 0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30],
                    "H_M_L": [0.73, 0.68, 0.63, 0.58, 0.53, 0.48, 0.43, 0.38, 0.33, 0.28],
                    "M_M_M": [0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25],
                    "M_M_L": [0.68, 0.63, 0.58, 0.53, 0.48, 0.43, 0.38, 0.33, 0.28, 0.23],
                    "L_L_L": [0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15], // Darker room
                },
                // Narrow Beam Distribution (typical for some downlights, spotlights, industrial high bays)
                "narrow": {
                    "H_H_M": [0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25],
                    "H_H_L": [0.68, 0.63, 0.58, 0.53, 0.48, 0.43, 0.38, 0.33, 0.28, 0.23],
                    "H_M_M": [0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20],
                    "H_M_L": [0.63, 0.58, 0.53, 0.48, 0.43, 0.38, 0.33, 0.28, 0.23, 0.18],
                    "M_M_M": [0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15],
                    "M_M_L": [0.58, 0.53, 0.48, 0.43, 0.38, 0.33, 0.28, 0.23, 0.18, 0.13],
                    "L_L_L": [0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15, 0.10, 0.05],
                },
                // Wide Beam Distribution (typical for some panels, wide floodlights)
                "wide": {
                    "H_H_M": [0.82, 0.78, 0.73, 0.68, 0.63, 0.58, 0.53, 0.48, 0.43, 0.38],
                    "H_H_L": [0.80, 0.75, 0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35],
                    "H_M_M": [0.77, 0.72, 0.67, 0.62, 0.57, 0.52, 0.47, 0.42, 0.37, 0.32],
                    "H_M_L": [0.75, 0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30],
                    "M_M_M": [0.72, 0.67, 0.62, 0.57, 0.52, 0.47, 0.42, 0.37, 0.32, 0.27],
                    "M_M_L": [0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25],
                    "L_L_L": [0.62, 0.57, 0.52, 0.47, 0.42, 0.37, 0.32, 0.27, 0.22, 0.17],
                },
                // Asymmetric distribution (specific for wall washers, street lights - very rough estimate for lumen method)
                "asymmetric": {
                    "H_H_M": [0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15],
                    "H_M_M": [0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15, 0.10],
                    "M_M_M": [0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15, 0.10, 0.05],
                }
            };

            // Mapping reflectances to categories
            function getReflectanceCategory(rc, rw, rf) {
                let c = '';
                if (rc >= 70) c = 'H'; else if (rc >= 50) c = 'M'; else c = 'L';
                let w = '';
                if (rw >= 70) w = 'H'; else if (rw >= 50) w = 'M'; else w = 'L';
                let f = '';
                if (rf >= 20) f = 'M'; else f = 'L'; // Simplified floor categories
                return `${c}_${w}_${f}`;
            }

            // Function to get CU based on RCR and category
            function getCoefficientOfUtilization(luminaireType, luminaireDistribution, ceilingReflectance, wallReflectance, floorReflectance, roomCavityRatio, isOutdoor) {
                if (isOutdoor) {
                    // For outdoor, CU is less about room surfaces and more about direct light delivery.
                    // These are simplified typical values for outdoor luminaires.
                    if (luminaireType === 'outdoor_area_light' || luminaireType === 'outdoor_road') {
                        return 0.45; // General outdoor area/road lighting
                    } else if (luminaireType === 'floodlight') {
                        return 0.35; // More focused, can be lower for average illuminance
                    } else if (luminaireType === 'high_bay_led' && isOutdoor) {
                        return 0.60; // High bay used for outdoor high pole applications
                    } else if (luminaireType === 'residential_fixture' && isOutdoor) {
                        return 0.40; // Residential outdoor fixtures
                    }
                    return 0.4; // Fallback for outdoor
                }

                // Indoor CU estimation using lookup table
                const rcrIndex = Math.min(Math.floor(roomCavityRatio), 9); // RCR 0-9 for indices 0-9
                const reflectanceCategory = getReflectanceCategory(ceilingReflectance, wallReflectance, floorReflectance);
                
                let cuValues = cuLookupTable[luminaireDistribution]?.[reflectanceCategory];

                if (!cuValues) {
                    // Fallback if specific reflectance category not found, try a more general one
                    cuValues = cuLookupTable[luminaireDistribution]?.["M_M_L"]; // Default to medium reflectances
                    if (!cuValues) {
                        return 0.6; // Absolute fallback if distribution type is also not found
                    }
                }
                
                // Interpolate or pick directly based on RCR index
                let cu = cuValues[rcrIndex];
                
                // Further minor adjustments based on luminaire type (simplified)
                if (luminaireType === 'led_panel' || luminaireType === 'fluorescent_troffer') {
                    cu *= 1.0; // No major adjustment
                } else if (luminaireType === 'led_downlight') {
                    cu *= 0.9; // Downlights typically have slightly lower CU for general area
                } else if (luminaireType === 'high_bay_led' && !isOutdoor) {
                    cu *= 1.05; // High bays can be very efficient in high RCR environments
                } else if (luminaireType === 'linear_fluorescent') {
                    cu *= 0.98; // Minor adjustment
                } else if (luminaireType === 'residential_fixture') {
                    cu *= 0.85; // Residential fixtures often less efficient for general area illumination
                }

                return Math.max(0.1, Math.min(0.9, cu)); // Constrain CU to a reasonable range
            }

            // ** NEW: Uniformity Ratio Estimation **
            // These are typical uniformity ratios (Min/Avg) for different applications.
            // Max/Min is often derived from Min/Avg.
            const typicalUniformityMinAvg = {
                'office_general': 0.7,
                'office_drawing': 0.8,
                'warehouse_storage': 0.3, // Lower uniformity often acceptable
                'warehouse_aisle': 0.4,
                'industrial_shed_general': 0.5,
                'industrial_shed_fine_work': 0.7,
                'industrial_laboratory': 0.7,
                'industrial_workshop': 0.6,
                'industrial_plant_area': 0.4,
                'retail_store_general': 0.6,
                'retail_store_display': 0.7,
                'residential_living_room': 0.4, // Can be lower for ambiance
                'residential_kitchen': 0.6,
                'residential_bedroom': 0.3,
                'outdoor_pathway': 0.25, // Lower for general pathways
                'outdoor_parking': 0.3,
                'outdoor_road': 0.35, // Road lighting has specific uniformity classes
                'outdoor_security': 0.2, // Focus on coverage, not high uniformity
                'fire_station_apparatus_bay': 0.6,
                'emergency_exit': 0.2 // Minimum illumination, not uniformity
            };

            function calculateLightingLoad() {
                clearResults(); // Clear previous results

                // Input values
                const areaType = areaTypeInput.value;
                const roomLength = parseFloat(roomLengthInput.value);
                const roomWidth = parseFloat(roomWidthInput.value);
                const roomHeight = parseFloat(roomHeightInput.value); // Only for indoor
                const mountingHeight = parseFloat(mountingHeightInput.value); // Only for indoor
                const poleHeight = parseFloat(poleHeightInput.value); // Only for outdoor
                const workingPlaneHeight = parseFloat(workingPlaneHeightInput.value);
                const lightLossFactor = parseFloat(lightLossFactorInput.value);
                const ceilingReflectance = parseFloat(ceilingReflectanceInput.value);
                const wallReflectance = parseFloat(wallReflectanceInput.value);
                const floorReflectance = parseFloat(floorReflectanceInput.value);
                const requiredIlluminance = parseFloat(requiredIlluminanceInput.value);
                const luminaireType = luminaireTypeInput.value;
                const luminaireDistribution = luminaireDistributionInput.value;
                const luminousFluxPerLuminaire = parseFloat(luminousFluxPerLuminaireInput.value);
                const wattagePerLuminaire = parseFloat(wattagePerLuminaireInput.value);
                const luminairePowerFactor = parseFloat(luminairePowerFactorInput.value);
                const supplyVoltage = parseFloat(supplyVoltageInput.value);
                const phaseType = phaseTypeInput.value;
                const diversityFactor = parseFloat(diversityFactorInput.value) / 100; // Convert to per unit

                const isOutdoor = areaType.startsWith('outdoor_') || areaType.startsWith('emergency_') || areaType.startsWith('fire_station_apparatus_bay');

                // Input Validation
                if (isNaN(roomLength) || roomLength <= 0) { displayMessage("Area Length must be a positive number.", "error"); return; }
                if (isNaN(roomWidth) || roomWidth <= 0) { displayMessage("Area Width must be a positive number.", "error"); return; }
                if (!isOutdoor && (isNaN(roomHeight) || roomHeight <= 0)) { displayMessage("Room Height must be a positive number for indoor areas.", "error"); return; }
                if (!isOutdoor && (isNaN(mountingHeight) || mountingHeight <= 0 || mountingHeight >= roomHeight)) { displayMessage("Luminaire Mounting Height must be positive and less than Room Height for indoor areas.", "error"); return; }
                if (isOutdoor && (isNaN(poleHeight) || poleHeight <= 0)) { displayMessage("Pole Height must be a positive number for outdoor areas.", "error"); return; }
                if (isNaN(workingPlaneHeight) || workingPlaneHeight < 0 || (workingPlaneHeight >= roomHeight && !isOutdoor && areaType !== 'fire_station_apparatus_bay') || (workingPlaneHeight >= poleHeight && isOutdoor && areaType !== 'fire_station_apparatus_bay')) { displayMessage("Working Plane Height must be non-negative and less than the effective mounting height.", "error"); return; }
                if (isNaN(lightLossFactor) || lightLossFactor < 0.5 || lightLossFactor > 1.0) { displayMessage("Light Loss Factor must be between 0.5 and 1.0.", "error"); return; }
                if (!isOutdoor && (isNaN(ceilingReflectance) || ceilingReflectance < 0 || ceilingReflectance > 100)) { displayMessage("Ceiling Reflectance must be between 0 and 100% for indoor areas.", "error"); return; }
                if (!isOutdoor && (isNaN(wallReflectance) || wallReflectance < 0 || wallReflectance > 100)) { displayMessage("Wall Reflectance must be between 0 and 100% for indoor areas.", "error"); return; }
                if (!isOutdoor && (isNaN(floorReflectance) || floorReflectance < 0 || floorReflectance > 100)) { displayMessage("Floor Reflectance must be between 0 and 100% for indoor areas.", "error"); return; }
                if (isNaN(requiredIlluminance) || requiredIlluminance <= 0) { displayMessage("Required Illuminance must be a positive number.", "error"); return; }
                if (isNaN(luminousFluxPerLuminaire) || luminousFluxPerLuminaire <= 0) { displayMessage("Luminous Flux per Luminaire must be a positive number.", "error"); return; }
                if (isNaN(wattagePerLuminaire) || wattagePerLuminaire <= 0) { displayMessage("Wattage per Luminaire must be a positive number.", "error"); return; }
                if (isNaN(luminairePowerFactor) || luminairePowerFactor < 0.5 || luminairePowerFactor > 1.0) { displayMessage("Luminaire Power Factor must be between 0.5 and 1.0.", "error"); return; }
                if (isNaN(supplyVoltage) || supplyVoltage <= 0) { displayMessage("Supply Voltage must be a positive number.", "error"); return; }
                if (isNaN(diversityFactor) || diversityFactor < 0.5 || diversityFactor > 1.0) { displayMessage("Diversity Factor must be between 50% and 100%.", "error"); return; }


                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>1. Input Parameters:</strong></p>`;
                calculationHtml += `<p class="calculation-step">Area Type: ${areaType.replace(/_/g, ' ').toUpperCase()}</p>`;
                calculationHtml += `<p class="calculation-step">Area Length: ${roomLength} m</p>`;
                calculationHtml += `<p class="calculation-step">Area Width: ${roomWidth} m</p>`;
                if (!isOutdoor) {
                    calculationHtml += `<p class="calculation-step">Room Height: ${roomHeight} m</p>`;
                    calculationHtml += `<p class="calculation-step">Luminaire Mounting Height: ${mountingHeight} m</p>`;
                } else {
                    calculationHtml += `<p class="calculation-step">Pole Height: ${poleHeight} m</p>`;
                }
                calculationHtml += `<p class="calculation-step">Working Plane Height: ${workingPlaneHeight} m</p>`;
                calculationHtml += `<p class="calculation-step">Light Loss Factor (LLF): ${lightLossFactor}</p>`;
                if (!isOutdoor) {
                    calculationHtml += `<p class="calculation-step">Ceiling Reflectance: ${ceilingReflectance}%</p>`;
                    calculationHtml += `<p class="calculation-step">Wall Reflectance: ${wallReflectance}%</p>`;
                    calculationHtml += `<p class="calculation-step">Floor Reflectance: ${floorReflectance}%</p>`;
                }
                calculationHtml += `<p class="calculation-step">Required Illuminance: ${requiredIlluminance} Lux</p>`;
                calculationHtml += `<p class="calculation-step">Luminaire Type: ${luminaireType.replace(/_/g, ' ').toUpperCase()}</p>`;
                calculationHtml += `<p class="calculation-step">Luminaire Light Distribution: ${luminaireDistribution.replace(/_/g, ' ').toUpperCase()}</p>`;
                calculationHtml += `<p class="calculation-step">Luminous Flux per Luminaire: ${luminousFluxPerLuminaire} lm</p>`;
                calculationHtml += `<p class="calculation-step">Wattage per Luminaire: ${wattagePerLuminaire} W</p>`;
                calculationHtml += `<p class="calculation-step">Luminaire Power Factor: ${luminairePowerFactor}</p>`;
                calculationHtml += `<p class="calculation-step">Supply Voltage: ${supplyVoltage} V</p>`;
                calculationHtml += `<p class="calculation-step">Phase Type: ${phaseType.replace(/_/g, ' ').toUpperCase()}</p>`;
                calculationHtml += `<p class="calculation-step">Diversity Factor: ${diversityFactor * 100}%</p>`;

                // 2. Calculate Area
                const area = roomLength * roomWidth;
                calculationHtml += `<p><strong>2. Area Calculation:</strong></p>`;
                calculationHtml += `<p class="formula">Area = Area Length × Area Width</p>`;
                calculationHtml += `<p class="calculation-step">Area = ${roomLength} m × ${roomWidth} m = ${area.toFixed(2)} sq.m</p>`;

                // 3. Calculate Effective Mounting Height (h_rc or h_eff) and Room Cavity Ratio (RCR)
                let h_effective;
                let roomCavityRatio = 0; // Default for outdoor, will be calculated for indoor

                if (!isOutdoor) {
                    h_effective = mountingHeight - workingPlaneHeight;
                    // Ensure h_effective is not negative or zero, as it's used in division for RCR
                    if (h_effective <= 0) {
                        displayMessage("Effective Mounting Height must be positive (Mounting Height > Working Plane Height). Please adjust inputs.", "error");
                        return;
                    }
                    roomCavityRatio = (5 * h_effective * (roomLength + roomWidth)) / (roomLength * roomWidth);
                    calculationHtml += `<p><strong>3. Effective Mounting Height (h<sub>eff</sub>) & Room Cavity Ratio (RCR) Calculation (Indoor):</strong></p>`;
                    calculationHtml += `<p class="formula">h<sub>eff</sub> = Luminaire Mounting Height - Working Plane Height</p>`;
                    calculationHtml += `<p class="calculation-step">h<sub>eff</sub> = ${mountingHeight} m - ${workingPlaneHeight} m = ${h_effective.toFixed(2)} m</p>`;
                    calculationHtml += `<p class="formula">RCR = (5 × h<sub>eff</sub> × (Area Length + Area Width)) / (Area Length × Area Width)</p>`;
                    calculationHtml += `<p class="calculation-step">RCR = (5 × ${h_effective.toFixed(2)} × (${roomLength} + ${roomWidth})) / (${roomLength} × ${roomWidth}) = ${roomCavityRatio.toFixed(2)}</p>`;
                } else {
                    h_effective = poleHeight - workingPlaneHeight; // For outdoor, effective height is pole height above working plane
                     if (h_effective <= 0) {
                        displayMessage("Effective Mounting Height must be positive (Pole Height > Working Plane Height). Please adjust inputs.", "error");
                        return;
                    }
                    calculationHtml += `<p><strong>3. Effective Mounting Height (h<sub>eff</sub>) Calculation (Outdoor):</strong></p>`;
                    calculationHtml += `<p class="formula">h<sub>eff</sub> = Pole Height - Working Plane Height</p>`;
                    calculationHtml += `<p class="calculation-step">h<sub>eff</sub> = ${poleHeight} m - ${workingPlaneHeight} m = ${h_effective.toFixed(2)} m</p>`;
                    calculationHtml += `<p class="calculation-step"><em>Note: Room Cavity Ratio is not typically used for outdoor lighting calculations.</em></p>`;
                }

                // 4. Estimate Coefficient of Utilization (CU)
                const coefficientOfUtilization = getCoefficientOfUtilization(luminaireType, luminaireDistribution, ceilingReflectance, wallReflectance, floorReflectance, roomCavityRatio, isOutdoor);
                calculationHtml += `<p><strong>4. Coefficient of Utilization (CU) Estimation:</strong></p>`;
                calculationHtml += `<p class="calculation-step">Estimated CU based on Luminaire Type, Light Distribution, Room/Area Characteristics: ${coefficientOfUtilization.toFixed(3)}</p>`;
                calculationHtml += `<p class="calculation-step"><em>Note: This is a simplified estimation. For precise CU, refer to luminaire manufacturer's photometric data (IES files) and use specialized lighting design software.</em></p>`;


                // 5. Calculate Total Required Lumens
                const totalLumensRequired = (requiredIlluminance * area) / (coefficientOfUtilization * lightLossFactor);
                calculationHtml += `<p><strong>5. Total Lumens Required Calculation:</strong></p>`;
                calculationHtml += `<p class="formula">Total Lumens Required = (Required Illuminance × Area) / (CU × Light Loss Factor)</p>`;
                calculationHtml += `<p class="calculation-step">Total Lumens Required = (${requiredIlluminance} Lux × ${area.toFixed(2)} sq.m) / (${coefficientOfUtilization.toFixed(3)} × ${lightLossFactor}) = ${totalLumensRequired.toFixed(2)} lumens</p>`;

                // 6. Calculate Number of Luminaires Required
                const numberOfLuminaires = Math.ceil(totalLumensRequired / luminousFluxPerLuminaire);
                calculationHtml += `<p><strong>6. Number of Luminaires Required Calculation:</strong></p>`;
                calculationHtml += `<p class="formula">Number of Luminaires = Ceiling(Total Lumens Required / Luminous Flux per Luminaire)</p>`;
                calculationHtml += `<p class="calculation-step">Number of Luminaires = Ceiling(${totalLumensRequired.toFixed(2)} lumens / ${luminousFluxPerLuminaire} lm) = ${numberOfLuminaires}</p>`;

                // 7. Calculate Luminaire Spacing (Simplified Grid)
                // Determine optimal rows and columns for a near-square arrangement
                const aspectRatio = roomLength / roomWidth;
                let numRows = Math.round(Math.sqrt(numberOfLuminaires / aspectRatio));
                let numCols = Math.round(numberOfLuminaires / numRows);

                // Adjust to ensure product is at least numberOfLuminaires
                while (numRows * numCols < numberOfLuminaires) {
                    if (numRows * aspectRatio <= numCols) {
                        numRows++;
                    } else {
                        numCols++;
                    }
                }
                // Ensure no zero values
                if (numRows === 0) numRows = 1;
                if (numCols === 0) numCols = 1;


                const spacingLength = roomLength / numCols;
                const spacingWidth = roomWidth / numRows;
                
                // Calculate Spacing to Mounting Height Ratio (S/H)
                const spacingToHeightRatioLength = spacingLength / h_effective;
                const spacingToHeightRatioWidth = spacingWidth / h_effective;

                let spacingNotes = "These values provide a uniform grid. Actual spacing should consider luminaire distribution (Spacing Criteria), obstructions, and desired uniformity.";
                
                // Typical S/H ratios:
                // General/Symmetric: 1.0 - 1.5
                // Narrow: < 1.0
                // Wide: 1.5 - 2.0 (or higher, but check uniformity)

                if (luminaireDistribution === 'narrow') {
                    if (spacingToHeightRatioLength > 1.0 || spacingToHeightRatioWidth > 1.0) {
                        spacingNotes += " <span style='color: var(--warning-color); font-weight: bold;'>Warning: Narrow beam luminaires typically require S/H ratio < 1.0 for good uniformity. Current S/H is high.</span>";
                    } else {
                        spacingNotes += " Narrow beam luminaires require closer spacing to achieve uniformity. Recommended S/H ratio < 1.0.";
                    }
                } else if (luminaireDistribution === 'wide') {
                    if (spacingToHeightRatioLength < 1.5 || spacingToHeightRatioWidth < 1.5) {
                         spacingNotes += " Wide beam luminaires can allow for larger spacing. Recommended S/H ratio 1.5 - 2.0.";
                    } else {
                        spacingNotes += " <span style='color: var(--warning-color); font-weight: bold;'>Note: Wide beam luminaires can allow for larger spacing, but verify uniformity with photometric software. Current S/H is within typical wide range.</span>";
                    }
                } else { // General/Symmetric
                    if (spacingToHeightRatioLength > 1.5 || spacingToHeightRatioWidth > 1.5) {
                        spacingNotes += " <span style='color: var(--warning-color); font-weight: bold;'>Warning: For general distribution, S/H ratio typically 1.0-1.5. Current S/H might be too high for uniform illumination.</span>";
                    } else if (spacingToHeightRatioLength < 1.0 || spacingToHeightRatioWidth < 1.0) {
                        spacingNotes += " <span style='color: var(--warning-color); font-weight: bold;'>Note: For general distribution, S/H ratio typically 1.0-1.5. Current S/H might be a bit low, potentially leading to more luminaires than necessary.</span>";
                    } else {
                        spacingNotes += " For general/symmetric distribution, recommended S/H ratio 1.0 - 1.5.";
                    }
                }


                calculationHtml += `<p><strong>7. Luminaire Layout & Spacing Calculation:</strong></p>`;
                calculationHtml += `<p class="calculation-step">Optimal Rows (along Area Width): ${numRows}</p>`;
                calculationHtml += `<p class="calculation-step">Optimal Columns (along Area Length): ${numCols}</p>`;
                calculationHtml += `<p class="formula">Spacing Along Length = Area Length / Number of Columns</p>`;
                calculationHtml += `<p class="calculation-step">Spacing Along Length = ${spacingLength.toFixed(2)} m</p>`;
                calculationHtml += `<p class="formula">Spacing Along Width = Area Width / Number of Rows</p>`;
                calculationHtml += `<p class="calculation-step">Spacing Along Width = ${spacingWidth.toFixed(2)} m</p>`;
                calculationHtml += `<p class="calculation-step">Spacing to Effective Mounting Height Ratio (S/H) Length: ${spacingToHeightRatioLength.toFixed(2)}</p>`;
                calculationHtml += `<p class="calculation-step">Spacing to Effective Mounting Height Ratio (S/H) Width: ${spacingToHeightRatioWidth.toFixed(2)}</p>`;
                calculationHtml += `<p class="calculation-step"><em>Note: This layout assumes equal spacing from walls and between luminaires. For precise layout, consider edge distances (typically half of inter-luminaire spacing). ${spacingNotes}</em></p>`;


                // 8. Calculate Total Lighting Load & Lighting Power Density (LPD)
                const totalLightingLoad_W = numberOfLuminaires * wattagePerLuminaire;
                const lightingPowerDensity = totalLightingLoad_W / area; // W/sq.m

                calculationHtml += `<p><strong>8. Total Lighting Load & Lighting Power Density (LPD) Calculation:</strong></p>`;
                calculationHtml += `<p class="formula">Total Lighting Load = Number of Luminaires × Wattage per Luminaire</p>`;
                calculationHtml += `<p class="calculation-step">Total Lighting Load = ${numberOfLuminaires} × ${wattagePerLuminaire} W = ${totalLightingLoad_W.toFixed(2)} W</p>`;
                calculationHtml += `<p class="formula">Lighting Power Density (LPD) = Total Lighting Density / Area</p>`;
                calculationHtml += `<p class="calculation-step">LPD = ${totalLightingLoad_W.toFixed(2)} W / ${area.toFixed(2)} sq.m = ${lightingPowerDensity.toFixed(2)} W/sq.m</p>`;
                calculationHtml += `<p class="calculation-step"><em>Note: Compare calculated LPD with local energy codes (e.g., ASHRAE 90.1, EN 15193) to ensure compliance.</em></p>`;


                // 9. Calculate Circuit Current (considering diversity factor)
                let circuitCurrent_A;
                let circuitCurrentFormula;
                const sqrt3 = Math.sqrt(3);
                const totalApparentPower_VA = totalLightingLoad_W / luminairePowerFactor;
                const diversifiedApparentPower_VA = totalApparentPower_VA * diversityFactor;


                if (phaseType === 'single_phase') {
                    circuitCurrent_A = diversifiedApparentPower_VA / supplyVoltage;
                    circuitCurrentFormula = `Current = (Total Load / Luminaire PF) × Diversity Factor / Supply Voltage`;
                    calculationHtml += `<p><strong>9. Circuit Current Calculation (Single Phase, with Diversity):</strong></p>`;
                    calculationHtml += `<p class="formula">${circuitCurrentFormula}</p>`;
                    calculationHtml += `<p class="calculation-step">Total Apparent Power = ${totalLightingLoad_W.toFixed(2)} W / ${luminairePowerFactor} = ${totalApparentPower_VA.toFixed(2)} VA</p>`;
                    calculationHtml += `<p class="calculation-step">Diversified Apparent Power = ${totalApparentPower_VA.toFixed(2)} VA × ${diversityFactor} = ${diversifiedApparentPower_VA.toFixed(2)} VA</p>`;
                    calculationHtml += `<p class="calculation-step">Circuit Current = ${diversifiedApparentPower_VA.toFixed(2)} VA / ${supplyVoltage} V = ${circuitCurrent_A.toFixed(2)} A</p>`;
                } else { // three_phase
                    circuitCurrent_A = diversifiedApparentPower_VA / (sqrt3 * supplyVoltage);
                    circuitCurrentFormula = `Current = (Total Load / Luminaire PF) × Diversity Factor / (sqrt(3) × Supply Voltage)`;
                    calculationHtml += `<p><strong>9. Circuit Current Calculation (Three Phase, with Diversity):</strong></p>`;
                    calculationHtml += `<p class="formula">${circuitCurrentFormula}</p>`;
                    calculationHtml += `<p class="calculation-step">Total Apparent Power = ${totalLightingLoad_W.toFixed(2)} W / ${luminairePowerFactor} = ${totalApparentPower_VA.toFixed(2)} VA</p>`;
                    calculationHtml += `<p class="calculation-step">Diversified Apparent Power = ${totalApparentPower_VA.toFixed(2)} VA × ${diversityFactor} = ${diversifiedApparentPower_VA.toFixed(2)} VA</p>`;
                    calculationHtml += `<p class="calculation-step">Circuit Current = ${diversifiedApparentPower_VA.toFixed(2)} VA / (${sqrt3.toFixed(3)} × ${supplyVoltage} V) = ${circuitCurrent_A.toFixed(2)} A</p>`;
                }

                calculationHtml += `<p class="calculation-step"><em>Note: This current is used for sizing circuit breakers and cables. Always apply appropriate safety factors and consult local electrical codes (e.g., NEC, IEC 60364) for final circuit design.</em></p>`;

                // ** NEW: Uniformity Calculations **
                const estimatedMinIlluminance = requiredIlluminance * (typicalUniformityMinAvg[areaType] || 0.5); // Default to 0.5 if not found
                const uniformityMinAvg = (typicalUniformityMinAvg[areaType] || 0.5).toFixed(2);
                const uniformityMaxMin = (1 / (typicalUniformityMinAvg[areaType] || 0.5)).toFixed(2); // Rough inverse for Max/Min

                calculationHtml += `<p><strong>10. Estimated Uniformity Parameters:</strong></p>`;
                calculationHtml += `<p class="calculation-step">Estimated Minimum Illuminance = Required Illuminance × Typical (Min/Avg) Uniformity Ratio</p>`;
                calculationHtml += `<p class="calculation-step">Estimated Minimum Illuminance = ${requiredIlluminance} Lux × ${uniformityMinAvg} = ${estimatedMinIlluminance.toFixed(2)} Lux</p>`;
                calculationHtml += `<p class="calculation-step">Estimated Uniformity (Min/Avg) = ${uniformityMinAvg}</p>`;
                calculationHtml += `<p class="calculation-step">Estimated Uniformity (Max/Min) = ${uniformityMaxMin}</p>`;
                calculationHtml += `<p class="calculation-step"><em>Note: These uniformity values are estimations based on typical industry standards for the selected area type and general luminaire distribution. Actual uniformity requires detailed photometric analysis using specialized software.</em></p>`;


                // Populate results table
                resultTableBody.innerHTML = '';
                addResultRow("Area Type", areaType.replace(/_/g, ' ').toUpperCase(), "", "The chosen application influences recommended illuminance and design considerations.");
                addResultRow("Area (Length x Width)", `${roomLength} m x ${roomWidth} m`, "", "The dimensions of the space being illuminated.");
                addResultRow("Calculated Area", area.toFixed(2), "sq.m", "The total surface area of the room or outdoor space.");
                if (!isOutdoor) {
                    addResultRow("Room Height", roomHeight.toFixed(1), "m", "The vertical distance from the floor to the ceiling.");
                    addResultRow("Luminaire Mounting Height", mountingHeight.toFixed(1), "m", "The height at which the luminaires are installed from the floor. This significantly impacts light distribution and uniformity.");
                    addResultRow("Effective Mounting Height (h_eff)", h_effective.toFixed(2), "m", "The vertical distance from the luminaire to the working plane. This is critical for calculating Room Cavity Ratio and luminaire spacing.");
                    addResultRow("Room Cavity Ratio (RCR)", roomCavityRatio.toFixed(2), "", "A dimensionless value describing the room's proportions relative to the working plane. It helps determine how effectively light reaches the task area and is used in CU calculation.");
                    addResultRow("Ceiling Reflectance", `${ceilingReflectance}%`, "", "The percentage of light reflected by the ceiling. Lighter surfaces reflect more light, improving overall illumination efficiency.");
                    addResultRow("Wall Reflectance", `${wallReflectance}%`, "", "The percentage of light reflected by the walls. Light-colored walls contribute to better light distribution and reduce shadows.");
                    addResultRow("Floor Reflectance", `${floorReflectance}%`, "", "The percentage of light reflected by the floor. Even though often darker, floor reflectance still contributes to overall light levels.");
                } else {
                    addResultRow("Pole Height", poleHeight.toFixed(1), "m", "The height of the lighting pole from the ground. This is the primary mounting height for outdoor luminaires.");
                    addResultRow("Effective Mounting Height (h_eff)", h_effective.toFixed(2), "m", "The vertical distance from the luminaire to the working plane (usually ground level for outdoor). This is crucial for determining spacing and light spread.");
                }
                addResultRow("Working Plane Height", workingPlaneHeight.toFixed(2), "m", "The height above the floor/ground where the primary visual task is performed.");
                addResultRow("Light Loss Factor (LLF)", lightLossFactor.toFixed(2), "", "A multiplier accounting for various factors that reduce light output over time, including lamp lumen depreciation, luminaire dirt depreciation, and maintenance practices. It ensures that the required illuminance is maintained throughout the luminaire's life.");
                addResultRow("Required Illuminance", requiredIlluminance, "Lux", "The target average illuminance level on the working plane, based on international standards and the selected area type. This is the primary design goal.");
                addResultRow("Luminaire Type", luminaireType.replace(/_/g, ' ').toUpperCase(), "", "The selected type of light fixture. Different types have varying efficiencies and light distribution patterns.");
                addResultRow("Luminaire Light Distribution", luminaireDistribution.replace(/_/g, ' ').toUpperCase(), "", "Describes how light is emitted from the luminaire (e.g., narrow, wide, asymmetric). This is crucial for achieving uniform illumination and avoiding hot spots or dark areas.");
                addResultRow("Luminous Flux per Luminaire", luminousFluxPerLuminaire, "lumens", "The total light output from a single luminaire as specified by the manufacturer. This is the raw light energy available.");
                addResultRow("Wattage per Luminaire", wattagePerLuminaire.toFixed(1), "W", "The electrical power consumed by one luminaire. Used to calculate the total power load.");
                addResultRow("Luminaire Power Factor", luminairePowerFactor.toFixed(2), "", "The ratio of real power to apparent power consumed by the luminaire. A higher power factor (closer to 1.0) indicates more efficient use of electrical energy.");
                addResultRow("Supply Voltage", supplyVoltage, "V", "The nominal voltage of the electrical supply system.");
                addResultRow("Phase Type", phaseType.replace(/_/g, ' ').toUpperCase(), "", "Indicates whether the electrical supply is single-phase or three-phase, affecting circuit current calculations.");
                addResultRow("Diversity Factor", `${diversityFactor * 100}%`, "", "A factor applied to the total connected load to account for the fact that not all lights may be operating simultaneously at their maximum capacity. It helps in sizing upstream distribution equipment more economically.");
                addResultRow("Coefficient of Utilization (CU)", coefficientOfUtilization.toFixed(3), "", "The ratio of light reaching the working plane to the total light emitted by the lamps. It quantifies the efficiency of the lighting system in delivering light to the target area, considering room geometry and surface reflectances.");
                addResultRow("Total Lumens Required", totalLumensRequired.toFixed(2), "lumens", "The calculated total light output required from all luminaires to achieve the desired illuminance level, accounting for all losses.");
                addResultRow("Number of Luminaires Required", numberOfLuminaires, "units", "The calculated minimum number of luminaires needed. Always round up to ensure the target illuminance is met or exceeded.");
                addResultRow("Recommended Layout (Rows x Columns)", `${numRows} x ${numCols}`, "units", "A suggested grid layout for the luminaires to achieve relatively uniform illumination across the area. Rows are along the width, columns along the length.");
                addResultRow("Approx. Spacing Along Length", spacingLength.toFixed(2), "m", `The approximate center-to-center distance between luminaires along the longest dimension of the area. This is a crucial parameter for achieving uniformity.`);
                addResultRow("Approx. Spacing Along Width", spacingWidth.toFixed(2), "m", `The approximate center-to-center distance between luminaires along the shortest dimension of the area. This, along with spacing along length, defines the luminaire grid.`);
                addResultRow("Spacing to Effective Mounting Height Ratio (S/H) - Length", spacingToHeightRatioLength.toFixed(2), "", `The ratio of luminaire spacing along the length to the effective mounting height. This is a key indicator of potential uniformity issues.`);
                addResultRow("Spacing to Effective Mounting Height Ratio (S/H) - Width", spacingToHeightRatioWidth.toFixed(2), "", `The ratio of luminaire spacing along the width to the effective mounting height. This is a key indicator of potential uniformity issues.`);
                addResultRow("Total Lighting Load", totalLightingLoad_W.toFixed(2), "W", "The total electrical power consumed by all luminaires in the installation. This is the connected load.");
                addResultRow("Lighting Power Density (LPD)", lightingPowerDensity.toFixed(2), "W/sq.m", "The total lighting load per unit area. This metric is used by energy codes to limit power consumption for lighting in buildings.");
                addResultRow("Estimated Circuit Current", circuitCurrent_A.toFixed(2), "A", "The estimated electrical current drawn by the lighting circuit, considering the total load, voltage, power factor, and diversity factor. This value is essential for selecting appropriate circuit breakers and cable sizes.");
                addResultRow("Estimated Minimum Illuminance", estimatedMinIlluminance.toFixed(2), "Lux", "The estimated lowest illuminance level on the working plane, crucial for assessing uniformity and avoiding dark spots.");
                addResultRow("Estimated Uniformity (Min/Avg)", uniformityMinAvg, "", "The ratio of minimum illuminance to average illuminance. A higher value (closer to 1.0) indicates better uniformity.");
                addResultRow("Estimated Uniformity (Max/Min)", uniformityMaxMin, "", "The ratio of maximum illuminance to minimum illuminance. A lower value (closer to 1.0) indicates better uniformity.");


                // Standard Reference
                let standardRefText = `
                    <h4>International Standards & Best Practices for Lighting Design:</h4>
                    <p>This calculator's methodology aligns with principles from globally recognized lighting standards and organizations. For professional lighting design, always refer to the latest editions of these documents and local electrical codes:</p>
                    <ul>
                        <li><strong>ISO 8995-1:2002 / CIE S 008/E:2004 - Lighting of work places -- Part 1: Indoor work places.</strong> This is a fundamental international standard providing recommendations for illuminance levels, glare limits, and color rendering properties for various indoor tasks and spaces. It is widely adopted globally and forms the basis for many national standards (e.g., EN 12464-1 in Europe).</li>
                        <li><strong>Illuminating Engineering Society (IES) Lighting Handbook (North America):</strong> A comprehensive reference widely used in North America, providing detailed guidance on lighting fundamentals, design procedures (including the Lumen Method), luminaire data, and recommended illuminance levels for a vast array of applications.</li>
                        <li><strong>ASHRAE/IES Standard 90.1 - Energy Standard for Buildings Except Low-Rise Residential Buildings:</strong> Focuses on energy efficiency in building design, including prescriptive and performance-based requirements for lighting power densities. Essential for sustainable building design and energy code compliance.</li>
                        <li><strong>IEC 60364 Series - Electrical Installations of Buildings:</strong> Provides fundamental principles for safety in electrical installations. Relevant for circuit sizing, protection, and wiring practices for lighting loads worldwide.</li>
                        <li><strong>National Electrical Code (NEC) - NFPA 70 (USA):</strong> A widely adopted standard in the United States for the safe installation of electrical wiring and equipment. It includes requirements for lighting circuits, overcurrent protection, and wiring methods.</li>
                        <li><strong>CIBSE Lighting Guides (Chartered Institution of Building Services Engineers, UK):</strong> A series of practical guides covering various aspects of lighting design, including specific applications, energy efficiency, and emergency lighting.</li>
                        <li><strong>EN 12464-2: Lighting of work places -- Part 2: Outdoor work places:</strong> Provides specific recommendations for outdoor lighting applications, including industrial areas, sports facilities, and security lighting.</li>
                        <li><strong>UL Standards (Underwriters Laboratories):</strong> Relevant for luminaire safety and performance testing, ensuring products meet safety requirements.</li>
                        <li><strong>Local Building Codes and Energy Efficiency Regulations:</strong> Always ensure compliance with specific local and national building codes, energy codes, and environmental regulations, as these can vary significantly by region and may supersede general international guidelines. These are paramount for project approval and safety.</li>
                    </ul>
                    <p><strong>Important Considerations for Professional Lighting Design:</strong></p>
                    <ul>
                        <li><strong>Photometric Data (IES Files):</strong> For accurate designs, always use actual luminaire photometric data (often in IES or LDT format) provided by manufacturers. This data describes the precise light distribution patterns of the specific luminaire.</li>
                        <li><strong>Lighting Design Software:</strong> Professional tools like DIALux evo, Relux, AGI32, or Revit with lighting plugins are essential for complex projects to perform detailed calculations, visualize light distribution, analyze uniformity ratios (e.g., UGR - Unified Glare Rating), and ensure glare control.</li>
                        <li><strong>Uniformity:</strong> Beyond average illuminance, uniformity is critical for visual comfort and task performance. Ensure even light distribution to avoid bright spots and dark areas.</li>
                        <li><strong>Glare Control:</strong> Assess potential for discomfort glare and disability glare. Proper luminaire selection and placement are key.</li>
                        <li><strong>Color Properties:</strong> Consider Color Rendering Index (CRI) for accurate color perception and Correlated Color Temperature (CCT) for desired ambiance and visual comfort.</li>
                        <li><strong>Daylight Integration:</strong> Integrate natural light effectively to reduce energy consumption and improve occupant well-being. Utilize daylight harvesting controls where applicable.</li>
                        <li><strong>Control Systems:</strong> Implement intelligent lighting control systems (e.g., dimming, occupancy/vacancy sensors, daylight harvesting, scheduling) for energy savings, flexibility, and enhanced user experience.</li>
                        <li><strong>Emergency Lighting:</strong> For safety, emergency lighting (e.g., exit signs, emergency luminaires) must be designed to specific standards (e.g., NFPA 101, EN 1838) to ensure safe egress during power failures.</li>
                        <li><strong>Environmental Factors (Outdoor):</strong> For outdoor lighting, consider environmental factors like wind loading on poles, temperature extremes, ingress protection (IP ratings) for luminaires, and light pollution regulations.</li>
                    </ul>
                    <p>This calculator provides a solid starting point for preliminary estimations. For final design, compliance, and optimal performance, engaging with qualified lighting design professionals and utilizing specialized software is highly recommended.</p>
                `;
                standardReference.innerHTML = standardRefText;

                calculationDetailsDiv.innerHTML = calculationHtml; // Insert detailed steps
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    calculationDetailsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to calculation details
                }, 10);
                displayMessage("Lighting load calculated successfully!", "info");
            }

            // Event Listeners
            areaTypeInput.addEventListener('change', updateInputFieldsVisibility);
            calculateBtn.addEventListener('click', calculateLightingLoad);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Initial call to set correct input field visibility and default illuminance
            updateInputFieldsVisibility();
        });
    </script>
</body>

</html>
