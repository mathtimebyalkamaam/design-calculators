<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baud Rate / Cycle Time Calculator - Instrumentation</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional calculator for serial communication timing. Calculate bit time, message time, and network polling cycle time for Modbus RTU and other protocols.">
    <meta name="keywords" content="baud rate calculator, cycle time, modbus rtu, rs-485, serial communication, profibus, instrumentation, network timing">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    
    <!-- AdSense & Analytics (from new header) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts & Icons (from new header) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for Formulas (from new header) -->
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['\\(', '\\)'], ['$', '$']],
            displayMath: [['\\[', '\\]'], ['$$', '$$']]
        },
        svg: { fontCache: 'global' },
        options: {
            processHtmlClass: 'math-content', // Process elements with this class
            ignoreHtmlClass: 'no-mathjax' // Ignore elements with this class
        }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- PDF Generation (Not used by this tool but included in header) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Favicon (from new header) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- New Styles from template file -->
    <style>
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
            /* Specific colors for this tool */
            --ok-color: #10B981;
            --error-color: #DC2626;
            --warning-color: #F59E0B;
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --ok-color: #10B981;
            --error-color: #e74c3c;
            --warning-color: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        /* Applied to the tool container */
        .tool-container {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .tool-description {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.05rem;
        }
        h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        /* Small hack for combined input/select */
        .form-group select {
            width: 30%; /* Give some space for the select */
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        .form-group input + select {
             width: 30%;
        }
         .form-group input {
            width: 70%;
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            display: inline-block; /* Allow select to sit next to it */
        }
        /* Full width for inputs without a select */
        .form-group input[type="number"]:only-child,
        .form-group select:only-child,
        .form-group input[type="number"][placeholder] {
             width: 100%;
             border-right: 2px solid var(--border);
             border-radius: 6px;
        }
        /* Fix for single selects */
        .form-group select {
            width: 100%;
            border-left: 2px solid var(--border);
            border-radius: 6px;
        }
        /* Fix for combined input/select again */
        .form-group input + select {
             width: 30%;
             border-left: none;
             border-top-left-radius: 0;
             border-bottom-left-radius: 0;
        }


        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .calculator-form {
            background-color: var(--card); /* Re-using card style */
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .form-section {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        .form-section h3 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn-group .btn {
            flex: 1;
            min-width: 150px;
        }
        .btn.secondary {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn.accent {
            background: var(--accent);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        .btn.accent:hover {
             box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }
        .btn.danger {
            background: var(--danger);
             box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        .btn.danger:hover {
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }
        .btn.small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }


        /* CALCULATION STEPS DISPLAY */
        .steps-container {
            display: none;
            margin-top: 30px;
        }
        .steps-container.active {
            display: block;
        }
        .step-card {
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px; /* Spacing between cards */
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
        }
        .step-card .number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        .step-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: start;
        }
        @media (max-width: 768px) {
            .step-content {
                grid-template-columns: 1fr;
            }
        }
        .step-content .formula-block {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid var(--border);
        }
        .step-content .formula-block p {
            margin-top: 0;
        }
        .step-content .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .step-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
            line-height: 1.2;
        }
        .step-unit {
            font-size: 1rem;
            color: var(--text);
            opacity: 0.8;
            font-weight: 500;
            margin-left: 5px;
        }
        .step-explanation {
            font-size: 1.05rem;
            line-height: 1.8;
        }
        /* Specific class for calculation steps */
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--bg);
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 8px;
            color: var(--text);
            white-space: pre-wrap;
            word-break: break-word;
            border: 1px solid var(--border);
        }


        /* Results */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th,
        .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) {
            background-color: var(--bg);
        }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .results-table .highlight {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--success);
        }
        .results-table .warning {
            font-weight: 700;
            color: var(--warning);
        }
        .results-table .error {
            font-weight: 700;
            color: var(--danger);
        }

        /* Educational Section */
        .education-section {
            margin-top: 60px;
        }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i {
            font-size: 1.5rem;
        }
        .insight-card p {
            margin: 10px 0;
            line-height: 1.8;
        }
        .insight-card ol,
        .insight-card ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .insight-card li {
            margin-bottom: 10px;
        }
        .stat-highlight {
            display: inline-block;
            background: var(--accent);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin: 0 4px;
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 {
            color: var(--danger);
            margin-top: 0;
        }
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h4 {
            color: var(--success);
            margin-top: 0;
        }


        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .btn-group { flex-direction: column; }
        }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 5px;
            cursor: help;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Adjusted width */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-family: 'Inter', sans-serif; /* Professional font */
            font-size: 0.85rem; /* Slightly smaller font size */
            line-height: 1.4; /* Better readability */
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Specific styles for Baud Rate Calculator */
        .status-display {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.5s, color 0.5s;
            text-align: center;
            width: 100%;
        }
        .status-display.optimal {
            background-color: var(--ok-color);
            color: white;
        }
        .status-display.adequate {
            background-color: #34D399; /* Lighter green */
            color: white;
        }
        .status-display.warning {
            background-color: var(--warning-color);
            color: var(--heading);
        }
        .status-display.critical {
            background-color: var(--error-color);
            color: white;
        }
        
        #dynamic-recommendations {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--bg);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            color: var(--text);
            border: 1px solid var(--border);
        }
        #dynamic-recommendations h4 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        #dynamic-recommendations ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #dynamic-recommendations ul li {
            margin-bottom: 8px;
        }

        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            color: white;
            font-size: 1.5em;
            flex-direction: column;
            gap: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body oncontextmenu="return false;">
    <!-- Message box for notifications -->
    <div id="message-box" class="message-box"></div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- New Header from file.txt -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a class='logo-container' href='/'>
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Main Tool Container -->
        <div class="tool-container">
            <h2><i class="fas fa-network-wired"></i> Baud Rate / Cycle Time Calculator</h2>
                        
            <div class="tool-description">
                <p>This calculator helps determine communication timings for serial field buses like Modbus RTU, Profibus DP, etc. It calculates bit time, character time, message transmission time, and estimates polling cycle time for multiple devices, incorporating real-world factors like slave delays and network overhead.</p>
            </div>
                    
            <div class="calculator-form">
                <form id="baud-rate-calculator-form">
                    <!-- Communication Parameters -->
                    <div class="form-section">
                        <h3><i class="fas fa-satellite-dish"></i> Communication Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="protocol-type">Protocol Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the communication protocol. This sets reasonable defaults.</span></span></label>
                                <select id="protocol-type">
                                    <option value="Modbus_RTU">Modbus RTU</option>
                                    <option value="Generic_Serial">Generic Serial</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="baud-rate">Baud Rate <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The communication speed of the serial bus. (e.g., 9600, 19200, 115200)</span></span></label>
                                <input type="number" id="baud-rate" step="1" value="9600" required>
                                <select id="baud-rate-unit">
                                    <option value="bps">bps</option>
                                    <option value="kbps">kbps</option>
                                    <option value="Mbps">Mbps</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="data-bits">Data Bits <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Number of data bits per character (e.g., 7 or 8).</span></span></label>
                                <select id="data-bits">
                                    <option value="7">7</option>
                                    <option value="8" selected>8</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="stop-bits">Stop Bits <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Number of stop bits per character (e.g., 1 or 2).</span></span></label>
                                <select id="stop-bits">
                                    <option value="1" selected>1</option>
                                    <option value="2">2</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="parity">Parity <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Parity setting for error checking (None, Even, Odd). Affects character length.</span></span></label>
                                <select id="parity">
                                    <option value="None" selected>None</option>
                                    <option value="Even">Even</option>
                                    <option value="Odd">Odd</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Message & Network Parameters -->
                    <div class="form-section">
                        <h3><i class="fas fa-envelope-open-text"></i> Message & Network Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="request-message-bytes">Request Message Length (Bytes) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total number of bytes in a typical request message (including address, function code, data, CRC/checksum).</span></span></label>
                                <input type="number" id="request-message-bytes" step="1" value="8" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="response-message-bytes">Response Message Length (Bytes) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total number of bytes in a typical response message (including address, function code, data, CRC/checksum).</span></span></label>
                                <input type="number" id="response-message-bytes" step="1" value="8" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="num-devices">Number of Devices (Slaves) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Number of slave devices on the bus that the master polls in a cycle.</span></span></label>
                                <input type="number" id="num-devices" step="1" value="5" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="slave-response-delay">Slave Device Response Delay (ms) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Typical time a slave device takes to process a request and begin sending a response.</span></span></label>
                                <input type="number" id="slave-response-delay" step="0.1" value="10" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="network-propagation-delay">Network Propagation Delay (ms) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Time for a signal to travel the full length of the network cable (one way).</span></span></label>
                                <input type="number" id="network-propagation-delay" step="0.01" value="0.5" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="overhead-time">Inter-Message Overhead Time (Value) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Additional time delay between messages or for master turnaround (e.g., for Modbus RTU, this is typically 3.5 character times).</span></span></label>
                                <input type="number" id="overhead-time" step="0.01" value="3.5" required>
                            </div>
                            <div class="form-group">
                                <label for="overhead-unit">Overhead Unit <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Unit for the Inter-Message Overhead Time (milliseconds or character times).</span></span></label>
                                <select id="overhead-unit">
                                    <option value="ms">ms</option>
                                    <option value="char_times" selected>Character Times</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculation Buttons -->
                    <div class="btn-group" style="margin-top: 25px;">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Timings</button>
                        <button type="button" id="reset-form-btn" class="btn accent"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- NEW Step-by-Step Results Container -->
        <div id="steps-container" class="steps-container math-content">
            <!-- Step cards will be dynamically inserted here -->
        </div>

        <!-- Updated Results Section -->
        <div id="results-section" class="card hidden">
            <h3><i class="fas fa-clipboard-check"></i> Communication Timing Results</h3>
            <p class="status-display" id="timing-status-display">Timing Status: N/A</p>
            
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    <!-- Results will be dynamically inserted here -->
                </tbody>
            </table>

            <!-- Dynamic Recommendations (from old file) -->
            <div id="dynamic-recommendations" style="display: none;">
                <h4><i class="fas fa-lightbulb"></i> Practical Considerations & Recommendations</h4>
                <ul id="recommendations-list">
                    <!-- Recommendations will be dynamically inserted here -->
                </ul>
            </div>

            <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                <button type="button" id="clear-results-btn" class="btn accent"><i class="fas fa-times-circle"></i> Clear Results</button>
            </div>

            <!-- Static Standard Reference (from old file) -->
            <div class="insight-card" id="standard-reference" style="margin-top: 30px;">
                 <h4><i class="fas fa-book"></i> Applicable Standards and Guidelines</h4>
                 <p>Understanding communication timings is crucial for designing reliable and responsive industrial control systems.</p>
                 <ul>
                    <li><strong>Baud Rate:</strong> The number of signal changes, or symbols, per second. For simple binary signaling, it's equivalent to bits per second (bps).</li>
                    <li><strong>Character Frame:</strong> In serial communication (like RS-485), each character is transmitted within a "frame" that includes: 1 Start Bit, Data Bits (e.g., 8), an optional Parity Bit, and Stop Bits (e.g., 1).</li>
                    <li><strong>Inter-Message Overhead:</strong> Time delays between messages. For Modbus RTU, this is typically 3.5 character times (T3.5) to signify the end of a message.</li>
                    <li><strong>Slave Device Response Delay:</strong> The internal processing time of the slave device before it begins transmitting its response.</li>
                    <li><strong>Cycle Time:</strong> For polling-based networks (like Modbus RTU master-slave), the cycle time is the total time it takes for the master to poll all slave devices and receive their responses.</li>
                    <li><strong>Protocol Specifications:</strong> Always refer to the specific fieldbus protocol's documentation (e.g., Modbus Application Protocol) for exact timing requirements.</li>
                </ul>
                <p>This tool provides a refined estimation of communication timings. Actual performance can be influenced by network topology, cable quality, and device processing delays.</p>
            </div>
        </div>
        
        <!-- NEW 800-word Educational Section -->
        <div id="education-section" class="education-section card math-content">
            <h2><i class="fas fa-book-open"></i> Engineer's Guide to Serial Comms & Network Timing</h2>

            <div class="tool-description">
                <p>In industrial automation, serial communication protocols like Modbus RTU (over RS-485) remain the backbone for connecting field devices (sensors, VFDs, actuators) to controllers (PLCs, DCS). While newer Ethernet-based protocols are faster, serial networks are simple, robust, and cost-effective. However, their performance is entirely dependent on <strong>timing</strong>. Understanding the relationship between baud rate, message size, and protocol overhead is the key to designing a stable and responsive control system.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-tachometer-alt"></i> Baud Rate vs. Bit Rate vs. Cycle Time</h4>
                <p>These terms are often confused, but they mean very different things.</p>
                <ul>
                    <li><strong>Baud Rate:</strong> This is the "speed" of the wire, measured in symbols per second. A symbol is a change in the electrical state (e.g., a voltage change). In simple binary systems like RS-485, one symbol represents one bit, so <strong>Baud Rate = Bits Per Second (bps)</strong>. 9600 baud means the system can transmit 9,600 bits every second.</li>
                    <li><strong>Bit Time:</strong> This is the duration of a single bit: $Time_{bit} = 1 / \text{Baud Rate}$. At 9600 baud, one bit takes $1/9600 = 0.000104s$, or <strong>104 microseconds (μs)</strong>.</li>
                    <li><strong>Cycle Time:</strong> This is the *total time* it takes for a master (PLC) to complete one full "round" of polling all the slave devices on the network. This is the value that matters for your control loop. A 10-second cycle time is fine for monitoring a tank farm, but disastrous for controlling a high-speed packaging machine.</li>
                </ul>
                <p><strong>Key takeaway:</strong> A high baud rate (e.g., 115,200 bps) does *not* guarantee a fast cycle time. A poorly designed network with large messages and long delays can be slow, even at high speeds.</p>
            </div>

            <div class="success-box">
                <h4><i class="fas fa-list-ol"></i> The Anatomy of a Serial "Character" (Byte)</h4>
                <p>In serial communication, you don't just send 8 bits of data. You send a "frame" that includes overhead bits for synchronization and error checking. This is the single most important concept for timing calculations.</p>
                <p>A typical asynchronous frame (like in Modbus RTU) consists of:</p>
                <ul>
                    <li><strong>1 Start Bit:</strong> Always 1 bit. Signals the start of a new character.</li>
                    <li><strong>Data Bits:</strong> Typically <strong>8 bits</strong> (to send one full byte).</li>
                    <li><strong>Parity Bit:</strong> Optional (0 or 1 bit). Used for basic error checking.</li>
                    <li><strong>Stop Bits:</strong> Typically <strong>1 or 2 bits</strong>. Signals the end of the character.</li>
                </ul>
                <p><strong>Total Bits per Character = 1 (Start) + Data Bits + Parity Bits + Stop Bits</strong></p>
                <p>A "standard" 8-N-1 (8 data bits, No parity, 1 stop bit) configuration actually takes <strong>10 bits</strong> to send on the wire. This calculator computes this for you. At 9600 baud (104.17 μs/bit), one character (byte) takes $10 \text{ bits} \times 104.17 \mu s = 1.0417 \text{ ms}$.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-hourglass-half"></i> The "Gaps": Where Does All the Time Go?</h4>
                <p>A network's cycle time isn't just the sum of its message transmission times. The real-world performance is dominated by the "silent time" or "gaps" between messages. This calculator accounts for all of them.</p>
                
                <p>A single master-slave poll consists of 5 distinct phases:</p>
                <ol>
                    <li><strong>Request TX Time:</strong> The time to physically send the master's request (e.g., 8 bytes).
                        <p class="formula">$$T_{req} = (\text{Request Bytes}) \times (\text{Character Time})$$</p>
                    </li>
                    <li><strong>Propagation Delay (x2):</strong> The time for the electrical signal to travel from the master to the *farthest* slave. This happens twice (once for the request, once for the response). It's very small for short RS-485 runs but can be significant (milliseconds) in long-distance networks.</li>
                    <li><strong>Slave Response Delay:</strong> This is the time the slave device takes to *process* the request and formulate its response *before* it starts transmitting. This is a critical value found in the device's datasheet and can range from <1 ms to >100 ms.</li>
                    <li><strong>Response TX Time:</strong> The time to physically send the slave's response (e.g., 20 bytes).
                        <p class="formula">$$T_{resp} = (\text{Response Bytes}) \times (\text{Character Time})$$</p>
                    </li>
                    <li><strong>Protocol Overhead (Inter-Message Gap):</strong> The "silent time" the master must wait before sending its *next* poll. For Modbus RTU, this is famously the <strong>T3.5</strong>, or the time it takes to send 3.5 characters. This gap is a "bus-free" condition that signals the end of one transaction and the start of the next.</li>
                </ol>
            </div>

            <div class="danger-box">
                <h4><i class="fas fa-exclamation-triangle"></i> Putting It All Together: The Full Cycle Time</h4>
                <p>The total time for one poll is the sum of all these parts:</p>
                <p class="formula" style="font-size: 0.9rem;">$$T_{poll} = T_{req} + T_{prop} + T_{slave\_delay} + T_{prop} + T_{resp} + T_{overhead}$$</p>
                <p>The <strong>Total Polling Cycle Time</strong> is this value, multiplied by the number of devices you are polling in the loop.</p>
                <p class="formula">$$T_{cycle} = T_{poll} \times (\text{Number of Devices})$$</p>
                <p>This is the number that your PLC's control loop must be able to tolerate. If you have 20 devices, each with a 50ms slave delay, your *minimum* cycle time is already $20 \times 50\text{ms} = 1 \text{ second}$, and that's *before* any data is even transmitted!</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-chart-pie"></i> Network Utilization & Best Practices</h4>
                <p><strong>Network Utilization</strong> is a measure of how "busy" the bus is. It's the ratio of "time spent sending useful data" to the "total cycle time." A high utilization (> 70-80%) is dangerous. It means your network has no "breathing room" to handle a retry if a message is corrupted. This leads to dropped packets and intermittent failures.</p>
                
                <p><strong>How to Improve a Slow Network:</strong></p>
                <ol>
                    <li><strong>Increase the Baud Rate:</strong> This is the single biggest fix. Moving from 9600 to 115200 bps makes every bit *and* every T3.5 gap 12 times shorter. Ensure all devices and your cable (e.g., shielded, twisted-pair) can support the higher speed.</li>
                    <li><strong>Optimize Polling:</strong> Does every device need to be updated every cycle? Poll critical control devices (like a VFD) every cycle, but poll non-critical monitoring devices (like a tank temperature) every 10 cycles.</li>
                    <li><strong>Reduce Message Size:</strong> Don't poll for 100 registers if you only need 2. Smaller messages transmit faster.</li>
                    <li><strong>Segment the Network:</strong> If you have 100 devices, don't put them all on one RS-485 bus. Use 4 separate bus gateways, each handling 25 devices. This divides your cycle time by 4.</li>
                    <li><strong>Check Slave Delays:</strong> If one old, slow device has a 200ms response delay, it is holding up the *entire network*. Replace it or move it to its own, separate, slow-speed bus.</li>
                </ol>
            </div>
        </div>

    </main>

    <!-- New Footer from file.txt -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li> 
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li> 
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Updated JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Form Elements ---
            const protocolTypeSelect = document.getElementById('protocol-type');
            const baudRateInput = document.getElementById('baud-rate');
            const baudRateUnitSelect = document.getElementById('baud-rate-unit');
            const dataBitsSelect = document.getElementById('data-bits');
            const stopBitsSelect = document.getElementById('stop-bits');
            const paritySelect = document.getElementById('parity');
            const requestMessageBytesInput = document.getElementById('request-message-bytes');
            const responseMessageBytesInput = document.getElementById('response-message-bytes');
            const numDevicesInput = document.getElementById('num-devices');
            const slaveResponseDelayInput = document.getElementById('slave-response-delay');
            const networkPropagationDelayInput = document.getElementById('network-propagation-delay');
            const overheadTimeInput = document.getElementById('overhead-time');
            const overheadUnitSelect = document.getElementById('overhead-unit');

            // --- Button & Result Elements ---
            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            
            const resultsSection = document.getElementById('results-section');
            const stepsContainer = document.getElementById('steps-container'); // New steps container
            const resultTableBody = document.getElementById('result-table-body');
            const timingStatusDisplay = document.getElementById('timing-status-display');
            const dynamicRecommendationsDiv = document.getElementById('dynamic-recommendations');
            const recommendationsList = document.getElementById('recommendations-list');
            const messageBox = document.getElementById('message-box');
            const loadingOverlay = document.getElementById('loading-overlay');

            // --- Default values for resetting form ---
            const defaultValues = {
                'protocol-type': 'Modbus_RTU',
                'baud-rate': 9600, 'baud-rate-unit': 'bps',
                'data-bits': '8',
                'stop-bits': '1',
                'parity': 'None',
                'request-message-bytes': 8,
                'response-message-bytes': 8,
                'num-devices': 5,
                'slave-response-delay': 10,
                'network-propagation-delay': 0.5,
                'overhead-time': 3.5,
                'overhead-unit': 'char_times'
            };

            // --- Helper for unit conversions ---
            const unitConversions = {
                baud_rate: { 'bps': 1, 'kbps': 1000, 'Mbps': 1000000 },
                time: { 's': 1, 'ms': 0.001, 'us': 0.000001 }
            };

            // --- New showMessage function (from template) ---
            function showMessage(msg, type = 'success') {
                messageBox.textContent = msg;
                if (type === 'error') {
                    messageBox.style.backgroundColor = 'var(--danger)';
                    messageBox.style.color = 'white';
                } else if (type === 'warning') {
                    messageBox.style.backgroundColor = 'var(--warning)';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                    messageBox.style.color = 'white';
                }
                messageBox.classList.add('show');
                setTimeout(() => messageBox.classList.remove('show'), 4000);
            }

            // Function to show/hide loading overlay
            function showLoading(message = "Loading...") {
                loadingOverlay.querySelector('p').textContent = message;
                loadingOverlay.classList.add('show');
            }
            function hideLoading() {
                loadingOverlay.classList.remove('show');
            }

            // --- Helper function to add rows to the result table ---
            function addResultRow(parameter, value, statusClass = '') {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
                if (statusClass) {
                    valueCell.classList.add(statusClass);
                }
            }

            // --- Function to apply protocol-specific defaults ---
            function applyProtocolDefaults() {
                const protocol = protocolTypeSelect.value;
                if (protocol === 'Modbus_RTU') {
                    dataBitsSelect.value = '8';
                    stopBitsSelect.value = '1';
                    // Don't override parity, user might want Even/Odd
                    overheadTimeInput.value = '3.5';
                    overheadUnitSelect.value = 'char_times';
                    requestMessageBytesInput.value = '8';
                    responseMessageBytesInput.value = '8';
                    slaveResponseDelayInput.value = '10';
                    networkPropagationDelayInput.value = '0.5';
                } else if (protocol === 'Generic_Serial') {
                    dataBitsSelect.value = '8';
                    stopBitsSelect.value = '1';
                    paritySelect.value = 'None';
                    overheadTimeInput.value = '1'; // 1ms gap
                    overheadUnitSelect.value = 'ms';
                    requestMessageBytesInput.value = '10';
                    responseMessageBytesInput.value = '10';
                    slaveResponseDelayInput.value = '20';
                    networkPropagationDelayInput.value = '1';
                }
            }

            // --- Clear Results Function ---
            function clearResults() {
                resultsSection.classList.add('hidden');
                stepsContainer.innerHTML = '';
                stepsContainer.classList.remove('active');
                resultTableBody.innerHTML = '';
                dynamicRecommendationsDiv.style.display = 'none';
                recommendationsList.innerHTML = '';
                timingStatusDisplay.textContent = 'Timing Status: N/A';
                timingStatusDisplay.className = 'status-display';
                showMessage("Results cleared.", "success");
            }

            // --- Reset Form Function ---
            function resetForm() {
                for (const key in defaultValues) {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = defaultValues[key];
                    }
                }
                // Re-apply protocol defaults after general reset
                applyProtocolDefaults();
                clearResults();
                showMessage("Form reset to default values.", "success");
            }
            
            // --- Event Listeners ---
            protocolTypeSelect.addEventListener('change', applyProtocolDefaults);
            calculateBtn.addEventListener('click', calculateTimings);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);
            
            // --- Main Calculation Function ---
            function calculateTimings() {
                clearResults(); // Clear previous results
                
                let stepsHtml = '';
                let calculationFailed = false;

                // --- 1. Get and Validate Inputs ---
                let protocolType = protocolTypeSelect.value;
                let baudRate = parseFloat(baudRateInput.value) * unitConversions.baud_rate[baudRateUnitSelect.value];
                let dataBits = parseInt(dataBitsSelect.value);
                let stopBits = parseInt(stopBitsSelect.value);
                let parity = paritySelect.value;
                let requestMessageBytes = parseInt(requestMessageBytesInput.value);
                let responseMessageBytes = parseInt(responseMessageBytesInput.value);
                let numDevices = parseInt(numDevicesInput.value);
                let slaveResponseDelay_ms = parseFloat(slaveResponseDelayInput.value); // Already in ms
                let networkPropagationDelay_ms = parseFloat(networkPropagationDelayInput.value); // Already in ms
                let overheadTimeRaw = parseFloat(overheadTimeInput.value);
                let overheadUnit = overheadUnitSelect.value;

                // Input validation
                if (isNaN(baudRate) || baudRate <= 0) { showMessage('Baud Rate must be a positive number.', 'error'); calculationFailed = true; }
                if (isNaN(dataBits) || (dataBits !== 7 && dataBits !== 8)) { showMessage('Data Bits must be 7 or 8.', 'error'); calculationFailed = true; }
                if (isNaN(stopBits) || (stopBits !== 1 && stopBits !== 2)) { showMessage('Stop Bits must be 1 or 2.', 'error'); calculationFailed = true; }
                if (isNaN(requestMessageBytes) || requestMessageBytes <= 0) { showMessage('Request Message Length must be a positive integer.', 'error'); calculationFailed = true; }
                if (isNaN(responseMessageBytes) || responseMessageBytes <= 0) { showMessage('Response Message Length must be a positive integer.', 'error'); calculationFailed = true; }
                if (isNaN(numDevices) || numDevices <= 0) { showMessage('Number of Devices must be a positive integer.', 'error'); calculationFailed = true; }
                if (isNaN(slaveResponseDelay_ms) || slaveResponseDelay_ms < 0) { showMessage('Slave Response Delay must be a non-negative number.', 'error'); calculationFailed = true; }
                if (isNaN(networkPropagationDelay_ms) || networkPropagationDelay_ms < 0) { showMessage('Network Propagation Delay must be a non-negative number.', 'error'); calculationFailed = true; }
                if (isNaN(overheadTimeRaw) || overheadTimeRaw < 0) { showMessage('Inter-Message Overhead Time (Value) must be a non-negative number.', 'error'); calculationFailed = true; }

                if (calculationFailed) return;

                // --- Step 1: Bit Time & Character Frame ---
                const bitTime_s = 1 / baudRate;
                const bitTime_us = bitTime_s * 1_000_000;
                const parityBits = (parity === 'None') ? 0 : 1;
                const bitsPerCharacter = 1 + dataBits + parityBits + stopBits; // 1 Start Bit

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">1</span>Bit Time & Character Frame</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>First, we find the time for one bit, then the total bits for one character (byte) including framing bits.</p>
                            <p class="calculation-step">Bit Time = 1 / ${baudRate} bps = ${bitTime_s.toExponential(3)} s</p>
                            <p class="calculation-step">Bits/Char = 1 (Start) + ${dataBits} (Data) + ${parityBits} (Parity) + ${stopBits} (Stop)</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Bit Time:</strong></p>
                            <div class="step-value">${(bitTime_us).toFixed(2)}<span class="step-unit">μs</span></div>
                            <p><strong>Total Bits per Character:</strong></p>
                            <div class="step-value">${bitsPerCharacter}<span class="step-unit">bits</span></div>
                        </div>
                    </div>
                </div>`;

                // --- Step 2: Character & Message Time ---
                const characterTime_s = bitsPerCharacter * bitTime_s;
                const characterTime_ms = characterTime_s * 1000;
                const requestTransmissionTime_ms = requestMessageBytes * characterTime_ms;
                const responseTransmissionTime_ms = responseMessageBytes * characterTime_ms;
                
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">2</span>Message Transmission Time</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>The time to send one character and the total time to transmit the request and response messages.</p>
                            <p class="calculation-step">Char Time = ${bitsPerCharacter} bits * ${bitTime_s.toExponential(3)} s = ${characterTime_s.toExponential(3)} s</p>
                            <p class="calculation-step">Request Time = ${requestMessageBytes} bytes * ${characterTime_ms.toFixed(3)} ms</p>
                            <p class="calculation-step">Response Time = ${responseMessageBytes} bytes * ${characterTime_ms.toFixed(3)} ms</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Character Time:</strong></p>
                            <div class="step-value">${characterTime_ms.toFixed(3)}<span class="step-unit">ms</span></div>
                            <p><strong>Request TX Time:</strong></p>
                            <div class="step-value">${requestTransmissionTime_ms.toFixed(3)}<span class="step-unit">ms</span></div>
                            <p><strong>Response TX Time:</strong></p>
                            <div class="step-value">${responseTransmissionTime_ms.toFixed(3)}<span class="step-unit">ms</span></div>
                        </div>
                    </div>
                </div>`;

                // --- Step 3: Delays & Overheads ---
                let calculatedOverheadTime_ms = 0;
                let overheadCalcString = '';
                if (overheadUnit === 'ms') {
                    calculatedOverheadTime_ms = overheadTimeRaw;
                    overheadCalcString = `<p class="calculation-step">Protocol Overhead = ${overheadTimeRaw.toFixed(2)} ms (User defined)</p>`;
                } else { // 'char_times'
                    calculatedOverheadTime_ms = overheadTimeRaw * characterTime_ms;
                    overheadCalcString = `<p class="calculation-step">Protocol Overhead = ${overheadTimeRaw} char * ${characterTime_ms.toFixed(3)} ms/char = ${calculatedOverheadTime_ms.toFixed(3)} ms</p>`;
                }
                
                const totalOverheadPerInteraction_ms = calculatedOverheadTime_ms + slaveResponseDelay_ms + (2 * networkPropagationDelay_ms);

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">3</span>Total Delays & Overhead Per Poll</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This is the total "silent time" for one poll, including protocol gaps, device processing time, and signal travel time (round trip).</p>
                            ${overheadCalcString}
                            <p class="calculation-step">Slave Delay = ${slaveResponseDelay_ms.toFixed(2)} ms</p>
                            <p class="calculation-step">Propagation Delay (x2) = 2 * ${networkPropagationDelay_ms.toFixed(2)} ms = ${(2 * networkPropagationDelay_ms).toFixed(2)} ms</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formula:</strong></p>
                            <p class="formula" style="font-size: 0.8rem;">$$T_{delay} = T_{overhead} + T_{slave} + (2 \times T_{prop})$$</p>
                            <p><strong>Total Delay per Poll:</strong></p>
                            <div class="step-value">${totalOverheadPerInteraction_ms.toFixed(3)}<span class="step-unit">ms</span></div>
                        </div>
                    </div>
                </div>`;

                // --- Step 4: Total Poll & Cycle Time ---
                const timePerDeviceInteraction_ms = requestTransmissionTime_ms + responseTransmissionTime_ms + totalOverheadPerInteraction_ms;
                const estimatedCycleTime_ms = numDevices * timePerDeviceInteraction_ms;
                const estimatedCycleTime_s = estimatedCycleTime_ms / 1000;

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">4</span>Total Poll & Cycle Time</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>The total time for one device poll is the sum of transmission times and delays. The total cycle time is this value multiplied by the number of devices.</p>
                            <p class="calculation-step">Time per Poll = ${requestTransmissionTime_ms.toFixed(3)} ms (Req) + ${responseTransmissionTime_ms.toFixed(3)} ms (Resp) + ${totalOverheadPerInteraction_ms.toFixed(3)} ms (Delay)</p>
                            <p class="calculation-step">Cycle Time = ${timePerDeviceInteraction_ms.toFixed(3)} ms/device * ${numDevices} devices</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Time per Single Poll:</strong></p>
                            <div class="step-value">${timePerDeviceInteraction_ms.toFixed(3)}<span class="step-unit">ms</span></div>
                            <p><strong>Total Network Cycle Time:</strong></p>
                            <div class="step-value">${estimatedCycleTime_ms.toFixed(2)}<span class="step-unit">ms</span></div>
                            <p>(${estimatedCycleTime_s.toFixed(3)} seconds)</p>
                        </div>
                    </div>
                </div>`;
                
                // --- Step 5: Network Utilization ---
                const totalUsefulBits = numDevices * (requestMessageBytes + responseMessageBytes) * dataBits;
                const networkUtilization = (totalUsefulBits / (estimatedCycleTime_s * baudRate)) * 100;
                
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">5</span>Network Utilization</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This estimates how much of the network's total bit capacity is used for sending *useful data* (excluding start/stop/parity bits and delays).</p>
                            <p class="calculation-step">Useful Bits = ${numDevices} devices * (${requestMessageBytes} + ${responseMessageBytes}) bytes * ${dataBits} bits/byte = ${totalUsefulBits.toFixed(0)} bits</p>
                            <p class="calculation-step">Total Capacity = ${baudRate} bps * ${estimatedCycleTime_s.toFixed(3)} s = ${(estimatedCycleTime_s * baudRate).toFixed(0)} bits</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formula:</strong></p>
                            <p class="formula">$$Util \% = \frac{\text{Total Useful Bits}}{\text{Baud Rate} \times T_{cycle}} \times 100$$</p>
                            <p><strong>Network Utilization:</strong></p>
                            <div class="step-value">${networkUtilization.toFixed(2)}<span class="step-unit">%</span></div>
                        </div>
                    </div>
                </div>`;

                // --- Display Results ---
                stepsContainer.innerHTML = stepsHtml;
                stepsContainer.classList.add('active');
                
                // --- Populate Summary Table ---
                resultTableBody.innerHTML = '';
                addResultRow(`<strong>Estimated Cycle Time</strong>`, `<strong>${estimatedCycleTime_ms.toFixed(2)} ms</strong>`, "highlight");
                addResultRow(`<strong>Network Utilization</strong>`, `<strong>${networkUtilization.toFixed(2)} %</strong>`, networkUtilization > 70 ? "error" : (networkUtilization > 50 ? "warning" : "highlight"));
                addResultRow(`Time per Single Poll`, `${timePerDeviceInteraction_ms.toFixed(3)} ms`);
                addResultRow(`Bit Time`, `${bitTime_us.toFixed(3)} μs`);
                addResultRow(`Character Time (${bitsPerCharacter} bits)`, `${characterTime_ms.toFixed(3)} ms`);
                addResultRow(`Request TX Time (${requestMessageBytes} bytes)`, `${requestTransmissionTime_ms.toFixed(3)} ms`);
                addResultRow(`Response TX Time (${responseMessageBytes} bytes)`, `${responseTransmissionTime_ms.toFixed(3)} ms`);
                addResultRow(`Total Delay per Poll`, `${totalOverheadPerInteraction_ms.toFixed(3)} ms`);

                // --- Update Status Display and Dynamic Recommendations ---
                let statusText = 'Timing Status: ';
                let statusClass = 'status-display ';
                let recommendations = [];

                if (estimatedCycleTime_ms < 100) {
                    statusText += 'Optimal (Very Fast)';
                    statusClass += 'optimal';
                    recommendations.push("Cycle time is excellent, suitable for high-speed control loops.");
                } else if (estimatedCycleTime_ms < 500) {
                    statusText += 'Adequate (Fast)';
                    statusClass += 'adequate';
                    recommendations.push("Cycle time is fast and suitable for most standard process control loops.");
                } else if (estimatedCycleTime_ms < 2000) {
                    statusText += 'Warning (Moderate)';
                    statusClass += 'warning';
                    recommendations.push("Cycle time is moderate. Acceptable for monitoring or slow loops, but may be too slow for responsive control.");
                } else {
                    statusText += 'Critical (Slow)';
                    statusClass += 'critical';
                    recommendations.push("Cycle time is very slow. This is likely unacceptable for control and may be slow even for monitoring. Investigate bottlenecks.");
                }

                if (networkUtilization > 70) {
                    recommendations.push("<strong>High Network Utilization:</strong> Your network is heavily loaded. There is little room for retries, which can lead to communication dropouts. Strongly consider increasing baud rate or segmenting the network.");
                } else if (networkUtilization > 50) {
                    recommendations.push("<strong>Moderate Network Utilization:</strong> Your network is moderately busy. Monitor performance, as adding more devices or handling retries could cause congestion.");
                }
                
                if (slaveResponseDelay_ms > 50) {
                     recommendations.push("The 'Slave Response Delay' is a significant bottleneck. Check if this can be improved or if this device is slowing down the entire network.");
                }
                if (protocolType === 'Modbus_RTU' && overheadTimeRaw !== 3.5 && overheadUnit === 'char_times') {
                    recommendations.push("For Modbus RTU, the standard inter-message gap is 3.5 character times. Using a different value may violate the protocol standard.");
                }

                recommendations.push("To improve cycle time, the best options are: 1) Increase Baud Rate, 2) Reduce Number of Devices (or segment the network), 3) Optimize polling to request fewer bytes.");

                recommendationsList.innerHTML = '';
                recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.innerHTML = rec; // Use innerHTML for bold tags
                    recommendationsList.appendChild(li);
                });
                dynamicRecommendationsDiv.style.display = 'block';

                timingStatusDisplay.textContent = statusText;
                timingStatusDisplay.className = statusClass;

                resultsSection.classList.remove('hidden');
                
                // Typeset MathJax
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    setTimeout(() => {
                        window.MathJax.typesetPromise([stepsContainer, document.getElementById('education-section')]);
                    }, 50); 
                }

                setTimeout(() => {
                    stepsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
            
            // --- Theme switch logic (from new file) ---
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // --- Initial setup calls ---
            applyProtocolDefaults();
            
            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });
        });
    </script>
</body>
</html>
