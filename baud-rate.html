<!DOCTYPE html>
<html lang="en" oncontextmenu="return false;">
<head>
    <!-- Google tag (gtag.js) -->
    <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baud Rate / Cycle Time Calculator - Instrumentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Basic CSS Variables for a consistent theme (Green) */
        :root {
            --primary-color: #28A745; /* Green */
            --secondary-color: #1E7E34; /* Darker Green */
            --accent-color: #FFC107; /* Amber (for warnings/accents) */
            --bg-color: #e6f2ed; /* Light Greenish Grey */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey (for contrast) */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #d9ead3; /* Lighter green for hover */
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #176B2F);
            --reset-button-bg: #6c757d; /* Grey for reset */
            --reset-button-hover-bg: #5a6268; /* Darker grey */
            --clear-button-bg: #FFC107; /* Amber for clear */
            --clear-button-hover-bg: #E0A800; /* Darker amber */
            --ok-color: #28a745; /* Green for OK status */
            --error-color: #dc3545; /* Red for error status */
            --warning-color: #ffc107; /* Amber for warnings */
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #446688;
            --button-gradient: linear-gradient(45deg, #1E7E34, #28A745);
            --button-hover-gradient: linear-gradient(45deg, #28A745, #34B850);
            --reset-button-bg: #5a6268; /* Darker grey for dark mode reset */
            --reset-button-hover-bg: #495057;
            --clear-button-bg: #DAA520; /* Darker amber for dark mode clear */
            --clear-button-hover-bg: #B8860B;
            --ok-color: #5cb85c;
            --error-color: #e74c3c;
            --warning-color: #DAA520;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-color), #d0d2d6);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.3s;
            width: fit-content;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg);
            color: var(--text-color);
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 0;
        }
        
        .calculate-btn, .save-btn, .load-btn {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 25px;
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto;
            min-width: 220px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .calculate-btn:hover, .save-btn:hover, .load-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .reset-btn {
            background-color: var(--reset-button-bg);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 25px;
            margin-left: 15px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .reset-btn:hover {
            background-color: var(--reset-button-hover-bg);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .clear-results-btn {
            background-color: var(--clear-button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .clear-results-btn:hover {
            background-color: var(--clear-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tr:last-child td {
            border-bottom: none;
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color);
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--hover-color);
            border-radius: 4px;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: color 0.3s;
        }

        .info-icon:hover {
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-size: 0.85em;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 250px;
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.95em;
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 12px 10px;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 8px;
            color: var(--text-color);
            white-space: pre-wrap;
            word-break: break-word;
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
            color: var(--text-color);
        }

        /* Style for centering the button */
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 20px;
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
            gap: 15px; /* Spacing between buttons */
        }

        /* Animation for input fields on focus */
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(40, 167, 69, 0.4); /* Green glow */
            outline: none;
            animation: pulse 0.8s infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 0 4px rgba(40, 167, 69, 0.4);
            }
            to {
                box-shadow: 0 0 0 8px rgba(40, 167, 69, 0.2);
            }
        }

        /* Status Display */
        .status-display {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.5s, color 0.5s;
            text-align: center;
            width: 100%;
        }
        .status-display.optimal {
            background-color: var(--ok-color);
            color: white;
        }
        .status-display.adequate {
            background-color: #66bb6a; /* Lighter green */
            color: white;
        }
        .status-display.warning {
            background-color: var(--warning-color);
            color: var(--text-color);
        }
        .status-display.critical {
            background-color: var(--error-color);
            color: white;
        }

        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            color: white;
            font-size: 1.5em;
            flex-direction: column;
            gap: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        #loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <header>
        <div class="container">
            <h1>Design Calculators - Instrumentation</h1>
            <p class="subtitle">Smart Tools for Modern Instrumentation Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <a href="indexInst.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </div>
        
        <div class="tool-container">
            <h2>Baud Rate / Cycle Time Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator helps determine communication timings for serial field buses like Modbus RTU, Profibus DP, etc. It calculates bit time, character time, message transmission time, and estimates polling cycle time for multiple devices, incorporating more real-world factors.</p>
            </div>
        
            <div class="calculator-form">
                <form id="baud-rate-calculator-form">
                    <!-- Communication Parameters -->
                    <div class="form-section">
                        <h3>Communication Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="protocol-type">Protocol Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the communication protocol. This may influence default overheads.</span></span></label>
                                <select id="protocol-type">
                                    <option value="Modbus_RTU">Modbus RTU</option>
                                    <option value="Generic_Serial">Generic Serial</option>
                                    <!-- Add more protocols as needed -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="baud-rate">Baud Rate <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The communication speed of the serial bus. (e.g., 9600, 19200, 115200)</span></span></label>
                                <input type="number" id="baud-rate" step="1" value="9600" required>
                                <select id="baud-rate-unit">
                                    <option value="bps">bps</option>
                                    <option value="kbps">kbps</option>
                                    <option value="Mbps">Mbps</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="data-bits">Data Bits <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Number of data bits per character (e.g., 7 or 8).</span></span></label>
                                <select id="data-bits">
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="stop-bits">Stop Bits <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Number of stop bits per character (e.g., 1 or 2).</span></span></label>
                                <select id="stop-bits">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="parity">Parity <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Parity setting for error checking (None, Even, Odd). Affects character length.</span></span></label>
                                <select id="parity">
                                    <option value="None">None</option>
                                    <option value="Even">Even</option>
                                    <option value="Odd">Odd</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Message & Network Parameters -->
                    <div class="form-section">
                        <h3>Message & Network Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="request-message-bytes">Request Message Length (Bytes) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total number of bytes in a typical request message (including address, function code, data, CRC/checksum).</span></span></label>
                                <input type="number" id="request-message-bytes" step="1" value="8" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="response-message-bytes">Response Message Length (Bytes) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total number of bytes in a typical response message (including address, function code, data, CRC/checksum).</span></span></label>
                                <input type="number" id="response-message-bytes" step="1" value="8" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="num-devices">Number of Devices (Slaves) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Number of slave devices on the bus that the master polls in a cycle.</span></span></label>
                                <input type="number" id="num-devices" step="1" value="5" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="slave-response-delay">Slave Device Response Delay (ms) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Typical time a slave device takes to process a request and begin sending a response.</span></span></label>
                                <input type="number" id="slave-response-delay" step="0.1" value="10" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="network-propagation-delay">Network Propagation Delay (ms) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Time for a signal to travel the full length of the network cable (one way).</span></span></label>
                                <input type="number" id="network-propagation-delay" step="0.01" value="0.5" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="overhead-time">Inter-Message Overhead Time (Value) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Additional time delay between messages or for master turnaround (e.g., for Modbus RTU, this is typically 3.5 character times).</span></span></label>
                                <input type="number" id="overhead-time" step="0.01" value="3.5" required>
                            </div>
                            <div class="form-group">
                                <label for="overhead-unit">Overhead Unit <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Unit for the Inter-Message Overhead Time (milliseconds or character times).</span></span></label>
                                <select id="overhead-unit">
                                    <option value="ms">ms</option>
                                    <option value="char_times">Character Times</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="calculate-btn">Calculate Timings</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>

            <div id="result-container" class="result-container">
                <h3>Communication Timing Results</h3>
                <p class="status-display" id="timing-status-display">Timing Status: N/A</p>

                <div id="calculation-details">
                    <h4>Step-by-Step Calculation</h4>
                    <div id="steps-list">
                        <!-- Calculation steps will be inserted here -->
                    </div>
                </div>

                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>

                <div id="practical-recommendations" style="display: none;">
                    <h4>Practical Considerations & Recommendations</h4>
                    <ul id="recommendations-list">
                        <!-- Recommendations will be dynamically inserted here -->
                    </ul>
                </div>

                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
                </div>
                <div class="standard-reference" id="standard-reference">
                    <p><strong>Applicable Standards and Guidelines:</strong> Understanding communication timings is crucial for designing reliable and responsive industrial control systems.</p>
                    <ul>
                        <li><strong>Baud Rate:</strong> The number of signal changes, or symbols, per second. For simple binary signaling, it's equivalent to bits per second (bps). Higher baud rates mean faster data transmission.</li>
                        <li><strong>Bit Time:</strong> The duration of a single bit (1 / Baud Rate).</li>
                        <li><strong>Character Frame:</strong> In serial communication (like RS-232, RS-485), each character is transmitted within a "frame" that includes:
                            <ul>
                                <li>1 Start Bit (always)</li>
                                <li>Data Bits (e.g., 7 or 8)</li>
                                <li>Parity Bit (optional: None, Even, Odd)</li>
                                <li>Stop Bits (e.g., 1 or 2)</li>
                            </ul>
                            The total number of bits per character is (1 + Data Bits + Parity Bits + Stop Bits).
                        </li>
                        <li><strong>Message Length:</strong> The total number of bytes in a complete communication message, including protocol-specific overhead like address, function code, data payload, and error checking (CRC/checksum). This calculator now allows for separate Request and Response message lengths, which is more accurate for many protocols.</li>
                        <li><strong>Inter-Message Overhead:</strong> Time delays between messages. For Modbus RTU, this is typically 3.5 character times (T3.5) to signify the end of a message and allow devices to reset their internal timers. Other protocols may have different requirements (e.g., turnaround times for half-duplex communication).</li>
                        <li><strong>Slave Device Response Delay:</strong> This accounts for the internal processing time of the slave device before it begins transmitting its response. This is a critical factor in real-world cycle times.</li>
                        <li><strong>Network Propagation Delay:</strong> The time it takes for electrical signals to travel across the physical cable. This becomes significant in very long cable runs or complex networks with many repeaters/converters.</li>
                        <li><strong>Cycle Time:</strong> For polling-based networks (like Modbus RTU master-slave), the cycle time is the total time it takes for the master to poll all slave devices and receive their responses. It directly impacts the responsiveness of the control system.</li>
                        <li><strong>Network Utilization:</strong> The percentage of available bandwidth that is actively being used for data transmission. High utilization can indicate a congested network and potential performance bottlenecks.</li>
                        <li><strong>Protocol Specifications:</strong> Always refer to the specific fieldbus protocol's documentation (e.g., Modbus Application Protocol, Profibus DP Technical Specification) for exact timing requirements, message structures, and overhead definitions.</li>
                    </ul>
                    <p>This tool provides a more refined estimation of communication timings. Actual performance can be influenced by network topology, cable quality, device processing delays, and electromagnetic interference. For critical applications, network analysis tools and real-world testing are essential.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Instrumentation!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Instrumentation! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <div id="custom-message-box"></div>
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <script type="module">
        document.addEventListener('DOMContentLoaded', async function() {
            // Input elements
            const protocolTypeSelect = document.getElementById('protocol-type');
            const baudRateInput = document.getElementById('baud-rate');
            const baudRateUnitSelect = document.getElementById('baud-rate-unit');
            const dataBitsSelect = document.getElementById('data-bits');
            const stopBitsSelect = document.getElementById('stop-bits');
            const paritySelect = document.getElementById('parity');
            const requestMessageBytesInput = document.getElementById('request-message-bytes'); // Changed
            const responseMessageBytesInput = document.getElementById('response-message-bytes'); // New
            const numDevicesInput = document.getElementById('num-devices');
            const slaveResponseDelayInput = document.getElementById('slave-response-delay'); // New
            const networkPropagationDelayInput = document.getElementById('network-propagation-delay'); // New
            const overheadTimeInput = document.getElementById('overhead-time');
            const overheadUnitSelect = document.getElementById('overhead-unit');

            // Buttons and result containers
            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const timingStatusDisplay = document.getElementById('timing-status-display');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const stepsList = document.getElementById('steps-list');
            const practicalRecommendationsDiv = document.getElementById('practical-recommendations');
            const recommendationsList = document.getElementById('recommendations-list');
            const loadingOverlay = document.getElementById('loading-overlay');

            // Default values for resetting form
            const defaultValues = {
                'protocol-type': 'Modbus_RTU',
                'baud-rate': 9600, 'baud-rate-unit': 'bps',
                'data-bits': '8',
                'stop-bits': '1',
                'parity': 'None',
                'request-message-bytes': 8, // Updated default
                'response-message-bytes': 8, // New default
                'num-devices': 5,
                'slave-response-delay': 10, // New default (ms)
                'network-propagation-delay': 0.5, // New default (ms)
                'overhead-time': 3.5, // Will be set by protocol type
                'overhead-unit': 'char_times' // Will be set by protocol type
            };

            // Helper for unit conversions
            const unitConversions = {
                baud_rate: { 'bps': 1, 'kbps': 1000, 'Mbps': 1000000 },
                time: { 's': 1, 'ms': 0.001, 'us': 0.000001 }
            };

            // Function to display custom messages
            function showCustomMessage(message, type = 'info') {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add(type); // Add type for styling (e.g., 'error', 'success', 'info')

                if (type === 'error') {
                    messageBox.style.backgroundColor = '#dc3545'; // Red
                } else if (type === 'success') {
                    messageBox.style.backgroundColor = '#28a745'; // Green
                } else if (type === 'warning') {
                    messageBox.style.backgroundColor = '#ffc107'; // Amber
                    messageBox.style.color = '#333'; // Dark text for amber
                } else {
                    messageBox.style.backgroundColor = '#28A745'; // Green (default info)
                }

                messageBox.style.opacity = '1';
                messageBox.style.transform = 'translateX(-50%) translateY(0)'; // Slide down animation

                setTimeout(() => {
                    messageBox.style.opacity = '0';
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)'; // Slide up animation
                }, 3000);
            }

            // Function to show/hide loading overlay
            function showLoading(message = "Loading...") {
                loadingOverlay.querySelector('p').textContent = message;
                loadingOverlay.classList.add('show');
            }

            function hideLoading() {
                loadingOverlay.classList.remove('show');
            }

            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            // Function to apply protocol-specific defaults
            function applyProtocolDefaults() {
                const protocol = protocolTypeSelect.value;
                if (protocol === 'Modbus_RTU') {
                    dataBitsSelect.value = '8';
                    stopBitsSelect.value = '1';
                    paritySelect.value = 'None'; // Or 'Even'/'Odd' depending on common setup
                    overheadTimeInput.value = '3.5';
                    overheadUnitSelect.value = 'char_times';
                    requestMessageBytesInput.value = '8'; // Common Modbus request length
                    responseMessageBytesInput.value = '8'; // Common Modbus response length (can vary)
                    slaveResponseDelayInput.value = '10'; // Typical for many Modbus slaves
                    networkPropagationDelayInput.value = '0.5'; // Small default for typical short runs
                } else if (protocol === 'Generic_Serial') {
                    // Reset to more generic defaults or keep user's last input
                    dataBitsSelect.value = '8';
                    stopBitsSelect.value = '1';
                    paritySelect.value = 'None';
                    overheadTimeInput.value = '0'; // Generic might not have fixed overhead
                    overheadUnitSelect.value = 'ms';
                    requestMessageBytesInput.value = '10';
                    responseMessageBytesInput.value = '10';
                    slaveResponseDelayInput.value = '50'; // More conservative for generic
                    networkPropagationDelayInput.value = '1'; // More conservative for generic
                }
                // Add more else if blocks for other protocols
            }

            // Event listener for protocol type change
            protocolTypeSelect.addEventListener('change', applyProtocolDefaults);
            // Apply defaults on initial load
            applyProtocolDefaults();


            // Calculation Logic
            calculateBtn.addEventListener('click', function() {
                resultTableBody.innerHTML = ''; // Clear previous results
                stepsList.innerHTML = ''; // Clear previous steps
                recommendationsList.innerHTML = ''; // Clear previous recommendations
                practicalRecommendationsDiv.style.display = 'none'; // Hide recommendations initially
                timingStatusDisplay.textContent = 'Timing Status: Calculating...';
                timingStatusDisplay.className = 'status-display'; // Reset class

                let calculationSteps = [];
                let currentMainStep = 1;
                let calculationFailed = false;

                // 1. Get and Validate Inputs
                let protocolType = protocolTypeSelect.value;
                let baudRate = parseFloat(baudRateInput.value) * unitConversions.baud_rate[baudRateUnitSelect.value];
                let dataBits = parseInt(dataBitsSelect.value);
                let stopBits = parseInt(stopBitsSelect.value);
                let parity = paritySelect.value;
                let requestMessageBytes = parseInt(requestMessageBytesInput.value);
                let responseMessageBytes = parseInt(responseMessageBytesInput.value);
                let numDevices = parseInt(numDevicesInput.value);
                let slaveResponseDelay = parseFloat(slaveResponseDelayInput.value); // ms
                let networkPropagationDelay = parseFloat(networkPropagationDelayInput.value); // ms
                let overheadTimeRaw = parseFloat(overheadTimeInput.value);
                let overheadUnit = overheadUnitSelect.value;

                // Input validation
                if (isNaN(baudRate) || baudRate <= 0) { showCustomMessage('Baud Rate must be a positive number.', 'error'); calculationFailed = true; }
                if (isNaN(dataBits) || (dataBits !== 7 && dataBits !== 8)) { showCustomMessage('Data Bits must be 7 or 8.', 'error'); calculationFailed = true; }
                if (isNaN(stopBits) || (stopBits !== 1 && stopBits !== 2)) { showCustomMessage('Stop Bits must be 1 or 2.', 'error'); calculationFailed = true; }
                if (isNaN(requestMessageBytes) || requestMessageBytes <= 0) { showCustomMessage('Request Message Length must be a positive integer.', 'error'); calculationFailed = true; }
                if (isNaN(responseMessageBytes) || responseMessageBytes <= 0) { showCustomMessage('Response Message Length must be a positive integer.', 'error'); calculationFailed = true; }
                if (isNaN(numDevices) || numDevices <= 0) { showCustomMessage('Number of Devices must be a positive integer.', 'error'); calculationFailed = true; }
                if (isNaN(slaveResponseDelay) || slaveResponseDelay < 0) { showCustomMessage('Slave Response Delay must be a non-negative number.', 'error'); calculationFailed = true; }
                if (isNaN(networkPropagationDelay) || networkPropagationDelay < 0) { showCustomMessage('Network Propagation Delay must be a non-negative number.', 'error'); calculationFailed = true; }
                if (isNaN(overheadTimeRaw) || overheadTimeRaw < 0) { showCustomMessage('Inter-Message Overhead Time (Value) must be a non-negative number.', 'error'); calculationFailed = true; }


                if (calculationFailed) {
                    resultContainer.style.display = 'none';
                    resultContainer.classList.remove('show');
                    return;
                }

                calculationSteps.push(`<strong>${currentMainStep++}. Input Parameters:</strong>`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Protocol Type: ${protocolType}`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Baud Rate: ${baudRateInput.value} ${baudRateUnitSelect.value} (${baudRate} bps)`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Data Bits: ${dataBits}`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Stop Bits: ${stopBits}`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Parity: ${parity}`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Request Message Length: ${requestMessageBytes} bytes`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Response Message Length: ${responseMessageBytes} bytes`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Number of Devices: ${numDevices}`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Slave Device Response Delay: ${slaveResponseDelay.toFixed(2)} ms`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Network Propagation Delay: ${networkPropagationDelay.toFixed(2)} ms`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Inter-Message Overhead Time: ${overheadTimeRaw} ${overheadUnit}`);

                // 2. Calculate Bit Time
                const bitTime = 1 / baudRate; // seconds
                calculationSteps.push(`<strong>${currentMainStep++}. Calculate Bit Time:</strong>`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Bit Time = 1 / Baud Rate = 1 / ${baudRate} bps = ${bitTime.toExponential(3)} seconds`);

                // 3. Calculate Parity Bits
                const parityBits = (parity === 'None') ? 0 : 1;
                calculationSteps.push(`<strong>${currentMainStep++}. Determine Parity Bits:</strong>`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Parity Type: ${parity}`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Parity Bits = ${parityBits}`);

                // 4. Calculate Bits per Character
                const bitsPerCharacter = 1 + dataBits + parityBits + stopBits; // 1 Start Bit + Data Bits + Parity Bit + Stop Bits
                calculationSteps.push(`<strong>${currentMainStep++}. Calculate Total Bits per Character:</strong>`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Bits per Character = 1 (Start) + Data Bits + Parity Bit + Stop Bits`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Bits per Character = 1 + ${dataBits} + ${parityBits} + ${stopBits} = ${bitsPerCharacter} bits`);

                // 5. Calculate Character Time
                const characterTime = bitsPerCharacter * bitTime; // seconds
                calculationSteps.push(`<strong>${currentMainStep++}. Calculate Character Time:</strong>`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Character Time = Bits per Character * Bit Time = ${bitsPerCharacter} bits * ${bitTime.toExponential(3)} s/bit = ${characterTime.toExponential(3)} seconds`);

                // 6. Calculate Message Transmission Times
                const requestTransmissionTime = requestMessageBytes * characterTime; // seconds
                const responseTransmissionTime = responseMessageBytes * characterTime; // seconds
                calculationSteps.push(`<strong>${currentMainStep++}. Calculate Message Transmission Times:</strong>`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Request Transmission Time = Request Message Length (bytes) * Character Time`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Request Transmission Time = ${requestMessageBytes} bytes * ${characterTime.toExponential(3)} s/char = ${requestTransmissionTime.toExponential(3)} seconds`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Response Transmission Time = Response Message Length (bytes) * Character Time`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Response Transmission Time = ${responseMessageBytes} bytes * ${characterTime.toExponential(3)} s/char = ${responseTransmissionTime.toExponential(3)} seconds`);


                // 7. Calculate Total Inter-Message Overhead Time (including user input, slave delay, propagation delay)
                let calculatedOverheadTime = 0; // seconds
                if (overheadUnit === 'ms') {
                    calculatedOverheadTime = overheadTimeRaw / 1000; // Convert ms to seconds
                    calculationSteps.push(`<strong>${currentMainStep++}. Calculate Inter-Message Overhead Time:</strong>`);
                    calculationSteps.push(`&nbsp;&nbsp;&nbsp;User-Defined Overhead (converted to seconds) = ${overheadTimeRaw} ms / 1000 = ${calculatedOverheadTime.toExponential(3)} seconds`);
                } else { // char_times
                    calculatedOverheadTime = overheadTimeRaw * characterTime; // Convert character times to seconds
                    calculationSteps.push(`<strong>${currentMainStep++}. Calculate Inter-Message Overhead Time:</strong>`);
                    calculationSteps.push(`&nbsp;&nbsp;&nbsp;User-Defined Overhead (converted to seconds) = Overhead Time (char_times) * Character Time`);
                    calculationSteps.push(`&nbsp;&nbsp;&nbsp;User-Defined Overhead = ${overheadTimeRaw} char_times * ${characterTime.toExponential(3)} s/char = ${calculatedOverheadTime.toExponential(3)} seconds`);
                }

                // Convert slave response delay and network propagation delay to seconds
                const slaveResponseDelaySec = slaveResponseDelay / 1000;
                const networkPropagationDelaySec = networkPropagationDelay / 1000;

                const totalOverheadPerInteraction = calculatedOverheadTime + slaveResponseDelaySec + (2 * networkPropagationDelaySec); // 2x for round trip
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Slave Response Delay (converted to seconds) = ${slaveResponseDelay.toFixed(2)} ms / 1000 = ${slaveResponseDelaySec.toExponential(3)} seconds`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Network Propagation Delay (round trip, converted to seconds) = 2 * ${networkPropagationDelay.toFixed(2)} ms / 1000 = ${(2 * networkPropagationDelaySec).toExponential(3)} seconds`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Total Overhead per Interaction = User-Defined Overhead + Slave Response Delay + (2 * Network Propagation Delay)`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Total Overhead per Interaction = ${calculatedOverheadTime.toExponential(3)} s + ${slaveResponseDelaySec.toExponential(3)} s + ${(2 * networkPropagationDelaySec).toExponential(3)} s = ${totalOverheadPerInteraction.toExponential(3)} seconds`);


                // 8. Estimate Cycle Time per device interaction and total cycle time
                const timePerDeviceInteraction = requestTransmissionTime + responseTransmissionTime + totalOverheadPerInteraction; // seconds
                const estimatedCycleTime = numDevices * timePerDeviceInteraction; // seconds

                calculationSteps.push(`<strong>${currentMainStep++}. Estimate Cycle Time:</strong>`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Time per Device Interaction = Request Transmission Time + Response Transmission Time + Total Overhead per Interaction`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Time per Device Interaction = ${requestTransmissionTime.toExponential(3)} s + ${responseTransmissionTime.toExponential(3)} s + ${totalOverheadPerInteraction.toExponential(3)} s = ${timePerDeviceInteraction.toExponential(3)} seconds`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Estimated Cycle Time = Number of Devices * Time per Device Interaction`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Estimated Cycle Time = ${numDevices} * ${timePerDeviceInteraction.toExponential(3)} s = ${estimatedCycleTime.toFixed(4)} seconds`);

                // 9. Calculate Network Utilization
                // Total data bits transmitted (request + response) per cycle
                const totalDataBitsPerCycle = numDevices * ((requestMessageBytes * dataBits) + (responseMessageBytes * dataBits));
                // Total bits transmitted (including overhead bits) per cycle
                const totalBitsPerCycle = numDevices * (requestMessageBytes * bitsPerCharacter + responseMessageBytes * bitsPerCharacter + (totalOverheadPerInteraction / bitTime));
                
                // Total bits that *could* be transmitted in the cycle time at full baud rate
                const theoreticalMaxBitsInCycle = baudRate * estimatedCycleTime;

                // Network Utilization = (Total bits actually transmitted / Theoretical max bits in cycle) * 100
                // A more practical network utilization is based on the actual data bits vs the total time.
                // Let's calculate based on (total useful bits) / (total bits including overhead)
                const totalUsefulBits = numDevices * (requestMessageBytes + responseMessageBytes) * dataBits;
                const networkUtilization = (totalUsefulBits / (estimatedCycleTime * baudRate)) * 100;


                calculationSteps.push(`<strong>${currentMainStep++}. Calculate Network Utilization:</strong>`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Total Useful Bits per Cycle = Number of Devices * (Request Bytes + Response Bytes) * Data Bits`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Total Useful Bits per Cycle = ${numDevices} * (${requestMessageBytes} + ${responseMessageBytes}) * ${dataBits} = ${totalUsefulBits} bits`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Total Bits Capacity in Cycle = Baud Rate * Estimated Cycle Time`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Total Bits Capacity in Cycle = ${baudRate} bps * ${estimatedCycleTime.toFixed(4)} s = ${theoreticalMaxBitsInCycle.toFixed(2)} bits`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Network Utilization = (Total Useful Bits per Cycle / Total Bits Capacity in Cycle) * 100`);
                calculationSteps.push(`&nbsp;&nbsp;&nbsp;Network Utilization = (${totalUsefulBits} / ${theoreticalMaxBitsInCycle.toFixed(2)}) * 100 = ${networkUtilization.toFixed(2)} %`);


                // Display Results in table
                const results = [
                    { param: 'Protocol Type', value: `${protocolType}` },
                    { param: 'Baud Rate', value: `${baudRateInput.value} ${baudRateUnitSelect.value}` },
                    { param: 'Data Bits', value: `${dataBits}` },
                    { param: 'Stop Bits', value: `${stopBits}` },
                    { param: 'Parity', value: `${parity}` },
                    { param: 'Bits per Character', value: `${bitsPerCharacter} bits` },
                    { param: 'Request Message Length', value: `${requestMessageBytes} bytes` },
                    { param: 'Response Message Length', value: `${responseMessageBytes} bytes` },
                    { param: 'Number of Devices', value: `${numDevices}` },
                    { param: 'Slave Device Response Delay', value: `${slaveResponseDelay.toFixed(2)} ms` },
                    { param: 'Network Propagation Delay', value: `${networkPropagationDelay.toFixed(2)} ms` },
                    { param: 'Inter-Message Overhead', value: `${overheadTimeRaw} ${overheadUnit}` },
                    { param: '<strong>Bit Time</strong>', value: `<strong>${(bitTime * 1000).toFixed(4)} ms</strong>` },
                    { param: '<strong>Character Time</strong>', value: `<strong>${(characterTime * 1000).toFixed(4)} ms</strong>` },
                    { param: '<strong>Request Transmission Time</strong>', value: `<strong>${(requestTransmissionTime * 1000).toFixed(4)} ms</strong>` },
                    { param: '<strong>Response Transmission Time</strong>', value: `<strong>${(responseTransmissionTime * 1000).toFixed(4)} ms</strong>` },
                    { param: '<strong>Estimated Cycle Time</strong>', value: `<strong>${(estimatedCycleTime * 1000).toFixed(2)} ms (${estimatedCycleTime.toFixed(4)} s)</strong>` },
                    { param: '<strong>Network Utilization</strong>', value: `<strong>${networkUtilization.toFixed(2)} %</strong>` }
                ];

                results.forEach(res => {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell(0);
                    const valueCell = row.insertCell(1);
                    paramCell.innerHTML = res.param;
                    valueCell.innerHTML = res.value;
                });

                // Populate step-by-step calculations
                stepsList.innerHTML = '';
                calculationSteps.forEach(step => {
                    const p = document.createElement('p');
                    p.className = 'calculation-step';
                    p.innerHTML = step;
                    stepsList.appendChild(p);
                });

                // Update Status Display and Recommendations
                let statusText = 'Timing Status: ';
                let statusClass = 'status-display ';
                let recommendations = [];

                if (estimatedCycleTime < 0.1) { // Very fast, e.g., < 100ms
                    statusClass += 'optimal';
                    statusText += 'Very Fast Cycle Time (Excellent Responsiveness)';
                    recommendations.push("The estimated cycle time is very fast, indicating excellent network responsiveness. This is ideal for applications requiring rapid data updates.");
                } else if (estimatedCycleTime >= 0.1 && estimatedCycleTime < 1) { // Fast, e.g., 100ms to 1s
                    statusClass += 'adequate';
                    statusText += 'Fast Cycle Time (Good Responsiveness)';
                    recommendations.push("The estimated cycle time is fast, providing good responsiveness for most industrial control applications.");
                } else if (estimatedCycleTime >= 1 && estimatedCycleTime < 5) { // Moderate, e.g., 1s to 5s
                    statusClass += 'warning';
                    statusText += 'Moderate Cycle Time (Acceptable for Non-Critical Apps)';
                    recommendations.push("The estimated cycle time is moderate. This might be acceptable for non-critical monitoring applications but could lead to delays in control loops. Consider optimizing parameters if faster response is needed.");
                } else { // Slow, e.g., > 5s
                    statusClass += 'critical';
                    statusText += 'Slow Cycle Time (Potential Performance Issues)';
                    recommendations.push("The estimated cycle time is slow, which may lead to significant delays in data updates and control responses. This is often unacceptable for real-time control. Review your network parameters and optimize for speed.");
                }
                
                recommendations.push("<strong>Optimize Baud Rate:</strong> Higher baud rates reduce bit time and overall transmission times. Ensure all devices and cables support the chosen baud rate.");
                recommendations.push("<strong>Minimize Message Lengths:</strong> Shorter request and response messages transmit faster. Only send necessary data.");
                recommendations.push("<strong>Reduce Number of Devices:</strong> Fewer devices to poll in a cycle will naturally reduce the overall cycle time.");
                recommendations.push("<strong>Account for Delays:</strong> Ensure accurate 'Slave Device Response Delay' and 'Network Propagation Delay' values are used, as these significantly impact the actual cycle time, especially in large or complex networks.");
                recommendations.push("<strong>Adjust Overhead Time:</strong> Ensure the inter-message overhead time is correctly configured according to the protocol specification (e.g., Modbus T3.5). Incorrect settings can lead to communication errors or unnecessary delays.");
                if (networkUtilization > 70) {
                    recommendations.push("<strong>High Network Utilization:</strong> Your calculated network utilization is high. This can lead to increased latency, retries, and potential communication failures, especially under peak load. Consider increasing baud rate, reducing message size, or segmenting the network.");
                } else if (networkUtilization > 50) {
                    recommendations.push("<strong>Moderate Network Utilization:</strong> Your network utilization is moderate. Monitor performance under peak conditions. If responsiveness is critical, consider optimizing parameters to reduce utilization.");
                }
                recommendations.push("<strong>Consider Network Load:</strong> This calculator provides theoretical timing. Actual network performance can be impacted by network traffic, device processing delays, and cable quality. For complex networks, use network analysis tools and real-world testing.");
                recommendations.push("<strong>Select Appropriate Protocol:</strong> For very high-speed or real-time applications, consider fieldbus protocols designed for such performance (e.g., Profinet, EtherNet/IP) over traditional serial protocols.");


                recommendationsList.innerHTML = '';
                recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.innerHTML = rec; // Use innerHTML for bold tags in recommendations
                    recommendationsList.appendChild(li);
                });
                practicalRecommendationsDiv.style.display = 'block'; // Show recommendations

                timingStatusDisplay.textContent = statusText;
                timingStatusDisplay.className = statusClass;

                resultContainer.style.display = 'block';
                // Trigger fade-in animation
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    showCustomMessage('Calculation successful!', 'success');
                }, 100);
            });

            // Reset Form Logic
            resetFormBtn.addEventListener('click', function() {
                for (const key in defaultValues) {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = defaultValues[key];
                        // Also update select elements
                        if (input.tagName === 'SELECT') {
                            input.value = defaultValues[key];
                        }
                    }
                }
                // Re-apply protocol defaults after general reset to ensure consistency
                applyProtocolDefaults();
                showCustomMessage('Form reset to default values.', 'info');
            });

            // Clear Results Logic
            clearResultsBtn.addEventListener('click', function() {
                resultContainer.classList.remove('show');
                setTimeout(() => {
                    resultContainer.style.display = 'none';
                    resultTableBody.innerHTML = '';
                    stepsList.innerHTML = '';
                    recommendationsList.innerHTML = '';
                    practicalRecommendationsDiv.style.display = 'none';
                    timingStatusDisplay.textContent = 'Timing Status: N/A';
                    timingStatusDisplay.className = 'status-display';
                }, 500); // Wait for fade-out transition
                showCustomMessage('Results cleared.', 'info');
            });

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>

</html>
