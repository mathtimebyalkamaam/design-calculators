<!DOCTYPE html>
<html lang="en">
<head>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');   
    </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Factor Correction - Design Calculators - Electrical</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* Custom CSS variables for theme */
        :root {
            --primary-color: #3b82f6; /* Blue */
            --secondary-color: #2563eb; /* Darker Blue */
            --text-color: #333;
            --bg-color: #f0f4f8; /* Light background */
            --card-bg: #ffffff;
            --border-color: #cbd5e1;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e8f0;
        }

        .dark-mode {
            --primary-color: #60a5fa; /* Lighter Blue for Header in Dark Mode */
            --secondary-color: #3b82f6; /* Blue */
            --text-color: #e2e8f0; /* Light text for general body */
            --bg-color: #1a202c; /* Dark background */
            --card-bg: #2d3748; /* Darker card background */
            --border-color: #4a5568;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --hover-color: #4a5568;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            background-color: var(--primary-color);
            color: white; /* Default white for header text */
            padding: 1.5rem 0;
            text-align: center;
            position: relative;
            overflow: hidden; /* For animations */
        }

        header .container {
            position: relative;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Specific text color for header in dark mode for better contrast */
        .dark-mode header h1,
        .dark-mode header .subtitle {
            color: #1a202c; /* Dark text to contrast with lighter primary-color in dark mode */
        }

        .theme-toggle {
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 10; /* Ensure it's above animations */
        }

        /* Switch for theme toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--secondary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--secondary-color);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .light-icon, .dark-icon {
            color: white;
        }

        .container {
            max-width: 1024px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 1rem;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            color: var(--primary-color);
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s;
        }

        .back-button:hover {
            color: var(--secondary-color);
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out; /* Animation */
        }

        .tool-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
            outline: none;
        }

        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-row .form-group {
            flex: 1 1 200px; /* Allows items to wrap naturally */
        }

        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s; /* Animation */
            position: relative;
            overflow: hidden;
        }

        .calculate-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* Ripple effect for button */
        .calculate-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            opacity: 0;
            transform: scale(1) translate(-50%, -50%);
            transition: transform 0.5s, opacity 0.5s;
        }

        .calculate-btn:active::after {
            transform: scale(20) translate(-50%, -50%);
            opacity: 1;
            transition: 0s;
        }

        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For fade-in animation */
            transform: translateY(20px); /* For slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .result-table th {
            background-color: var(--hover-color);
        }

        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
        }

        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position the tooltip above the text */
            left: 50%;
            margin-left: -100px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        footer {
            margin-top: 2rem;
            padding: 1.5rem 0;
            background-color: var(--card-bg);
            color: var(--text-color);
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .social-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .linkedin { background-color: #0077B5; }
        .facebook { background-color: #3b5998; }
        .twitter { background-color: #00acee; }
        .whatsapp { background-color: #25D366; }
        .reddit { background-color: #FF4500; }

        /* Modal styling */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s;
        }

        .modal.show {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            max-width: 400px;
            text-align: center;
            position: relative;
            transform: scale(0.9); /* For pop-in animation */
            transition: transform 0.3s ease-out;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .component-recommendations {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For fade-in animation */
            transform: translateY(20px); /* For slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .component-recommendations.show {
            opacity: 1;
            transform: translateY(0);
        }

        .component-recommendations h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        .component-recommendations ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        .component-recommendations ul li {
            margin-bottom: 8px;
        }

        /* Ensure h3 headings are white in dark mode for better visibility */
        .dark-mode .calculator-form h3,
        .dark-mode .result-container h3,
        .dark-mode .component-recommendations h3,
        .dark-mode .economic-recommendation h3 { /* Added new section */
            color: white; /* Explicitly set to white */
        }

        /* Styles for detailed calculation steps */
        .detailed-calculations {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--hover-color); /* A lighter background for contrast */
            overflow-x: auto; /* Allow horizontal scrolling for wide formulas */
        }

        .dark-mode .detailed-calculations {
            background-color: #3a475a; /* Darker background for contrast in dark mode */
            border-color: #6a7a8f;
        }

        .detailed-calculations h4 {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary-color); /* Highlight heading */
        }

        .dark-mode .detailed-calculations h4 {
            color: var(--primary-color); /* Use lighter primary color in dark mode */
        }

        .detailed-calculations p {
            margin-bottom: 5px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .detailed-calculations strong {
            color: var(--secondary-color); /* Highlight key terms in formulas */
        }

        .dark-mode .detailed-calculations strong {
            color: var(--primary-color); /* Use lighter primary color for highlights in dark mode */
        }

        /* Make MathJax rendered output slightly larger for readability */
        .MathJax .MJX_Assistive_MathML {
            font-size: 1.1em !important;
        }

        .calculation-step {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .detailed-calculations .calculation-step:last-child {
            border-bottom: none; /* No border after the last step */
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .form-row {
                flex-direction: column;
            }
            .form-row .form-group {
                flex: 1 1 auto;
            }
            .theme-toggle {
                position: static; /* Adjust for smaller screens */
                transform: none;
                justify-content: center;
                margin-top: 1rem;
            }
            header .container {
                padding-bottom: 1rem; /* Add space for theme toggle if moved */
            }
        }

        /* Header animation */
        @keyframes headerPulse {
            0% { background-color: var(--primary-color); }
            50% { background-color: var(--secondary-color); }
            100% { background-color: var(--primary-color); }
        }

        header {
            animation: headerPulse 10s infinite alternate;
        }

        /* Input focus animation */
        .form-group input:focus, .form-group select:focus {
            animation: inputFocusGlow 0.8s infinite alternate;
        }

        @keyframes inputFocusGlow {
            from { box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
            to { box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.4); }
        }

        /* Result table row hover effect */
        .result-table tbody tr {
            transition: background-color 0.3s ease;
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color);
        }

        /* Tooltip animation */
        .tooltip .tooltiptext {
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s;
        }

        .tooltip:hover .tooltiptext {
            transform: translateY(0);
        }

        /* Fix for tool-description text color in dark mode */
        .dark-mode .tool-description p {
            color: var(--text-color); /* Ensure it uses the light text color from dark mode variables */
        }

        /* Styles for SVG diagrams */
        /* Removed .connection-diagram styles as diagrams are removed */

        /* Economic Recommendation Section */
        .economic-recommendation {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For fade-in animation */
            transform: translateY(20px); /* For slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .economic-recommendation.show {
            opacity: 1;
            transform: translateY(0);
        }

        .economic-recommendation h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        .economic-recommendation ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        .economic-recommendation ul li {
            margin-bottom: 8px;
        }
        /* Animation for table rows */
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-table-row-animated {
            animation: slideInUp 0.5s ease-out forwards;
        }
    </style>
    <!-- MathJax configuration and loading moved to head -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                // Ensure MathJax processes elements that have the 'math-content' class
                processHtmlClass: 'math-content',
                // Also process content dynamically added
                ignoreHtmlClass: 'no-mathjax'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="antialiased">
    <header>
        <div class="container">
            <h1 class="text-3xl font-bold">Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy â€” Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container py-8">
        <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </a>
        
        <div class="tool-container mt-8 p-6">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-white mb-4">Power Factor Correction Tool</h2>
            
            <div class="tool-description mb-6 text-gray-600 dark:text-gray-400">
                <p>Calculate the required reactive power and capacitance to improve the power factor of your electrical system. This tool adheres to fundamental electrical engineering principles and relevant international standards for power factor correction.</p>
            </div>
            
            <div class="calculator-form">
                <form id="power-factor-form">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Input Parameters</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="loadPowerKW">Load Power (kW) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The real power consumed by the load.</span></span></label>
                            <input type="number" id="loadPowerKW" min="0" step="any" value="100" required>
                        </div>
                        <div class="form-group">
                            <label for="existingPowerFactor">Existing Power Factor (PF) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The current power factor of the load (e.g., 0.8 for 80%). Must be between 0.1 and 1.0.</span></span></label>
                            <input type="number" id="existingPowerFactor" min="0.1" max="1" step="0.01" value="0.8" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="targetPowerFactor">Target Power Factor (PF) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The desired power factor after correction (must be greater than or equal to existing PF, and less than or equal to 1.0).</span></span></label>
                            <input type="number" id="targetPowerFactor" min="0.1" max="1" step="0.01" value="0.95" required>
                        </div>
                        <div class="form-group">
                            <label for="systemVoltage">System Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The line-to-line voltage of the electrical system.</span></span></label>
                            <input type="number" id="systemVoltage" min="0" step="any" value="415" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="frequency">Frequency (Hz) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The system frequency (e.g., 50 or 60 Hz).</span></span></label>
                            <input type="number" id="frequency" min="10" max="100" step="1" value="50" required>
                        </div>
                        <div class="form-group">
                            <label for="phaseType">Phase Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select if the system is single-phase or three-phase.</span></span></label>
                            <select id="phaseType" required>
                                <option value="single">Single-Phase</option>
                                <option value="three" selected>Three-Phase</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="standardCapacitorKVAr">Standard 3-Phase Capacitor Unit (kVAr) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select a common standard reactive power rating for a complete 3-phase capacitor unit. This is used for sizing the number of physical units.</span></span></label>
                            <select id="standardCapacitorKVAr">
                                <option value="5">5 kVAr</option>
                                <option value="10">10 kVAr</option>
                                <option value="12.5">12.5 kVAr</option>
                                <option value="15">15 kVAr</option>
                                <option value="20">20 kVAr</option>
                                <option value="25" selected>25 kVAr</option>
                                <option value="50">50 kVAr</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="capacitorType">Capacitor Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the type of capacitor technology.</span></span></label>
                            <select id="capacitorType">
                                <option value="standard">Standard Duty (MPP)</option>
                                <option value="heavy-duty">Heavy Duty (APP)</option>
                                <option value="harmonic-filter">Harmonic Filter Capacitors</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="button" id="calculate-btn" class="calculate-btn">Calculate Power Factor Correction</button>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Calculation Summary</h3>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Summary Results will be inserted here -->
                    </tbody>
                </table>

                <!-- Added 'math-content' class for MathJax processing -->
                <div id="detailed-calculations" class="detailed-calculations mt-6 math-content">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Detailed Calculation Steps</h3>
                    <!-- Detailed calculation steps will be inserted here dynamically -->
                </div>

                <div id="economic-recommendation" class="economic-recommendation">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Most Economic and Reliable Solution Recommendation</h3>
                    <p class="mb-4">Choosing the right power factor correction scheme depends on various factors, including load characteristics, budget, and desired level of automation. Here's a comparison to help you decide:</p>
                    <ul class="list-disc pl-5 text-gray-700 dark:text-gray-300">
                        <li>
                            <strong>Fixed Compensation (Single Star or Delta Bank):</strong>
                            <ul class="list-circle pl-5">
                                <li><strong>Pros:</strong> Simplest and lowest initial cost.</li>
                                <li><strong>Cons:</strong> Suitable only for loads with constant reactive power demand. Can lead to over-correction if the load varies, resulting in leading power factor and potential penalties. Less reliable for dynamic loads.</li>
                                <li><strong>Best for:</strong> Loads with very stable and continuous reactive power consumption (e.g., large induction motors running continuously at full load).</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Automatic Power Factor Correction (APFC) with Stepped Capacitor Banks (Combination Scheme):</strong>
                            <ul class="list-circle pl-5">
                                <li><strong>Pros:</strong> Most common, economic, and reliable solution for varying industrial and commercial loads. Automatically adjusts reactive power compensation to maintain target PF, preventing over-correction and penalties. Extends capacitor life by only switching in necessary steps.</li>
                                <li><strong>Cons:</strong> Higher initial cost than fixed compensation due to APFC relay and multiple contactors/capacitor steps.</li>
                                <li><strong>Best for:</strong> Systems with fluctuating loads, where reactive power demand changes frequently (e.g., factories with multiple machines, commercial buildings). This is generally the **recommended solution** for most industrial and commercial applications due to its efficiency, reliability, and ability to adapt to changing load conditions.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Harmonic Filter Capacitors (Detuned or Tuned):</strong>
                            <ul class="list-circle pl-5">
                                <li><strong>Pros:</strong> Essential for systems with significant harmonic distortion (e.g., VFDs, UPS, LED lighting). Protects capacitors from harmonic currents and improves overall power quality.</li>
                                <li><strong>Cons:</strong> Highest initial cost due to the addition of reactors. Requires careful design to avoid resonance.</li>
                                <li><strong>Best for:</strong> Systems where Total Harmonic Distortion Current (THDI) is above 5-8%, or where sensitive electronic equipment is present. This is often implemented as a stepped APFC system, but with detuned reactors in series with each capacitor step.</li>
                            </ul>
                        </li>
                    </ul>
                    <p class="mt-4 text-gray-700 dark:text-gray-300"><strong>Overall Recommendation:</strong> For most applications with varying loads, an <strong>Automatic Power Factor Correction (APFC) panel with stepped capacitor banks</strong> (the "Combination Scheme") offers the most economic and reliable solution. If harmonic distortion is a concern, integrating detuned harmonic filters into the APFC system is highly recommended for optimal performance and equipment longevity.</p>
                </div>

                <div id="economic-benefits" class="economic-recommendation mt-8 p-6">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Economic Benefits of Power Factor Correction</h3>
                    <p class="mb-4">Improving your power factor offers significant economic and operational advantages for industrial and commercial facilities:</p>
                    <ul class="list-disc pl-5 text-gray-700 dark:text-gray-300">
                        <li>
                            <strong>Reduced Electricity Bills:</strong>
                            <ul class="list-circle pl-5">
                                <li>Many utilities charge penalties for low power factor (e.g., below 0.9 or 0.95). Correcting power factor eliminates or reduces these penalties.</li>
                                <li>Lower reactive power demand reduces the overall apparent power (kVA) drawn from the utility, potentially leading to lower demand charges.</li>
                                <li>Reduced current means lower $I^2R$ losses in cables and transformers, leading to energy savings.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Increased System Capacity:</strong>
                            <ul class="list-circle pl-5">
                                <li>By reducing reactive current, power factor correction frees up capacity in your existing transformers, switchgear, and cables. This allows for additional load to be added without costly upgrades to infrastructure.</li>
                                <li>For example, a system operating at 0.7 PF that is corrected to 0.95 PF can handle significantly more real power (kW) with the same kVA infrastructure.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Improved Voltage Regulation:</strong>
                            <ul class="list-circle pl-5">
                                <li>Low power factor causes higher current flow, leading to increased voltage drops across cables and transformers.</li>
                                <li>Power factor correction reduces these voltage drops, providing a more stable and higher voltage at the load terminals, which improves the performance and lifespan of electrical equipment.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Reduced Carbon Footprint:</strong>
                            <ul class="list-circle pl-5">
                                <li>Lower energy consumption and reduced losses contribute to a smaller carbon footprint, aligning with environmental sustainability goals.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Extended Equipment Lifespan:</strong>
                            <ul class="list-circle pl-5">
                                <li>Reduced current flow and improved voltage stability reduce thermal stress on electrical components, extending the lifespan of motors, transformers, and other equipment.</li>
                            </ul>
                        </li>
                    </ul>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400"><em>The payback period for power factor correction equipment is often very short, typically ranging from 6 months to 2 years, making it a highly attractive investment.</em></p>
                </div>

                <div class="standard-reference" id="standard-reference">
                    <p>Calculations are based on fundamental power factor correction principles. Relevant international standards for the design and installation of Power Factor Correction (PFC) equipment include: <br>
                    - <strong>IEEE Std 18-2012:</strong> IEEE Standard for Shunt Power Capacitors.<br>
                    - <strong>IEC 60831-1 & 2:</strong> Shunt power capacitors of the self-healing type for A.C. systems having a rated voltage up to and including $1000V$.<br>
                    - <strong>IEC 61439:</strong> Low-voltage switchgear and controlgear assemblies (for capacitor bank panels).</p>
                </div>
            </div>

            <div id="component-recommendations" class="component-recommendations mt-8 p-6">
                <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Recommended Components for Power Factor Correction</h3>
                <p class="mb-4">To effectively correct the power factor and ensure safe operation, the following standard components are typically required:</p>
                <ul class="list-disc pl-5 text-gray-700 dark:text-gray-300">
                    <li>
                        <strong>Power Capacitors:</strong> These are the main components that provide the necessary reactive power (kVAr) to counteract the inductive load. They come in various ratings (e.g., 5 kVAr, 10 kVAr, 25 kVAr) and can be single-phase or three-phase. Look for robust, self-healing types designed for power factor correction.
                    </li>
                    <li>
                        <strong>Capacitor Duty Contactors:</strong> Standard contactors are not suitable for switching capacitors due to high inrush currents. Capacitor duty contactors are specially designed with damping resistors to limit these currents, ensuring smooth switching and longer life for both the contactor and the capacitors.
                    </li>
                    <li>
                        <strong>Automatic Power Factor Control (APFC) Relay:</strong> This smart device continuously monitors the power factor of your system. It automatically switches capacitor steps (banks of capacitors) ON or OFF as needed to maintain the target power factor, ensuring optimal compensation and preventing over-correction.
                    </li>
                    <li>
                        <strong>Detuned Harmonic Filters (Reactors):</strong> If your electrical system has significant harmonic distortion (often caused by electronic loads like VFDs, LED lighting, etc.), simple capacitors can amplify these harmonics. Detuned reactors are installed in series with capacitors to block harmonics, protecting the capacitors and improving overall power quality. This is crucial for systems with a Total Harmonic Distortion Current (THDI) above 5-8%.
                    </li>
                    <li>
                        <strong>Fuses/Circuit Breakers:</strong> These are essential safety devices that protect the capacitor banks and the associated wiring from overcurrents and short circuits. Proper sizing is critical.
                    </li>
                    <li>
                        <strong>Discharge Resistors:</strong> These are vital safety components installed across capacitor terminals. They ensure that the capacitor discharges to a safe voltage level within a specified time (e.g., 5 seconds as per IEEE Std 18) after being disconnected from the power supply, preventing electric shock hazards during maintenance.
                    </li>
                    <li>
                        <strong>Switchgear and Enclosures:</strong> All the above components are typically housed in a robust, ventilated electrical panel or switchgear. This provides physical protection, allows for safe access for maintenance, and ensures compliance with electrical safety regulations.
                    </li>
                    <li>
                        <strong>Cables and Busbars:</strong> Appropriate sizing of cables and busbars is necessary to safely carry the current to and from the capacitor banks.
                    </li>
                </ul>
                <p class="mt-4 text-sm text-gray-600 dark:text-gray-400"><em>It's always recommended to consult with a qualified electrical engineer for specific system design and component selection.</em></p>
            </div>

        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                
                <p class="text-sm">Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit mt-4">
                <p class="text-sm">Created by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share mt-4">
                <h3 class="text-lg font-semibold">Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Electrical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Electrical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Custom Modal for Alerts -->
    <div id="custom-alert-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-alert-modal">&times;</span>
            <p id="alert-message"></p>
            <button class="calculate-btn mt-4" id="ok-alert-button">OK</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeSwitch = document.getElementById('theme-switch');
            const body = document.body;

            // Apply saved theme preference or default to light mode
            if (localStorage.getItem('theme') === 'dark') {
                body.classList.add('dark-mode');
                themeSwitch.checked = true;
            } else {
                body.classList.remove('dark-mode');
                themeSwitch.checked = false;
            }

            // Theme toggle functionality
            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    body.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                } else {
                    body.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                }
            });

            const loadPowerKWInput = document.getElementById('loadPowerKW');
            const existingPowerFactorInput = document.getElementById('existingPowerFactor');
            const targetPowerFactorInput = document.getElementById('targetPowerFactor');
            const systemVoltageInput = document.getElementById('systemVoltage');
            const frequencyInput = document.getElementById('frequency');
            const phaseTypeSelect = document.getElementById('phaseType');
            const standardCapacitorKVArSelect = document.getElementById('standardCapacitorKVAr');
            const capacitorTypeSelect = document.getElementById('capacitorType');
            
            const calculateBtn = document.getElementById('calculate-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const detailedCalculationsDiv = document.getElementById('detailed-calculations'); 
            const componentRecommendationsDiv = document.getElementById('component-recommendations');
            const economicRecommendationDiv = document.getElementById('economic-recommendation');

            // Set default values for inputs
            loadPowerKWInput.value = 100;
            existingPowerFactorInput.value = 0.8;
            targetPowerFactorInput.value = 0.95;
            systemVoltageInput.value = 415;
            frequencyInput.value = 50;
            phaseTypeSelect.value = 'three';
            standardCapacitorKVArSelect.value = 25;
            capacitorTypeSelect.value = 'standard';


            // Custom Alert Modal elements
            const customAlertModal = document.getElementById('custom-alert-modal');
            const alertMessage = document.getElementById('alert-message');
            const closeAlertModalBtn = document.getElementById('close-alert-modal');
            const okAlertButton = document.getElementById('ok-alert-button');

            // Function to show custom alert
            function showCustomAlert(message) {
                alertMessage.textContent = message;
                customAlertModal.classList.add('show');
            }

            // Function to hide custom alert
            function hideCustomAlert() {
                customAlertModal.classList.remove('show');
            }

            closeAlertModalBtn.addEventListener('click', hideCustomAlert);
            okAlertButton.addEventListener('click', hideCustomAlert);
            customAlertModal.addEventListener('click', (e) => {
                if (e.target === customAlertModal) {
                    hideCustomAlert();
                }
            });

            calculateBtn.addEventListener('click', function() {
                // Clear previous results and hide containers
                resultTableBody.innerHTML = '';
                // Clear and re-add heading for detailed calculations
                detailedCalculationsDiv.innerHTML = '<h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Detailed Calculation Steps</h3>'; 
                
                // Hide and reset animations for result sections
                resultContainer.classList.remove('show');
                componentRecommendationsDiv.classList.remove('show');
                economicRecommendationDiv.classList.remove('show');

                resultContainer.style.display = 'none';
                componentRecommendationsDiv.style.display = 'none';
                economicRecommendationDiv.style.display = 'none';

                const loadPowerKW = parseFloat(loadPowerKWInput.value);
                const existingPF = parseFloat(existingPowerFactorInput.value);
                const targetPF = parseFloat(targetPowerFactorInput.value);
                const systemVoltage = parseFloat(systemVoltageInput.value);
                const frequency = parseFloat(frequencyInput.value);
                const phaseType = phaseTypeSelect.value;
                const standardCapacitorKVAr = parseFloat(standardCapacitorKVArSelect.value);
                const capacitorType = capacitorTypeSelect.value;

                // Input validation
                if (isNaN(loadPowerKW) || isNaN(existingPF) || isNaN(targetPF) || isNaN(systemVoltage) || isNaN(frequency)) {
                    showCustomAlert("Please fill in all required fields with valid numbers.");
                    return;
                }
                if (loadPowerKW <= 0) {
                    showCustomAlert("Load Power (kW) must be a positive value.");
                    return;
                }
                if (existingPF < 0.1 || existingPF > 1 || targetPF < 0.1 || targetPF > 1) {
                    showCustomAlert("Power Factors must be between 0.1 and 1.0.");
                    return;
                }
                if (targetPF < existingPF) {
                    showCustomAlert("Target Power Factor cannot be less than the Existing Power Factor. It must be greater than or equal to the existing PF.");
                    return;
                }
                if (systemVoltage <= 0) {
                    showCustomAlert("System Voltage (V) must be a positive value.");
                    return;
                }
                if (frequency <= 0) {
                    showCustomAlert("Frequency (Hz) must be a positive value.");
                    return;
                }

                // --- Calculation Steps ---
                // Step 1: Calculate the angles (phi) from the power factors
                // Formula: phi = arccos(PF)
                const initialAngle = Math.acos(existingPF);
                const targetAngle = Math.acos(targetPF);

                // Step 2: Calculate initial and target reactive power (kVAr)
                // Formula: Reactive Power (Q) = Active Power (P) * tan(phi)
                const initialKVAr = loadPowerKW * Math.tan(initialAngle);
                const targetKVAr = loadPowerKW * Math.tan(targetAngle);

                // Step 3: Calculate the required capacitive reactive power (kVAr) with Safety Factor
                // Apply a practical safety factor (e.g., 5-10% for industrial applications)
                const safetyFactor = 1.05; // 5% safety factor for practical oversizing
                const requiredCapacitiveKVArRaw = initialKVAr - targetKVAr;
                const requiredCapacitiveKVAr = requiredCapacitiveKVArRaw * safetyFactor;

                // Step 4: Calculate Angular Frequency (omega)
                // Formula: omega = 2 * pi * f
                const omega = 2 * Math.PI * frequency; // Angular frequency in radians per second

                // Step 5: Convert required reactive power to VAR for capacitance calculation
                const Qc_VAR = requiredCapacitiveKVAr * 1000; // Required reactive power in VAR

                let capacitanceMicroF_singlePhase = 0;
                let capacitanceMicroF_threePhaseDelta = 0;
                let capacitanceMicroF_threePhaseStar = 0;
                let calculationNote = "";
                let numberOfCapacitorUnits = 0;
                let totalIndividualCapacitors = 0;

                if (requiredCapacitiveKVAr > 0) {
                    // Capacitance for Single Phase
                    capacitanceMicroF_singlePhase = Qc_VAR / (omega * systemVoltage * systemVoltage) * 1e6; // in microF

                    if (phaseType === 'three') {
                        // Capacitance for Three-Phase Delta connection (per phase)
                        capacitanceMicroF_threePhaseDelta = Qc_VAR / (3 * omega * systemVoltage * systemVoltage) * 1e6; // in microF per phase

                        // Capacitance for Three-Phase Star connection (per phase)
                        capacitanceMicroF_threePhaseStar = Qc_VAR / (omega * systemVoltage * systemVoltage) * 1e6; // in microF per phase
                    }

                    // Calculate number of standard capacitor units
                    if (standardCapacitorKVAr > 0) {
                        numberOfCapacitorUnits = Math.ceil(requiredCapacitiveKVAr / standardCapacitorKVAr);
                        
                        if (phaseType === 'three') {
                            totalIndividualCapacitors = numberOfCapacitorUnits * 3;
                        } else { // Single phase
                            totalIndividualCapacitors = numberOfCapacitorUnits; // For single phase, it's just the number of units
                        }

                    } else {
                        showCustomAlert("Please select a valid Standard Capacitor Unit (kVAr).");
                        return;
                    }

                } else {
                    calculationNote = "No capacitive kVAr needed. Power factor is already sufficient or cannot be improved with capacitors (e.g., if it's already 1.0 or target PF is less than existing PF).";
                }


                // Display Detailed Calculation Steps (Ensuring full LaTeX enclosure)
                addDetailedCalculationStep(
                    "Step 1: Calculate Initial Angle ($\\phi_{\\text{initial}}$)",
                    `This step determines the phase angle corresponding to your current power factor. A lagging angle indicates an inductive load, which is common in industrial settings due to motors and transformers.`,
                    `Formula: $\\phi_{\\text{initial}} = \\text{arccos}(PF_{\\text{initial}})$`,
                    `Calculation: $\\phi_{\\text{initial}} = \\text{arccos}(${existingPF.toFixed(3)}) \\approx ${ (initialAngle * 180 / Math.PI).toFixed(2) }^{\\circ}$`
                );

                addDetailedCalculationStep(
                    "Step 2: Calculate Target Angle ($\\phi_{\\text{target}}$)",
                    `This is the desired phase angle after power factor correction. The goal is to bring this angle closer to $0^{\\circ}$ (meaning a power factor closer to 1.0) to minimize reactive power flow.`,
                    `Formula: $\\phi_{\\text{target}} = \\text{arccos}(PF_{\\text{target}})$`,
                    `Calculation: $\\phi_{\\text{target}} = \\text{arccos}(${targetPF.toFixed(3)}) \\approx ${ (targetAngle * 180 / Math.PI).toFixed(2) }^{\\circ}$`
                );
                
                addDetailedCalculationStep(
                    "Step 3: Calculate Initial Reactive Power ($Q_{\\text{initial}}$)",
                    `This represents the reactive power currently consumed by your inductive loads. This power does no useful work but is necessary to establish magnetic fields in equipment like motors.`,
                    `Formula: $P$ is Load Power (kW). $Q_{\\text{initial}} = P \\cdot \\tan(\\phi_{\\text{initial}})$`,
                    `Calculation: $Q_{\\text{initial}} = ${loadPowerKW.toFixed(2)} \\text{ kW} \\cdot \\tan(${initialAngle.toFixed(3)}) \\approx ${initialKVAr.toFixed(2)} \\text{ kVAr}$`
                );

                addDetailedCalculationStep(
                    "Step 4: Calculate Target Reactive Power ($Q_{\\text{target}}$)",
                    `This is the reactive power that will still be present in the system after correction to achieve the target power factor. Ideally, this value is very small or zero if the target power factor is 1.0.`,
                    `Formula: $Q_{\\text{target}} = P \\cdot \\tan(\\phi_{\\text{target}})$`,
                    `Calculation: $Q_{\\text{target}} = ${loadPowerKW.toFixed(2)} \\text{ kW} \\cdot \\tan(${targetAngle.toFixed(3)}) \\approx ${targetKVAr.toFixed(2)} \\text{ kVAr}$`
                );

                addDetailedCalculationStep(
                    "Step 5: Calculate Required Capacitive Reactive Power ($Q_c$) with Safety Factor",
                    `This is the amount of reactive power that needs to be supplied by capacitors to offset the inductive reactive power and improve the power factor to your target. A safety factor is applied to ensure sufficient compensation and account for future load changes or variations.`,
                    `Formula: $Q_c = (Q_{\\text{initial}} - Q_{\\text{target}}) \\cdot \\text{Safety Factor}$ <br> (A safety factor of ${((safetyFactor - 1) * 100).toFixed(0)}\\%$ is applied for practical industrial design, accounting for potential load changes or future expansion.)`,
                    `Calculation: $Q_c = (${initialKVAr.toFixed(2)} \\text{ kVAr} - ${targetKVAr.toFixed(2)} \\text{ kVAr}) \\cdot ${safetyFactor.toFixed(2)} = ${requiredCapacitiveKVAr.toFixed(2)} \\text{ kVAr}$`
                );

                if (requiredCapacitiveKVAr > 0) {
                    addDetailedCalculationStep(
                        "Step 6: Calculate Angular Frequency ($\\omega$)",
                        `Angular frequency is a fundamental parameter in AC circuits, representing the rate of change of the phase of a sinusoidal waveform. It is crucial for calculating capacitive reactance and capacitance.`,
                        `Formula: $\\omega = 2 \\cdot \\pi \\cdot f$`,
                        `Calculation: $\\omega = 2 \\cdot \\pi \\cdot ${frequency.toFixed(1)} \\text{ Hz} \\approx ${omega.toFixed(2)} \\text{ rad/s}$`
                    );

                    addDetailedCalculationStep(
                        "Step 7: Calculate Required Capacitance ($C$)",
                        `This calculates the physical capacitance required to provide the calculated reactive power. The formula varies depending on whether the system is single-phase or three-phase, and for three-phase, whether a Delta or Star connection is used.`,
                        phaseType === 'single' ? 
                        `For Single-Phase System: <br> Formula: $C = \\frac{Q_c \\cdot 1000}{\\omega \\cdot V^2}$ <br> Calculation: $C = \\frac{${(requiredCapacitiveKVAr * 1000).toFixed(0)} \\text{ VAR}}{${omega.toFixed(2)} \\text{ rad/s} \\cdot ${systemVoltage.toFixed(0)}^2 \\text{ V}^2} \\approx ${capacitanceMicroF_singlePhase.toFixed(2)} \\text{ }\\mu\\text{F}$`
                        :
                        `For Three-Phase System: <br>
                        <strong>Delta ($\Delta$) Connection (per phase):</strong> <br> Formula: $C_{\\Delta} = \\frac{Q_c \\cdot 1000}{3 \\cdot \\omega \\cdot V_{\\text{line}}^2}$ <br> Calculation: $C_{\\Delta} = \\frac{${(requiredCapacitiveKVAr * 1000).toFixed(0)} \\text{ VAR}}{3 \\cdot ${omega.toFixed(2)} \\text{ rad/s} \\cdot ${systemVoltage.toFixed(0)}^2 \\text{ V}^2} \\approx ${capacitanceMicroF_threePhaseDelta.toFixed(2)} \\text{ }\\mu\\text{F}$ <br><br>
                        <strong>Star (Y) Connection (per phase):</strong> <br> Formula: $C_Y = \\frac{Q_c \\cdot 1000}{\\omega \\cdot V_{\\text{line}}^2}$ <br> Calculation: $C_Y = \\frac{${(requiredCapacitiveKVAr * 1000).toFixed(0)} \\text{ VAR}}{${omega.toFixed(2)} \\text{ rad/s} \\cdot ${systemVoltage.toFixed(0)}^2 \\text{ V}^2} \\approx ${capacitanceMicroF_threePhaseStar.toFixed(2)} \\text{ }\\mu\\text{F}$`
                    );

                    addDetailedCalculationStep(
                        "Step 8: Calculate Number of Standard Capacitor Units",
                        `This determines how many standard capacitor units (e.g., 3-phase units) are needed to meet the total required capacitive reactive power. We use the ceiling function ($\\lceil \\rceil$) to ensure we round up to the nearest whole unit, as you cannot install a fraction of a capacitor unit.`,
                        `Formula: $\\text{Number of 3-Phase Units} = \\lceil \\frac{Q_c}{\\text{Standard 3-Phase Unit kVAr}} \\rceil$`,
                        `Calculation: $\\text{Number of 3-Phase Units} = \\lceil \\frac{${requiredCapacitiveKVAr.toFixed(2)} \\text{ kVAr}}{${standardCapacitorKVAr.toFixed(1)} \\text{ kVAr}} \\rceil = ${numberOfCapacitorUnits} \\text{ units}$`
                    );

                    if (phaseType === 'three') {
                        addDetailedCalculationStep(
                            "Step 9: Total Individual Capacitors",
                            `Each standard 3-phase capacitor unit typically consists of three individual capacitor elements (one for each phase). This step calculates the total count of these individual elements.`,
                            `Calculation: $\\text{Total Individual Capacitors} = ${numberOfCapacitorUnits} \\text{ (3-Phase Units)} \\times 3 \\text{ (capacitors/unit)} = ${totalIndividualCapacitors} \\text{ individual capacitors.}$`
                        );
                        addDetailedCalculationStep(
                            "Step 10: Sizing for Automatic Power Factor Correction (APFC) Panels",
                            `For APFC panels, the total required capacitive kVAr ($Q_c$) is typically divided into multiple steps (e.g., 6, 8, or 12 steps) using standard capacitor unit ratings. This allows the APFC relay to precisely switch in the necessary reactive power to maintain the target power factor as the load varies, preventing over-compensation and potential leading power factor penalties.`,
                            `Example: If $Q_c = ${requiredCapacitiveKVAr.toFixed(2)} \\text{ kVAr}$ and the standard unit is ${standardCapacitorKVAr.toFixed(1)} \\text{ kVAr}$, you might have steps like $${standardCapacitorKVAr.toFixed(1)} \\text{ kVAr}$ to achieve the total compensation. The APFC relay will then manage these steps automatically.`
                        );
                    }

                    // Add a note if Harmonic Filter Capacitors are selected
                    if (capacitorType === 'harmonic-filter') {
                        addDetailedCalculationStep(
                            "Note on Harmonic Filter Capacitors (IEEE 519)",
                            `You have selected 'Harmonic Filter Capacitors'. In systems with significant harmonic distortion (e.g., from VFDs, UPS, LED lighting), standard capacitors can resonate with system inductance, leading to overvoltages and equipment damage. Harmonic filter capacitors are designed with series reactors to block specific harmonic frequencies, protecting the capacitors and improving overall power quality.`,
                            `While this calculator determines the fundamental reactive power needed, the actual selection and tuning of harmonic filters in a real-world industrial scenario requires a detailed harmonic study (e.g., as per IEEE 519) to identify dominant harmonic frequencies and ensure proper filter design.`
                        );
                    }

                } else {
                    addDetailedCalculationStep("Note", "", calculationNote);
                }

                // Display Summary Results
                addResultRow("Load Power (P)", loadPowerKW.toFixed(2) + " kW");
                addResultRow("Existing Power Factor (PF_initial)", existingPF.toFixed(3));
                addResultRow("Target Power Factor (PF_target)", targetPF.toFixed(3));
                addResultRow("System Voltage (V)", systemVoltage.toFixed(2) + " V");
                addResultRow("Frequency (f)", frequency.toFixed(1) + " Hz");
                addResultRow("Phase Type", phaseType === 'single' ? "Single-Phase" : "Three-Phase");
                addResultRow("Initial Reactive Power (Q_initial)", initialKVAr.toFixed(2) + " kVAr");
                addResultRow("Target Reactive Power (Q_target)", targetKVAr.toFixed(2) + " kVAr");
                addResultRow("Required Capacitive Reactive Power (Qc) with Safety Factor", requiredCapacitiveKVAr.toFixed(2) + " kVAr");
                addResultRow("Selected Standard 3-Phase Capacitor Unit Rating", standardCapacitorKVAr.toFixed(1) + " kVAr"); // Updated label
                addResultRow("Selected Capacitor Type", capacitorTypeSelect.options[capacitorTypeSelect.selectedIndex].text);

                if (requiredCapacitiveKVAr > 0) {
                    if (phaseType === 'single') {
                        addResultRow("Required Capacitance (C)", capacitanceMicroF_singlePhase.toFixed(2) + " $\\mu$F");
                        addResultRow("Number of Standard Single-Phase Units Required", numberOfCapacitorUnits + " units");
                    } else {
                        addResultRow("Required Capacitance per phase (Delta connection)", capacitanceMicroF_threePhaseDelta.toFixed(2) + " $\\mu$F");
                        addResultRow("Required Capacitance per phase (Star connection)", capacitanceMicroF_threePhaseStar.toFixed(2) + " $\\mu$F");
                        addResultRow("Number of Standard 3-Phase Units Required", numberOfCapacitorUnits + " units");
                        addResultRow("Total Individual Capacitors (3-Phase)", totalIndividualCapacitors + " capacitors (3 per 3-phase unit)");
                    }
                }
                
                // Show result sections with animation
                resultContainer.style.display = 'block';
                componentRecommendationsDiv.style.display = 'block';
                economicRecommendationDiv.style.display = 'block';
                
                // Apply 'show' class after a small delay to trigger CSS transitions
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    componentRecommendationsDiv.classList.add('show');
                    economicRecommendationDiv.classList.add('show');
                }, 10); 

                resultContainer.scrollIntoView({ behavior: 'smooth' });

                // IMPORTANT: Tell MathJax to re-render the newly added content after a small delay
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    setTimeout(() => {
                        window.MathJax.typesetPromise([detailedCalculationsDiv, resultTableBody, economicRecommendationDiv, document.getElementById('economic-benefits')])
                            .catch((err) => console.error('MathJax typesetting failed:', err));
                    }, 50); // Small delay to ensure DOM is fully rendered
                }
            });
            
            // Helper function to add a row to the summary result table
            function addResultRow(parameter, value) {
                const row = document.createElement('tr');
                
                const paramCell = document.createElement('td');
                // Use innerHTML to render LaTeX in parameter
                paramCell.innerHTML = parameter; 
                paramCell.classList.add('font-medium');
                
                const valueCell = document.createElement('td');
                // Use innerHTML to render LaTeX in value
                valueCell.innerHTML = value;
                
                row.appendChild(paramCell);
                row.appendChild(valueCell);

                // Add animation class to the newly added row
                row.classList.add('result-table-row-animated');
                
                resultTableBody.appendChild(row);
            }

            // Helper function to add a detailed calculation step
            function addDetailedCalculationStep(stepTitle, explanationText, formulaText, calculationText) {
                const stepDiv = document.createElement('div');
                stepDiv.classList.add('calculation-step');

                const titleElem = document.createElement('h4');
                titleElem.textContent = stepTitle; // Step title should not have LaTeX
                stepDiv.appendChild(titleElem);

                if (explanationText) {
                    const explanationElem = document.createElement('p');
                    explanationElem.innerHTML = explanationText;
                    stepDiv.appendChild(explanationElem);
                }

                if (formulaText) {
                    const formulaElem = document.createElement('p');
                    formulaElem.innerHTML = formulaText; // Formulas always use LaTeX
                    stepDiv.appendChild(formulaElem);
                }

                if (calculationText) {
                    const calcElem = document.createElement('p');
                    calcElem.innerHTML = calculationText; // Calculations always use LaTeX
                    stepDiv.appendChild(calcElem);
                }
                detailedCalculationsDiv.appendChild(stepDiv);
            }
        });
    </script>
</body>

</html>

