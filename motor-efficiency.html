<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEMA Motor Efficiency Calculator - Design Calculators - Electrical</title>
    <!-- Meta tags from user file -->
    <meta name="description" content="NEMA Motor Efficiency Calculator to determine operational efficiency, losses, and economic savings based on IEC/NEMA standards.">
    <meta name="keywords" content="motor efficiency calculator, nema efficiency, iec 60034, motor losses, electrical calculator, energy savings">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/motor-efficiency.html" />
    
    <!-- AdSense & Google Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- MathJax for formula rendering -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' },
            options: { processHtmlClass: 'math-content', ignoreHtmlClass: 'no-mathjax' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    <!-- New CSS Block -->
    <style>
        :root {
            --primary-color: #1E3A8A;
            --secondary-color: #2563EB;
            --accent-color: #F59E0B;
            --success-color: #10B981;
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-color: #4B5563;
            --heading-color: #111827;
            --footer-bg: #0F172A;
            --border-color: #E2E8F0;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --input-focus-shadow: 0 0 0 3px rgba(30, 58, 138, 0.25);
        }

        body.dark-mode {
            --primary-color: #10B981;
            --secondary-color: #34D399;
            --bg-color: #0F172A;
            --card-bg: #1E293B;
            --text-color: #CBD5E1;
            --heading-color: #F1F5F9;
            --footer-bg: #020617;
            --border-color: #334155;
            --hover-color: #1E293B;
            --input-focus-shadow: 0 0 0 3px rgba(16, 185, 129, 0.5);
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* HEADER */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 24px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            flex-direction: column;
            align-items: flex-start;
            text-decoration: none;
            color: white;
            gap: 0;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            line-height: 1.2;
            margin: 4px 0 0 0;
            font-weight: 300;
            max-width: 400px;
            color: #E0E7FF;
        }
        
        .nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent-color); }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .theme-toggle .icon {
            color: white;
            font-size: 1.2rem;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content */
        main { padding: 40px 0; }
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
        }
         .tool-container h3 {
            color: var(--heading-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1rem;
            line-height: 1.8;
        }
        .tool-description a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        .tool-description a:hover {
            text-decoration: underline;
        }

        /* Form Styles */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading-color);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            transition: all 0.3s;
            font-size: 1rem;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: var(--input-focus-shadow);
            outline: none;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        /* Button Styles */
        .calculate-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .calculate-btn:disabled {
            background: #9ca3af; /* Grey */
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .calculate-btn .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-left-color: #ffffff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Result Styles */
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .result-container.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .result-table th, .result-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 700;
        }
        .result-table tr:nth-child(even) {
            background-color: rgba(0,0,0,0.02);
        }
        .result-table td strong {
            color: var(--heading-color);
        }
        body.dark-mode .result-table td strong {
             color: var(--primary-color);
        }
        /* Animation for table rows */
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .result-table-body tr {
            opacity: 0; /* Start hidden for animation */
            transform: translateY(20px);
            animation: fadeInSlideUp 0.5s ease-out forwards;
        }
        /* Staggered delay for rows */
        .result-table-body tr:nth-child(1) { animation-delay: 0s; }
        .result-table-body tr:nth-child(2) { animation-delay: 0.05s; }
        .result-table-body tr:nth-child(3) { animation-delay: 0.1s; }
        .result-table-body tr:nth-child(4) { animation-delay: 0.15s; }
        .result-table-body tr:nth-child(5) { animation-delay: 0.2s; }
        .result-table-body tr:nth-child(6) { animation-delay: 0.25s; }
        .result-table-body tr:nth-child(7) { animation-delay: 0.3s; }
        .result-table-body tr:nth-child(8) { animation-delay: 0.35s; }
        .result-table-body tr:nth-child(9) { animation-delay: 0.4s; }
        
        /* Calculation Details & Standard Ref */
        #calculation-details { 
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.95rem;
        }
        #calculation-details h3 { 
            color: var(--primary-color);
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
            margin-top: 0; 
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            text-align: center;
            padding: 15px;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            line-height: 1.6;
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
            line-height: 1.7;
        }

        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            padding: 15px;
            background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.05));
            border-left: 4px solid var(--accent-color);
            border-radius: 6px;
            line-height: 1.7;
        }
         .standard-reference a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        .standard-reference a:hover {
            text-decoration: underline;
        }

        /* Tooltip */
        .info-icon {
            color: var(--primary-color);
            margin-left: 6px;
            cursor: help;
            font-size: 0.9rem;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 130%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.5;
            white-space: normal;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Custom Message Box */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #custom-message-box.show { opacity: 1; }

        /* New Content Block Styles */
        .content-block { 
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            margin-top: 30px;
            display: none; 
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .content-block.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .content-block h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
        }
        .content-block h3 {
            color: var(--heading-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            margin-top: 25px;
            margin-bottom: 15px;
        }
         .content-block h4 {
            color: var(--secondary-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2rem;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .content-block p, .content-block li {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-color);
        }
        .content-block ul, .content-block ol {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 5px;
            margin-bottom: 15px;
        }
        .content-block ol {
            list-style-type: decimal;
        }
        .content-block li {
            margin-bottom: 10px;
        }
        .content-block strong {
            color: var(--heading-color);
        }
        body.dark-mode .content-block strong {
            color: var(--primary-color);
        }
        .content-block code {
            background-color: var(--hover-color);
            padding: 2px 5px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--primary-color);
        }
        body.dark-mode .content-block code {
            color: var(--secondary-color);
        }
        .content-block .formula-block {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            text-align: center;
            padding: 15px;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 20px 0;
            overflow-x: auto;
            border: 1px dashed var(--primary-color);
        }
        .content-block table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .content-block th, .content-block td {
            padding: 14px;
            text-align: left;
            border: 1px solid var(--border-color);
        }
        .content-block th {
            background-color: var(--hover-color);
            font-weight: 600;
        }
        
        /* FOOTER */
        footer {
            background: var(--gradient-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            font-size: 1.1rem;
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col ul li { margin-bottom: 10px; }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
            font-size: 0.95rem;
        }
        .footer-col a:hover { color: var(--accent-color); }
        .footer-disclaimer {
            text-align: center;
            margin: 30px auto;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        .creator-name {
            color: var(--secondary-color);
            font-weight: bold;
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            text-decoration: none;
            font-size: 1.1rem;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .tool-container, .content-block { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .theme-toggle {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 15px;
            }
            .content-block table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            .logo-container {
                 align-items: center; 
            }
            .logo-subtitle {
                text-align: center; 
            }
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    
    <!-- NEW HEADER -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <!-- Updated Subtitle -->
                    <p class="logo-subtitle">
                        Inspired by standards such as IEC, IEEE, ISA, ASME, and API.
                    </p>
                </a>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href='/articles'>Articles</a></li>
                    <li><a href='/indexmech'>Mechanical</a></li>
                    <li><a href='/indexele'>Electrical</a></li>
                    <li><a href='/indexinst'>Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun icon"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon icon"></i>
                </div>
            </nav>
        </div>
    </header>

    <!-- MAIN CONTENT - Refactored -->
    <main class="container">
        <!-- Back button removed -->
        <div class="tool-container">
            <h2>NEMA Motor Efficiency Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator determines the operational efficiency of an electric motor based on its output power and measured electrical input parameters, in line with NEMA standards. It also provides an estimated breakdown of losses, economic analysis for efficiency improvements, and general recommendations. Ensure input values are accurate for precise results.</p>
            </div>
            
            <div class="calculator-form">
                <form id="motor-efficiency-form">
                    <h3>Input Parameters</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rated-output-power">Rated Output Power (kW) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The nominal mechanical output power of the motor as specified by the manufacturer (e.g., from the nameplate).</span></span></label>
                            <input type="number" id="rated-output-power" min="0.01" step="0.01" value="10" required>
                        </div>
                        <div class="form-group">
                            <label for="input-voltage">Input Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The line-to-line voltage supplied to the motor during operation.</span></span></label>
                            <input type="number" id="input-voltage" min="1" step="1" value="415" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="input-current">Input Current (A) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The measured input current drawn by the motor during operation.</span></span></label>
                            <input type="number" id="input-current" min="0.01" step="0.01" value="18" required>
                        </div>
                        <div class="form-group">
                            <label for="power-factor">Power Factor <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The cosine of the angle between voltage and current. For motors, typical values are between 0.7 and 0.95.</span></span></label>
                            <input type="number" id="power-factor" min="0.1" max="1" step="0.01" value="0.85" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phase-type-motor">System Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select whether the motor is single-phase or three-phase.</span></span></label>
                            <select id="phase-type-motor" required>
                                <option value="single">Single-Phase</option>
                                <option value="three" selected>Three-Phase</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="load-factor">Load Factor (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The percentage of the motor's rated power at which it is currently operating (e.g., 75 for 75% load).</span></span></label>
                            <input type="number" id="load-factor" min="0" max="100" step="1" value="100" required>
                        </div>
                    </div>

                    <h3>Economic Analysis Parameters (Optional)</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="operatingHoursPerYear">Operating Hours per Year (hours) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Estimated annual operating hours of the motor.</span></span></label>
                            <input type="number" id="operatingHoursPerYear" min="0" step="1" value="2000">
                        </div>
                        <div class="form-group">
                            <label for="electricityCostPerKWh">Electricity Cost (per kWh) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Your average electricity cost per kilowatt-hour.</span></span></label>
                            <input type="number" id="electricityCostPerKWh" min="0" step="0.001" value="0.12">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="currencySymbol">Currency <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the currency symbol for economic analysis.</span></span></label>
                            <select id="currencySymbol">
                                <option value="$">USD ($)</option>
                                <option value="€">Euro (€)</option>
                                <option value="£">British Pound (£)</option>
                                <option value="¥">Japanese Yen (¥)</option>
                                <option value="₹" selected>Indian Rupee (₹)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newMotorEfficiency">Proposed New Motor Efficiency (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The estimated efficiency of a new, higher-efficiency motor you might consider.</span></span></label>
                            <input type="number" id="newMotorEfficiency" min="0" max="100" step="0.01" value="90">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <!-- Label updated to include a span for the currency symbol -->
                            <label for="newMotorPurchaseCost">New Motor Purchase Cost <span class="currency-label-prefix">(₹)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The estimated purchase cost of the new, higher-efficiency motor. Leave blank if not considering replacement.</span></span></label>
                            <input type="number" id="newMotorPurchaseCost" min="0" step="any">
                        </div>
                        <div class="form-group">
                            <label for="analysisPeriodYears">Analysis Period (Years) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The number of years over which to calculate cumulative savings.</span></span></label>
                            <input type="number" id="analysisPeriodYears" min="1" step="1" value="5">
                        </div>
                    </div>

                    <!-- NEW Button Group -->
                    <div class="form-row" style="gap: 10px; margin-top: 25px;">
                        <button type="button" id="calculate-efficiency-btn" class="calculate-btn" style="flex: 2;">
                            <i class="fas fa-calculator" style="margin-right: 8px;"></i>Calculate Efficiency & Savings
                            <span class="spinner" id="calculate-spinner" style="display:none;"></span>
                        </button>
                        <button type="button" id="reset-calculations-btn" class="calculate-btn" style="flex: 1; background: var(--accent-color); box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                            <i class="fas fa-sync-alt" style="margin-right: 8px;"></i>Reset
                        </button>
                        <button type="button" id="download-pdf-btn" class="calculate-btn" style="flex: 1; background: var(--secondary-color); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);">
                            <i class="fas fa-file-pdf" style="margin-right: 8px;"></i>Download PDF
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Result Container -->
            <div id="result-container" class="result-container">
                <h3>Calculation Summary</h3>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body" class="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <!-- Detailed calculations section -->
                <div id="calculation-details" class="math-content">
                    <!-- ID changed from detailed-calculations -->
                    <h3>Detailed Calculation Steps</h3>
                    <!-- Detailed calculation steps will be dynamically inserted here -->
                </div>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>

            <!-- All content blocks below are refactored with new class -->
            <div id="loss-breakdown-section" class="content-block">
                <h3>Estimated Motor Loss Breakdown</h3>
                <p class="mb-4">Motor losses are categorized into several types. The following is an estimated breakdown of the calculated total losses for your motor, based on typical industry distributions. Exact values require detailed motor design data and specific test procedures (e.g., IEEE 112, IEC 60034-2-1).</p>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Loss Type</th>
                            <th>Value (kW)</th>
                            <th>Percentage of Total Losses</th>
                        </tr>
                    </thead>
                    <tbody id="loss-breakdown-table-body" class="result-table-body">
                        <!-- Loss breakdown will be inserted here -->
                    </tbody>
                </table>
            </div>

            <div id="efficiency-class-section" class="content-block">
                <h3>Estimated Efficiency Class</h3>
                <p class="mb-4" id="efficiency-class-text"></p>
                <p style="font-size: 0.9rem; font-style: italic;">Note: This is an estimation based on common efficiency ranges for NEMA and IEC standards. Actual classification requires certified test data and adherence to specific test procedures (e.g., IEEE 112 for North America, IEC 60034-2-1 for international markets).</p>
            </div>

            <div id="economic-analysis-section" class="content-block">
                <h3>Economic Analysis of Efficiency Improvement</h3>
                <div id="economic-analysis-results" class="math-content">
                    <!-- Economic analysis results will be inserted here -->
                </div>
            </div>

            <div id="factors-affecting-efficiency-section" class="content-block">
                <h3>Key Factors Affecting Motor Efficiency</h3>
                <p class="mb-4">Beyond the design of the motor itself, several operational and environmental factors can significantly impact its real-world efficiency:</p>
                <ul>
                    <li>
                        <strong>Load Factor:</strong> Motors are most efficient when operating near their full rated load (typically 75-100%). Under-loaded motors (e.g., below 50% load) experience a significant drop in efficiency, as fixed losses (like core losses and friction/windage) become a larger percentage of the total power.
                    </li>
                    <li>
                        <strong>Voltage Imbalance:</strong> Unequal voltages across the phases of a three-phase motor can lead to increased losses, overheating, and reduced efficiency. Even a small imbalance (e.g., 1%) can cause a disproportionately larger increase in losses.
                    </li>
                    <li>
                        <strong>Harmonic Distortion:</strong> Non-sinusoidal waveforms (harmonics) in the power supply, often introduced by variable frequency drives (VFDs) or other non-linear loads, can cause additional losses in the motor windings and core, leading to reduced efficiency and premature aging.
                    </li>
                    <li>
                        <strong>Voltage Level:</strong> Operating a motor significantly above or below its rated voltage can reduce efficiency and increase losses.
                    </li>
                    <li>
                        <strong>Ambient Temperature & Ventilation:</strong> High ambient temperatures or inadequate ventilation can lead to increased motor winding temperatures, which in turn increase copper losses and reduce efficiency.
                    </li>
                    <li>
                        <strong>Bearing & Lubrication Condition:</strong> Poorly maintained or worn bearings and inadequate lubrication increase mechanical friction losses, directly impacting motor efficiency.
                    </li>
                    <li>
                        <strong>Alignment:</strong> Misalignment between the motor and the driven equipment can cause excessive vibration, increased bearing wear, and higher mechanical losses.
                    </li>
                    <li>
                        <strong>Maintenance Practices:</strong> Regular preventive maintenance, including cleaning, lubrication, and inspection of electrical connections, is crucial for maintaining optimal motor efficiency over its lifespan.
                    </li>
                </ul>
                <p style="margin-top: 15px; font-size: 0.9rem; font-style: italic;">Understanding and addressing these factors is key to maximizing energy savings and extending motor life in industrial applications.</p>
            </div>

            <div id="general-recommendations-section" class="content-block">
                <h3>General Recommendations for Motor System Optimization</h3>
                <p class="mb-4">To achieve the most economic and reliable solution for motor system optimization, consider the following:</p>
                <ul>
                    <li>
                        <strong>Upgrade to High-Efficiency Motors (IE3/IE4):</strong> For motors that operate frequently or at high loads, replacing older, less efficient motors with modern high-efficiency (IE3) or super premium efficiency (IE4) motors can lead to significant energy savings and reduced operating costs. This is often the **most economic and reliable long-term solution** for continuous duty applications.
                    </li>
                    <li>
                        <strong>Utilize Variable Frequency Drives (VFDs):</strong> For applications with variable loads (e.g., pumps, fans, compressors), installing a VFD can precisely match motor speed to load demand, drastically reducing energy consumption compared to fixed-speed operation with throttling or dampening. This offers excellent control and energy savings.
                    </li>
                    <li>
                        <strong>Proper Motor Sizing:</strong> Ensure motors are correctly sized for their application. Oversized motors operate at lower load factors, which reduces their efficiency. Undersized motors can overheat and fail prematurely.
                    </li>
                    <li>
                        <strong>Implement Power Factor Correction:</strong> While not directly improving motor efficiency, maintaining a good power factor (typically > 0.95 lagging) reduces reactive power demand, lowers utility bills (especially if penalized for low PF), and frees up electrical capacity.
                    </li>
                    <li>
                        <strong>Regular Maintenance:</strong> Implement a robust preventive maintenance program including lubrication, cleaning, and vibration analysis to ensure motors run smoothly and efficiently, extending their lifespan.
                    </li>
                    <li>
                        <strong>System Integration:</strong> Consider the entire system (motor, driven equipment, controls) for optimization. Improvements in one area can positively impact others.
                    </li>
                    <li>
                        <strong>Conduct Energy Audits:</strong> Periodically perform comprehensive energy audits to identify areas for improvement and quantify potential savings.
                    </li>
                </ul>
                <p style="margin-top: 15px; font-size: 0.9rem; font-style: italic;">Always consult with a qualified electrical engineer or energy auditor for a detailed assessment and tailored recommendations for your specific application.</p>
            </div>
        </div>
    </main>

    <!-- NEW FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <!-- Updated Text -->
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">
                        If you find this tool helpful, please consider sharing it with your colleagues!
                    </p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href='/indexele'>Electrical</a></li>
                        <li><a href='/indexmech'>Mechanical</a></li>
                        <li><a href='/indexinst'>Instrumentation</a></li>
                        <li><a href='/articles'>Articles</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href='/about'>About Us</a></li>
                        <li><a href='/contact'>Contact</a></li>
                        <li><a href='/faq'>FAQ</a></li>
                        <li><a href='/privacy-policy'>Privacy Policy</a></li>
                        <li><a href='/terms-of-service'>Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <!-- Updated Link -->
                        <li><a href="/articles.html">Articles</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li>
                        <li><a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer">YouTube Channel</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary design guidance. Always verify results against relevant engineering standards (ISO, ASME, IEC, NEC) and manufacturer specifications. Final designs require professional engineering verification considering site-specific conditions.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box -->
    <div id="custom-message-box"></div>

    <!-- UPDATED SCRIPT with FIXES -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get buttons
            const calculateBtn = document.getElementById('calculate-efficiency-btn');
            const resetFormBtn = document.getElementById('reset-calculations-btn');
            const downloadPdfBtn = document.getElementById('download-pdf-btn');
            const calculationSpinner = document.getElementById('calculate-spinner');
            
            // Get containers
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const detailedCalculationsDiv = document.getElementById('calculation-details'); // ID changed
            const lossBreakdownSection = document.getElementById('loss-breakdown-section');
            const lossBreakdownTableBody = document.getElementById('loss-breakdown-table-body');
            const efficiencyClassSection = document.getElementById('efficiency-class-section');
            const efficiencyClassText = document.getElementById('efficiency-class-text');
            const economicAnalysisSection = document.getElementById('economic-analysis-section');
            const economicAnalysisResultsDiv = document.getElementById('economic-analysis-results');
            const generalRecommendationsSection = document.getElementById('general-recommendations-section');
            const factorsAffectingEfficiencySection = document.getElementById('factors-affecting-efficiency-section');
            const standardReference = document.getElementById('standard-reference');

            // Default values for resetting
            const defaultValues = {
                'rated-output-power': 10,
                'input-voltage': 415,
                'input-current': 18,
                'power-factor': 0.85,
                'phase-type-motor': 'three',
                'load-factor': 100,
                'operatingHoursPerYear': 2000,
                'electricityCostPerKWh': 0.12,
                'currencySymbol': '₹',
                'newMotorEfficiency': 90,
                'newMotorPurchaseCost': '',
                'analysisPeriodYears': 5
            };
            
            // --- Custom Message Box Functionality ---
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                
                messageBox.textContent = message;
                messageBox.style.color = 'white'; // Default
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; // Red
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; // Yellow
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745'; // Green
                }
                messageBox.classList.add('show');

                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 5000);
            }

            // --- Update currency label prefix dynamically ---
            const currencySymbolSelect = document.getElementById('currencySymbol');
            const newMotorPurchaseCostLabel = document.querySelector('label[for="newMotorPurchaseCost"] .currency-label-prefix');

            function updateCurrencyLabel() {
                if (newMotorPurchaseCostLabel) {
                    newMotorPurchaseCostLabel.textContent = `(${currencySymbolSelect.value})`;
                }
            }
            currencySymbolSelect.addEventListener('change', updateCurrencyLabel);
            
            // --- Reset & Clear Functions ---
            function clearResults() {
                resultContainer.classList.remove('show');
                lossBreakdownSection.classList.remove('show');
                efficiencyClassSection.classList.remove('show');
                economicAnalysisSection.classList.remove('show');
                generalRecommendationsSection.classList.remove('show');
                factorsAffectingEfficiencySection.classList.remove('show');
                
                // *** FIX: REMOVED setTimeout from here ***
                // This was causing the race condition.
                // The clearing of content should happen immediately *before* new calculation.
                // Or, in the case of reset, immediately.
                resultTableBody.innerHTML = '';
                detailedCalculationsDiv.innerHTML = '<h3>Detailed Calculation Steps</h3>';
                lossBreakdownTableBody.innerHTML = '';
                efficiencyClassText.innerHTML = '';
                economicAnalysisResultsDiv.innerHTML = '';
                standardReference.innerHTML = ''; // Also clear reference text
            }

            function resetForm() {
                for (const id in defaultValues) {
                    const input = document.getElementById(id);
                    if (input) input.value = defaultValues[id];
                }
                updateCurrencyLabel(); // Reset currency label
                clearResults(); // Clear results immediately
                displayMessage("Form reset to default values.", "info");
            }
            
            // --- PDF Download Function ---
            function downloadPDF() {
                if (!resultContainer.classList.contains('show')) {
                    displayMessage("Please run a calculation first to generate a report.", "error");
                    return;
                }
                displayMessage("Generating PDF... Please wait.", "info");

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                let currentY = 15; // Top margin

                // Title
                pdf.setFont("helvetica", "bold");
                pdf.setFontSize(18);
                pdf.setTextColor(30, 58, 138); // var(--primary-color)
                pdf.text("Motor Efficiency Calculation Report", pdfWidth / 2, currentY, { align: 'center' });
                currentY += 7;
                pdf.setFont("helvetica", "normal");
                pdf.setFontSize(10);
                pdf.setTextColor(100, 100, 100);
                pdf.text(`Generated on: ${new Date().toLocaleString()}`, pdfWidth / 2, currentY, { align: 'center' });
                currentY += 15;

                // Function to add a section with error handling for html2canvas
                async function addSectionToPdf(elementId, title) {
                    const element = document.getElementById(elementId);
                    // Check if element exists and is shown
                    if (!element || (!element.classList.contains('show') && (element.id !== 'result-container' && !element.classList.contains('tool-container')) )) {
                        return; // Skip if hidden
                    }
                    
                    if (element.id !== 'result-container') { // Don't print title for main container
                         pdf.setFont("helvetica", "bold");
                         pdf.setFontSize(16);
                         pdf.setTextColor(30, 58, 138);
                         if (currentY + 10 > pdfHeight - 20) { // Check for page break
                            pdf.addPage();
                            currentY = 15;
                         }
                         pdf.text(title, 10, currentY);
                         currentY += 10;
                    }
                    
                    try {
                        const canvas = await html2canvas(element, {
                            scale: 2,
                            useCORS: true,
                            onclone: (doc) => {
                                // Force light mode styles for PDF
                                doc.body.classList.remove('dark-mode');
                                doc.querySelectorAll('*').forEach(el => {
                                    el.style.color = '#4B5563'; // var(--text-color)
                                });
                                doc.querySelectorAll('.tool-container, .result-container, .content-block, .calculator-form').forEach(el => {
                                    el.style.background = '#FFFFFF'; // var(--card-bg)
                                    el.style.color = '#4B5563';
                                });
                                doc.querySelectorAll('h2, h3').forEach(el => {
                                    el.style.color = '#1E3A8A'; // var(--primary-color)
                                });
                                doc.querySelectorAll('h4').forEach(el => {
                                    el.style.color = '#2563EB'; // var(--secondary-color)
                                });
                                doc.querySelectorAll('strong').forEach(el => {
                                    el.style.color = '#111827'; // var(--heading-color)
                                });
                                
                                // Specific table styling
                                doc.querySelectorAll('.result-table th').forEach(el => {
                                    el.style.background = '#1E3A8A'; 
                                    el.style.color = '#FFFFFF';
                                });
                                doc.querySelectorAll('.result-table tr:nth-child(even)').forEach(el => {
                                    el.style.backgroundColor = '#F8FAFC';
                                });
                                
                                // Specific calc details styling
                                if(doc.querySelector('#calculation-details')) {
                                    doc.querySelector('#calculation-details').style.background = '#F8FAFC';
                                    doc.querySelectorAll('#calculation-details .formula, #calculation-details .calculation-step').forEach(el => {
                                        el.style.backgroundColor = '#e2e6ea';
                                    });
                                }
                                // Hide buttons in PDF
                                doc.querySelectorAll('button').forEach(btn => btn.style.display = 'none');
                            }
                        });
                        
                        const imgData = canvas.toDataURL('image/png');
                        const imgWidth = pdfWidth - 20;
                        const imgHeight = canvas.height * imgWidth / canvas.width;

                        if (currentY + imgHeight > pdfHeight - 20) {
                            pdf.addPage();
                            currentY = 15;
                        }
                        
                        pdf.addImage(imgData, 'PNG', 10, currentY, imgWidth, imgHeight);
                        currentY += imgHeight + 10;
                        
                    } catch (err) {
                        console.error(`Error rendering ${elementId} to canvas:`, err);
                        pdf.setFont("helvetica", "normal");
                        pdf.setFontSize(10);
                        pdf.setTextColor(255, 0, 0);
                        pdf.text(`Error rendering section: ${title}.`, 10, currentY);
                        currentY += 10;
                    }
                }

                // Chain the PDF generation
                (async () => {
                    await addSectionToPdf('result-container', 'Calculation Summary');
                    await addSectionToPdf('loss-breakdown-section', 'Estimated Motor Loss Breakdown');
                    await addSectionToPdf('efficiency-class-section', 'Estimated Efficiency Class');
                    await addSectionToPdf('economic-analysis-section', 'Economic Analysis');
                    
                    // Add footer to all pages
                    const pageCount = pdf.internal.getNumberOfPages();
                    for(let i = 1; i <= pageCount; i++) {
                        pdf.setPage(i);
                        pdf.setFontSize(8);
                        pdf.setTextColor(150, 150, 150);
                        pdf.text(`Page ${i} of ${pageCount} | www.designcalculators.co.in`, pdfWidth / 2, pdfHeight - 10, { align: 'center' });
                    }
                    
                    pdf.save('Motor-Efficiency-Report.pdf');
                })();
            }

            // --- Calculation Logic ---
            const mainCalculationFunction = function() {
                calculationSpinner.style.display = 'inline-block';
                calculateBtn.disabled = true;

                setTimeout(() => {
                    try {
                        // Get input values
                        const ratedOutputPower = parseFloat(document.getElementById('rated-output-power').value);
                        const inputVoltage = parseFloat(document.getElementById('input-voltage').value);
                        const inputCurrent = parseFloat(document.getElementById('input-current').value);
                        const powerFactor = parseFloat(document.getElementById('power-factor').value);
                        const phaseType = document.getElementById('phase-type-motor').value;
                        const loadFactor = parseFloat(document.getElementById('load-factor').value);

                        const operatingHoursPerYear = parseFloat(document.getElementById('operatingHoursPerYear').value);
                        const electricityCostPerKWh = parseFloat(document.getElementById('electricityCostPerKWh').value);
                        const currencySymbol = document.getElementById('currencySymbol').value;
                        const newMotorEfficiency = parseFloat(document.getElementById('newMotorEfficiency').value);
                        const newMotorPurchaseCost = parseFloat(document.getElementById('newMotorPurchaseCost').value);
                        const analysisPeriodYears = parseFloat(document.getElementById('analysisPeriodYears').value);

                        // Input validation
                        if (isNaN(ratedOutputPower) || isNaN(inputVoltage) || isNaN(inputCurrent) || isNaN(powerFactor) || isNaN(loadFactor)) {
                            throw new Error("Please fill in all required fields with valid numbers.");
                        }
                        if (ratedOutputPower <= 0 || inputVoltage <= 0 || inputCurrent <= 0 || powerFactor <= 0 || powerFactor > 1 || loadFactor < 0 || loadFactor > 100) {
                            throw new Error("Please enter positive values for power, voltage, and current. Power factor should be between 0.1 and 1, and Load Factor between 0 and 100.");
                        }

                        // *** FIX: Clear previous results *immediately* ***
                        clearResults(); 
                        
                        let inputPowerVA = 0;

                        // Step 1: Calculate Input Apparent Power (S)
                        if (phaseType === 'single') {
                            inputPowerVA = inputVoltage * inputCurrent;
                            addDetailedCalculationStep(
                                "Step 1: Calculate Input Apparent Power (Single-Phase)",
                                `Apparent power ($S$) is the product of voltage and current.`,
                                `$$S = V \\times I$$`,
                                `Calculation: $S = ${inputVoltage.toFixed(2)} \\text{ V} \\times ${inputCurrent.toFixed(2)} \\text{ A} = ${inputPowerVA.toFixed(2)} \\text{ VA}$`
                            );
                        } else { // Three-phase
                            inputPowerVA = Math.sqrt(3) * inputVoltage * inputCurrent;
                            addDetailedCalculationStep(
                                "Step 1: Calculate Input Apparent Power (Three-Phase)",
                                `Apparent power ($S$) for three-phase is $\\sqrt{3} \\times V_L \\times I_L$.`,
                                `$$S = \\sqrt{3} \\times V_{\\text{line}} \\times I_{\\text{line}}$$`,
                                `Calculation: $S = \\sqrt{3} \\times ${inputVoltage.toFixed(2)} \\text{ V} \\times ${inputCurrent.toFixed(2)} \\text{ A} = ${inputPowerVA.toFixed(2)} \\text{ VA}$`
                            );
                        }

                        // Step 2: Calculate Input Real Power (P_in) in kW
                        const inputPowerKW = (inputPowerVA * powerFactor) / 1000;
                        addDetailedCalculationStep(
                            "Step 2: Calculate Input Real Power ($P_{\\text{in}}$)",
                            `Input real power ($P_{\\text{in}}$) is the apparent power multiplied by the power factor.`,
                            `$$P_{\\text{in}} = \\frac{S \\times PF}{1000}$$`,
                            `Calculation: $P_{\\text{in}} = \\frac{${inputPowerVA.toFixed(2)} \\text{ VA} \\times ${powerFactor.toFixed(2)}}{1000} = ${inputPowerKW.toFixed(2)} \\text{ kW}$`
                        );

                        // Step 3: Calculate Actual Mechanical Output Power (P_out,actual)
                        const actualOutputPowerKW = ratedOutputPower * (loadFactor / 100);
                        addDetailedCalculationStep(
                            "Step 3: Calculate Actual Mechanical Output Power ($P_{\\text{out,actual}}$)",
                            `The actual mechanical output power is the motor's rated power adjusted by its current load factor.`,
                            `$$P_{\\text{out,actual}} = \\text{Rated Output Power} \\times \\frac{\\text{Load Factor}}{100}$$`,
                            `Calculation: $P_{\\text{out,actual}} = ${ratedOutputPower.toFixed(2)} \\text{ kW} \\times \\frac{${loadFactor.toFixed(0)}}{100} = ${actualOutputPowerKW.toFixed(2)} \\text{ kW}$`
                        );

                        // Step 4: Calculate Efficiency (eta) and Total Losses (P_losses)
                        let efficiency = 0;
                        let totalLossesKW = 0;
                        if (inputPowerKW > 0) {
                            efficiency = (actualOutputPowerKW / inputPowerKW) * 100;
                            totalLossesKW = inputPowerKW - actualOutputPowerKW;
                            addDetailedCalculationStep(
                                "Step 4: Calculate Motor Efficiency ($\\eta$)",
                                `Efficiency ($\eta$) is the ratio of actual output power to input real power.`,
                                `$$\\eta = \\left( \\frac{P_{\\text{out,actual}}}{P_{\\text{in}}} \\right) \\times 100\\%$$`,
                                `Calculation: $\\eta = \\left( \\frac{${actualOutputPowerKW.toFixed(2)} \\text{ kW}}{${inputPowerKW.toFixed(2)} \\text{ kW}} \\right) \\times 100\\% = ${efficiency.toFixed(2)}\\%$`
                            );
                            addDetailedCalculationStep(
                                "Step 5: Calculate Total Losses ($P_{\\text{losses}}$)",
                                `Total losses are the difference between input power and output power.`,
                                `$$P_{\\text{losses}} = P_{\\text{in}} - P_{\\text{out,actual}}$$`,
                                `Calculation: $P_{\\text{losses}} = ${inputPowerKW.toFixed(2)} \\text{ kW} - ${actualOutputPowerKW.toFixed(2)} \\text{ kW} = ${totalLossesKW.toFixed(2)} \\text{ kW}$`
                            );
                        } else {
                            throw new Error("Input power is zero, cannot calculate efficiency. Check inputs.");
                        }
                        
                        // Update Standard Reference
                        standardReference.innerHTML = `Motor efficiency calculations and testing standards are typically defined by: 
                            <strong>NEMA MG 1</strong> (Motors and Generators), 
                            <strong>IEC 60034</strong> (Rotating electrical machines), and 
                            <strong>IEEE 112</strong> (Test Procedures for Polyphase Induction Motors).`;

                        // Display Summary Results
                        addResultRow("Rated Output Power", ratedOutputPower.toFixed(2) + " kW");
                        addResultRow("Actual Output Power", actualOutputPowerKW.toFixed(2) + " kW (at " + loadFactor + "% load)");
                        addResultRow("Input Voltage", inputVoltage.toFixed(2) + " V");
                        addResultRow("Input Current", inputCurrent.toFixed(2) + " A");
                        addResultRow("Power Factor", powerFactor.toFixed(2));
                        addResultRow("Calculated Input Power", `<strong>${inputPowerKW.toFixed(2)} kW</strong>`);
                        addResultRow("Motor Efficiency", `<strong>${efficiency.toFixed(2)} %</strong>`);
                        addResultRow("Total Losses", `<strong>${totalLossesKW.toFixed(2)} kW</strong>`);
                        addResultRow("System Type", phaseType === "single" ? "Single-Phase" : "Three-Phase");

                        // --- Estimated Loss Breakdown (Simplified) ---
                        const lossDistribution = {
                            statorI2R: 0.35, rotorI2R: 0.25, coreLoss: 0.20,
                            frictionWindage: 0.10, strayLoad: 0.10
                        };
                        const statorI2RLoss = totalLossesKW * lossDistribution.statorI2R;
                        const rotorI2RLoss = totalLossesKW * lossDistribution.rotorI2R;
                        const coreLoss = totalLossesKW * lossDistribution.coreLoss;
                        const frictionWindageLoss = totalLossesKW * lossDistribution.frictionWindage;
                        const strayLoadLoss = totalLossesKW * lossDistribution.strayLoad;

                        lossBreakdownTableBody.innerHTML = ''; // Clear previous
                        addLossRow(lossBreakdownTableBody, "Stator I²R Losses", statorI2RLoss, lossDistribution.statorI2R * 100);
                        addLossRow(lossBreakdownTableBody, "Rotor I²R Losses", rotorI2RLoss, lossDistribution.rotorI2R * 100);
                        addLossRow(lossBreakdownTableBody, "Core Losses", coreLoss, lossDistribution.coreLoss * 100);
                        addLossRow(lossBreakdownTableBody, "Friction & Windage", frictionWindageLoss, lossDistribution.frictionWindage * 100);
                        addLossRow(lossBreakdownTableBody, "Stray Load Losses", strayLoadLoss, lossDistribution.strayLoad * 100);

                        // --- Efficiency Class Determination ---
                        const efficiencyClass = getEfficiencyClass(ratedOutputPower, efficiency);
                        efficiencyClassText.innerHTML = `Based on the calculated efficiency of <strong>${efficiency.toFixed(2)}%</strong> and rated output power of <strong>${ratedOutputPower.toFixed(2)} kW</strong>, your motor's estimated efficiency class is: <strong>${efficiencyClass}</strong>.`;

                        // --- Economic Analysis ---
                        if (operatingHoursPerYear > 0 && electricityCostPerKWh > 0 && newMotorEfficiency > 0) {
                            const currentAnnualEnergyConsumption = inputPowerKW * operatingHoursPerYear;
                            const currentAnnualEnergyCost = currentAnnualEnergyConsumption * electricityCostPerKWh;
                            
                            let newMotorInputPowerKW = 0;
                            if (newMotorEfficiency > 0) {
                                newMotorInputPowerKW = actualOutputPowerKW / (newMotorEfficiency / 100);
                            } else {
                                newMotorInputPowerKW = inputPowerKW;
                            }
                            
                            const newAnnualEnergyConsumption = newMotorInputPowerKW * operatingHoursPerYear;
                            const newAnnualEnergyCost = newAnnualEnergyConsumption * electricityCostPerKWh;
                            const annualCostSavings = currentAnnualEnergyCost - newAnnualEnergyCost;
                            const cumulativeSavings = annualCostSavings * analysisPeriodYears;
                            const carbonEmissionFactor = 0.5; // kg CO2 per kWh, approx
                            const annualCarbonReduction = (currentAnnualEnergyConsumption - newAnnualEnergyConsumption) * carbonEmissionFactor;

                            economicAnalysisResultsDiv.innerHTML = `
                                <p>Current Annual Energy Consumption: <strong>${currentAnnualEnergyConsumption.toFixed(2)} kWh</strong></p>
                                <p>Current Annual Energy Cost: <strong>${currencySymbol}${currentAnnualEnergyCost.toFixed(2)}</strong></p>
                                <hr style="border-color: var(--border-color); margin: 10px 0;">
                                <p>Proposed New Motor Input Power: <strong>${newMotorInputPowerKW.toFixed(2)} kW</strong></p>
                                <p>New Annual Energy Consumption (@ ${newMotorEfficiency.toFixed(2)}%): <strong>${newAnnualEnergyConsumption.toFixed(2)} kWh</strong></p>
                                <p>New Annual Energy Cost: <strong>${currencySymbol}${newAnnualEnergyCost.toFixed(2)}</strong></p>
                                <hr style="border-color: var(--border-color); margin: 10px 0;">
                                <p style="color: var(--success-color);"><strong>Estimated Annual Cost Savings: ${currencySymbol}${annualCostSavings.toFixed(2)}</strong></p>
                                <p style="color: var(--success-color);"><strong>Cumulative Savings over ${analysisPeriodYears} years: ${currencySymbol}${cumulativeSavings.toFixed(2)}</strong></p>
                                <p style="color: var(--secondary-color);"><strong>Est. Annual Carbon Reduction: ${annualCarbonReduction.toFixed(2)} kg CO₂</strong></p>
                            `;

                            if (!isNaN(newMotorPurchaseCost) && newMotorPurchaseCost > 0 && annualCostSavings > 0) {
                                const paybackPeriodYears = newMotorPurchaseCost / annualCostSavings;
                                economicAnalysisResultsDiv.innerHTML += `<hr style="border-color: var(--border-color); margin: 10px 0;"><p><strong>Estimated Payback Period for New Motor: ${paybackPeriodYears.toFixed(1)} years</strong></p>`;
                            }
                        } else {
                            economicAnalysisResultsDiv.innerHTML = `<p>Please provide Operating Hours, Electricity Cost, and New Motor Efficiency for economic analysis.</p>`;
                        }

                        // Show result sections with animation
                        resultContainer.classList.add('show');
                        lossBreakdownSection.classList.add('show');
                        efficiencyClassSection.classList.add('show');
                        economicAnalysisSection.classList.add('show');
                        generalRecommendationsSection.classList.add('show');
                        factorsAffectingEfficiencySection.classList.add('show');
                        
                        resultContainer.scrollIntoView({ behavior: 'smooth' });

                        // Tell MathJax to re-render
                        if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                            setTimeout(() => {
                                window.MathJax.typesetPromise([detailedCalculationsDiv, economicAnalysisResultsDiv])
                                    .catch((err) => console.error('MathJax typesetting failed:', err));
                            }, 50); // Small delay to ensure content is in DOM
                        }

                    } catch (error) {
                        displayMessage(error.message, "error");
                    } finally {
                        calculationSpinner.style.display = 'none';
                        calculateBtn.disabled = false;
                    }
                }, 500); // 500ms delay for spinner
            };
            
            // Add the event listener to the button
            calculateBtn.addEventListener('click', mainCalculationFunction);

            // Helper function to add a row to the summary result table
            function addResultRow(parameter, value) {
                const row = document.createElement('tr');
                const paramCell = document.createElement('td');
                paramCell.innerHTML = parameter;
                const valueCell = document.createElement('td');
                valueCell.innerHTML = value;
                row.appendChild(paramCell);
                row.appendChild(valueCell);
                resultTableBody.appendChild(row);
            }

            // Helper function to add a detailed calculation step
            function addDetailedCalculationStep(stepTitle, explanationText, formulaText, calculationText) {
                const stepDiv = document.createElement('div');
                stepDiv.style.marginBottom = '15px';
                stepDiv.style.paddingBottom = '15px';
                stepDiv.style.borderBottom = `1px dashed var(--border-color)`;
                
                const titleElem = document.createElement('h4');
                titleElem.innerHTML = stepTitle;
                stepDiv.appendChild(titleElem);
                
                if (explanationText) {
                    const explanationElem = document.createElement('p');
                    explanationElem.innerHTML = explanationText;
                    stepDiv.appendChild(explanationElem);
                }
                if (formulaText) {
                    const formulaElem = document.createElement('p');
                    formulaElem.classList.add('formula'); // Class from new CSS
                    formulaElem.innerHTML = formulaText;
                    stepDiv.appendChild(formulaElem);
                }
                if (calculationText) {
                    const calcElem = document.createElement('p');
                    calcElem.classList.add('calculation-step'); // Class from new CSS
                    calcElem.innerHTML = calculationText;
                    stepDiv.appendChild(calcElem);
                }
                detailedCalculationsDiv.appendChild(stepDiv);
            }

            // Helper function for loss breakdown table
            function addLossRow(tableBody, lossType, valueKW, percentage) { 
                const row = document.createElement('tr');
                const typeCell = document.createElement('td');
                typeCell.textContent = lossType;
                const valueCell = document.createElement('td');
                valueCell.textContent = valueKW.toFixed(2) + " kW";
                const percentCell = document.createElement('td');
                percentCell.textContent = percentage.toFixed(1) + " %";
                row.appendChild(typeCell);
                row.appendChild(valueCell);
                row.appendChild(percentCell);
                tableBody.appendChild(row); 
            }

            // Function to determine efficiency class
            function getEfficiencyClass(ratedPowerKW, efficiency) {
                if (ratedPowerKW < 0.75) {
                    if (efficiency >= 85) return "IE3 / NEMA Premium";
                    if (efficiency >= 80) return "IE2 / NEMA Energy Efficient";
                    return "IE1 / NEMA Standard";
                } else if (ratedPowerKW < 7.5) {
                    if (efficiency >= 90) return "IE3 / NEMA Premium";
                    if (efficiency >= 87) return "IE2 / NEMA Energy Efficient";
                    return "IE1 / NEMA Standard";
                } else if (ratedPowerKW < 75) {
                    if (efficiency >= 93) return "IE3 / NEMA Premium";
                    if (efficiency >= 90) return "IE2 / NEMA Energy Efficient";
                    return "IE1 / NEMA Standard";
                } else {
                    if (efficiency >= 95) return "IE3 / NEMA Premium";
                    if (efficiency >= 92) return "IE2 / NEMA Energy Efficient";
                    return "IE1 / NEMA Standard";
                }
            }
            
            // Add listeners for new buttons
            resetFormBtn.addEventListener('click', resetForm);
            downloadPdfBtn.addEventListener('click', downloadPDF);

            // --- Theme switch logic ---
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
            
            // Initial call to set currency
            updateCurrencyLabel();

            // *** FIX: Removed the resetForm() call from here ***
            // This was clearing the defaults you set in the HTML.
            // We only need to set the currency label.
        });
    </script>
</body>
</html>


