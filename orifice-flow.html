<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orifice Plate Flow Calculator - Design Calculators - Instrumentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering - kept for potential future use, but formulas will be plain text -->
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #3b8e3e);
            --reset-button-bg: #FFC107; /* Yellow for reset */
            --reset-button-hover-bg: #E0A800; /* Darker yellow */
            --clear-button-bg: #007bff; /* Blue for clear */
            --clear-button-hover-bg: #0056b3; /* Darker blue */
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #446688;
            --button-gradient: linear-gradient(45deg, #3b8e3e, #4CAF50);
            --button-hover-gradient: linear-gradient(45deg, #4CAF50, #5cb85c);
            --reset-button-bg: #FFD700; /* Gold/Yellow for dark mode reset */
            --reset-button-hover-bg: #DAA520; /* Darker gold/yellow */
            --clear-button-bg: #17a2b8; /* Cyan for dark mode clear */
            --clear-button-hover-bg: #138496;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-color), #e0e0e0);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.3s;
            width: fit-content; 
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px; /* Default margin for form groups */
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg); /* Use card-bg for input background */
            color: var(--text-color);
            box-sizing: border-box; /* Ensure padding doesn't increase width */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
            gap: 20px; /* Gap between grid items */
            margin-bottom: 0; /* Handled by form-group margin */
        }
        
        .calculate-btn {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 12px 30px; /* Increased padding for better appearance */
            border-radius: 25px; /* More rounded */
            cursor: pointer;
            font-size: 1.1em; /* Slightly larger font */
            font-weight: bold;
            margin-top: 25px; /* More space above button */
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto; /* Allow button to size based on content and padding */
            min-width: 220px; /* Ensure a minimum width for consistency */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .calculate-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02); /* Lift and slightly scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }

        .reset-btn {
            background-color: var(--reset-button-bg);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 25px;
            margin-left: 15px; /* Space from calculate button */
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .reset-btn:hover {
            background-color: var(--reset-button-hover-bg);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .clear-results-btn {
            background-color: var(--clear-button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .clear-results-btn:hover {
            background-color: var(--clear-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For animation */
            transform: translateY(20px); /* Initial state for animation */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners apply to table content */
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color); /* Highlight row on hover */
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--hover-color);
            border-radius: 4px;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: color 0.3s;
        }

        .info-icon:hover {
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px); /* Initial state for tooltip animation */
            font-size: 0.85em;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: flex; /* Use flex for centering text */
            align-items: center;
            justify-content: center;
            min-width: 250px; /* Ensure it's wide enough */
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* More space */
            font-size: 0.95em;
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px; /* More space */
            text-align: center;
            font-size: 1.2em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif; /* A font suitable for mathematical formulas */
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 12px 10px; /* Increased padding */
            background-color: var(--hover-color);
            border-radius: 6px; /* More rounded */
            margin: 15px 0; /* More space */
            overflow-x: auto; /* Allow horizontal scrolling for long formulas */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace; /* Monospace for steps */
            background-color: var(--hover-color);
            padding: 8px 15px; /* Increased padding */
            border-radius: 4px; /* More rounded */
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-break: break-word; /* Break long words */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px; /* Increased margin */
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
        }

        /* Style for centering the button */
        .button-wrapper {
            display: flex;
            justify-content: center; /* Center the button horizontally */
            width: 100%; /* Ensure it takes full width to center effectively */
            padding-top: 20px; /* Add more spacing above the button */
        }

        /* Animation for input fields on focus */
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4); /* Green glow, slightly more pronounced */
            outline: none;
            animation: pulse 0.8s infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4);
            }
            to {
                box-shadow: 0 0 0 8px rgba(76, 175, 80, 0.2); /* Softer pulse */
            }
        }

        /* Specific styles for Orifice Flow */
        .unit-system-selector {
            margin-bottom: 20px;
            background-color: var(--hover-color);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        .unit-system-selector label {
            font-weight: bold;
            color: var(--text-color);
        }

        /* Fluid type selection */
        .fluid-type-selector {
            display: flex;
            align-items: center;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: var(--hover-color);
            border-radius: 8px;
            padding: 10px;
        }

        .fluid-type-selector label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-color);
        }

        .fluid-type-selector input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }

        /* Conditional display for fluid properties */
        #liquid-properties, #gas-properties {
            display: none; /* Hidden by default */
            margin-top: 15px;
            border-top: 1px dashed var(--border-color);
            padding-top: 15px;
        }

        #liquid-properties.active, #gas-properties.active {
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Instrumentation</h1>
            <p class="subtitle">Smart Tools for Modern Instrumentation Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <a href="indexInst.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </div>
        
        <div class="tool-container">
            <h2>Orifice Plate Flow Calculator</h2>
            
            <div class="tool-description">
                <p>This professional tool calculates the flow rate of a fluid through an orifice plate based on differential pressure and fluid properties. It is designed for engineers worldwide, supporting both Metric and Imperial units, and is essential for accurate flow measurement and system design in various industrial applications.</p>
            </div>
        
            <div class="calculator-form">
                <form id="orifice-flow-form">
                    <!-- Unit System Selection -->
                    <div class="form-section unit-system-selector">
                        <label for="unit-system">Select Unit System:</label>
                        <select id="unit-system" required>
                            <option value="metric">Metric (mm, Pa, kg/m³)</option>
                            <option value="imperial">Imperial (in, psi, lb/ft³)</option>
                        </select>
                        <label for="output-flow-type">Output Flow Type:</label>
                        <select id="output-flow-type" required>
                            <option value="volumetric">Volumetric Flow Rate</option>
                            <option value="mass">Mass Flow Rate</option>
                        </select>
                        <label for="output-flow-unit">Output Flow Unit:</label>
                        <select id="output-flow-unit" required>
                            <!-- Options will be dynamically populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Input Parameters -->
                    <div class="form-section">
                        <h3>Primary Flow Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="orifice-diameter" id="label-orifice-diameter">Orifice Bore Diameter (d) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-orifice-diameter">The diameter of the hole in the orifice plate.</span></span></label>
                                <input type="number" id="orifice-diameter" step="0.001" value="50.0" required>
                            </div>
                            <div class="form-group">
                                <label for="pipe-diameter" id="label-pipe-diameter">Pipe Inside Diameter (D) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-pipe-diameter">The inside diameter of the pipe where the orifice plate is installed.</span></span></label>
                                <input type="number" id="pipe-diameter" step="0.001" value="100.0" required>
                            </div>
                            <div class="form-group">
                                <label for="differential-pressure" id="label-differential-pressure">Differential Pressure (ΔP) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-differential-pressure">The pressure difference measured across the orifice plate.</span></span></label>
                                <input type="number" id="differential-pressure" step="0.01" value="1000.0" required>
                            </div>
                            <div class="form-group">
                                <label for="discharge-coefficient" id="label-discharge-coefficient">Discharge Coefficient (C<sub>d</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-discharge-coefficient">A dimensionless coefficient accounting for energy losses. Typically between 0.6 and 0.8. For precise values, refer to ISO 5167 or specific manufacturer data.</span></span></label>
                                <input type="number" id="discharge-coefficient" step="0.001" value="0.61" required>
                            </div>
                        </div>
                    </div>

                    <!-- Fluid Type Selection -->
                    <div class="form-section">
                        <h3>Fluid Type and Properties</h3>
                        <div class="fluid-type-selector">
                            <label>
                                <input type="radio" name="fluid-type" value="liquid" checked> Liquid
                            </label>
                            <label>
                                <input type="radio" name="fluid-type" value="gas"> Gas
                            </label>
                        </div>

                        <!-- Liquid Specific Properties -->
                        <div id="liquid-properties" class="form-row active">
                            <div class="form-group">
                                <label for="liquid-density" id="label-liquid-density">Liquid Density (ρ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-liquid-density">The density of the liquid at operating conditions.</span></span></label>
                                <input type="number" id="liquid-density" step="0.01" value="1000.0" required>
                            </div>
                            <div class="form-group">
                                <label for="liquid-viscosity" id="label-liquid-viscosity">Liquid Viscosity (μ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-liquid-viscosity">Dynamic viscosity of the liquid at operating conditions. Used for Reynolds number calculation.</span></span></label>
                                <input type="number" id="liquid-viscosity" step="0.000001" value="0.001" required>
                            </div>
                        </div>

                        <!-- Gas Specific Properties -->
                        <div id="gas-properties" class="form-row">
                            <div class="form-group">
                                <label for="molecular-weight" id="label-molecular-weight">Molecular Weight (MW) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-molecular-weight">The molecular weight of the gas. E.g., Air ≈ 28.97 g/mol. Used to calculate gas density.</span></span></label>
                                <input type="number" id="molecular-weight" step="0.01" value="28.97" required>
                            </div>
                            <div class="form-group">
                                <label for="operating-temperature" id="label-operating-temperature">Operating Temperature (T) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-operating-temperature">The absolute temperature of the gas at operating conditions. Used to calculate gas density.</span></span></label>
                                <input type="number" id="operating-temperature" step="0.1" value="25.0" required>
                            </div>
                            <div class="form-group">
                                <label for="absolute-pressure" id="label-absolute-pressure">Absolute Upstream Pressure (P<sub>1</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-absolute-pressure">The absolute pressure of the gas upstream of the orifice. Used to calculate gas density and expansion factor.</span></span></label>
                                <input type="number" id="absolute-pressure" step="0.1" value="101325.0" required>
                            </div>
                            <div class="form-group">
                                <label for="specific-heat-ratio" id="label-specific-heat-ratio">Specific Heat Ratio (k) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-specific-heat-ratio">Ratio of specific heats (Cp/Cv) for the gas. E.g., Air ≈ 1.4. Used for expansion factor calculation.</span></span></label>
                                <input type="number" id="specific-heat-ratio" step="0.01" value="1.4" required>
                            </div>
                            <div class="form-group">
                                <label for="gas-viscosity" id="label-gas-viscosity">Gas Viscosity (μ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-gas-viscosity">Dynamic viscosity of the gas at operating conditions. Used for Reynolds number calculation.</span></span></label>
                                <input type="number" id="gas-viscosity" step="1e-7" value="0.000018" required>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-flow-btn" class="calculate-btn">Calculate Flow</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Flow Calculation Results</h3>
                <div id="calculation-details">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
                </div>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Instrumentation!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Instrumentation! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const unitSystemSelect = document.getElementById('unit-system');
            const outputFlowTypeSelect = document.getElementById('output-flow-type');
            const outputFlowUnitSelect = document.getElementById('output-flow-unit');
            const orificeDiameterInput = document.getElementById('orifice-diameter');
            const pipeDiameterInput = document.getElementById('pipe-diameter');
            const differentialPressureInput = document.getElementById('differential-pressure');
            const dischargeCoefficientInput = document.getElementById('discharge-coefficient');

            const fluidTypeRadios = document.querySelectorAll('input[name="fluid-type"]');
            const liquidPropertiesDiv = document.getElementById('liquid-properties');
            const gasPropertiesDiv = document.getElementById('gas-properties');

            const liquidDensityInput = document.getElementById('liquid-density');
            const liquidViscosityInput = document.getElementById('liquid-viscosity');
            const molecularWeightInput = document.getElementById('molecular-weight');
            const operatingTemperatureInput = document.getElementById('operating-temperature');
            const absolutePressureInput = document.getElementById('absolute-pressure');
            const specificHeatRatioInput = document.getElementById('specific-heat-ratio');
            const gasViscosityInput = document.getElementById('gas-viscosity');

            const labelOrificeDiameter = document.getElementById('label-orifice-diameter');
            const labelPipeDiameter = document.getElementById('label-pipe-diameter');
            const labelDifferentialPressure = document.getElementById('label-differential-pressure');
            const labelFluidDensity = document.getElementById('label-fluid-density'); // This label will be updated based on fluid type
            const labelLiquidDensity = document.getElementById('label-liquid-density');
            const labelLiquidViscosity = document.getElementById('label-liquid-viscosity');
            const labelMolecularWeight = document.getElementById('label-molecular-weight');
            const labelOperatingTemperature = document.getElementById('label-operating-temperature');
            const labelAbsolutePressure = document.getElementById('label-absolute-pressure');
            const labelSpecificHeatRatio = document.getElementById('label-specific-heat-ratio');
            const labelGasViscosity = document.getElementById('label-gas-viscosity');


            const calculateFlowBtn = document.getElementById('calculate-flow-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            // Constants
            const UNIVERSAL_GAS_CONSTANT_SI = 8.314462618; // J/(mol·K) or Pa·m³/(mol·K)
            const ABSOLUTE_ZERO_CELSIUS = -273.15; // °C

            // Default values for resetting form (Metric)
            const defaultValues = {
                'unit-system': 'metric',
                'output-flow-type': 'volumetric',
                'orifice-diameter': 50.0, // mm
                'pipe-diameter': 100.0, // mm
                'differential-pressure': 1000.0, // Pa
                'discharge-coefficient': 0.61,
                'fluid-type': 'liquid',
                'liquid-density': 1000.0, // kg/m³
                'liquid-viscosity': 0.001, // Pa·s (water at 20°C)
                'molecular-weight': 28.97, // g/mol (air)
                'operating-temperature': 25.0, // °C
                'absolute-pressure': 101325.0, // Pa (1 atm)
                'specific-heat-ratio': 1.4, // for air
                'gas-viscosity': 0.000018 // Pa·s (air at 20°C)
            };

            // Unit configurations
            const unitsConfig = {
                'metric': {
                    diameter: { label: 'mm', tooltip: 'millimeters' },
                    pressure: { label: 'Pa', tooltip: 'Pascals', toSI: 1 },
                    temperature: { label: '°C', tooltip: 'Celsius', toKelvin: (T) => T + ABSOLUTE_ZERO_CELSIUS },
                    density: { label: 'kg/m³', tooltip: 'kilograms per cubic meter', toSI: 1 },
                    viscosity: { label: 'Pa·s', tooltip: 'Pascal-seconds', toSI: 1 },
                    molecularWeight: { label: 'g/mol', tooltip: 'grams per mole', toSI: 1 / 1000 }, // g/mol to kg/mol
                    flowOutputs: {
                        volumetric: [
                            { value: 'm3s', label: 'm³/s' },
                            { value: 'Ls', label: 'L/s' },
                            { value: 'm3hr', label: 'm³/hr' }
                        ],
                        mass: [
                            { value: 'kgs', label: 'kg/s' },
                            { value: 'kgmin', label: 'kg/min' },
                            { value: 'kghr', label: 'kg/hr' }
                        ]
                    },
                    conversions: {
                        orificeDiameter: 1 / 1000, // mm to m
                        pipeDiameter: 1 / 1000, // mm to m
                    }
                },
                'imperial': {
                    diameter: { label: 'in', tooltip: 'inches' },
                    pressure: { label: 'psi', tooltip: 'pounds per square inch', toSI: 6894.76 },
                    temperature: { label: '°F', tooltip: 'Fahrenheit', toKelvin: (T) => (T - 32) * 5/9 + ABSOLUTE_ZERO_CELSIUS },
                    density: { label: 'lb/ft³', tooltip: 'pounds per cubic foot', toSI: 16.0185 },
                    viscosity: { label: 'lb/(ft·s)', tooltip: 'pounds per foot-second', toSI: 1.48816 }, // lb/(ft·s) to Pa·s
                    molecularWeight: { label: 'lb/lbmol', tooltip: 'pounds per pound-mole', toSI: 0.453592 }, // lb/lbmol to kg/mol (approx, as 1 lbmol = 453.592 mol)
                    flowOutputs: {
                        volumetric: [
                            { value: 'ft3s', label: 'ft³/s' },
                            { value: 'gpm', label: 'GPM (US)' },
                            { value: 'bpd', label: 'BPD (US)' }
                        ],
                        mass: [
                            { value: 'lbs', label: 'lb/s' },
                            { value: 'lbmin', label: 'lb/min' },
                            { value: 'lbhr', label: 'lb/hr' }
                        ]
                    },
                    conversions: {
                        orificeDiameter: 0.0254, // inches to meters
                        pipeDiameter: 0.0254, // inches to meters
                    }
                }
            };

            // Conversion factors for output units from m³/s (SI base volumetric flow) or kg/s (SI base mass flow)
            const outputConversions = {
                'm3s': { factor: 1, type: 'volumetric' },
                'Ls': { factor: 1000, type: 'volumetric' }, // m³/s to L/s
                'm3hr': { factor: 3600, type: 'volumetric' }, // m³/s to m³/hr
                'ft3s': { factor: 35.3147, type: 'volumetric' }, // m³/s to ft³/s
                'gpm': { factor: 15850.3, type: 'volumetric' }, // m³/s to US GPM
                'bpd': { factor: 5434.36, type: 'volumetric' }, // m³/s to US BPD (1 barrel = 42 US gallons)
                'kgs': { factor: 1, type: 'mass' },
                'kgmin': { factor: 60, type: 'mass' }, // kg/s to kg/min
                'kghr': { factor: 3600, type: 'mass' }, // kg/s to kg/hr
                'lbs': { factor: 2.20462, type: 'mass' }, // kg/s to lb/s
                'lbmin': { factor: 132.277, type: 'mass' }, // kg/s to lb/min
                'lbhr': { factor: 7936.64, type: 'mass' } // kg/s to lb/hr
            };

            // Helper function to add rows to the result table (moved to a higher scope)
            function addResultRow(parameter, value) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
            }

            // Event Listeners
            unitSystemSelect.addEventListener('change', updateUnitLabelsAndTooltips);
            unitSystemSelect.addEventListener('change', populateOutputFlowUnits);
            outputFlowTypeSelect.addEventListener('change', populateOutputFlowUnits);
            fluidTypeRadios.forEach(radio => radio.addEventListener('change', updateFluidPropertiesVisibility));
            calculateFlowBtn.addEventListener('click', calculateFlow);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            // Initial setup
            populateOutputFlowUnits(); // Populate units based on initial system and flow type
            updateUnitLabelsAndTooltips(); // Update labels based on initial system
            updateFluidPropertiesVisibility(); // Show/hide fluid properties based on initial fluid type
            
            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            function populateOutputFlowUnits() {
                const selectedSystem = unitSystemSelect.value;
                const selectedFlowType = outputFlowTypeSelect.value;
                const flowOutputs = unitsConfig[selectedSystem].flowOutputs[selectedFlowType];
                outputFlowUnitSelect.innerHTML = ''; // Clear existing options

                flowOutputs.forEach(unit => {
                    const option = document.createElement('option');
                    option.value = unit.value;
                    option.textContent = unit.label;
                    outputFlowUnitSelect.appendChild(option);
                });
            }

            function updateUnitLabelsAndTooltips() {
                const selectedSystem = unitSystemSelect.value;
                const config = unitsConfig[selectedSystem];
                const fluidType = document.querySelector('input[name="fluid-type"]:checked').value;

                labelOrificeDiameter.innerHTML = `Orifice Bore Diameter (d) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The diameter of the hole in the orifice plate. Unit: ${config.diameter.tooltip}.</span></span>`;
                labelPipeDiameter.innerHTML = `Pipe Inside Diameter (D) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The inside diameter of the pipe where the orifice plate is installed. Unit: ${config.diameter.tooltip}.</span></span>`;
                labelDifferentialPressure.innerHTML = `Differential Pressure (ΔP) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The pressure difference measured across the orifice plate. Unit: ${config.pressure.tooltip}.</span></span>`;
                
                // Update fluid property labels based on selected system
                if (fluidType === 'liquid') {
                    labelLiquidDensity.innerHTML = `Liquid Density (ρ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The density of the liquid at operating conditions. Unit: ${config.density.tooltip}.</span></span>`;
                    labelLiquidViscosity.innerHTML = `Liquid Viscosity (μ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dynamic viscosity of the liquid at operating conditions. Used for Reynolds number calculation. Unit: ${config.viscosity.tooltip}.</span></span>`;
                } else { // gas
                    labelMolecularWeight.innerHTML = `Molecular Weight (MW) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The molecular weight of the gas. E.g., Air ≈ 28.97. Used to calculate gas density. Unit: ${config.molecularWeight.tooltip}.</span></span>`;
                    labelOperatingTemperature.innerHTML = `Operating Temperature (T) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The absolute temperature of the gas at operating conditions. Used to calculate gas density. Unit: ${config.temperature.tooltip}.</span></span>`;
                    labelAbsolutePressure.innerHTML = `Absolute Upstream Pressure (P<sub>1</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The absolute pressure of the gas upstream of the orifice. Used to calculate gas density and expansion factor. Unit: ${config.pressure.tooltip}.</span></span>`;
                    labelSpecificHeatRatio.innerHTML = `Specific Heat Ratio (k) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ratio of specific heats (C<sub>p</sub>/C<sub>v</sub>) for the gas. E.g., Air ≈ 1.4. Used for expansion factor calculation. (Dimensionless)</span></span>`;
                    labelGasViscosity.innerHTML = `Gas Viscosity (μ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dynamic viscosity of the gas at operating conditions. Used for Reynolds number calculation. Unit: ${config.viscosity.tooltip}.</span></span>`;
                }

                // Update input placeholders (optional, but good for UX)
                orificeDiameterInput.placeholder = `e.g., 50 ${config.diameter.label}`;
                pipeDiameterInput.placeholder = `e.g., 100 ${config.diameter.label}`;
                differentialPressureInput.placeholder = `e.g., 1000 ${config.pressure.label}`;
                
                liquidDensityInput.placeholder = `e.g., 1000 ${config.density.label}`;
                liquidViscosityInput.placeholder = `e.g., 0.001 ${config.viscosity.label}`;
                molecularWeightInput.placeholder = `e.g., 28.97 ${config.molecularWeight.label}`;
                operatingTemperatureInput.placeholder = `e.g., 25 ${config.temperature.label}`;
                absolutePressureInput.placeholder = `e.g., 101325 ${config.pressure.label}`;
                specificHeatRatioInput.placeholder = `e.g., 1.4`;
                gasViscosityInput.placeholder = `e.g., 0.000018 ${config.viscosity.label}`;
            }

            function updateFluidPropertiesVisibility() {
                const selectedFluidType = document.querySelector('input[name="fluid-type"]:checked').value;
                if (selectedFluidType === 'liquid') {
                    liquidPropertiesDiv.classList.add('active');
                    gasPropertiesDiv.classList.remove('active');
                    // Set required attributes for liquid inputs
                    liquidDensityInput.setAttribute('required', 'required');
                    liquidViscosityInput.setAttribute('required', 'required');
                    molecularWeightInput.removeAttribute('required');
                    operatingTemperatureInput.removeAttribute('required');
                    absolutePressureInput.removeAttribute('required');
                    specificHeatRatioInput.removeAttribute('required');
                    gasViscosityInput.removeAttribute('required');
                } else { // gas
                    liquidPropertiesDiv.classList.remove('active');
                    gasPropertiesDiv.classList.add('active');
                    // Set required attributes for gas inputs
                    liquidDensityInput.removeAttribute('required');
                    liquidViscosityInput.removeAttribute('required');
                    molecularWeightInput.setAttribute('required', 'required');
                    operatingTemperatureInput.setAttribute('required', 'required');
                    absolutePressureInput.setAttribute('required', 'required');
                    specificHeatRatioInput.setAttribute('required', 'required');
                    gasViscosityInput.setAttribute('required', 'required');
                }
                updateUnitLabelsAndTooltips(); // Update labels after visibility change
                clearResults(); // Clear results when fluid type changes
            }

            function clearResults() {
                resultContainer.classList.remove('show');
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                standardReference.innerHTML = '';
                displayMessage("Results cleared.", "info");
            }

            function resetForm() {
                unitSystemSelect.value = defaultValues['unit-system'];
                outputFlowTypeSelect.value = defaultValues['output-flow-type'];
                
                // Reset fluid type radio and trigger its change event
                document.querySelector(`input[name="fluid-type"][value="${defaultValues['fluid-type']}"]`).checked = true;
                updateFluidPropertiesVisibility(); // This will also call updateUnitLabelsAndTooltips and populateOutputFlowUnits

                orificeDiameterInput.value = defaultValues['orifice-diameter'];
                pipeDiameterInput.value = defaultValues['pipe-diameter'];
                differentialPressureInput.value = defaultValues['differential-pressure'];
                dischargeCoefficientInput.value = defaultValues['discharge-coefficient'];
                liquidDensityInput.value = defaultValues['liquid-density'];
                liquidViscosityInput.value = defaultValues['liquid-viscosity'];
                molecularWeightInput.value = defaultValues['molecular-weight'];
                operatingTemperatureInput.value = defaultValues['operating-temperature'];
                absolutePressureInput.value = defaultValues['absolute-pressure'];
                specificHeatRatioInput.value = defaultValues['specific-heat-ratio'];
                gasViscosityInput.value = defaultValues['gas-viscosity'];
                
                clearResults(); // Clear results again after inputs are reset
                displayMessage("Form reset to default values (Metric, Liquid).", "info");
            }

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    messageBox.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        padding: 15px 25px;
                        border-radius: 8px;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                        z-index: 1000;
                        font-weight: bold;
                        color: white;
                        opacity: 0;
                        transition: opacity 0.5s ease-in-out, transform 0.3s ease-out;
                        display: flex; /* Use flex for centering text */
                        align-items: center;
                        justify-content: center;
                        min-width: 250px; /* Ensure it's wide enough */
                    `;
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; /* Red */
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; /* Amber */
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745'; /* Green */
                }
                messageBox.style.opacity = 1;
                messageBox.style.transform = 'translateX(-50%) translateY(0)'; // Bring to position

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)'; // Fade out and move up
                }, 5000);
            }

            function calculateFlow() {
                clearResults(); // Clear previous results
                const selectedSystem = unitSystemSelect.value;
                const selectedFlowType = outputFlowTypeSelect.value;
                const outputFlowUnit = outputFlowUnitSelect.value;
                const config = unitsConfig[selectedSystem];

                let d = parseFloat(orificeDiameterInput.value);
                let D = parseFloat(pipeDiameterInput.value);
                let dP = parseFloat(differentialPressureInput.value);
                let Cd = parseFloat(dischargeCoefficientInput.value);
                
                let rho_si; // Density in kg/m³
                let mu_si;  // Viscosity in Pa·s
                let Y = 1;  // Expansion Factor (default 1 for liquids)

                const fluidType = document.querySelector('input[name="fluid-type"]:checked').value;

                // Input Validation
                if (isNaN(d) || isNaN(D) || isNaN(dP) || isNaN(Cd)) {
                    displayMessage("Please enter valid numerical values for all primary flow parameters.", "error");
                    return;
                }
                if (d <= 0 || D <= 0) {
                    displayMessage("Diameters must be positive values.", "error");
                    return;
                }
                if (d >= D) {
                    displayMessage("Orifice bore diameter (d) must be less than pipe inside diameter (D).", "error");
                    return;
                }
                if (dP < 0) {
                    displayMessage("Differential pressure (ΔP) cannot be negative.", "error");
                    return;
                }
                if (Cd <= 0 || Cd > 1) {
                    displayMessage("Discharge Coefficient (C<sub>d</sub>) should be a positive value, typically between 0.6 and 0.8.", "warning");
                    // Continue calculation with warning
                }

                // Convert primary inputs to SI units
                d *= config.conversions.orificeDiameter; // to meters
                D *= config.conversions.pipeDiameter;     // to meters
                dP_si = dP * config.pressure.toSI;        // to Pascals

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>Unit System:</strong> ${selectedSystem.toUpperCase()}</p>`;
                calculationHtml += `<p><strong>Output Flow Type:</strong> ${selectedFlowType === 'volumetric' ? 'Volumetric Flow Rate' : 'Mass Flow Rate'}</p>`;
                calculationHtml += `<p><strong>1. Convert Inputs to SI Units:</strong></p>`;
                calculationHtml += `<p class="calculation-step">Orifice Diameter (d) = ${orificeDiameterInput.value} ${config.diameter.label} = ${d.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Pipe Diameter (D) = ${pipeDiameterInput.value} ${config.diameter.label} = ${D.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Differential Pressure (ΔP) = ${differentialPressureInput.value} ${config.pressure.label} = ${dP_si.toFixed(2)} Pa</p>`;
                calculationHtml += `<p class="calculation-step">Discharge Coefficient (C<sub>d</sub>) = ${Cd.toFixed(3)} (dimensionless)</p>`;

                // Fluid properties handling
                if (fluidType === 'liquid') {
                    let liquidDensity = parseFloat(liquidDensityInput.value);
                    let liquidViscosity = parseFloat(liquidViscosityInput.value);

                    if (isNaN(liquidDensity) || liquidDensity <= 0) {
                        displayMessage("Please enter a valid positive Liquid Density.", "error");
                        return;
                    }
                    if (isNaN(liquidViscosity) || liquidViscosity <= 0) {
                        displayMessage("Please enter a valid positive Liquid Viscosity.", "error");
                        return;
                    }

                    rho_si = liquidDensity * config.density.toSI;
                    mu_si = liquidViscosity * config.viscosity.toSI;

                    calculationHtml += `<p><strong>2. Liquid Properties:</strong></p>`;
                    calculationHtml += `<p class="calculation-step">Input Liquid Density = ${liquidDensityInput.value} ${config.density.label} = ${rho_si.toFixed(2)} kg/m³</p>`;
                    calculationHtml += `<p class="calculation-step">Input Liquid Viscosity = ${liquidViscosityInput.value} ${config.viscosity.label} = ${mu_si.toExponential(2)} Pa·s</p>`;

                } else { // gas
                    let molecularWeight = parseFloat(molecularWeightInput.value);
                    let operatingTemperature = parseFloat(operatingTemperatureInput.value);
                    let absolutePressure = parseFloat(absolutePressureInput.value);
                    let specificHeatRatio = parseFloat(specificHeatRatioInput.value);
                    let gasViscosity = parseFloat(gasViscosityInput.value);

                    if (isNaN(molecularWeight) || molecularWeight <= 0) {
                        displayMessage("Please enter a valid positive Molecular Weight.", "error");
                        return;
                    }
                    if (isNaN(operatingTemperature)) {
                        displayMessage("Please enter a valid Operating Temperature.", "error");
                        return;
                    }
                    if (isNaN(absolutePressure) || absolutePressure <= 0) {
                        displayMessage("Please enter a valid positive Absolute Upstream Pressure.", "error");
                        return;
                    }
                    if (isNaN(specificHeatRatio) || specificHeatRatio <= 0) {
                        displayMessage("Please enter a valid positive Specific Heat Ratio.", "error");
                        return;
                    }
                    if (isNaN(gasViscosity) || gasViscosity <= 0) {
                        displayMessage("Please enter a valid positive Gas Viscosity.", "error");
                        return;
                    }

                    // Convert gas inputs to SI
                    const T_kelvin = config.temperature.toKelvin(operatingTemperature); // to Kelvin
                    const P1_si = absolutePressure * config.pressure.toSI; // to Pascals
                    const MW_si = molecularWeight * config.molecularWeight.toSI; // to kg/mol
                    mu_si = gasViscosity * config.viscosity.toSI;

                    // Calculate gas density using Ideal Gas Law (PV=nRT -> P*MW = rho*R*T)
                    rho_si = (P1_si * MW_si) / (UNIVERSAL_GAS_CONSTANT_SI * T_kelvin);

                    // Calculate Expansion Factor (Y) for gases
                    const beta_ratio = d / D;
                    const pressure_ratio = dP_si / P1_si;
                    Y = 1 - (0.41 + 0.35 * Math.pow(beta_ratio, 4)) * (pressure_ratio / specificHeatRatio);
                    
                    if (Y <= 0 || Y > 1) {
                         displayMessage("Calculated Expansion Factor (Y) is out of typical range. Check gas parameters or differential pressure. Y should be between 0 and 1.", "warning");
                    }

                    calculationHtml += `<p><strong>2. Gas Properties:</strong></p>`;
                    calculationHtml += `<p class="calculation-step">Input Molecular Weight = ${molecularWeightInput.value} ${config.molecularWeight.label} = ${MW_si.toFixed(4)} kg/mol</p>`;
                    calculationHtml += `<p class="calculation-step">Input Operating Temperature = ${operatingTemperatureInput.value} ${config.temperature.label} = ${T_kelvin.toFixed(2)} K</p>`;
                    calculationHtml += `<p class="calculation-step">Input Absolute Upstream Pressure = ${absolutePressureInput.value} ${config.pressure.label} = ${P1_si.toFixed(2)} Pa</p>`;
                    calculationHtml += `<p class="calculation-step">Input Specific Heat Ratio (k) = ${specificHeatRatio.toFixed(2)} (dimensionless)</p>`;
                    calculationHtml += `<p class="calculation-step">Input Gas Viscosity = ${gasViscosityInput.value} ${config.viscosity.label} = ${mu_si.toExponential(2)} Pa·s</p>`;
                    calculationHtml += `<p class="calculation-step">Calculated Gas Density (ρ) = ${rho_si.toFixed(3)} kg/m³</p>`;
                    calculationHtml += `<p class="calculation-step">Calculated Expansion Factor (Y) = ${Y.toFixed(4)} (dimensionless)</p>`;
                }

                // Perform Calculation
                const Ao = Math.PI / 4 * d * d; // Orifice Area (m²)
                const beta = d / D;             // Beta ratio (dimensionless)
                const beta4 = Math.pow(beta, 4); // Beta ratio to the power of 4

                if (1 - beta4 <= 0) { // Safeguard
                    displayMessage("Invalid pipe and orifice diameter ratio. Check your inputs.", "error");
                    return;
                }

                const volumetricFlowRate_m3s = Cd * Y * Ao * Math.sqrt((2 * dP_si) / (rho_si * (1 - beta4))); // Volumetric flow rate in m³/s
                const massFlowRate_kgs = volumetricFlowRate_m3s * rho_si; // Mass flow rate in kg/s

                // Reynolds Number Calculation (based on pipe diameter)
                let Re;
                if (mu_si > 0) { // Avoid division by zero
                    Re = (4 * massFlowRate_kgs) / (Math.PI * D * mu_si);
                } else {
                    Re = 0; // Or handle as an error if viscosity is expected
                    displayMessage("Viscosity is zero or invalid, Reynolds number cannot be calculated.", "warning");
                }
                

                calculationHtml += `<p><strong>3. Calculate Area Ratios and Reynolds Number:</strong></p>`;
                calculationHtml += `<p class="calculation-step">Orifice Area (A<sub>o</sub>) = π/4 * d² = ${Ao.toExponential(4)} m²</p>`;
                calculationHtml += `<p class="calculation-step">Beta Ratio (β) = d / D = ${beta.toFixed(4)}</p>`;
                calculationHtml += `<p class="calculation-step">β⁴ = ${beta4.toFixed(4)}</p>`;
                calculationHtml += `<p class="calculation-step">Reynolds Number (Re) = (4 * Mass Flow Rate) / (π * Pipe Diameter * Dynamic Viscosity)</p>`;
                calculationHtml += `<p class="calculation-step">Re = (4 * ${massFlowRate_kgs.toExponential(4)} kg/s) / (π * ${D.toFixed(4)} m * ${mu_si.toExponential(2)} Pa·s) = ${Re.toExponential(2)}</p>`;


                calculationHtml += `<p><strong>4. Apply the Orifice Flow Equation:</strong></p>`;
                calculationHtml += `<p>The flow rate through an orifice plate is calculated using a modified Bernoulli's equation, incorporating the discharge coefficient, the expansion factor (for gases), and the velocity of approach factor (derived from the beta ratio).</p>`;
                calculationHtml += `<p class="formula">Volumetric Flow Rate (Q<sub>v</sub>) = C<sub>d</sub> * Y * A<sub>o</sub> * &radic;[ (2 * &Delta;P) / (&rho; * (1 - &beta;<sup>4</sup>)) ]</p>`;
                calculationHtml += `<p class="formula">Mass Flow Rate (Q<sub>m</sub>) = Q<sub>v</sub> * &rho;</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>v</sub> = ${Cd.toFixed(3)} * ${Y.toFixed(4)} * ${Ao.toExponential(4)} * &radic;[ (2 * ${dP_si.toFixed(2)}) / (${rho_si.toFixed(2)} * (1 - ${beta4.toFixed(4)})) ]</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>v</sub> = ${volumetricFlowRate_m3s.toExponential(4)} m³/s</p>`;
                calculationHtml += `<p class="calculation-step">Q<sub>m</sub> = ${volumetricFlowRate_m3s.toExponential(4)} m³/s * ${rho_si.toFixed(3)} kg/m³ = ${massFlowRate_kgs.toExponential(4)} kg/s</p>`;


                // Convert to desired output unit
                let finalFlowRate;
                let finalFlowUnitLabel;

                if (selectedFlowType === 'volumetric') {
                    finalFlowRate = volumetricFlowRate_m3s * outputConversions[outputFlowUnit].factor;
                    finalFlowUnitLabel = outputFlowUnitSelect.options[outputFlowUnitSelect.selectedIndex].text;
                    calculationHtml += `<p class="calculation-step">Converted Volumetric Flow Rate = ${finalFlowRate.toFixed(3)} ${finalFlowUnitLabel}</p>`;
                } else { // mass
                    finalFlowRate = massFlowRate_kgs * outputConversions[outputFlowUnit].factor;
                    finalFlowUnitLabel = outputFlowUnitSelect.options[outputFlowUnitSelect.selectedIndex].text;
                    calculationHtml += `<p class="calculation-step">Converted Mass Flow Rate = ${finalFlowRate.toFixed(3)} ${finalFlowUnitLabel}</p>`;
                }


                // Display Results
                calculationDetailsDiv.innerHTML = calculationHtml;
                
                resultTableBody.innerHTML = '';
                addResultRow("Orifice Bore Diameter (d)", `${orificeDiameterInput.value} ${config.diameter.label}`);
                addResultRow("Pipe Inside Diameter (D)", `${pipeDiameterInput.value} ${config.diameter.label}`);
                addResultRow("Differential Pressure (ΔP)", `${differentialPressureInput.value} ${config.pressure.label}`);
                addResultRow("Discharge Coefficient (C<sub>d</sub>)", `${dischargeCoefficientInput.value}`);
                addResultRow("Fluid Type", fluidType.charAt(0).toUpperCase() + fluidType.slice(1));
                if (fluidType === 'liquid') {
                    addResultRow("Liquid Density (ρ)", `${liquidDensityInput.value} ${config.density.label}`);
                    addResultRow("Liquid Viscosity (μ)", `${liquidViscosityInput.value} ${config.viscosity.label}`);
                } else {
                    addResultRow("Molecular Weight (MW)", `${molecularWeightInput.value} ${config.molecularWeight.label}`);
                    addResultRow("Operating Temperature (T)", `${operatingTemperatureInput.value} ${config.temperature.label}`);
                    addResultRow("Absolute Upstream Pressure (P<sub>1</sub>)", `${absolutePressureInput.value} ${config.pressure.label}`);
                    addResultRow("Specific Heat Ratio (k)", `${specificHeatRatioInput.value}`);
                    addResultRow("Gas Viscosity (μ)", `${gasViscosityInput.value} ${config.viscosity.label}`);
                    addResultRow("Calculated Gas Density (ρ)", `${rho_si.toFixed(3)} kg/m³`);
                    addResultRow("Calculated Expansion Factor (Y)", `${Y.toFixed(4)}`);
                }
                addResultRow("Beta Ratio (β)", `${beta.toFixed(4)}`);
                addResultRow("Reynolds Number (Re)", `${Re.toExponential(2)}`);
                addResultRow(`<strong>Calculated ${selectedFlowType === 'volumetric' ? 'Volumetric' : 'Mass'} Flow Rate</strong>`, `<strong>${finalFlowRate.toFixed(3)} ${finalFlowUnitLabel}</strong>`);
                
                standardRefText = `
                    <h4>International Standards Compliance:</h4>
                    <p>This calculator is based on the fundamental principles of flow measurement using orifice plates, which are standardized globally to ensure accuracy and interchangeability. It incorporates key parameters and calculations as defined by leading international standards:</p>
                    <ul>
                        <li><strong>ISO 5167: Measurement of fluid flow by means of pressure differential devices inserted in circular cross-section conduits running full.</strong> This is the primary international standard covering the design, installation, and calculation methods for orifice plates, nozzles, and Venturi tubes. It provides detailed equations and coefficients for various flow conditions, including the use of discharge coefficients (C<sub>d</sub>) and expansion factors (Y) for compressible fluids.</li>
                        <li><strong>ASME MFC-3M: Measurement of Fluid Flow in Pipes Using Orifice, Nozzle, and Venturi.</strong> This American Society of Mechanical Engineers (ASME) standard is widely used, providing similar guidelines and calculation methods to ISO 5167, often with specific focus on North American practices.</li>
                        <li><strong>API MPMS (Manual of Petroleum Measurement Standards) Chapter 14.3: Concentric, Square-Edged Orifice Meters.</strong> For the petroleum and natural gas industries, this API standard provides specific guidance for the use of orifice meters in custody transfer and other critical applications, often referencing the principles of ISO 5167.</li>
                        <li><strong>Fluid Properties (Density & Viscosity):</strong> Accurate determination of fluid density (especially for gases using equations of state like the Ideal Gas Law, as approximated here) and dynamic viscosity are critical inputs. These properties are typically derived from industry-standard handbooks, databases, or specialized software, which align with principles from thermodynamics and fluid mechanics.</li>
                        <li><strong>Reynolds Number (Re):</strong> The calculation of the Reynolds number is crucial for characterizing flow regimes (laminar, transitional, turbulent) and is a key parameter influencing the discharge coefficient (C<sub>d</sub>) in flow measurement standards.</li>
                    </ul>
                    <p>While this tool provides a robust calculation, precise flow measurement in industrial applications requires careful adherence to the installation requirements, fluid property characterization, and calibration procedures detailed in these standards. Always consult the full standard documents for critical engineering design and verification.</p>
                `;
                standardReference.innerHTML = standardRefText;

                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    resultContainer.scrollIntoView({ behavior: 'smooth' });
                }, 10);
            }

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>

</html>

