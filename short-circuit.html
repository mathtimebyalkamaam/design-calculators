<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googletagservices.com/tag/js/gpt.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Short Circuit Current - Design Calculators - Electrical</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #1E3A8A; /* Professional Dark Blue */
            --secondary-color: #2563EB; /* Bright Blue */
            --accent-color: #F59E0B; /* Warm Amber */
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-color: #4B5563;
            --heading-color: #111827;
            --footer-bg: #0F172A;
            --border-color: #E2E8F0;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --hover-color: #F1F5F9;
        }

        body.dark-mode {
            --primary-color: #10B981; /* Vibrant Green */
            --secondary-color: #34D399; /* Lighter Green */
            --bg-color: #0F172A;
            --card-bg: #1E293B;
            --text-color: #CBD5E1;
            --heading-color: #F1F5F9;
            --footer-bg: #020617;
            --border-color: #334155;
            --hover-color: #1E293B;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* NEW HEADER STYLES */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 24px 0;
            position: relative;
            overflow: hidden;
        }
        .navbar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .logo-container { 
            display: flex; 
            align-items: center; 
            gap: 16px; 
            text-decoration: none; 
            color: white; 
        }
        .logo { 
            height: 56px; 
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .theme-toggle { 
            display: flex; 
            align-items: center; 
            gap: 12px;
        }
        .theme-toggle .icon { 
            color: white; 
            font-size: 1.2rem; 
        }
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 56px; 
            height: 30px; 
        }
        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: rgba(0,0,0,0.2); 
            transition: .4s; 
            border-radius: 30px; 
        }
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 22px; 
            width: 22px; 
            left: 4px; 
            bottom: 4px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
        }
        input:checked + .slider { 
            background-color: var(--accent-color); 
        }
        input:checked + .slider:before { 
            transform: translateX(26px); 
        }

        main {
            padding: 20px 0;
        }
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .tool-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        .tool-container h2 {
            color: var(--heading-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        .tool-description {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--hover-color);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.2s;
            font-weight: 500;
        }
        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateX(-3px);
        }

        /* NEW FOOTER STYLES */
        footer { 
            background: var(--gradient-dark);
            color: #CBD5E1; 
            padding: 80px 0 30px 0; 
        }
        .footer-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 40px; 
        }
        .footer-col h4 { 
            font-size: 1.2rem; 
            color: white; 
            margin-bottom: 1.5rem; 
            font-weight: 700;
        }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col ul li { margin-bottom: 1rem; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent-color); }
        .footer-disclaimer {
            text-align: center;
            margin: 40px auto;
            padding-top: 40px;
            border-top: 1px solid #334155;
            max-width: 800px;
        }
        .footer-disclaimer h4 {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 1rem;
        }
        .footer-bottom { 
            text-align: center; 
            padding-top: 20px; 
            font-size: 0.9rem; 
            color: #94A3B8;
        }
        .creator-name { 
            color: var(--secondary-color); 
            font-weight: bold; 
        }

        /* Calculator Styles */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--heading-color);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: border-color 0.3s, box-shadow 0.3s;
            font-size: 1rem;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            outline: none;
        }
        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .form-row .form-group {
            flex: 1 1 200px;
        }
        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
        }
        .calculate-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        .calculate-btn:active {
            transform: translateY(0);
        }
        .result-container {
            margin-top: 30px;
            padding: 25px;
            border-radius: 8px;
            background-color: var(--card-bg);
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        .result-container.show {
            opacity: 1;
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 6px;
            overflow: hidden;
        }
        .result-table th, .result-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background-color: var(--hover-color);
            font-weight: 600;
            color: var(--heading-color);
        }
        .result-table tr:last-child td {
            border-bottom: none;
        }
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            padding: 15px;
            background-color: var(--hover-color);
            border-radius: 6px;
            border-left: 4px solid var(--accent-color);
        }
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .loading-spinner {
            display: none;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .detailed-calculations, .short-circuit-reduction-tips, .industry-importance {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--hover-color);
            animation: fadeIn 0.5s ease-out;
        }
        .detailed-calculations h4, .short-circuit-reduction-tips h4, .industry-importance h4 {
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .detailed-calculations p, .short-circuit-reduction-tips p, .short-circuit-reduction-tips ul, .industry-importance p {
            margin-bottom: 10px;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        .short-circuit-reduction-tips ul {
            list-style-type: disc;
            padding-left: 20px;
        }
        .detailed-calculations strong, .short-circuit-reduction-tips strong {
            color: var(--secondary-color);
        }
        .formula {
            font-family: 'Courier New', Courier, monospace;
            background-color: rgba(0,0,0,0.05);
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
            margin: 8px 0;
            font-size: 0.95em;
            border-left: 3px solid var(--primary-color);
        }
        .calculation-step {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed var(--border-color);
            animation: fadeIn 0.5s ease-out;
        }
        .detailed-calculations .calculation-step:last-child {
            border-bottom: none;
        }
        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 25px;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.3rem;
            font-weight: 600;
        }
        .section-title i {
            font-size: 1.2rem;
        }
        .standards-section {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--hover-color);
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }
        .standards-section h4 {
            color: var(--heading-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        .standards-section ul {
            list-style-type: none;
            padding-left: 0;
        }
        .standards-section li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        .standards-section li:before {
            content: "•";
            color: var(--primary-color);
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .tool-container {
                padding: 15px;
            }
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            .form-row .form-group {
                flex: 1 1 100%;
            }
            .result-table {
                display: block;
                overflow-x: auto;
            }
            .logo-text {
                font-size: 1.4rem;
            }
            .tool-container h2 {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
            .theme-toggle {
                align-self: flex-end;
            }
            .logo-text {
                font-size: 1.2rem;
            }
            .tool-container h2 {
                font-size: 1.3rem;
            }
            .section-title {
                font-size: 1.1rem;
            }
        }
        
        /* Print styles */
        @media print {
            .header, .back-button, footer, .calculate-btn {
                display: none;
            }
            .tool-container {
                box-shadow: none;
                border: 1px solid #000;
            }
            .result-container {
                display: block;
                opacity: 1;
            }
        }
    </style>
    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                processHtmlClass: 'math-content',
                ignoreHtmlClass: 'no-mathjax'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>
                <div class="theme-toggle">
                    <i class="fas fa-sun icon"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon icon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        
        <div class="tool-container">
            <h2>Advanced Short Circuit Current Calculator</h2>
            <div class="tool-description">
                <p>This calculator estimates various types of short-circuit currents in electrical power systems, including three-phase, line-to-line, line-to-ground, and double line-to-ground faults. It considers utility source impedance, transformer characteristics, cable parameters, and motor contributions for comprehensive analysis.</p>
                <p><strong>Industry Importance:</strong> Short circuit analysis is critical for selecting properly rated equipment, ensuring personnel safety, maintaining system reliability, and complying with electrical codes and standards. Accurate fault current calculations help prevent equipment damage, minimize downtime, and ensure safe operation of electrical systems.</p>
            </div>
            
            <div class="calculator-form">
                <form id="short-circuit-form">
                    <div class="section-title">
                        <i class="fas fa-bolt"></i>
                        <span>System Parameters</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="system-voltage">System Voltage (V - Line-to-Line) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The nominal line-to-line voltage of the electrical system at the point of interest.</span></span></label>
                            <input type="number" id="system-voltage" min="1" step="1" value="415" required>
                        </div>
                        <div class="form-group">
                            <label for="fault-type">Fault Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the type of short circuit fault to calculate.</span></span></label>
                            <select id="fault-type" required>
                                <option value="three-phase-symmetrical">Three-Phase Symmetrical (3PH)</option>
                                <option value="single-line-to-ground">Single-Line-to-Ground (SLG)</option>
                                <option value="line-to-line">Line-to-Line (LL)</option>
                                <option value="double-line-to-ground">Double-Line-to-Ground (DLG)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="section-title">
                        <i class="fas fa-plug"></i>
                        <span>Source (Utility/Grid) Data</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="utility-fault-mva">Utility Fault Level (MVA) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The available fault level from the utility grid at the transformer's primary side (e.g., 500 MVA). Enter 0 for an infinite bus assumption (simplified, $Z_{utility}=0$).</span></span></label>
                            <input type="number" id="utility-fault-mva" min="0" step="1" value="500" required>
                        </div>
                        <div class="form-group">
                            <label for="utility-xr-ratio">Utility X/R Ratio <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The X/R ratio of the utility source impedance. Typical values are 5-20 for high voltage, lower for low voltage.</span></span></label>
                            <input type="number" id="utility-xr-ratio" min="1" step="0.1" value="10" required>
                        </div>
                    </div>
                    
                    <div class="section-title">
                        <i class="fas fa-transformer"></i>
                        <span>Transformer Data</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="transformer-kva">Transformer Rating (kVA) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The kVA rating of the upstream transformer.</span></span></label>
                            <input type="number" id="transformer-kva" min="1" step="1" value="1000" required>
                        </div>
                        <div class="form-group">
                            <label for="transformer-impedance">Transformer Impedance (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The percentage impedance of the transformer (typically found on the nameplate).</span></span></label>
                            <input type="number" id="transformer-impedance" min="0.1" max="20" step="0.1" value="5.75" required>
                        </div>
                    </div>
                    <div class="form-row">
                         <div class="form-group">
                            <label for="transformer-xr-ratio">Transformer X/R Ratio <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The X/R ratio of the transformer impedance. Typical values are 3-7.</span></span></label>
                            <input type="number" id="transformer-xr-ratio" min="0.5" step="0.1" value="5" required>
                        </div>
                        <div class="form-group">
                            <label for="transformer-connection-primary">Transformer Primary Connection <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Connection type of the transformer primary winding.</span></span></label>
                            <select id="transformer-connection-primary" required>
                                <option value="delta">Delta (Δ)</option>
                                <option value="wye-grounded">Wye Grounded (Yg)</option>
                                <option value="wye-ungrounded">Wye Ungrounded (Yu)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="transformer-connection-secondary">Transformer Secondary Connection <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Connection type of the transformer secondary winding.</span></span></label>
                            <select id="transformer-connection-secondary" required>
                                <option value="wye-grounded">Wye Grounded (Yg)</option>
                                <option value="delta">Delta (Δ)</option>
                                <option value="wye-ungrounded">Wye Ungrounded (Yu)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transformer-grounding-impedance">Transformer Grounding Impedance ($\Omega$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">External impedance in transformer neutral grounding path (for Yg secondary). Enter 0 for solid grounding.</span></span></label>
                            <input type="number" id="transformer-grounding-impedance" min="0" step="0.001" value="0.001">
                        </div>
                    </div>
                    
                    <div class="section-title">
                        <i class="fas fa-cable"></i>
                        <span>Cable Data (Transformer to Fault)</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cable-length">Cable Length (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The length of the cable connecting the transformer's secondary to the fault location.</span></span></label>
                            <input type="number" id="cable-length" min="0" step="0.1" value="20" required>
                        </div>
                        <div class="form-group">
                            <label for="cable-size">Cable Cross-Sectional Area (mm<sup>2</sup>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The cross-sectional area of the conductors in the cable.</span></span></label>
                            <input type="number" id="cable-size" min="1.5" step="0.5" value="185" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cable-material">Cable Material <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Material of the cable conductors (Copper or Aluminum).</span></span></label>
                            <select id="cable-material" required>
                                <option value="copper">Copper</option>
                                <option value="aluminum">Aluminum</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cable-xr-ratio">Cable X/R Ratio <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The X/R ratio of the cable impedance. Typical values are 0.5-3 for LV cables.</span></span></label>
                            <input type="number" id="cable-xr-ratio" min="0.1" step="0.1" value="1" required>
                        </div>
                    </div>
                    <div class="form-row">
                         <div class="form-group">
                            <label for="cable-temperature">Cable Operating Temperature (°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Operating temperature of the cable, affecting its resistance. Standard reference is 75°C or 90°C.</span></span></label>
                            <input type="number" id="cable-temperature" min="20" step="5" value="75" required>
                        </div>
                    </div>
                    
                    <div class="section-title">
                        <i class="fas fa-motor"></i>
                        <span>Motor Contribution (Optional)</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="motor-hp">Total Motor Horsepower (HP) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total aggregate horsepower of motors connected to the fault bus.</span></span></label>
                            <input type="number" id="motor-hp" min="0" step="1" value="0">
                        </div>
                        <div class="form-group">
                            <label for="motor-efficiency">Motor Efficiency (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Average efficiency of the motors.</span></span></label>
                            <input type="number" id="motor-efficiency" min="50" max="100" step="1" value="85">
                        </div>
                    </div>
                    <div class="form-row">
                         <div class="form-group">
                            <label for="motor-starting-pf">Motor Starting Power Factor <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Average starting power factor of the motors (typically low, e.g., 0.2-0.4).</span></span></label>
                            <input type="number" id="motor-starting-pf" min="0.1" max="0.99" step="0.01" value="0.3">
                        </div>
                        <div class="form-group">
                            <label for="motor-subtransient-reactance">Motor Sub-transient Reactance ($X''_{d}$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Average sub-transient reactance of motors in per-unit (pu). Typical range: 0.15 - 0.25 pu.</span></span></label>
                            <input type="number" id="motor-subtransient-reactance" min="0.05" max="0.5" step="0.01" value="0.2">
                        </div>
                    </div>
                    
                    <button type="button" id="calculate-short-circuit-btn" class="calculate-btn">
                        <i class="fas fa-calculator"></i> Calculate Short Circuit Current
                    </button>
                    <div id="loading-spinner" class="loading-spinner"></div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Short Circuit Analysis Results</h3>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be populated here -->
                    </tbody>
                </table>
                
                <div id="detailed-calculations" class="detailed-calculations">
                    <h4><i class="fas fa-calculator"></i> Detailed Calculation Steps</h4>
                    <!-- Detailed calculations will be populated here -->
                </div>
                
                <div class="standards-section">
                    <h4><i class="fas fa-book"></i> Applicable Standards</h4>
                    <ul>
                        <li>IEEE 141 (IEEE Recommended Practice for Electric Power Distribution for Industrial Plants)</li>
                        <li>IEEE 242 (IEEE Recommended Practice for Protection and Coordination of Industrial and Commercial Power Systems)</li>
                        <li>IEC 60909 (Short-circuit currents in three-phase a.c. systems)</li>
                        <li>ANSI/IEEE C37.010 (Application Guide for AC High-Voltage Circuit Breakers)</li>
                        <li>NFPA 70 (National Electrical Code)</li>
                    </ul>
                </div>
                
                <div class="industry-importance">
                    <h4><i class="fas fa-industry"></i> Industry Importance</h4>
                    <p>Short circuit analysis is essential for:</p>
                    <ul>
                        <li><strong>Equipment Selection:</strong> Ensuring circuit breakers, fuses, and other protective devices can safely interrupt fault currents</li>
                        <li><strong>System Protection:</strong> Designing coordinated protection schemes that isolate faults while maintaining service to healthy sections</li>
                        <li><strong>Safety Compliance:</strong> Meeting regulatory requirements for electrical system safety</li>
                        <li><strong>System Reliability:</strong> Preventing equipment damage and minimizing downtime during fault conditions</li>
                        <li><strong>Arc Flash Analysis:</strong> Determining incident energy levels for proper personal protective equipment selection</li>
                    </ul>
                </div>
                
                <div class="short-circuit-reduction-tips">
                    <h4><i class="fas fa-lightbulb"></i> Short Circuit Current Reduction Methods</h4>
                    <p>To reduce short circuit levels in industrial systems:</p>
                    <ul>
                        <li>Use higher impedance transformers</li>
                        <li>Implement current limiting reactors</li>
                        <li>Employ current limiting fuses or circuit breakers</li>
                        <li>Use transformers with separate secondary windings</li>
                        <li>Implement bus splitting schemes</li>
                        <li>Use generators with higher subtransient reactance</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/indexele'>Electrical Tools</a></li>
                        <li><a href='/indexmech'>Mechanical Tools</a></li>
                        <li><a href='/indexinst'>Instrumentation Tools</a></li>
                        <li><a href='/'>Home</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href='/privacy-policy'>Privacy Policy</a></li>
                        <li><a href='/terms-of-service'>Terms of Service</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>About</h4>
                    <ul>
                        <li><a href='/about'>About Us</a></li>
                        <li><a href='/contact'>Contact Us</a></li>
                        <li><a href='/faq'>FAQ</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <h4>Disclaimer</h4>
                <p>All tools are for guidance only and should not replace professional engineering judgment. Results must be verified by a qualified professional against project requirements and local codes.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box -->
    <div id="custom-message-box"></div>
    <script>
        // Complex number class for impedance calculations
        class Complex {
            constructor(real, imag) {
                this.re = real;
                this.im = imag;
            }
            add(other) {
                return new Complex(this.re + other.re, this.im + other.im);
            }
            subtract(other) {
                return new Complex(this.re - other.re, this.im - other.im);
            }
            multiply(other) {
                return new Complex(
                    this.re * other.re - this.im * other.im,
                    this.re * other.im + this.im * other.re
                );
            }
            divide(other) {
                const denominator = other.re * other.re + other.im * other.im;
                if (denominator === 0) {
                    return new Complex(1e12, 1e12); 
                }
                return new Complex(
                    (this.re * other.re + this.im * other.im) / denominator,
                    (this.im * other.re - this.re * other.im) / denominator
                );
            }
            magnitude() {
                return Math.sqrt(this.re * this.re + this.im * this.im);
            }
            angle() {
                return Math.atan2(this.im, this.re);
            }
            toString(fixed = 4) {
                const sign = this.im >= 0 ? '+' : '-';
                return `${this.re.toFixed(fixed)} ${sign} j${Math.abs(this.im).toFixed(fixed)}`;
            }
            toPolarString(fixed = 4) {
                const mag = this.magnitude();
                const ang = this.angle() * 180 / Math.PI;
                return `${mag.toFixed(fixed)} ∠ ${ang.toFixed(fixed)}°`;
            }
        }

        // Theme Switcher Logic
        const themeSwitch = document.getElementById('theme-switch');
        const body = document.body;
        const currentTheme = localStorage.getItem('theme');

        if (currentTheme) {
            body.classList.add(currentTheme);
            if (currentTheme === 'dark-mode') themeSwitch.checked = true;
        }

        themeSwitch.addEventListener('change', () => {
            if (themeSwitch.checked) {
                body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark-mode');
            } else {
                body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light-mode');
            }
        });

        // Calculator Logic
        const calculateBtn = document.getElementById('calculate-short-circuit-btn');
        const resultContainer = document.getElementById('result-container');
        const resultTableBody = document.getElementById('result-table-body');
        const detailedCalculationsDiv = document.getElementById('detailed-calculations');
        const loadingSpinner = document.getElementById('loading-spinner');
        
        // Set default values
        document.getElementById('system-voltage').value = 415;
        document.getElementById('transformer-kva').value = 1000;
        document.getElementById('transformer-impedance').value = 5.75;
        document.getElementById('utility-fault-mva').value = 500;
        document.getElementById('cable-length').value = 20;
        document.getElementById('cable-size').value = 185;
        document.getElementById('cable-material').value = 'copper';
        document.getElementById('fault-type').value = 'three-phase-symmetrical';
        document.getElementById('utility-xr-ratio').value = 10;
        document.getElementById('transformer-xr-ratio').value = 5;
        document.getElementById('transformer-connection-primary').value = 'delta';
        document.getElementById('transformer-connection-secondary').value = 'wye-grounded';
        document.getElementById('transformer-grounding-impedance').value = 0.001;
        document.getElementById('cable-xr-ratio').value = 1;
        document.getElementById('cable-temperature').value = 75;
        document.getElementById('motor-hp').value = 0;
        document.getElementById('motor-efficiency').value = 85;
        document.getElementById('motor-starting-pf').value = 0.3;
        document.getElementById('motor-subtransient-reactance').value = 0.2;

        calculateBtn.addEventListener('click', async function() {
            loadingSpinner.style.display = 'block';
            resultContainer.classList.remove('show');
            
            // Get input values
            const systemVoltage = parseFloat(document.getElementById('system-voltage').value);
            const faultType = document.getElementById('fault-type').value;
            const utilityFaultMVA = parseFloat(document.getElementById('utility-fault-mva').value);
            const utilityXRRatio = parseFloat(document.getElementById('utility-xr-ratio').value);
            const transformerKVA = parseFloat(document.getElementById('transformer-kva').value);
            const transformerImpedance = parseFloat(document.getElementById('transformer-impedance').value);
            const transformerXRRatio = parseFloat(document.getElementById('transformer-xr-ratio').value);
            const transformerPrimaryConn = document.getElementById('transformer-connection-primary').value;
            const transformerSecondaryConn = document.getElementById('transformer-connection-secondary').value;
            const transformerGroundingImpedance = parseFloat(document.getElementById('transformer-grounding-impedance').value);
            const cableLength = parseFloat(document.getElementById('cable-length').value);
            const cableSize = parseFloat(document.getElementById('cable-size').value);
            const cableMaterial = document.getElementById('cable-material').value;
            const cableXRRatio = parseFloat(document.getElementById('cable-xr-ratio').value);
            const cableTemperature = parseFloat(document.getElementById('cable-temperature').value);
            const motorHP = parseFloat(document.getElementById('motor-hp').value);
            const motorEfficiency = parseFloat(document.getElementById('motor-efficiency').value) / 100;
            const motorStartingPF = parseFloat(document.getElementById('motor-starting-pf').value);
            const motorSubtransientReactance = parseFloat(document.getElementById('motor-subtransient-reactance').value);

            // Input validation
            if (isNaN(systemVoltage) || isNaN(transformerKVA) || isNaN(transformerImpedance) || isNaN(utilityFaultMVA) || isNaN(cableLength) || isNaN(cableSize) || isNaN(utilityXRRatio) || isNaN(transformerXRRatio) || isNaN(cableXRRatio) || isNaN(cableTemperature) || isNaN(motorHP) || isNaN(motorEfficiency) || isNaN(motorStartingPF) || isNaN(motorSubtransientReactance)) {
                displayMessage("Please fill in all required fields with valid numbers.", "error");
                loadingSpinner.style.display = 'none';
                return;
            }
            if (systemVoltage <= 0 || transformerKVA <= 0 || transformerImpedance <= 0 || transformerImpedance > 20 || cableLength < 0 || cableSize <= 0 || utilityXRRatio <= 0 || transformerXRRatio <= 0 || cableXRRatio <= 0 || cableTemperature < 20 || motorEfficiency <=0) {
                displayMessage("Please ensure all inputs have valid positive values. Transformer impedance should be between 0.1 and 20.", "error");
                loadingSpinner.style.display = 'none';
                return;
            }
            
            // Clear previous results
            resultTableBody.innerHTML = '';
            detailedCalculationsDiv.innerHTML = '<h4><i class="fas fa-calculator"></i> Detailed Calculation Steps</h4>';
            resultContainer.style.display = 'none';

            // Base values
            const baseMVA = transformerKVA / 1000;
            const baseKV = systemVoltage / 1000;
            const Z_base_ohmic = Math.pow(baseKV, 2) / baseMVA;
            addDetailedCalculationStep(
                "Step 1: Calculate Base Impedance ($Z_{base}$)",
                `Formula: $Z_{\\text{base}} = \\frac{V_{\\text{base,kV}}^2}{\\text{MVA}_{\\text{base}}}$`,
                `Calculation: $Z_{\\text{base}} = \\frac{${baseKV.toFixed(3)}^2 \\text{ kV}^2}{${baseMVA.toFixed(3)} \\text{ MVA}} = ${Z_base_ohmic.toFixed(4)} \\Omega$`
            );
            
            // Utility impedance
            let Z1_utility_pu = new Complex(0, 0);
            let Z0_utility_pu = new Complex(0, 0);
            let utilityCalcText = "(Assumed infinite bus, $Z_{utility}=0$)";
            if (utilityFaultMVA > 0) {
                const X_utility_pu_mag = baseMVA / utilityFaultMVA;
                const R_utility_pu_mag = X_utility_pu_mag / utilityXRRatio;
                Z1_utility_pu = new Complex(R_utility_pu_mag, X_utility_pu_mag);
                Z0_utility_pu = new Complex(R_utility_pu_mag, X_utility_pu_mag);
                utilityCalcText = `$X_{\\text{utility,pu}} = \\frac{\\text{Base MVA}}{\\text{Utility Fault MVA}} = \\frac{${baseMVA.toFixed(3)}}{${utilityFaultMVA.toFixed(3)}} = ${X_utility_pu_mag.toFixed(4)}$<br>
                $R_{\\text{utility,pu}} = \\frac{X_{\\text{utility,pu}}}{X/R} = \\frac{${X_utility_pu_mag.toFixed(4)}}{${utilityXRRatio.toFixed(1)}} = ${R_utility_pu_mag.toFixed(4)}$<br>
                $Z_{1,utility,pu} = ${Z1_utility_pu.toString(4)}$`;
            }
            addDetailedCalculationStep( 
                "Step 2: Calculate Utility Impedance ($Z_{utility,pu}$)", 
                `Formula: $Z_{\\text{utility,pu}} = \\frac{\\text{Base MVA}}{\\text{Utility Fault MVA}}$`,
                utilityCalcText
            );

            // Transformer impedance
            const Z_transformer_pu_mag = transformerImpedance / 100;
            const angle_rad = Math.atan(transformerXRRatio);
            const X_transformer_pu = Z_transformer_pu_mag * Math.sin(angle_rad);
            const R_transformer_pu = Z_transformer_pu_mag * Math.cos(angle_rad);
            const Z1_transformer_pu = new Complex(R_transformer_pu, X_transformer_pu);
            
            let Z0_transformer_pu;
            let Zg_pu_complex = new Complex(0,0);
            
            // Zero sequence impedance based on transformer connection
            if (transformerPrimaryConn === 'delta' && transformerSecondaryConn === 'wye-grounded') { 
                Z0_transformer_pu = new Complex(R_transformer_pu, X_transformer_pu * 0.9); 
            } 
            else if (transformerPrimaryConn === 'wye-grounded' && transformerSecondaryConn === 'wye-grounded') { 
                Z0_transformer_pu = new Complex(R_transformer_pu, X_transformer_pu * 1.0); 
            } 
            else { 
                Z0_transformer_pu = new Complex(1e9, 1e9); // High impedance for ungrounded systems
            }
            
            // Add grounding impedance for Yg secondary
            if (transformerSecondaryConn === 'wye-grounded' && transformerGroundingImpedance > 0) {
                const Zg_ohmic = new Complex(transformerGroundingImpedance, 0);
                Zg_pu_complex = Zg_ohmic.divide(new Complex(Z_base_ohmic, 0));
                Z0_transformer_pu = Z0_transformer_pu.add(Zg_pu_complex.multiply(new Complex(3,0)));
            }
            
            addDetailedCalculationStep(
                "Step 3: Calculate Transformer Impedance ($Z_{transformer,pu}$)",
                `Formula: $Z_{\\text{transformer,pu}} = \\frac{\\%Z}{100}$, $R_{\\text{transformer,pu}} = Z_{\\text{transformer,pu}} \\cdot \\cos(\\tan^{-1}(X/R))$, $X_{\\text{transformer,pu}} = Z_{\\text{transformer,pu}} \\cdot \\sin(\\tan^{-1}(X/R))$`,
                `$Z_{\\text{transformer,pu}} = \\frac{${transformerImpedance.toFixed(2)}}{100} = ${Z_transformer_pu_mag.toFixed(4)}$<br>
                $R_{\\text{transformer,pu}} = ${Z_transformer_pu_mag.toFixed(4)} \\cdot \\cos(\\tan^{-1}(${transformerXRRatio.toFixed(1)})) = ${R_transformer_pu.toFixed(4)}$<br>
                $X_{\\text{transformer,pu}} = ${Z_transformer_pu_mag.toFixed(4)} \\cdot \\sin(\\tan^{-1}(${transformerXRRatio.toFixed(1)})) = ${X_transformer_pu.toFixed(4)}$<br>
                $Z_{1,transformer,pu} = ${Z1_transformer_pu.toString(4)}$<br>
                $Z_{0,transformer,pu} = ${Z0_transformer_pu.toString(4)}$`
            );

            // Cable impedance
            const resistivity20C = { copper: 0.0172, aluminum: 0.0282 };
            const alpha = cableMaterial === 'copper' ? 0.00393 : 0.00403;
            const R_cable_ohmic_20C = (resistivity20C[cableMaterial] * cableLength) / cableSize;
            const R_cable_ohmic = R_cable_ohmic_20C * (1 + alpha * (cableTemperature - 20));
            const X_cable_ohmic = R_cable_ohmic * cableXRRatio;
            const Z1_cable_ohmic = new Complex(R_cable_ohmic, X_cable_ohmic);
            const Z1_cable_pu = Z1_cable_ohmic.divide(new Complex(Z_base_ohmic, 0));
            const Z0_cable_ohmic = new Complex(R_cable_ohmic, X_cable_ohmic * 3); // Zero sequence reactance is typically 3x positive sequence
            const Z0_cable_pu = Z0_cable_ohmic.divide(new Complex(Z_base_ohmic, 0));
            
            addDetailedCalculationStep(
                "Step 4: Calculate Cable Impedance ($Z_{cable,pu}$)",
                `Formula: $R_{\\text{cable,20°C}} = \\frac{\\rho \\cdot L}{A}$, $R_{\\text{cable,T°C}} = R_{\\text{cable,20°C}} \\cdot [1 + \\alpha \\cdot (T - 20)]$, $X_{\\text{cable}} = R_{\\text{cable}} \\cdot (X/R)$`,
                `$R_{\\text{cable,20°C}} = \\frac{${resistivity20C[cableMaterial].toFixed(4)} \\cdot ${cableLength.toFixed(1)}}{${cableSize.toFixed(1)}} = ${R_cable_ohmic_20C.toFixed(6)} \\Omega$<br>
                $R_{\\text{cable,${cableTemperature}°C}} = ${R_cable_ohmic_20C.toFixed(6)} \\cdot [1 + ${alpha.toFixed(5)} \\cdot (${cableTemperature} - 20)] = ${R_cable_ohmic.toFixed(6)} \\Omega$<br>
                $X_{\\text{cable}} = ${R_cable_ohmic.toFixed(6)} \\cdot ${cableXRRatio.toFixed(1)} = ${X_cable_ohmic.toFixed(6)} \\Omega$<br>
                $Z_{1,cable,pu} = \\frac{${Z1_cable_ohmic.toString(6)}}{${Z_base_ohmic.toFixed(4)}} = ${Z1_cable_pu.toString(4)}$<br>
                $Z_{0,cable,pu} = \\frac{${Z0_cable_ohmic.toString(6)}}{${Z_base_ohmic.toFixed(4)}} = ${Z0_cable_pu.toString(4)}$`
            );

            // Motor impedance
            let Z1_motor_pu = new Complex(Infinity, Infinity);
            if (motorHP > 0) {
                const motorKVA = (motorHP * 0.746) / motorEfficiency;
                const motorBaseMVA = motorKVA / 1000;
                const Xd_motor_pu = motorSubtransientReactance * (baseMVA / motorBaseMVA);
                const R_motor_pu = Xd_motor_pu * Math.tan(Math.acos(motorStartingPF));
                Z1_motor_pu = new Complex(R_motor_pu, Xd_motor_pu);
                
                addDetailedCalculationStep(
                    "Step 5: Calculate Motor Impedance ($Z_{motor,pu}$)",
                    `Formula: $\\text{Motor kVA} = \\frac{\\text{HP} \\cdot 0.746}{\\text{Efficiency}}$, $X''_{d,pu} = X''_{d} \\cdot \\frac{\\text{Base MVA}}{\\text{Motor Base MVA}}$, $R_{\\text{motor,pu}} = X''_{d,pu} \\cdot \\tan(\\cos^{-1}(PF))$`,
                    `$\\text{Motor kVA} = \\frac{${motorHP.toFixed(0)} \\cdot 0.746}{${motorEfficiency.toFixed(2)}} = ${motorKVA.toFixed(2)} \\text{ kVA}$<br>
                    $X''_{d,pu} = ${motorSubtransientReactance.toFixed(2)} \\cdot \\frac{${baseMVA.toFixed(3)}}{${(motorKVA/1000).toFixed(3)}}} = ${Xd_motor_pu.toFixed(4)}$<br>
                    $R_{\\text{motor,pu}} = ${Xd_motor_pu.toFixed(4)} \\cdot \\tan(\\cos^{-1}(${motorStartingPF.toFixed(2)})) = ${R_motor_pu.toFixed(4)}$<br>
                    $Z_{1,motor,pu} = ${Z1_motor_pu.toString(4)}$`
                );
            } else {
                addDetailedCalculationStep(
                    "Step 5: Calculate Motor Impedance ($Z_{motor,pu}$)",
                    "No motor contribution specified",
                    "$Z_{1,motor,pu} = \\infty$ (No motor contribution)"
                );
            }

            // Total source impedance
            const Z1_total_source_path_pu = Z1_utility_pu.add(Z1_transformer_pu).add(Z1_cable_pu);
            const Z2_total_source_path_pu = Z1_total_source_path_pu;
            let Z0_total_source_path_pu = Z0_utility_pu.add(Z0_transformer_pu).add(Z0_cable_pu);
            
            addDetailedCalculationStep(
                "Step 6: Calculate Total Source Impedance ($Z_{total,source,pu}$)",
                "Formula: $Z_{1,total} = Z_{1,utility} + Z_{1,transformer} + Z_{1,cable}$, $Z_{2,total} = Z_{1,total}$, $Z_{0,total} = Z_{0,utility} + Z_{0,transformer} + Z_{0,cable}$",
                `$Z_{1,total,pu} = ${Z1_utility_pu.toString(4)} + ${Z1_transformer_pu.toString(4)} + ${Z1_cable_pu.toString(4)} = ${Z1_total_source_path_pu.toString(4)}$<br>
                $Z_{2,total,pu} = Z_{1,total,pu} = ${Z2_total_source_path_pu.toString(4)}$<br>
                $Z_{0,total,pu} = ${Z0_utility_pu.toString(4)} + ${Z0_transformer_pu.toString(4)} + ${Z0_cable_pu.toString(4)} = ${Z0_total_source_path_pu.toString(4)}$`
            );

            // Base current
            const I_base = (baseMVA * 1000) / (Math.sqrt(3) * baseKV);
            addDetailedCalculationStep(
                "Step 7: Calculate Base Current ($I_{base}$)",
                `Formula: $I_{\\text{base}} = \\frac{\\text{Base MVA} \\cdot 1000}{\\sqrt{3} \\cdot V_{\\text{base,kV}}}$`,
                `$I_{\\text{base}} = \\frac{${baseMVA.toFixed(3)} \\cdot 1000}{\\sqrt{3} \\cdot ${baseKV.toFixed(3)}} = ${I_base.toFixed(2)} \\text{ A}$`
            );

            // Fault current calculation based on fault type
            let faultCurrent = 0;
            let calculationDetails = '';
            let faultCurrentSym = 0;
            let faultCurrentAsym = 0;
            let dcOffset = 0;
            let peakCurrent = 0;
            
            if (faultType === 'three-phase-symmetrical') {
                let effective_Z1_pu = Z1_total_source_path_pu;
                if (motorHP > 0) {
                     effective_Z1_pu = Z1_total_source_path_pu.multiply(Z1_motor_pu).divide(Z1_total_source_path_pu.add(Z1_motor_pu));
                }
                faultCurrent = I_base / effective_Z1_pu.magnitude();
                faultCurrentSym = faultCurrent;
                
                // Calculate asymmetrical current (including DC offset)
                const XR_total = effective_Z1_pu.im / effective_Z1_pu.re;
                dcOffset = Math.sqrt(2) * faultCurrent * Math.exp(-2 * Math.PI * 0.5 / XR_total); // Assuming 0.5 cycles
                faultCurrentAsym = Math.sqrt(Math.pow(faultCurrent, 2) + Math.pow(dcOffset, 2));
                peakCurrent = Math.sqrt(2) * faultCurrent + dcOffset;
                
                calculationDetails = `$I_{\\text{3PH}} = \\frac{I_{\\text{base}}}{Z_{1,\\text{total}}} = \\frac{${I_base.toFixed(2)} \\text{ A}}{${effective_Z1_pu.magnitude().toFixed(4)}} = ${faultCurrent.toFixed(2)} \\text{ A}$<br>
                $I_{\\text{peak}} = \\sqrt{2} \\cdot I_{\\text{3PH}} + I_{\\text{DC}} = \\sqrt{2} \\cdot ${faultCurrent.toFixed(2)} + ${dcOffset.toFixed(2)} = ${peakCurrent.toFixed(2)} \\text{ A}$`;
                
                addDetailedCalculationStep(
                    "Step 8: Calculate 3-Phase Fault Current ($I_{3PH}$)",
                    "Formula: $I_{\\text{3PH}} = \\frac{I_{\\text{base}}}{Z_{1,\\text{total}}}$, $I_{\\text{DC}} = \\sqrt{2} \\cdot I_{\\text{3PH}} \\cdot e^{-2\\pi f t / (X/R)}$, $I_{\\text{peak}} = \\sqrt{2} \\cdot I_{\\text{3PH}} + I_{\\text{DC}}$",
                    calculationDetails
                );
                
                addResultRow("Three-Phase Symmetrical Fault Current", faultCurrentSym.toFixed(2) + " A");
                addResultRow("DC Offset Current (at 0.5 cycles)", dcOffset.toFixed(2) + " A");
                addResultRow("Asymmetrical Fault Current", faultCurrentAsym.toFixed(2) + " A");
                addResultRow("Peak Fault Current", peakCurrent.toFixed(2) + " A");
                addResultRow("Fault MVA", (Math.sqrt(3) * systemVoltage * faultCurrent / 1000000).toFixed(2) + " MVA");
            } else if (faultType === 'single-line-to-ground') {
                // SLG fault calculation
                const Z_total = Z1_total_source_path_pu.add(Z2_total_source_path_pu).add(Z0_total_source_path_pu);
                faultCurrent = (3 * I_base) / Z_total.magnitude();
                calculationDetails = `$I_{\\text{SLG}} = \\frac{3 \\cdot I_{\\text{base}}}{Z_{1} + Z_{2} + Z_{0}} = \\frac{3 \\cdot ${I_base.toFixed(2)}}{${Z_total.magnitude().toFixed(4)}} = ${faultCurrent.toFixed(2)} \\text{ A}$`;
                
                addDetailedCalculationStep(
                    "Step 8: Calculate Single-Line-to-Ground Fault Current ($I_{SLG}$)",
                    "Formula: $I_{\\text{SLG}} = \\frac{3 \\cdot I_{\\text{base}}}{Z_{1} + Z_{2} + Z_{0}}$",
                    calculationDetails
                );
                
                addResultRow("Single-Line-to-Ground Fault Current", faultCurrent.toFixed(2) + " A");
            } else if (faultType === 'line-to-line') {
                // LL fault calculation
                const Z_total = Z1_total_source_path_pu.add(Z2_total_source_path_pu);
                faultCurrent = (Math.sqrt(3) * I_base) / (2 * Z_total.magnitude());
                calculationDetails = `$I_{\\text{LL}} = \\frac{\\sqrt{3} \\cdot I_{\\text{base}}}{2 \\cdot Z_{1}} = \\frac{\\sqrt{3} \\cdot ${I_base.toFixed(2)}}{2 \\cdot ${Z1_total_source_path_pu.magnitude().toFixed(4)}} = ${faultCurrent.toFixed(2)} \\text{ A}$`;
                
                addDetailedCalculationStep(
                    "Step 8: Calculate Line-to-Line Fault Current ($I_{LL}$)",
                    "Formula: $I_{\\text{LL}} = \\frac{\\sqrt{3} \\cdot I_{\\text{base}}}{2 \\cdot Z_{1}}$",
                    calculationDetails
                );
                
                addResultRow("Line-to-Line Fault Current", faultCurrent.toFixed(2) + " A");
            } else if (faultType === 'double-line-to-ground') {
                // DLG fault calculation
                const Z_parallel = Z2_total_source_path_pu.multiply(Z0_total_source_path_pu).divide(Z2_total_source_path_pu.add(Z0_total_source_path_pu));
                const Z_total = Z1_total_source_path_pu.add(Z_parallel);
                faultCurrent = I_base / Z_total.magnitude();
                calculationDetails = `$I_{\\text{DLG}} = \\frac{I_{\\text{base}}}{Z_{1} + \\frac{Z_{2} \\cdot Z_{0}}{Z_{2} + Z_{0}}} = \\frac{${I_base.toFixed(2)}}{${Z_total.magnitude().toFixed(4)}} = ${faultCurrent.toFixed(2)} \\text{ A}$`;
                
                addDetailedCalculationStep(
                    "Step 8: Calculate Double-Line-to-Ground Fault Current ($I_{DLG}$)",
                    "Formula: $I_{\\text{DLG}} = \\frac{I_{\\text{base}}}{Z_{1} + \\frac{Z_{2} \\cdot Z_{0}}{Z_{2} + Z_{0}}}$",
                    calculationDetails
                );
                
                addResultRow("Double-Line-to-Ground Fault Current", faultCurrent.toFixed(2) + " A");
            }
            
            // Add additional results
            addResultRow("Base Current", I_base.toFixed(2) + " A");
            addResultRow("Base Impedance", Z_base_ohmic.toFixed(4) + " Ω");
            addResultRow("Total Positive Sequence Impedance", Z1_total_source_path_pu.toPolarString(4));
            addResultRow("Total Negative Sequence Impedance", Z2_total_source_path_pu.toPolarString(4));
            addResultRow("Total Zero Sequence Impedance", Z0_total_source_path_pu.toPolarString(4));
            
            // Show results
            loadingSpinner.style.display = 'none';
            resultContainer.style.display = 'block';
            resultContainer.classList.add('show');
            
            // Re-render MathJax
            if (window.MathJax) {
                setTimeout(() => { 
                    window.MathJax.typesetPromise([detailedCalculationsDiv]); 
                }, 100);
            }
        });

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('custom-message-box');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'custom-message-box';
                document.body.appendChild(messageBox);
            }
            messageBox.textContent = message;
            messageBox.style.backgroundColor = type === "error" ? '#dc3545' : '#28a745';
            messageBox.style.opacity = 1;
            setTimeout(() => { messageBox.style.opacity = 0; }, 5000);
        }

        function addResultRow(parameter, value) {
            const row = document.createElement('tr');
            const paramCell = document.createElement('td');
            paramCell.textContent = parameter;
            paramCell.style.fontWeight = '500';
            const valueCell = document.createElement('td');
            valueCell.textContent = value;
            valueCell.style.fontWeight = '600';
            valueCell.style.color = 'var(--primary-color)';
            row.appendChild(paramCell);
            row.appendChild(valueCell);
            resultTableBody.appendChild(row);
        }

        function addDetailedCalculationStep(stepTitle, formulaText, calculationText) {
            const stepDiv = document.createElement('div');
            stepDiv.classList.add('calculation-step');
            
            const titleElem = document.createElement('h5');
            titleElem.style.fontWeight = '600';
            titleElem.style.marginBottom = '10px';
            titleElem.style.color = 'var(--heading-color)';
            titleElem.textContent = stepTitle;
            stepDiv.appendChild(titleElem);
            
            if (formulaText) {
                const formulaElem = document.createElement('div');
                formulaElem.classList.add('formula');
                formulaElem.innerHTML = formulaText;
                stepDiv.appendChild(formulaElem);
            }
            
            if (calculationText) {
                const calcElem = document.createElement('div');
                calcElem.style.marginTop = '10px';
                calcElem.innerHTML = calculationText;
                stepDiv.appendChild(calcElem);
            }
            
            detailedCalculationsDiv.appendChild(stepDiv);
        }
    </script>
</body>
</html>

