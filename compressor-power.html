<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compressor Power Calculator - Industrial Grade</title>
    <meta name="description" content="Professional Compressor Power Calculator. Calculate Adiabatic and Polytropic Head, Discharge Temperature, and Brake Horsepower. Supports Air, Natural Gas, and Custom Gases with compressibility factor correction.">
    <meta name="keywords" content="compressor calculator, adiabatic power, polytropic head, brake horsepower, discharge temperature, isentropic efficiency, gas compression, natural gas compressor, air compressor sizing">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Quick Load Buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .highlight { color: var(--success); font-weight: 700; }
        .danger-text { color: var(--danger); font-weight: 700; }

        /* Calculation Steps Styling */
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(37, 99, 235, 0.05); /* Light Blue Tint */
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(37, 99, 235, 0.1); }
        
        .calculation-step h4 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 5px;
        }

        /* Canvas Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Educational Section Styling */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .insight-card p, .insight-card ul {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text);
        }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }

        /* Vector Input Group Styling (Reused) */
        .vector-input-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Print Styling */
        @media print {
            header, footer, .education-section, .theme-toggle, .button-wrapper, .preset-container { display: none !important; }
            .card { border: none; shadow: none; padding: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 300px; page-break-inside: avoid; }
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='index.html'>Home</a></li>
                    <li><a href="articles.html">Articles</a></li>
                    <li><a href="indexmech.html">Mechanical</a></li>
                    <li><a href="indexele.html">Electrical</a></li>
                    <li><a href="indexinst.html">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-wind"></i> Compressor Power & Head Calculator</h2>
            
            <div class="tool-description">
                <p>This commercial-grade calculator solves the thermodynamics of gas compression. It calculates <strong>Polytropic/Adiabatic Head</strong>, <strong>Discharge Temperature</strong>, and the <strong>Brake Horsepower (BHP)</strong> required at the shaft. Essential for sizing compressors (Centrifugal, Reciprocating) and evaluating efficiency.</p>
            </div>

            <div class="calculator-form">
                <form id="compressor-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('shop_air')"><i class="fas fa-tools"></i> Shop Air (7 bar)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('nat_gas_boost')"><i class="fas fa-fire"></i> Natural Gas Booster</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('nitrogen')"><i class="fas fa-flask"></i> Nitrogen Feed</button>
                            </div>
                        </div>
                    </div>

                    <!-- Gas Properties -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. Gas Properties</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-atom"></i> Molecular Data</div>
                            <div class="form-group">
                                <label for="gas-type">Gas Selection</label>
                                <select id="gas-type" onchange="updateGas()">
                                    <option value="air" selected>Air (MW=28.97, k=1.4)</option>
                                    <option value="methane">Methane (MW=16.04, k=1.3)</option>
                                    <option value="propane">Propane (MW=44.1, k=1.13)</option>
                                    <option value="nitrogen">Nitrogen (MW=28.0, k=1.4)</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="mol-weight">Mol Weight (MW) [g/mol]</label>
                                <input type="number" id="mol-weight" value="28.97" step="0.01">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="k-ratio">Specific Heat Ratio (k) [Cp/Cv]</label>
                                <input type="number" id="k-ratio" value="1.4" step="0.01">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-cogs"></i> Process Type</div>
                            <div class="form-group">
                                <label for="process-type">Compression Model</label>
                                <select id="process-type">
                                    <option value="adiabatic" selected>Adiabatic (Isentropic)</option>
                                    <option value="polytropic">Polytropic (Real)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="n-exp">Polytropic Exp (n) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Usually between 1.0 and k. Typical: 1.35 for Air.</span></span></label>
                                <input type="number" id="n-exp" value="1.35" step="0.01">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="z-avg">Compressibility (Z_avg) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Average Z factor [(Z1+Z2)/2]. Use 1.0 for low pressure.</span></span></label>
                                <input type="number" id="z-avg" value="1.0" step="0.01">
                            </div>
                        </div>
                    </div>

                    <!-- Conditions -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Operating Conditions</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-tachometer-alt"></i> Inlet/Outlet</div>
                            <div class="form-group">
                                <label for="p1">Inlet Pressure ($P_1$) [bar(a)]</label>
                                <input type="number" id="p1" value="1.0" step="0.1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="t1">Inlet Temp ($T_1$) [°C]</label>
                                <input type="number" id="t1" value="20" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="p2">Discharge Pressure ($P_2$) [bar(a)]</label>
                                <input type="number" id="p2" value="8.0" step="0.1">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-wind"></i> Capacity & Efficiency</div>
                            <div class="form-group">
                                <label for="flow-rate">Inlet Flow ($Q_1$) [m³/h]</label>
                                <input type="number" id="flow-rate" value="1000" step="10">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="eff-isen">Adiabatic/Poly Efficiency ($\eta$) [%]</label>
                                <input type="number" id="eff-isen" value="75" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="eff-mech">Mechanical Efficiency ($\eta_m$) [%]</label>
                                <input type="number" id="eff-mech" value="95" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Power</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download Datasheet</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Performance Analysis</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Output Metrics</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Unit</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-info-circle"></i> Insight:</strong>
                            <div id="interpretation-text" style="margin-top: 5px; font-size: 0.95rem;"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Compression Cycle (P-V Diagram)</h4>
                        <div class="chart-container">
                            <canvas id="pvChart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                            <span style="color: #3B82F6;">● Compression Curve</span> &nbsp;
                            <span style="color: #EF4444;">● Work Area</span>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Head calculation using GPSA Engineering Data Book method. $Power = \dot{m} \times Head / \eta$.
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (MASSIVE) -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: Compressor Thermodynamics</h2>
            
            <!-- Insight 1: Compression Process -->
            <div class="insight-card">
                <h4><i class="fas fa-compress-arrows-alt"></i> 1. Adiabatic vs. Polytropic</h4>
                <p>Compression adds energy to the gas.
                <ul>
                    <li><strong>Adiabatic (Isentropic):</strong> Assumes perfect insulation (no heat loss) and reversible process. $PV^k = C$. Used as the reference for efficiency. Real compressors are never truly adiabatic because of friction and turbulence.</li>
                    <li><strong>Polytropic:</strong> The real-world process. Includes heat transfer and friction. $PV^n = C$. The exponent $n$ is determined experimentally. Typically $1 < n < k$ if cooled, or $n > k$ if irreversible losses dominate.</li>
                </ul>
                </p>
            </div>

            <!-- Insight 2: Discharge Temperature -->
            <div class="insight-card">
                <h4><i class="fas fa-thermometer-full"></i> 2. The Danger of Discharge Temp ($T_2$)</h4>
                <p>Compressing gas creates heat. The theoretical discharge temperature is:
                $$ T_2 = T_1 \left( \frac{P_2}{P_1} \right)^{\frac{n-1}{n}} $$
                If $T_2$ exceeds 150-160°C, lubricating oil can break down or carbonize, and seals can fail. This sets the limit for the compression ratio per stage (usually max 3:1 or 4:1). If calculation shows $T_2 > 150^\circ C$, you need multi-stage compression with intercooling.</p>
            </div>

            <!-- Insight 3: Mass Flow -->
            <div class="insight-card">
                <h4><i class="fas fa-weight-hanging"></i> 3. Mass Flow vs Volumetric Flow</h4>
                <p>Compressors are sized by inlet volume ($m^3/h$), but the work done depends on Mass ($\dot{m}$).
                <br>$\dot{m} = \rho_1 \times Q_1$.
                <br>Since $\rho_1 \propto P_1 / T_1$, a hot summer day (High $T_1$) reduces the mass flow capability of the machine, while a cold day increases it (and power demand!). This calculator derives mass flow internally.</p>
            </div>

            <!-- Insight 4: Power Calculation -->
            <div class="insight-card">
                <h4><i class="fas fa-bolt"></i> 4. Brake Horsepower (BHP)</h4>
                <p>The <strong>Gas Power (GHP)</strong> is the energy added to the gas.
                <br>The <strong>Brake Power (BHP)</strong> is what the motor must deliver to the shaft.
                <br>$BHP = GHP / \eta_{mech}$.
                <br>Mechanical losses (bearings, gears, seals) typically consume 2-5% of the power. This tool separates Gas Efficiency (Aerodynamic) from Mechanical Efficiency.</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Empowering engineers with precision tools for complex analysis. If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele.html">Electrical</a></li>
                        <li><a href="indexmech.html">Mechanical</a></li>
                        <li><a href="indexinst.html">Instrumentation</a></li>
                        <li><a href="articles.html">Articles</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles.html'>Articles & Whitepapers</a></li>
                        <li><a href="sitemap2.html">Sitemap</a></li>                        
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to API 617, API 618). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let pvChart = null;
        let lastResult = null;

        // Gas Constants
        const R_u = 8314.46; // J/(kmol K)
        const gases = {
            'air': { mw: 28.97, k: 1.40 },
            'methane': { mw: 16.04, k: 1.30 },
            'propane': { mw: 44.10, k: 1.13 },
            'nitrogen': { mw: 28.01, k: 1.40 }
        };

        function updateGas() {
            const key = document.getElementById('gas-type').value;
            if(key !== 'custom') {
                document.getElementById('mol-weight').value = gases[key].mw;
                document.getElementById('k-ratio').value = gases[key].k;
            }
        }

        function loadPreset(type) {
            if (type === 'shop_air') {
                document.getElementById('gas-type').value = 'air';
                updateGas();
                document.getElementById('p1').value = '1.0';
                document.getElementById('p2').value = '8.0'; // 7 bar g -> 8 bar a
                document.getElementById('t1').value = '25';
                document.getElementById('flow-rate').value = '500';
            } else if (type === 'nat_gas_boost') {
                document.getElementById('gas-type').value = 'methane';
                updateGas();
                document.getElementById('p1').value = '20.0';
                document.getElementById('p2').value = '50.0';
                document.getElementById('t1').value = '40';
                document.getElementById('flow-rate').value = '5000';
                document.getElementById('z-avg').value = '0.92';
            } else if (type === 'nitrogen') {
                document.getElementById('gas-type').value = 'nitrogen';
                updateGas();
                document.getElementById('p1').value = '5.0';
                document.getElementById('p2').value = '30.0';
                document.getElementById('flow-rate').value = '2000';
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Theme handling
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function performCalculation() {
            // 1. Get Inputs
            const mode = document.getElementById('process-type').value;
            const mw = parseFloat(document.getElementById('mol-weight').value);
            const k = parseFloat(document.getElementById('k-ratio').value);
            const n_poly = parseFloat(document.getElementById('n-exp').value);
            const z_avg = parseFloat(document.getElementById('z-avg').value);
            
            const p1 = parseFloat(document.getElementById('p1').value); // bar a
            const t1_c = parseFloat(document.getElementById('t1').value); // C
            const p2 = parseFloat(document.getElementById('p2').value); // bar a
            
            const q1_m3h = parseFloat(document.getElementById('flow-rate').value); // m3/h
            const eta_isen = parseFloat(document.getElementById('eff-isen').value) / 100;
            const eta_mech = parseFloat(document.getElementById('eff-mech').value) / 100;

            if (isNaN(p1) || isNaN(p2) || p1 <= 0 || p2 <= p1) {
                displayMessage("Invalid pressures. P2 must be > P1.", "error");
                return;
            }

            // 2. Physics Engine
            const t1_k = t1_c + 273.15;
            const p1_kpa = p1 * 100;
            const p2_kpa = p2 * 100;
            const r_p = p2 / p1; // Pressure Ratio

            // Exponent n or k
            const exponent = (mode === 'adiabatic') ? k : n_poly;
            const m_exp = (exponent - 1) / exponent;

            // Mass Flow (kg/h) -> kg/s
            // rho1 = P1 / (Z R T)
            const R_specific = R_u / mw; // J/kgK
            const rho1 = (p1_kpa * 1000) / (z_avg * R_specific * t1_k); // kg/m3 (Using Z at inlet approx Z_avg)
            const m_dot = (q1_m3h * rho1) / 3600; // kg/s

            // Discharge Temp T2
            const t2_k = t1_k * Math.pow(r_p, m_exp);
            const t2_c = t2_k - 273.15;

            // Head Calculation (kJ/kg)
            // Head = [Z R T1 / (n-1/n)] * [ (P2/P1)^((n-1)/n) - 1 ]
            // Note: R_specific is J/kgK. Result in J/kg. Divide by 1000 for kJ/kg.
            const head_j_kg = (z_avg * R_specific * t1_k / m_exp) * (Math.pow(r_p, m_exp) - 1);
            
            // Gas Power (kW) = m_dot * Head / eta_isen
            const p_gas = (m_dot * head_j_kg) / (eta_isen * 1000); // kW
            
            // Brake Power (kW) = P_gas / eta_mech
            const p_brake = p_gas / eta_mech;

            lastResult = { p_brake, t2_c, head_j_kg, rho1, m_dot, r_p, exponent, mode, p1, p2, t1_k };

            // 4. Render Step-by-Step
            let html = `<h4>Step 1: Gas Properties & Mass Flow</h4>`;
            html += `<div class="calculation-step">`;
            html += `Density $\\rho_1 = \\frac{P_1}{Z R_{sp} T_1} = \\frac{${p1_kpa} \\cdot 10^3}{${z_avg} \\cdot ${R_specific.toFixed(1)} \\cdot ${t1_k.toFixed(1)}} = \\mathbf{${rho1.toFixed(3)} \\text{ kg/m}^3}$<br>`;
            html += `Mass Flow $\\dot{m} = Q_1 \\cdot \\rho_1 = \\frac{${q1_m3h}}{3600} \\cdot ${rho1.toFixed(3)} = \\mathbf{${m_dot.toFixed(3)} \\text{ kg/s}}$`;
            html += `</div>`;

            html += `<h4>Step 2: Discharge Temperature ($T_2$)</h4>`;
            html += `<div class="calculation-step">`;
            html += `Pressure Ratio $r_p = ${r_p.toFixed(2)}$. Exponent $\\frac{n-1}{n} = ${m_exp.toFixed(3)}$.<br>`;
            html += `$$ T_2 = T_1 (r_p)^{\\frac{n-1}{n}} = ${t1_k.toFixed(1)} (${r_p.toFixed(2)})^{${m_exp.toFixed(3)}} = \\mathbf{${t2_k.toFixed(1)} \\text{ K}} \\; (${t2_c.toFixed(1)} ^\\circ\\text{C}) $$`;
            html += `</div>`;

            html += `<h4>Step 3: Head & Power</h4>`;
            html += `<div class="calculation-step">`;
            html += `$$ \\text{Head} = \\frac{Z R T_1}{\\sigma} [r_p^\\sigma - 1] = \\mathbf{${(head_j_kg/1000).toFixed(2)} \\text{ kJ/kg}} $$<br>`;
            html += `Gas Power $P_{gas} = \\frac{\\dot{m} \\cdot \\text{Head}}{\\eta_{poly}} = \\frac{${m_dot.toFixed(2)} \\cdot ${(head_j_kg/1000).toFixed(2)}}{${eta_isen}} = ${p_gas.toFixed(1)} \\text{ kW}$<br>`;
            html += `$$ P_{brake} = \\frac{P_{gas}}{\\eta_{mech}} = \\mathbf{${p_brake.toFixed(1)} \\text{ kW}} $$`;
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;

            // 5. Update Table
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, u, c="") => {
                tbody.innerHTML += `<tr style="${c ? 'color:'+c : ''}"><td><strong>${n}</strong></td><td>${v}</td><td>${u}</td></tr>`;
            };
            addRow("Brake Power", p_brake.toFixed(2), "kW", "var(--primary)");
            addRow("Discharge Temp", t2_c.toFixed(1), "°C", t2_c > 150 ? "var(--danger)" : "var(--success)");
            addRow("Head", (head_j_kg/1000).toFixed(2), "kJ/kg");
            addRow("Mass Flow", (m_dot*3600).toFixed(0), "kg/h");

            const interpEl = document.getElementById('interpretation-text');
            if (t2_c > 160) {
                interpEl.innerHTML = `<span style="color:var(--danger); font-weight:bold;">High Discharge Temp!</span> Oil breakdown risk. Consider Multi-stage.`;
            } else {
                interpEl.innerHTML = `<span class="highlight">Optimal Operation.</span> Discharge temp is safe.`;
            }

            // 6. Draw Chart
            drawChart(p1, p2, 1/rho1, exponent);

            // 7. Show
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        function drawChart(p1, p2, v1, n) {
            const ctx = document.getElementById('pvChart').getContext('2d');
            if (pvChart) pvChart.destroy();

            const dataPoints = [];
            // PV^n = C -> P = C / V^n
            // V2 = V1 * (P1/P2)^(1/n)
            const v2 = v1 * Math.pow(p1/p2, 1/n);
            const C_const = p1 * Math.pow(v1, n);

            // Plot curve from v2 to v1
            const step = (v1 - v2) / 20;
            for(let v = v2; v <= v1; v += step) {
                const p = C_const / Math.pow(v, n);
                dataPoints.push({x: v, y: p});
            }

            pvChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Compression Path',
                        data: dataPoints,
                        borderColor: '#3B82F6',
                        borderWidth: 3,
                        pointRadius: 0,
                        fill: true,
                        backgroundColor: 'rgba(59, 130, 246, 0.1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'linear', title: {display:true, text:'Specific Volume (m³/kg)'} },
                        y: { title: {display:true, text:'Pressure (bar)'} }
                    }
                }
            });
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(30, 58, 138); 
            pdf.text('Compressor Power Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. Design Inputs', 14, y);
            y += 5;

            const inputData = [
                ['Inlet Pressure', `${lastResult.p1} bar(a)`],
                ['Discharge Pressure', `${lastResult.p2} bar(a)`],
                ['Inlet Temp', `${(lastResult.t1_k-273.15).toFixed(1)} °C`],
                ['Ratio (Cp/Cv or n)', `${lastResult.exponent}`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. Performance Data', 14, y);
            y += 5;

            const resData = [
                ['Brake Power', `${lastResult.p_brake.toFixed(2)} kW`],
                ['Discharge Temp', `${lastResult.t2_c.toFixed(1)} °C`],
                ['Polytropic Head', `${(lastResult.head_j_kg/1000).toFixed(2)} kJ/kg`],
                ['Pressure Ratio', `${lastResult.r_p.toFixed(2)}`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] },
                didParseCell: function(data) {
                    if(data.row.index === 0) {
                        data.cell.styles.fontStyle = 'bold';
                    }
                }
            });

            pdf.save('Compressor_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }
    </script>
</body>
</html>
