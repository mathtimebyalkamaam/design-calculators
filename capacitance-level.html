<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitance Level Sensor Calculator - Design Calculators - Instrumentation</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional calculator for designing and calibrating capacitance level sensors. Calculate level from capacitance or theoretical capacitance from dimensions, considering probe insulation and dielectric constants.">
    <meta name="keywords" content="capacitance level sensor, capacitance calculator, dielectric constant, level measurement, probe design, instrumentation, lrv urv">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/capacitance-level.html" />

    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for Formulas -->
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['\\(', '\\)'], ['$', '$']],
            displayMath: [['\\[', '\\]'], ['$$', '$$']]
        },
        svg: { fontCache: 'global' },
        options: {
            processHtmlClass: 'math-content', // Process elements with this class
            ignoreHtmlClass: 'no-mathjax' // Ignore elements with this class
        }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- PDF Generation (Included from header file, but not used by this specific tool) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- New CSS from attached file -->
    <style>
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        /* Applied to the tool container */
        .tool-container {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .tool-description {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.05rem;
        }
        h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 20px;
            position: relative; /* For unit display */
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
        }
        /* Style for inputs with selects */
        .form-group.input-with-select input {
             padding-right: 75px; /* Space for the select */
        }
        .form-group .unit-select, .form-group .unit-span {
            position: absolute;
            right: 2px;
            top: 31px; /* Aligns with label */
            height: calc(100% - 31px);
            border: none;
            background: var(--border);
            color: var(--text);
            border-radius: 0 6px 6px 0;
            padding: 0 10px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .form-group .unit-span {
             display: inline-flex;
             align-items: center;
             padding: 0 15px;
             height: 48px;
             top: 31px;
             background-color: var(--bg);
             border-left: 1px solid var(--border);
             border-radius: 0 6px 6px 0;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .calculator-form {
            /* Using .tool-container styles */
        }
        .form-section {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        .form-section h3 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none; /* For back-button */
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        .btn-group .btn {
            flex: 1;
            min-width: 150px;
        }
        .btn.secondary {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn.accent {
            background: var(--accent);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        /* Back button specific style */
        .back-button {
            width: fit-content;
            padding: 12px 20px;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        /* CALCULATION STEPS DISPLAY */
        .steps-container {
            display: none;
            margin-top: 30px;
        }
        .steps-container.active {
            display: block;
        }
        .step-card {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box; /* v6 */
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px; /* Spacing between cards */
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: block; /* Changed from flex */
        }
        .step-card h4::after {
            content: "";
            display: table;
            clear: both;
        }
        .step-card .number {
            float: left; /* Changed to float */
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            /* Removed flex-shrink */
        }
        .step-content {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box; /* v6 */
            display: grid;
            grid-template-columns: 1fr !important;
            gap: 25px;
            align-items: start;
        }
        .step-content > * { min-width: 0; }
        .step-content .formula-block {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid var(--border);
        }
        .step-content .formula-block p {
            margin-top: 0;
        }
        .step-content .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            border-radius: 4px;
        }
        .step-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
            line-height: 1.2;
            word-break: break-all;
        }
        .step-unit {
            font-size: 1rem;
            color: var(--text);
            opacity: 0.8;
            font-weight: 500;
            margin-left: 5px;
        }
        .step-explanation {
            font-size: 1.05rem;
            line-height: 1.8;
        }
        .step-explanation ul {
            padding-left: 20px;
        }
        .step-explanation li {
            margin-bottom: 8px;
        }

        /* Results Summary */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th,
        .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) {
            background-color: var(--bg);
        }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .results-table .highlight {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--success);
        }
        .results-table .warning {
            font-weight: 700;
            color: var(--warning);
        }
        .results-table .error {
            font-weight: 700;
            color: var(--danger);
        }
        
        /* Status Display */
        .range-status-display {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.5s, color 0.5s;
            text-align: center;
        } 
        .range-status-display.ok {
            background-color: var(--success);
            color: white;
        } 
        .range-status-display.error {
            background-color: var(--danger);
            color: white;
        } 
        .range-status-display.warning {
            background-color: var(--warning);
            color: #333;
        }
        .range-status-display.adequate { /* New status */
            background-color: var(--primary);
            color: white;
        }
        .range-status-display.marginal { /* New status */
            background-color: var(--accent);
            color: #333;
        }


        /* Educational Section */
        .education-section {
            margin-top: 60px;
        }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i {
            font-size: 1.5rem;
        }
        .insight-card p {
            margin: 10px 0;
            line-height: 1.8;
        }
        .insight-card ol,
        .insight-card ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .insight-card li {
            margin-bottom: 10px;
        }
        .stat-highlight {
            display: inline-block;
            background: var(--accent);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin: 0 4px;
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 {
            color: var(--danger);
            margin-top: 0;
        }
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h4 {
            color: var(--success);
            margin-top: 0;
        }


        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col li {
            margin-bottom: 8px; /* Added for spacing */
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .btn-group { flex-direction: column; }
        }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 5px;
            cursor: help;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Adjusted width */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-family: 'Inter', sans-serif; /* Professional font */
            font-size: 0.85rem; /* Slightly smaller font size */
            line-height: 1.4; /* Better readability */
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }
    </style>
    <link rel="stylesheet" href="styles.css">
    <meta property="og:title" content="Capacitance Level Sensor Calculator - Design Calculators - Instrumentation">
    <meta property="og:description" content="Professional calculator for designing and calibrating capacitance level sensors. Calculate level from capacitance or theoretical capacitance from dimensions, considering probe insulation and dielectric constants.">
</head>
<body>
    <!-- New Message Box HTML -->
    <div id="message-box" class="message-box"></div>

    <!-- New Header from file.txt -->
    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <!-- Back Button - Styled as a .btn -->
        <a class='btn back-button' href='/indexinst.html'><i class="fas fa-arrow-left"></i> Back to Tools</a>
                
        <div class="tool-container">
            <h2><i class="fas fa-battery-half"></i> Capacitance Level Sensor Calculator</h2>
                        
            <div class="tool-description">
                <p>This calculator assists in the design and calibration of capacitance level sensors. It can calculate theoretical capacitance values based on probe and tank geometry, or determine liquid level from measured capacitance, considering dielectric properties of the media.</p>
            </div>
                    
            <div class="calculator-form">
                <form id="capacitance-calculator-form">
                    <!-- Calculation Mode Selection -->
                    <div class="form-section">
                        <h3><i class="fas fa-sliders-h"></i> Calculation Mode</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="calculation-mode">Select Calculation Type</label>
                                <select id="calculation-mode" required>
                                    <option value="level-from-c">Calculate Level from Measured Capacitance</option>
                                    <option value="capacitance-from-dimensions">Calculate Capacitance from Dimensions</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Common Parameters for both modes -->
                    <div class="form-section" id="common-parameters">
                        <h3><i class="fas fa-ruler-combined"></i> Common Parameters</h3>
                        <div class="form-row">
                            <div class="form-group input-with-select">
                                <label for="probe-length">Probe Length (L)</label>
                                <input type="number" id="probe-length" step="any" min="0.01" value="1.0" required>
                                <select id="probe-length-unit" class="unit-select">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="cm">cm</option>
                                    <option value="in">in</option>
                                </select>
                            </div>
                            <div class="form-group input-with-select">
                                <label for="probe-diameter">Probe Diameter (D<sub>p</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Outer diameter of the conductive probe.</span></span></label>
                                <input type="number" id="probe-diameter" step="any" min="0.001" value="0.01" required>
                                <select id="probe-diameter-unit" class="unit-select">
                                    <option value="m">m</option>
                                    <option value="cm">cm</option>
                                    <option value="in">in</option>
                                    <option value="mm">mm</option>
                                </select>
                            </div>
                            <div class="form-group input-with-select">
                                <label for="probe-insulation-thickness">Probe Insulation Thickness (t<sub>ins</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Thickness of the insulation layer on the probe. Set to 0 if uninsulated.</span></span></label>
                                <input type="number" id="probe-insulation-thickness" step="any" min="0" value="0.001" required>
                                <select id="probe-insulation-thickness-unit" class="unit-select">
                                    <option value="m">m</option>
                                    <option value="cm">cm</option>
                                    <option value="in">in</option>
                                    <option value="mm">mm</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dielectric-insulation">Insulation Dielectric (K<sub>ins</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dielectric constant of the probe's insulating material (e.g., PTFE ≈ 2.1). Ignored if thickness is 0.</span></span></label>
                                <input type="number" id="dielectric-insulation" step="0.01" min="1.0" value="2.1" required>
                            </div>
                            <div class="form-group input-with-select">
                                <label for="tank-diameter">Tank/Reference Diameter (D<sub>t</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inner diameter of the tank (for concentric probe) or reference electrode diameter.</span></span></label>
                                <input type="number" id="tank-diameter" step="any" min="0.01" value="0.5" required>
                                <select id="tank-diameter-unit" class="unit-select">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="cm">cm</option>
                                    <option value="in">in</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dielectric-air">Vapor/Gas Dielectric (K<sub>air</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dielectric constant of the medium above the liquid (e.g., air ≈ 1.0).</span></span></label>
                                <input type="number" id="dielectric-air" step="0.01" min="1.0" value="1.0" required>
                            </div>
                            <div class="form-group">
                                <label for="dielectric-liquid">Liquid Dielectric (K<sub>liquid</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dielectric constant of the liquid. Water ≈ 80, many oils ≈ 2-3.</span></span></label>
                                <input type="number" id="dielectric-liquid" step="0.1" min="1.0" value="2.5" required>
                            </div>
                        </div>
                    </div>

                    <!-- Parameters for 'Calculate Level from Measured Capacitance' mode -->
                    <div class="form-section" id="level-from-c-parameters">
                        <h3><i class="fas fa-tachometer-alt"></i> Level Calculation Parameters</h3>
                        <div class="form-row">
                            <div class="form-group input-with-select">
                                <label for="measured-capacitance">Measured Capacitance (C<sub>measured</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Capacitance reading from the sensor in pF.</span></span></label>
                                <input type="number" id="measured-capacitance" step="any" min="0" value="100" required>
                                <span class="unit-span">pF</span>
                            </div>
                            <div class="form-group input-with-select">
                                <label for="empty-capacitance">Empty Capacitance (C<sub>empty</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Capacitance when the tank is empty (probe in air/vapor). Also known as 0% or LRV calibration.</span></span></label>
                                <input type="number" id="empty-capacitance" step="any" min="0" value="50" required>
                                <span class="unit-span">pF</span>
                            </div>
                            <div class="form-group input-with-select">
                                <label for="full-capacitance">Full Capacitance (C<sub>full</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Capacitance when the tank is full of liquid. Also known as 100% or URV calibration.</span></span></label>
                                <input type="number" id="full-capacitance" step="any" min="0" value="200" required>
                                <span class="unit-span">pF</span>
                            </div>
                        </div>
                    </div>

                    <!-- Update button classes to match new theme -->
                    <div class="btn-group">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate</button>
                        <button type="button" id="reset-form-btn" class="btn accent"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- NEW Step-by-Step Results Container (replaces #calculation-details) -->
        <div id="steps-container" class="steps-container math-content">
            <!-- Step cards will be dynamically inserted here -->
        </div>

        <!-- Results Section (replaces #result-container) -->
        <div id="results-section" class="card hidden">
            <h3><i class="fas fa-clipboard-check"></i> Calculation Summary</h3>
            
            <!-- Status Display -->
            <p class="range-status-display" id="range-status-display">Status: N/A</p>

            <table class="results-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    <!-- Results will be dynamically inserted here -->
                </tbody>
            </table>

            <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                <button type="button" id="clear-results-btn" class="btn accent"><i class="fas fa-times-circle"></i> Clear Results</button>
            </div>

            <!-- Practical Recommendations Section -->
            <div id="practical-recommendations" class="insight-card" style="display: none; margin-top: 30px;">
                <h4><i class="fas fa-lightbulb"></i> Practical Considerations & Recommendations</h4>
                <ul id="recommendations-list">
                    <!-- Recommendations will be dynamically inserted here -->
                </ul>
            </div>

            <!-- Standard Reference Section -->
            <div class="insight-card" id="standard-reference" style="margin-top: 30px;">
                <h4><i class="fas fa-book"></i> Applicable Standards & Best Practices</h4>
                <p>Capacitance level sensing involves principles from electrical engineering and instrumentation. Key considerations include:</p>
                <ul>
                    <li><strong>IEC 61298-3:</strong> Process measurement and control devices - General methods and procedures for evaluating performance. (Relevant for performance evaluation).</li>
                    <li><strong>ASTM D150:</strong> Standard Test Methods for AC Loss Characteristics and Permittivity (Dielectric Constant) of Solid Electrical Insulation. (Relevant for material properties).</li>
                    <li><strong>Sensor Design:</strong> The calculation model used here is for a concentric cylinder (probe in a tank or stilling well). Bare probes are for non-conductive liquids, while insulated probes are for conductive liquids.</li>
                    <li><strong>Fluid Properties:</strong> The dielectric constant (K) of the process fluid is crucial. Changes in temperature or composition can alter the `K` value, affecting accuracy.</li>
                    <li><strong>Coating/Build-up:</strong> Conductive coatings on the probe can cause errors. Insulated probes are designed to mitigate this by making the insulation the primary dielectric.</li>
                    <li><strong>Calibration:</strong> Accurate 2-point calibration (Empty and Full) is essential for reliable level measurement, as it accounts for real-world fringe effects and installation eccentricities not captured by theoretical formulas.</li>
                </ul>
                <p>This tool provides theoretical calculations and estimations. For real-world applications, always refer to manufacturer specifications, conduct proper calibration, and consider environmental factors.</p>
            </div>
        </div>

        <!-- NEW 800-word Educational Section -->
        <div id="education-section" class="education-section card math-content">
            <h2><i class="fas fa-book-open"></i> Deep Dive: Principles of Capacitance Level Sensing</h2>

            <div class="tool-description">
                <p>Capacitance level sensors are a robust and widely used technology for measuring the level of liquids, slurries, and even some solids. Their operation is based on the fundamental principles of a capacitor. This guide explores how they work, the critical factors influencing their accuracy, and their common applications.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-atom"></i> The Core Principle: A Variable Capacitor</h4>
                <p>At its heart, a capacitor is a simple device that stores electrical energy. It consists of two conductive plates separated by a non-conductive material called a dielectric. The measure of its ability to store charge is called <strong>capacitance (C)</strong>.</p>
                <p>A capacitance level sensor functions as a <strong>variable capacitor</strong>. The sensor's probe (a conductive rod) acts as one plate, and the metal tank wall (or a dedicated reference probe) acts as the second plate. The material between these two "plates" is the dielectric.</p>
                <p>As the liquid level in the tank rises, it displaces the air or vapor in the space between the probe and the tank wall. This changes the *overall* dielectric constant of the material between the plates, which in turn causes a *direct and measurable change* in the sensor's total capacitance.</p>
                                <p>The electronics in the sensor's transmitter continuously measure this capacitance and convert it into a proportional level reading (e.g., a 4-20mA signal or a digital value).</p>
            </div>
            
            <h3><i class="fas fa-calculator"></i> The Governing Formula</h3>
            <p>For the most common configuration, a concentric cylinder (a probe of diameter `d` inside a tank or reference tube of diameter `D`), the capacitance `C` is given by the formula:</p>
            <p style="text-align: center; font-size: 1.2rem; font-weight: bold;">
                $$ C = \frac{2 \pi \varepsilon_0 K L}{\ln(D/d)} $$
            </p>
            <ul>
                <li><strong>$C$</strong> is the Capacitance (in Farads).</li>
                <li><strong>$\pi$</strong> (pi) is the mathematical constant (~3.14159).</li>
                <li><strong>$\varepsilon_0$</strong> (Epsilon-nought) is the permittivity of free space, a constant ($8.854 \times 10^{-12}$ F/m).</li>
                <li><strong>$K$</strong> is the <strong>Dielectric Constant</strong> of the material between the plates.</li>
                <li><strong>$L$</strong> is the length of the probe covered by the material.</li>
                <li><strong>$\ln(D/d)$</strong> is the natural logarithm of the ratio of the outer diameter (D) to the inner diameter (d).</li>
            </ul>
            <p>This formula shows that capacitance is <strong>directly proportional to the dielectric constant (K) and the covered length (L)</strong>. Since everything else is constant, as the level (L) rises, the capacitance (C) increases linearly.</p>

            <h3><i class="fas fa-shield-alt"></i> Critical Factor: Probe Type vs. Liquid Type</h3>
            <p>The single most important decision in selecting a capacitance sensor is matching the probe type to the liquid's conductivity.</p>

            <div class="insight-card">
                <h4><i class="fas fa-oil-can"></i> 1. Bare (Uninsulated) Probes</h4>
                <p><strong>Use For: Non-Conductive Liquids</strong> (e.g., oils, solvents, fuels, liquefied gases).</p>
                <p>In this setup, the non-conductive liquid and the vapor above it act as the dielectric. The probe measures the capacitance change as the liquid (with a higher `K` value, e.g., 2-3 for oil) displaces the vapor (with a `K` value of ~1). This setup fails with conductive liquids because the liquid would "short out" the two plates, leading to a massive, non-linear signal spike.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-tint"></i> 2. Insulated Probes (e.g., PTFE/PFA Coated)</h4>
                <p><strong>Use For: Conductive Liquids</strong> (e.g., water, acids, bases, wastewater, conductive slurries).</p>
                <p>This is a clever design. The probe is coated in a durable, non-conductive material like PTFE (Teflon). In this case, the <strong>insulation itself becomes the dielectric</strong>. The conductive liquid now acts as the *outer plate* of the capacitor, effectively connecting to the tank wall. The vapor space, having low conductivity, does not form a capacitor in the same way.</p>
                <p>The result: the sensor measures the capacitance of the insulation *only for the length covered by the conductive liquid*. This design is also excellent at ignoring conductive or sticky buildup on the probe, as the buildup simply becomes part of the "outer plate," and the sensor continues to measure the capacitance of the *insulation*. This is why this calculator accounts for insulation thickness and its dielectric constant.</p>
            </div>

            <h3><i class="fas fa-tachometer-alt"></i> Factors Affecting Accuracy</h3>
            <p>While reliable, capacitance sensors are sensitive to several process variables:</p>
            <ol>
                <li><strong>Dielectric Constant (K):</strong> This is paramount. The `K` value of a material is its ability to store electrical energy. Air is the baseline (K=1). Oils are low (K=2-4). Alcohols are moderate (K=15-30). Water is very high (K=80). Any change to the liquid's `K` value—due to temperature, composition, or moisture content—will be misinterpreted by the sensor as a change in level.</li>
                <li><strong>Temperature:</strong> Temperature can change the `K` value of both the liquid and the vapor. For high-accuracy applications, sensors with built-in temperature compensation are essential.</li>
                <li><strong>Build-up (Coating):</strong> A non-conductive buildup (like paraffin on a bare probe in oil) will add an extra dielectric layer, causing the sensor to read low. A conductive buildup (on a bare probe) can cause a short. Insulated probes are the best defense against buildup issues.</li>
                <li><strong>Vapor Space:</strong> The `K` value of the gas or vapor above the liquid affects the "empty" or 0% reading. If this vapor changes (e.g., from dry air to heavy hydrocarbon vapor), the 0% calibration point will shift.</li>
            </ol>

            <div class="success-box">
                <h4><i class="fas fa-tools"></i> The Importance of 2-Point Calibration</h4>
                <p>While the formulas in this calculator provide excellent *theoretical* values, they assume a perfect world (a perfectly centered probe, no fringe effects, etc.). Real-world installations are never perfect.</p>
                <p>This is why all capacitance sensors <strong>must</strong> be calibrated on-site using a 2-point method. This is what the "Calculate Level from Measured Capacitance" mode is for.</p>
                <ul>
                    <li><strong>Step 1: Calibrate Empty (0% / LRV):</strong> With the tank at its known empty process level, the user records the sensor's capacitance reading. This is <strong>$C_{empty}$</strong> (e.g., 50 pF).</li>
                    <li><strong>Step 2: Calibrate Full (100% / URV):</strong> With the tank at its known full process level, the user records the capacitance reading. This is <strong>$C_{full}$</strong> (e.g., 200 pF).</li>
                </ul>
                <p>The transmitter then knows that the "span" (the capacitance change from 0% to 100%) is $C_{full} - C_{empty}$ (e.g., 200 - 50 = 150 pF). It can then use linear interpolation to find the level for any reading in between. For example, a reading of 125 pF would be:</p>
                <p>Level % = (125 - 50) / (200 - 50) = 75 / 150 = 0.5 = <strong>50% Level</strong>.</p>
                <p>This real-world calibration is the key to accuracy, as it automatically accounts for all the non-ideal factors of the specific installation.</p>
            </div>
        </div>

    </main>

    <!-- New Footer from file.txt -->
        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Updated JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Elements ---
            const calculationModeSelect = document.getElementById('calculation-mode');
            const commonParametersSection = document.getElementById('common-parameters');
            const levelFromCParametersSection = document.getElementById('level-from-c-parameters');

            // Common Inputs
            const probeLengthInput = document.getElementById('probe-length');
            const probeLengthUnit = document.getElementById('probe-length-unit');
            const probeDiameterInput = document.getElementById('probe-diameter');
            const probeDiameterUnit = document.getElementById('probe-diameter-unit');
            const probeInsulationThicknessInput = document.getElementById('probe-insulation-thickness');
            const probeInsulationThicknessUnit = document.getElementById('probe-insulation-thickness-unit');
            const dielectricInsulationInput = document.getElementById('dielectric-insulation');
            const tankDiameterInput = document.getElementById('tank-diameter');
            const tankDiameterUnit = document.getElementById('tank-diameter-unit');
            const dielectricAirInput = document.getElementById('dielectric-air');
            const dielectricLiquidInput = document.getElementById('dielectric-liquid');

            // Level from Capacitance Inputs
            const measuredCapacitanceInput = document.getElementById('measured-capacitance');
            const emptyCapacitanceInput = document.getElementById('empty-capacitance');
            const fullCapacitanceInput = document.getElementById('full-capacitance');

            // Buttons and result containers
            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            
            // New result containers
            const resultsSection = document.getElementById('results-section');
            const stepsContainer = document.getElementById('steps-container');
            const resultTableBody = document.getElementById('result-table-body');
            const rangeStatusDisplay = document.getElementById('range-status-display');
            const practicalRecommendationsDiv = document.getElementById('practical-recommendations');
            const recommendationsList = document.getElementById('recommendations-list');
            
            const messageBox = document.getElementById('message-box');

            // Constants
            const EPSILON_0 = 8.854e-12; // Farads per meter

            // Default values for resetting form
            const defaultValues = {
                'calculation-mode': 'level-from-c',
                'probe-length': 1.0,
                'probe-length-unit': 'm',
                'probe-diameter': 0.01,
                'probe-diameter-unit': 'm',
                'probe-insulation-thickness': 0.001,
                'probe-insulation-thickness-unit': 'm',
                'dielectric-insulation': 2.1,
                'tank-diameter': 0.5,
                'tank-diameter-unit': 'm',
                'dielectric-air': 1.0,
                'dielectric-liquid': 2.5,
                'measured-capacitance': 100,
                'empty-capacitance': 50,
                'full-capacitance': 200
            };

            // --- New showMessage function ---
            function showMessage(msg, type = 'success') {
                messageBox.textContent = msg;
                messageBox.style.color = 'white'; // Default
                if (type === 'error') {
                    messageBox.style.backgroundColor = 'var(--danger)';
                } else if (type === 'warning') {
                    messageBox.style.backgroundColor = 'var(--warning)';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                }
                messageBox.classList.add('show');
                setTimeout(() => messageBox.classList.remove('show'), 4000);
            }
            
            // --- New addResultRow helper ---
            function addResultRow(parameter, value, statusClass = '') {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
                if (statusClass) {
                    valueCell.classList.add(statusClass);
                }
            }

            // Function to toggle parameter sections based on calculation mode
            function toggleCalculationParameters() {
                if (calculationModeSelect.value === 'level-from-c') {
                    levelFromCParametersSection.style.display = 'block';
                } else {
                    levelFromCParametersSection.style.display = 'none';
                }
            }

            // Event listener for calculation mode change
            calculationModeSelect.addEventListener('change', toggleCalculationParameters);

            // Unit Conversion Functions (to meters for length/diameter)
            function convertLengthToMeters(value, unit) {
                switch (unit) {
                    case 'm': return value;
                    case 'ft': return value * 0.3048;
                    case 'cm': return value * 0.01;
                    case 'in': return value * 0.0254;
                    case 'mm': return value * 0.001;
                    default: return value;
                }
            }

            // Calculation Logic
            calculateBtn.addEventListener('click', function() {
                resultTableBody.innerHTML = '';
                stepsContainer.innerHTML = '';
                recommendationsList.innerHTML = '';
                practicalRecommendationsDiv.style.display = 'none';
                rangeStatusDisplay.textContent = 'Status: Calculating...';
                rangeStatusDisplay.className = 'range-status-display'; 

                let stepsHtml = '';
                let validationError = false;
                let recommendations = [];

                try {
                    const mode = calculationModeSelect.value;
                    
                    // --- 1. Get and Validate Common Inputs ---
                    const L_raw = parseFloat(probeLengthInput.value);
                    const L_unit = probeLengthUnit.value;
                    const Dp_raw = parseFloat(probeDiameterInput.value);
                    const Dp_unit = probeDiameterUnit.value;
                    const t_ins_raw = parseFloat(probeInsulationThicknessInput.value);
                    const t_ins_unit = probeInsulationThicknessUnit.value;
                    const K_ins = parseFloat(dielectricInsulationInput.value);
                    const Dt_raw = parseFloat(tankDiameterInput.value);
                    const Dt_unit = tankDiameterUnit.value;
                    const K_air = parseFloat(dielectricAirInput.value);
                    const K_liquid = parseFloat(dielectricLiquidInput.value);

                    if (isNaN(L_raw) || L_raw <= 0 || isNaN(Dp_raw) || Dp_raw <= 0 || isNaN(Dt_raw) || Dt_raw <= 0) {
                        throw new Error('Probe Length, Probe Diameter, and Tank Diameter must be positive numbers.');
                    }
                    if (isNaN(t_ins_raw) || t_ins_raw < 0) {
                        throw new Error('Probe Insulation Thickness must be a non-negative number.');
                    }
                    if (isNaN(K_ins) || K_ins < 1.0) {
                        throw new Error('Dielectric Constant of Insulation must be 1.0 or greater.');
                    }
                    if (isNaN(K_air) || K_air < 1.0) {
                        throw new Error('Dielectric Constant of Vapor/Gas must be 1.0 or greater.');
                    }
                    if (isNaN(K_liquid) || K_liquid < 1.0) {
                        throw new Error('Dielectric Constant of Liquid must be 1.0 or greater.');
                    }

                    // --- 2. Convert to Meters and Calculate Radii ---
                    const L_m = convertLengthToMeters(L_raw, L_unit);
                    const Dp_m = convertLengthToMeters(Dp_raw, Dp_unit);
                    const t_ins_m = convertLengthToMeters(t_ins_raw, t_ins_unit);
                    const Dt_m = convertLengthToMeters(Dt_raw, Dt_unit);
                    
                    const Rp = Dp_m / 2; // Probe radius
                    const R_ins_out = Rp + t_ins_m; // Outer radius of insulation
                    const Rt = Dt_m / 2; // Tank radius

                    if (Rp >= Rt) {
                        throw new Error('Probe Radius must be less than Tank Radius.');
                    }
                    if (R_ins_out >= Rt && t_ins_m > 0) {
                        throw new Error('Probe with insulation must fit inside the tank. Adjust insulation or tank diameter.');
                    }

                    // --- 3. Build Step Card 1: Input Parameters ---
                    stepsHtml += `<div class="step-card">
                        <h4><span class="number">1</span>Input Parameters & Converted Dimensions</h4>
                        <div class="step-content">
                            <div class="step-explanation">
                                <ul>
                                    <li><strong>Probe Length (L):</strong> ${L_raw.toFixed(3)} ${L_unit} &rarr; ${L_m.toExponential(3)} m</li>
                                    <li><strong>Probe Diameter (D<sub>p</sub>):</strong> ${Dp_raw.toFixed(3)} ${Dp_unit} &rarr; ${Dp_m.toExponential(3)} m</li>
                                    <li><strong>Insulation Thick (t<sub>ins</sub>):</strong> ${t_ins_raw.toFixed(3)} ${t_ins_unit} &rarr; ${t_ins_m.toExponential(3)} m</li>
                                    <li><strong>Tank Diameter (D<sub>t</sub>):</strong> ${Dt_raw.toFixed(3)} ${Dt_unit} &rarr; ${Dt_m.toExponential(3)} m</li>
                                </ul>
                            </div>
                            <div class="step-explanation">
                                <ul>
                                    <li><strong>Insulation Dielectric (K<sub>ins</sub>):</strong> ${K_ins.toFixed(2)}</li>
                                    <li><strong>Vapor Dielectric (K<sub>air</sub>):</strong> ${K_air.toFixed(2)}</li>
                                    <li><strong>Liquid Dielectric (K<sub>liquid</sub>):</strong> ${K_liquid.toFixed(2)}</li>
                                    <li><strong>Permittivity (&epsilon;₀):</strong> ${EPSILON_0.toExponential(3)} F/m</li>
                                </ul>
                            </div>
                        </div>
                    </div>`;

                    // --- 4. Build Step Card 2: Derived Radii ---
                    stepsHtml += `<div class="step-card">
                        <h4><span class="number">2</span>Derived Radii</h4>
                        <div class="step-content">
                            <div class="step-explanation">
                                <p>The formulas use radii (distance from center) rather than diameters.</p>
                                <p class="formula">Probe Radius (R<sub>p</sub>) = D<sub>p</sub> / 2</p>
                                <p class="formula">Insulation Outer Radius (R<sub>ins_out</sub>) = R<sub>p</sub> + t<sub>ins</sub></p>
                                <p class="formula">Tank Radius (R<sub>t</sub>) = D<sub>t</sub> / 2</p>
                            </div>
                            <div>
                                <p><strong>Probe Radius (R<sub>p</sub>):</strong></p>
                                <div class="step-value">${Rp.toExponential(3)}<span class="step-unit">m</span></div>
                                <p><strong>Insulation Outer (R<sub>ins_out</sub>):</strong></p>
                                <div class="step-value">${R_ins_out.toExponential(3)}<span class="step-unit">m</span></div>
                                <p><strong>Tank Radius (R<sub>t</sub>):</strong></p>
                                <div class="step-value">${Rt.toExponential(3)}<span class="step-unit">m</span></div>
                            </div>
                        </div>
                    </div>`;

                    // --- 5. Calculate Capacitance Per Unit Length (C') ---
                    let C_prime_liquid_F_per_m;
                    let C_prime_air_F_per_m;
                    let step3Html = '';

                    if (t_ins_m > 0) { // Insulated probe
                        const term1_liquid = (1 / K_ins) * Math.log(R_ins_out / Rp);
                        const term2_liquid = (1 / K_liquid) * Math.log(Rt / R_ins_out);
                        C_prime_liquid_F_per_m = (2 * Math.PI * EPSILON_0) / (term1_liquid + term2_liquid);

                        const term1_air = (1 / K_ins) * Math.log(R_ins_out / Rp);
                        const term2_air = (1 / K_air) * Math.log(Rt / R_ins_out);
                        C_prime_air_F_per_m = (2 * Math.PI * EPSILON_0) / (term1_air + term2_air);

                        step3Html = `<div class="step-card">
                            <h4><span class="number">3</span>Capacitance per Unit Length (C') - Insulated Probe</h4>
                            <div class="step-content">
                                <div class="step-explanation">
                                    <p>For an insulated probe, the capacitance is calculated as two capacitors in series (the insulation and the medium).</p>
                                    <p class="formula" style="font-size: 0.9rem;">$$ C' = \frac{2 \pi \varepsilon_0}{\frac{1}{K_{ins}}\ln(\frac{R_{ins\_out}}{R_p}) + \frac{1}{K_{medium}}\ln(\frac{R_t}{R_{ins\_out}})} $$</p>
                                </div>
                                <div>
                                    <p><strong>C' (Liquid):</strong></p>
                                    <div class="step-value">${C_prime_liquid_F_per_m.toExponential(3)}<span class="step-unit">F/m</span></div>
                                    <p><strong>C' (Air/Vapor):</strong></p>
                                    <div class="step-value">${C_prime_air_F_per_m.toExponential(3)}<span class="step-unit">F/m</span></div>
                                </div>
                            </div>
                        </div>`;

                    } else { // Bare probe
                        const C_base_factor = (2 * Math.PI * EPSILON_0) / Math.log(Rt / Rp);
                        C_prime_liquid_F_per_m = C_base_factor * K_liquid;
                        C_prime_air_F_per_m = C_base_factor * K_air;
                        
                        step3Html = `<div class="step-card">
                            <h4><span class="number">3</span>Capacitance per Unit Length (C') - Bare Probe</h4>
                            <div class="step-content">
                                <div class="step-explanation">
                                    <p>For a bare probe, the formula is simpler as there is only one dielectric (the medium).</p>
                                    <p class="formula">$$ C' = \frac{2 \pi \varepsilon_0 K_{medium}}{\ln(R_t / R_p)} $$</p>
                                    <p class="formula">Base Factor = (2&pi;&epsilon;₀) / ln(R<sub>t</sub>/R<sub>p</sub>) = ${C_base_factor.toExponential(3)} F/m</p>
                                </div>
                                <div>
                                    <p><strong>C' (Liquid) = Base &times; K<sub>liquid</sub>:</strong></p>
                                    <div class="step-value">${C_prime_liquid_F_per_m.toExponential(3)}<span class="step-unit">F/m</span></div>
                                    <p><strong>C' (Air) = Base &times; K<sub>air</sub>:</strong></p>
                                    <div class="step-value">${C_prime_air_F_per_m.toExponential(3)}<span class="step-unit">F/m</span></div>
                                </div>
                            </div>
                        </div>`;
                    }
                    stepsHtml += step3Html;

                    const C_empty_calculated_F = C_prime_air_F_per_m * L_m;
                    const C_full_calculated_F = C_prime_liquid_F_per_m * L_m;
                    const C_empty_calculated_pF = C_empty_calculated_F * 1e12;
                    const C_full_calculated_pF = C_full_calculated_F * 1e12;

                    // --- 6. Perform Final Calculation Based on Mode ---
                    if (mode === 'capacitance-from-dimensions') {
                        stepsHtml += `<div class="step-card">
                            <h4><span class="number">4</span>Final Calculation: Theoretical Capacitance</h4>
                            <div class="step-content">
                                <div class="step-explanation">
                                    <p>The total capacitance is the capacitance per unit length (C') multiplied by the total probe length (L).</p>
                                    <p class="formula">C<sub>empty</sub> = C'<sub>air</sub> &times; L</p>
                                    <p class="formula">C<sub>full</sub> = C'<sub>liquid</sub> &times; L</p>
                                </div>
                                <div>
                                    <p><strong>Theoretical Empty (C<sub>empty</sub>):</strong></p>
                                    <div class="step-value">${C_empty_calculated_pF.toFixed(2)}<span class="step-unit">pF</span></div>
                                    <p><strong>Theoretical Full (C<sub>full</sub>):</strong></p>
                                    <div class="step-value">${C_full_calculated_pF.toFixed(2)}<span class="step-unit">pF</span></div>
                                </div>
                            </div>
                        </div>`;
                        
                        addResultRow("<strong>Calculated Empty Capacitance (C<sub>empty</sub>)</strong>", `<strong>${C_empty_calculated_pF.toFixed(2)} pF</strong>`, "highlight");
                        addResultRow("<strong>Calculated Full Capacitance (C<sub>full</sub>)</strong>", `<strong>${C_full_calculated_pF.toFixed(2)} pF</strong>`, "highlight");
                        
                        rangeStatusDisplay.textContent = 'Status: Theoretical Capacitance Calculated';
                        rangeStatusDisplay.classList.add('ok');
                        
                        recommendations.push("These are theoretical values. Real-world calibrated values will differ due to installation eccentricities and electrical fringe effects.");
                        recommendations.push("Use these values for initial sensor selection and design, not for final process control.");

                    } else { // mode === 'level-from-c'
                        const C_measured = parseFloat(measuredCapacitanceInput.value);
                        const C_empty_input = parseFloat(emptyCapacitanceInput.value);
                        const C_full_input = parseFloat(fullCapacitanceInput.value);

                        if (isNaN(C_measured) || C_measured < 0 || isNaN(C_empty_input) || C_empty_input < 0 || isNaN(C_full_input) || C_full_input < 0) {
                            throw new Error('Measured, Empty, and Full Capacitance must be non-negative numbers.');
                        }
                        if (C_empty_input >= C_full_input) {
                            throw new Error('Empty Capacitance (0%) must be less than Full Capacitance (100%).');
                        }
                        if (C_measured < C_empty_input || C_measured > C_full_input) {
                            showMessage('Measured Capacitance is outside the calibrated 0-100% range. Level will be clamped to 0% or 100%.', 'warning');
                        }

                        let level_percent = ((C_measured - C_empty_input) / (C_full_input - C_empty_input)) * 100;
                        level_percent = Math.max(0, Math.min(100, level_percent)); // Clamp between 0 and 100
                        
                        const level_length_m = (level_percent / 100) * L_m;
                        let level_length_display = level_length_m;
                        
                        switch (L_unit) {
                            case 'ft': level_length_display = level_length_m / 0.3048; break;
                            case 'cm': level_length_display = level_length_m / 0.01; break;
                            case 'in': level_length_display = level_length_m / 0.0254; break;
                        }

                        stepsHtml += `<div class="step-card">
                            <h4><span class="number">4</span>Final Calculation: Level from Capacitance</h4>
                            <div class="step-content">
                                <div class="step-explanation">
                                    <p>The level is found by linear interpolation between the calibrated empty (0%) and full (100%) capacitance values.</p>
                                    <p class="formula" style="font-size: 0.9rem;">$$ Level \% = \frac{C_{measured} - C_{empty}}{C_{full} - C_{empty}} \times 100\% $$</p>
                                    <p class="formula" style="font-size: 0.9rem;">Level (abs) = (Level % / 100) &times; L</p>
                                </div>
                                <div>
                                    <p><strong>Calculated Liquid Level (%):</strong></p>
                                    <div class="step-value">${level_percent.toFixed(2)}<span class="step-unit">%</span></div>
                                    <p><strong>Liquid Level (Absolute):</strong></p>
                                    <div class="step-value">${level_length_display.toFixed(2)}<span class="step-unit">${L_unit}</span></div>
                                </div>
                            </div>
                        </div>`;
                        
                        addResultRow("<strong>Calculated Liquid Level (%)</strong>", `<strong>${level_percent.toFixed(2)} %</strong>`, "highlight");
                        addResultRow("<strong>Liquid Level (Absolute)</strong>", `<strong>${level_length_display.toFixed(2)} ${L_unit}</strong>`, "highlight");

                        if (level_percent < 5 || level_percent > 95) {
                            rangeStatusDisplay.textContent = 'Status: Level at Extremes';
                            rangeStatusDisplay.classList.add('marginal');
                            recommendations.push("The level is near 0% or 100%. Ensure calibration is accurate at these extremes.");
                        } else if (level_percent >= 20 && level_percent <= 80) {
                            rangeStatusDisplay.textContent = 'Status: Optimal Range';
                            rangeStatusDisplay.classList.add('ok');
                            recommendations.push("The level is within the optimal operating range for most sensors.");
                        } else {
                            rangeStatusDisplay.textContent = 'Status: Level Calculated';
                            rangeStatusDisplay.classList.add('adequate');
                            recommendations.push("The calculated level is valid.");
                        }
                        
                        recommendations.push(`Your theoretical values are: C<sub>empty</sub> = ${C_empty_calculated_pF.toFixed(2)} pF and C<sub>full</sub> = ${C_full_calculated_pF.toFixed(2)} pF. Compare these to your calibrated values (${C_empty_input} pF, ${C_full_input} pF) to check for large discrepancies, which could indicate a change in medium or probe fouling.`);
                    }

                    // --- 7. Display Results ---
                    stepsContainer.innerHTML = stepsHtml;
                    stepsContainer.classList.add('active');
                    
                    recommendationsList.innerHTML = recommendations.map(r => `<li>${r}</li>`).join('');
                    practicalRecommendationsDiv.style.display = 'block';

                    resultsSection.classList.remove('hidden');
                    showMessage('Calculation successful!', 'success');
                    
                    // Typeset MathJax
                    if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                        setTimeout(() => {
                            window.MathJax.typesetPromise([stepsContainer, document.getElementById('education-section')]);
                        }, 50); 
                    }

                    setTimeout(() => {
                        stepsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);

                } catch (error) {
                    showMessage(error.message, 'error');
                    resultsSection.classList.add('hidden');
                    stepsContainer.classList.remove('active');
                    validationError = true;
                }
            });

            // --- Reset Form Logic ---
            resetFormBtn.addEventListener('click', function() {
                for (const key in defaultValues) {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = defaultValues[key];
                    }
                }
                toggleCalculationParameters();
                clearResults();
                showMessage('Form reset to default values.', 'success');
            });

            // --- Clear Results Logic ---
            function clearResults() {
                resultsSection.classList.add('hidden');
                stepsContainer.classList.remove('active');
                setTimeout(() => {
                    resultTableBody.innerHTML = '';
                    stepsContainer.innerHTML = '';
                    recommendationsList.innerHTML = '';
                    practicalRecommendationsDiv.style.display = 'none';
                    rangeStatusDisplay.textContent = 'Status: N/A';
                    rangeStatusDisplay.className = 'range-status-display';
                }, 400); // Wait for fade-out
            }
            clearResultsBtn.addEventListener('click', () => {
                clearResults();
                showMessage('Results cleared.', 'success');
            });

            // --- Initial fade-in for form sections ---
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            // --- Theme switch logic ---
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
            
            // Initial call to set visibility
            toggleCalculationParameters();
            
            // Initial MathJax typesetting for education section
            if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                window.MathJax.typesetPromise([document.getElementById('education-section')]);
            }
        });
    </script>
</body>
</html>


