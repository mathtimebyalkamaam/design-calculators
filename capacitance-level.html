<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script> <!-- Placeholder for G-tag ID -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX'); // Placeholder for G-tag ID
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitance Level Sensor Calculator - Design Calculators - Instrumentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Basic CSS Variables for a consistent theme (Blue Only) */
        :root {
            --primary-color: #0056b3; /* A strong, professional blue */
            --secondary-color: #003f80; /* A darker shade of blue */
            --accent-color: #FFC107; /* Amber for warnings/highlights */
            --bg-color: #e6f2ff; /* Very light blue background */
            --card-bg: #ffffff; /* White card background */
            --text-color: #333333; /* Dark grey text */
            --header-bg: #ffffff; /* White for header */
            --footer-bg: #ffffff; /* White for footer */
            --border-color: #a0c3e6; /* Lighter blue border */
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #d0e6ff; /* Lighter blue for hover states */
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #00224d);
            --reset-button-bg: #FFC107; /* Amber for reset */
            --reset-button-hover-bg: #E0A800; /* Darker amber */
            --clear-button-bg: #6c757d; /* Grey for clear */
            --clear-button-hover-bg: #5a6268; /* Darker grey */
            --ok-color: #28a745; /* Green for OK status */
            --error-color: #dc3545; /* Red for error status */
            --warning-color: #ffc107; /* Amber for warnings */
        }

        /* Dark Mode Variables (Blue Only) */
        body.dark-mode {
            --bg-color: #1a2a40; /* Dark blue background */
            --card-bg: #2a3d54; /* Slightly lighter dark blue for cards */
            --text-color: #e0f2ff; /* Light blue text */
            --header-bg: #1a2a40; /* Keep dark for dark mode header */
            --footer-bg: #1a2a40; /* Keep dark for dark mode footer */
            --border-color: #3b506b;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #3b506b; /* Darker blue for hover */
            --button-gradient: linear-gradient(45deg, #003f80, #0056b3);
            --button-hover-gradient: linear-gradient(45deg, #0056b3, #006bb3);
            --reset-button-bg: #FFD700; /* Gold/Yellow for dark mode reset */
            --reset-button-hover-bg: #DAA520; /* Darker gold/yellow */
            --clear-button-bg: #5a6268; /* Darker grey for dark mode clear */
            --clear-button-hover-bg: #495057;
            --ok-color: #5cb85c;
            --error-color: #e74c3c;
            --warning-color: #DAA520;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-color), #c0d9ed); /* Gradient for depth */
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: var(--text-color); /* Text color changes with background */
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color); /* Maintain primary color for emphasis */
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: var(--text-color); /* Text color changes with background */
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.3s;
            width: fit-content;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: var(--text-color); /* Adjust icon color for white header */
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: var(--text-color); /* Text color changes with background */
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: var(--text-color); /* Text color changes with background */
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px; /* Default margin for form groups */
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg); /* Use card-bg for input background */
            color: var(--text-color);
            box-sizing: border-box; /* Ensure padding doesn't increase width */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
            gap: 20px; /* Gap between grid items */
            margin-bottom: 0; /* Handled by form-group margin */
        }
        
        .calculate-btn {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 12px 30px; /* Increased padding for better appearance */
            border-radius: 25px; /* More rounded */
            cursor: pointer;
            font-size: 1.1em; /* Slightly larger font */
            font-weight: bold;
            margin-top: 25px; /* More space above button */
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto; /* Allow button to size based on content and padding */
            min-width: 220px; /* Ensure a minimum width for consistency */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .calculate-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02); /* Lift and slightly scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }

        .reset-btn {
            background-color: var(--reset-button-bg);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 25px;
            margin-left: 15px; /* Space from calculate button */
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .reset-btn:hover {
            background-color: var(--reset-button-hover-bg);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .clear-results-btn {
            background-color: var(--clear-button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .clear-results-btn:hover {
            background-color: var(--clear-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For animation */
            transform: translateY(20px); /* Initial state for animation */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners apply to table content */
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color); /* Highlight row on hover */
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--hover-color);
            border-radius: 4px;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: color 0.3s;
        }

        .info-icon:hover {
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px); /* Initial state for tooltip animation */
            font-size: 0.85em;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: flex; /* Use flex for centering text */
            align-items: center;
            justify-content: center;
            min-width: 250px; /* Ensure it's wide enough */
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* More space */
            font-size: 0.95em;
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif; /* A font suitable for mathematical formulas */
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 12px 10px; /* Increased padding */
            background-color: var(--hover-color);
            border-radius: 6px; /* More rounded */
            margin: 15px 0; /* More space */
            overflow-x: auto; /* Allow horizontal scrolling for long formulas */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace; /* Monospace for steps */
            background-color: var(--hover-color);
            padding: 8px 15px; /* Increased padding */
            border-radius: 4px; /* More rounded */
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-break: break-word; /* Break long words */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
        }

        /* Style for centering the button */
        .button-wrapper {
            display: flex;
            justify-content: center; /* Center the button horizontally */
            width: 100%; /* Ensure it takes full width to center effectively */
            padding-top: 20px; /* Add more spacing above the button */
        }

        /* Animation for input fields on focus */
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 86, 179, 0.4); /* Blue glow */
            outline: none;
            animation: pulse 0.8s infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 0 4px rgba(0, 86, 179, 0.4);
            }
            to {
                box-shadow: 0 0 0 8px rgba(0, 86, 179, 0.2); /* Softer pulse */
            }
        }

        /* Status Display */
        .status-display {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.5s, color 0.5s;
            text-align: center;
            width: 100%;
        }
        .status-display.optimal {
            background-color: var(--ok-color);
            color: white;
        }
        .status-display.sufficient {
            background-color: #66bb6a; /* Lighter green */
            color: white;
        }
        .status-display.adequate {
            background-color: #add8e6; /* Light blue */
            color: var(--text-color);
        }
        .status-display.marginal {
            background-color: var(--warning-color);
            color: var(--text-color);
        }
        .status-display.insufficient {
            background-color: var(--error-color);
            color: white;
        }

        /* Practical Recommendations Section */
        #practical-recommendations {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--bg-color);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        #practical-recommendations h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }
        #practical-recommendations ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #practical-recommendations ul li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Instrumentation</h1>
            <p class="subtitle">Smart Tools for Modern Instrumentation Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <a href="indexInst.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </div>
        
        <div class="tool-container">
            <h2>Capacitance Level Sensor Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator assists in the design and calibration of capacitance level sensors. It can calculate theoretical capacitance values based on probe and tank geometry, or determine liquid level from measured capacitance, considering dielectric properties of the media.</p>
            </div>
        
            <div class="calculator-form">
                <form id="capacitance-calculator-form">
                    <!-- Calculation Mode Selection -->
                    <div class="form-section">
                        <h3>Calculation Mode</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="calculation-mode">Select Calculation Type</label>
                                <select id="calculation-mode" required>
                                    <option value="level-from-c">Calculate Level from Measured Capacitance</option>
                                    <option value="capacitance-from-dimensions">Calculate Capacitance from Dimensions</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Common Parameters for both modes -->
                    <div class="form-section" id="common-parameters">
                        <h3>Common Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="probe-length">Probe Length (L)</label>
                                <input type="number" id="probe-length" step="any" min="0.01" value="1.0" required>
                                <select id="probe-length-unit">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="cm">cm</option>
                                    <option value="in">in</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="probe-diameter">Probe Diameter (D<sub>p</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Outer diameter of the probe.</span></span></label>
                                <input type="number" id="probe-diameter" step="any" min="0.001" value="0.01" required>
                                <select id="probe-diameter-unit">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="cm">cm</option>
                                    <option value="in">in</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="probe-insulation-thickness">Probe Insulation Thickness (t<sub>ins</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Thickness of the insulation layer on the probe. Set to 0 if uninsulated.</span></span></label>
                                <input type="number" id="probe-insulation-thickness" step="any" min="0" value="0.001" required>
                                <select id="probe-insulation-thickness-unit">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="cm">cm</option>
                                    <option value="in">in</option>
                                    <option value="mm">mm</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dielectric-insulation">Dielectric Constant of Insulation (K<sub>ins</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dielectric constant of the probe's insulating material (e.g., PTFE ≈ 2.1).</span></span></label>
                                <input type="number" id="dielectric-insulation" step="0.01" min="1.0" value="2.1" required>
                            </div>
                            <div class="form-group">
                                <label for="tank-diameter">Tank Diameter (D<sub>t</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inner diameter of the tank (for concentric probe) or reference electrode diameter.</span></span></label>
                                <input type="number" id="tank-diameter" step="any" min="0.01" value="0.5" required>
                                <select id="tank-diameter-unit">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="cm">cm</option>
                                    <option value="in">in</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dielectric-air">Dielectric Constant of Vapor/Gas (K<sub>air</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dielectric constant of the medium above the liquid (e.g., air ≈ 1.0).</span></span></label>
                                <input type="number" id="dielectric-air" step="0.01" min="1.0" value="1.0" required>
                            </div>
                            <div class="form-group">
                                <label for="dielectric-liquid">Dielectric Constant of Liquid (K<sub>liquid</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dielectric constant of the liquid. Water ≈ 80, many oils ≈ 2-3.</span></span></label>
                                <input type="number" id="dielectric-liquid" step="0.1" min="1.0" value="2.5" required>
                            </div>
                        </div>
                    </div>

                    <!-- Parameters for 'Calculate Level from Measured Capacitance' mode -->
                    <div class="form-section" id="level-from-c-parameters">
                        <h3>Level Calculation Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="measured-capacitance">Measured Capacitance (C<sub>measured</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Capacitance reading from the sensor in pF.</span></span></label>
                                <input type="number" id="measured-capacitance" step="any" min="0" value="100" required>
                                <span class="unit">pF</span>
                            </div>
                            <div class="form-group">
                                <label for="empty-capacitance">Empty Capacitance (C<sub>empty</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Capacitance when the tank is empty (probe in air/vapor).</span></span></label>
                                <input type="number" id="empty-capacitance" step="any" min="0" value="50" required>
                                <span class="unit">pF</span>
                            </div>
                            <div class="form-group">
                                <label for="full-capacitance">Full Capacitance (C<sub>full</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Capacitance when the tank is full of liquid.</span></span></label>
                                <input type="number" id="full-capacitance" step="any" min="0" value="200" required>
                                <span class="unit">pF</span>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="calculate-btn">Calculate</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>

            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <p class="status-display" id="calc-status-display">Calculation Status: N/A</p>

                <div id="calculation-details">
                    <h4>Step-by-Step Calculation</h4>
                    <p class="formula" id="calc-formula">
                        <!-- Formula will be dynamically inserted here -->
                    </p>
                    <div id="steps-list">
                        <!-- Calculation steps will be inserted here -->
                    </div>
                </div>

                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>

                <div id="practical-recommendations" style="display: none;">
                    <h4>Practical Considerations & Recommendations</h4>
                    <ul id="recommendations-list">
                        <!-- Recommendations will be dynamically inserted here -->
                    </ul>
                </div>

                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
                </div>
                <div class="standard-reference">
                    <p><strong>Applicable Standards and Guidelines:</strong> Capacitance level sensing involves principles from electrical engineering and instrumentation. Key considerations include:</p>
                    <ul>
                        <li><strong>IEC 61298-3:</strong> Process measurement, control and automation - General methods and procedures for evaluating performance - Part 3: Test methods for the determination of the influence of static pressure on the performance of pressure measuring instruments. (General instrumentation standard, not specific to capacitance but relevant for performance evaluation).</li>
                        <li><strong>ASTM D150:</strong> Standard Test Methods for AC Loss Characteristics and Permittivity (Dielectric Constant) of Solid Electrical Insulation. (Relevant for material properties).</li>
                        <li><strong>Sensor Design:</strong> Concentric cylinder (probe in stilling well), bare probe, insulated probe, and dual-probe designs. Each has specific capacitance formulas.</li>
                        <li><strong>Fluid Properties:</strong> The dielectric constant of the process fluid is crucial. Changes in temperature or composition can alter the dielectric constant, affecting accuracy.</li>
                        <li><strong>Coating/Build-up:</strong> Conductive coatings on the probe can cause errors. Insulated probes help mitigate this.</li>
                        <li><strong>Vapor Space Dielectric:</strong> The dielectric constant of the vapor or gas above the liquid also affects the empty capacitance.</li>
                        <li><strong>Calibration:</strong> Accurate calibration (empty and full) is essential for reliable level measurement.</li>
                        <li><strong>Temperature Compensation:</strong> Dielectric constants are temperature-dependent. For high accuracy, temperature compensation may be required.</li>
                    </ul>
                    <p>This tool provides theoretical calculations and estimations. For real-world applications, always refer to manufacturer specifications, conduct proper calibration, and consider environmental factors.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in=Design Calculators - Instrumentation" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Instrumentation!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Instrumentation! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Input elements
            const calculationModeSelect = document.getElementById('calculation-mode');
            const commonParametersSection = document.getElementById('common-parameters');
            const levelFromCParametersSection = document.getElementById('level-from-c-parameters');

            // Common Inputs
            const probeLengthInput = document.getElementById('probe-length');
            const probeLengthUnit = document.getElementById('probe-length-unit');
            const probeDiameterInput = document.getElementById('probe-diameter');
            const probeDiameterUnit = document.getElementById('probe-diameter-unit');
            const probeInsulationThicknessInput = document.getElementById('probe-insulation-thickness'); // New
            const probeInsulationThicknessUnit = document.getElementById('probe-insulation-thickness-unit'); // New
            const dielectricInsulationInput = document.getElementById('dielectric-insulation'); // New
            const tankDiameterInput = document.getElementById('tank-diameter');
            const tankDiameterUnit = document.getElementById('tank-diameter-unit');
            const dielectricAirInput = document.getElementById('dielectric-air');
            const dielectricLiquidInput = document.getElementById('dielectric-liquid');

            // Level from Capacitance Inputs
            const measuredCapacitanceInput = document.getElementById('measured-capacitance');
            const emptyCapacitanceInput = document.getElementById('empty-capacitance');
            const fullCapacitanceInput = document.getElementById('full-capacitance');

            // Buttons and result containers
            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const calcStatusDisplay = document.getElementById('calc-status-display');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const calcFormula = document.getElementById('calc-formula');
            const stepsList = document.getElementById('steps-list');
            const practicalRecommendationsDiv = document.getElementById('practical-recommendations');
            const recommendationsList = document.getElementById('recommendations-list');

            // Permittivity of free space (F/m)
            const EPSILON_0 = 8.854e-12; // Farads per meter

            // Default values for resetting form
            const defaultValues = {
                'calculation-mode': 'level-from-c',
                'probe-length': 1.0,
                'probe-length-unit': 'm',
                'probe-diameter': 0.01,
                'probe-diameter-unit': 'm',
                'probe-insulation-thickness': 0.001, // New default
                'probe-insulation-thickness-unit': 'm', // New default
                'dielectric-insulation': 2.1, // New default
                'tank-diameter': 0.5,
                'tank-diameter-unit': 'm',
                'dielectric-air': 1.0,
                'dielectric-liquid': 2.5,
                'measured-capacitance': 100,
                'empty-capacitance': 50,
                'full-capacitance': 200
            };

            // Function to display custom messages
            function showCustomMessage(message, type = 'info') {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add(type); // Add type for styling (e.g., 'error', 'success', 'info')

                if (type === 'error') {
                    messageBox.style.backgroundColor = '#dc3545'; // Red
                } else if (type === 'success') {
                    messageBox.style.backgroundColor = '#28a745'; // Green
                } else {
                    messageBox.style.backgroundColor = 'var(--primary-color)'; // Blue (default info)
                }

                messageBox.style.opacity = '1';
                messageBox.style.transform = 'translateX(-50%) translateY(0)'; // Slide down animation

                setTimeout(() => {
                    messageBox.style.opacity = '0';
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)'; // Slide up animation
                }, 3000);
            }

            // Function to toggle parameter sections based on calculation mode
            function toggleCalculationParameters() {
                if (calculationModeSelect.value === 'level-from-c') {
                    levelFromCParametersSection.style.display = 'block';
                } else {
                    levelFromCParametersSection.style.display = 'none';
                }
            }

            // Event listener for calculation mode change
            calculationModeSelect.addEventListener('change', toggleCalculationParameters);

            // Unit Conversion Functions (to meters for length/diameter)
            function convertLengthToMeters(value, unit) {
                switch (unit) {
                    case 'm': return value;
                    case 'ft': return value * 0.3048;
                    case 'cm': return value * 0.01;
                    case 'in': return value * 0.0254;
                    case 'mm': return value * 0.001; // New unit
                    default: return value;
                }
            }

            // Calculation Logic
            calculateBtn.addEventListener('click', function() {
                resultTableBody.innerHTML = ''; // Clear previous results
                stepsList.innerHTML = ''; // Clear previous steps
                recommendationsList.innerHTML = ''; // Clear previous recommendations
                practicalRecommendationsDiv.style.display = 'none'; // Hide recommendations initially
                calcStatusDisplay.textContent = 'Calculation Status: Calculating...';
                calcStatusDisplay.className = 'status-display'; // Reset class

                let calculationSteps = [];
                let validationError = false;
                let results = [];
                let recommendations = [];

                const mode = calculationModeSelect.value;

                // Common inputs
                const L_raw = parseFloat(probeLengthInput.value);
                const L_unit = probeLengthUnit.value;
                const Dp_raw = parseFloat(probeDiameterInput.value);
                const Dp_unit = probeDiameterUnit.value;
                const t_ins_raw = parseFloat(probeInsulationThicknessInput.value); // New
                const t_ins_unit = probeInsulationThicknessUnit.value; // New
                const K_ins = parseFloat(dielectricInsulationInput.value); // New
                const Dt_raw = parseFloat(tankDiameterInput.value);
                const Dt_unit = tankDiameterUnit.value;
                const K_air = parseFloat(dielectricAirInput.value);
                const K_liquid = parseFloat(dielectricLiquidInput.value);

                // Convert common inputs to meters
                const L_m = convertLengthToMeters(L_raw, L_unit);
                const Dp_m = convertLengthToMeters(Dp_raw, Dp_unit);
                const t_ins_m = convertLengthToMeters(t_ins_raw, t_ins_unit); // New
                const Dt_m = convertLengthToMeters(Dt_raw, Dt_unit);

                // Radii for calculations
                const Rp = Dp_m / 2; // Probe radius
                const R_ins_out = Rp + t_ins_m; // Outer radius of insulation
                const Rt = Dt_m / 2; // Tank radius

                // Common Input Validation
                if (isNaN(L_raw) || L_raw <= 0 || isNaN(Dp_raw) || Dp_raw <= 0 || isNaN(Dt_raw) || Dt_raw <= 0) {
                    showCustomMessage('Probe Length, Probe Diameter, and Tank Diameter must be positive numbers.', 'error');
                    validationError = true;
                }
                if (isNaN(t_ins_raw) || t_ins_raw < 0) { // Insulation thickness can be 0
                    showCustomMessage('Probe Insulation Thickness must be a non-negative number.', 'error');
                    validationError = true;
                }
                if (isNaN(K_ins) || K_ins < 1.0) {
                    showCustomMessage('Dielectric Constant of Insulation must be 1.0 or greater.', 'error');
                    validationError = true;
                }
                if (Rp >= Rt) {
                    showCustomMessage('Probe Radius must be less than Tank Radius.', 'error');
                    validationError = true;
                }
                if (R_ins_out >= Rt && t_ins_m > 0) {
                    showCustomMessage('Probe with insulation must fit inside the tank. Adjust insulation thickness or tank diameter.', 'error');
                    validationError = true;
                }
                if (isNaN(K_air) || K_air < 1.0) {
                    showCustomMessage('Dielectric Constant of Vapor/Gas must be 1.0 or greater.', 'error');
                    validationError = true;
                }
                if (isNaN(K_liquid) || K_liquid < 1.0) {
                    showCustomMessage('Dielectric Constant of Liquid must be 1.0 or greater.', 'error');
                    validationError = true;
                }

                if (validationError) {
                    resultContainer.style.display = 'none';
                    resultContainer.classList.remove('show');
                    return;
                }

                calculationSteps.push(`<strong>1. Selected Calculation Mode: ${mode === 'level-from-c' ? 'Calculate Level from Measured Capacitance' : 'Calculate Capacitance from Dimensions'}</strong>`);
                calculationSteps.push(`<strong>2. Input Parameters:</strong>`);
                calculationSteps.push(`Probe Length (L): ${L_raw.toFixed(3)} ${L_unit} (Converted to: ${L_m.toExponential(2)} m)`);
                calculationSteps.push(`Probe Diameter (D<sub>p</sub>): ${Dp_raw.toFixed(3)} ${Dp_unit} (Converted to: ${Dp_m.toExponential(2)} m)`);
                calculationSteps.push(`Probe Insulation Thickness (t<sub>ins</sub>): ${t_ins_raw.toFixed(3)} ${t_ins_unit} (Converted to: ${t_ins_m.toExponential(2)} m)`);
                calculationSteps.push(`Dielectric Constant of Insulation (K<sub>ins</sub>): ${K_ins.toFixed(2)}`);
                calculationSteps.push(`Tank Diameter (D<sub>t</sub>): ${Dt_raw.toFixed(3)} ${Dt_unit} (Converted to: ${Dt_m.toExponential(2)} m)`);
                calculationSteps.push(`Dielectric Constant of Vapor/Gas (K<sub>air</sub>): ${K_air.toFixed(2)}`);
                calculationSteps.push(`Dielectric Constant of Liquid (K<sub>liquid</sub>): ${K_liquid.toFixed(2)}`);
                calculationSteps.push(`Permittivity of Free Space (ε₀): ${EPSILON_0.toExponential(3)} F/m`);
                
                calculationSteps.push(`<strong>3. Derived Radii:</strong>`);
                calculationSteps.push(`Probe Radius (R<sub>p</sub>) = D<sub>p</sub> / 2 = ${Rp.toExponential(2)} m`);
                calculationSteps.push(`Insulation Outer Radius (R<sub>ins_out</sub>) = R<sub>p</sub> + t<sub>ins</sub> = ${R_ins_out.toExponential(2)} m`);
                calculationSteps.push(`Tank Radius (R<sub>t</sub>) = D<sub>t</sub> / 2 = ${Rt.toExponential(2)} m`);


                // Capacitance per unit length for insulated probe (F/m)
                let C_prime_liquid_F_per_m;
                let C_prime_air_F_per_m;

                if (t_ins_m > 0) { // Insulated probe
                    // Capacitance per unit length for liquid portion
                    const term1_liquid = (1 / K_ins) * Math.log(R_ins_out / Rp);
                    const term2_liquid = (1 / K_liquid) * Math.log(Rt / R_ins_out);
                    C_prime_liquid_F_per_m = (2 * Math.PI * EPSILON_0) / (term1_liquid + term2_liquid);

                    // Capacitance per unit length for air portion
                    const term1_air = (1 / K_ins) * Math.log(R_ins_out / Rp);
                    const term2_air = (1 / K_air) * Math.log(Rt / R_ins_out);
                    C_prime_air_F_per_m = (2 * Math.PI * EPSILON_0) / (term1_air + term2_air);

                    calculationSteps.push(`<strong>4. Capacitance per Unit Length (Insulated Probe):</strong>`);
                    calculationSteps.push(`For Liquid (C'<sub>liquid</sub>) = (2 &times; &pi; &times; &epsilon;₀) / [(1/K<sub>ins</sub>)ln(R<sub>ins_out</sub>/R<sub>p</sub>) + (1/K<sub>liquid</sub>)ln(R<sub>t</sub>/R<sub>ins_out</sub>)]`);
                    calculationSteps.push(`C'<sub>liquid</sub> = (2 &times; ${Math.PI.toFixed(4)} &times; ${EPSILON_0.toExponential(3)}) / [(1/${K_ins.toFixed(2)})ln(${R_ins_out.toExponential(2)}/${Rp.toExponential(2)}) + (1/${K_liquid.toFixed(2)})ln(${Rt.toExponential(2)}/${R_ins_out.toExponential(2)})] = <strong>${C_prime_liquid_F_per_m.toExponential(3)} F/m</strong>`);
                    calculationSteps.push(`For Air (C'<sub>air</sub>) = (2 &times; &pi; &times; &epsilon;₀) / [(1/K<sub>ins</sub>)ln(R<sub>ins_out</sub>/R<sub>p</sub>) + (1/K<sub>air</sub>)ln(R<sub>t</sub>/R<sub>ins_out</sub>)]`);
                    calculationSteps.push(`C'<sub>air</sub> = (2 &times; ${Math.PI.toFixed(4)} &times; ${EPSILON_0.toExponential(3)}) / [(1/${K_ins.toFixed(2)})ln(${R_ins_out.toExponential(2)}/${Rp.toExponential(2)}) + (1/${K_air.toFixed(2)})ln(${Rt.toExponential(2)}/${R_ins_out.toExponential(2)})] = <strong>${C_prime_air_F_per_m.toExponential(3)} F/m</strong>`);

                } else { // Bare probe (original logic)
                    const C_base_factor = (2 * Math.PI * EPSILON_0) / Math.log(Rt / Rp);
                    C_prime_liquid_F_per_m = C_base_factor * K_liquid;
                    C_prime_air_F_per_m = C_base_factor * K_air;

                    calculationSteps.push(`<strong>4. Capacitance per Unit Length (Bare Probe):</strong>`);
                    calculationSteps.push(`Base Factor = (2 &times; &pi; &times; &epsilon;₀) / ln(R<sub>t</sub> / R<sub>p</sub>) = ${C_base_factor.toExponential(3)} F/m`);
                    calculationSteps.push(`For Liquid (C'<sub>liquid</sub>) = Base Factor &times; K<sub>liquid</sub> = ${C_base_factor.toExponential(3)} &times; ${K_liquid.toFixed(2)} = <strong>${C_prime_liquid_F_per_m.toExponential(3)} F/m</strong>`);
                    calculationSteps.push(`For Air (C'<sub>air</sub>) = Base Factor &times; K<sub>air</sub> = ${C_base_factor.toExponential(3)} &times; ${K_air.toFixed(2)} = <strong>${C_prime_air_F_per_m.toExponential(3)} F/m</strong>`);
                }

                const C_empty_calculated_F = C_prime_air_F_per_m * L_m;
                const C_full_calculated_F = C_prime_liquid_F_per_m * L_m;

                const C_empty_calculated_pF = C_empty_calculated_F * 1e12; // Convert to pF
                const C_full_calculated_pF = C_full_calculated_F * 1e12; // Convert to pF

                if (mode === 'capacitance-from-dimensions') {
                    // Calculate Capacitance from Dimensions
                    calcFormula.innerHTML = `
                        C<sub>empty</sub> = C'<sub>air</sub> &times; L <br>
                        C<sub>full</sub> = C'<sub>liquid</sub> &times; L
                    `;
                    calculationSteps.push(`<strong>5. Total Capacitance Calculation from Dimensions:</strong>`);
                    calculationSteps.push(`C<sub>empty</sub> = ${C_prime_air_F_per_m.toExponential(3)} F/m &times; ${L_m.toExponential(2)} m = ${C_empty_calculated_F.toExponential(3)} F = <strong>${C_empty_calculated_pF.toFixed(2)} pF</strong>`);
                    calculationSteps.push(`C<sub>full</sub> = ${C_prime_liquid_F_per_m.toExponential(3)} F/m &times; ${L_m.toExponential(2)} m = ${C_full_calculated_F.toExponential(3)} F = <strong>${C_full_calculated_pF.toFixed(2)} pF</strong>`);

                    results.push({ param: 'Calculated Empty Capacitance (C<sub>empty</sub>)', value: `${C_empty_calculated_pF.toFixed(2)} pF` });
                    results.push({ param: 'Calculated Full Capacitance (C<sub>full</sub>)', value: `${C_full_calculated_pF.toFixed(2)} pF` });
                    calcStatusDisplay.textContent = 'Calculation Status: Capacitance Calculated';
                    calcStatusDisplay.className = 'status-display optimal';
                    recommendations.push("These are theoretical capacitance values. Actual sensor calibration will provide more precise empty and full capacitance values due to fringe effects and non-ideal geometries.");
                    recommendations.push("Ensure the probe and tank dimensions are accurate for reliable theoretical calculations.");
                    if (t_ins_m > 0) {
                        recommendations.push("For insulated probes, the dielectric constant of the insulation material significantly impacts capacitance. Verify its value for accuracy.");
                    }

                } else { // mode === 'level-from-c'
                    const C_measured = parseFloat(measuredCapacitanceInput.value);
                    const C_empty_input = parseFloat(emptyCapacitanceInput.value);
                    const C_full_input = parseFloat(fullCapacitanceInput.value);

                    // Input Validation for Level from Capacitance
                    if (isNaN(C_measured) || C_measured < 0 || isNaN(C_empty_input) || C_empty_input < 0 || isNaN(C_full_input) || C_full_input < 0) {
                        showCustomMessage('Measured, Empty, and Full Capacitance must be non-negative numbers.', 'error');
                        validationError = true;
                    }
                    if (C_empty_input >= C_full_input) {
                        showCustomMessage('Empty Capacitance must be less than Full Capacitance.', 'error');
                        validationError = true;
                    }
                    if (C_measured < C_empty_input || C_measured > C_full_input) {
                        showCustomMessage('Measured Capacitance is outside the calibrated empty-to-full range. Level calculation may be inaccurate or invalid.', 'warning');
                        // Do not set validationError = true, allow calculation but warn.
                    }

                    if (validationError) {
                        resultContainer.style.display = 'none';
                        resultContainer.classList.remove('show');
                        return;
                    }

                    calculationSteps.push(`<strong>3. Level Calculation Parameters:</strong>`);
                    calculationSteps.push(`Measured Capacitance (C<sub>measured</sub>): ${C_measured.toFixed(2)} pF`);
                    calculationSteps.push(`Empty Capacitance (C<sub>empty</sub>): ${C_empty_input.toFixed(2)} pF`);
                    calculationSteps.push(`Full Capacitance (C<sub>full</sub>): ${C_full_input.toFixed(2)} pF`);

                    // Calculate Level (percentage)
                    let level_percent = ((C_measured - C_empty_input) / (C_full_input - C_empty_input)) * 100;
                    level_percent = Math.max(0, Math.min(100, level_percent)); // Clamp between 0 and 100

                    // Calculate Level (in probe length units)
                    const level_length_m = (level_percent / 100) * L_m;
                    let level_length_display = level_length_m;
                    let level_length_unit_display = 'm';

                    // Convert back to original probe length unit for display
                    switch (L_unit) {
                        case 'ft': level_length_display = level_length_m / 0.3048; break;
                        case 'cm': level_length_display = level_length_m / 0.01; break;
                        case 'in': level_length_display = level_length_m / 0.0254; break;
                        default: level_length_display = level_length_m; break;
                    }
                    level_length_unit_display = L_unit;


                    calcFormula.innerHTML = `Level (%) = (C<sub>measured</sub> - C<sub>empty</sub>) / (C<sub>full</sub> - C<sub>empty</sub>) &times; 100%`;
                    calculationSteps.push(`<strong>4. Level Calculation:</strong>`);
                    calculationSteps.push(`Level (%) = (${C_measured.toFixed(2)} - ${C_empty_input.toFixed(2)}) / (${C_full_input.toFixed(2)} - ${C_empty_input.toFixed(2)}) &times; 100%`);
                    calculationSteps.push(`Level (%) = <strong>${level_percent.toFixed(2)} %</strong>`);
                    calculationSteps.push(`Level (${L_unit}) = (${level_percent.toFixed(2)} / 100) &times; ${L_raw.toFixed(3)} ${L_unit} = <strong>${level_length_display.toFixed(2)} ${level_length_unit_display}</strong>`);


                    results.push({ param: 'Calculated Liquid Level', value: `${level_percent.toFixed(2)} %` });
                    results.push({ param: 'Liquid Level (Absolute)', value: `${level_length_display.toFixed(2)} ${level_length_unit_display}` });

                    if (level_percent < 5 || level_percent > 95) {
                        calcStatusDisplay.textContent = 'Calculation Status: Level at Extremes';
                        calcStatusDisplay.className = 'status-display marginal';
                        recommendations.push("The calculated level is near the tank's empty or full point. Ensure the sensor is correctly calibrated for these extremes to avoid inaccuracies.");
                    } else if (level_percent >= 20 && level_percent <= 80) {
                        calcStatusDisplay.textContent = 'Calculation Status: Optimal Range';
                        calcStatusDisplay.className = 'status-display optimal';
                        recommendations.push("The calculated level is within the optimal operating range for most capacitance sensors, providing good accuracy and linearity.");
                    } else {
                        calcStatusDisplay.textContent = 'Calculation Status: Valid';
                        calcStatusDisplay.className = 'status-display adequate';
                        recommendations.push("The calculated level is valid. For critical applications, consider the linearity of your specific sensor over its full range.");
                    }
                    recommendations.push("Ensure the provided empty and full capacitance values are from a recent and accurate calibration of your sensor for the specific liquid.");
                    recommendations.push("The theoretical capacitance values (Empty/Full) based on dimensions and dielectric constants are: Empty = " + C_empty_calculated_pF.toFixed(2) + " pF, Full = " + C_full_calculated_pF.toFixed(2) + " pF. Compare these with your calibrated values for consistency.");
                }

                // Display Results in table
                results.forEach(res => {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell(0);
                    const valueCell = row.insertCell(1);
                    paramCell.innerHTML = res.param;
                    valueCell.innerHTML = res.value;
                });

                // Populate step-by-step calculations
                stepsList.innerHTML = '';
                calculationSteps.forEach(step => {
                    const p = document.createElement('p');
                    p.className = 'calculation-step';
                    p.innerHTML = step;
                    stepsList.appendChild(p);
                });

                practicalRecommendationsDiv.style.display = 'block'; // Show recommendations

                resultContainer.style.display = 'block';
                // Trigger fade-in animation
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    showCustomMessage('Calculation successful!', 'success');
                }, 100);

            });

            // Reset Form Logic
            resetFormBtn.addEventListener('click', function() {
                for (const key in defaultValues) {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = defaultValues[key];
                    }
                }
                toggleCalculationParameters(); // Apply visibility based on reset mode
                showCustomMessage('Form reset to default values.', 'info');
            });

            // Clear Results Logic
            clearResultsBtn.addEventListener('click', function() {
                resultContainer.classList.remove('show');
                setTimeout(() => {
                    resultContainer.style.display = 'none';
                    resultTableBody.innerHTML = '';
                    stepsList.innerHTML = '';
                    calcFormula.innerHTML = '';
                    recommendationsList.innerHTML = '';
                    practicalRecommendationsDiv.style.display = 'none';
                    calcStatusDisplay.textContent = 'Calculation Status: N/A';
                    calcStatusDisplay.className = 'status-display';
                }, 500); // Wait for fade-out transition
                showCustomMessage('Results cleared.', 'info');
            });

            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
            // Initial call to set visibility based on default/saved values
            toggleCalculationParameters();
        });
    </script>
</body>
</html>