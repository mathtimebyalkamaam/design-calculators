<!DOCTYPE html>
<html lang="en">
<head>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Grounding/Earthing System Design Calculator - Design Calculators - Electrical</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --input-bg: #ffffff;
            --input-border-focus: #4CAF50;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.3);
            --hover-color: #446688;
            --input-bg: #446688;
            --input-border-focus: #4CAF50;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }
        /* Ensure H2 is visible in dark mode */
        body.dark-mode .tool-container h2 {
            color: white; /* Explicitly set to white for visibility */
            border-bottom-color: white;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color); /* Ensure label text is visible */
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--input-border-focus);
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.5); /* Primary color with transparency */
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1 1 200px;
        }
        
        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .calculate-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .calculate-btn .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }

        .calculate-btn.loading .spinner {
            display: inline-block;
        }

        .calculate-btn.loading {
            cursor: not-allowed;
            opacity: 0.8;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        /* Ensure H3 is visible in dark mode */
        body.dark-mode .result-container h3 {
            color: white; /* Explicitly set to white for visibility */
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color); /* Ensure visibility in dark mode */
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: transform 0.2s ease-in-out;
        }
        .info-icon:hover {
            transform: scale(1.1);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Increased width for more text */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 10px; /* Increased padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of new width */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.3;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            min-width: 300px;
            text-align: center;
        }
        #custom-message-box.error { background-color: #dc3545; } /* Red */
        #custom-message-box.warning { background-color: #ffc107; color: #333; } /* Amber */
        #custom-message-box.info { background-color: #28a745; } /* Green */

        /* Styles for detailed calculation steps and tips */
        .detailed-calculations, .grounding-tips, .safety-considerations {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--hover-color); /* A lighter background for contrast */
            color: var(--text-color); /* Ensure text visibility */
            animation: fadeIn 0.8s ease-out; /* Add fade-in animation */
        }

        body.dark-mode .detailed-calculations, body.dark-mode .grounding-tips, body.dark-mode .safety-considerations {
            background-color: #3a475a; /* Darker background for contrast in dark mode */
            border-color: #6a7a8f;
        }

        .detailed-calculations h4, .grounding-tips h4, .safety-considerations h4 {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary-color); /* Highlight heading */
        }
        body.dark-mode .detailed-calculations h4, body.dark-mode .grounding-tips h4, body.dark-mode .safety-considerations h4 {
            color: var(--primary-color); /* Use lighter primary color in dark mode */
        }

        .detailed-calculations p, .grounding-tips p, .grounding-tips ul, .safety-considerations p, .safety-considerations ul {
            margin-bottom: 5px;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .grounding-tips ul, .safety-considerations ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        .detailed-calculations strong, .grounding-tips strong, .safety-considerations strong {
            color: var(--secondary-color); /* Highlight key terms in formulas */
        }
        body.dark-mode .detailed-calculations strong, body.dark-mode .grounding-tips strong, body.dark-mode .safety-considerations strong {
            color: var(--primary-color); /* Use lighter primary color for highlights in dark mode */
        }

        /* MathJax rendered formulas will have the desired styling */
        .formula {
            font-family: 'Courier New', Courier, monospace; /* Not strictly needed with MathJax, but good for raw */
            background-color: rgba(0,0,0,0.05); /* Light tint for formula background */
            padding: 2px 5px;
            border-radius: 3px;
            display: inline-block; /* Helps with MathJax inline rendering */
            margin-top: 5px;
            font-size: 0.9em;
        }
        body.dark-mode .formula {
            background-color: rgba(255,255,255,0.05);
        }

        .calculation-step {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .detailed-calculations .calculation-step:last-child {
            border-bottom: none; /* No border after the last step */
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .message-box-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        .input-focus-animation:focus {
            box-shadow: 0 0 0 3px var(--input-border-focus);
            transition: box-shadow 0.3s ease-in-out;
        }
    </style>
    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                processHtmlClass: 'math-content', // Process elements with this class
                ignoreHtmlClass: 'no-mathjax'      // Ignore elements with this class
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy — Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        
        <div class="tool-container">
            <h2>Advanced Grounding/Earthing System Design Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator provides an estimation of earth electrode resistance for both single and multiple vertical rods, incorporating advanced considerations for safety and system design. Effective grounding is crucial for personnel safety and equipment protection. **For accurate design and compliance with safety standards, a detailed soil resistivity study and comprehensive grounding system analysis using specialized software are always required.**</p>
            </div>
        
            <div class="calculator-form">
                <form id="grounding-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="soil-resistivity">Soil Resistivity (Ohm-meter) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The resistivity of the soil ($\rho$) at the installation site. This value should be determined by on-site measurements (e.g., Wenner method).</span></span></label>
                            <input type="number" id="soil-resistivity" min="1" step="1" value="100" class="input-focus-animation" required>
                        </div>
                        <div class="form-group">
                            <label for="rod-length">Earth Rod Length (L) (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The buried length of each earth rod.</span></span></label>
                            <input type="number" id="rod-length" min="0.5" step="0.1" value="3.0" class="input-focus-animation" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rod-diameter">Earth Rod Diameter (d) (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The diameter of each earth rod. Common diameters range from 12mm to 20mm.</span></span></label>
                            <input type="number" id="rod-diameter" min="5" step="1" value="16" class="input-focus-animation" required>
                        </div>
                        <div class="form-group">
                            <label for="number-of-rods">Number of Parallel Rods (N) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The total number of earth rods connected in parallel. For multiple rods, a simplified empirical formula is used to estimate the combined resistance.</span></span></label>
                            <input type="number" id="number-of-rods" min="1" step="1" value="1" class="input-focus-animation">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="rod-spacing">Rod Spacing (S) (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The distance between adjacent rods. For efficient multiple rod systems, spacing should ideally be 2 to 2.2 times the rod length to minimize mutual resistance effects.</span></span></label>
                            <input type="number" id="rod-spacing" min="0" step="0.1" value="6.0" class="input-focus-animation">
                        </div>
                        <div class="form-group">
                            <label for="fault-current">Maximum Fault Current ($I_f$) (A) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum symmetrical fault current that the grounding system might experience. Critical for safety potential calculations.</span></span></label>
                            <input type="number" id="fault-current" min="1" step="1" value="5000" class="input-focus-animation" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fault-duration">Fault Duration ($t_f$) (s) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The duration of the fault current. Affects permissible touch and step voltages. (e.g., 0.5s for typical relay operation)</span></span></label>
                            <input type="number" id="fault-duration" min="0.01" step="0.01" value="0.2" class="input-focus-animation" required>
                        </div>
                        <div class="form-group">
                            <label for="surface-resistivity">Surface Layer Resistivity ($\rho_s$) (Ohm-meter) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Resistivity of the surface layer (e.g., gravel, concrete) for safety potential calculations. If same as soil, enter soil resistivity.</span></span></label>
                            <input type="number" id="surface-resistivity" min="1" step="1" value="3000" class="input-focus-animation" required>
                        </div>
                    </div>
                    
                    <button type="button" id="calculate-grounding-btn" class="calculate-btn">
                        Calculate Earth Resistance <span class="spinner"></span>
                    </button>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Summarized results will be dynamically inserted here -->
                    </tbody>
                </table>
                
                <!-- Detailed calculations section -->
                <div id="detailed-calculations" class="detailed-calculations mt-6 math-content">
                    <h3>Detailed Calculation Steps</h3>
                    <!-- Detailed calculation steps will be dynamically inserted here -->
                </div>

                <!-- Safety Considerations Section -->
                <div id="safety-considerations" class="safety-considerations mt-6 math-content">
                    <h3>Safety Considerations: Step and Touch Potentials</h3>
                    <p>Understanding step and touch potentials is crucial for ensuring safety around grounding systems during fault conditions. The calculated values are compared against permissible limits defined by standards like IEEE Std 80.</p>
                    <div id="safety-details">
                        <!-- Safety potential details will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Grounding Tips Section -->
                <div id="grounding-tips" class="grounding-tips mt-6">
                    <h3>Important Considerations for Grounding System Design</h3>
                    <p>Effective grounding is a cornerstone of electrical safety and system reliability. Beyond basic resistance calculations, consider these critical factors:</p>
                    <ul>
                        <li>
                            <strong>Soil Resistivity Measurement:</strong> The most critical parameter. Always conduct on-site soil resistivity tests (e.g., Wenner four-pin method) across various depths and locations to get accurate data. Soil resistivity can vary significantly with moisture content, temperature, and geological composition.
                        </li>
                        <li>
                            <strong>Multi-Layer Soil:</strong> Real-world soil is rarely uniform. For accurate designs, especially for larger systems, multi-layer soil models (e.g., two-layer, three-layer) and specialized software (e.g., CDEGS, ETAP) are necessary to account for varying resistivity with depth. This calculator uses a simplified single-layer model.
                        </li>
                        <li>
                            <strong>Target Resistance:</strong> The desired earth resistance depends on the application (e.g., power substations, industrial facilities, residential). Common targets are typically 1 Ohm to 5 Ohms, but specific standards (e.g., NEC, local codes) must be followed.
                        </li>
                        <li>
                            <strong>Step and Touch Potentials:</strong> During a fault, potential differences can arise on the ground surface.
                            <ul>
                                <li><strong>Step Potential:</strong> Voltage difference between two points on the ground surface, separated by a distance of one step (approx. 1 meter).</li>
                                <li><strong>Touch Potential:</strong> Voltage difference between a grounded object (e.g., transformer tank, fence) and a point on the ground surface where a person is standing while touching the object.</li>
                            </ul>
                            These must be kept below safe limits to prevent electrocution. IEEE Std 80 provides detailed methods for calculating and controlling these potentials.
                        </li>
                        <li>
                            <strong>Fault Current and Duration:</strong> The magnitude and duration of fault currents directly influence the required grounding system design, especially for safety potentials. Higher fault currents and longer durations require more robust grounding.
                        </li>
                        <li>
                            <strong>Electrode Material and Corrosion:</strong> Common materials include copper, copper-clad steel, and galvanized steel. Consider soil chemistry and potential for corrosion, which can degrade the electrode over time.
                        </li>
                        <li>
                            <strong>Grounding System Geometry:</strong> The arrangement of electrodes (e.g., single rod, multiple rods, grid, counterpoise) significantly impacts the overall resistance and potential distribution. For multiple rods, sufficient spacing (typically 2 to 2.2 times the rod length) is crucial to minimize mutual resistance.
                        </li>
                        <li>
                            <strong>Maintenance:</strong> Grounding systems require periodic inspection and testing to ensure their integrity and continued effectiveness.
                        </li>
                    </ul>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400"><em>Grounding system design is a complex engineering discipline. This tool provides an estimate for educational and preliminary purposes. Always consult with a qualified electrical engineer and adhere to local electrical codes and international standards (e.g., IEEE Std 80, IEC 60364 series) for precise design, safety compliance, and robust system performance.</em></p>
                </div>
                <!-- END Grounding Tips Section -->

                <div class="standard-reference" id="standard-reference-text">
                    <p>Grounding system design calculations should adhere to relevant international standards and recommended practices such as: <br>
                    - <strong>IEEE Std 80:</strong> IEEE Guide for Safety in AC Substation Grounding. <br>
                    - <strong>IEC 60364-5-54:</strong> Low-voltage electrical installations - Part 5-54: Selection and erection of electrical equipment - Earthing arrangements and protective conductors. <br>
                    - <strong>National Electrical Code (NEC) / IEC 60364:</strong> Electrical installations of buildings (for general earthing and safety considerations). <br>
                    - <strong>IEEE Std 81:</strong> IEEE Guide for Measuring Earth Resistivity, Ground Impedance, and Earth Surface Potentials of a Ground System.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <p>Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Electrical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Electrical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box -->
    <div id="custom-message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-grounding-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReferenceText = document.getElementById('standard-reference-text');
            const numberOfRodsInput = document.getElementById('number-of-rods');
            const rodSpacingInput = document.getElementById('rod-spacing');
            const rodLengthInput = document.getElementById('rod-length');
            const detailedCalculationsDiv = document.getElementById('detailed-calculations');
            const safetyConsiderationsDiv = document.getElementById('safety-considerations');
            const safetyDetailsDiv = document.getElementById('safety-details');
            const groundingTipsDiv = document.getElementById('grounding-tips');

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                // Check for saved theme preference
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            calculateBtn.addEventListener('click', function() {
                // Show spinner and disable button
                calculateBtn.classList.add('loading');
                calculateBtn.disabled = true;

                // Get input values
                const soilResistivity = parseFloat(document.getElementById('soil-resistivity').value); // Ohm-meter
                const rodLength = parseFloat(rodLengthInput.value); // meters
                const rodDiameter = parseFloat(document.getElementById('rod-diameter').value); // millimeters
                const numberOfRods = parseInt(numberOfRodsInput.value); // Number of rods
                const rodSpacing = parseFloat(rodSpacingInput.value); // meters
                const faultCurrent = parseFloat(document.getElementById('fault-current').value); // Amps
                const faultDuration = parseFloat(document.getElementById('fault-duration').value); // Seconds
                const surfaceResistivity = parseFloat(document.getElementById('surface-resistivity').value); // Ohm-meter

                // Input validation
                if (isNaN(soilResistivity) || isNaN(rodLength) || isNaN(rodDiameter) || isNaN(numberOfRods) || 
                    isNaN(faultCurrent) || isNaN(faultDuration) || isNaN(surfaceResistivity)) {
                    displayMessage("Please fill in all required fields with valid numbers.", "error", true); // Added true for shake
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }

                if (soilResistivity <= 0 || rodLength <= 0 || rodDiameter <= 0 || numberOfRods <= 0 ||
                    faultCurrent <= 0 || faultDuration <= 0 || surfaceResistivity <= 0) {
                    displayMessage("Please enter positive values for all inputs.", "error", true); // Added true for shake
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }

                if (numberOfRods > 1 && (isNaN(rodSpacing) || rodSpacing <= 0)) {
                    displayMessage("For multiple rods, please enter a positive value for rod spacing.", "error", true); // Added true for shake
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }

                // Clear previous results and sections
                resultTableBody.innerHTML = '';
                detailedCalculationsDiv.innerHTML = '<h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Detailed Calculation Steps</h3>';
                safetyDetailsDiv.innerHTML = ''; // Clear previous safety details
                resultContainer.style.display = 'none';
                groundingTipsDiv.style.display = 'block'; // Ensure tips are visible

                // --- Grounding Resistance Calculation Logic ---
                const rodRadiusMeters = (rodDiameter / 2) / 1000; // Convert mm to meters

                let earthResistanceSingleRod = 0;
                if (rodLength > 0 && rodRadiusMeters > 0) {
                    // Dwight's formula approximation for single vertical rod
                    earthResistanceSingleRod = (soilResistivity / (2 * Math.PI * rodLength)) * (Math.log((4 * rodLength) / rodRadiusMeters) - 1);
                } else {
                    displayMessage("Invalid rod dimensions. Length and diameter must be greater than zero.", "error", true);
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }

                let totalEarthResistance = earthResistanceSingleRod;
                let combiningFactorK = 1; // Default for single rod

                if (numberOfRods > 1) {
                    // Empirical combining factor (K) for parallel rods.
                    // This is a simplification; actual K depends on specific array geometry and spacing.
                    // A commonly cited empirical formula for rods in a line or square array:
                    combiningFactorK = (0.377527 * Math.log(numberOfRods)) + 0.89057; // This is a general empirical fit.
                    totalEarthResistance = earthResistanceSingleRod * combiningFactorK;

                    // Warning for inadequate spacing
                    const recommendedMinSpacing = 2 * rodLength; // Typically 2 to 2.2 times rod length
                    if (rodSpacing < recommendedMinSpacing) {
                        displayMessage(`Warning: Rod spacing (${rodSpacing.toFixed(1)} m) is less than the recommended minimum (${recommendedMinSpacing.toFixed(1)} m = 2 * Rod Length). This can significantly reduce the efficiency of the multiple rod system due to mutual resistance effects.`, "warning");
                    }
                } else {
                    // Ensure spacing input is cleared or disabled if only one rod is selected
                    rodSpacingInput.value = '';
                }
                
                // --- Safety Potential Calculations (IEEE Std 80 Simplified) ---
                // Current Distribution Factor (Cs) - Simplified from IEEE Std 80
                // Cs = 1 - (0.09 * (1 - (rho_s / rho)))
                // If surface resistivity is less than or equal to soil resistivity, Cs is 1 (no improvement).
                let Cs = 1;
                if (surfaceResistivity > soilResistivity) {
                    Cs = 1 - (0.09 * (1 - (soilResistivity / surfaceResistivity))); // Corrected formula for Cs
                    // Note: IEEE Std 80 has more complex charts/formulas for Cs based on layer thickness and geometry.
                    // This is a common simplification for a uniform surface layer over uniform soil.
                }

                // Permissible Touch Voltage (E_touch_permissible)
                // Using IEEE Std 80-2000, for 50kg person (more conservative):
                const K_touch_50 = 0.116; // Constant for 50kg person, from IEEE Std 80
                const E_touch_permissible = (1000 + 1.5 * Cs * surfaceResistivity) * K_touch_50 / Math.sqrt(faultDuration);

                // Permissible Step Voltage (E_step_permissible)
                // Using IEEE Std 80-2000, for 50kg person (more conservative):
                const K_step_50 = 0.116; // Constant for 50kg person, from IEEE Std 80
                const E_step_permissible = (1000 + 6 * Cs * surfaceResistivity) * K_step_50 / Math.sqrt(faultDuration);

                // Ground Potential Rise (GPR)
                const GPR = faultCurrent * totalEarthResistance;

                // Display Detailed Calculations
                addDetailedCalculationStep(
                    "Step 1: Resistance of a Single Earth Rod ($R_1$)",
                    `Formula (Dwight's approximation, adapted): $$R_1 = \\frac{\\rho}{2 \\pi L} \\left( \\ln \\left(\\frac{4 L}{a}\\right) - 1 \\right)$$`,
                    `Where: <br> $\\rho$ = Soil Resistivity = ${soilResistivity.toFixed(2)} &#8486;&middot;m <br> $L$ = Rod Length = ${rodLength.toFixed(2)} m <br> $a$ = Rod Radius = (Rod Diameter / 2) / 1000 = (${rodDiameter.toFixed(0)} mm / 2) / 1000 = ${rodRadiusMeters.toFixed(4)} m <br> $\\ln$ = Natural Logarithm <br> Calculation: $R_1 = \\frac{${soilResistivity.toFixed(2)}}{2 \\cdot ${Math.PI.toFixed(5)} \\cdot ${rodLength.toFixed(2)}} \\left( \\ln \\left(\\frac{4 \\cdot ${rodLength.toFixed(2)}}{${rodRadiusMeters.toFixed(4)}}\\right) - 1 \\right) = ${earthResistanceSingleRod.toFixed(3)} \\text{ &#8486;}$`
                );

                if (numberOfRods > 1) {
                    addDetailedCalculationStep(
                        "Step 2: Combining Factor (K) for Multiple Parallel Rods",
                        `Formula (Empirical Approximation): $$K = 0.377527 \\cdot \\ln(N) + 0.89057$$`,
                        `Where: <br> $N$ = Number of Parallel Rods = ${numberOfRods} <br> $\\ln$ = Natural Logarithm <br> Calculation: $K = 0.377527 \\cdot \\ln(${numberOfRods}) + 0.89057 = ${combiningFactorK.toFixed(3)}$`
                    );
                    addDetailedCalculationStep(
                        "Step 3: Total Earth Resistance ($R_{\\text{total}}$) for Parallel Rods",
                        `Formula: $$R_{\\text{total}} = R_1 \\cdot K$$`,
                        `Where: <br> $R_1$ = Resistance of Single Rod = ${earthResistanceSingleRod.toFixed(3)} &#8486; <br> $K$ = Combining Factor = ${combiningFactorK.toFixed(3)} <br> Calculation: $R_{\\text{total}} = ${earthResistanceSingleRod.toFixed(3)} \\text{ &#8486;} \\cdot ${combiningFactorK.toFixed(3)} = ${totalEarthResistance.toFixed(3)} \\text{ &#8486;}$`
                    );
                } else {
                    // If only one rod, the total resistance is the single rod resistance.
                    addDetailedCalculationStep(
                        "Step 2: Total Earth Resistance ($R_{\\text{total}}$) for Single Rod",
                        `Formula: $$R_{\\text{total}} = R_1$$`,
                        `Where: <br> $R_1$ = Resistance of Single Rod = ${earthResistanceSingleRod.toFixed(3)} &#8486; <br> Calculation: $R_{\\text{total}} = ${earthResistanceSingleRod.toFixed(3)} \\text{ &#8486;}$`
                    );
                }

                addDetailedCalculationStep(
                    "Step 4: Ground Potential Rise (GPR)",
                    `Formula: $$GPR = I_f \\cdot R_{\\text{total}}$$`,
                    `Where: <br> $I_f$ = Maximum Fault Current = ${faultCurrent.toFixed(0)} A <br> $R_{\\text{total}}$ = Total Earth Resistance = ${totalEarthResistance.toFixed(3)} &#8486; <br> Calculation: $GPR = ${faultCurrent.toFixed(0)} \\text{ A} \\cdot ${totalEarthResistance.toFixed(3)} \\text{ &#8486;} = ${GPR.toFixed(2)} \\text{ V}$`
                );

                addDetailedCalculationStep(
                    "Step 5: Current Distribution Factor ($C_s$)",
                    `Formula (Simplified): $$C_s = 1 - 0.09 \\left(1 - \\frac{\\rho}{\\rho_s}\\right) \\text{ (if } \\rho_s > \\rho \\text{, else } C_s = 1)$$`,
                    `Where: <br> $\\rho$ = Soil Resistivity = ${soilResistivity.toFixed(2)} &#8486;&middot;m <br> $\\rho_s$ = Surface Layer Resistivity = ${surfaceResistivity.toFixed(0)} &#8486;&middot;m <br> Calculation: ${surfaceResistivity > soilResistivity ? `$C_s = 1 - 0.09 \\left(1 - \\frac{${soilResistivity.toFixed(2)}}{${surfaceResistivity.toFixed(0)}}\\right) = ${Cs.toFixed(3)}$` : `$C_s = 1$ (since $\\rho_s \\le \\rho$ or for conservative estimate)`}`
                );

                addDetailedCalculationStep(
                    "Step 6: Permissible Touch Voltage ($E_{\\text{touch-permissible}}$) (IEEE Std 80, 50kg person)",
                    `Formula: $$E_{\\text{touch-permissible}} = \\frac{(1000 + 1.5 \\cdot C_s \\cdot \\rho_s) \\cdot K_{\\text{touch}}}{\\sqrt{t_f}}$$`,
                    `Where: <br> $K_{\\text{touch}}$ = ${K_touch_50} (Constant for 50kg person) <br> $C_s$ = Current Distribution Factor = ${Cs.toFixed(3)} <br> $\\rho_s$ = Surface Layer Resistivity = ${surfaceResistivity.toFixed(0)} &#8486;&middot;m <br> $t_f$ = Fault Duration = ${faultDuration.toFixed(2)} s <br> Calculation: $E_{\\text{touch-permissible}} = \\frac{(1000 + 1.5 \\cdot ${Cs.toFixed(3)} \\cdot ${surfaceResistivity.toFixed(0)}) \\cdot ${K_touch_50}}{\\sqrt{${faultDuration.toFixed(2)}}} = ${E_touch_permissible.toFixed(2)} \\text{ V}$`
                );

                addDetailedCalculationStep(
                    "Step 7: Permissible Step Voltage ($E_{\\text{step-permissible}}$) (IEEE Std 80, 50kg person)",
                    `Formula: $$E_{\\text{step-permissible}} = \\frac{(1000 + 6 \\cdot C_s \\cdot \\rho_s) \\cdot K_{\\text{step}}}{\\sqrt{t_f}}$$`,
                    `Where: <br> $K_{\\text{step}}$ = ${K_step_50} (Constant for 50kg person) <br> $C_s$ = Current Distribution Factor = ${Cs.toFixed(3)} <br> $\\rho_s$ = Surface Layer Resistivity = ${surfaceResistivity.toFixed(0)} &#8486;&middot;m <br> $t_f$ = Fault Duration = ${faultDuration.toFixed(2)} s <br> Calculation: $E_{\\text{step-permissible}} = \\frac{(1000 + 6 \\cdot ${Cs.toFixed(3)} \\cdot ${surfaceResistivity.toFixed(0)}) \\cdot ${K_step_50}}{\\sqrt{${faultDuration.toFixed(2)}}} = ${E_step_permissible.toFixed(2)} \\text{ V}$`
                );

                // Summarized results for the table
                addResultRow("Soil Resistivity (ρ)", `${soilResistivity.toFixed(2)} &#8486;&middot;m`);
                addResultRow("Earth Rod Length (L)", `${rodLength.toFixed(2)} m`);
                addResultRow("Earth Rod Diameter (d)", `${rodDiameter.toFixed(2)} mm`);
                addResultRow("Number of Parallel Rods (N)", numberOfRods);
                if (numberOfRods > 1) {
                    addResultRow("Rod Spacing (S)", `${rodSpacing.toFixed(2)} m`);
                    addResultRow("Single Rod Resistance", `${earthResistanceSingleRod.toFixed(3)} &#8486;`);
                    addResultRow("Combining Factor (K)", combiningFactorK.toFixed(3));
                }
                addResultRow("<strong>Total Earth Resistance (R_total)</strong>", `<strong>${totalEarthResistance.toFixed(3)} &#8486;</strong>`);
                addResultRow("Maximum Fault Current (I_f)", `${faultCurrent.toFixed(0)} A`);
                addResultRow("Fault Duration (t_f)", `${faultDuration.toFixed(2)} s`);
                addResultRow("Surface Layer Resistivity (ρ_s)", `${surfaceResistivity.toFixed(0)} &#8486;&middot;m`);
                addResultRow("Current Distribution Factor (C_s)", Cs.toFixed(3));
                addResultRow("<strong>Ground Potential Rise (GPR)</strong>", `<strong>${GPR.toFixed(2)} V</strong>`);
                addResultRow("Permissible Touch Voltage", `${E_touch_permissible.toFixed(2)} V`);
                addResultRow("Permissible Step Voltage", `${E_step_permissible.toFixed(2)} V`);

                // Safety Details Section
                let safetyHtml = '';
                safetyHtml += `<p><strong>Ground Potential Rise (GPR):</strong> ${GPR.toFixed(2)} V</p>`;
                safetyHtml += `<p><strong>Permissible Touch Voltage:</strong> ${E_touch_permissible.toFixed(2)} V</p>`;
                safetyHtml += `<p><strong>Permissible Step Voltage:</strong> ${E_step_permissible.toFixed(2)} V</p>`;
                
                safetyHtml += `<p class="mt-4"><strong>Safety Assessment:</strong></p><ul>`;
                if (GPR < E_touch_permissible && GPR < E_step_permissible) {
                    safetyHtml += `<li class="text-green-600 dark:text-green-400">The calculated GPR (${GPR.toFixed(2)} V) is below both permissible touch and step voltages. This indicates a potentially safe design based on these simplified calculations.</li>`;
                } else {
                    safetyHtml += `<li class="text-red-600 dark:text-red-400"><strong>Warning:</strong> The calculated GPR (${GPR.toFixed(2)} V) is higher than the permissible touch voltage (${E_touch_permissible.toFixed(2)} V) or permissible step voltage (${E_step_permissible.toFixed(2)} V). This system may not be safe during a fault. Further detailed analysis and design modifications (e.g., adding more electrodes, using a ground grid, improving surface layer) are required.</li>`;
                }
                safetyHtml += `</ul><p class="mt-2 text-sm text-gray-600 dark:text-gray-400"><em>Note: Actual step and touch potentials are complex and depend on the precise geometry of the grounding system and fault current distribution. These are simplified comparisons. A detailed study with specialized software (e.g., CDEGS) is essential for critical installations.</em></p>`;
                safetyDetailsDiv.innerHTML = safetyHtml;


                standardReferenceText.innerHTML = `<p>Grounding system design principles are guided by standards such as: <br>
                - <strong>IEEE Std 80:</strong> IEEE Guide for Safety in AC Substation Grounding (provides detailed methods for calculating and controlling step and touch potentials). <br>
                - <strong>IEC 60364-5-54:</strong> Low-voltage electrical installations - Part 5-54: Selection and erection of electrical equipment - Earthing arrangements and protective conductors. <br>
                - <strong>National Electrical Code (NEC) / IEC 60364:</strong> Electrical installations of buildings (for general earthing and safety considerations). <br>
                - <strong>IEEE Std 81:</strong> IEEE Guide for Measuring Earth Resistivity, Ground Impedance, and Earth Surface Potentials of a Ground System.</p>`;
                
                resultContainer.style.display = 'block';
                resultContainer.scrollIntoView({ behavior: 'smooth' }); // Scroll to results

                // Important: Trigger MathJax to render the new content after a small delay
                // This ensures all dynamically added content, including safety details, is processed.
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    setTimeout(() => {
                        window.MathJax.typesetPromise([detailedCalculationsDiv, safetyConsiderationsDiv]);
                        calculateBtn.classList.remove('loading');
                        calculateBtn.disabled = false;
                    }, 200); // Small delay for DOM to settle
                } else {
                    // Fallback if MathJax is not available/loaded
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                }
            });

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info", animate = false) {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                // Remove previous type classes
                messageBox.classList.remove('error', 'warning', 'info', 'message-box-shake');
                messageBox.classList.add(type);
                if (animate) {
                    messageBox.classList.add('message-box-shake');
                }
                messageBox.style.opacity = 1;

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            // Helper function to add a row to the summary result table
            function addResultRow(parameter, value) {
                const row = document.createElement('tr');
                
                const paramCell = document.createElement('td');
                paramCell.innerHTML = parameter; // Use innerHTML to allow strong tag
                paramCell.classList.add('font-medium');
                
                const valueCell = document.createElement('td');
                valueCell.innerHTML = value; // Use innerHTML to allow strong tag
                
                row.appendChild(paramCell);
                row.appendChild(valueCell);
                
                resultTableBody.appendChild(row);
            }

            // Helper function to add a detailed calculation step
            function addDetailedCalculationStep(stepTitle, formulaText, calculationText) {
                const stepDiv = document.createElement('div');
                stepDiv.classList.add('calculation-step');

                const titleElem = document.createElement('h4');
                titleElem.textContent = stepTitle;
                stepDiv.appendChild(titleElem);

                if (formulaText) {
                    const formulaElem = document.createElement('p');
                    formulaElem.innerHTML = formulaText; 
                    stepDiv.appendChild(formulaElem);
                }

                if (calculationText) {
                    const calcElem = document.createElement('p');
                    calcElem.innerHTML = calculationText; // Use innerHTML to allow MathJax to process
                    stepDiv.appendChild(calcElem);
                }
                detailedCalculationsDiv.appendChild(stepDiv);

                // IMPORTANT: Tell MathJax to re-render the newly added content immediately
                // This is crucial for fixing the $ signs issue.
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    window.MathJax.typesetPromise([stepDiv]);
                }
            }

            // Enable/Disable Rod Spacing based on Number of Rods
            numberOfRodsInput.addEventListener('input', function() {
                const currentRodLength = parseFloat(rodLengthInput.value); 
                if (parseInt(this.value) > 1) {
                    rodSpacingInput.removeAttribute('disabled');
                    rodSpacingInput.setAttribute('required', 'required'); // Make spacing required for multiple rods
                    if (!isNaN(currentRodLength) && currentRodLength > 0) {
                        rodSpacingInput.value = (currentRodLength * 2).toFixed(1); // Pre-fill with a reasonable default
                    } else {
                        rodSpacingInput.value = ''; // Clear if rod length is not valid
                    }
                } else {
                    rodSpacingInput.setAttribute('disabled', 'disabled');
                    rodSpacingInput.removeAttribute('required');
                    rodSpacingInput.value = ''; // Clear spacing if only one rod
                }
            });

            // Initial state check for spacing input on page load
            const initialRodLength = parseFloat(rodLengthInput.value);
            if (parseInt(numberOfRodsInput.value) <= 1) {
                rodSpacingInput.setAttribute('disabled', 'disabled');
                rodSpacingInput.removeAttribute('required');
                rodSpacingInput.value = '';
            } else {
                rodSpacingInput.removeAttribute('disabled');
                rodSpacingInput.setAttribute('required', 'required');
                if (!isNaN(initialRodLength) && initialRodLength > 0) {
                    rodSpacingInput.value = (initialRodLength * 2).toFixed(1);
                }
            }
        });
    </script>
</body>

</html>

