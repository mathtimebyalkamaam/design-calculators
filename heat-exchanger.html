<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- The title from your original file has been retained -->
    <title>Heat Exchanger Design - Design Calculators - Mechanical</title>
    
    <!-- Meta tags, scripts, and links from the new file -->
    <meta name="description" content="Professional Heat Exchanger calculator. Calculate Area using LMTD method or Effectiveness, NTU, and Outlet Temperatures using the E-NTU method.">
    <meta name="keywords" content="heat exchanger calculator, LMTD, E-NTU, effectiveness, number of transfer units, mechanical engineering">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-23Y1V450SR');
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- MathJax script from the new file -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- MathJax configuration from your original file -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- The complete CSS block from the new file has been used -->
    <style>
        @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
        }

        @keyframes shimmer {
        0% { background-position: -1000px 0; }
        100% { background-position: 1000px 0; }
        }

        :root {
        --primary-color: #1E3A8A;
        --secondary-color: #2563EB;
        --accent-color: #F59E0B;
        --success-color: #10B981;
        --bg-color: #F8FAFC;
        --card-bg: #FFFFFF;
        --text-color: #4B5563;
        --heading-color: #111827;
        --footer-bg: #0F172A;
        --border-color: #E2E8F0;
        --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
        --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
        --primary-color: #10B981;
        --secondary-color: #34D399;
        --bg-color: #0F172A;
        --card-bg: #1E293B;
        --text-color: #CBD5E1;
        --heading-color: #F1F5F9;
        --footer-bg: #020617;
        --border-color: #334155;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        line-height: 1.8;
        transition: background-color 0.3s, color 0.3s;
        margin: 0;
        padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* HEADER */
        .header {
        background: var(--gradient-primary);
        color: white;
        padding: 24px 0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        animation: slideIn 0.5s ease;
        }

        .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        }

        .logo-container {
        display: flex;
        align-items: center;
        gap: 16px;
        text-decoration: none;
        color: white;
        }

        .logo-text {
        font-size: 1.75rem;
        font-weight: 800;
        font-family: 'Montserrat', sans-serif;
        }

        .nav-links {
        display: flex;
        gap: 24px;
        list-style: none;
        margin: 0;
        padding: 0;
        }

        .nav-links a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s;
        }

        .nav-links a:hover {
        color: var(--accent-color);
        transform: translateY(-2px);
        }

        .theme-toggle {
        display: flex;
        align-items: center;
        gap: 12px;
        }

        .theme-toggle .icon {
        color: white;
        font-size: 1.2rem;
        }

        .switch {
        position: relative;
        width: 56px;
        height: 30px;
        }

        .switch input {
        opacity: 0;
        width: 0;
        height: 0;
        }

        .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0,0,0,0.2);
        transition: .4s;
        border-radius: 30px;
        }

        .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
        }

        input:checked + .slider {
        background-color: var(--accent-color);
        }

        input:checked + .slider:before {
        transform: translateX(26px);
        }

        main {
        padding: 40px 0;
        max-width: 1000px;
        margin: 0 auto;
        }

        /* Back button removed, so style is no longer needed */
        /*
        .back-button {
        display: inline-block;
        background-color: var(--primary-color);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        text-decoration: none;
        margin-bottom: 20px;
        transition: all 0.3s;
        font-weight: 600;
        animation: fadeInUp 0.5s ease;
        }

        .back-button:hover {
        background-color: var(--secondary-color);
        transform: translateY(-2px);
        }
        */

        .tool-container {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 30px;
        box-shadow: var(--card-shadow);
        margin-bottom: 30px;
        animation: fadeInUp 0.6s ease;
        }

        .tool-container h2 {
        color: var(--primary-color);
        border-bottom: 3px solid var(--primary-color);
        padding-bottom: 15px;
        margin-top: 0;
        margin-bottom: 25px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.8rem;
        }
        
        .tool-container h3 {
            color: var(--primary-color);
            margin-top: 25px;
        }

        .tool-description {
        margin-bottom: 25px;
        font-size: 1rem;
        line-height: 1.8;
        }
        
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }

        .calculator-form {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 25px;
        margin-top: 25px;
        box-shadow: var(--card-shadow);
        }

        .form-group {
        margin-bottom: 20px;
        animation: slideIn 0.5s ease;
        }

        .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--heading-color);
        }

        .form-group input, .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-size: 1rem;
        transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 12px rgba(30, 58, 138, 0.25);
        outline: none;
        transform: scale(1.02);
        }

        .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        }

        .button-group {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
        }

        .calculate-btn, .reset-btn, .download-btn {
        padding: 14px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 700;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        }

        .calculate-btn {
        background: var(--gradient-primary);
        color: white;
        flex: 1;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }

        .calculate-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        animation: pulse 0.6s ease;
        }

        .reset-btn {
        background: linear-gradient(135deg, #EF4444, #DC2626);
        color: white;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .reset-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        .download-btn {
        background: linear-gradient(135deg, #10B981, #059669);
        color: white;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .download-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .result-container {
        margin-top: 40px;
        padding: 30px;
        border-radius: 12px;
        background-color: var(--card-bg);
        box-shadow: var(--card-shadow);
        display: none;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.6s ease;
        }

        .result-container.show {
        display: block;
        opacity: 1;
        transform: translateY(0);
        }

        .result-container h3 {
        color: var(--primary-color);
        margin-bottom: 25px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.6rem;
        }

        #calculation-details {
        background-color: var(--bg-color);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 25px;
        animation: fadeInUp 0.7s ease;
        }

        #calculation-details h4 {
        color: var(--secondary-color);
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 1.2rem;
        }

        #calculation-details p.formula {
        font-family: 'Times New Roman', serif;
        font-size: 1.1rem;
        text-align: center;
        padding: 15px;
        background: linear-gradient(90deg, transparent, rgba(var(--border-color), 0.5), transparent);
        border-radius: 6px;
        margin: 15px 0;
        overflow-x: auto;
        }
        
        body.dark-mode #calculation-details p.formula {
             background: linear-gradient(90deg, transparent, rgba(var(--border-color), 0.1), transparent);
        }

        #calculation-details p.calculation-step {
        font-family: 'Courier New', monospace;
        background-color: var(--card-bg);
        padding: 10px 12px;
        border-radius: 4px;
        border-left: 4px solid var(--secondary-color);
        margin-bottom: 10px;
        }

        #calculation-details ul {
        list-style-type: disc;
        margin-left: 25px;
        padding-left: 0;
        }

        .result-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 8px;
        overflow: hidden;
        animation: fadeInUp 0.8s ease;
        }

        .result-table th, .result-table td {
        padding: 14px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
        }

        .result-table th {
        background: var(--gradient-primary);
        color: white;
        font-weight: 700;
        }

        .result-table tr:nth-child(even) {
        background-color: rgba(0,0,0,0.02);
        }
        
        body.dark-mode .result-table tr:nth-child(even) {
            background-color: rgba(255,255,255,0.02);
        }

        .result-table tr:hover {
        background-color: rgba(37, 99, 235, 0.1);
        transform: scale(1.01);
        transition: all 0.3s;
        }
        
        body.dark-mode .result-table tr:hover {
            background-color: rgba(16, 185, 129, 0.1);
        }

        .standard-reference {
        margin-top: 25px;
        font-style: italic;
        font-size: 0.95rem;
        padding: 15px;
        background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.05));
        border-left: 4px solid var(--accent-color);
        border-radius: 6px;
        line-height: 1.7;
        animation: fadeInUp 0.9s ease;
        }

        .info-icon {
        color: var(--primary-color);
        margin-left: 6px;
        cursor: help;
        transition: transform 0.3s;
        }

        .info-icon:hover {
        transform: scale(1.2) rotate(10deg);
        }

        .tooltip {
        position: relative;
        display: inline-block;
        }

        .tooltip .tooltiptext {
        visibility: hidden;
        width: 260px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1000;
        bottom: 130%;
        left: 50%;
        margin-left: -130px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.85rem;
        white-space: normal;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
        }

        #custom-message-box {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(-100px);
        padding: 16px 28px;
        border-radius: 8px;
        box-shadow: 0 6px 16px rgba(0,0,0,0.25);
        z-index: 10000;
        font-weight: 600;
        color: white;
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        #custom-message-box.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
        }

        /* FOOTER */
        footer {
        background: var(--gradient-dark);
        color: #CBD5E1;
        padding: 50px 0 20px 0;
        margin-top: 40px; /* Added margin-top from original file */
        }

        .footer-content {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 40px;
        margin-bottom: 30px;
        }

        .footer-col {
        flex: 1;
        min-width: 200px;
        }

        .footer-col h4 {
        color: white;
        margin-bottom: 15px;
        font-weight: 700;
        }

        .footer-col ul {
        list-style: none;
        padding: 0;
        margin: 0;
        }

        .footer-col ul li {
        margin-bottom: 10px;
        }

        .footer-col a {
        color: #CBD5E1;
        text-decoration: none;
        transition: all 0.3s;
        }

        .footer-col a:hover {
        color: var(--accent-color);
        transform: translateX(3px);
        }

        .footer-disclaimer {
        text-align: center;
        margin: 30px auto;
        padding-top: 25px;
        border-top: 1px solid #334155;
        max-width: 800px;
        font-size: 0.9rem;
        line-height: 1.6;
        }

        .footer-bottom {
        text-align: center;
        padding-top: 20px;
        font-size: 0.9rem;
        color: #94A3B8;
        }

        .creator-name {
        color: var(--secondary-color);
        font-weight: bold;
        }

        .social-buttons {
        display: flex;
        gap: 12px;
        margin-top: 15px;
        }

        .social-btn {
        width: 40px;
        height: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        border-radius: 50%;
        text-decoration: none;
        transition: all 0.3s;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .social-btn:hover {
        transform: translateY(-4px) scale(1.1);
        box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.email { background-color: #7f8c8d; } /* Added from original file */


        @media (max-width: 768px) {
        .navbar { flex-direction: column; gap: 20px; }
        .nav-links { flex-direction: column; gap: 12px; text-align: center; }
        .form-row { grid-template-columns: 1fr; }
        .button-group { flex-direction: column; }
        .calculate-btn, .reset-btn, .download-btn { width: 100%; }
        .footer-content { flex-direction: column; }
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- NEW HEADER -->
    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <!-- Back button has been removed as requested -->
            
        <div class="tool-container">
            <!-- Added icon to h2 -->
            <h2><i class="fas fa-sync-alt"></i> Heat Exchanger Design Calculator</h2>
            <div class="tool-description">
                <p>This calculator assists in the design and analysis of heat exchangers using two fundamental methods:</p>
                <ul>
                    <li><strong>Log Mean Temperature Difference (LMTD) Method:</strong> Suitable for known inlet and outlet temperatures of both fluids and helps determine the required heat transfer area.</li>
                    <li><strong>Effectiveness-Number of Transfer Units (Effectiveness-NTU) Method:</strong> Ideal when only inlet temperatures are known and the heat exchanger performance (effectiveness) or size (NTU) needs to be evaluated.</li>
                </ul>
                <p>Choose the appropriate method and unit system, input your fluid and heat exchanger parameters, and let the tool calculate the key design values.</p>
            </div>

            <div class="calculator-form">
                <form id="heat-exchanger-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="calculation-method">Calculation Method: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Choose between LMTD method (for known outlet temperatures) or Effectiveness-NTU method (for unknown outlet temperatures).</span></span></label>
                            <select id="calculation-method" required>
                                <option value="lmtd">LMTD Method</option>
                                <option value="ntu">Effectiveness-NTU Method</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (e.g., kW, kg/s, °C) or Imperial (e.g., BTU/h, lb/s, °F) units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (kW, kg/s, °C)</option>
                                <option value="imperial">Imperial (BTU/h, lb/s, °F)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="hx-type">Heat Exchanger Type: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the type of heat exchanger for specific LMTD correction factor (F) or Effectiveness-NTU correlations.</span></span></label>
                        <select id="hx-type" required>
                            <option value="parallel">Parallel Flow</option>
                            <option value="counter">Counter Flow</option>
                            <option value="shell-1-2">Shell and Tube (1 shell pass, 2 tube passes)</option>
                            <option value="shell-1-multi">Shell and Tube (1 shell pass, 4, 6, ... tube passes)</option>
                            <option value="cross-unmixed">Cross Flow (one fluid unmixed, one mixed)</option>
                            <option value="cross-mixed">Cross Flow (both fluids mixed)</option>
                        </select>
                    </div>

                    <h3>Hot Fluid Parameters</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="m_h">Mass Flow Rate (\( \dot{m}_h \)): <span class="mass-flow-unit-label">(kg/s)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Mass flow rate of the hot fluid.</span></span></label>
                            <input type="number" id="m_h" step="0.01" value="0.5" required>
                        </div>
                        <div class="form-group">
                            <label for="cp_h">Specific Heat Capacity (\( C_{p,h} \)): <span class="cp-unit-label">(kJ/kg°C)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Specific heat capacity of the hot fluid.</span></span></label>
                            <input type="number" id="cp_h" step="0.01" value="4.18" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="T_h_in">Inlet Temperature (\( T_{h,in} \)): <span class="temp-unit-label">(°C)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inlet temperature of the hot fluid.</span></span></label>
                            <input type="number" id="T_h_in" step="0.1" value="90" required>
                        </div>
                        <div class="form-group" id="T_h_out_group">
                            <label for="T_h_out">Outlet Temperature (\( T_{h,out} \)): <span class="temp-unit-label">(°C)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Outlet temperature of the hot fluid (required for LMTD, optional for NTU).</span></span></label>
                            <input type="number" id="T_h_out" step="0.1" value="50">
                        </div>
                    </div>

                    <h3>Cold Fluid Parameters</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="m_c">Mass Flow Rate (\( \dot{m}_c \)): <span class="mass-flow-unit-label">(kg/s)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Mass flow rate of the cold fluid.</span></span></label>
                            <input type="number" id="m_c" step="0.01" value="0.4" required>
                        </div>
                        <div class="form-group">
                            <label for="cp_c">Specific Heat Capacity (\( C_{p,c} \)): <span class="cp-unit-label">(kJ/kg°C)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Specific heat capacity of the cold fluid.</span></span></label>
                            <input type="number" id="cp_c" step="0.01" value="4.18" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="T_c_in">Inlet Temperature (\( T_{c,in} \)): <span class="temp-unit-label">(°C)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inlet temperature of the cold fluid.</span></span></label>
                            <input type="number" id="T_c_in" step="0.1" value="20" required>
                        </div>
                        <div class="form-group" id="T_c_out_group">
                            <label for="T_c_out">Outlet Temperature (\( T_{c,out} \)): <span class="temp-unit-label">(°C)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Outlet temperature of the cold fluid (required for LMTD, optional for NTU).</span></span></label>
                            <input type="number" id="T_c_out" step="0.1" value="40"> <!-- Changed default from 60 to 40 for parallel flow to avoid negative dT2 -->
                        </div>
                    </div>

                    <!-- LMTD-only inputs -->
                    <div class="lmtd-only">
                        <h3>Overall Heat Transfer Coefficient & Area</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="U_overall">Overall Heat Transfer Coefficient (\( U \)): <span class="U-unit-label">(kW/m²°C)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Overall heat transfer coefficient.</span></span></label>
                                <input type="number" id="U_overall" step="0.1" value="0.8">
                            </div>
                            <div class="form-group" id="area-group">
                                <label for="area">Heat Transfer Area (\( A \)): <span class="area-unit-label">(m²)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Heat transfer surface area. (This is typically an output for LMTD, but can be an input).</span></span></label>
                                <input type="number" id="area" step="0.01" value="">
                            </div>
                        </div>
                    </div>

                    <!-- NTU-only inputs -->
                    <div class="ntu-only" style="display: none;">
                        <h3>NTU & Coefficient Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="NTU">Number of Transfer Units (NTU): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dimensionless parameter for heat exchanger size (Leave blank to calculate from U and Area, or fill in to calculate Q).</span></span></label>
                                <input type="number" id="NTU_input" step="0.01" value="">
                            </div>
                            <div class="form-group">
                                <label for="U_overall_ntu">Overall Heat Transfer Coefficient (\( U \)): <span class="U-unit-label">(kW/m²°C)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Overall heat transfer coefficient (Required if NTU is blank).</span></span></label>
                                <input type="number" id="U_overall_ntu" step="0.1" value="0.8">
                            </div>
                            <div class="form-group">
                                <label for="area_ntu">Heat Transfer Area (\( A \)): <span class="area-unit-label">(m²)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Heat transfer surface area (Required if NTU is blank).</span></span></label>
                                <input type="number" id="area_ntu" step="0.01" value="">
                            </div>
                        </div>
                    </div>

                    <!-- Updated button group -->
                    <div class="button-group">
                        <button type="button" id="calculate-hx-btn" class="calculate-btn">
                            <i class="fas fa-calculator"></i> Calculate Heat Exchanger
                        </button>
                    </div>
                </form>
            </div>

            <div id="result-container" class="result-container">
                <h3><i class="fas fa-chart-line"></i> Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
        
        <!-- NEW INFORMATIVE CONTENT SECTION -->
        <div class="tool-container" style="margin-top: 40px;">
            <h2><i class="fas fa-book-open"></i> A Comprehensive Guide to Heat Exchanger Design</h2>

            <h3 style="color: var(--primary-color); margin-top: 25px;">What is a Heat Exchanger?</h3>
            <p>A heat exchanger is a device engineered to efficiently transfer thermal energy (heat) from one fluid to another without the fluids mixing. This process is fundamental to countless industrial, commercial, and residential applications. The core purpose is either to cool a hot fluid or to heat a cooler fluid. From the radiator in a car to the massive condensers in a power plant, heat exchangers are the unsung heroes of thermal management.</p>
            <p>The entire process is governed by the principles of thermodynamics, particularly the Second Law, which dictates that heat will always flow from a higher temperature source to a lower temperature sink. The goal of a heat exchanger is to facilitate this flow as efficiently and compactly as possible.</p>

            <h3 style="color: var(--primary-color); margin-top: 25px;">Fundamental Principles of Heat Transfer</h3>
            <p>In a typical heat exchanger, two primary modes of heat transfer are dominant:</p>
            <ul>
                <li><strong>Convection:</strong> This is the heat transfer within the fluids themselves. As a fluid (like water or air) moves over a solid surface (like a pipe wall), heat is transferred between the fluid and the surface. The rate of this transfer is defined by the convection heat transfer coefficient, \(h\).</li>
                <li><strong>Conduction:</strong> This is the heat transfer *through* the solid wall separating the two fluids. Heat moves from the hotter side of the wall to the cooler side. The rate of this transfer is determined by the wall's material (thermal conductivity, \(k\)) and its thickness (\(L\)).</li>
            </ul>
            <p>The overall efficiency of the heat exchanger is dictated by the sum of these thermal resistances, which we'll explore in the "Overall Heat Transfer Coefficient (U)" section.</p>

            <h3 style="color: var(--primary-color); margin-top: 25px;">Classification of Heat Exchangers</h3>
            <p>Heat exchangers can be classified in several ways, but the most common are by flow arrangement and construction.</p>

            <h4>By Flow Arrangement:</h4>
            <ul>
                <li><strong>Parallel Flow:</strong> The hot and cold fluids enter at the same end, flow in the same direction, and exit at the other end. This is the least efficient arrangement because the maximum temperature the cold fluid can reach is limited by the hot fluid's exit temperature. The large temperature difference at the inlet causes high thermal stress.</li>
                <li><strong>Counter Flow:</strong> The hot and cold fluids enter at opposite ends and flow in opposite directions. This is the most efficient arrangement. The cold fluid can be heated to a temperature higher than the hot fluid's *outlet* temperature, allowing for a much closer temperature approach and maximizing the heat recovered.</li>
                <li><strong>Cross Flow:</strong> The two fluids flow at right angles to each other. This is common in applications like a car radiator, where air (one fluid) flows across a series of tubes carrying hot coolant (the other fluid). The fluids can be "mixed" (their temperature is uniform in the direction perpendicular to flow) or "unmixed" (the temperature varies).</li>
            </ul>

            <h4>By Construction Type:</h4>
            <ul>
                <li><strong>Shell and Tube:</strong> The workhorse of the industry. One fluid flows through a bundle of tubes, while the other fluid flows over these tubes within a larger shell. Baffles are often added inside the shell to direct the shell-side fluid across the tubes, increasing turbulence and the heat transfer coefficient. They are robust, can handle high pressures and temperatures, but are less compact.</li>
                <li><strong>Plate and Frame:</strong> Composed of a series of thin, corrugated metal plates. The fluids flow in the narrow channels between adjacent plates, in a counter-flow arrangement. This design creates a very large surface area in a small volume, leading to high efficiency and a compact size. They are common in food processing and HVAC.</li>
                <li><strong>Double Pipe (Hairpin):</strong> The simplest form, consisting of one small pipe concentrically placed inside a larger one. One fluid flows in the inner pipe, and the other flows in the annular space. They are used for small-scale applications and high-pressure scenarios.</li>
            </ul>

            <h3 style="color: var(--primary-color); margin-top: 25px;">Core Calculation Methods Explained</h3>
            <p>This calculator uses the two primary methods for heat exchanger analysis, which serve different purposes.</p>

            <h4>1. The Log Mean Temperature Difference (LMTD) Method</h4>
            <p>The LMTD method is used for <strong>design and sizing</strong>. It's the go-to method when you know all four temperatures (hot in/out, cold in/out) and you want to find the required heat transfer area (\(A\)).</p>
            <p>The fundamental equation is:</p>
            <p class="formula">\[ Q = U \cdot A \cdot \Delta T_{lm} \]</p>
            <ul>
                <li>\(Q\) is the rate of heat transfer (kW or BTU/h).</li>
                <li>\(U\) is the Overall Heat Transfer Coefficient (kW/m²°C or BTU/h ft²°F).</li>
                <li>\(A\) is the required heat transfer surface area (m² or ft²).</li>
                <li>\(\Delta T_{lm}\) is the Log Mean Temperature Difference (°C or °F).</li>
            </ul>
            <p>The \(\Delta T_{lm}\) is the true average temperature difference driving the heat transfer. Its formula depends on the flow arrangement:</p>
            <p class="formula">\[ \Delta T_{lm} = \frac{\Delta T_1 - \Delta T_2}{\ln(\Delta T_1 / \Delta T_2)} \]</p>
            <ul>
                <li>For <strong>Counter Flow</strong>: \(\Delta T_1 = T_{h,in} - T_{c,out}\) and \(\Delta T_2 = T_{h,out} - T_{c,in}\)</li>
                <li>For <strong>Parallel Flow</strong>: \(\Delta T_1 = T_{h,in} - T_{c,in}\) and \(\Delta T_2 = T_{h,out} - T_{c,out}\)</li>
            </ul>
            <p>For complex flows (like shell-and-tube or cross-flow), a <strong>Correction Factor (F)</strong> is applied, as they are not true counter-flow. The equation becomes \(Q = U \cdot A \cdot F \cdot \Delta T_{lm, \text{counterflow}}\). This \(F\) factor is found using charts based on two dimensionless parameters, \(P\) and \(R\).</p>

            <h4>2. The Effectiveness-NTU (ε-NTU) Method</h4>
            <p>The ε-NTU method is used for <strong>performance analysis</strong>. It's the best method when you *don't* know the outlet temperatures but you *do* know the heat exchanger's size (\(A\)) and its coefficient (\(U\)). It's used to predict how an existing heat exchanger will perform.</p>
            <p>It's based on three dimensionless parameters:</p>
            <ul>
                <li><strong>Effectiveness (\(\epsilon\)):</strong> The ratio of the *actual* heat transfer to the *maximum possible* heat transfer.
                <p class="formula">\[ \epsilon = \frac{Q_{\text{actual}}}{Q_{\text{max}}} \]</p>
                Where \(Q_{\text{max}} = C_{\text{min}} \cdot (T_{h,in} - T_{c,in})\)
                </li>
                <li><strong>Heat Capacity Rate (\(C\)):</strong> The rate at which a fluid can absorb or release heat. \(C = \dot{m} \cdot C_p\). We find \(C_h\) and \(C_c\), and identify \(C_{\text{min}}\) (the smaller value) and \(C_{\text{max}}\) (the larger).</li>
                <li><strong>Number of Transfer Units (NTU):</strong> A dimensionless measure of the heat exchanger's "size". A larger NTU means a larger heat exchanger.
                <p class="formula">\[ NTU = \frac{U \cdot A}{C_{\text{min}}} \]</p>
                </li>
            </ul>
            <p>The core of this method is the relationship: \(\epsilon = f(NTU, C_r, \text{flow arrangement})\), where \(C_r = C_{\text{min}} / C_{\text{max}}\). For every flow type, there is a unique formula linking these three parameters. This calculator uses these formulas to find the effectiveness, which then allows us to find the actual heat transfer (\(Q = \epsilon \cdot Q_{\text{max}}\)) and the unknown outlet temperatures.</p>

            <h3 style="color: var(--primary-color); margin-top: 25px;">Critical Design Parameters</h3>
            <ul>
                <li><strong>Overall Heat Transfer Coefficient (U):</strong> This value represents the *total* resistance to heat flow. It combines the resistance from the hot fluid's convection, the wall's conduction, and the cold fluid's convection.
                <p class="formula">\[ \frac{1}{U} = \frac{1}{h_i} + R_w + \frac{1}{h_o} \]</p>
                </li>
                <li><strong>Fouling Factor (R_f):</strong> In the real world, deposits (scale, rust, biological growth) build up on the heat transfer surfaces. This "fouling" adds a significant thermal resistance and *must* be accounted for in design. Engineers add a "fouling factor" to the resistance equation, effectively oversizing the heat exchanger to ensure it still meets performance goals even when dirty.
                <p class="formula">\[ \frac{1}{U_{\text{dirty}}} = \frac{1}{U_{\text{clean}}} + R_{f,i} + R_{f,o} \]</p>
                </li>
                <li><strong>Pressure Drop (ΔP):</strong> The fundamental trade-off. To increase the convection coefficient (\(h\)), fluid velocity and turbulence must be high. However, this dramatically increases the pressure drop, which requires larger, more expensive pumps and consumes more energy. A successful design is a careful balance between maximizing heat transfer and minimizing pressure drop.</li>
            </ul>

        </div>

    </main>

    <!-- NEW FOOTER -->
        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Message box for notifications -->
    <div id="custom-message-box"></div>

    <!-- The original JavaScript logic is retained, with minor tweaks for new CSS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-hx-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            // Input elements
            const calculationMethodSelect = document.getElementById('calculation-method');
            const unitSystemSelect = document.getElementById('unit-system');
            const hxTypeSelect = document.getElementById('hx-type');

            const m_h_input = document.getElementById('m_h');
            const cp_h_input = document.getElementById('cp_h');
            const T_h_in_input = document.getElementById('T_h_in');
            const T_h_out_input = document.getElementById('T_h_out');
            const T_h_out_group = document.getElementById('T_h_out_group');

            const m_c_input = document.getElementById('m_c');
            const cp_c_input = document.getElementById('cp_c');
            const T_c_in_input = document.getElementById('T_c_in');
            const T_c_out_input = document.getElementById('T_c_out');
            const T_c_out_group = document.getElementById('T_c_out_group');

            const U_overall_input = document.getElementById('U_overall'); // For LMTD
            const area_input = document.getElementById('area'); // For LMTD 
            const lmtdOnlyDivs = document.querySelectorAll('.lmtd-only');

            const NTU_input_field = document.getElementById('NTU_input'); // For NTU
            const U_overall_ntu_input = document.getElementById('U_overall_ntu'); // For NTU (U input)
            const area_ntu_input = document.getElementById('area_ntu'); // For NTU (Area input)
            const ntuOnlyDivs = document.querySelectorAll('.ntu-only');

            // Unit Labels
            const massFlowUnitLabels = document.querySelectorAll('.mass-flow-unit-label');
            const cpUnitLabels = document.querySelectorAll('.cp-unit-label');
            const tempUnitLabels = document.querySelectorAll('.temp-unit-label');
            const UUnitLabels = document.querySelectorAll('.U-unit-label');
            const areaUnitLabels = document.querySelectorAll('.area-unit-label');

            const themeSwitch = document.getElementById('theme-switch');
            
            /**
             * Displays a custom message box at the top of the screen.
             * @param {string} message - The message to display.
             * @param {string} type - The type of message ('info', 'error', 'warning').
             */
            function displayMessage(message, type = "info") {
                const messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    console.error("Message box element not found.");
                    return;
                }
                messageBox.textContent = message;
                // Using new theme colors
                if (type === "error") {
                    messageBox.style.backgroundColor = '#EF4444'; // Red
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#F59E0B'; // Amber
                } else {
                    messageBox.style.backgroundColor = '#10B981'; // Green
                }
                messageBox.classList.add('show');
                setTimeout(() => messageBox.classList.remove('show'), 5000);
            }

            /**
             * Updates the visibility of input fields and unit labels based on the selected calculation method and unit system.
             */
            function updateUI() {
                const method = calculationMethodSelect.value;
                const unitSystem = unitSystemSelect.value;

                // Update unit labels
                if (unitSystem === 'imperial') {
                    massFlowUnitLabels.forEach(label => label.innerHTML = '(lb/s)');
                    cpUnitLabels.forEach(label => label.innerHTML = '(BTU/lb°F)');
                    tempUnitLabels.forEach(label => label.innerHTML = '(°F)');
                    UUnitLabels.forEach(label => label.innerHTML = '(BTU/h ft²°F)');
                    areaUnitLabels.forEach(label => label.innerHTML = '(ft²)');

                    // Adjust default values for Imperial
                    if (m_h_input.value === "0.5") m_h_input.value = "1.1"; // Approx 0.5 kg/s
                    if (cp_h_input.value === "4.18") cp_h_input.value = "1"; // Approx for water
                    if (T_h_in_input.value === "90") T_h_in_input.value = "194"; // 90C to F
                    if (T_h_out_input.value === "50") T_h_out_input.value = "122"; // 50C to F
                    if (m_c_input.value === "0.4") m_c_input.value = "0.88"; // Approx 0.4 kg/s
                    if (cp_c_input.value === "4.18") cp_c_input.value = "1";
                    if (T_c_in_input.value === "20") T_c_in_input.value = "68"; // 20C to F
                    if (T_c_out_input.value === "40") T_c_out_input.value = "104"; // 40C to F (updated default)
                    if (U_overall_input.value === "0.8") U_overall_input.value = "140.89"; // 0.8 * 176.11
                    if (U_overall_ntu_input.value === "0.8") U_overall_ntu_input.value = "140.89";

                } else { // Metric
                    massFlowUnitLabels.forEach(label => label.innerHTML = '(kg/s)');
                    cpUnitLabels.forEach(label => label.innerHTML = '(kJ/kg°C)');
                    tempUnitLabels.forEach(label => label.innerHTML = '(°C)');
                    UUnitLabels.forEach(label => label.innerHTML = '(kW/m²°C)');
                    areaUnitLabels.forEach(label => label.innerHTML = '(m²)');

                    // Adjust default values back to Metric
                    if (m_h_input.value === "1.1") m_h_input.value = "0.5";
                    if (cp_h_input.value === "1") cp_h_input.value = "4.18";
                    if (T_h_in_input.value === "194") T_h_in_input.value = "90";
                    if (T_h_out_input.value === "122") T_h_out_input.value = "50";
                    if (m_c_input.value === "0.88") m_c_input.value = "0.4";
                    if (cp_c_input.value === "1") cp_c_input.value = "4.18";
                    if (T_c_in_input.value === "68") T_c_in_input.value = "20";
                    if (T_c_out_input.value === "104") T_c_out_input.value = "40"; // Updated default
                    if (U_overall_input.value === "140.89") U_overall_input.value = "0.8";
                    if (U_overall_ntu_input.value === "140.89") U_overall_ntu_input.value = "0.8";
                }

                // Show/hide groups based on method
                if (method === 'lmtd') {
                    lmtdOnlyDivs.forEach(div => div.style.display = 'block'); // Use 'block' as they are not flex rows
                    ntuOnlyDivs.forEach(div => div.style.display = 'none');
                    T_h_out_group.style.display = 'block'; // Outlet temps required for LMTD
                    T_c_out_group.style.display = 'block'; // Outlet temps required for LMTD
                    U_overall_input.required = true;
                    T_h_out_input.required = true;
                    T_c_out_input.required = true;
                    
                    // NTU inputs not required
                    NTU_input_field.required = false;
                    U_overall_ntu_input.required = false;
                    area_ntu_input.required = false;

                } else { // NTU method
                    lmtdOnlyDivs.forEach(div => div.style.display = 'none');
                    ntuOnlyDivs.forEach(div => div.style.display = 'block'); // Use 'block'
                    
                    // Outlet temps are outputs for NTU, so not required
                    T_h_out_group.style.display = 'block'; // Keep visible, but not required
                    T_c_out_group.style.display = 'block'; // Keep visible, but not required
                    T_h_out_input.required = false;
                    T_c_out_input.required = false;
                    
                    // LMTD inputs not required
                    U_overall_input.required = false;
                    
                    // For NTU, either NTU *or* (U and Area) must be provided
                    const isNTUInputProvided = NTU_input_field.value !== '';
                    if (isNTUInputProvided) {
                        U_overall_ntu_input.required = false;
                        area_ntu_input.required = false;
                    } else {
                        // If NTU is not provided, U and Area are needed to calculate it
                        U_overall_ntu_input.required = true;
                        area_ntu_input.required = true;
                    }
                }
            }

            // Event Listeners for UI updates
            calculationMethodSelect.addEventListener('change', updateUI);
            unitSystemSelect.addEventListener('change', updateUI);
            NTU_input_field.addEventListener('input', updateUI); // Re-check required fields when NTU is typed

            // Initial UI update on load
            updateUI();

            /**
             * Helper function to parse float values from input fields.
             * @param {HTMLElement} inputElement - The input element to parse.
             * @param {string} paramName - The name of the parameter for error messages.
             * @param {boolean} isRequired - Whether the field is currently required.
             * @returns {number|null} Parsed float value or null if invalid.
             */
            function getFloatValue(inputElement, paramName, isRequired = true) {
                const valueStr = inputElement.value;
                if (!valueStr && !isRequired) {
                    return null; // Field is empty but not required
                }
                const value = parseFloat(valueStr);
                if (isNaN(value)) {
                    if (isRequired) {
                         displayMessage(`Please enter a valid number for ${paramName}.`, "error");
                    } else if (valueStr) {
                         displayMessage(`Invalid number entered for ${paramName}.`, "warning");
                    }
                    return null;
                }
                return value;
            }
            
            // --- UNIT CONVERSION FUNCTIONS ---
            function CtoF(C) { return (C * 9/5) + 32; }
            function FtoC(F) { return (F - 32) * 5/9; }
            function Cp_kJ_kgC_to_BTU_lbF(Cp_kJ_kgC) { return Cp_kJ_kgC * 0.238846; }
            function Cp_BTU_lbF_to_kJ_kgC(Cp_BTU_lbF) { return Cp_BTU_lbF / 0.238846; }
            function m_kg_s_to_lb_s(m_kg_s) { return m_kg_s * 2.20462; }
            function m_lb_s_to_kg_s(m_lb_s) { return m_lb_s / 2.20462; }
            function U_kW_m2C_to_BTU_h_ft2F(U_kW_m2C) { return U_kW_m2C * 176.11; } // 1 (kW/m2C) * 1000 (W/kW) * 3.41214 (BTU/h/W) / (10.7639 ft2/m2 * 1.8 F/C)
            function U_BTU_h_ft2F_to_kW_m2C(U_BTU_h_ft2F) { return U_BTU_h_ft2F / 176.11; }
            function Area_m2_to_ft2(m2) { return m2 * 10.7639; }
            function Area_ft2_to_m2(ft2) { return ft2 / 10.7639; }
            function Q_kW_to_BTUh(kW) { return kW * 3412.14; } // 1 kW = 3412.14 BTU/h
            function Q_BTUh_to_kW(BTUh) { return BTUh / 3412.14; }


            /**
             * Calculates the Log Mean Temperature Difference (LMTD).
             * @param {number} dT1 - Temperature difference at one end.
             * @param {number} dT2 - Temperature difference at the other end.
             * @returns {number} LMTD value.
             */
            function calculateLMTD(dT1, dT2) {
                if (Math.abs(dT1 - dT2) < 1e-6) return dT1; // Handle case where dT1 and dT2 are practically equal
                if (dT1 <= 0 || dT2 <= 0) {
                     displayMessage("Invalid temperature differences for LMTD calculation (ΔT1 or ΔT2 is zero or negative). Check temperatures for crossover.", "error");
                     return NaN;
                }
                if (dT1 / dT2 <= 0) {
                    displayMessage("Cannot calculate LMTD: (ΔT1 / ΔT2) is negative. Check temperatures.", "error");
                    return NaN;
                }
                return (dT1 - dT2) / Math.log(dT1 / dT2);
            }

            /**
             * Calculates the correction factor F for LMTD.
             * This remains a simplified placeholder as implementing full P-R charts is complex.
             * @param {string} hxType - Type of heat exchanger.
             * @param {number} R - Heat capacity rate ratio (T_h_in - T_h_out) / (T_c_out - T_c_in)
             * @param {number} P - Temperature effectiveness (T_c_out - T_c_in) / (T_h_in - T_c_in)
             * @returns {number} LMTD correction factor F.
             */
            function calculateF(hxType, R, P) {
                if (hxType === 'parallel' || hxType === 'counter') {
                    return 1.0;
                }
                
                // For Shell-and-Tube (1-2)
                if (hxType === 'shell-1-2') {
                    if (R === 1) {
                         // Special case for R=1
                         const F_num = (Math.sqrt(2) * (1 - P)) / P;
                         const F_den = Math.log( ( (2 - P) * (1 - Math.sqrt(0.5)) ) / ( (2 - P) * (1 + Math.sqrt(0.5)) ) );
                         if (isFinite(F_num / F_den)) return F_num / F_den;
                    } else {
                        const F_num = (Math.sqrt(R*R + 1) / (R - 1)) * Math.log( (2 - P*(1+R-Math.sqrt(R*R+1))) / (2 - P*(1+R+Math.sqrt(R*R+1))) );
                        const F_den = Math.log( (1-P) / (1-P*R) );
                        if (isFinite(F_num / F_den)) return F_num / F_den;
                    }
                }
                
                // Fallback for other complex types or calculation issues
                displayMessage(`F-factor calculation for ${hxType} is complex. A placeholder value (0.9) is used. For exact design, consult P-R charts.`, "warning");
                return 0.9; // Placeholder for other types
            }

            /**
             * Calculates the effectiveness (epsilon) for various heat exchanger types.
             * @param {string} hxType - Type of heat exchanger.
             * @param {number} NTU - Number of Transfer Units.
             * @param {number} C_r - Heat capacity rate ratio (C_min / C_max).
             * @returns {number} Heat exchanger effectiveness.
             */
            function calculateEffectiveness(hxType, NTU, C_r) {
                if (NTU === 0) return 0;
                let epsilon;
                try {
                    if (hxType === 'parallel') {
                        epsilon = (1 - Math.exp(-NTU * (1 + C_r))) / (1 + C_r);
                    } else if (hxType === 'counter') {
                        if (Math.abs(C_r - 1) < 1e-6) { // C_r is 1
                            epsilon = NTU / (1 + NTU);
                        } else {
                            epsilon = (1 - Math.exp(-NTU * (1 - C_r))) / (1 - C_r * Math.exp(-NTU * (1 - C_r)));
                        }
                    } else if (hxType === 'shell-1-2' || hxType === 'shell-1-multi') {
                        const beta = Math.sqrt(1 + C_r * C_r);
                        const num = 1 + Math.exp(-NTU * beta);
                        const den = 1 - Math.exp(-NTU * beta);
                        epsilon = 2 / (1 + C_r + beta * (num / den));
                        if (hxType === 'shell-1-multi' && epsilon > 0.9) {
                            // The 1-2 pass formula becomes less accurate for high passes.
                            // For multi-pass (>=4), it approaches counter-flow.
                            // Let's use counter-flow as an approximation if 1-2 is high
                            let e_counter = calculateEffectiveness('counter', NTU, C_r);
                            epsilon = Math.max(epsilon, e_counter * 0.95); // take the more realistic value
                        }
                    } else if (hxType === 'cross-unmixed') { 
                        // Assuming C_min is unmixed, C_max is mixed (common case)
                        if (Math.abs(C_r) < 1e-6) { // C_r = 0 (isothermal)
                            epsilon = 1 - Math.exp(-NTU);
                        } else {
                             epsilon = (1 / C_r) * (1 - Math.exp(-C_r * (1 - Math.exp(-NTU))));
                        }
                    } else if (hxType === 'cross-mixed') {
                         // Both fluids mixed (less common, less efficient)
                         epsilon = 1 / ( (1 / (1 - Math.exp(-NTU))) + (C_r / (1 - Math.exp(-NTU * C_r))) - 1);
                         if (isNaN(epsilon)) { // Fallback for complex formula issues
                            epsilon = 0.8 * (1 - Math.exp(-NTU * (1 + C_r))) / (1 + C_r); // Parallel flow approx
                         }
                    } else {
                        epsilon = 0; 
                    }
                } catch (e) {
                     displayMessage(`Error calculating effectiveness: ${e.message}`, "error");
                     epsilon = 0;
                }
                return Math.max(0, Math.min(1, epsilon)); // Clamp epsilon between 0 and 1
            }
            
            /**
             * Calculates NTU from Effectiveness (inverse relation).
             * @param {string} hxType - Type of heat exchanger.
             * @param {number} epsilon - Effectiveness.
             * @param {number} C_r - Heat capacity rate ratio (C_min / C_max).
             * @returns {number} NTU.
             */
            function calculateNTU(hxType, epsilon, C_r) {
                if (epsilon === 0) return 0;
                if (epsilon >= 1) return Infinity; // Max effectiveness
                
                try {
                    if (hxType === 'parallel') {
                        return -Math.log(1 - epsilon * (1 + C_r)) / (1 + C_r);
                    } else if (hxType === 'counter') {
                        if (Math.abs(C_r - 1) < 1e-6) { // C_r = 1
                            return epsilon / (1 - epsilon);
                        } else {
                            return (1 / (C_r - 1)) * Math.log((epsilon * C_r - 1) / (epsilon - 1));
                        }
                    } else {
                        // Inverse relations for shell-and-tube and cross-flow are very complex
                        displayMessage(`Inverse NTU calculation for ${hxType} is not supported. NTU can't be calculated from outlet temps for this type.`, "warning");
                        return NaN;
                    }
                } catch (e) {
                     displayMessage(`Error calculating NTU: ${e.message}. Effectiveness may be too high for this C_r.`, "error");
                     return NaN;
                }
            }


            calculateBtn.addEventListener('click', function() {
                // Clear previous results
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                resultContainer.classList.remove('show');
                standardReference.innerHTML = '';

                const method = calculationMethodSelect.value;
                const unitSystem = unitSystemSelect.value;
                const hxType = hxTypeSelect.value;
                
                // --- Get Base Inputs (Required for both methods) ---
                let m_h = getFloatValue(m_h_input, 'Hot Fluid Mass Flow Rate', true);
                let cp_h = getFloatValue(cp_h_input, 'Hot Fluid Specific Heat Capacity', true);
                let T_h_in = getFloatValue(T_h_in_input, 'Hot Fluid Inlet Temperature', true);
                let m_c = getFloatValue(m_c_input, 'Cold Fluid Mass Flow Rate', true);
                let cp_c = getFloatValue(cp_c_input, 'Cold Fluid Specific Heat Capacity', true);
                let T_c_in = getFloatValue(T_c_in_input, 'Cold Fluid Inlet Temperature', true);

                if (m_h === null || cp_h === null || T_h_in === null || m_c === null || cp_c === null || T_c_in === null) {
                    return; // Error message already displayed
                }

                // --- Convert all inputs to SI (Metric) for internal calculations ---
                let m_h_SI = m_h, cp_h_SI = cp_h, T_h_in_SI = T_h_in;
                let m_c_SI = m_c, cp_c_SI = cp_c, T_c_in_SI = T_c_in;
                
                let Q_unit = "kW", LMTD_unit = "°C", U_unit = "kW/m²°C", Area_unit = "m²", Cp_rate_unit = "kW/°C";

                if (unitSystem === 'imperial') {
                    T_h_in_SI = FtoC(T_h_in);
                    T_c_in_SI = FtoC(T_c_in);
                    m_h_SI = m_lb_s_to_kg_s(m_h);
                    cp_h_SI = Cp_BTU_lbF_to_kJ_kgC(cp_h); // Stays as kJ/kg°C (or kJ/kgK)
                    m_c_SI = m_lb_s_to_kg_s(m_c);
                    cp_c_SI = Cp_BTU_lbF_to_kJ_kgC(cp_c);
                    
                    Q_unit = "BTU/h";
                    LMTD_unit = "°F";
                    U_unit = "BTU/h ft²°F";
                    Area_unit = "ft²";
                    Cp_rate_unit = "BTU/h°F";
                }

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                let results = [];

                // --- Common calculations (SI) ---
                const C_h_SI = m_h_SI * cp_h_SI; // Hot fluid heat capacity rate in kW/°C
                const C_c_SI = m_c_SI * cp_c_SI; // Cold fluid heat capacity rate in kW/°C
                const C_min_SI = Math.min(C_h_SI, C_c_SI);
                const C_max_SI = Math.max(C_h_SI, C_c_SI);
                const C_r_SI = C_min_SI / C_max_SI;
                const Q_max_SI = C_min_SI * (T_h_in_SI - T_c_in_SI);
                
                // Display values for C_h and C_c
                let C_h_display = C_h_SI.toFixed(3);
                let C_c_display = C_c_SI.toFixed(3);
                let C_min_display = C_min_SI.toFixed(3);
                let Q_max_display = Q_max_SI.toFixed(2);
                
                if (unitSystem === 'imperial') {
                    C_h_display = Q_kW_to_BTUh(C_h_SI * 1).toFixed(2); // kW/C -> kW/K -> (kJ/sK * 3.412 BTU/h / (W) * 1000 W/kW) / (1.8 F/K)
                    C_c_display = Q_kW_to_BTUh(C_c_SI * 1).toFixed(2);
                    C_min_display = Q_kW_to_BTUh(C_min_SI * 1).toFixed(2);
                    Q_max_display = Q_kW_to_BTUh(Q_max_SI).toFixed(2);
                }


                calculationHtml += `<p><strong>1. Input Parameters & Heat Capacity Rates:</strong></p>`;
                calculationHtml += `<ul>
                    <li>Method: ${method === 'lmtd' ? 'LMTD' : 'Effectiveness-NTU'}</li>
                    <li>HX Type: ${hxTypeSelect.options[hxTypeSelect.selectedIndex].text}</li>
                    <li>Hot Fluid Heat Capacity Rate (\\(C_h = \\dot{m}_h C_{p,h}\\)): ${C_h_display} ${Cp_rate_unit}</li>
                    <li>Cold Fluid Heat Capacity Rate (\\(C_c = \\dot{m}_c C_{p,c}\\)): ${C_c_display} ${Cp_rate_unit}</li>
                    <li>\\(C_{min}\\): ${C_min_display} ${Cp_rate_unit}</li>
                    <li>Heat Capacity Rate Ratio (\\(C_r = C_{min} / C_{max}\\)): ${C_r_SI.toFixed(3)}</li>
                    <li>Maximum Possible Heat Transfer (\\(Q_{max} = C_{min} (T_{h,in} - T_{c,in})\\)): ${Q_max_display} ${Q_unit}</li>
                </ul>`;

                if (method === 'lmtd') {
                    // --- LMTD Method ---
                    let T_h_out = getFloatValue(T_h_out_input, 'Hot Fluid Outlet Temperature', true);
                    let T_c_out = getFloatValue(T_c_out_input, 'Cold Fluid Outlet Temperature', true);
                    let U_overall = getFloatValue(U_overall_input, 'Overall Heat Transfer Coefficient (U)', true);
                    
                    if (T_h_out === null || T_c_out === null || U_overall === null) return;
                    
                    let T_h_out_SI = T_h_out, T_c_out_SI = T_c_out, U_overall_SI = U_overall;
                    
                    if (unitSystem === 'imperial') {
                        T_h_out_SI = FtoC(T_h_out);
                        T_c_out_SI = FtoC(T_c_out);
                        U_overall_SI = U_BTU_h_ft2F_to_kW_m2C(U_overall);
                    }

                    // Validation
                    if (T_h_out_SI >= T_h_in_SI || T_c_out_SI <= T_c_in_SI) {
                        displayMessage("Temperature violation: Hot fluid outlet must be < inlet, and cold fluid outlet must be > inlet.", "error"); return;
                    }
                    if (T_h_out_SI < T_c_in_SI || T_c_out_SI > T_h_in_SI) {
                        displayMessage("Temperature Crossover: Hot fluid cannot exit cooler than cold fluid inlet, and cold fluid cannot exit hotter than hot fluid inlet.", "error"); return;
                    }

                    const Q_h_SI = C_h_SI * (T_h_in_SI - T_h_out_SI);
                    const Q_c_SI = C_c_SI * (T_c_out_SI - T_c_in_SI);
                    const Q_actual_SI = (Q_h_SI + Q_c_SI) / 2;
                    
                    if (Math.abs(Q_h_SI - Q_c_SI) / Q_actual_SI > 0.05) { // 5% tolerance
                        displayMessage(`Heat balance error. Q_h: ${Q_h_SI.toFixed(2)} kW, Q_c: ${Q_c_SI.toFixed(2)} kW. Check inputs.`, "warning");
                    }
                    
                    let dT1_SI, dT2_SI;
                    let dT1_display, dT2_display;

                    if (hxType === 'parallel') {
                        dT1_SI = T_h_in_SI - T_c_in_SI;
                        dT2_SI = T_h_out_SI - T_c_out_SI;
                        dT1_display = T_h_in - T_c_in;
                        dT2_display = T_h_out - T_c_out;
                    } else { // Counter-flow basis for counter, shell-tube, and cross-flow
                        dT1_SI = T_h_in_SI - T_c_out_SI;
                        dT2_SI = T_h_out_SI - T_c_in_SI;
                        dT1_display = T_h_in - T_c_out;
                        dT2_display = T_h_out - T_c_in;
                    }

                    const LMTD_SI = calculateLMTD(dT1_SI, dT2_SI);
                    if (isNaN(LMTD_SI)) return;
                    
                    const P_factor = (T_c_out_SI - T_c_in_SI) / (T_h_in_SI - T_c_in_SI);
                    const R_factor = (T_h_in_SI - T_h_out_SI) / (T_c_out_SI - T_c_in_SI); // This is C_c / C_h
                    const F_factor = calculateF(hxType, R_factor, P_factor); 
                    
                    const LMTD_corrected_SI = LMTD_SI * F_factor;
                    const area_calculated_SI = Q_actual_SI / (U_overall_SI * LMTD_corrected_SI);

                    let Q_display = (unitSystem === 'imperial' ? Q_kW_to_BTUh(Q_actual_SI) : Q_actual_SI).toFixed(2);
                    let LMTD_display = (unitSystem === 'imperial' ? CtoF(LMTD_SI) - CtoF(0) : LMTD_SI).toFixed(2); // Convert delta-C to delta-F
                    let LMTD_corr_display = (unitSystem === 'imperial' ? CtoF(LMTD_corrected_SI) - CtoF(0) : LMTD_corrected_SI).toFixed(2);
                    let Area_display = (unitSystem === 'imperial' ? Area_m2_to_ft2(area_calculated_SI) : area_calculated_SI).toFixed(3);

                    results.push(["Actual Heat Transfer Rate (\\(Q\\))", `<strong>${Q_display} ${Q_unit}</strong>`]);
                    results.push(["LMTD (uncorrected)", `${LMTD_display} ${LMTD_unit}`]);
                    results.push(["LMTD Correction Factor (F)", F_factor.toFixed(3)]);
                    results.push(["Corrected LMTD (\\( \\Delta T_{lm,F} \\))", `<strong>${LMTD_corr_display} ${LMTD_unit}</strong>`]);
                    results.push(["Required Heat Transfer Area (\\( A \\))", `<strong>${Area_display} ${Area_unit}</strong>`]);

                    calculationHtml += `<p><strong>2. Calculate Heat Transfer Rate (\\(Q\\)):</strong></p>`;
                    calculationHtml += `<p class="formula">\\[ Q = \\dot{m} C_p \\Delta T \\]</p>`;
                    calculationHtml += `<p class="calculation-step">\\(Q_h\\) = ${C_h_SI.toFixed(3)} * (${T_h_in_SI.toFixed(2)} - ${T_h_out_SI.toFixed(2)}) = ${Q_h_SI.toFixed(2)} kW</p>`;
                    calculationHtml += `<p class="calculation-step">\\(Q_c\\) = ${C_c_SI.toFixed(3)} * (${T_c_out_SI.toFixed(2)} - ${T_c_in_SI.toFixed(2)}) = ${Q_c_SI.toFixed(2)} kW</p>`;
                    calculationHtml += `<p class="calculation-step">\\(Q_{avg}\\) = ${Q_actual_SI.toFixed(2)} kW</p>`;
                    calculationHtml += `<p><strong>3. Calculate LMTD and Correction Factor (F):</strong></p>`;
                    calculationHtml += `<p class="calculation-step">\\(\\Delta T_1\\) = ${dT1_display.toFixed(2)} ${LMTD_unit}</p>`;
                    calculationHtml += `<p class="calculation-step">\\(\\Delta T_2\\) = ${dT2_display.toFixed(2)} ${LMTD_unit}</p>`;
                    calculationHtml += `<p class="formula">\\[ \\Delta T_{lm} = \\frac{\\Delta T_1 - \\Delta T_2}{\\ln(\\Delta T_1 / \\Delta T_2)} = ${LMTD_display} \\]</p>`;
                    calculationHtml += `<p class="calculation-step">P = ${P_factor.toFixed(3)}, R = ${R_factor.toFixed(3)}</p>`;
                    calculationHtml += `<p class="calculation-step">LMTD Correction Factor (F) = ${F_factor.toFixed(3)}</p>`;
                    calculationHtml += `<p class="formula">\\[ \\Delta T_{lm,F} = F \\cdot \\Delta T_{lm} = ${LMTD_corr_display} \\]</p>`;
                    calculationHtml += `<p><strong>4. Calculate Required Heat Transfer Area (\\(A\\)):</strong></p>`;
                    calculationHtml += `<p class="formula">\\[ A = \\frac{Q}{U \\Delta T_{lm,F}} \\]</p>`;
                    calculationHtml += `<p class="calculation-step">\\(A\\) = \\frac{${Q_actual_SI.toFixed(2)} \\text{ kW}}{${U_overall_SI.toFixed(3)} \\text{ kW/m}²\\text{°C} \\times ${LMTD_corrected_SI.toFixed(2)} \\text{°C}} = ${area_calculated_SI.toFixed(3)} \\text{ m}²</p>`;

                } else {
                    // --- Effectiveness-NTU Method ---
                    let NTU_val = getFloatValue(NTU_input_field, 'NTU', false);
                    let U_overall_ntu = getFloatValue(U_overall_ntu_input, 'Overall Heat Transfer Coefficient (U)', false);
                    let area_ntu = getFloatValue(area_ntu_input, 'Heat Transfer Area (A)', false);

                    let calculated_NTU, calculated_epsilon, calculated_area_SI, Q_actual_SI;
                    
                    if (NTU_val !== null) { // Case 1: NTU is provided
                        calculated_NTU = NTU_val;
                        calculated_epsilon = calculateEffectiveness(hxType, calculated_NTU, C_r_SI);
                        Q_actual_SI = calculated_epsilon * Q_max_SI;
                        if (U_overall_ntu !== null) { // Can also calculate Area
                            let U_ntu_SI = (unitSystem === 'imperial') ? U_BTU_h_ft2F_to_kW_m2C(U_overall_ntu) : U_overall_ntu;
                            calculated_area_SI = (calculated_NTU * C_min_SI) / U_ntu_SI;
                        }
                        calculationHtml += `<p><strong>2. Calculate Effectiveness (\\(\\epsilon\\)) from NTU:</strong></p>`;
                        calculationHtml += `<p class="calculation-step">NTU = ${calculated_NTU.toFixed(3)} (User Provided)</p>`;
                        calculationHtml += `<p class="formula">\\[ \\epsilon = f(NTU, C_r, \\text{Type}) \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(\\epsilon\\) = ${calculated_epsilon.toFixed(4)}</p>`;

                    } else if (U_overall_ntu !== null && area_ntu !== null) { // Case 2: U and A are provided
                        let U_ntu_SI = (unitSystem === 'imperial') ? U_BTU_h_ft2F_to_kW_m2C(U_overall_ntu) : U_overall_ntu;
                        calculated_area_SI = (unitSystem === 'imperial') ? Area_ft2_to_m2(area_ntu) : area_ntu;
                        
                        calculated_NTU = (U_ntu_SI * calculated_area_SI) / C_min_SI;
                        calculated_epsilon = calculateEffectiveness(hxType, calculated_NTU, C_r_SI);
                        Q_actual_SI = calculated_epsilon * Q_max_SI;
                        
                        calculationHtml += `<p><strong>2. Calculate NTU and Effectiveness (\\(\\epsilon\\)):</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ NTU = \\frac{U A}{C_{min}} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(NTU\\) = \\frac{${U_ntu_SI.toFixed(3)} \\times ${calculated_area_SI.toFixed(3)}}{${C_min_SI.toFixed(3)}} = ${calculated_NTU.toFixed(3)}</p>`;
                        calculationHtml += `<p class="formula">\\[ \\epsilon = f(NTU, C_r, \\text{Type}) \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(\\epsilon\\) = ${calculated_epsilon.toFixed(4)}</p>`;
                    
                    } else {
                        displayMessage("For NTU method, please provide either 'NTU' or *both* 'U' and 'Area'.", "error");
                        return;
                    }
                    
                    if (isNaN(calculated_epsilon)) {
                         displayMessage("Failed to calculate effectiveness. Check inputs and formulas.", "error");
                         return;
                    }

                    // Calculate outlet temperatures
                    let T_h_out_SI = T_h_in_SI - (Q_actual_SI / C_h_SI);
                    let T_c_out_SI = T_c_in_SI + (Q_actual_SI / C_c_SI);
                    
                    // Convert results back to user's selected unit system
                    let Q_actual_display = (unitSystem === 'imperial' ? Q_kW_to_BTUh(Q_actual_SI) : Q_actual_SI).toFixed(2);
                    let T_h_out_display = (unitSystem === 'imperial' ? CtoF(T_h_out_SI) : T_h_out_SI).toFixed(2);
                    let T_c_out_display = (unitSystem === 'imperial' ? CtoF(T_c_out_SI) : T_c_out_SI).toFixed(2);
                    let Area_display_ntu = (unitSystem === 'imperial' ? Area_m2_to_ft2(calculated_area_SI) : calculated_area_SI);

                    results.push(["Heat Exchanger Effectiveness (\\( \\epsilon \\))", `<strong>${calculated_epsilon.toFixed(4)}</strong>`]);
                    results.push(["Number of Transfer Units (NTU)", `<strong>${calculated_NTU.toFixed(3)}</strong>`]);
                    results.push(["Actual Heat Transfer Rate (\\(Q\\))", `<strong>${Q_actual_display} ${Q_unit}</strong>`]);
                    results.push(["Hot Fluid Outlet Temperature (\\(T_{h,out}\\))", `<strong>${T_h_out_display} ${tempUnitLabels[0].textContent}</strong>`]);
                    results.push(["Cold Fluid Outlet Temperature (\\(T_{c,out}\\))", `<strong>${T_c_out_display} ${tempUnitLabels[0].textContent}</strong>`]);
                    if (calculated_area_SI) {
                        results.push(["Heat Transfer Area (\\(A\\))", `<strong>${Area_display_ntu.toFixed(3)} ${Area_unit}</strong>`]);
                    }
                    
                    calculationHtml += `<p><strong>3. Calculate Actual Heat Transfer Rate and Outlet Temperatures:</strong></p>`;
                    calculationHtml += `<p class="formula">\\[ Q = \\epsilon Q_{max} \\]</p>`;
                    calculationHtml += `<p class="calculation-step">\\(Q\\) = ${calculated_epsilon.toFixed(4)} \\times ${Q_max_SI.toFixed(2)} = ${Q_actual_SI.toFixed(2)} \\text{ kW}</p>`;
                    calculationHtml += `<p class="formula">\\[ T_{h,out} = T_{h,in} - \\frac{Q}{C_h} \\]</p>`;
                    calculationHtml += `<p class="calculation-step">\\(T_{h,out}\\) = ${T_h_in_SI.toFixed(2)} - \\frac{${Q_actual_SI.toFixed(2)}}{${C_h_SI.toFixed(3)}} = ${T_h_out_SI.toFixed(2)} \\text{ °C}</p>`;
                    calculationHtml += `<p class="formula">\\[ T_{c,out} = T_{c,in} + \\frac{Q}{C_c} \\]</p>`;
                    calculationHtml += `<p class="calculation-step">\\(T_{c,out}\\) = ${T_c_in_SI.toFixed(2)} + \\frac{${Q_actual_SI.toFixed(2)}}{${C_c_SI.toFixed(3)}} = ${T_c_out_SI.toFixed(2)} \\text{ °C}</p>`;
                }

                // Populate results table
                function addResultRow(parameterHtml, valueHtml) {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.innerHTML = parameterHtml;
                    valueCell.innerHTML = valueHtml;
                }
                results.forEach(row => addResultRow(row[0], row[1]));

                // Update calculation details and MathJax rendering
                calculationDetailsDiv.innerHTML = calculationHtml;
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv, resultTableBody])
                        .catch((err) => console.log('MathJax typesetting error: ' + err));
                }

                // Display standard reference
                standardReference.innerHTML = "Heat exchanger design principles are extensively covered in thermodynamics and heat transfer textbooks. For detailed correlations, charts, and limitations, refer to standard texts such as <strong>Cengel, Y. A., & Ghajar, A. J., 'Heat and Mass Transfer: Fundamentals & Applications'</strong> or <strong>Incropera, F. P., et al., 'Fundamentals of Heat and Mass Transfer'</strong>. Consult engineering standards for specific applications.";

                // Show result container
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth' });
                displayMessage("Calculation completed successfully!", "info");
            });

            // Theme switch functionality (from new file)
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }
        });
    </script>
</body>
</html>
