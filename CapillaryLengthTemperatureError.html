<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capillary Length, Response Time & Temperature Error Calculator - Industrial Grade</title>
    <meta name="description" content="Professional Capillary Seal Calculator. Determine Temperature Zero Shift (Head + Stiffness), Response Time (Tau), and Viscosity Lag for Remote Seal Pressure Transmitters.">
    <meta name="keywords" content="remote seal calculator, capillary length error, diaphragm seal response time, fill fluid viscosity, zero shift, temperature drift, dc200 viscosity, syltherm, instrumentation engineering">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial - Matches Symmetrical Components) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Quick Load Buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .highlight { color: var(--success); font-weight: 700; }
        .danger-text { color: var(--danger); font-weight: 700; }

        /* Canvas Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Educational Section Styling */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .insight-card p, .insight-card ul {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text);
        }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(0,0,0,0.03);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid var(--success);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(255,255,255,0.05); }

        /* Vector Input Group Styling (Reused) */
        .vector-input-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Print Styling */
        @media print {
            header, footer, .education-section, .theme-toggle, .button-wrapper, .preset-container { display: none !important; }
            .card { border: none; shadow: none; padding: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 300px; page-break-inside: avoid; }
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-history"></i> Capillary Length & Response Time Calculator</h2>
            
            <div class="tool-description">
                <p>This industrial-grade calculator simulates the performance of <strong>Remote Seal Systems</strong>. It calculates the <strong>Combined Zero Shift Error</strong> (Head + Stiffness) and the dynamic <strong>Time Constant ($\tau$)</strong> to predict sluggishness in control loops caused by viscous fill fluids in long capillaries.</p>
            </div>

            <div class="calculator-form">
                <form id="capillary-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('standard_silicone')"><i class="fas fa-check-circle"></i> Std Silicone (DC200)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('cold_viscous')"><i class="fas fa-snowflake"></i> Cold Outdoor (Viscous)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('high_temp')"><i class="fas fa-fire"></i> High Temp (Syltherm)</button>
                            </div>
                        </div>
                    </div>

                    <!-- Fluid Specs -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. Fill Fluid Properties</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-flask"></i> Fluid Type</div>
                            <div class="form-group">
                                <label for="fluid-type">Selection</label>
                                <select id="fluid-type" onchange="updateFluidProps()">
                                    <option value="dc200_10" selected>DC200 10cSt (Standard)</option>
                                    <option value="dc200_50">DC200 50cSt (High Temp)</option>
                                    <option value="syltherm">Syltherm 800 (Very High Temp)</option>
                                    <option value="halocarbon">Halocarbon (Inert)</option>
                                </select>
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-atom"></i> Physical Data</div>
                            <div class="form-group">
                                <label for="sg-fluid">SG @ 25°C</label>
                                <input type="number" id="sg-fluid" value="0.94" step="0.01">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="viscosity-base">Viscosity @ 25°C [cSt]</label>
                                <input type="number" id="viscosity-base" value="10" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="beta-fluid">Expansion ($\beta$) [1/°C]</label>
                                <input type="number" id="beta-fluid" value="0.00108" step="0.00001">
                            </div>
                        </div>
                    </div>

                    <!-- System Geometry -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Capillary & Seal Geometry</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-ruler"></i> Dimensions</div>
                            <div class="form-group">
                                <label for="cap-length">One-Sided Length [m] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Length of a single leg. Total length = 2x this for balanced system.</span></span></label>
                                <input type="number" id="cap-length" value="5.0" step="0.5">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="cap-id">Capillary ID [mm] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Standard is 1mm or 2mm. Larger ID = Faster Response but more Temp Error.</span></span></label>
                                <input type="number" id="cap-id" value="1.0" step="0.1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="vert-height">Vertical Separation [m] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height difference between Tap and Transmitter (Head Effect).</span></span></label>
                                <input type="number" id="vert-height" value="3.0" step="0.1">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-bullseye"></i> Diaphragm</div>
                            <div class="form-group">
                                <label for="diaphragm-size">Seal Size (Stiffness)</label>
                                <select id="diaphragm-size">
                                    <option value="2">2 inch / DN50 (Stiff)</option>
                                    <option value="3" selected>3 inch / DN80 (Standard)</option>
                                    <option value="4">4 inch / DN100 (Flexible)</option>
                                </select>
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-thermometer-half"></i> Temperatures</div>
                            <div class="form-group">
                                <label for="temp-cal">Calibration Temp [°C]</label>
                                <input type="number" id="temp-cal" value="20" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="temp-amb">Ambient Temp [°C]</label>
                                <input type="number" id="temp-amb" value="40" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Error & Response</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download PDF Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Performance Analysis</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Combined Errors</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Impact</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-info-circle"></i> Insight:</strong>
                            <div id="interpretation-text" style="margin-top: 5px; font-size: 0.95rem;"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Step Response Simulation</h4>
                        <div class="chart-container">
                            <canvas id="responseChart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                            <span style="color: #10B981;">● Process Step</span> &nbsp;
                            <span style="color: #EF4444;">● Transmitter Response</span>
                        </div>
                    </div>
                    <!-- New Schematic Canvas -->
                     <div style="grid-column: 1 / -1; margin-top: 20px;">
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">System Diagram</h4>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="schematicCanvas"></canvas>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Response Time $\tau \propto \nu L / d^4$. Stiffness Error $E = \Delta V / K_{diaphragm}$.
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (MASSIVE) -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: The Three Errors of Remote Seals</h2>
            
            <!-- Insight 1: Head Error -->
            <div class="insight-card">
                <h4><i class="fas fa-weight-hanging"></i> 1. Head Error (Density Effect)</h4>
                <p>This is the most common error in level applications. The oil in the vertical section of the capillary has weight. As temperature rises, the oil expands and becomes less dense. This reduces the hydrostatic head exerted on the transmitter.</p>
                <div class="formula">$$ \Delta P_{head} = \Delta \rho \cdot g \cdot H_{vertical} $$</div>
                <p>For a 10m capillary with Silicone oil, a 40°C temperature rise can cause a zero shift of over 50 mmH2O. This error is purely a function of vertical height, not total length.</p>
            </div>

            <!-- Insight 2: Stiffness Error -->
            <div class="insight-card">
                <h4><i class="fas fa-expand-arrows-alt"></i> 2. Stiffness Error (Volumetric Expansion)</h4>
                <p>Fluids expand with temperature. In a closed capillary system, this expanding volume ($\Delta V$) has nowhere to go but to push against the sensing diaphragm. The diaphragm acts like a spring with a stiffness constant ($K$).</p>
                <div class="formula">$$ \Delta P_{stiff} = \frac{\Delta V_{fluid}}{K_{diaphragm}} $$</div>
                <p><strong>Small Diaphragms = Big Errors:</strong> A 2-inch diaphragm is much stiffer than a 4-inch diaphragm. It resists the expanding oil more, creating a much larger back-pressure error. This is why 3" or 4" seals are preferred for low-pressure measurements. This error depends on Total Length (Total Volume), not just vertical height.</p>
            </div>

            <!-- Insight 3: Time Response -->
            <div class="insight-card">
                <h4><i class="fas fa-clock"></i> 3. Response Time (Viscosity Drag)</h4>
                <p>Pushing oil through a tiny tube takes time. The friction of the fluid against the capillary walls creates a time delay ($\tau$).</p>
                <p><strong>Viscosity is King:</strong> Viscosity is highly temperature-dependent. Silicone oil that flows like water at 25°C turns into honey at -40°C.
                <br><strong>The Diameter Law:</strong> Flow resistance is proportional to $1/d^4$. Reducing the capillary ID from 2mm to 1mm increases the response time by a factor of 16!
                <br><strong>Design Trade-off:</strong> Larger ID improves response time but increases fluid volume, which worsens the Stiffness Error (Temperature Drift). It is a balancing act.</p>
            </div>

            <!-- Insight 4: Cold Startups -->
            <div class="insight-card">
                <h4><i class="fas fa-snowflake"></i> 4. Cold Ambient Effects</h4>
                <p>In winter, outdoor transmitters can become extremely sluggish. If a control loop relies on a fast pressure reading (e.g., surge control), a cold capillary can cause the loop to go unstable or fail to react in time. Heat tracing capillaries is often required not to prevent freezing, but to maintain a constant, low viscosity for speed.</p>
            </div>
            
            <!-- Insight 5: Hydrogen Permeation -->
            <div class="insight-card">
                <h4><i class="fas fa-atom"></i> 5. Hydrogen Permeation (Gold Plating)</h4>
                <p>In certain processes (Refining, Hydrotreating), atomic hydrogen can diffuse through standard SS316 diaphragms. It accumulates in the fill fluid, forming hydrogen gas bubbles. This destroys the vacuum and creates massive drift. <strong>Solution:</strong> Use Gold-Plated diaphragms which act as a hydrogen barrier.</p>
            </div>

            <!-- Insight 6: The Balanced System Myth -->
            <div class="insight-card">
                <h4><i class="fas fa-balance-scale"></i> 6. The Myth of "Balanced" Systems</h4>
                <p>Many engineers assume equal capillary lengths cancel all errors. This is false. Equal lengths cancel <strong>Stiffness Error</strong> (Volume expansion matches), but they do NOT cancel <strong>Head Error</strong> unless the vertical elevation is also identical. If the LP leg drops 5m and the HP leg drops 1m, the LP leg will have 5x the density shift error, regardless of total length.</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Empowering engineers with precision tools for complex analysis. If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li>
                        <li><a href="articles">Articles</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href="sitemap.html">Sitemap</a></li>
                        <<li><a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer">YouTube Channel</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to IEC 60534, ISA 75.01). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let responseChart = null;
        let lastResult = null;

        // Fluid Data
        const fluidDB = {
            'dc200_10': { sg: 0.94, beta: 0.00108, visc25: 10, name: 'DC200 10cSt' },
            'dc200_50': { sg: 0.96, beta: 0.00096, visc25: 50, name: 'DC200 50cSt' },
            'syltherm': { sg: 0.90, beta: 0.00096, visc25: 20, name: 'Syltherm 800' },
            'halocarbon': { sg: 1.85, beta: 0.00120, visc25: 6, name: 'Halocarbon' },
            'neobee': { sg: 0.92, beta: 0.00100, visc25: 9, name: 'Neobee M-20' }
        };

        // Diaphragm Stiffness K (approx volume change per unit pressure)
        // Smaller diaphragm = Stiffer = Lower Vol/Pressure = Higher Error for same expansion
        // K_vol = dV/dP. We need dP = dV / K. So K is Compliance.
        // Let's use Stiffness Factor (dP/dV) in mbar/ml
        const diaphragmDB = {
            '2': { stiffness: 10.0, name: '2 inch / DN50' }, // 10 mbar error per ml expansion
            '3': { stiffness: 1.5, name: '3 inch / DN80' },  // 1.5 mbar per ml
            '4': { stiffness: 0.5, name: '4 inch / DN100' }  // Very flexible
        };

        function updateFluidProps() {
            const key = document.getElementById('fluid-type').value;
            if(key !== 'custom') {
                document.getElementById('sg-fluid').value = fluidDB[key].sg;
                document.getElementById('viscosity-base').value = fluidDB[key].visc25;
                document.getElementById('beta-fluid').value = fluidDB[key].beta;
            }
        }

        function loadPreset(type) {
            if (type === 'standard_silicone') {
                document.getElementById('fluid-type').value = 'dc200_10';
                updateFluidProps();
                document.getElementById('cap-length').value = '5.0';
                document.getElementById('cap-id').value = '1.0';
                document.getElementById('vert-height').value = '3.0';
                document.getElementById('temp-amb').value = '40';
            } else if (type === 'cold_viscous') {
                document.getElementById('fluid-type').value = 'dc200_50'; // Viscous
                updateFluidProps();
                document.getElementById('cap-length').value = '10.0'; // Long
                document.getElementById('cap-id').value = '1.0';
                document.getElementById('vert-height').value = '5.0';
                document.getElementById('temp-amb').value = '-20'; // COLD
            } else if (type === 'high_temp') {
                document.getElementById('fluid-type').value = 'syltherm';
                updateFluidProps();
                document.getElementById('cap-length').value = '3.0';
                document.getElementById('cap-id').value = '2.0'; // Larger ID for speed
                document.getElementById('vert-height').value = '1.0';
                document.getElementById('temp-amb').value = '50';
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Theme handling
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function performCalculation() {
            // 1. Get Inputs
            const sg0 = parseFloat(document.getElementById('sg-fluid').value);
            const visc0 = parseFloat(document.getElementById('viscosity-base').value);
            const beta = parseFloat(document.getElementById('beta-fluid').value);
            
            const L = parseFloat(document.getElementById('cap-length').value); // m
            const d_mm = parseFloat(document.getElementById('cap-id').value); // mm
            const H = parseFloat(document.getElementById('vert-height').value); // m
            
            const t_cal = parseFloat(document.getElementById('temp-cal').value);
            const t_amb = parseFloat(document.getElementById('temp-amb').value);
            
            const sealKey = document.getElementById('diaphragm-size').value;
            const stiffness = diaphragmDB[sealKey].stiffness; // mbar/ml

            if (isNaN(sg0) || isNaN(L) || isNaN(d_mm)) {
                displayMessage("Please enter valid numbers.", "error");
                return;
            }

            // 2. Physics Engine
            const delta_T = t_amb - t_cal;
            
            // A. Head Error (Density)
            // Rho_op = Rho_cal / (1 + beta * dT)
            // Error_head = (Rho_op - Rho_cal) * g * H
            // Approx: Error = - Rho * beta * dT * g * H
            // Using SG: dP (mmH2O) = - SG * beta * dT * H(mm)
            const err_head_mm = -1 * sg0 * beta * delta_T * (H * 1000);
            
            // B. Stiffness Error (Volume)
            // Total Vol V = pi * r^2 * L (Total length usually 2L for dual seal, but input says one-sided length for this calc context. 
            // If it's a level app with 2 seals, expansion happens in both. Assume calculation per leg.
            // Volume in ml. r in cm. L in cm.
            const r_cm = (d_mm / 2) / 10;
            const L_cm = L * 100;
            const Vol_ml = Math.PI * Math.pow(r_cm, 2) * L_cm;
            
            const delta_V_ml = Vol_ml * beta * delta_T;
            const err_stiff_mbar = delta_V_ml * stiffness;
            const err_stiff_mm = err_stiff_mbar * 10.197; // mbar to mmH2O

            // Total Zero Shift
            const total_shift_mm = err_head_mm + err_stiff_mm;

            // C. Response Time (Tau)
            // Viscosity at T_amb. Approx model: log(mu) = A + B/T.
            // Simplified: Viscosity doubles for every 10C drop (very rough but illustrative) or linear interop.
            // Using a simple exponential for estimation: mu = mu0 * exp(-0.02 * (T - 25))
            // Actually, silicone oil viscosity is flatter. ASTM D341 is complex.
            // Let's use a conservative industrial approx: 2% change per degree C.
            // Colder = Thicker.
            const visc_op = visc0 * Math.exp(-0.015 * (t_amb - 25)); // cSt
            
            // Tau = Const * Visc * L / d^4
            // Empirical constant. For 5m, 1mm ID, 10cSt -> ~1-2 sec.
            // Tau (s) = (6.8e-6) * Visc(cSt) * L(cm)^2 / d(cm)^2 ? No, d^4 factor for flow.
            // Industrial Formula (Approx): Tau (s) = [3 * nu(cSt) * L(m)] / [d(mm)^4 * K_stiff_factor]
            // Stiffer diaphragm = Faster response (less volume to move).
            // K_factor ~ stiffness/1.5. 
            const tau = (2.5 * visc_op * L) / (Math.pow(d_mm, 4) * stiffness);
            
            const t90 = 2.3 * tau;

            lastResult = { err_head_mm, err_stiff_mm, total_shift_mm, tau, t90, visc_op, delta_T, Vol_ml, delta_V_ml, L, H };

            // 4. Render Step-by-Step
            let html = `<h4>Step 1: Temperature & Viscosity Analysis</h4>`;
            html += `<div class="calculation-step">`;
            html += `$\Delta T = ${t_amb} - ${t_cal} = ${delta_T.toFixed(1)}^\circ C$.<br>`;
            html += `Fill Fluid Viscosity adjusted for temp: ${visc0} cSt $\\rightarrow$ <strong>${visc_op.toFixed(1)} cSt</strong>.`;
            html += `</div>`;

            html += `<h4>Step 2: Head Error (Density Component)</h4>`;
            html += `<div class="calculation-step">`;
            html += `Error due to weight change of vertical oil column ($H=${H}m$).<br>`;
            html += `$$ E_{head} \\approx -SG \\cdot \\beta \\cdot \\Delta T \\cdot H $$`;
            html += `$$ E_{head} = -${sg0} \\cdot ${beta} \\cdot ${delta_T} \\cdot ${H*1000} = \\mathbf{${err_head_mm.toFixed(1)} \\text{ mmH}_2\\text{O}} $$`;
            html += `</div>`;

            html += `<h4>Step 3: Stiffness Error (Volumetric Component)</h4>`;
            html += `<div class="calculation-step">`;
            html += `Internal Volume $V = ${Vol_ml.toFixed(2)} \\text{ ml}$. Expansion $\\Delta V = ${delta_V_ml.toFixed(3)} \\text{ ml}$.<br>`;
            html += `Diaphragm Stiffness $K = ${stiffness} \\text{ mbar/ml}$.<br>`;
            html += `$$ E_{stiff} = \\Delta V \\times K = ${delta_V_ml.toFixed(3)} \\times ${stiffness} = ${err_stiff_mbar.toFixed(2)} \\text{ mbar} $$`;
            html += `$$ E_{stiff} = \\mathbf{${err_stiff_mm.toFixed(1)} \\text{ mmH}_2\\text{O}} $$`;
            html += `</div>`;

            html += `<h4>Step 4: Response Time Analysis ($\tau$)</h4>`;
            html += `<div class="calculation-step">`;
            html += `$$ \\tau \\propto \\frac{\\nu \\cdot L}{d^4} $$`;
            html += `Time Constant $\\tau = \\mathbf{${tau.toFixed(2)} \\text{ s}}$. (63% response)<br>`;
            html += `Full Response ($T_{90}$) = <strong>${t90.toFixed(2)} s</strong>.`;
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;

            // 5. Update Table
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, u, c="") => {
                tbody.innerHTML += `<tr style="${c ? 'color:'+c : ''}"><td><strong>${n}</strong></td><td>${v}</td><td>${u}</td></tr>`;
            };
            addRow("Total Zero Shift", total_shift_mm.toFixed(1), "mmH2O", Math.abs(total_shift_mm) > 50 ? "var(--danger)" : "");
            addRow("Head Error Component", err_head_mm.toFixed(1), "mmH2O");
            addRow("Stiffness Component", err_stiff_mm.toFixed(1), "mmH2O");
            addRow("Response Time (T90)", t90.toFixed(2), "sec", t90 > 5 ? "var(--warning)" : "var(--success)");

            const interpEl = document.getElementById('interpretation-text');
            if (t90 > 10) {
                interpEl.innerHTML = `<span style="color:var(--danger); font-weight:bold;">SYSTEM TOO SLOW.</span> 10+ second lag is unacceptable for control loops. Increase Capillary ID or Heat Trace.`;
            } else if (Math.abs(total_shift_mm) > 100) {
                interpEl.innerHTML = `<span style="color:var(--warning); font-weight:bold;">High Drift.</span> Expect >100mm error between day/night.`;
            } else {
                interpEl.innerHTML = `Performance acceptable.`;
            }

            // 6. Draw Chart
            drawChart(tau);
            drawSchematic(H, L);

            // 7. Show
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        function drawChart(tau) {
            const ctx = document.getElementById('responseChart').getContext('2d');
            if (window.myChart) window.myChart.destroy();

            // Step response data
            const labels = [];
            const dataProc = [];
            const dataTx = [];
            const duration = tau * 5;
            const points = 50;
            
            for(let i=0; i<=points; i++) {
                const t = (duration/points)*i;
                labels.push(t.toFixed(1));
                dataProc.push(t > 0 ? 100 : 0); // Step at t=0
                const resp = 100 * (1 - Math.exp(-t/tau));
                dataTx.push(resp);
            }

            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Process Step',
                            data: dataProc,
                            borderColor: '#10B981',
                            borderDash: [5,5],
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: 'Transmitter Output',
                            data: dataTx,
                            borderColor: '#EF4444',
                            borderWidth: 2,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: {display:true, text:'Time (s)'} },
                        y: { title: {display:true, text:'Pressure (%)'} }
                    },
                    plugins: {
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    xMin: tau,
                                    xMax: tau,
                                    borderColor: '#3B82F6',
                                    borderWidth: 1,
                                    label: { content: 'Tau (63%)', enabled: true }
                                }
                            }
                        }
                    }
                }
            });
        }

        function drawSchematic(vertical, length) {
            const canvas = document.getElementById('schematicCanvas');
            const ctx = canvas.getContext('2d');
            const cw = canvas.width = 400;
            const ch = canvas.height = 300;

            ctx.clearRect(0, 0, cw, ch);
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 2;
            
            // Draw Flange (Seal)
            ctx.fillStyle = '#9CA3AF';
            const sealX = 60;
            const sealY = 50;
            ctx.fillRect(sealX, sealY, 20, 60); // Flange body
            
            // Draw Transmitter
            const txX = 60;
            // Scale vertical height: Let 200px = max expected height
            // Visual scale only
            const scale = Math.min(200 / vertical, 200/2); // limit scale
            const txY = sealY + 30 + (vertical * 20); // visual offset approx
            
            // But we want to show the path length.
            // If Length > Vertical, coil it.
            
            // Transmitter Body
            ctx.fillStyle = '#1E3A8A';
            ctx.beginPath();
            ctx.arc(txX + 200, 200, 30, 0, 2*Math.PI);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Inter';
            ctx.fillText("PT", txX + 192, 205);
            
            // Draw Capillary
            ctx.beginPath();
            ctx.strokeStyle = '#EF4444'; // Red capillary
            ctx.lineWidth = 3;
            ctx.moveTo(sealX + 20, sealY + 30);
            
            // Simple Bezier curve to represent flexible capillary
            // From seal to transmitter
            ctx.bezierCurveTo(sealX + 100, sealY + 30, txX + 100, 200, txX + 170, 200);
            ctx.stroke();

            // Dimensions
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            // Vertical H
            ctx.beginPath();
            ctx.moveTo(40, sealY + 30);
            ctx.lineTo(40, 200);
            // Arrows
            ctx.moveTo(35, sealY+35); ctx.lineTo(40, sealY+30); ctx.lineTo(45, sealY+35);
            ctx.moveTo(35, 195); ctx.lineTo(40, 200); ctx.lineTo(45, 195);
            ctx.stroke();
            ctx.fillStyle = '#000';
            ctx.fillText(`H = ${vertical}m`, 50, 120);

            ctx.fillStyle = '#666';
            ctx.fillText(`L_cap = ${length}m`, 150, 100);
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            // Header
            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(30, 58, 138); 
            pdf.text('Remote Seal Performance Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. Design Inputs', 14, y);
            y += 5;

            const inputData = [
                ['Temp Change', `${lastResult.delta_T.toFixed(1)} °C`],
                ['Capillary Length', `${document.getElementById('cap-length').value} m`],
                ['Capillary ID', `${document.getElementById('cap-id').value} mm`],
                ['Diaphragm', document.getElementById('diaphragm-size').options[document.getElementById('diaphragm-size').selectedIndex].text]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. Calculated Errors', 14, y);
            y += 5;

            const resData = [
                ['Head Error', `${lastResult.err_head_mm.toFixed(1)} mmH2O`],
                ['Stiffness Error', `${lastResult.err_stiff_mm.toFixed(1)} mmH2O`],
                ['Total Zero Shift', `${lastResult.total_shift_mm.toFixed(1)} mmH2O`],
                ['Response Time (Tau)', `${lastResult.tau.toFixed(2)} s`],
                ['Response Time (T90)', `${lastResult.t90.toFixed(2)} s`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] },
                didParseCell: function(data) {
                    if(data.row.index === 2) {
                        data.cell.styles.fontStyle = 'bold';
                    }
                }
            });

            pdf.save('Seal_Perf_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }
    </script>
</body>
</html>
