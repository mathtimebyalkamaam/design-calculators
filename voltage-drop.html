<!DOCTYPE html>
<html lang="en">
<head>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');     
    </script>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" as="script">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Voltage Drop Calculator - Design Calculators - Electrical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true // Allows \$ to be rendered as $
            },
            options: {
                // Only process elements with the 'mathjax-process' class
                // This ensures MathJax does not interfere with other parts of the DOM
                processHtmlClass: 'mathjax-process', 
                ignoreHtmlClass: 'no-mathjax-process', // Optionally ignore specific classes
                skipHtmlTags: [ // Tags whose content will NOT be processed by MathJax
                    'script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option'
                ]
            }
        };
    </script>
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1d4ed8;
            --bg-color: #f0f4f8; /* Lighter background for a modern feel */
            --text-color: #1f2937;
            --card-bg: #ffffff;
            --border-color: #d1d5db;
            --hover-color: #e0e7eb; /* Slightly darker hover */
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Stronger shadow */
            --input-focus-border: #60a5fa; /* Blue for focus */
            --button-gradient-start: #3b82f6;
            --button-gradient-end: #2563eb;
        }

        /* Dark Mode Variables - Applied when data-theme="dark" is on body */
        body[data-theme="dark"] {
            --bg-color: #1a202c; /* Darker background */
            --text-color: #e2e8f0; /* Lighter text */
            --card-bg: #2d3748; /* Darker card background */
            --border-color: #4a5568;
            --hover-color: #4a5568;
            --input-focus-border: #90cdf4; /* Lighter blue for dark mode focus */
            --button-gradient-start: #4299e1;
            --button-gradient-end: #3182ce;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.4s ease, color 0.4s ease; /* Smoother transitions */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2.5rem 0; /* More padding */
            text-align: center;
            position: relative;
            overflow: hidden; /* For potential future animations */
        }

        header h1 {
            font-size: 2.8rem; /* Larger title */
            margin-bottom: 0.75rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
        }

        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        main {
            padding: 2.5rem 0;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            color: var(--primary-color);
            text-decoration: none;
            margin-bottom: 2.5rem; /* More margin */
            font-weight: 600; /* Bolder */
            transition: color 0.3s ease, transform 0.2s ease;
            font-size: 1.05rem;
        }

        .back-button:hover {
            color: var(--secondary-color);
            transform: translateX(-5px);
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 16px; /* More rounded */
            padding: 2.5rem; /* More padding */
            box-shadow: var(--card-shadow);
            animation: fadeIn 0.8s ease-out; /* Fade in animation for the whole tool */
        }

        .tool-container h2 {
            color: var(--primary-color);
            margin-bottom: 1.2rem;
            font-size: 2.2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .tool-description {
            margin-bottom: 2.5rem;
            color: var(--text-color);
            opacity: 0.9;
            font-size: 1.05rem;
        }

        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px; /* More padding */
            margin-top: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); /* Lighter shadow for inner form */
        }

        .form-group {
            margin-bottom: 20px; /* More spacing */
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 1.05rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px; /* More padding */
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--input-focus-border);
            box-shadow: 0 0 0 3px rgba(var(--input-focus-border-rgb), 0.3); /* Adjusted for var */
        }
        
        /* Define custom CSS properties for RGB values for box-shadow */
        body:not([data-theme="dark"]) {
            --input-focus-border-rgb: 96, 165, 250; /* RGB for #60a5fa */
        }
        body[data-theme="dark"] {
            --input-focus-border-rgb: 144, 205, 244; /* RGB for #90cdf4 */
        }


        .form-row {
            display: flex;
            gap: 20px; /* More gap */
            flex-wrap: wrap;
        }

        .form-row .form-group {
            flex: 1 1 calc(50% - 10px); /* 2 columns on larger screens */
        }

        @media (max-width: 768px) {
            .form-row .form-group {
                flex: 1 1 100%; /* Single column on smaller screens */
            }
        }

        .calculate-btn {
            background: linear-gradient(90deg, var(--button-gradient-start), var(--button-gradient-end));
            color: white;
            border: none;
            padding: 14px 25px; /* More padding */
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.15rem; /* Larger font */
            font-weight: bold;
            margin-top: 20px;
            transition: transform 0.2s ease, box-shadow 0.3s ease, background 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            width: 100%; /* Full width on smaller screens */
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); /* Invert gradient on hover */
        }

        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .result-container {
            margin-top: 35px;
            padding: 2.5rem;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none;
            opacity: 0; /* For fade-in animation */
            transform: translateY(20px); /* For slide-in animation */
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .result-container.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 18px;
            font-size: 2rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 1rem;
        }

        .result-table th, .result-table td {
            padding: 15px; /* More padding */
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .result-table th {
            background-color: var(--hover-color);
            font-weight: 600;
        }

        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            line-height: 1.5;
            padding: 15px;
            background-color: var(--hover-color);
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
        }

        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: transform 0.2s ease;
        }

        .info-icon:hover {
            transform: scale(1.1);
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Wider tooltip */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px; /* More rounded */
            padding: 8px 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            font-size: 0.85rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(-5px); /* Slight lift */
        }

        footer {
            background-color: var(--card-bg);
            padding: 3rem 0; /* More padding */
            margin-top: 5rem; /* More margin */
            border-top: 1px solid var(--border-color);
            text-align: center; /* Center footer content */
        }

        .disclaimer {
            background-color: #fef3c7;
            color: #92400e;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2.5rem;
            border: 1px solid #fde68a;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: left; /* Align disclaimer text left */
        }

        [data-theme="dark"] .disclaimer {
            background-color: #451a03;
            color: #fbbf24;
            border-color: #92400e;
        }

        .disclaimer h3 {
            color: inherit; /* Inherit color from parent */
            margin-bottom: 0.8rem;
            font-size: 1.4rem;
        }

        .credit {
            margin-bottom: 2.5rem;
            font-weight: 500;
            font-size: 1rem;
        }

        .social-share h3 {
            margin-bottom: 1rem;
            color: var(--text-color);
            font-size: 1.2rem;
        }

        .social-buttons {
            display: flex;
            justify-content: center;
            gap: 1.2rem; /* More gap */
            margin-top: 1.5rem;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 48px; /* Larger buttons */
            height: 48px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            font-size: 1.3rem; /* Larger icon */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .social-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .linkedin { background-color: #0077b5; }
        .facebook { background-color: #1877f2; }
        .twitter { background-color: #1da1f2; }
        .whatsapp { background-color: #25d366; }
        .reddit { background-color: #ff4500; }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            visibility: hidden; /* Use visibility to prevent clicks when hidden */
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
            background-color: #28a745; /* Default success green */
        }
        #custom-message-box.show {
            opacity: 1;
            visibility: visible;
        }
        #custom-message-box.error {
            background-color: #dc3545; /* Red for error */
        }
        #custom-message-box.warning {
            background-color: #ffc107; /* Amber for warning */
            color: #333;
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.98em;
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 8px;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.15em;
            text-align: center;
            padding: 15px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            word-wrap: break-word; /* Ensure long lines break */
            white-space: pre-wrap; /* Preserve whitespace and break lines */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-bottom: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
        }

        /* Responsive adjustments for overall layout */
        @media (max-width: 1024px) {
            .container {
                padding: 0 15px;
            }
            header h1 {
                font-size: 2.2rem;
            }
            .subtitle {
                font-size: 1rem;
            }
            .tool-container, .calculator-form, .result-container {
                padding: 2rem;
            }
            .tool-container h2 {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 2rem 0;
            }
            header h1 {
                font-size: 1.8rem;
            }
            .subtitle {
                font-size: 0.9rem;
            }
            .theme-toggle {
                top: 15px;
                right: 15px;
                gap: 8px;
            }
            .switch {
                width: 50px;
                height: 28px;
            }
            .slider:before {
                height: 20px;
                width: 20px;
                left: 3px;
                bottom: 4px;
            }
            input:checked + .slider:before {
                transform: translateX(22px);
            }
            main {
                padding: 1.5rem 0;
            }
            .back-button {
                margin-bottom: 1.5rem;
                font-size: 0.95rem;
            }
            .tool-container, .calculator-form, .result-container {
                padding: 1.5rem;
            }
            .tool-container h2 {
                font-size: 1.6rem;
            }
            .tool-description {
                margin-bottom: 1.5rem;
                font-size: 0.95rem;
            }
            .form-group label {
                font-size: 1rem;
            }
            .form-group input, .form-group select {
                padding: 10px;
                font-size: 0.95rem;
            }
            .form-row {
                gap: 15px;
            }
            .calculate-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            .result-container h3 {
                font-size: 1.5rem;
            }
            .result-table th, .result-table td {
                padding: 10px;
                font-size: 0.9rem;
            }
            .standard-reference {
                font-size: 0.85rem;
                padding: 10px;
            }
            .disclaimer {
                padding: 1rem;
                font-size: 0.9rem;
            }
            .disclaimer h3 {
                font-size: 1.2rem;
            }
            .social-btn {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 1.5rem;
            }
            .subtitle {
                font-size: 0.8rem;
            }
            .theme-toggle {
                flex-direction: column; /* Stack icons and switch */
                right: 10px;
                top: 10px;
                gap: 5px;
            }
            .tool-container, .calculator-form, .result-container {
                padding: 1rem;
            }
            .tool-container h2 {
                font-size: 1.4rem;
            }
            .form-group label {
                font-size: 0.9rem;
            }
            .form-group input, .form-group select {
                font-size: 0.85rem;
            }
            .calculate-btn {
                font-size: 0.95rem;
                padding: 10px 15px;
            }
            .result-table th, .result-table td {
                font-size: 0.8rem;
                padding: 8px;
            }
            .tooltip .tooltiptext {
                width: 180px;
                margin-left: -90px;
                font-size: 0.75rem;
            }
        }

        /* Keyframe animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulseBorder {
            0% { border-color: var(--border-color); }
            50% { border-color: var(--input-focus-border); }
            100% { border-color: var(--border-color); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy — Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        
        <div class="tool-container">
            <h2>Voltage Drop Calculator</h2>
            
            <div class="tool-description">
                <p>Calculate the voltage drop in electrical cables and conductors based on current, distance, and cable specifications according to industry-recognized standards.</p>
            </div>
            
            <div class="calculator-form">
                <form id="voltage-drop-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="load-current">Load Current (A) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The total load current flowing through the cable.</span></span></label>
                            <input type="number" id="load-current" min="0.01" step="0.01" value="10" required>
                        </div>
                        <div class="form-group">
                            <label for="cable-length">Cable Length (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">One-way length of the cable run from the source to the load.</span></span></label>
                            <input type="number" id="cable-length" min="0.1" step="0.1" value="50" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="system-voltage">System Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Nominal line-to-line voltage for AC three-phase systems, or line-to-neutral/line-to-line for single-phase, or terminal voltage for DC.</span></span></label>
                            <input type="number" id="system-voltage" min="1" step="1" value="230" required>
                        </div>
                        <div class="form-group">
                            <label for="phase-type">System Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the electrical system configuration: Single-Phase AC, Three-Phase AC, or DC.</span></span></label>
                            <select id="phase-type" required>
                                <option value="single">Single-Phase AC</option>
                                <option value="three">Three-Phase AC</option>
                                <option value="dc">DC System</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cable-size">Cable Size (mm²) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Cross-sectional area of the conductor in square millimeters.</span></span></label>
                            <select id="cable-size" required>
                                <option value="1.5">1.5 mm²</option>
                                <option value="2.5" selected>2.5 mm²</option>
                                <option value="4">4 mm²</option>
                                <option value="6">6 mm²</option>
                                <option value="10">10 mm²</option>
                                <option value="16">16 mm²</option>
                                <option value="25">25 mm²</option>
                                <option value="35">35 mm²</option>
                                <option value="50">50 mm²</option>
                                <option value="70">70 mm²</option>
                                <option value="95">95 mm²</option>
                                <option value="120">120 mm²</option>
                                <option value="150">150 mm²</option>
                                <option value="185">185 mm²</option>
                                <option value="240">240 mm²</option>
                                <option value="300">300 mm²</option>
                                <option value="400">400 mm²</option>
                                <option value="500">500 mm²</option>
                                <option value="630">630 mm²</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cable-material">Cable Material <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The conductive material of the cable (Copper or Aluminum).</span></span></label>
                            <select id="cable-material" required>
                                <option value="copper">Copper</option>
                                <option value="aluminum">Aluminum</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" id="power-factor-group">
                            <label for="power-factor">Power Factor <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The cosine of the phase angle between voltage and current (for AC systems only). Use 1.0 for purely resistive loads.</span></span></label>
                            <input type="number" id="power-factor" min="0.1" max="1" step="0.01" value="0.85" required>
                        </div>
                        <div class="form-group">
                            <label for="temperature">Conductor Temperature (℃) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The estimated operating temperature of the conductor. This affects its resistance.</span></span></label>
                            <input type="number" id="temperature" min="0" max="90" step="1" value="75" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conduit-material">Conduit Material <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Material of the conduit or raceway. Steel conduits can increase reactance due to magnetic effects.</span></span></label>
                            <select id="conduit-material">
                                <option value="pvc">PVC (Non-Magnetic)</option>
                                <option value="steel">Steel (Magnetic)</option>
                                <option value="aluminum">Aluminum (Non-Magnetic)</option>
                                <option value="none">No Conduit / Open Air</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="calculation-method">Calculation Method <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the standard or method for calculation. "Exact" (Impedance) is recommended for AC.</span></span></label>
                            <select id="calculation-method" required>
                                <option value="simplified">Simplified (Resistance Only)</option>
                                <option value="exact" selected>Exact (Impedance Method)</option>
                                <option value="nec">NEC Method (Approximate K-factor)</option>
                                <option value="iec">IEC Method (Impedance based)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="button" id="calculate-btn" class="calculate-btn">Calculate Voltage Drop</button>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div id="calculation-details" class="mathjax-process">
                    <!-- Detailed calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                    </tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                
                <p>This calculator provides estimations based on widely accepted electrical engineering principles and approximate conductor data. For critical applications, always consult the latest editions of relevant national and international electrical codes (e.g., NEC, IEC), cable manufacturers' data, and professional electrical engineers.</p>
                <p>Factors like complex load profiles, harmonics, specific cable insulation types, grouping of cables, and environmental conditions can significantly impact actual voltage drop and are beyond the scope of this general calculator.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Electrical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Electrical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <div id="custom-message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const phaseTypeSelect = document.getElementById('phase-type');
            const powerFactorGroup = document.getElementById('power-factor-group');
            const powerFactorInput = document.getElementById('power-factor');
            const calculationMethodSelect = document.getElementById('calculation-method');
            const backButton = document.querySelector('.back-button');

            // --- Conductor Data (Illustrative - should ideally come from specific standards/tables) ---
            // Resistivity (rho) in Ohm-mm²/m at 20°C
            const RHO_20C_COPPER = 0.01724;
            const RHO_20C_ALUMINUM = 0.02826;

            // Temperature coefficient of resistance (per °C)
            const ALPHA_COPPER = 0.00393; // at 20°C
            const ALPHA_ALUMINUM = 0.00403; // at 20°C

            // Reactance (X) values in Ohm/km at 50/60Hz (Approximate, highly dependent on cable construction/spacing)
            // Values are per conductor. For more accuracy, use specific cable manufacturer data or tables like NEC Chapter 9, Table 9.
            // These are generally higher for smaller cables and lower for larger cables due to proximity effects.
            const reactancePerKm = {
                '1.5': 0.12, '2.5': 0.11, '4': 0.10, '6': 0.09, '10': 0.085,
                '16': 0.08, '25': 0.078, '35': 0.076, '50': 0.075, '70': 0.074,
                '95': 0.073, '120': 0.072, '150': 0.071, '185': 0.07, '240': 0.069,
                '300': 0.068, '400': 0.067, '500': 0.066, '630': 0.065
            };

            // NEC voltage drop constants (K-factor in Ohm-circular mil per foot) at 75°C
            // These K-factors are simplified and represent an average impedance for common conditions.
            // K = (R * cos(phi) + X * sin(phi)) for AC, or R for DC, * 2 (for round trip)
            // More precise NEC calculations involve detailed R and X values from tables.
            const necKFactors = {
                copper: {
                    dc: 12.9, // Resistivity of copper at 75°C (12.9 Ohm-CM/kft from NEC)
                    ac: { // Approximate impedance K-factors (resistive + reactive) for AC at 75°C
                        '1.5': 13.5, '2.5': 13.4, '4': 13.3, '6': 13.2, '10': 13.1, // Adjusted based on typical impedance
                        '16': 13.0, '25': 12.9, '35': 12.8, '50': 12.7, '70': 12.6,
                        '95': 12.5, '120': 12.4, '150': 12.3, '185': 12.2, '240': 12.1,
                        '300': 12.0, '400': 11.9, '500': 11.8, '630': 11.7
                    }
                },
                aluminum: {
                    dc: 21.2, // Resistivity of aluminum at 75°C (21.2 Ohm-CM/kft from NEC)
                    ac: { // Approximate impedance K-factors for AC at 75°C
                        '1.5': 22.0, '2.5': 21.9, '4': 21.8, '6': 21.7, '10': 21.6,
                        '16': 21.5, '25': 21.4, '35': 21.3, '50': 21.2, '70': 21.1,
                        '95': 21.0, '120': 20.9, '150': 20.8, '185': 20.7, '240': 20.6,
                        '300': 20.5, '400': 20.4, '500': 20.3, '630': 20.2
                    }
                }
            };

            // Convert mm² to circular mils (used for NEC calculations)
            function mmSquaredToCircularMils(mmSquared) {
                // 1 mm^2 = 1973.5 circular mils
                return mmSquared * 1973.5;
            }

            // Convert meters to feet (used for NEC calculations)
            function metersToFeet(meters) {
                return meters * 3.28084;
            }

            // Calculate resistivity at a given temperature using temperature coefficient
            function calculateResistivityAtTemp(rho20C, alpha, tempC) {
                // rho_T = rho_20C * [1 + alpha_20C * (T - 20)]
                return rho20C * (1 + alpha * (tempC - 20));
            }

            // --- Custom Message Box ---
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                messageBox.className = ''; // Clear existing classes
                messageBox.classList.add(type); // Add type class for styling
                messageBox.classList.add('show'); // Show the box

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 5000);
            }

            // --- Calculation Logic ---
            calculateBtn.addEventListener('click', function() {
                // Get input values
                const loadCurrent = parseFloat(document.getElementById('load-current').value);
                const cableLength = parseFloat(document.getElementById('cable-length').value); // in meters
                const systemVoltage = parseFloat(document.getElementById('system-voltage').value);
                const phaseType = phaseTypeSelect.value;
                const cableSize = parseFloat(document.getElementById('cable-size').value); // in mm2
                const cableMaterial = document.getElementById('cable-material').value;
                const powerFactor = parseFloat(document.getElementById('power-factor').value);
                const temperature = parseFloat(document.getElementById('temperature').value); // Conductor Temperature
                const conduitMaterial = document.getElementById('conduit-material').value;
                const calculationMethod = calculationMethodSelect.value;

                // Input validation
                if (isNaN(loadCurrent) || isNaN(cableLength) || isNaN(systemVoltage) || isNaN(powerFactor) || isNaN(temperature) ||
                    loadCurrent <= 0 || cableLength <= 0 || systemVoltage <= 0 || powerFactor <= 0 || powerFactor > 1 || temperature < 0 || temperature > 90) {
                    displayMessage("Please ensure all inputs are valid positive numbers. Power Factor must be between 0.1 and 1.0, Temperature between 0-90°C.", "error");
                    return;
                }

                let voltageDrop = 0;
                let voltageDropPercent = 0;
                let methodDescription = "";
                let standardExplanation = "";
                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';

                // Step 1: Calculate Resistivity at Operating Temperature
                const rho20C = (cableMaterial === 'copper') ? RHO_20C_COPPER : RHO_20C_ALUMINUM;
                const alpha = (cableMaterial === 'copper') ? ALPHA_COPPER : ALPHA_ALUMINUM;
                const rho = calculateResistivityAtTemp(rho20C, alpha, temperature); // Resistivity in Ohm-mm²/m at actual temp

                calculationHtml += `<p><strong>1. Conductor Resistivity ($\\rho_T$):</strong></p>`;
                calculationHtml += `<p>The resistivity of the conductor material at the specified operating temperature. Resistance increases with temperature.</p>`;
                calculationHtml += `<p class="formula">$\\rho_T = \\rho_{20} [1 + \\alpha (T - 20)] \\text{ (Ohm} \\cdot \\text{mm}^2/\\text{m)}$</p>`;
                calculationHtml += `Where:<ul>
                    <li>$\\rho_{20}$ = Resistivity at 20°C = ${rho20C.toFixed(5)} Ohm·mm²/m (${cableMaterial.charAt(0).toUpperCase() + cableMaterial.slice(1)})</li>
                    <li>$\\alpha$ = Temperature Coefficient at 20°C = ${alpha.toFixed(5)} /°C</li>
                    <li>T = Operating Temperature = ${temperature.toFixed(0)} °C</li>
                </ul>`;
                calculationHtml += `<p class="calculation-step">
                    $\\rho_T = ${rho20C.toFixed(5)} [1 + ${alpha.toFixed(5)} \\times (${temperature.toFixed(0)} - 20)] = ${rho.toFixed(5)} \\text{ Ohm} \\cdot \\text{mm}^2/\\text{m}$
                </p>`;


                // Common variables for formulas
                let K_display_factor = ''; // For 2 or sqrt(3) in formula
                let L_calc = cableLength; // Length for calculation (meters)
                let A_calc = cableSize; // Area for calculation (mm²)

                if (phaseType === "single" || phaseType === "dc") {
                    K_display_factor = '2'; // For single-phase (round trip) or DC
                } else if (phaseType === "three") {
                    K_display_factor = '\\sqrt{3}'; // For three-phase
                }

                // Calculate total resistance (R) and reactance (X) for the cable length
                const totalResistance = (rho * cableLength * (phaseType === "dc" ? 1 : 1)) / cableSize; // Adjusted for length * 1
                let totalReactance = 0;
                if (phaseType !== "dc") {
                    const cableReactancePerMeter = reactancePerKm[cableSize.toString()] / 1000; // Ohm/meter
                    totalReactance = cableReactancePerMeter * cableLength;

                    // Adjust reactance for steel conduit - approximate increase (e.g., 10-20%)
                    if (conduitMaterial === 'steel') {
                        totalReactance *= 1.15; // Example: 15% increase for steel conduit
                        calculationHtml += `<p><strong>1.2. Reactance Adjustment for Conduit:</strong></p>`;
                        calculationHtml += `<p>For steel conduits, the magnetic field can increase the effective reactance of the conductor. An approximate increase of 15% is applied for illustrative purposes. Actual impact depends on conduit size, conductor spacing, and frequency.</p>`;
                        calculationHtml += `<p class="calculation-step">X<sub>adjusted</sub> = X<sub>initial</sub> \\times 1.15 = ${totalReactance.toFixed(5)} \\text{ Ohms}</p>`;
                    }
                }
                
                calculationHtml += `<p><strong>1.1. Total Cable Resistance (R) and Reactance (X):</strong></p>`;
                calculationHtml += `<p>These values represent the total opposition to current flow over the entire cable length.</p>`;
                calculationHtml += `<p class="calculation-step">
                    $R = \\frac{\\rho_T \\times L}{A} = \\frac{${rho.toFixed(5)} \\times ${cableLength.toFixed(2)}}{${cableSize.toFixed(1)}} = ${totalResistance.toFixed(5)} \\text{ Ohms}$
                </p>`;
                if (phaseType !== "dc") {
                    calculationHtml += `<p class="calculation-step">
                        $X = \\text{Reactance per km} \\times L_{km} = ${reactancePerKm[cableSize.toString()].toFixed(3)} \\text{ Ohm/km} \\times \\frac{${cableLength.toFixed(2)}}{1000} = ${totalReactance.toFixed(5)} \\text{ Ohms}$
                    </p>`;
                }

                // --- Calculation Method Specific Logic ---
                if (calculationMethod === "simplified" || phaseType === "dc") {
                    // Simplified method (resistance only) or DC calculation
                    voltageDrop = (K_display_factor === '2' ? 2 : (K_display_factor === '\\sqrt{3}' ? Math.sqrt(3) : 1)) * loadCurrent * totalResistance;
                    methodDescription = phaseType === "dc" ?
                        "DC calculation using resistance only (IEC/IEEE general method for DC)" :
                        "Simplified calculation using resistance only (for AC, neglecting reactance)";
                    voltageDropFormula = `$$V_D = ${K_display_factor} \\times I_{load} \\times R$$`;
                    
                    calculationHtml += `<p><strong>2. Voltage Drop Calculation (${methodDescription}):</strong></p>`;
                    calculationHtml += `<p>This method calculates voltage drop based purely on the cable's resistance. It is accurate for DC circuits and provides a quick estimation for short AC circuits where reactance is negligible. It aligns with basic electrical principles.</p>`;
                    calculationHtml += `<p class="formula">${voltageDropFormula}</p>`;
                    calculationHtml += `Where:<ul>
                        <li>Load Current ($I_{load}$) = ${loadCurrent.toFixed(2)} A</li>
                        <li>Total Cable Resistance (R) = ${totalResistance.toFixed(5)} Ohms</li>
                    </ul>`;
                    calculationHtml += `<p class="calculation-step">
                        $V_D = ${K_display_factor} \\times ${loadCurrent.toFixed(2)} \\times ${totalResistance.toFixed(5)} = ${voltageDrop.toFixed(2)} \\text{ V}$
                    </p>`;
                    standardExplanation = `This calculation uses a simplified resistance-only method. While useful for quick estimations, it neglects the reactive component of impedance, which can lead to inaccuracies in AC circuits, especially for longer cable runs or lower power factors. It is accurate for DC circuits and aligns with general electrical principles.`;

                } else if (calculationMethod === "exact" || calculationMethod === "iec") {
                    // Exact method using impedance (for AC) or IEC method
                    const cosPhi = powerFactor;
                    const sinPhi = Math.sin(Math.acos(powerFactor)); // Assuming power factor is lagging by default

                    if (phaseType === "single") {
                        voltageDrop = 2 * loadCurrent * (totalResistance * cosPhi + totalReactance * sinPhi);
                        voltageDropFormula = `$$V_D = 2 \\times I_{load} \\times (R \\cos\\phi + X \\sin\\phi)$$`;
                    } else { // Three-phase AC
                        voltageDrop = Math.sqrt(3) * loadCurrent * (totalResistance * cosPhi + totalReactance * sinPhi);
                        voltageDropFormula = `$$V_D = \\sqrt{3} \\times I_{load} \\times (R \\cos\\phi + X \\sin\\phi)$$`;
                    }
                    
                    methodDescription = calculationMethod === "exact" ? "Exact calculation using both resistance and reactance (Impedance Method)" : "Calculation based on IEC 60364-5-52 standard (Impedance Method)";

                    calculationHtml += `<p><strong>2. Voltage Drop Calculation (${methodDescription}):</strong></p>`;
                    calculationHtml += `<p>This method considers both the resistive (R) and reactive (X) components of the cable's impedance, providing a more accurate result for AC circuits, particularly for longer cables or varying power factors. It is the basis for most detailed voltage drop analyses.</p>`;
                    calculationHtml += `<p class="formula">${voltageDropFormula}</p>`;
                    calculationHtml += `Where:<ul>
                        <li>Load Current ($I_{load}$) = ${loadCurrent.toFixed(2)} A</li>
                        <li>Total Cable Resistance (R) = ${totalResistance.toFixed(5)} Ohms</li>
                        <li>Total Cable Reactance (X) = ${totalReactance.toFixed(5)} Ohms</li>
                        <li>Power Factor (cos$\\phi$) = ${powerFactor.toFixed(2)}</li>
                        <li>sin$\\phi$ = ${sinPhi.toFixed(2)} (derived from Power Factor)</li>
                    </ul>`;
                    calculationHtml += `<p class="calculation-step">
                        $V_D = ${K_display_factor} \\times ${loadCurrent.toFixed(2)} \\times ( ${totalResistance.toFixed(5)} \\times ${cosPhi.toFixed(2)} + ${totalReactance.toFixed(5)} \\times ${sinPhi.toFixed(2)} ) = ${voltageDrop.toFixed(2)} \\text{ V}$
                    </p>`;
                    standardExplanation = `This calculation is based on principles from **IEC 60364-5-52** (Selection and erection of electrical equipment – Wiring systems) and uses the impedance method. This method provides a comprehensive and accurate voltage drop calculation for AC systems. The provided resistance and reactance values are illustrative examples. For strict compliance, always refer to the latest official IEC standards or relevant national annexes for precise values based on cable construction, installation methods, and environmental conditions.`;

                } else if (calculationMethod === "nec") {
                    // NEC method using K-factors
                    L_calc = metersToFeet(cableLength); // Convert meters to feet
                    A_calc = mmSquaredToCircularMils(cableSize); // Convert mm2 to circular mils

                    let necConstantK = 0;
                    if (phaseType === "dc") {
                        necConstantK = necKFactors[cableMaterial].dc;
                    } else { // AC
                        // For AC, NEC K-factor depends on cable size and material for impedance.
                        // We use the provided lookup for AC as well for consistency with K-factor method
                        necConstantK = necKFactors[cableMaterial].ac[cableSize.toString()];
                        if (!necConstantK) {
                             displayMessage(`NEC K-factor not available for ${cableMaterial} ${cableSize}mm² at AC. Using approximation.`, "warning");
                             // Fallback if specific K-factor is not defined for a size
                             necConstantK = (cableMaterial === 'copper' ? 12.5 : 20.5);
                        }
                    }

                    if (phaseType === "single" || phaseType === "dc") {
                        voltageDrop = (2 * necConstantK * loadCurrent * L_calc) / A_calc;
                        voltageDropFormula = `$$V_D = \\frac{2 \\times K \\times I_{load} \\times D}{CMIL}$$`;
                    } else { // Three-phase AC
                        voltageDrop = (Math.sqrt(3) * necConstantK * loadCurrent * L_calc) / A_calc;
                        voltageDropFormula = `$$V_D = \\frac{\\sqrt{3} \\times K \\times I_{load} \\times D}{CMIL}$$`;
                    }
                    
                    methodDescription = "Calculation based on NEC Chapter 9, Table 8 K-factors (Approximate Method)";
                    calculationHtml += `<p><strong>2. Voltage Drop Calculation (${methodDescription}):</strong></p>`;
                    calculationHtml += `<p>This method uses K-factors (resistivity or impedance constants) as provided in NEC Chapter 9, Table 8 (or similar tables). It provides an approximation of voltage drop, often used for simplicity. These K-factors are based on specific conductor temperatures (e.g., 75°C) and average power factors. </p>`;
                    calculationHtml += `<p class="formula">${voltageDropFormula}</p>`;
                    calculationHtml += `Where:<ul>
                        <li>K = NEC K-Factor = ${necConstantK.toFixed(2)} (Ohm-CMIL/kft) from NEC Ch.9, Table 8 (or similar empirical data for ${cableMaterial.charAt(0).toUpperCase() + cableMaterial.slice(1)} ${phaseType === "dc" ? "DC" : "AC"} at 75°C)</li>
                        <li>$I_{load}$ = Load Current = ${loadCurrent.toFixed(2)} A</li>
                        <li>D = Cable Length in feet = ${L_calc.toFixed(2)} ft (1 meter = 3.28084 feet)</li>
                        <li>CMIL = Cable Size in Circular Mils = ${A_calc.toFixed(2)} CMIL (1 mm² = 1973.5 CMIL)</li>
                    </ul>`;
                    calculationHtml += `<p class="calculation-step">
                        $V_D = \\frac{${K_display_factor === '2' ? '2' : '\\sqrt{3}'} \\times ${necConstantK.toFixed(2)} \\times ${loadCurrent.toFixed(2)} \\times ${L_calc.toFixed(2)}}{${A_calc.toFixed(2)}} = ${voltageDrop.toFixed(2)} \\text{ V}$
                    </p>`;
                    standardExplanation = `This calculation uses simplified K-factors based on **National Electrical Code (NEC) Chapter 9, Table 8** (or similar empirical data). For precise compliance and complex installations, refer to the full NEC document, which considers specific conductor impedance (R and X) values for different cable types and installation conditions. Note that NEC voltage drop recommendations are typically secondary considerations to ampacity and overcurrent protection, usually suggested not to exceed 3% for feeder and branch circuits.`;
                }

                // Step 3: Convert Voltage Drop to Percentage
                voltageDropPercent = (voltageDrop / systemVoltage) * 100;
                calculationHtml += `<p><strong>3. Voltage Drop Percentage ($\\text{%VD}$):</strong></p>`;
                calculationHtml += `<p>To express the voltage drop as a percentage of the system's nominal voltage, providing an easy way to assess its significance.</p>`;
                calculationHtml += `<p class="formula">$$\\%VD = \\frac{V_D}{V_{system}} \\times 100\\%$$</p>`;
                calculationHtml += `Where:<ul>
                    <li>$V_D$ = Calculated Voltage Drop = ${voltageDrop.toFixed(2)} V</li>
                    <li>$V_{system}$ = System Voltage = ${systemVoltage.toFixed(0)} V</li>
                </ul>`;
                calculationHtml += `<p class="calculation-step">
                    $\\%VD = \\frac{${voltageDrop.toFixed(2)}}{${systemVoltage.toFixed(0)}} \\times 100\\% = ${voltageDropPercent.toFixed(2)}\\%$
                </p>`;

                // Step 4: Determine Status (Acceptable/Marginal/Unacceptable) based on common recommendations
                let acceptableStatus = "Acceptable";
                let statusColor = "green";
                if (voltageDropPercent > 5) {
                    acceptableStatus = "Unacceptable (Exceeds 5%)";
                    statusColor = "red";
                } else if (voltageDropPercent > 3) {
                    acceptableStatus = "Marginal (3% - 5%)";
                    statusColor = "orange";
                }
                calculationHtml += `<p><strong>4. Voltage Drop Status & Recommendations:</strong></p>`;
                calculationHtml += `<p>Common industry recommendations (e.g., from NEC, IEC, and good engineering practice) suggest voltage drop should ideally be below 3% for feeder and branch circuits, and generally not exceeding 5% for the total circuit. Excessive voltage drop can lead to reduced efficiency, overheating, and improper operation of electrical equipment.</p>`;
                calculationHtml += `<p class="calculation-step" style="color: ${statusColor}; font-weight: bold;">Status: ${acceptableStatus}</p>`;

                calculationDetailsDiv.innerHTML = calculationHtml;
                // Trigger MathJax to render the new content, specifically targeting calculationDetailsDiv
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv]);
                }
                
                // Display summarized results in the table
                resultTableBody.innerHTML = ''; // Clear previous results
                addResultRow("Cable Size", `${cableSize} mm²`);
                addResultRow("Cable Material", cableMaterial.charAt(0).toUpperCase() + cableMaterial.slice(1));
                addResultRow("Cable Length", `${cableLength} m`);
                addResultRow("Load Current", `${loadCurrent} A`);
                addResultRow("System Voltage", `${systemVoltage} V`);
                addResultRow("System Type", phaseType === "single" ? "Single-Phase AC" : (phaseType === "three" ? "Three-Phase AC" : "DC System"));
                addResultRow("Conductor Temperature", `${temperature} ℃`);
                if (phaseType !== "dc") {
                    addResultRow("Power Factor", powerFactor);
                }
                addResultRow("Conduit Material", conduitMaterial.charAt(0).toUpperCase() + conduitMaterial.slice(1));
                addResultRow("Calculation Method", methodDescription);
                addResultRow("Resistivity Used (at Temp)", `${rho.toFixed(5)} Ohm·mm²/m`);
                if (phaseType !== "dc" && (calculationMethod === "exact" || calculationMethod === "iec")) {
                    addResultRow("Reactance Used (per km)", `${reactancePerKm[cableSize.toString()]} Ohm/km`);
                }
                addResultRow("Calculated Voltage Drop", `${voltageDrop.toFixed(2)} V`);
                addResultRow("Voltage Drop Percentage", `<span style="font-weight: bold; color: ${statusColor};">${voltageDropPercent.toFixed(2)}%</span>`);
                addResultRow("Voltage Drop Status", acceptableStatus);

                // Set standard reference text
                standardReference.innerHTML = standardExplanation;
                
                // Show result container with animation
                resultContainer.classList.add('show');
                
                // Scroll to results after a short delay to allow animation to start
                setTimeout(() => {
                    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            });
            
            // Helper function to add a row to the result table
            function addResultRow(parameter, value) {
                const row = document.createElement('tr');
                
                const paramCell = document.createElement('td');
                paramCell.textContent = parameter;
                
                const valueCell = document.createElement('td');
                valueCell.innerHTML = value; // Use innerHTML for styling like colored status, MathJax processing is limited to specific div
                
                row.appendChild(paramCell);
                row.appendChild(valueCell);
                
                resultTableBody.appendChild(row);
            }
            
            // Show/hide power factor field and adjust calculation method options based on system type
            phaseTypeSelect.addEventListener('change', function() {
                if (this.value === 'dc') {
                    powerFactorGroup.style.opacity = '0.5';
                    powerFactorInput.disabled = true;
                    powerFactorInput.value = '1.0'; // Default PF to 1 for DC

                    // For DC, only show simplified and NEC methods (reactance not applicable)
                    calculationMethodSelect.innerHTML = `
                        <option value="simplified">Simplified (Resistance Only)</option>
                        <option value="nec">NEC Method (Approximate K-factor)</option>
                    `;
                    // If current selection is not valid for DC, default to simplified
                    if (calculationMethodSelect.value !== 'simplified' && calculationMethodSelect.value !== 'nec') {
                        calculationMethodSelect.value = 'simplified';
                    }
                } else { // AC (Single-Phase or Three-Phase)
                    powerFactorGroup.style.opacity = '1';
                    powerFactorInput.disabled = false;
                    
                    // For AC, show all methods
                    calculationMethodSelect.innerHTML = `
                        <option value="simplified">Simplified (Resistance Only)</option>
                        <option value="exact">Exact (Impedance Method)</option>
                        <option value="nec">NEC Method (Approximate K-factor)</option>
                        <option value="iec">IEC Method (Impedance based)</option>
                    `;
                }
            });
            
            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            const body = document.body;

            // Check for saved theme preference on load
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                body.setAttribute('data-theme', 'dark');
                themeSwitch.checked = true;
            } else {
                body.removeAttribute('data-theme');
                themeSwitch.checked = false;
            }

            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    body.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    body.removeAttribute('data-theme');
                    localStorage.setItem('theme', 'light');
                }
            });

            // Back button functionality
            backButton.addEventListener('click', function(e) {                
                // In a real application, you might navigate back or show a different section
                // For this standalone file, we'll just hide the results and reset the form
                resultContainer.classList.remove('show');
                document.getElementById('voltage-drop-form').reset(); // Reset form fields
                // Scroll to top or calculator form
                document.querySelector('.tool-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Re-trigger phase type change to reset PF and methods on form reset
                phaseTypeSelect.dispatchEvent(new Event('change'));
            });

            // Initial trigger for phase-type change to set correct UI state on load
            phaseTypeSelect.dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>