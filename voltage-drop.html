<!DOCTYPE html>
<html lang="en">
<head>
    <!-- The head section is identical to your provided file -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googlesignals.page/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" as="script">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Voltage Drop Calculator - Design Calculators - Electrical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                processHtmlClass: 'mathjax-process',
                ignoreHtmlClass: 'no-mathjax-process',
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option']
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary-color: #1E3A8A; /* Professional Dark Blue */
            --secondary-color: #2563EB; /* Bright Blue */
            --accent-color: #F59E0B; /* Warm Amber */
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-color: #4B5563;
            --heading-color: #111827;
            --border-color: #E2E8F0;
            --success-color: #16a34a;
            --warning-color: #f59e0b;
            --error-color: #dc2626;
            --card-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -2px rgba(0,0,0,0.05);
            --button-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --font-primary: 'Inter', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
        }

        body.dark-mode {
            --primary-color: #10B981; /* Vibrant Green */
            --secondary-color: #34D399; /* Lighter Green */
            --bg-color: #0F172A;
            --card-bg: #1E293B;
            --text-color: #CBD5E1;
            --heading-color: #F1F5F9;
            --border-color: #334155;
            --success-color: #22c55e;
            --warning-color: #facc15;
            --error-color: #f87171;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-primary);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* Header */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 24px 0;
            position: relative;
            overflow: hidden;
        }
        .navbar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .logo-container { 
            display: flex; 
            align-items: center; 
            gap: 16px; 
            text-decoration: none; 
            color: white; 
        }
        .logo { 
            height: 56px; 
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .theme-toggle { 
            display: flex; 
            align-items: center; 
            gap: 12px;
        }
        .theme-toggle .icon { 
            color: white; 
            font-size: 1.2rem; 
        }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.2); transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(26px); }

        main { padding: 2.5rem 0; }

        .back-button { display: inline-flex; align-items: center; gap: 0.6rem; color: var(--primary-color); text-decoration: none; margin-bottom: 2.5rem; font-weight: 600; transition: all 0.3s ease; font-size: 1.05rem; }
        .back-button:hover { color: var(--secondary-color); transform: translateX(-5px); }

        .tool-container { background-color: var(--card-bg); border-radius: 16px; padding: 2.5rem; box-shadow: var(--card-shadow); animation: fadeIn 0.8s ease-out; }
        .tool-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1.5rem; gap: 1rem; }
        .tool-header h2 { color: var(--heading-color); font-size: 2rem; }
        
        .form-section { margin-bottom: 2rem; border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; }
        .form-section h3 { font-size: 1.25rem; color: var(--primary-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .form-group { margin-bottom: 0; position: relative; }
        .form-group label { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 8px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--input-bg, #f8fafc); color: var(--text-color); font-size: 1rem; transition: all 0.2s ease; }
        body.dark-mode .form-group input, body.dark-mode .form-group select { background-color: var(--input-bg, #0f172a); }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 20%, transparent); }

        .action-buttons { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 2rem; }
        .pro-btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 14px 25px; border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: 600; text-decoration: none; transition: all 0.2s ease; border: none; }
        .pro-btn.primary { background-color: var(--primary-color); color: white; box-shadow: var(--button-shadow); }
        .pro-btn.primary:hover { background-color: var(--secondary-color); transform: translateY(-2px); }
        .pro-btn.secondary { background-color: transparent; color: var(--primary-color); border: 1px solid var(--primary-color); }
        .pro-btn.secondary:hover { background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); transform: translateY(-2px); }

        .result-section { margin-top: 2.5rem; display: none; opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease, transform 0.6s ease; }
        .result-section.show { display: block; opacity: 1; transform: translateY(0); }
        
        .result-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2.5rem; }
        .summary-card { background-color: var(--card-bg); border-radius: 12px; padding: 1.5rem; text-align: center; border-left: 5px solid; transition: all 0.3s ease; }
        .summary-card:hover { transform: translateY(-5px); box-shadow: var(--card-shadow); }
        .summary-card.status-acceptable { border-color: var(--success-color); }
        .summary-card.status-marginal { border-color: var(--warning-color); }
        .summary-card.status-unacceptable { border-color: var(--error-color); }
        .summary-card .label { font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .summary-card .value { font-size: 2rem; font-weight: 700; color: var(--heading-color); }
        .summary-card .status-text { font-weight: 600; margin-top: 0.5rem; }

        .calculation-details { background-color: var(--card-bg); border-radius: 12px; padding: 2rem; box-shadow: var(--card-shadow); }
        .calculation-details h3 { font-size: 1.75rem; color: var(--heading-color); margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
        .step { margin-bottom: 2.5rem; animation: slideInUp 0.6s ease forwards; opacity: 0;}
        .step h4 { font-size: 1.2rem; color: var(--primary-color); margin-bottom: 1rem; }
        .step p { margin-bottom: 1rem; }
        .step .formula-box { background-color: var(--input-bg, #f8fafc); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid var(--border-color); font-size: 1.1rem; text-align: center; overflow-x: auto; }
        body.dark-mode .step .formula-box { background-color: var(--input-bg, #0f172a); }
        .step .calculation-step { font-family: var(--font-mono); background-color: color-mix(in srgb, var(--text-color) 5%, transparent); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; white-space: pre-wrap; word-wrap: break-word; font-size: 0.95rem; }
        .recommendation { background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); border-left: 4px solid var(--primary-color); padding: 1rem; border-radius: 8px; margin-top: 1rem; }
        
        #summary-table-container { margin-top: 3rem; }
        .summary-table { width: 100%; border-collapse: collapse; }
        .summary-table th, .summary-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .summary-table th { font-weight: 600; color: var(--heading-color); }
        .summary-table tr:last-child td { border-bottom: none; }
        .summary-table td:first-child { font-weight: 500; }
        .summary-table .status-value { font-weight: bold; }

        /* Tooltip Styles */
        .tooltip { position: relative; display: inline-block; cursor: help; color: var(--secondary-color); }
        .tooltip .tooltiptext { visibility: hidden; width: 280px; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 8px 12px; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -140px; opacity: 0; transition: opacity 0.3s; font-size: 0.85rem; font-weight: 400; line-height: 1.4; }
        .tooltip .tooltiptext::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        body.dark-mode .tooltip .tooltiptext { background-color: #f1f5f9; color: #1e293b; }
        body.dark-mode .tooltip .tooltiptext::after { border-color: #f1f5f9 transparent transparent transparent; }
        
        .save-load-section { display: flex; gap: 1rem; align-items: center; }
        #project-name { flex-grow: 1; }
        #load-project-select { flex-grow: 1; }
        
        #custom-message-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 1000; font-weight: bold; color: white; opacity: 0; visibility: hidden; transition: all 0.5s ease-in-out; background-color: var(--success-color); }
        #custom-message-box.show { opacity: 1; visibility: visible; }
        #custom-message-box.error { background-color: var(--error-color); }
        #custom-message-box.warning { background-color: var(--warning-color); color: #333; }

        /* Footer */
        footer { 
            background: var(--gradient-dark);
            color: #CBD5E1; 
            padding: 80px 0 30px 0; 
            margin-top: 5rem;
        }
        .footer-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 40px; 
        }
        .footer-col h4 { 
            font-size: 1.2rem; 
            color: white; 
            margin-bottom: 1.5rem; 
            font-weight: 700;
        }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col ul li { margin-bottom: 1rem; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent-color); }
        .footer-disclaimer {
            text-align: center;
            margin: 40px auto;
            padding-top: 40px;
            border-top: 1px solid #334155;
            max-width: 800px;
        }
        .footer-disclaimer h4 {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 1rem;
        }
        .footer-bottom { 
            text-align: center; 
            padding-top: 20px; 
            font-size: 0.9rem; 
            color: #94A3B8;
        }
        .creator-name { 
            color: var(--secondary-color); 
            font-weight: bold; 
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* Print Styles */
        @media print {
            body { background-color: #fff; color: #000; font-size: 10pt; }
            header, footer, .back-button, .action-buttons, .tool-header .save-load-section, .disclaimer, .social-share, .credit, .tooltip { display: none; }
            main { padding: 0; }
            .tool-container, .result-section { box-shadow: none; border: none; padding: 0; }
            .form-section { border: 1px solid #ccc; padding: 1em; }
            .form-row { grid-template-columns: 1fr 1fr; }
            .result-summary { grid-template-columns: 1fr 1fr 1fr; }
            .summary-card { box-shadow: none; border: 1px solid #ccc; }
            .calculation-details { box-shadow: none; padding: 0; }
            .step .formula-box, .step .calculation-step { background-color: #f0f0f0; border: 1px solid #ddd; }
            h2, h3 { color: #000 !important; }
            .value { color: #000 !important; }
            .summary-card.status-acceptable { border-color: #008000; }
            .summary-card.status-marginal { border-color: #ffa500; }
            .summary-card.status-unacceptable { border-color: #ff0000; }
            a { text-decoration: none; color: #000; }
            #print-header { display: block !important; text-align: center; margin-bottom: 2rem; }
            #print-header h1 { font-size: 18pt; }
            #print-header p { font-size: 10pt; }
        }
        #print-header { display: none; }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>
                <div class="theme-toggle">
                    <i class="fas fa-sun icon"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon icon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
            <div id="print-header">
            <h1>Voltage Drop Calculation Report</h1>
            <p>Generated by Design Calculators &copy; 2025</p>
        </div>
        <div class="tool-container">
            <div class="tool-header">
                <h2>Advanced Voltage Drop Calculator</h2>
                <div class="save-load-section">
                    <select id="load-project-select" class="form-group select"></select>
                    <button id="delete-project-btn" class="pro-btn secondary"><i class="fas fa-trash"></i></button>
                </div>
            </div>

            <form id="voltage-drop-form">
                <div class="form-section">
                    <h3><i class="fas fa-bolt"></i>System & Load Parameters</h3>
                    <div class="form-row">
                        <div class="form-group"><label for="load-type">Load Type <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">Specify the load in Amps (A), Kilowatts (kW), or Kilovolt-Amps (kVA). The tool will calculate the current if kW or kVA is selected.</span></span></label><select id="load-type"><option value="amps">Amps (A)</option><option value="kw">Kilowatts (kW)</option><option value="kva">kVA</option></select></div>
                        <div class="form-group"><label for="load-value">Load Value</label><input type="number" id="load-value" min="0.01" step="0.01" value="10" required></div>
                        <div class="form-group"><label for="system-voltage">System Voltage (V) <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">Nominal line-to-line voltage for 3-phase, or line-to-neutral for 1-phase systems.</span></span></label><input type="number" id="system-voltage" min="1" step="1" value="415" required></div>
                        <div class="form-group"><label for="phase-type">System Type</label><select id="phase-type" required><option value="three">Three-Phase AC</option><option value="single">Single-Phase AC</option><option value="dc">DC System</option></select></div>
                        <div class="form-group" id="power-factor-group"><label for="power-factor">Power Factor (cos φ) <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">The ratio of real power (kW) to apparent power (kVA). Use 1.0 for purely resistive loads. Required for kW and Amp load types.</span></span></label><input type="number" id="power-factor" min="0.1" max="1" step="0.01" value="0.85" required></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-ruler-combined"></i>Conductor & Installation</h3>
                    <div class="form-row">
                        <div class="form-group"><label for="cable-length">Cable Length (m) <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">One-way length of the cable run from source to load.</span></span></label><input type="number" id="cable-length" min="0.1" step="0.1" value="50" required></div>
                        <div class="form-group"><label for="cable-size">Cable Size (mm²) <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">Cross-sectional area of the conductor.</span></span></label><select id="cable-size" required><option value="1.5">1.5</option><option value="2.5">2.5</option><option value="4">4</option><option value="6">6</option><option value="10" selected>10</option><option value="16">16</option><option value="25">25</option><option value="35">35</option><option value="50">50</option><option value="70">70</option><option value="95">95</option><option value="120">120</option><option value="150">150</option><option value="185">185</option><option value="240">240</option><option value="300">300</option><option value="400">400</option><option value="500">500</option><option value="630">630</option></select></div>
                        <div class="form-group"><label for="cable-material">Cable Material</label><select id="cable-material" required><option value="copper">Copper</option><option value="aluminum">Aluminum</option></select></div>
                        <div class="form-group"><label for="parallel-runs">Parallel Runs <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">Number of conductors per phase. Running cables in parallel reduces effective impedance.</span></span></label><input type="number" id="parallel-runs" min="1" max="10" step="1" value="1" required></div>
                        <div class="form-group"><label for="temperature">Conductor Temp (°C) <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">The maximum expected operating temperature of the conductor, typically based on insulation type (e.g., 75°C for PVC, 90°C for XLPE).</span></span></label><input type="number" id="temperature" min="0" max="90" step="1" value="75" required></div>
                         <div class="form-group"><label for="conduit-material">Conduit Material</label><select id="conduit-material"><option value="pvc">PVC (Non-Magnetic)</option><option value="steel">Steel (Magnetic)</option><option value="aluminum">Aluminum (Non-Magnetic)</option><option value="none">No Conduit / Open Air</option></select></div>
                        <div class="form-group"><label for="calculation-method">Calculation Method</label><select id="calculation-method" required><option value="iec" selected>IEC 60364 (Impedance)</option><option value="nec">NEC (K-Factor)</option><option value="simplified">Simplified (Resistance Only)</option></select></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-cogs"></i>Advanced Parameters (Optional)</h3>
                    <div class="form-row">
                        <div class="form-group"><label for="motor-lra">Motor Locked Rotor Amps (LRA) <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">For motor starting calculations, enter the LRA from the motor nameplate. This will calculate the voltage dip during startup.</span></span></label><input type="number" id="motor-lra" min="0" step="1" placeholder="e.g., 100"></div>
                        <div class="form-group"><label for="ambient-temp">Ambient Temp (°C) <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">Ambient air or ground temperature. For professional use, this is used with derating tables to verify cable ampacity (informational for this tool).</span></span></label><input type="number" id="ambient-temp" min="-20" max="60" step="1" placeholder="e.g., 40"></div>
                        <div class="form-group"><label for="cable-grouping">Cables in Group <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">Number of circuits or multi-core cables in the same conduit/tray. Used with derating tables to verify ampacity (informational for this tool).</span></span></label><input type="number" id="cable-grouping" min="1" step="1" value="1"></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-save"></i>Project Management</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="project-name">Save Project As</label>
                            <input type="text" id="project-name" placeholder="e.g., Main Feeder Pump">
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="button" id="calculate-running-btn" class="pro-btn primary"><i class="fas fa-calculator"></i> Calculate Running VD</button>
                    <button type="button" id="calculate-motor-start-btn" class="pro-btn primary"><i class="fas fa-play-circle"></i> Calculate Motor Start VD</button>
                    <button type="button" id="save-btn" class="pro-btn secondary"><i class="fas fa-save"></i> Save Project</button>
                    <button type="button" id="print-btn" class="pro-btn secondary"><i class="fas fa-print"></i> Print Results</button>
                    <button type="button" id="reset-btn" class="pro-btn secondary"><i class="fas fa-redo"></i> Reset</button>
                </div>
            </form>
            
            <section id="result-section" class="result-section">
                <div id="result-summary" class="result-summary"></div>
                <div id="calculation-details" class="calculation-details mathjax-process">
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/indexele'>Electrical Tools</a></li>
                        <li><a href='/indexmech'>Mechanical Tools</a></li>
                        <li><a href='/indexinst'>Instrumentation Tools</a></li>
                        <li><a href='/'>Home</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href='/privacy-policy'>Privacy Policy</a></li>
                        <li><a href='/terms-of-service'>Terms of Service</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>About</h4>
                    <ul>
                        <li><a href='/about'>About Us</a></li>
                        <li><a href='/contact'>Contact Us</a></li>
                        <li><a href='/faq'>FAQ</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <h4>Disclaimer</h4>
                <p>All tools are for guidance only and should not replace professional engineering judgment. Results must be verified by a qualified professional against project requirements and local codes.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="custom-message-box"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- THEME SWITCHER LOGIC ---
        const themeSwitch = document.getElementById('theme-switch');
        const body = document.body;
        const currentTheme = localStorage.getItem('theme');

        if (currentTheme) {
            body.classList.add(currentTheme);
            if (currentTheme === 'dark-mode') themeSwitch.checked = true;
        }

        themeSwitch.addEventListener('change', () => {
            body.classList.toggle('dark-mode', themeSwitch.checked);
            localStorage.setItem('theme', themeSwitch.checked ? 'dark-mode' : 'light-mode');
        });

        // --- DOM ELEMENTS ---
        const form = document.getElementById('voltage-drop-form');
        const calculateRunningBtn = document.getElementById('calculate-running-btn');
        const calculateMotorStartBtn = document.getElementById('calculate-motor-start-btn');
        const saveBtn = document.getElementById('save-btn');
        const printBtn = document.getElementById('print-btn');
        const resetBtn = document.getElementById('reset-btn');
        const loadProjectSelect = document.getElementById('load-project-select');
        const deleteProjectBtn = document.getElementById('delete-project-btn');
        const resultSection = document.getElementById('result-section');
        const resultSummary = document.getElementById('result-summary');
        const calculationDetails = document.getElementById('calculation-details');
        const phaseTypeSelect = document.getElementById('phase-type');
        const powerFactorGroup = document.getElementById('power-factor-group');
        const powerFactorInput = document.getElementById('power-factor');
        const loadTypeSelect = document.getElementById('load-type');

        // --- CONSTANTS & DATA ---
        const CONSTANTS = {
            RHO_20C_COPPER: 0.01724, ALPHA_COPPER: 0.00393,
            RHO_20C_ALUMINUM: 0.02826, ALPHA_ALUMINUM: 0.00403,
            REACTANCE_PER_KM: {'1.5':0.12,'2.5':0.11,'4':0.1,'6':0.09,'10':0.085,'16':0.08,'25':0.078,'35':0.076,'50':0.075,'70':0.074,'95':0.073,'120':0.072,'150':0.071,'185':0.07,'240':0.069,'300':0.068,'400':0.067,'500':0.066,'630':0.065},
            NEC_K_FACTORS_75C: {
                copper_dc: 12.9, aluminum_dc: 21.2,
                copper_ac: 12.9, aluminum_ac: 21.2 
            },
            MM2_TO_CMIL: 1973.5, M_TO_FT: 3.28084,
            CABLE_SIZES: [1.5, 2.5, 4, 6, 10, 16, 25, 35, 50, 70, 95, 120, 150, 185, 240, 300, 400, 500, 630]
        };

        // --- APP LOGIC ---
        const App = {
            init() {
                this.bindEventListeners();
                this.loadProjects();
                this.loadLastInputs();
                this.updateUIForPhase();
            },

            bindEventListeners() {
                calculateRunningBtn.addEventListener('click', () => this.runCalculation('running'));
                calculateMotorStartBtn.addEventListener('click', () => this.runCalculation('motor_start'));
                phaseTypeSelect.addEventListener('change', this.updateUIForPhase.bind(this));
                loadTypeSelect.addEventListener('change', this.updateUIForPhase.bind(this));
                saveBtn.addEventListener('click', this.saveProject.bind(this));
                loadProjectSelect.addEventListener('change', this.loadSelectedProject.bind(this));
                deleteProjectBtn.addEventListener('click', this.deleteSelectedProject.bind(this));
                printBtn.addEventListener('click', () => window.print());
                resetBtn.addEventListener('click', this.resetForm.bind(this));
            },

            getInputs() {
                const inputs = {};
                for (let element of form.elements) {
                    if (element.id) {
                        inputs[element.id] = (element.type === 'number' || (element.tagName === 'SELECT' && !isNaN(parseFloat(element.value)))) 
                            ? parseFloat(element.value) 
                            : element.value;
                    }
                }
                return inputs;
            },

            validateInputs(inputs, type) {
                const { 'load-value': loadValue, 'system-voltage': systemVoltage, 'power-factor': powerFactor, temperature, 'motor-lra': motorLRA } = inputs;
                if ([loadValue, systemVoltage, powerFactor, temperature].some(v => v === null || isNaN(v)) || loadValue <= 0 || systemVoltage <= 0 || powerFactor < 0.1 || powerFactor > 1 || temperature < 0 || temperature > 90) {
                    this.displayMessage("Please check main inputs. Load, Voltage must be positive. PF: 0.1-1.0. Temp: 0-90°C.", "error"); return false;
                }
                if (type === 'motor_start' && (isNaN(motorLRA) || motorLRA <= 0)) {
                    this.displayMessage("Please enter a valid Motor LRA for starting calculation.", "error"); return false;
                }
                return true;
            },

            runCalculation(type) {
                resultSection.classList.remove('show');
                const inputs = this.getInputs();
                if (!this.validateInputs(inputs, type)) return;
                this.saveLastInputs(inputs);
                const calculations = this.performCalculations(inputs, type);
                this.renderResults(inputs, calculations, type);
                setTimeout(() => {
                    resultSection.classList.add('show');
                    resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            },
            
            performCalculations(inputs, type) {
                const { 
                    'load-type': loadType, 'load-value': loadValue, 'system-voltage': systemVoltage, 
                    'phase-type': phaseType, 'power-factor': powerFactor, 'motor-lra': motorLRA,
                    'cable-material': cableMaterial, temperature, 'cable-size': cableSize, 'parallel-runs': parallelRuns,
                    'cable-length': cableLength, 'conduit-material': conduitMaterial, 'calculation-method': calculationMethod
                } = inputs;

                let loadCurrent, pf, calculationTitle, currentFormula, currentSubstitution;
                
                if (type === 'motor_start') {
                    loadCurrent = motorLRA;
                    pf = 0.3; 
                    calculationTitle = "Motor Starting Voltage Dip";
                    currentFormula = `I = I_{LRA}`;
                    currentSubstitution = `I = ${motorLRA.toFixed(2)} \\, A`;
                } else {
                    calculationTitle = "Running Load Voltage Drop";
                    pf = powerFactor;
                    if (loadType === 'kw') {
                        const phaseDivisor = (phaseType === 'three') ? `\\sqrt{3} \\times V_{LL} \\times \\cos\\phi` : `V_{LN} \\times \\cos\\phi`;
                        const phaseDivisorCalc = (phaseType === 'three') ? Math.sqrt(3) * systemVoltage * pf : systemVoltage * pf;
                        loadCurrent = (loadValue * 1000) / phaseDivisorCalc;
                        currentFormula = `I = \\frac{P}{${phaseDivisor}} = \\frac{kW \\times 1000}{${phaseDivisor}}`;
                        currentSubstitution = `I = \\frac{${loadValue} \\times 1000}{${(phaseType === 'three') ? `\\sqrt{3} \\times ${systemVoltage} \\times ${pf.toFixed(2)}` : `${systemVoltage} \\times ${pf.toFixed(2)}`}} = ${loadCurrent.toFixed(2)} \\, A`;
                    } else if (loadType === 'kva') {
                         const phaseDivisor = (phaseType === 'three') ? `\\sqrt{3} \\times V_{LL}` : `V_{LN}`;
                        const phaseDivisorCalc = (phaseType === 'three') ? Math.sqrt(3) * systemVoltage : systemVoltage;
                        loadCurrent = (loadValue * 1000) / phaseDivisorCalc;
                        currentFormula = `I = \\frac{S}{${phaseDivisor}} = \\frac{kVA \\times 1000}{${phaseDivisor}}`;
                        currentSubstitution = `I = \\frac{${loadValue} \\times 1000}{${(phaseType === 'three') ? `\\sqrt{3} \\times ${systemVoltage}` : `${systemVoltage}`}} = ${loadCurrent.toFixed(2)} \\, A`;
                    } else {
                        loadCurrent = loadValue;
                        currentFormula = `I = I_{load}`;
                        currentSubstitution = `I = ${loadCurrent.toFixed(2)} \\, A`;
                    }
                }
                
                const rho20C = (cableMaterial === 'aluminum') ? CONSTANTS.RHO_20C_ALUMINUM : CONSTANTS.RHO_20C_COPPER;
                const alpha = (cableMaterial === 'aluminum') ? CONSTANTS.ALPHA_ALUMINUM : CONSTANTS.ALPHA_COPPER;
                const rhoT = rho20C * (1 + alpha * (temperature - 20));
                
                const R_per_meter = (rhoT / cableSize);
                const totalResistance_one_run = R_per_meter * cableLength;
                
                let X_per_meter = (CONSTANTS.REACTANCE_PER_KM[cableSize.toString()] || 0.08) / 1000;
                if (conduitMaterial === 'steel' && phaseType !== 'dc') { X_per_meter *= 1.15; }
                const totalReactance_one_run = X_per_meter * cableLength;

                const totalResistance = totalResistance_one_run / parallelRuns;
                const totalReactance = totalReactance_one_run / parallelRuns;

                let voltageDrop = 0, methodUsed = '', vdFormula = '', vdSubstitution = '';
                if (calculationMethod === 'iec' || (calculationMethod === 'simplified' && phaseType !== 'dc') || phaseType === 'dc') {
                    methodUsed = phaseType === 'dc' ? 'DC Resistance Method' : 'IEC 60364 Impedance Method';
                    if (phaseType === 'dc') {
                        vdFormula = `V_d = 2 \\times I \\times R_{total}`;
                        voltageDrop = 2 * loadCurrent * totalResistance;
                        vdSubstitution = `V_d = 2 \\times ${loadCurrent.toFixed(2)} \\times ${totalResistance.toFixed(5)} = ${voltageDrop.toFixed(3)} \\, V`;
                    } else if (phaseType === 'single') {
                        if (calculationMethod === 'simplified') {
                             vdFormula = `V_d = 2 \\times I \\times R_{total}`;
                             voltageDrop = 2 * loadCurrent * totalResistance;
                             vdSubstitution = `V_d = 2 \\times ${loadCurrent.toFixed(2)} \\times ${totalResistance.toFixed(5)} = ${voltageDrop.toFixed(3)} \\, V`;
                        } else {
                            const sinPhi = Math.sin(Math.acos(pf));
                            vdFormula = `V_d = 2 \\times I \\times (R_{total} \\cos\\phi + X_{total} \\sin\\phi)`;
                            voltageDrop = 2 * loadCurrent * (totalResistance * pf + totalReactance * sinPhi);
                            vdSubstitution = `V_d = 2 \\times ${loadCurrent.toFixed(2)} \\times (${totalResistance.toFixed(5)} \\times ${pf.toFixed(2)} + ${totalReactance.toFixed(5)} \\times ${sinPhi.toFixed(2)}) = ${voltageDrop.toFixed(3)} \\, V`;
                        }
                    } else { // 3-phase
                         if (calculationMethod === 'simplified') {
                             vdFormula = `V_d = \\sqrt{3} \\times I \\times R_{total}`;
                             voltageDrop = Math.sqrt(3) * loadCurrent * totalResistance;
                             vdSubstitution = `V_d = \\sqrt{3} \\times ${loadCurrent.toFixed(2)} \\times ${totalResistance.toFixed(5)} = ${voltageDrop.toFixed(3)} \\, V`;
                         } else {
                            const sinPhi = Math.sin(Math.acos(pf));
                            vdFormula = `V_d = \\sqrt{3} \\times I \\times (R_{total} \\cos\\phi + X_{total} \\sin\\phi)`;
                            voltageDrop = Math.sqrt(3) * loadCurrent * (totalResistance * pf + totalReactance * sinPhi);
                            vdSubstitution = `V_d = \\sqrt{3} \\times ${loadCurrent.toFixed(2)} \\times (${totalResistance.toFixed(5)} \\times ${pf.toFixed(2)} + ${totalReactance.toFixed(5)} \\times ${sinPhi.toFixed(2)}) = ${voltageDrop.toFixed(3)} \\, V`;
                        }
                    }
                } else { // NEC
                    methodUsed = 'NEC K-Factor Method';
                    const K_factor = CONSTANTS.NEC_K_FACTORS_75C[`${cableMaterial}_ac`];
                    const length_ft = cableLength * CONSTANTS.M_TO_FT;
                    const area_cmil = cableSize * CONSTANTS.MM2_TO_CMIL;
                    const Z_nec = area_cmil * parallelRuns;
                    if (phaseType === 'single') {
                        vdFormula = `V_d = \\frac{2 \\times K \\times I \\times L_{ft}}{CMIL_{total}}`;
                        voltageDrop = (2 * K_factor * loadCurrent * length_ft) / Z_nec;
                        vdSubstitution = `V_d = \\frac{2 \\times ${K_factor} \\times ${loadCurrent.toFixed(2)} \\times ${length_ft.toFixed(2)}}{${Z_nec.toFixed(0)}} = ${voltageDrop.toFixed(3)} \\, V`;
                    } else { // 3-phase
                        vdFormula = `V_d = \\frac{\\sqrt{3} \\times K \\times I \\times L_{ft}}{CMIL_{total}}`;
                        voltageDrop = (Math.sqrt(3) * K_factor * loadCurrent * length_ft) / Z_nec;
                        vdSubstitution = `V_d = \\frac{\\sqrt{3} \\times ${K_factor} \\times ${loadCurrent.toFixed(2)} \\times ${length_ft.toFixed(2)}}{${Z_nec.toFixed(0)}} = ${voltageDrop.toFixed(3)} \\, V`;
                    }
                }
                
                const voltageDropPercent = (voltageDrop / systemVoltage) * 100;
                let status, statusClass;
                const limit = (type === 'motor_start') ? 15 : 5;
                if (voltageDropPercent > limit) {
                    status = 'Unacceptable'; statusClass = 'status-unacceptable';
                } else if (voltageDropPercent > (limit * 0.6)) {
                    status = 'Marginal'; statusClass = 'status-marginal';
                } else {
                    status = 'Acceptable'; statusClass = 'status-acceptable';
                }

                let recommendation = '';
                if (status !== 'Acceptable' && type === 'running') {
                    const currentIndex = CONSTANTS.CABLE_SIZES.indexOf(cableSize);
                    if (currentIndex < CONSTANTS.CABLE_SIZES.length - 1) {
                        const nextSize = CONSTANTS.CABLE_SIZES[currentIndex + 1];
                        recommendation = `Voltage drop is high. Consider increasing cable size to the next standard of ${nextSize} mm².`;
                    } else {
                        recommendation = `Voltage drop is high. Consider increasing the number of parallel runs or using a transformer.`;
                    }
                }

                return { ...inputs, calculationTitle, loadCurrent, pf, rhoT, R_per_meter, X_per_meter, totalResistance, totalReactance, voltageDrop, voltageDropPercent, status, statusClass, recommendation, methodUsed, currentFormula, currentSubstitution, vdFormula, vdSubstitution };
            },

            renderResults(inputs, calcs, type) {
                resultSummary.innerHTML = `
                    <div class="summary-card ${calcs.statusClass}">
                        <div class="label">${calcs.calculationTitle}</div>
                        <div class="value">${calcs.voltageDrop.toFixed(2)} V</div>
                    </div>
                    <div class="summary-card ${calcs.statusClass}">
                        <div class="label">Percentage</div>
                        <div class="value">${calcs.voltageDropPercent.toFixed(2)}%</div>
                    </div>
                    <div class="summary-card ${calcs.statusClass}">
                        <div class="label">Status</div>
                        <div class="value status-text">${calcs.status}</div>
                    </div>
                `;

                let detailsHTML = `<h3>Detailed Breakdown: ${calcs.calculationTitle} (${calcs.methodUsed})</h3>`;
                
                if (inputs['load-type'] !== 'amps' && type === 'running') {
                    detailsHTML += `
                     <div class="step" style="animation-delay: 0.1s;">
                        <h4>Step 1: Calculate Load Current (I)</h4>
                        <p>The load was specified in ${inputs['load-type'].toUpperCase()}, so it is first converted to Amperes.</p>
                        <div class="formula-box">$$${calcs.currentFormula}$$</div>
                        <div class="calculation-step">$$${calcs.currentSubstitution}$$</div>
                     </div>`;
                }

                detailsHTML += `
                     <div class="step" style="animation-delay: 0.2s;">
                        <h4>Step 2: Calculate Conductor Impedance (Z)</h4>
                        <p>First, the conductor's resistivity is adjusted for the operating temperature.</p>
                        <div class="formula-box">$$ \\rho_T = \\rho_{20} [1 + \\alpha (T - 20)] $$</div>
                        <div class="calculation-step">$$\\rho_{${calcs.temperature}}°C = ${calcs['cable-material'] === 'copper' ? CONSTANTS.RHO_20C_COPPER : CONSTANTS.RHO_20C_ALUMINUM} [1 + ${calcs['cable-material'] === 'copper' ? CONSTANTS.ALPHA_COPPER : CONSTANTS.ALPHA_ALUMINUM} (${calcs.temperature} - 20)] = ${calcs.rhoT.toFixed(5)} \\, \\Omega \\cdot mm^2/m$$</div>
                        <p>Next, the total resistance and reactance are calculated for the cable length and divided by the number of parallel runs.</p>
                        <div class="formula-box">$$ R_{total} = \\frac{\\rho_T \\times L}{A \\times N_{runs}} \\quad | \\quad X_{total} = \\frac{X_{/m} \\times L}{N_{runs}} $$</div>
                        <div class="calculation-step">$$R_{total} = \\frac{${calcs.rhoT.toFixed(5)} \\times ${calcs['cable-length']}}{${calcs['cable-size']} \\times ${calcs['parallel-runs']}} = ${calcs.totalResistance.toFixed(5)} \\, \\Omega$$</div>
                        ${inputs['phase-type'] !== 'dc' ? `<div class="calculation-step">$$X_{total} = \\frac{${calcs.X_per_meter.toFixed(5)} \\times ${calcs['cable-length']}}{${calcs['parallel-runs']}} = ${calcs.totalReactance.toFixed(5)} \\, \\Omega$$</div>` : ''}
                     </div>
                `;

                detailsHTML += `
                    <div class="step" style="animation-delay: 0.3s;">
                        <h4>Step 3: Calculate Voltage Drop (Vd)</h4>
                        <p>Using the calculated current and impedance, the final voltage drop is determined using the selected method's formula.</p>
                        <div class="formula-box">$$${calcs.vdFormula}$$</div>
                        <div class="calculation-step">$$${calcs.vdSubstitution}$$</div>
                    </div>
                `;

                detailsHTML += `
                    <div class="step" style="animation-delay: 0.4s;">
                        <h4>Step 4: Calculate Percentage Drop (%VD)</h4>
                        <div class="formula-box">$$ \\%VD = \\frac{V_d}{V_{system}} \\times 100\\% $$</div>
                        <div class="calculation-step">$$\\%VD = \\frac{${calcs.voltageDrop.toFixed(3)}}{${calcs['system-voltage']}} \\times 100\\% = ${calcs.voltageDropPercent.toFixed(2)}\\%$$</div>
                    </div>
                `;
                
                if(calcs.recommendation){
                    detailsHTML += `<div class="step" style="animation-delay: 0.5s;"><h4>Recommendations</h4><div class="recommendation">${calcs.recommendation}</div></div>`;
                }
                
                // --- Summary Table ---
                let summaryTableHTML = `
                    <div id="summary-table-container">
                        <h3>Input & Result Summary</h3>
                        <table class="summary-table">
                            <tbody>
                `;

                const addRow = (param, value) => `<tr><td>${param}</td><td>${value}</td></tr>`;
                
                summaryTableHTML += addRow('System Voltage', `${inputs['system-voltage']} V`);
                summaryTableHTML += addRow('System Type', `${inputs['phase-type'].replace('three', 'Three-Phase AC').replace('single', 'Single-Phase AC').replace('dc', 'DC System')}`);
                summaryTableHTML += addRow('Load Type', `${inputs['load-type'].toUpperCase()} (${inputs['load-value']})`);
                if(inputs['phase-type'] !== 'dc') {
                    summaryTableHTML += addRow('Power Factor', `${calcs.pf.toFixed(2)}`);
                }
                summaryTableHTML += addRow('Load Current (Calculated)', `${calcs.loadCurrent.toFixed(2)} A`);

                summaryTableHTML += addRow('Cable Material', `${inputs['cable-material'].charAt(0).toUpperCase() + inputs['cable-material'].slice(1)}`);
                summaryTableHTML += addRow('Cable Size', `${inputs['cable-size']} mm²`);
                summaryTableHTML += addRow('Cable Length', `${inputs['cable-length']} m`);
                summaryTableHTML += addRow('Parallel Runs', `${inputs['parallel-runs']}`);
                summaryTableHTML += addRow('Conductor Temp.', `${inputs['temperature']} °C`);
                summaryTableHTML += addRow('Conduit Material', `${inputs['conduit-material'].charAt(0).toUpperCase() + inputs['conduit-material'].slice(1).replace('Pvc', 'PVC')}`);
                
                summaryTableHTML += addRow('Resistivity at Temp', `${calcs.rhoT.toFixed(5)} Ω·mm²/m`);
                summaryTableHTML += addRow('Total Resistance', `${calcs.totalResistance.toFixed(5)} Ω`);
                if(inputs['phase-type'] !== 'dc') {
                     summaryTableHTML += addRow('Total Reactance', `${calcs.totalReactance.toFixed(5)} Ω`);
                }

                summaryTableHTML += `<tr><td colspan="2" style="background-color: var(--bg-color); text-align: center; font-weight: bold;">RESULTS</td></tr>`;
                summaryTableHTML += addRow('Voltage Drop', `<strong>${calcs.voltageDrop.toFixed(2)} V</strong>`);
                summaryTableHTML += addRow('Voltage Drop Percentage', `<strong style="color: var(--${calcs.statusClass.replace('status-','')}-color);">${calcs.voltageDropPercent.toFixed(2)}%</strong>`);
                summaryTableHTML += addRow('Status', `<span class="status-value" style="color: var(--${calcs.statusClass.replace('status-','')}-color);">${calcs.status}</span>`);


                summaryTableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                calculationDetails.innerHTML = detailsHTML + summaryTableHTML;

                if (window.MathJax) { 
                    MathJax.typesetPromise([calculationDetails]).catch(function (err) {
                        console.log('MathJax processing error:', err);
                    });
                }
            },

            updateUIForPhase() {
                const isDC = phaseTypeSelect.value === 'dc';
                const loadType = loadTypeSelect.value;
                powerFactorGroup.style.display = (isDC || loadType === 'kva') ? 'none' : 'block';
                powerFactorInput.required = !(isDC || loadType === 'kva');
                
                const currentMethod = document.getElementById('calculation-method').value;
                document.getElementById('calculation-method').innerHTML = isDC 
                    ? `<option value="iec">DC Resistance Method</option>`
                    : `<option value="iec" ${currentMethod === 'iec' ? 'selected' : ''}>IEC 60364 (Impedance)</option><option value="nec" ${currentMethod === 'nec' ? 'selected' : ''}>NEC (K-Factor)</option><option value="simplified" ${currentMethod === 'simplified' ? 'selected' : ''}>Simplified (Resistance Only)</option>`;
            },
            
            saveProject() {
                const projectName = document.getElementById('project-name').value.trim();
                if (!projectName) { this.displayMessage("Please enter a project name to save.", "warning"); return; }
                const projects = JSON.parse(localStorage.getItem('vd_projects') || '{}');
                projects[projectName] = this.getInputs();
                localStorage.setItem('vd_projects', JSON.stringify(projects));
                this.displayMessage(`Project "${projectName}" saved.`, "success");
                this.loadProjects();
                document.getElementById('project-name').value = '';
            },
            
            loadProjects() {
                const projects = JSON.parse(localStorage.getItem('vd_projects') || '{}');
                const projectNames = Object.keys(projects);
                loadProjectSelect.innerHTML = '<option value="">Load a Saved Project...</option>';
                projectNames.sort().forEach(name => loadProjectSelect.add(new Option(name, name)));
            },

            loadSelectedProject() {
                const projectName = loadProjectSelect.value;
                if (!projectName) return;
                const projectData = JSON.parse(localStorage.getItem('vd_projects') || '{}')[projectName];
                if (projectData) {
                    for (const id in projectData) {
                        const element = document.getElementById(id);
                        if (element) element.value = projectData[id];
                    }
                    this.updateUIForPhase();
                    this.displayMessage(`Project "${projectName}" loaded.`, "info");
                    setTimeout(() => this.runCalculation('running'), 100);
                }
            },

            deleteSelectedProject() {
                 const projectName = loadProjectSelect.value;
                 if (!projectName) { this.displayMessage("Select a project to delete.", "warning"); return; }
                 let projects = JSON.parse(localStorage.getItem('vd_projects') || '{}');
                 delete projects[projectName];
                 localStorage.setItem('vd_projects', JSON.stringify(projects));
                 this.displayMessage(`Project "${projectName}" deleted.`, "success");
                 this.loadProjects();
            },

            saveLastInputs(inputs) { localStorage.setItem('vd_last_inputs', JSON.stringify(inputs)); },
            loadLastInputs() {
                const lastInputs = JSON.parse(localStorage.getItem('vd_last_inputs') || 'null');
                if (lastInputs) {
                     for (const id in lastInputs) {
                        const element = document.getElementById(id);
                        if (element) element.value = lastInputs[id];
                    }
                }
            },

            resetForm() {
                form.reset();
                this.updateUIForPhase();
                resultSection.classList.remove('show');
                localStorage.removeItem('vd_last_inputs');
                this.displayMessage("Form has been reset.", "info");
            },

            displayMessage(message, type = "info") {
                const messageBox = document.getElementById('custom-message-box');
                messageBox.textContent = message;
                messageBox.className = type + ' show';
                setTimeout(() => messageBox.classList.remove('show'), 4000);
            }
        };

        App.init();
    });
    </script>
</body>
</html>



