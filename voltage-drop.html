<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Voltage Drop & Cable Sizing Calculator - Industrial Grade</title>
    <meta name="description" content="Professional Voltage Drop Calculator per NEC/IEC standards. Calculates voltage dip, cable sizing, and phasor relationships. Features dynamic distance charting, temperature correction, and power factor analysis.">
    <meta name="keywords" content="voltage drop calculator, cable sizing, NEC 310-15, IEC 60364, phasor diagram, power factor correction, impedance calculation, electrical engineering tools, wire gauge calculator">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/voltage-drop.html" />

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF & Charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar { display: flex; justify-content: space-between; align-items: center; }
        .logo-container { text-decoration: none; color: white; display: flex; flex-direction: column; }
        .logo-text { font-size: 1.75rem; font-weight: 800; font-family: 'Montserrat', sans-serif; }
        .logo-subtitle { font-size: 0.8rem; margin: 4px 0 0 0; color: #E0E7FF; opacity: 0.9; }
        .nav-links { display: flex; gap: 24px; list-style: none; margin: 0; padding: 0; }
        .nav-links a { color: white; text-decoration: none; font-weight: 500; transition: color 0.3s; }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle { display: flex; align-items: center; gap: 12px; color: white; }
        .switch { position: relative; width: 56px; height: 30px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.2); transition: .4s; border-radius: 30px; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main */
        main { padding: 40px 0; }
        .card {
            background: var(--card); border-radius: 12px; padding: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05); margin-bottom: 30px; border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary); border-bottom: 3px solid var(--primary); padding-bottom: 15px;
            margin-top: 0; font-family: 'Montserrat', sans-serif; font-size: 1.8rem;
        }

        /* Forms */
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--heading); }
        .form-group input, .form-group select {
            width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 6px;
            background-color: var(--bg); color: var(--text); font-size: 1rem; transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1); }
        
        .vector-input-group { background: var(--bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border); position: relative; }
        .vector-input-header { font-weight: 700; margin-bottom: 10px; color: var(--primary); display: flex; align-items: center; gap: 8px; }

        /* Buttons */
        .btn {
            background: var(--grad); color: white; border: none; padding: 16px 30px;
            border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3); transition: all 0.3s; width: 100%;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4); }
        .btn-outline { background: transparent; border: 2px solid var(--secondary); color: var(--secondary); font-size: 0.9rem; padding: 8px 16px; }
        .btn-outline:hover { background: var(--secondary); color: white; }
        .button-wrapper { display: flex; justify-content: center; width: 100%; padding-top: 15px; gap: 15px; flex-wrap: wrap; }
        
        /* Presets */
        .preset-container { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .preset-btn { padding: 8px 12px; font-size: 0.85rem; border: 1px solid var(--border); background: var(--card); border-radius: 20px; cursor: pointer; transition: all 0.2s; color: var(--text); display: flex; align-items: center; gap: 5px; }
        .preset-btn:hover { background: var(--bg); border-color: var(--secondary); color: var(--secondary); }

        /* Results */
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start; }
        @media (max-width: 1024px) { .results-grid { grid-template-columns: 1fr; } }
        .results-table { width: 100%; border-collapse: collapse; margin-top: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 8px; overflow: hidden; }
        .results-table th, .results-table td { padding: 14px; text-align: left; border-bottom: 1px solid var(--border); }
        .results-table th { background: var(--grad); color: white; font-weight: 700; }
        .results-table td:first-child { font-weight: 600; color: var(--heading); }
        
        /* Steps */
        .calculation-step { font-family: 'Courier New', monospace; background-color: rgba(37, 99, 235, 0.05); padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid var(--secondary); font-size: 0.95rem; line-height: 1.6; }
        .calculation-step h4 { color: var(--primary); margin-top: 0; margin-bottom: 10px; font-size: 1.1rem; border-bottom: 1px dashed var(--border); padding-bottom: 5px; }

        /* Visualization */
        .chart-container { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 15px; position: relative; height: 350px; width: 100%; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        canvas { max-width: 100%; max-height: 100%; }

        /* Educational Content */
        .insight-card { background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03)); border-radius: 12px; padding: 25px; margin: 20px 0; border-left: 5px solid var(--secondary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: all 0.3s; }
        .insight-card:hover { transform: translateX(5px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .insight-card h4 { color: var(--secondary); font-size: 1.3rem; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px; font-family: 'Montserrat', sans-serif; }
        .insight-card p, .insight-card ul { margin: 10px 0; line-height: 1.8; color: var(--text); font-size: 1rem; }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Status Badges */
        .status-badge { padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block; }
        .status-pass { background: #dcfce7; color: #166534; }
        .status-fail { background: #fee2e2; color: #991b1b; }
        .status-warn { background: #fef9c3; color: #854d0e; }

        /* Footer */
        footer { background: #0F172A; color: #CBD5E1; padding: 50px 0 20px 0; margin-top: 60px; }
        .footer-content { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 40px; margin-bottom: 30px; }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn { width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; color: white; border-radius: 50%; font-size: 1.1rem; transition: transform 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .footer-disclaimer { text-align: center; padding-top: 25px; border-top: 1px solid #334155; max-width: 800px; margin: 0 auto; font-size: 0.9rem; }
        .footer-bottom { text-align: center; padding-top: 20px; font-size: 0.9rem; color: #94A3B8; }
        .hidden { display: none; }
        
        .message-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 16px 28px; border-radius: 8px; box-shadow: 0 6px 16px rgba(0,0,0,0.25); z-index: 10000; font-weight: 600; color: white; opacity: 0; transition: all 0.4s; display: none; }
        .message-box.show { display: block; opacity: 1; top: 30px; }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='index.html'>Home</a></li>
                    <li><a href="articles.html">Articles</a></li>
                    <li><a href="indexmech.html">Mechanical</a></li>
                    <li><a href="indexele.html">Electrical</a></li>
                    <li><a href="indexinst.html">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-bolt"></i> Advanced Voltage Drop Calculator (Phasor Analysis)</h2>
            
            <div class="tool-description">
                <p>This industrial-grade calculator solves voltage drop problems using the <strong>Rigorous AC Method</strong> ($V_d \approx I(R\cos\phi + X\sin\phi)$). It includes **Reactance Corrections** for steel conduit, **Temperature Adjustment** for conductors under load, and a **Phasor Diagram** to visualize the power factor effect. Checks cable ampacity limits.</p>
            </div>

            <div class="calculator-form">
                <form id="voltage-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('motor_start')"><i class="fas fa-car-battery"></i> Motor Start (Low PF)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('long_run')"><i class="fas fa-road"></i> Long Run (500m)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('heater')"><i class="fas fa-fire"></i> Heater (PF=1.0)</button>
                            </div>
                        </div>
                    </div>

                    <!-- System Config -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. System Configuration</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-cogs"></i> System Type</div>
                            <div class="form-group">
                                <label for="system-type">Phase & Voltage</label>
                                <select id="system-type">
                                    <option value="1ph_2w">1-Phase (2 Wire) - 230V/120V</option>
                                    <option value="3ph_3w" selected>3-Phase (3 Wire/4 Wire) - 400V/480V</option>
                                    <option value="dc">DC System</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="voltage">Nominal Voltage ($V_{LL}$) [V]</label>
                                <input type="number" id="voltage" value="400" step="10">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-plug"></i> Load</div>
                            <div class="form-group">
                                <label for="load-amps">Load Current ($I$) [A]</label>
                                <input type="number" id="load-amps" value="100" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="pf">Power Factor ($cos\phi$)</label>
                                <input type="number" id="pf" value="0.85" step="0.01" min="0.1" max="1.0">
                            </div>
                        </div>
                    </div>

                    <!-- Cable Data -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Cable Specification</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-ruler-horizontal"></i> Dimensions</div>
                            <div class="form-group">
                                <label for="distance">Cable Run Length [m]</label>
                                <input type="number" id="distance" value="100" step="10">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="cable-size">Cable Size [mm²]</label>
                                <select id="cable-size">
                                    <option value="1.5">1.5 mm²</option>
                                    <option value="2.5">2.5 mm²</option>
                                    <option value="4">4 mm²</option>
                                    <option value="6">6 mm²</option>
                                    <option value="10">10 mm²</option>
                                    <option value="16">16 mm²</option>
                                    <option value="25">25 mm²</option>
                                    <option value="35" selected>35 mm²</option>
                                    <option value="50">50 mm²</option>
                                    <option value="70">70 mm²</option>
                                    <option value="95">95 mm²</option>
                                    <option value="120">120 mm²</option>
                                    <option value="150">150 mm²</option>
                                    <option value="185">185 mm²</option>
                                    <option value="240">240 mm²</option>
                                    <option value="300">300 mm²</option>
                                    <option value="400">400 mm²</option>
                                    <option value="500">500 mm²</option>
                                    <option value="630">630 mm²</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-layer-group"></i> Material & Raceway</div>
                            <div class="form-group">
                                <label for="conductor">Conductor Material</label>
                                <select id="conductor">
                                    <option value="cu" selected>Copper (Cu)</option>
                                    <option value="al">Aluminum (Al)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="conduit">Raceway Type</label>
                                <select id="conduit">
                                    <option value="pvc" selected>PVC / Non-Magnetic (Standard X)</option>
                                    <option value="steel">Steel Conduit (High X)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="temp-op">Operating Temp [°C]</label>
                                <input type="number" id="temp-op" value="70" step="5">
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Voltage Drop</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Performance Analysis</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Drop Metrics</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Limit</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-info-circle"></i> Assessment:</strong>
                            <div id="interpretation-text" style="margin-top: 5px; font-size: 0.95rem;"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Phasor Diagram</h4>
                        <div class="chart-container">
                            <canvas id="phasorCanvas" width="400" height="300"></canvas>
                        </div>
                         <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                            <span style="color: #3B82F6;">● V_Source</span> &nbsp;
                            <span style="color: #10B981;">● V_Load</span> &nbsp;
                            <span style="color: #EF4444;">● I*Z Drop</span>
                        </div>
                        
                        <!-- Schematic Diagram -->
                        <div style="margin-top: 20px;">
                            <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Equivalent Circuit</h4>
                             <div class="chart-container" style="height:150px">
                                <canvas id="circuitCanvas"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                 <div style="margin-top: 30px;">
                    <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Voltage Drop vs Distance</h4>
                    <div class="chart-container" style="height:300px">
                        <canvas id="distChart"></canvas>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Resistance corrected for temperature using $R_t = R_{20}[1 + \alpha(T-20)]$. Steel conduit increases reactance by approx 25%. Ampacity check based on typical PVC/XLPE ratings (for guidance only).
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (MASSIVE) -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: Voltage Drop Physics</h2>
            
            <!-- Insight 1: Why it matters -->
            <div class="insight-card">
                <h4><i class="fas fa-exclamation-triangle"></i> 1. The Impact of Voltage Drop</h4>
                <p>Voltage drop is the loss of electrical potential as current flows through the resistance and reactance of a conductor.
                <br><strong>Motors:</strong> Torque $\propto V^2$. A 10% voltage drop results in a <strong>19% loss of starting torque</strong>, potentially causing the motor to stall or overheat.
                <br><strong>Lighting:</strong> Incandescent/Halogen output $\propto V^{3.4}$. A 5% drop cuts light by ~16%.
                <br><strong>Standards:</strong> IEC 60364 and NEC recommend max <strong>3% drop</strong> for lighting and <strong>5% drop</strong> for power circuits.</p>
            </div>

            <!-- Insight 2: The Formula -->
            <div class="insight-card">
                <h4><i class="fas fa-calculator"></i> 2. The Exact Formula</h4>
                <p>Most simple calculators use $V_d = \frac{2 \cdot L \cdot I \cdot \rho}{A}$ (DC approximation).
                <br>For AC systems, we must account for <strong>Inductive Reactance ($X$)</strong> and <strong>Power Factor ($\cos \phi$)</strong>. The vectors sum up:
                <div class="formula">$$ \Delta V \approx I \cdot L \cdot (R \cos\phi + X \sin\phi) \times \sqrt{3} $$</div>
                <br>Where $\sqrt{3}$ applies for 3-phase. At low power factors (e.g., motor start), the $X \sin\phi$ term dominates.</p>
            </div>

            <!-- Insight 3: Temperature Correction -->
            <div class="insight-card">
                <h4><i class="fas fa-thermometer-half"></i> 3. Temperature Correction ($\alpha$)</h4>
                <p>Copper resistance increases by ~0.4% for every degree Celsius rise.
                <br>Cable tables typically give $R$ at 20°C. However, cables under load run hotter (e.g., 70°C or 90°C).
                <br>Designing at 20°C is dangerous. This tool automatically corrects resistance to the operating temperature:
                $$ R_{op} = R_{20} \cdot [1 + 0.00393 \cdot (T_{op} - 20)] $$</p>
            </div>

            <!-- Insight 4: Skin Effect -->
            <div class="insight-card">
                <h4><i class="fas fa-magnet"></i> 4. Skin Effect & Proximity Effect</h4>
                <p>For large cables (>150 mm²), AC current tends to flow on the outer surface ("skin") of the conductor due to self-inductance. This effectively reduces the cross-sectional area, increasing AC Resistance ($R_{ac}$) compared to DC Resistance ($R_{dc}$).
                <br>This calculator uses standard $R_{ac}$ values for industrial frequencies (50/60 Hz).</p>
            </div>
            
            <!-- Insight 5: Parallel Cables -->
             <div class="insight-card">
                <h4><i class="fas fa-project-diagram"></i> 5. Parallel Runs</h4>
                <p>For high currents (>400A), single large cables become unwieldy and suffer from high Skin Effect. It is better to run smaller cables in parallel.
                <br>Resistance decreases: $R_{total} = R_{cable} / n$.
                <br>Voltage Drop is reduced by factor $n$.</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Empowering engineers with precision tools for complex analysis. If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='index.html'>Home</a></li>
                        <li><a href="indexele.html">Electrical</a></li>
                        <li><a href="indexmech.html">Mechanical</a></li>
                        <li><a href="indexinst.html">Instrumentation</a></li>
                        <li><a href="articles.html">Articles</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles.html'>Articles & Whitepapers</a></li>
                        <li><a href="sitemap2.html">Sitemap</a></li>                       
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to IEC 60364, NEC NFPA 70). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let distChart = null;
        let phasorChart = null;
        let lastResult = null;

        // Constants
        // Resistance (Ohm/km at 20C) and Reactance (Ohm/km) for Copper/Alu
        // Included Ampacity (Approx for PVC/30C ambient) for checking
        const cableData = {
            '1.5': { r_cu: 12.1, r_al: 20.0, x: 0.113, amp: 20 },
            '2.5': { r_cu: 7.41, r_al: 12.1, x: 0.107, amp: 27 },
            '4': { r_cu: 4.61, r_al: 7.41, x: 0.101, amp: 37 },
            '6': { r_cu: 3.08, r_al: 4.61, x: 0.096, amp: 48 },
            '10': { r_cu: 1.83, r_al: 3.08, x: 0.090, amp: 65 },
            '16': { r_cu: 1.15, r_al: 1.91, x: 0.086, amp: 87 },
            '25': { r_cu: 0.727, r_al: 1.20, x: 0.084, amp: 114 },
            '35': { r_cu: 0.524, r_al: 0.868, x: 0.082, amp: 140 },
            '50': { r_cu: 0.387, r_al: 0.641, x: 0.080, amp: 170 },
            '70': { r_cu: 0.268, r_al: 0.443, x: 0.079, amp: 215 },
            '95': { r_cu: 0.193, r_al: 0.320, x: 0.077, amp: 260 },
            '120': { r_cu: 0.153, r_al: 0.253, x: 0.076, amp: 300 },
            '150': { r_cu: 0.124, r_al: 0.206, x: 0.076, amp: 345 },
            '185': { r_cu: 0.0991, r_al: 0.164, x: 0.076, amp: 395 },
            '240': { r_cu: 0.0754, r_al: 0.125, x: 0.075, amp: 470 },
            '300': { r_cu: 0.0601, r_al: 0.100, x: 0.075, amp: 550 },
            '400': { r_cu: 0.0470, r_al: 0.0778, x: 0.075, amp: 650 },
            '500': { r_cu: 0.0366, r_al: 0.0605, x: 0.074, amp: 760 },
            '630': { r_cu: 0.0283, r_al: 0.0469, x: 0.073, amp: 880 }
        };

        // Temp Coeff
        const alpha_cu = 0.00393;
        const alpha_al = 0.00403;

        function loadPreset(type) {
            if (type === 'motor_start') {
                document.getElementById('system-type').value = '3ph_3w';
                document.getElementById('voltage').value = '400';
                document.getElementById('load-amps').value = '250'; // High start
                document.getElementById('pf').value = '0.35'; // Start PF
                document.getElementById('distance').value = '50';
                document.getElementById('cable-size').value = '70';
            } else if (type === 'long_run') {
                document.getElementById('system-type').value = '3ph_3w';
                document.getElementById('voltage').value = '415';
                document.getElementById('load-amps').value = '50';
                document.getElementById('pf').value = '0.9';
                document.getElementById('distance').value = '500';
                document.getElementById('cable-size').value = '35';
            } else if (type === 'heater') {
                document.getElementById('system-type').value = '1ph_2w';
                document.getElementById('voltage').value = '230';
                document.getElementById('load-amps').value = '16';
                document.getElementById('pf').value = '1.0';
                document.getElementById('distance').value = '30';
                document.getElementById('cable-size').value = '2.5';
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function performCalculation() {
            // 1. Get Inputs
            const sysType = document.getElementById('system-type').value;
            const V = parseFloat(document.getElementById('voltage').value);
            const I = parseFloat(document.getElementById('load-amps').value);
            const pf = parseFloat(document.getElementById('pf').value);
            const L = parseFloat(document.getElementById('distance').value);
            const sizeKey = document.getElementById('cable-size').value;
            const mat = document.getElementById('conductor').value;
            const raceway = document.getElementById('conduit').value;
            const temp = parseFloat(document.getElementById('temp-op').value);

            if (isNaN(V) || isNaN(I) || isNaN(L) || V<=0) {
                displayMessage("Check inputs.", "error");
                return;
            }

            // 2. Physics Engine
            // Get Resistance @ 20C (Ohm/km)
            const r20 = (mat === 'cu') ? cableData[sizeKey].r_cu : cableData[sizeKey].r_al;
            // Reactance Adjustment for Steel Conduit
            const x_base = cableData[sizeKey].x;
            const x = (raceway === 'steel') ? x_base * 1.25 : x_base;
            
            // Ampacity check
            const max_amp = cableData[sizeKey].amp;
            const amp_check_msg = (I > max_amp) ? `<span class="danger-text">OVERLOAD: Load ${I}A > Cable Rating ${max_amp}A!</span>` : `<span class="highlight">Current within Ampacity limit (${max_amp}A).</span>`;
            
            // Temperature Correction
            const alpha = (mat === 'cu') ? alpha_cu : alpha_al;
            const rt = r20 * (1 + alpha * (temp - 20)); // Ohm/km at operating temp
            
            // Circuit Factor (DC, 1ph, 3ph)
            let k_factor = 1.0;
            if (sysType === '1ph_2w') { k_factor = 2.0; }
            else if (sysType === '3ph_3w') { k_factor = Math.sqrt(3); }
            else if (sysType === 'dc') { k_factor = 2.0; }
            
            // Phasor Components
            const sin_phi = Math.sqrt(1 - pf*pf);
            
            // Voltage Drop Calc (V)
            // Vd = k * I * L(km) * (R cos + X sin)
            
            const r_drop = k_factor * I * (L/1000) * rt * pf;
            const x_drop = (sysType === 'dc') ? 0 : k_factor * I * (L/1000) * x * sin_phi;
            
            const vd_val = r_drop + x_drop;
            const vd_pct = (vd_val / V) * 100;
            const v_load = V - vd_val;
            
            // Max Lengths for 3% and 5%
            // Vd = k I L Z_eff / 1000 -> L = 1000 * Vd / (k I Z_eff)
            const z_eff = (sysType === 'dc') ? rt : (rt*pf + x*sin_phi);
            const vd_3 = V * 0.03;
            const vd_5 = V * 0.05;
            const L_max_3 = (1000 * vd_3) / (k_factor * I * z_eff);
            const L_max_5 = (1000 * vd_5) / (k_factor * I * z_eff);

            lastResult = { sysType, V, I, pf, L, sizeKey, mat, temp, vd_val, vd_pct, v_load, rt, x, k_factor };

            // 4. Render Step-by-Step
            let html = `<h4>Step 1: Impedance Calculation & Correction</h4>`;
            html += `<div class="calculation-step">`;
            html += `Base Resistance @ 20°C: $R_{20} = ${r20} \\, \\Omega/km$. Base Reactance: $X_{base} = ${x_base} \\, \\Omega/km$.<br>`;
            if (raceway === 'steel') html += `Steel Conduit increases Reactance: $X = X_{base} \\times 1.25 = ${x.toFixed(3)} \\, \\Omega/km$.<br>`;
            html += `Temperature Correction for ${mat === 'cu' ? 'Copper' : 'Aluminum'} ($\alpha=${alpha}$) at ${temp}°C:<br>`;
            html += `$$ R_{t} = R_{20} [1 + \\alpha (T - 20)] = ${r20} [1 + ${alpha} (${temp}-20)] = \\mathbf{${rt.toFixed(3)} \\, \\Omega/km} $$`;
            html += `</div>`;

            html += `<h4>Step 2: Phasor Components (Resistive vs. Reactive)</h4>`;
            html += `<div class="calculation-step">`;
            html += `Power Factor: $\\cos\\phi = ${pf}$. Sine: $\\sin\\phi = \\sqrt{1 - ${pf}^2} = ${sin_phi.toFixed(3)}$.<br>`;
            html += `System Factor $K = ${k_factor.toFixed(3)}$ (${sysType === '3ph_3w' ? '3-Phase' : '1-Phase/DC'}).<br>`;
            
            if (sysType === 'dc') {
                 html += `DC System: Reactance is ignored ($X=0$).<br>`;
                 html += `$$ V_{drop} = K \\cdot I \\cdot L \\cdot R_t = 2 \\cdot ${I} \\cdot ${L/1000} \\cdot ${rt.toFixed(3)} = \\mathbf{${vd_val.toFixed(2)} V} $$`;
            } else {
                 html += `<strong>Resistive Drop Component:</strong><br>`;
                 html += `$$ V_R = K \\cdot I \\cdot L \\cdot (R_t \\cos\\phi) = ${k_factor.toFixed(3)} \\cdot ${I} \\cdot ${L/1000} \\cdot (${rt.toFixed(3)} \\cdot ${pf}) = ${r_drop.toFixed(2)} \\text{ V} $$<br>`;
                 html += `<strong>Reactive Drop Component:</strong><br>`;
                 html += `$$ V_X = K \\cdot I \\cdot L \\cdot (X \\sin\\phi) = ${k_factor.toFixed(3)} \\cdot ${I} \\cdot ${L/1000} \\cdot (${x.toFixed(3)} \\cdot ${sin_phi.toFixed(3)}) = ${x_drop.toFixed(2)} \\text{ V} $$<br>`;
                 html += `$$ V_{total} \\approx V_R + V_X = \\mathbf{${vd_val.toFixed(2)} V} $$`;
            }
            html += `</div>`;

            html += `<h4>Step 3: Final Analysis & Limits</h4>`;
            html += `<div class="calculation-step">`;
            html += `Voltage at Load: $V_{load} = V_{source} - V_{drop} = ${V} - ${vd_val.toFixed(2)} = \\mathbf{${v_load.toFixed(1)} V}$.<br>`;
            html += `Percent Drop: $\\%V_d = (${vd_val.toFixed(2)} / ${V}) \\times 100 = \\mathbf{${vd_pct.toFixed(2)}\\%}$.<br>`;
            html += `Max Length for 3% Drop: <strong>${Math.floor(L_max_3)} m</strong>.<br>`;
            html += `${amp_check_msg}`;
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;

            // 5. Update Table
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, l) => {
                tbody.innerHTML += `<tr><td><strong>${n}</strong></td><td>${v}</td><td>${l}</td></tr>`;
            };
            
            let status = "OK";
            let color = "var(--success)";
            if (vd_pct > 5.0) { status = "CRITICAL"; color = "var(--danger)"; }
            else if (vd_pct > 3.0) { status = "WARNING"; color = "var(--warning)"; }
            
            addRow("Voltage Drop", vd_val.toFixed(2) + " V", `<span style="color:${color}; font-weight:bold">${vd_pct.toFixed(2)}%</span>`);
            addRow("Load Voltage", v_load.toFixed(1) + " V", "-");
            addRow("Cable Impedance", z_eff.toFixed(4) + " Ω/km", "Effective Z");
            addRow("Max Run (5%)", Math.floor(L_max_5) + " m", "Design Limit");

            const interpEl = document.getElementById('interpretation-text');
            if (I > max_amp) {
                 interpEl.innerHTML = `<span style="color:var(--danger); font-weight:bold;">AMPACITY FAILURE.</span> Cable is undersized for current. Heat damage likely. Ignore voltage drop results until cable size is increased.`;
            } else if (vd_pct > 5) {
                interpEl.innerHTML = `<span style="color:var(--danger); font-weight:bold;">High Voltage Drop.</span> Exceeds 5% limit. Upsize cable to next size.`;
            } else if (vd_pct > 3) {
                interpEl.innerHTML = `<span style="color:var(--warning); font-weight:bold;">Marginal.</span> Acceptable for power, check lighting limits (3%).`;
            } else {
                interpEl.innerHTML = `<span class="highlight">Optimal Design.</span> Drop is within limits and ampacity is safe.`;
            }

            // 6. Draw Visuals
            drawPhasor(V, vd_val, pf, r_drop, x_drop);
            drawChart(sysType, V, I, rt, x, pf);
            drawCircuit(sysType, V, I, r_drop, x_drop, v_load);

            // 7. Show
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        function drawPhasor(Vsource, Vdrop, pf, Vr, Vx) {
            const canvas = document.getElementById('phasorCanvas');
            const ctx = canvas.getContext('2d');
            const cw = canvas.width;
            const ch = canvas.height;

            ctx.clearRect(0, 0, cw, ch);
            
            const cx = 50; 
            const cy = ch - 50;
            const scale = (cw - 100) / Vsource;
            const angle = Math.acos(pf); // rad

            // Vload reference (Flat)
            const Vload = Vsource - Vdrop; // Approx magnitude for sketch
            
            // Draw Vload (Green)
            ctx.beginPath();
            ctx.strokeStyle = '#10B981';
            ctx.lineWidth = 4;
            ctx.moveTo(cx, cy);
            ctx.lineTo(cx + Vload*scale, cy);
            ctx.stroke();
            
            // Draw I vector (Lagging if inductive)
            ctx.beginPath();
            ctx.strokeStyle = '#64748B';
            ctx.lineWidth = 1;
            ctx.setLineDash([5,5]);
            ctx.moveTo(cx, cy);
            const iLen = 80;
            ctx.lineTo(cx + iLen*Math.cos(-angle), cy + iLen*Math.sin(-angle));
            ctx.stroke();
            ctx.fillText("I", cx + iLen + 5, cy + 20);
            ctx.setLineDash([]);
            
            // Draw IR Drop (Parallel to I)
            const x1 = cx + Vload*scale;
            const y1 = cy;
            const x2 = x1 + Vr*scale*Math.cos(-angle);
            const y2 = y1 + Vr*scale*Math.sin(-angle);
            
            ctx.beginPath();
            ctx.strokeStyle = '#F59E0B'; // Orange
            ctx.lineWidth = 3;
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            
            // Draw IX Drop (90 deg to I)
            // Simplified: Vertical component if I is horizontal.
            // With rotated I:
            const x3_real = x2 + Vx*scale*Math.sin(angle); 
            const y3_real = y2 - Vx*scale*Math.cos(angle);
            
            ctx.beginPath();
            ctx.strokeStyle = '#EF4444'; // Red
            ctx.moveTo(x2, y2);
            ctx.lineTo(x3_real, y3_real);
            ctx.stroke();
            
            // Vsource (Resultant)
            ctx.beginPath();
            ctx.strokeStyle = '#3B82F6';
            ctx.moveTo(cx, cy);
            ctx.lineTo(x3_real, y3_real);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#10B981'; ctx.fillText("V_load", cx + Vload*scale/2, cy + 15);
            ctx.fillStyle = '#F59E0B'; ctx.fillText("IR", x1+10, y1-10);
            ctx.fillStyle = '#EF4444'; ctx.fillText("IX", x2, y2-20);
            ctx.fillStyle = '#3B82F6'; ctx.fillText("V_source", cx + Vload*scale/2, cy - 40);
        }

        function drawCircuit(sys, V, I, Vr, Vx, Vload) {
             const canvas = document.getElementById('circuitCanvas');
            const ctx = canvas.getContext('2d');
            const cw = canvas.width = 400;
            const ch = canvas.height = 150;
            
            ctx.clearRect(0,0,cw,ch);
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#334155';
            ctx.fillStyle = '#000';
            ctx.font = '12px Inter';
            
            // Source
            ctx.beginPath();
            ctx.arc(50, ch/2, 20, 0, 2*Math.PI);
            ctx.stroke();
            ctx.fillText("Source", 30, ch/2 + 35);
            ctx.fillText(`${V}V`, 35, ch/2 + 5);
            
            // Line Top
            ctx.beginPath();
            ctx.moveTo(70, ch/2 - 10);
            ctx.lineTo(100, ch/2 - 10);
            // Resistor symbol
            ctx.lineTo(110, ch/2 - 15); ctx.lineTo(120, ch/2 - 5);
            ctx.lineTo(130, ch/2 - 15); ctx.lineTo(140, ch/2 - 5);
            ctx.lineTo(150, ch/2 - 10);
            // Inductor symbol (loops)
            ctx.bezierCurveTo(160, ch/2-25, 170, ch/2-25, 180, ch/2-10);
            ctx.bezierCurveTo(190, ch/2-25, 200, ch/2-25, 210, ch/2-10);
            ctx.lineTo(350, ch/2 - 10);
            ctx.stroke();
            
            // Labels Z
            ctx.fillText("R", 120, ch/2 - 25);
            ctx.fillText("X", 180, ch/2 - 25);
            
            // Load
            ctx.strokeRect(350, ch/2 - 30, 40, 60);
            ctx.fillText("Load", 355, ch/2 + 5);
            ctx.fillText(`${I}A`, 355, ch/2 - 40);
            
            // Return Line
            ctx.beginPath();
            ctx.moveTo(350, ch/2 + 10);
            ctx.lineTo(70, ch/2 + 10);
            ctx.stroke();
        }

        function drawChart(sys, V, I, rt, x, pf) {
            const ctx = document.getElementById('distChart').getContext('2d');
            if (distChart) distChart.destroy();
            
            // Plot Vdrop% vs Distance
            // Max distance 1000m
            const labels = [];
            const data3 = [];
            const data5 = [];
            const dataAct = [];
            
            let k = 1;
            if (sys.includes('3ph')) k = Math.sqrt(3);
            else if (sys === '1ph_2w' || sys === 'dc') k = 2;
            
            // Z_eff
            const sin_phi = Math.sqrt(1 - pf*pf);
            const z = (sys === 'dc') ? rt : (rt*pf + x*sin_phi);
            
            // Calculate max lengths for 3% and 5% limits
            const L_3 = (0.03 * V) * 1000 / (k * I * z);
            const L_5 = (0.05 * V) * 1000 / (k * I * z);
            
            const maxL = Math.max(L_5 * 1.2, 100);
            
            // Plot line
            for(let l=0; l<=maxL; l+=maxL/10) {
                labels.push(l.toFixed(0));
                const vd = (k * I * (l/1000) * z);
                const pct = (vd/V)*100;
                dataAct.push(pct);
            }
            
            distChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Voltage Drop %',
                            data: dataAct,
                            borderColor: '#3B82F6',
                            borderWidth: 3,
                            fill: false
                        },
                        {
                            label: '3% Limit',
                            data: Array(labels.length).fill(3),
                            borderColor: '#F59E0B',
                            borderWidth: 2,
                            borderDash: [5,5],
                            pointRadius: 0
                        },
                        {
                            label: '5% Limit',
                            data: Array(labels.length).fill(5),
                            borderColor: '#EF4444',
                            borderWidth: 2,
                            borderDash: [5,5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: {display:true, text:'Cable Length (m)'} },
                        y: { title: {display:true, text:'Voltage Drop (%)'}, min: 0 }
                    }
                }
            });
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(30, 58, 138); 
            pdf.text('Voltage Drop Analysis Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. System Parameters', 14, y);
            y += 5;

            const inputData = [
                ['System', lastResult.sysType.toUpperCase()],
                ['Voltage', `${lastResult.V} V`],
                ['Load', `${lastResult.I} A`],
                ['Distance', `${lastResult.L} m`],
                ['Cable', `${lastResult.sizeKey} mm² ${lastResult.mat.toUpperCase()}`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. Calculated Drop', 14, y);
            y += 5;

            const resData = [
                ['Voltage Drop', `${lastResult.vd_val.toFixed(2)} V`],
                ['Drop %', `${lastResult.vd_pct.toFixed(2)} %`],
                ['Load Voltage', `${lastResult.v_load.toFixed(1)} V`],
                ['Impedance (Rt)', `${lastResult.rt.toFixed(4)} Ω/km`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] },
                didParseCell: function(data) {
                    if(data.row.index === 1) {
                        data.cell.styles.fontStyle = 'bold';
                        data.cell.styles.textColor = lastResult.vd_pct > 5 ? [220, 38, 38] : [16, 185, 129];
                    }
                }
            });

            pdf.save('Voltage_Drop_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }
    </script>
</body>
</html>

