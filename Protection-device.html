<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electrical Protective Device Selector - Design Calculators - Electrical</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="Intelligent tool to select the correct electrical protective device (MCB, MCCB, RCD, Fuse) based on load, fault level, and IEC/IEEE standards.">
    <meta name="keywords" content="protective device selector, circuit breaker calculator, fuse selector, mcb, mccb, rcd, iec 60898, iec 60947, electrical engineering">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for Formulas (in educational content) -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    <style>
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
        }
        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
             box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        /* Checkbox Group Styling */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            background-color: var(--bg);
            padding: 10px;
            border-radius: 6px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
            color: var(--heading);
        }
        .checkbox-group label:hover {
            border-color: var(--primary);
        }
        .checkbox-group input {
            width: 1.1em;
            height: 1.1em;
            margin-right: 10px;
            accent-color: var(--primary);
        }
        
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn-group .btn {
            flex: 1;
            min-width: 150px;
        }
        .btn.secondary {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn.accent {
            background: var(--accent);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        /* NEW STEP-BY-STEP STYLES */
        .steps-container {
            display: none;
            margin-top: 30px;
        }
        .steps-container.active {
            display: block;
        }
        .step-card {
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px; /* Spacing between cards */
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
        }
        .step-card .number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        .step-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: start;
        }
        .step-content ul {
            padding-left: 20px;
            margin-top: 10px;
        }
        .step-content li {
            margin-bottom: 8px;
        }
        @media (max-width: 768px) {
            .step-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Recommendation Card Styles */
        .recommendation-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-left: 5px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .recommendation-card.primary {
            border-left-color: var(--success);
            background: linear-gradient(135deg, var(--bg), rgba(16,185,129,0.05));
        }
        .recommendation-card.composite {
            border-left-color: var(--secondary);
            background: linear-gradient(135deg, var(--bg), rgba(37,99,235,0.05));
        }
        .recommendation-card.alternative {
             border-left-color: var(--accent);
             background: linear-gradient(135deg, var(--bg), rgba(245,158,11,0.05));
        }
        .recommendation-card h5 {
            color: var(--heading);
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0 0 10px 0;
        }
        .recommendation-card.primary h5 { color: var(--success); }
        .recommendation-card.composite h5 { color: var(--secondary); }
        .recommendation-card.alternative h5 { color: var(--accent); }
        
        .recommendation-card ul {
            padding-left: 20px;
            margin: 10px 0;
            font-size: 0.95rem;
        }
        .recommendation-card ul li {
            margin-bottom: 5px;
        }
        .recommendation-card .spec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        .spec-grid span {
            display: block;
        }
        .spec-grid strong {
            color: var(--heading);
        }
        .recommendation-card .potential-issues {
            color: var(--danger);
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 10px;
        }


        /* Educational Section */
        .education-section {
            margin-top: 60px;
        }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i {
            font-size: 1.5rem;
        }
        .insight-card p {
            margin: 10px 0;
            line-height: 1.8;
        }
        .insight-card ol,
        .insight-card ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .insight-card li {
            margin-bottom: 10px;
        }
        .stat-highlight {
            display: inline-block;
            background: var(--accent);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin: 0 4px;
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 {
            color: var(--danger);
            margin-top: 0;
        }
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h4 {
            color: var(--success);
            margin-top: 0;
        }


        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .btn-group { flex-direction: column; }
            .checkbox-group { grid-template-columns: 1fr; }
        }
        .hidden { display: none; }
        
        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 5px;
            cursor: help;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Adjusted width */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-family: 'Inter', sans-serif; /* Professional font */
            font-size: 0.85rem; /* Slightly smaller font size */
            line-height: 1.4; /* Better readability */
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>

    <header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href="#">Home</a></li>
                    <li><a href="articles.html">Articles</a></li>
                    <li><a href="indexmech.html">Mechanical</a></li>
                    <li><a href="indexele.html">Electrical</a></li>
                    <li><a href="indexinst.html">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-shield-alt"></i> Electrical Protective Device Selector</h2>
            
            <p>This tool helps electrical engineers select appropriate protective devices based on system parameters and protection requirements. Input accurate data for precise recommendations based on IEC and IEEE standards.</p>
            
            <div class="calculator-form">
                <form id="protection-selector-form">
                    <h3>Input Parameters</h3>
                    
                    <div class="form-row">
                        <!-- Load Type -->
                        <div class="form-group">
                            <label for="load-type">Load Type <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">Resistive: Heaters; Inductive: Motors, Transformers; Capacitive: Capacitor banks; Motor: Specific inductive load with high starting current.</span></i></label>
                            <select id="load-type">
                                <option>Resistive</option>
                                <option>Inductive</option>
                                <option>Capacitive</option>
                                <option>Mixed</option>
                                <option>Motor</option>
                            </select>
                        </div>

                        <!-- Application Type -->
                        <div class="form-group">
                            <label for="application-type">Application Type <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">Defines the environment and regulatory requirements. E.g., Residential has lower fault levels than Industrial.</span></i></label>
                            <select id="application-type">
                                <option>Residential</option>
                                <option>Commercial</option>
                                <option>Industrial</option>
                                <option>Medical</option>
                                <option>Data Center</option>
                                <option>Hazardous Area</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <!-- Phase Type -->
                        <div class="form-group">
                            <label for="phase-type">Phase Type <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">Single-phase for smaller loads (e.g., homes), Three-phase for larger loads (e.g., industrial motors).</span></i></label>
                            <select id="phase-type">
                                <option>Single-phase</option>
                                <option>Three-phase</option>
                            </select>
                        </div>

                        <!-- Voltage Level -->
                        <div class="form-group">
                            <label for="voltage-level">Voltage Level <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">System operating voltage. LV: Low Voltage, MV: Medium Voltage, HV: High Voltage.</span></i></label>
                            <select id="voltage-level">
                                <option>LV (&lt;1kV)</option>
                                <option>MV (1-33kV)</option>
                                <option>HV (&gt;33kV)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <!-- Current Rating -->
                        <div class="form-group">
                            <label for="current-rating">Current Rating (Amps) <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">The full load current of the circuit to be protected.</span></i></label>
                            <input type="number" id="current-rating" placeholder="e.g., 16" value="16">
                        </div>

                        <!-- Fault Level (kA) -->
                        <div class="form-group">
                            <label for="fault-level">Prospective Fault Current (kA) <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">The maximum possible short-circuit current at the point of installation. Critical for selecting device breaking capacity.</span></i></label>
                            <input type="number" id="fault-level" placeholder="e.g., 6" step="0.1" value="6">
                        </div>
                    </div>

                    <div class="form-row" style="grid-template-columns: 1fr;">
                        <!-- Earthing System -->
                        <div class="form-group">
                            <label for="earthing-system">Earthing System <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">TT: Earth and neutral separate. TN-S: Separate neutral and PE. TN-C: Combined neutral and PE. IT: Unearthed or high-impedance earthed.</span></i></label>
                            <select id="earthing-system">
                                <option>TT</option>
                                <option>TN-S</option>
                                <option>TN-C</option>
                                <option>IT</option>
                            </select>
                        </div>
                    </div>

                    <h3>Protection Requirements <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">Select all required protections. This is a key factor in device selection.</span></i></h3>
                    <div id="protection-requirements" class="checkbox-group">
                        <!-- Checkboxes will be inserted here by JS -->
                    </div>

                    <h3 style="margin-top: 30px;">Environmental Conditions <i class="fas fa-info-circle tooltip info-icon"><span class="tooltiptext">The operational environment impacts device selection, especially enclosure type (IP rating) and material.</span></i></h3>
                    <div id="environmental-conditions" class="checkbox-group">
                        <!-- Checkboxes will be inserted here by JS -->
                    </div>

                    <div class="btn-group" style="margin-top: 25px;">
                        <button type="button" id="get-recommendation" class="btn"><i class="fas fa-calculator"></i> Get Recommendation</button>
                        <button type="button" id="reset-btn" class="btn accent"><i class="fas fa-sync-alt"></i> Reset</button>
                        <button type="button" id="pdf-btn" class="btn secondary" style="display: none;"><i class="fas fa-file-pdf"></i> Download PDF</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- NEW Step-by-Step Results Container -->
        <div id="steps-container" class="steps-container">
            <!-- Step cards will be dynamically inserted here -->
        </div>

        <!-- NEW/EXPANDED EDUCATIONAL INSIGHTS SECTION -->
        <div id="education-section" class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Professional Insights: Guide to Electrical Protection</h2>

            <div class="insight-card">
                <h4><i class="fas fa-exclamation-triangle"></i> The "Why" of Electrical Protection</h4>
                <p>Electrical protection is the bedrock of any safe and reliable power system. It is not an optional extra; it is a fundamental requirement. The goals are threefold:</p>
                <ol>
                    <li><strong>Protect People:</strong> The primary goal. To prevent electric shock, burns, and death from direct or indirect contact with live parts or fault currents. Devices like RCDs are specifically designed for this.</li>
                    <li><strong>Protect Property:</strong> To prevent damage to equipment, buildings, and infrastructure. This includes stopping fires caused by overloaded cables (Overload) or arc faults (AFDD), and preventing equipment from exploding under short-circuit conditions (Short Circuit).</li>
                    <li><strong>Protect Process (Continuity):</strong> In industrial and commercial settings, preventing unnecessary downtime is critical. Advanced protection ensures that only the *faulty* part of the system is disconnected, allowing the rest of the operation to continue. This is known as **selectivity** or **discrimination**.</li>
                </ol>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-bolt"></i> Overcurrent Protection: The Two-Headed Monster</h4>
                <p><strong>Overcurrent</strong> is any current higher than the rated current of the equipment or cable. It is the most common and dangerous condition, and it comes in two distinct forms that require different responses:</p>
                <p><strong>1. Overload Protection:</strong><br>
                This is a "slow" problem. It's a minor overcurrent, perhaps 1.5x to 3x the normal current (e.g., 15A in a 10A circuit). It's typically caused by plugging in too many devices or a motor struggling under heavy load. It's not immediately catastrophic, but over minutes or hours, this extra current generates excessive heat ($P = I^2R$), which will melt cable insulation and start a fire.
                <br><strong>Protection:</strong> This requires a **thermal** tripping mechanism. It's *slow* to avoid tripping on harmless in-rush currents (like a motor starting), but *fast enough* to trip before the cable melts.</p>
                
                <p><strong>2. Short-Circuit Protection:</strong><br>
                This is an "instant" disaster. It's a massive overcurrent, often 100x to 10,000x the normal current (e.g., 5,000A in a 10A circuit). It's caused by a direct fault, like a cut cable or internal equipment failure. The energy released is explosive, capable of vaporizing copper, creating plasma arcs, and causing catastrophic equipment failure in milliseconds.
                <br><strong>Protection:</strong> This requires a **magnetic** or **electronic** tripping mechanism. It must be *instantaneous* (tripping in less than 0.1 seconds) to disconnect the fault before the destructive energy is released.</p>
                <p>A circuit breaker (like an MCB or MCCB) contains *both* a thermal and a magnetic mechanism to protect against both conditions.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-chart-line"></i> Understanding Trip Curves (B, C, D, K, Z)</h4>
                <p>The "Trip Curve" of a circuit breaker defines its sensitivity to short circuits (the magnetic part). It's crucial for preventing "nuisance tripping" while ensuring safety.</p>
                <ul>
                    <li><strong>Type B (3-5 $I_n$):</strong> Very sensitive. For resistive loads with no inrush current, like electric heaters or outlets in a home. It will trip instantly on a fault 3-5 times its rated current.</li>
                    <li><strong>Type C (5-10 $I_n$):</strong> The "all-rounder." This is the most common type, used for general-purpose lighting and motor circuits with moderate inrush (like a vacuum cleaner or small fan).</li>
                    <li><strong>Type D (10-20 $I_n$):</strong> High tolerance. For high-inductance loads with massive inrush currents, like large transformers, X-ray machines, or large motors. Using a Type C here would cause it to trip every time the equipment starts.</li>
                    <li><strong>Type K (8-12 $I_n$):</strong> A "motor" specific curve, offering a balance between Type C and D.</li>
                    <li><strong>Type Z (2-3 $I_n$):</strong> Extremely sensitive. For protecting sensitive electronic circuits or semiconductor devices that can be damaged by even small, brief overcurrents.</li>
                </ul>
            </div>

            <div class="danger-box">
                <h4><i class="fas fa-heartbeat"></i> Earth Fault Protection: The Life Saver (RCD/GFCI)</h4>
                <p>Overcurrent protection (breakers/fuses) **will not save you from a fatal electric shock**. A typical fatal shock involves a current of 50-100mA (0.05-0.1A) passing through the body to ground. This current is *too small* to trip a 16A or 20A breaker.</p>
                <p>This is where a **Residual Current Device (RCD)**, also known as a Ground Fault Circuit Interrupter (GFCI), comes in. An RCD works by a simple principle: "what goes out must come in."</p>
                <p>It constantly measures the current in the "live" wire and the "neutral" wire. In a healthy circuit, these are perfectly balanced.</p>
                <p>If you touch a live part, a small amount of current (e.g., 50mA) will flow *through your body* to the ground instead of returning via the neutral wire. The RCD detects this tiny 50mA *imbalance* and trips the circuit in milliseconds—long before the shock can stop your heart. A 30mA RCD is the standard for protecting human life.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-fire-extinguisher"></i> Arc Fault Protection (AFDD): The Fire Prevention Specialist</h4>
                <p>There's a third type of fault that RCDs and MCBs can't detect: a **series arc fault**. This is a tiny, sputtering spark in a damaged cable, a loose terminal, or a faulty appliance plug. This arc is like a tiny, 2000°C welder's torch.</p>
                <p>The current draw is often *less* than the breaker's rating (e.g., 5A on a 16A circuit), so the MCB doesn't see an overload. The current is still balanced (no earth leakage), so the RCD doesn't see a fault. But this tiny, continuous arc superheats the surrounding plastic and wood, and is a primary cause of electrical fires.</p>
                <p>An **Arc Fault Detection Device (AFDD)** is a "smart" device with a microprocessor that "listens" to the electrical sine wave, detecting the unique high-frequency "sputter" and "noise" that only an arc fault makes. When it detects this signature, it trips the circuit, preventing a fire before it can start.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-bolt-lightning"></i> Surge Protection (SPD): The Gatekeeper</h4>
                <p>A **Surge Protection Device (SPD)** does not protect against overloads or short circuits. It protects against a different, very fast enemy: **transient overvoltages**. These are massive, microsecond-long voltage spikes, typically thousands of volts.</p>
                <p>They are caused by lightning strikes (even miles away) or large inductive loads (like motors) being switched off. These spikes travel through the wiring and will instantly destroy sensitive electronics like computers, TVs, and PLCs.</p>
                <p>An SPD is installed in parallel with your supply. It's an "open gate" that constantly monitors the voltage. When it sees a normal 240V, it does nothing. But when it detects a spike of 3000V, it slams "shut" in nanoseconds, diverting the entire surge of energy safely to ground, protecting everything downstream. It's the bouncer for your electrical system.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-sitemap"></i> Selectivity & Discrimination: The Art of Smart Protection</h4>
                <p>In a large building, you don't want a fault in a single light fixture to trip the main breaker for the entire building. This is where **selectivity** (or **discrimination**) is key.</p>
                <p>It's the art of coordinating your protective devices so that only the device *closest to the fault* trips, leaving the rest of the system powered on. For example:</p>
                <p><strong>Main Building Breaker (100A)</strong> -> <strong>Floor Breaker (40A)</strong> -> <strong>Final Circuit Breaker (10A)</strong> -> *Fault*</p>
                <p>In a selective system, only the 10A breaker will trip. This is achieved by carefully choosing device ratings, trip curves, and (in advanced systems) time delays. A "total" discrimination system is the hallmark of a professionally designed, robust electrical installation, and it's a primary function of advanced devices like MCCBs, ACBs, and Protection Relays.</p>
            </div>

        </div>

    </main>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="indexele.html">Electrical</a></li>
                        <li><a href="indexmech.html">Mechanical</a></li>
                        <li><a href="indexinst.html">Instrumentation</a></li>                       
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href="articles.html">Articles & Whitepapers</a></li>
                        <li><a href="sitemap2.html">Sitemap</a></li>
                        <li><a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer">YouTube Channel</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All recommendations are for preliminary engineering design guidance and educational purposes only. The selection of protective devices is a critical task that must comply with all local and international standards (e.g., IEC 60364, NEC/NFPA 70, BS 7671) and be performed by a qualified professional engineer. Always verify fault levels, coordination, and site-specific conditions before implementation.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- START OF SCRIPT ---

        // Fix for the ReferenceError:
        // This function is now defined in the global scope of the script tag.
        function showMessage(msg, type = 'success') {
            const messageBox = document.getElementById('message-box');
            if (!messageBox) {
                console.error("MessageBox element not found!");
                return;
            }
            messageBox.textContent = msg;
            if (type === 'error') {
                messageBox.style.backgroundColor = 'var(--danger)';
            } else if (type === 'warning') {
                 messageBox.style.backgroundColor = 'var(--warning)';
                 messageBox.style.color = '#333'; // Dark text for light warning color
            } else {
                messageBox.style.backgroundColor = 'var(--success)';
                messageBox.style.color = 'white';
            }
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        // --- DATABASE of Protective Devices ---
        const devices = {
            // Fuses (IEC Standards)
            'Fuse-gG': { 
                name: 'Cartridge Fuse (gG/gL)', 
                type: 'Fuse', 
                minI: 0.1, maxI: 100, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Fire Protection'], 
                breakingCapacity: { LV: { min: 6, max: 50 } }, // kA
                discrimination: 'Good', selectivity: 'Good', 
                standards: 'IEC 60269-1, IEC 60269-2', 
                notes: 'General purpose fuse for cable and conductor protection. Non-rewirable. Widely used in residential and light commercial applications in Europe and other IEC-standard regions.' 
            },
            'Fuse-aM': { 
                name: 'Motor Protection Fuse (aM)', 
                type: 'Fuse', 
                minI: 1, maxI: 630, 
                voltage: ['LV'], 
                protections: ['Short Circuit'], 
                breakingCapacity: { LV: { min: 50, max: 120 } }, // kA
                discrimination: 'Good', selectivity: 'Good', 
                standards: 'IEC 60269-2', 
                notes: 'Specifically designed for motor circuits, providing only short-circuit protection. Requires separate overload protection (e.g., thermal overload relay). Common in industrial motor control centers.' 
            },
            'Fuse-HRC': { 
                name: 'HRC Fuse (High Rupturing Capacity)', 
                type: 'Fuse', 
                minI: 2, maxI: 1250, 
                voltage: ['LV', 'MV'], 
                protections: ['Short Circuit', 'Overload', 'Fire Protection'], 
                breakingCapacity: { LV: { min: 80, max: 200 }, MV: { min: 10, max: 63 } }, // kA
                discrimination: 'Excellent', selectivity: 'Excellent', 
                standards: 'IEC 60269-2, IEC 60269-3', 
                notes: 'Known for very high breaking capacity, essential in industrial and commercial applications with high prospective fault currents. Ensures rapid fault clearance.' 
            },
            'Fuse-Semiconductor': { 
                name: 'Semiconductor Fuse (aR/gR)', 
                type: 'Fuse', 
                minI: 1, maxI: 1000, 
                voltage: ['LV'], 
                protections: ['Short Circuit'], 
                breakingCapacity: { LV: { min: 100, max: 300 } }, // kA
                discrimination: 'Excellent', selectivity: 'Excellent', 
                standards: 'IEC 60269-4', 
                notes: 'Ultra-fast acting, specifically for protecting sensitive power electronic devices (e.g., rectifiers, inverters, UPS systems) from short-circuit damage.' 
            },
            'Fuse-MV': {
                name: 'Medium Voltage Fuse',
                type: 'Fuse',
                minI: 1, maxI: 200,
                voltage: ['MV'],
                protections: ['Short Circuit', 'Overload'],
                breakingCapacity: { MV: { min: 20, max: 80 } }, // kA
                discrimination: 'Good', selectivity: 'Good',
                standards: 'IEC 60282-1',
                notes: 'Used in medium voltage networks for protection of transformers, capacitor banks, and feeder lines. Provides reliable protection in substations.'
            },
            
            // Circuit Breakers (IEC Standards)
            'MCB-B': { 
                name: 'Miniature Circuit Breaker (MCB) Type B', 
                type: 'Circuit Breaker', 
                minI: 0.5, maxI: 125, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Fire Protection'], 
                tripCurve: 'B (3-5 In)', 
                breakingCapacity: { LV: { min: 3, max: 10 } }, // kA
                discrimination: 'Limited', selectivity: 'Limited', 
                standards: 'IEC 60898-1', 
                notes: 'Suitable for resistive and lighting loads with no or very small inrush currents. Common in residential and light commercial installations.' 
            },
            'MCB-C': { 
                name: 'Miniature Circuit Breaker (MCB) Type C', 
                type: 'Circuit Breaker', 
                minI: 0.5, maxI: 125, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Fire Protection'], 
                tripCurve: 'C (5-10 In)', 
                breakingCapacity: { LV: { min: 6, max: 25 } }, // kA
                discrimination: 'Limited', selectivity: 'Limited', 
                standards: 'IEC 60898-1', 
                notes: 'General purpose for resistive and inductive loads (e.g., motors, transformers, fluorescent lighting) with moderate inrush currents. Most commonly used MCB type.' 
            },
            'MCB-D': { 
                name: 'Miniature Circuit Breaker (MCB) Type D', 
                type: 'Circuit Breaker', 
                minI: 0.5, maxI: 125, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Fire Protection'], 
                tripCurve: 'D (10-20 In)', 
                breakingCapacity: { LV: { min: 10, max: 25 } }, // kA
                discrimination: 'Limited', selectivity: 'Limited', 
                standards: 'IEC 60898-1', 
                notes: 'Designed for highly inductive loads with very high inrush currents, such as X-ray machines, large motors, and transformers. Provides delayed tripping for motor starting.' 
            },
            'MCB-K': { 
                name: 'Miniature Circuit Breaker (MCB) Type K', 
                type: 'Circuit Breaker', 
                minI: 0.5, maxI: 63, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Fire Protection'], 
                tripCurve: 'K (8-12 In)', 
                breakingCapacity: { LV: { min: 6, max: 10 } }, // kA
                discrimination: 'Limited', selectivity: 'Limited', 
                standards: 'IEC 60898-1', 
                notes: 'Similar to Type D but with a narrower tripping range, suitable for specific motor protection applications where precise coordination is needed.' 
            },
            'MCB-Z': { 
                name: 'Miniature Circuit Breaker (MCB) Type Z', 
                type: 'Circuit Breaker', 
                minI: 0.5, maxI: 63, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Fire Protection'], 
                tripCurve: 'Z (2-3 In)', 
                breakingCapacity: { LV: { min: 6, max: 10 } }, // kA
                discrimination: 'Limited', selectivity: 'Limited', 
                standards: 'IEC 60898-1', 
                notes: 'For sensitive electronic loads with very low inrush currents. Provides very fast response to short circuits to protect delicate equipment.' 
            },
            'MCCB': { 
                name: 'Molded Case Circuit Breaker (MCCB)', 
                type: 'Circuit Breaker', 
                minI: 16, maxI: 3200, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Fire Protection', 'Earth Fault'], // Earth fault is often an add-on module
                breakingCapacity: { LV: { min: 10, max: 150 } }, // kA
                discrimination: 'Good', selectivity: 'Good', 
                standards: 'IEC 60947-2', 
                notes: 'Versatile breaker for commercial and industrial applications. Offers adjustable trip settings for overload and short-circuit, allowing for better coordination.' 
            },
            'ACB': { 
                name: 'Air Circuit Breaker (ACB)', 
                type: 'Circuit Breaker', 
                minI: 400, maxI: 6300, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Earth Fault', 'Fire Protection'], 
                breakingCapacity: { LV: { min: 40, max: 150 } }, // kA
                discrimination: 'Excellent', selectivity: 'Excellent', 
                standards: 'IEC 60947-2', 
                notes: 'Used in main distribution boards and large industrial applications for high current ratings and fault levels. Offers advanced protection features and high reliability.' 
            },
            'VCB': { 
                name: 'Vacuum Circuit Breaker (VCB)', 
                type: 'Circuit Breaker', 
                minI: 100, maxI: 4000, 
                voltage: ['MV', 'HV'], 
                protections: ['Short Circuit', 'Overload', 'Earth Fault'], 
                breakingCapacity: { MV: { min: 20, max: 63 }, HV: { min: 25, max: 80 } }, // kA
                discrimination: 'Excellent', selectivity: 'Excellent', 
                standards: 'IEC 62271-100', 
                notes: 'Primary switching and protection device in medium voltage systems. Utilizes vacuum interrupters for efficient and environmentally friendly arc quenching. Essential for industrial and utility substations.' 
            },
            'SF6-CB': {
                name: 'SF6 Circuit Breaker',
                type: 'Circuit Breaker',
                minI: 400, maxI: 3150,
                voltage: ['MV', 'HV'],
                protections: ['Short Circuit', 'Overload', 'Earth Fault'],
                breakingCapacity: { MV: { min: 25, max: 50 }, HV: { min: 31.5, max: 63 } }, // kA
                discrimination: 'Excellent', selectivity: 'Excellent',
                standards: 'IEC 62271-100',
                notes: 'Used in medium and high voltage substations. SF6 gas provides excellent insulation and arc quenching properties. While effective, its use is being phased out in some regions due to environmental concerns.'
            },
            
            // Residual Current Devices (RCDs)
            'RCCB-AC': { 
                name: 'Residual Current Circuit Breaker (RCCB) Type AC', 
                type: 'RCD', 
                minI: 16, maxI: 125, 
                voltage: ['LV'], 
                protections: ['Earth Leakage', 'Fire Protection'], 
                earthingSystems: ['TT', 'TN-S'], 
                standards: 'IEC 61008-1', 
                notes: 'Detects sinusoidal AC residual currents. Most common type for general purpose loads in residential and commercial buildings.' 
            },
            'RCCB-A': { 
                name: 'Residual Current Circuit Breaker (RCCB) Type A', 
                type: 'RCD', 
                minI: 16, maxI: 125, 
                voltage: ['LV'], 
                protections: ['Earth Leakage', 'Fire Protection'], 
                earthingSystems: ['TT', 'TN-S'],
                standards: 'IEC 61008-1', 
                notes: 'Detects sinusoidal AC and pulsating DC residual currents. Recommended for circuits supplying equipment with electronic components that might produce pulsating DC faults (e.g., computers, washing machines, dimmers).' 
            },
            'RCCB-B': { 
                name: 'Residual Current Circuit Breaker (RCCB) Type B', 
                type: 'RCD', 
                minI: 25, maxI: 125, 
                voltage: ['LV'], 
                protections: ['Earth Leakage', 'Fire Protection'], 
                earthingSystems: ['TT', 'TN-S', 'IT'],
                standards: 'IEC 61008-1', 
                notes: 'Detects AC, pulsating DC, and smooth DC residual currents. Essential for applications with three-phase rectifiers or variable speed drives, EV charging stations, and medical equipment where smooth DC leakage currents can occur.' 
            },
            'RCCB-F': { 
                name: 'Residual Current Circuit Breaker (RCCB) Type F', 
                type: 'RCD', 
                minI: 16, maxI: 125, 
                voltage: ['LV'], 
                protections: ['Earth Leakage', 'Fire Protection'], 
                earthingSystems: ['TT', 'TN-S'],
                standards: 'IEC 61008-1', 
                notes: 'Detects AC, pulsating DC, and composite residual currents up to 1kHz. Designed for circuits with single-phase variable speed drives, heat pumps, and air conditioning units where higher frequency leakage currents may be present.' 
            },
            'RCBO': { 
                name: 'Residual Current Breaker with Overload (RCBO)', 
                type: 'RCD/CB Combined', 
                minI: 6, maxI: 63, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Earth Leakage', 'Fire Protection'], 
                earthingSystems: ['TT', 'TN-S'], // Type AC/A/B/F variants exist, common for single circuit protection
                breakingCapacity: { LV: { min: 6, max: 10 } }, // kA
                standards: 'IEC 61009-1', 
                notes: 'Combines the functions of an MCB (overcurrent and short-circuit protection) and an RCCB (earth leakage protection) in a single compact device. Ideal for comprehensive protection of individual circuits.' 
            },
            'ELCB': { 
                name: 'Earth Leakage Circuit Breaker (ELCB)', 
                type: 'RCD (Voltage)', 
                minI: 16, maxI: 100, 
                voltage: ['LV'], 
                protections: ['Earth Leakage'], 
                earthingSystems: ['TT'], 
                standards: 'BS 4293 (older)', 
                notes: 'An older type of earth leakage protection that operates based on voltage difference. Less common now; current-operated RCCBs are generally preferred for superior protection and wider applicability.' 
            },

            // Other Protective Devices
            'SFU': { 
                name: 'Switch Fuse Unit (SFU)', 
                type: 'Combined', 
                minI: 32, maxI: 800, 
                voltage: ['LV'], 
                protections: ['Short Circuit', 'Overload', 'Isolation', 'Fire Protection'], 
                breakingCapacity: { LV: { min: 50, max: 100 } }, // kA (depends on fuse)
                discrimination: 'Good', selectivity: 'Good', 
                standards: 'IEC 60947-3', 
                notes: 'Combines a manual switch for isolation and fuses for overcurrent and short-circuit protection. Robust and reliable for industrial power distribution and motor feeders.' 
            },
            'Isolator': { 
                name: 'Isolator/Disconnect Switch', 
                type: 'Switch', 
                minI: 16, maxI: 5000, 
                voltage: ['LV', 'MV', 'HV'], 
                protections: ['Isolation'], 
                standards: 'IEC 60947-3', 
                notes: 'Designed for safe isolation of electrical circuits for maintenance or repair. It has no breaking capacity for fault currents and must only be operated off-load or in conjunction with upstream protection.' 
            },
            'Protection-Relay': { 
                name: 'Protection Relay (with CB)', 
                type: 'Relay', 
                minI: 1, maxI: 10000, 
                voltage: ['LV', 'MV', 'HV'], 
                protections: ['Short Circuit', 'Overload', 'Earth Leakage', 'Arc Flash', 'Under/Over Voltage', 'Frequency', 'Directional', 'Differential', 'Fire Protection'], 
                standards: 'IEC 60255', 
                notes: 'Highly configurable digital or numerical protection device that senses fault conditions and sends a trip signal to an associated circuit breaker (e.g., VCB, ACB). Essential for complex industrial systems and utility grids requiring precise and flexible protection schemes.' 
            },
            'SPD': { 
                name: 'Surge Protection Device (SPD)', 
                type: 'Surge Protector', 
                minI: 0, maxI: 10000, // Rated for surge current, not continuous load current
                voltage: ['LV', 'MV'], 
                protections: ['Surge/Lightning'], 
                standards: 'IEC 61643-11, IEC 61643-21', 
                notes: 'Protects electrical equipment from transient overvoltages caused by lightning strikes or switching operations. Installed in parallel with the main power supply or at sub-distribution points. Categorized by Type (1, 2, 3) based on installation location.' 
            },
            'AFDD': {
                name: 'Arc Fault Detection Device (AFDD)',
                type: 'Arc Fault Detector',
                minI: 6, maxI: 40,
                voltage: ['LV'],
                protections: ['Arc Fault', 'Fire Protection'],
                standards: 'IEC 62606',
                notes: 'Detects dangerous electrical arc faults (series and parallel) that traditional circuit breakers cannot, preventing electrical fires. Increasingly mandated in residential and public buildings for enhanced safety. Often combined with an MCB or RCBO.'
            }
        };

        const protectionTypes = [
            'Short Circuit', 'Overload', 'Earth Leakage', 'Arc Fault', 
            'Surge/Lightning', 'Isolation', 'Under/Over Voltage', 'Frequency', 
            'Directional', 'Differential', 'Fire Protection'
        ];
        const environments = ['Indoor', 'Outdoor', 'Wet', 'Dusty', 'Corrosive', 'Explosive', 'High Temperature', 'Low Temperature'];
        let lastInputs = null; // For PDF
        let lastRecommendations = null; // For PDF

        // --- UI LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            // Theme Toggle
            const themeSwitch = document.getElementById('theme-switch');
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                }
            });

            // Populate Checkboxes
            const protectionContainer = document.getElementById('protection-requirements');
            protectionTypes.forEach(p => {
                protectionContainer.innerHTML += `
                    <label><input type="checkbox" value="${p}" class="protection-checkbox">${p}</label>
                `;
            });

            const environmentContainer = document.getElementById('environmental-conditions');
            environments.forEach(e => {
                environmentContainer.innerHTML += `
                    <label><input type="checkbox" value="${e}" class="environment-checkbox">${e}</label>
                `;
            });
            
            // Add Event Listeners
            document.getElementById('get-recommendation').addEventListener('click', getRecommendation);
            document.getElementById('reset-btn').addEventListener('click', resetForm);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function resetForm() {
            document.getElementById('protection-selector-form').reset();
            // Manually uncheck all dynamic checkboxes
            document.querySelectorAll('.protection-checkbox, .environment-checkbox').forEach(cb => cb.checked = false);
            
            // Reset default values
            document.getElementById('current-rating').value = "16";
            document.getElementById('fault-level').value = "6";
            
            // Hide all output sections
            document.getElementById('steps-container').classList.remove('active');
            document.getElementById('steps-container').innerHTML = ''; // Clear steps
            document.getElementById('pdf-btn').style.display = 'none';
            
            lastInputs = null;
            lastRecommendations = null;
            
            showMessage('Form reset', 'success');
        }

        // --- CORE LOGIC ---
        function getRecommendation() {
            // 1. Gather Inputs
            const inputs = {
                loadType: document.getElementById('load-type').value,
                applicationType: document.getElementById('application-type').value,
                phaseType: document.getElementById('phase-type').value,
                voltageLevel: document.getElementById('voltage-level').value.split(' ')[0], // e.g., 'LV'
                currentRating: parseFloat(document.getElementById('current-rating').value),
                faultLevel: parseFloat(document.getElementById('fault-level').value), // kA
                earthingSystem: document.getElementById('earthing-system').value,
                protections: Array.from(document.querySelectorAll('#protection-requirements input:checked')).map(el => el.value),
                environments: Array.from(document.querySelectorAll('#environmental-conditions input:checked')).map(el => el.value)
            };
            lastInputs = inputs; // Save for PDF

            // 2. Input Validation
            if (isNaN(inputs.currentRating) || inputs.currentRating <= 0) {
                showMessage('Please enter a valid positive current rating.', 'error');
                return;
            }
            if (isNaN(inputs.faultLevel) || inputs.faultLevel <= 0) {
                showMessage('Please enter a valid positive prospective fault current (kA).', 'error');
                return;
            }
            if (inputs.protections.length === 0) {
                showMessage('Please select at least one protection requirement.', 'error');
                return;
            }

            // 3. Decision Engine
            let recommendations = [];
            let compositeRecommendations = []; 

            for (const key in devices) {
                const device = devices[key];
                let score = 0;
                let reasons = [];
                let potentialIssues = [];

                // Rule 1: Voltage compatibility
                if (!device.voltage.includes(inputs.voltageLevel)) {
                    continue; 
                }
                reasons.push(`Voltage compatible (${inputs.voltageLevel}).`);

                // Rule 2: Current rating range
                if (inputs.currentRating >= device.minI && inputs.currentRating <= device.maxI) {
                    score += 2;
                    reasons.push(`Current rating (${inputs.currentRating}A) is within typical range (${device.minI}A - ${device.maxI}A).`);
                } else {
                    potentialIssues.push(`Current rating (${inputs.currentRating}A) is outside typical range (${device.minI}-${device.maxI}A).`);
                    score -= 5; 
                }

                // Rule 3: Breaking Capacity
                const requiredBreakingCapacity = inputs.faultLevel;
                if (device.type === 'Circuit Breaker' || device.type === 'Fuse' || device.type === 'Combined' || device.type === 'RCD/CB Combined') {
                    const deviceBreakingCapacity = device.breakingCapacity ? device.breakingCapacity[inputs.voltageLevel]?.max : 0;

                    if (deviceBreakingCapacity >= requiredBreakingCapacity) {
                        score += 3;
                        reasons.push(`Breaking capacity (${deviceBreakingCapacity}kA) meets/exceeds fault level (${requiredBreakingCapacity}kA).`);
                    } else {
                        potentialIssues.push(`Breaking capacity (${deviceBreakingCapacity || 'N/A'}kA) is INSUFFICIENT for fault level (${requiredBreakingCapacity}kA).`);
                        score -= 10; 
                    }
                } else if (device.type !== 'Switch') {
                     reasons.push(`Must be backed up by an overcurrent device (Fuse/CB) rated for at least ${requiredBreakingCapacity}kA.`);
                }

                // Rule 4: Protection requirements
                let missingProtections = inputs.protections.filter(p => !device.protections.includes(p));
                let providedProtections = inputs.protections.filter(p => device.protections.includes(p));

                if (providedProtections.length === inputs.protections.length) {
                    score += 10; 
                    reasons.push(`Provides all required protections: ${providedProtections.join(', ')}.`);
                } else if (providedProtections.length > 0) {
                    score += providedProtections.length * 2; 
                    potentialIssues.push(`Does not provide all required protections. Missing: ${missingProtections.join(', ')}.`);
                } else {
                    continue; // Skip if no required protections are met
                }

                // Rule 5: Load Type
                if (device.type === 'Circuit Breaker' && device.tripCurve) {
                    let loadMatch = false;
                    if (inputs.loadType === 'Resistive' && (device.tripCurve.includes('B') || device.tripCurve.includes('C'))) loadMatch = true;
                    else if ((inputs.loadType === 'Inductive' || inputs.loadType === 'Mixed') && device.tripCurve.includes('C')) loadMatch = true;
                    else if (inputs.loadType === 'Motor' && (device.tripCurve.includes('C') || device.tripCurve.includes('D') || device.tripCurve.includes('K'))) loadMatch = true;
                    else if (inputs.loadType === 'Capacitive' && device.tripCurve.includes('C')) loadMatch = true;
                    else if (inputs.loadType === 'Sensitive Electronics' && device.tripCurve.includes('Z')) loadMatch = true;

                    if (loadMatch) {
                        score += 2;
                        reasons.push(`Trip curve (${device.tripCurve}) is well-suited for ${inputs.loadType} loads.`);
                    } else {
                        potentialIssues.push(`Trip curve (${device.tripCurve}) may not be ideal for ${inputs.loadType} loads.`);
                        score -= 1; 
                    }
                }
                
                // Rule 6: Application Type
                if (inputs.applicationType === 'Residential' && (key.includes('MCB') || key.includes('RCBO') || key.includes('RCCB') || key.includes('AFDD'))) score += 3;
                if (inputs.applicationType === 'Commercial' && (key.includes('MCCB') || key.includes('ACB') || key.includes('RCBO') || key.includes('SPD'))) score += 3;
                if (inputs.applicationType === 'Industrial' && (key.includes('MCCB') || key.includes('ACB') || key.includes('VCB') || key.includes('SFU') || key.includes('Protection-Relay') || key.includes('HRC'))) score += 4;
                if (inputs.applicationType === 'Medical' && (key.includes('RCCB-B') || key.includes('IT') || key.includes('Isolator') || key.includes('Protection-Relay'))) score += 5;
                if (inputs.applicationType === 'Data Center' && (key.includes('MCCB') || key.includes('ACB') || key.includes('Semiconductor') || key.includes('SPD') || key.includes('Protection-Relay'))) score += 4;

                // Rule 7: Earthing System
                if (device.type && device.type.includes('RCD') && device.earthingSystems) {
                    if (!device.earthingSystems.includes(inputs.earthingSystem)) {
                        potentialIssues.push(`Device is not typically suitable for ${inputs.earthingSystem} earthing system.`);
                        score -= 3;
                    }
                }

                recommendations.push({ id: key, device, score, reasons, potentialIssues });
            }

            // Sort by score
            recommendations.sort((a, b) => b.score - a.score);

            // Filter out devices with critical failures (e.g., insufficient breaking capacity)
            let viableRecommendations = recommendations.filter(rec => !rec.potentialIssues.some(issue => issue.includes('INSUFFICIENT')));

            // Handle composite recommendations
            if (viableRecommendations.length === 0 || viableRecommendations[0].potentialIssues.length > 0) {
                 // Try to find a combination
                if (inputs.protections.includes('Short Circuit') && inputs.protections.includes('Overload') && inputs.protections.includes('Earth Leakage') && inputs.voltageLevel === 'LV') {
                    const cbCandidates = recommendations.filter(d => (d.id.includes('MCB') || d.id.includes('MCCB')) && d.device.protections.includes('Short Circuit') && d.device.protections.includes('Overload') && !d.potentialIssues.some(issue => issue.includes('INSUFFICIENT')));
                    const rcdCandidates = recommendations.filter(d => d.id.includes('RCCB') && d.device.protections.includes('Earth Leakage') && d.device.earthingSystems.includes(inputs.earthingSystem));
                    
                    if (cbCandidates.length > 0 && rcdCandidates.length > 0) {
                        compositeRecommendations.push({
                            name: `${cbCandidates[0].device.name} + ${rcdCandidates[0].device.name}`,
                            devices: [cbCandidates[0], rcdCandidates[0]],
                            score: cbCandidates[0].score + rcdCandidates[0].score,
                            notes: `This is a common and effective solution. The ${cbCandidates[0].device.name} provides Overcurrent/Short Circuit protection, and the ${rcdCandidates[0].device.name} provides Earth Leakage protection.`
                        });
                    }
                }
                 // Add more composite scenarios here... (e.g., MCB + AFDD, CB + Relay)
            }
            
            lastRecommendations = { viable: viableRecommendations, composite: compositeRecommendations }; // Save for PDF
            
            // 4. Display Results
            displayResults(viableRecommendations, compositeRecommendations, inputs);
        }

        function displayResults(recommendations, compositeRecommendations, inputs) {
            const stepsContainer = document.getElementById('steps-container');
            stepsContainer.innerHTML = ''; // Clear previous results

            // Step 1: Input Summary
            stepsContainer.innerHTML += `
                <div class="step-card">
                    <h4><span class="number">1</span>Input Parameter Analysis</h4>
                    <div class="step-content">
                        <div>
                            <p>Your requirements have been analyzed:</p>
                            <ul>
                                <li><strong>Load:</strong> ${inputs.loadType} Load (${inputs.currentRating}A)</li>
                                <li><strong>System:</strong> ${inputs.voltageLevel} ${inputs.phaseType}</li>
                                <li><strong>Fault Level:</strong> ${inputs.faultLevel} kA</li>
                                <li><strong>Application:</strong> ${inputs.applicationType}</li>
                                <li><strong>Protections:</strong> ${inputs.protections.join(', ')}</li>
                            </ul>
                        </div>
                        <div>
                            <p><strong>Analysis:</strong></p>
                            <p>The system requires a device rated for <strong>${inputs.currentRating}A</strong> with a breaking capacity of at least <strong>${inputs.faultLevel}kA</strong>. The combination of <strong>${inputs.loadType} load</strong> and <strong>${inputs.applicationType} application</strong> requires careful selection for safety and reliability.</p>
                        </div>
                    </div>
                </div>
            `;
            
            let primaryHTML = '';
            let alternativeHTML = '';

            // Check for composite
            if (compositeRecommendations.length > 0 && (recommendations.length === 0 || (recommendations[0].potentialIssues.length > 0 && !recommendations[0].id.includes('RCBO')) )) {
                const bestComposite = compositeRecommendations[0];
                primaryHTML = createRecommendationCard(bestComposite.name, bestComposite.devices[0].device, bestComposite.devices[0].reasons, bestComposite.devices[0].potentialIssues, 'composite', inputs) +
                              createRecommendationCard(bestComposite.devices[1].device.name, bestComposite.devices[1].device, bestComposite.devices[1].reasons, bestComposite.devices[1].potentialIssues, 'composite', inputs);
                
                // Add alternatives
                recommendations.slice(0, 3).forEach(rec => {
                    alternativeHTML += createRecommendationCard(rec.device.name, rec.device, rec.reasons, rec.potentialIssues, 'alternative', inputs);
                });

            } else if (recommendations.length > 0) {
                // Primary single device
                const bestRec = recommendations[0];
                primaryHTML = createRecommendationCard(bestRec.device.name, bestRec.device, bestRec.reasons, bestRec.potentialIssues, 'primary', inputs);
                
                // Alternatives
                recommendations.slice(1, 4).forEach(rec => {
                    alternativeHTML += createRecommendationCard(rec.device.name, rec.device, rec.reasons, rec.potentialIssues, 'alternative', inputs);
                });
            } else {
                // No solution
                 primaryHTML = `
                    <div class="recommendation-card" style="border-left-color: var(--danger);">
                        <h5 style="color: var(--danger);">No Suitable Device Found</h5>
                        <p>No single device or common combination meets all specified criteria. This could be due to conflicting requirements (e.g., MV voltage with Earth Leakage protection, which requires a relay) or an insufficient breaking capacity for all available devices. Please review your inputs or consult with a qualified electrical engineer for a custom design.</p>
                    </div>
                 `;
            }

            // Step 2: Primary Recommendation(s)
            stepsContainer.innerHTML += `
                <div class="step-card">
                    <h4><span class="number">2</span>Primary Recommendation(s)</h4>
                    ${primaryHTML}
                </div>
            `;

            // Step 3: Alternative Options
            if(alternativeHTML.length > 0) {
                stepsContainer.innerHTML += `
                    <div class="step-card">
                        <h4><span class="number">3</span>Alternative Options</h4>
                        ${alternativeHTML}
                    </div>
                `;
            }

            stepsContainer.classList.add('active'); 
            document.getElementById('pdf-btn').style.display = 'inline-flex';
            showMessage('Recommendation complete!', 'success');
            stepsContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        function createRecommendationCard(title, device, reasons, potentialIssues, type, inputs) {
             const environmentalNotes = getEnvironmentalNotes(inputs.environments);
             return `
                <div class="recommendation-card ${type}">
                    <h5>${title}</h5>
                    <p><strong>Justification:</strong></p>
                    <ul>
                        ${reasons.map(r => `<li>${r}</li>`).join('')}
                        ${environmentalNotes.map(n => `<li>${n}</li>`).join('')}
                    </ul>
                    ${potentialIssues.length > 0 ? `<p class="potential-issues"><strong>Potential Issues:</strong> ${potentialIssues.join(', ')}</p>` : ''}
                    <div class="spec-grid">
                        <div><span><strong>Type:</strong> ${device.type}</span></div>
                        <div><span><strong>Voltage:</strong> ${device.voltage.join(', ')}</span></div>
                        ${device.tripCurve ? `<div><span><strong>Trip Curve:</strong> ${device.tripCurve}</span></div>` : ''}
                        ${device.breakingCapacity ? `<div><span><strong>Breaking Capacity (${inputs.voltageLevel}):</strong> ${device.breakingCapacity[inputs.voltageLevel]?.max || 'N/A'} kA</span></div>` : ''}
                        <div><span><strong>Std:</strong> ${device.standards}</span></div>
                    </div>
                </div>
             `;
        }

        function getEnvironmentalNotes(environments) {
            let notes = [];
            if (environments.includes('Outdoor') || environments.includes('Wet') || environments.includes('Dusty')) {
                notes.push('Requires an appropriate IP-rated enclosure (e.g., IP65+).');
            }
            if (environments.includes('Explosive')) {
                notes.push('Requires an ATEX/IECEx certified explosion-proof enclosure.');
            }
            if (environments.includes('Corrosive')) {
                notes.push('Requires corrosion-resistant materials (e.g., 316L Stainless Steel).');
            }
            if (environments.includes('High Temperature')) {
                notes.push('Device must be rated for high ambient temperatures and may require derating.');
            }
            if (environments.includes('Low Temperature')) {
                notes.push('Device must be rated for low ambient temperatures.');
            }
            if (environments.length === 0 || (environments.length === 1 && environments.includes('Indoor'))) {
                 notes.push('Standard indoor enclosure (e.g., IP4X) is suitable.');
            }
            return notes;
        }
        
        // Add PDF Generation
        function generatePDF() {
            if (!lastInputs || !lastRecommendations) {
                showMessage('Please run a calculation first.', 'error');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                let y = 15;
                const { inputs, results } = { inputs: lastInputs, results: lastRecommendations };

                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(16);
                pdf.text('Protective Device Selector Report', 105, y, { align: 'center' });
                y += 8;
                pdf.setFont('helvetica', 'normal');
                pdf.setFontSize(9);
                pdf.text(`Generated by Design Calculators | ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
                y += 10;
                
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(12);
                pdf.text('Input Parameters', 14, y);
                y += 2;

                const inputRows = [
                    ["Load Type", inputs.loadType],
                    ["Application Type", inputs.applicationType],
                    ["Phase Type", inputs.phaseType],
                    ["Voltage Level", inputs.voltageLevel],
                    ["Current Rating", `${inputs.currentRating} A`],
                    ["Prospective Fault Current", `${inputspre.faultLevel} kA`],
                    ["Earthing System", inputs.earthingSystem],
                    ["Required Protections", inputs.protections.join(', ')],
                    ["Environment", inputs.environments.join(', ') || 'Indoor (Standard)']
                ];
                
                pdf.autoTable({
                    startY: y,
                    head: [['Parameter', 'Value']],
                    body: inputRows,
                    margin: { left: 14, right: 14 },
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 138] },
                });
                y = pdf.autoTable.previous.finalY + 10;

                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(12);
                pdf.text('Recommendations', 14, y);
                y += 2;

                const resultRows = [];
                // Add composite
                results.composite.forEach(rec => {
                    resultRows.push(['Composite', rec.name]);
                    resultRows.push(['', rec.devices[0].device.name + ': ' + rec.devices[0].device.notes]);
                    resultRows.push(['', rec.devices[1].device.name + ': ' + rec.devices[1].device.notes]);
                });
                // Add primary
                if(results.viable.length > 0) {
                     resultRows.push(['Primary', results.viable[0].device.name]);
                     resultRows.push(['', 'Type: ' + results.viable[0].device.type + ' | Breaking Capacity: ' + (results.viable[0].device.breakingCapacity ? (results.viable[0].device.breakingCapacity[inputs.voltageLevel]?.max || 'N/A') + ' kA' : 'N/A')]);
                }
                // Add alternatives
                 results.viable.slice(1, 3).forEach(rec => {
                     resultRows.push(['Alternative', rec.device.name]);
                     resultRows.push(['', 'Type: ' + rec.device.type + ' | Breaking Capacity: ' + (rec.device.breakingCapacity ? (rec.device.breakingCapacity[inputs.voltageLevel]?.max || 'N/A') + ' kA' : 'N/A')]);
                 });
                
                if (resultRows.length === 0) {
                    resultRows.push(['No suitable device found', 'Please review inputs or consult a professional.']);
                }

                pdf.autoTable({
                    startY: y,
                    head: [['Recommendation Type', 'Device / Details']],
                    body: resultRows,
                    margin: { left: 14, right: 14 },
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 138] },
                    didParseCell: function (data) {
                        const cellText = data.cell.text[0];
                        if (cellText === 'Primary') {
                             data.cell.styles.textColor = [16, 185, 129]; // Green
                             data.cell.styles.fontStyle = 'bold';
                        }
                        if(cellText === 'Composite') {
                             data.cell.styles.textColor = [37, 99, 235]; // Blue
                             data.cell.styles.fontStyle = 'bold';
                        }
                        if(cellText === 'Alternative') {
                             data.cell.styles.textColor = [245, 158, 11]; // Orange
                             data.cell.styles.fontStyle = 'bold';
                        }
                    }
                });
                y = pdf.autoTable.previous.finalY + 15;

                // Add footer
                pdf.setFont('helvetica', 'normal');
                pdf.setFontSize(10);
                pdf.setTextColor(40, 40, 40);
                pdf.text('For more calculators and information, visit http://designcalculators.co.in', 105, y, { align: 'center' });
                y += 5;
                pdf.setFontSize(8);
                pdf.setTextColor(100, 100, 100);
                pdf.text('This report is for guidance only. All selections must be verified by a qualified engineer.', 105, y, { align: 'center' });

                pdf.save('Protective-Device-Report.pdf');
                showMessage('PDF downloaded successfully');

            } catch (e) {
                showMessage(`Error generating PDF: ${e.message}`, 'error');
            }
        }
        
        // Re-render MathJax on load if needed
        if (window.MathJax && window.MathJax.typeset) {
            window.MathJax.typeset();
        }

    </script>
</body>
</html>


