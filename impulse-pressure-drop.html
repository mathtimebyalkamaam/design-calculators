<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googlesyndication.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pressure Drop Calculator (Impulse Tubing) - Design Calculators - Instrumentation</title>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for Formulas (ADDED FROM CORRECT FILE) -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' },
            options: {
                processHtmlClass: 'math-content', // Process elements with this class
                ignoreHtmlClass: 'no-mathjax'     // Ignore elements with this class
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon (FROM ORIGINAL FILE) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* Basic CSS Variables for a consistent theme (ORIGINAL GREEN THEME) */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #3b8e3e);
            --reset-button-bg: #FFC107; /* Yellow for reset */
            --reset-button-hover-bg: #E0A800; /* Darker yellow */
            --clear-button-bg: #007bff; /* Blue for clear */
            --clear-button-hover-bg: #0056b3; /* Darker blue */
            --pressure-color: #e74c3c; /* Red for pressure drop */
            --pressure-color-dark: #c0392b; /* Darker red for pressure drop */

            /* NEW VARS FOR BLUE HEADER/FOOTER (FROM CORRECT FILE) */
            --header-primary: #1E3A8A;
            --header-secondary: #2563EB;
            --header-accent: #F59E0B;
            --header-grad: linear-gradient(135deg, var(--header-primary), var(--header-secondary));
            --footer-grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --footer-bg-dark: #0F172A;
        }

        /* Dark Mode Variables (ORIGINAL) */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #446688;
            --button-gradient: linear-gradient(45deg, #3b8e3e, #4CAF50);
            --button-hover-gradient: linear-gradient(45deg, #4CAF50, #5cb85c);
            --reset-button-bg: #FFD700; /* Gold/Yellow for dark mode reset */
            --reset-button-hover-bg: #DAA520; /* Darker gold/yellow */
            --clear-button-bg: #17a2b8; /* Cyan for dark mode clear */
            --clear-button-hover-bg: #138496;
            --pressure-color: #ff7675; /* Lighter red for dark mode */
            --pressure-color-dark: #d63031; /* Darker red for dark mode */
            
            /* DARK MODE VARS FOR FOOTER */
            --footer-bg-dark: #020617;
        }

        /* General Body Styling (ORIGINAL) */
        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-color), #e0e0e0);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1280px; /* Increased max-width to match new header */
            margin: 0 auto;
            padding: 0 24px; /* Added padding to match new header */
        }

        /* --- NEW HEADER STYLES (FROM CORRECT FILE) --- */
        header {
            background: var(--header-grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--header-accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white; /* Ensure icons are white */
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--header-accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        /* --- END OF NEW HEADER STYLES --- */


        main {
            padding: 40px 0; /* Adjusted padding */
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px; /* Increased border radius */
            padding: 30px; /* Increased padding */
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            transition: transform 0.3s ease-in-out;
            border: 1px solid var(--border-color); /* Added border */
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color); /* Thicker border */
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 20px;
            font-family: 'Montserrat', sans-serif; /* Added font */
            font-size: 1.8rem; /* Added font size */
            display: flex; /* Added for icon */
            align-items: center; /* Added for icon */
            gap: 12px; /* Added for icon */
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
            font-size: 1.05rem; /* Increased font size */
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px; /* Adjusted padding */
            border-radius: 6px; /* Adjusted radius */
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.3s;
            width: fit-content; 
            font-weight: 600; /* Added font weight */
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
        }


        /* --- NEW FOOTER STYLES (FROM CORRECT FILE) --- */
        footer {
            background: var(--footer-grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        body.dark-mode footer {
             background: var(--footer-bg-dark);
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col li {
            margin-bottom: 8px; /* Added for spacing */
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--header-accent); /* Use header accent color */
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-decoration: none; /* Added */
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        /* --- END OF NEW FOOTER STYLES --- */


        /* Styles for Calculator Forms and Results (ORIGINAL, SLIGHTLY TWEAKED) */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 0; /* Removed padding, handled by section */
            margin-top: 20px;
        }
        
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 20px; /* Increased margin */
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
            font-family: 'Montserrat', sans-serif; /* Added font */
            font-size: 1.5rem; /* Added font size */
        }

        .form-group {
            margin-bottom: 15px; /* Default margin for form groups */
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px; /* Increased margin */
            font-weight: 600; /* Bolder label */
            color: var(--text-color); /* Darker text */
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px; /* Increased padding */
            border: 1px solid var(--border-color);
            border-radius: 6px; /* Softer radius */
            background-color: var(--card-bg); /* Use card-bg for input background */
            color: var(--text-color);
            box-sizing: border-box; /* Ensure padding doesn't increase width */
            transition: border-color 0.3s, box-shadow 0.3s;
            font-size: 1rem; /* Added font size */
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
            gap: 20px; /* Gap between grid items */
            margin-bottom: 0; /* Handled by form-group margin */
        }
        
        .calculate-btn, .reset-btn {
            color: white;
            border: none;
            padding: 14px 30px; /* Adjusted padding */
            border-radius: 25px; /* More rounded */
            cursor: pointer;
            font-size: 1.1rem; /* Slightly larger font */
            font-weight: 700; /* Bolder */
            margin-top: 25px; /* More space above button */
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto; /* Allow button to size based on content and padding */
            min-width: 220px; /* Ensure a minimum width for consistency */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .calculate-btn {
             background: var(--button-gradient);
        }
        
        .calculate-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02); /* Lift and slightly scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }

        .reset-btn {
            background-color: var(--reset-button-bg);
            margin-left: 15px; /* Space from calculate button */
            min-width: 150px;
        }

        .reset-btn:hover {
            background-color: var(--reset-button-hover-bg);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .clear-results-btn {
            background-color: var(--clear-button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .clear-results-btn:hover {
            background-color: var(--clear-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For animation */
            transform: translateY(20px); /* Initial state for animation */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            display: block; /* Added */
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
            font-family: 'Montserrat', sans-serif; /* Added */
            font-size: 1.5rem; /* Added */
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners apply to table content */
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); /* Added shadow */
        }
        
        .result-table th, .result-table td {
            padding: 14px; /* Adjusted padding */
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color); /* Highlight row on hover */
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            padding: 15px; /* Increased padding */
            border-left: 4px solid var(--primary-color);
            background-color: var(--hover-color);
            border-radius: 4px;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: color 0.3s;
        }

        .info-icon:hover {
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Adjusted width */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: flex; /* Use flex for centering text */
            align-items: center;
            justify-content: center;
            min-width: 250px; /* Ensure it's wide enough */
        }
        
        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* More space */
            font-size: 0.95em;
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px; /* More space */
            text-align: center;
            font-size: 1.2em;
            font-family: 'Montserrat', sans-serif; /* Added */
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif; /* A font suitable for mathematical formulas */
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 12px 10px; /* Increased padding */
            background-color: var(--hover-color);
            border-radius: 6px; /* More rounded */
            margin: 15px 0; /* More space */
            overflow-x: auto; /* Allow horizontal scrolling for long formulas */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace; /* Monospace for steps */
            background-color: var(--hover-color);
            padding: 8px 15px; /* Increased padding */
            border-radius: 4px; /* More rounded */
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-break: break-word; /* Break long words */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px; /* Increased margin */
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
        }

        /* Style for centering the button */
        .button-wrapper {
            display: flex;
            justify-content: center; /* Center the button horizontally */
            flex-wrap: wrap; /* Allow buttons to wrap on small screens */
            width: 100%; /* Ensure it takes full width to center effectively */
            padding-top: 20px; /* Add more spacing above the button */
        }

        /* Animation for input fields on focus */
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4); /* Green glow, slightly more pronounced */
            outline: none;
            /* Removed pulsing animation as it can be distracting */
        }

        /* Specific styles for Pressure Drop Calculator */
        .unit-system-selector, .density-input-selector, .flow-rate-type-selector, .roughness-selector, .viscosity-input-selector {
            margin-bottom: 20px;
            background-color: var(--hover-color);
            border-radius: 8px;
            padding: 15px; /* Increased padding */
            display: flex;
            align-items: center;
            justify-content: space-around;
            flex-wrap: wrap; /* Allow wrapping */
            gap: 15px; /* Added gap */
        }
        .unit-system-selector label, .density-input-selector label, .flow-rate-type-selector label, .roughness-selector label, .viscosity-input-selector label {
            font-weight: bold;
            color: var(--text-color);
            display: flex; /* Added */
            align-items: center; /* Added */
            cursor: pointer; /* Added */
        }
        .density-input-selector input[type="radio"], .flow-rate-type-selector input[type="radio"], .roughness-selector input[type="radio"], .viscosity-input-selector input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
            accent-color: var(--primary-color); /* Added */
        }

        #density-input-group, #specific-gravity-input-group, #volumetric-flow-group, #mass-flow-group, #roughness-material-group, #roughness-direct-group, #dynamic-viscosity-group, #kinematic-viscosity-group, #elevation-change-group {
            display: none; /* Hidden by default */
        }
        #density-input-group.active, #specific-gravity-input-group.active, #volumetric-flow-group.active, #mass-flow-group.active, #roughness-material-group.active, #roughness-direct-group.active, #dynamic-viscosity-group.active, #kinematic-viscosity-group.active, #elevation-change-group.active {
            display: block;
        }

        /* Pressure Drop Visualization */
        .pressure-drop-visualization-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--bg-color);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            flex-direction: column;
        }

        .pressure-bar-container {
            width: 80%;
            height: 30px;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            margin-bottom: 10px;
        }

        .pressure-bar {
            height: 100%;
            width: 0%; /* Initial width */
            background: linear-gradient(to right, var(--pressure-color), var(--pressure-color-dark));
            transition: width 1.5s ease-out; /* Smooth animation */
            border-radius: 5px;
        }

        .pressure-drop-label {
            font-weight: bold;
            color: var(--text-color);
            font-size: 1.1em;
        }
        
        /* --- NEW CSS FOR EDUCATIONAL SECTION --- */
        /* (Using original Green theme variables) */
        
        .education-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-top: 40px; /* Space above */
            border: 1px solid var(--border-color);
        }
        
        .education-section h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .education-section h3 {
            color: var(--secondary-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        
        .insight-card-row {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
             gap: 20px;
             margin-top: 20px;
        }
        
        .insight-card {
            background: linear-gradient(135deg, var(--card-bg), rgba(76, 175, 80, 0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 0; /* Handled by grid gap */
            border-left: 5px solid var(--primary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
            height: 100%; /* Make cards in a row same height */
        }
        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary-color);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i {
            font-size: 1.5rem;
            width: 30px;
            text-align: center;
        }
        .insight-card p {
            margin: 10px 0;
            line-height: 1.8;
        }
        .insight-card ol,
        .insight-card ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .insight-card li {
            margin-bottom: 10px;
        }
        
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.05), rgba(220,38,38,0.03));
            border-left: 5px solid var(--pressure-color);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 {
            color: var(--pressure-color);
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .formula-block {
            background: var(--bg-color);
            border-left: 3px solid var(--accent-color);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem; /* Larger for formulas */
            border-radius: 4px;
            font-family: 'Times New Roman', serif;
            overflow-x: auto;
            text-align: center;
        }
        
        .steps-explanation ol {
            list-style-type: decimal;
            padding-left: 25px;
        }
        .steps-explanation li {
             margin-bottom: 15px;
             line-height: 1.7;
        }
        .steps-explanation li strong {
            color: var(--secondary-color);
            font-size: 1.05em;
        }
        
        /* --- END OF NEW CSS --- */

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; padding-left: 0; }
            .form-row { grid-template-columns: 1fr; }
            .tool-container, .education-section { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .button-wrapper { flex-direction: column; align-items: center; }
            .reset-btn { margin-left: 0; }
            .insight-card-row { grid-template-columns: 1fr; }
        }
        
    </style>
</head>
<body class="math-content"> <!-- Added math-content class to body for MathJax -->
    
    <!-- NEW HEADER (FROM CORRECT FILE) -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
               
        <div class="tool-container">
            <h2><i class="fas fa-tachometer-alt"></i> Pressure Drop Calculator (Impulse Tubing)</h2>
            
            <div class="tool-description">
                <p>This tool calculates the pressure loss in impulse tubing due to fluid friction and fittings. Accurate pressure drop calculation is crucial for proper sizing of impulse lines, ensuring reliable operation of differential pressure transmitters and other instrumentation in various industrial applications worldwide.</p>
            </div>
        
            <div class="calculator-form">
                <form id="pressure-drop-form">
                    <!-- Unit System Selection -->
                    <div class="form-section unit-system-selector">
                        <label for="unit-system">Select Unit System:</label>
                        <select id="unit-system" required>
                            <option value="metric">Metric (m, Pa, kg/m³, Pa·s, m³/s)</option>
                            <option value="imperial">Imperial (ft, psi, lb/ft³, lb/(ft·s), ft³/s)</option>
                        </select>
                    </div>

                    <!-- Fluid Properties -->
                    <div class="form-section">
                        <h3>Fluid Properties</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fluid-temperature" id="label-fluid-temperature">Fluid Temperature <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-fluid-temperature">The operating temperature of the fluid. Important for accurate density and viscosity.</span></span></label>
                                <input type="number" id="fluid-temperature" step="0.1" value="25.0" required>
                            </div>
                            <div class="form-group">
                                <label for="local-gravity" id="label-local-gravity">Local Gravity (g) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-local-gravity">The local acceleration due to gravity at your location. Standard is 9.80665 m/s² or 32.174 ft/s².</span></span></label>
                                <input type="number" id="local-gravity" step="0.001" value="9.80665" required>
                            </div>
                        </div>
                        <!-- Fluid Density Input Method -->
                        <div class="density-input-selector">
                            <label>Fluid Density Input Method:</label>
                            <label>
                                <input type="radio" name="density-input-method" value="density" checked> Direct Density
                            </label>
                            <label>
                                <input type="radio" name="density-input-method" value="specific-gravity"> Specific Gravity (SG)
                            </label>
                        </div>
                        <div class="form-row">
                            <div class="form-group" id="density-input-group">
                                <label for="fluid-density" id="label-fluid-density-actual">Fluid Density (ρ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-fluid-density-actual">The density of the fluid at operating conditions.</span></span></label>
                                <input type="number" id="fluid-density" step="0.01" value="1000.0" required>
                            </div>
                            <div class="form-group" id="specific-gravity-input-group">
                                <label for="specific-gravity" id="label-specific-gravity">Specific Gravity (SG) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-specific-gravity">The ratio of the fluid's density to the density of a reference fluid (usually water at 4°C for liquids). This value should be at the operating temperature.</span></span></label>
                                <input type="number" id="specific-gravity" step="0.001" value="1.0" required>
                            </div>
                        </div>
                        <!-- Viscosity Input Method -->
                        <div class="viscosity-input-selector">
                            <label>Viscosity Input Method:</label>
                            <label>
                                <input type="radio" name="viscosity-input-method" value="dynamic" checked> Dynamic Viscosity
                            </label>
                            <label>
                                <input type="radio" name="viscosity-input-method" value="kinematic"> Kinematic Viscosity
                            </label>
                        </div>
                        <div class="form-row">
                            <div class="form-group" id="dynamic-viscosity-group">
                                <label for="dynamic-viscosity" id="label-dynamic-viscosity">Dynamic Viscosity (μ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-dynamic-viscosity">The dynamic viscosity of the fluid at operating conditions.</span></span></label>
                                <input type="number" id="dynamic-viscosity" step="0.000001" value="0.001" required>
                            </div>
                            <div class="form-group" id="kinematic-viscosity-group">
                                <label for="kinematic-viscosity" id="label-kinematic-viscosity">Kinematic Viscosity (ν) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-kinematic-viscosity">The kinematic viscosity of the fluid at operating conditions. (μ / ρ)</span></span></label>
                                <input type="number" id="kinematic-viscosity" step="0.000000001" value="0.000001" required>
                            </div>
                        </div>
                    </div>

                    <!-- Tubing Properties -->
                    <div class="form-section">
                        <h3>Tubing Properties</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="inner-diameter" id="label-inner-diameter">Inner Diameter (D) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-inner-diameter">The internal diameter of the impulse tubing.</span></span></label>
                                <input type="number" id="inner-diameter" step="0.001" value="0.006" required>
                            </div>
                            <div class="form-group">
                                <label for="tubing-length" id="label-tubing-length">Tubing Length (L) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-tubing-length">The total length of the straight impulse tubing.</span></span></label>
                                <input type="number" id="tubing-length" step="0.1" value="10.0" required>
                            </div>
                            <div class="form-group" id="elevation-change-group">
                                <label for="elevation-change" id="label-elevation-change">Elevation Change (Δh) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-elevation-change">The vertical change in height of the tubing from inlet to outlet. Positive for upward flow, negative for downward flow.</span></span></label>
                                <input type="number" id="elevation-change" step="0.01" value="0.0" required>
                            </div>
                        </div>
                        <!-- Roughness Input Method -->
                        <div class="roughness-selector">
                            <label>Tubing Roughness Input Method:</label>
                            <label>
                                <input type="radio" name="roughness-input-method" value="material" checked> By Material
                            </label>
                            <label>
                                <input type="radio" name="roughness-input-method" value="direct"> Direct Input
                            </label>
                        </div>
                        <div class="form-row">
                            <div class="form-group" id="roughness-material-group">
                                <label for="tubing-material">Tubing Material <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select common tubing materials to auto-fill absolute roughness.</span></span></label>
                                <select id="tubing-material">
                                    <!-- Options will be populated by JS -->
                                </select>
                            </div>
                            <div class="form-group" id="roughness-direct-group">
                                <label for="absolute-roughness" id="label-absolute-roughness">Absolute Roughness (ε) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-absolute-roughness">The absolute roughness of the inner surface of the tubing.</span></span></label>
                                <input type="number" id="absolute-roughness" step="0.0000001" value="0.0000015" required>
                            </div>
                        </div>
                    </div>

                    <!-- Flow Rate & Fittings -->
                    <div class="form-section">
                        <h3>Flow Rate & Fittings</h3>
                        <div class="flow-rate-type-selector">
                            <label>Flow Rate Input Method:</label>
                            <label>
                                <input type="radio" name="flow-rate-type" value="volumetric" checked> Volumetric Flow Rate
                            </label>
                            <label>
                                <input type="radio" name="flow-rate-type" value="mass"> Mass Flow Rate
                            </label>
                        </div>
                        <div class="form-row">
                            <div class="form-group" id="volumetric-flow-group">
                                <label for="volumetric-flow-rate" id="label-volumetric-flow-rate">Volumetric Flow Rate (Q) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-volumetric-flow-rate">The volume of fluid passing through the tubing per unit time.</span></span></label>
                                <input type="number" id="volumetric-flow-rate" step="0.0000001" value="0.000001" required>
                            </div>
                            <div class="form-group" id="mass-flow-group">
                                <label for="mass-flow-rate" id="label-mass-flow-rate">Mass Flow Rate (ṁ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-mass-flow-rate">The mass of fluid passing through the tubing per unit time.</span></span></label>
                                <input type="number" id="mass-flow-rate" step="0.000001" value="0.001" required>
                            </div>
                            <div class="form-group">
                                <label for="total-k-factor">Total K-Factor for Fittings (ΣK) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The sum of resistance coefficients (K-factors) for all fittings (elbows, valves, etc.) in the impulse line.</span></span></label>
                                <input type="number" id="total-k-factor" step="0.1" value="5.0" required>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-pressure-drop-btn" class="calculate-btn"><i class="fas fa-calculator"></i> Calculate Pressure Drop</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Pressure Drop Calculation Results</h3>
                <div class="pressure-drop-visualization-container">
                    <div class="pressure-bar-container">
                        <div class="pressure-bar" style="width: 0%;"></div>
                    </div>
                    <p class="pressure-drop-label">Pressure Drop: <span id="pressure-drop-display">0.00</span></p>
                    <p class="pressure-drop-label">Flow Regime: <span id="flow-regime-display">N/A</span></p>
                </div>
                <!-- Added math-content class for MathJax rendering -->
                <div id="calculation-details" class="math-content">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
                </div>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>

        <!-- NEW EDUCATIONAL SECTION -->
        <div class="education-section math-content">
            <h2><i class="fas fa-lightbulb"></i> Understanding Impulse Line Pressure Drop</h2>
            <p style="font-size: 1.05rem; line-height: 1.8;">Impulse lines are the vital "nerves" of a process plant. They are the small-diameter tubes that connect a process tap (on a pipe, tank, or vessel) to an instrument, such as a pressure or differential pressure (DP) transmitter. Their sole purpose is to transmit the *exact* process pressure to the instrument's sensor. However, any fluid movement (flow) within these lines, even if very small, will cause a pressure drop due to friction. Understanding and managing this pressure drop is not just a minor detail—it is fundamental to the accuracy, safety, and reliability of your process measurements.</p>

            <h3>Why is This Calculation So Important?</h3>
            <p>For a standard pressure gauge, a small pressure drop might not be critical. But for a Differential Pressure (DP) transmitter—used for measuring flow, level, and filter delta-P—it is the single most important factor. A DP transmitter works by measuring a tiny *difference* in pressure between its High Pressure (HP) and Low Pressure (LP) ports. If the impulse tubing *itself* creates an unwanted pressure drop, this error is added directly to the measurement, leading to false readings.</p>
            
            <div class="insight-card-row">
                <div class="insight-card">
                    <h4><i class="fas fa-industry"></i> Industrial Significance: Efficiency</h4>
                    <p><strong>Application:</strong> Orifice Plate Flow Measurement</p>
                    <p>The most common use for a DP transmitter is measuring flow. The flow rate ($Q$) is proportional to the square root of the DP ($Q \propto \sqrt{DP}$).</p>
                    <ul>
                        <li><strong>The Problem:</strong> Imagine the flow is 100 m³/hr, creating a true DP of 50 inches H₂O. But, friction in the HP impulse line causes a 1" drop, and the LP line causes a 0.5" drop. The transmitter now sees a DP of $50 - 1 + 0.5 = 49.5"$.</li>
                        <li><strong>The Impact:</strong> The calculated flow will be wrong. This "small" error, compounded 24/7, results in significant financial losses in custody transfer (billing for the wrong amount of product) or inefficient process control (e.g., incorrect fuel/air ratios in a furnace, wasting energy).</li>
                    </ul>
                </div>
                
                <div class="insight-card">
                    <h4><i class="fas fa-hard-hat"></i> Industrial Significance: Safety</h4>
                    <p><strong>Application:</strong> Boiler Drum Level Control</p>
                    <p>A "three-element" boiler drum level system uses a DP transmitter to measure the level of water in a steam drum. This is one of the most critical safety systems in a power plant.</p>
                    <ul>
                        <li><strong>The Problem:</strong> The transmitter measures the hydrostatic head of the water. If there is a leak in an impulse line, it creates a small but constant flow. This flow creates a frictional pressure drop.</li>
                        <li><strong>The Impact:</strong> This pressure drop can make the transmitter report a *higher* or *lower* level than is actually in the drum. The control system might dangerously overfill the drum (sending water into the turbine) or let it run dry (causing tubes to melt), all while believing the level is perfectly fine. This is a primary cause of catastrophic boiler failures.</li>
                    </ul>
                </div>
                
                <div class="insight-card">
                    <h4><i class="fas fa-clipboard-check"></i> Industrial Significance: Reliability</h4>
                    <p><strong>Application:</strong> Process Reliability & Uptime</p>
                    <p>Impulse lines are often exposed to the elements and process upsets. Calculating pressure drop helps diagnose and prevent common failures.</p>
                    <ul>
                        <li><strong>Plugging/Clogging:</strong> If a fluid is dirty or near its freezing/solidification point, a low-flow state (high pressure drop) in a narrow tube is the perfect recipe for a blockage.</li>
                        <li><strong>Flashing & Condensation:</strong> For liquids, a significant pressure drop can cause the pressure to fall *below* the fluid's vapor pressure, causing it to boil (flash) inside the line. For gases, a drop can cause condensation. Both events create bubbles or slugs of liquid, making the pressure reading completely unstable and unreliable, often damaging the instrument sensor.</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top: 40px;">The Step-by-Step Calculation Logic</h3>
            <p>This calculator uses the <strong>Darcy-Weisbach equation</strong>, the most comprehensive and accurate method for calculating pressure loss. It breaks the problem down into logical steps:</p>
            
            <div class="steps-explanation">
                <ol>
                    <li>
                        <strong>Find Fluid Velocity ($V$)</strong>
                        <p>First, we need to know how fast the fluid is moving inside the tube. This depends on the flow rate (Volumetric, $Q$, or Mass, $\dot{m}$) and the tube's internal cross-sectional area ($A$).</p>
                        <div class="formula-block">
                            Area: $A = \pi \times (D / 2)^2$ <br>
                            Velocity: $V = Q / A$ &nbsp;&nbsp; or &nbsp;&nbsp; $V = \dot{m} / (\rho \times A)$
                        </div>
                    </li>
                    <li>
                        <strong>Determine the Flow Regime (Reynolds Number, $Re$)</strong>
                        <p>Next, we determine *how* the fluid is flowing. Is it smooth and orderly (Laminar) or chaotic and swirling (Turbulent)? This is governed by the Reynolds Number ($Re$), a dimensionless value that relates fluid density ($\rho$), velocity ($V$), tube diameter ($D$), and fluid viscosity ($\mu$).</p>
                        <div class="formula-block">
                            $Re = (\rho \times V \times D) / \mu$
                        </div>
                        <ul>
                            <li><strong>$Re < 2000$:</strong> Laminar Flow. Friction is high and dominated by viscosity.</li>
                            <li><strong>$Re > 4000$:</strong> Turbulent Flow. Friction is lower (per unit of energy) and dominated by chaotic eddies.</li>
                            <li><strong>Between 2000-4000:</strong> Transition Flow. Unstable and best to avoid in design.</li>
                        </ul>
                    </li>
                    <li>
                        <strong>Calculate the Friction Factor ($f$)</strong>
                        <p>This is the "fudge factor" that accounts for all the friction. Its value depends entirely on the flow regime from Step 2.</p>
                        <ul>
                            <li><strong>If Laminar:</strong> The formula is simple and exact: $f = 64 / Re$</li>
                            <li><strong>If Turbulent:</strong> The formula is complex. This calculator uses the <strong>Swamee-Jain equation</strong>, a highly accurate approximation of the famous Colebrook-White equation. It depends on both the Reynolds Number ($Re$) and the "Relative Roughness" of the tube ($\epsilon/D$).</li>
                        </ul>
                    </li>
                    <li>
                        <strong>Calculate Frictional Pressure Loss ($\Delta P_{\text{friction}}$)</strong>
                        <p>Now we combine everything. The Darcy-Weisbach equation calculates the pressure lost to friction from the straight length of the tube ($L/D$) and from all the bends, valves, and fittings ($\Sigma K$). This total resistance is multiplied by the fluid's kinetic energy (or "Velocity Head").</p>
                        <div class="formula-block">
                            $\Delta P_{\text{friction}} = (f \times (L/D) + \Sigma K) \times (\rho \times V^2 / 2)$
                        </div>
                    </li>
                    <li>
                        <strong>Calculate Hydrostatic Pressure Change ($\Delta P_{\text{hydrostatic}}$)</strong>
                        <p>This component is separate from friction. It is simply the pressure created by the *weight* of the fluid column due to a change in elevation ($\Delta h$). If the fluid flows uphill, it gains pressure head (a positive $\Delta P$). If it flows downhill, it loses pressure head.</p>
                        <div class="formula-block">
                            $\Delta P_{\text{hydrostatic}} = \rho \times g \times \Delta h$
                        </div>
                    </li>
                    <li>
                        <strong>Find the Total Pressure Drop ($\Delta P_{\text{total}}$)</strong>
                        <p>The final answer is the sum of the frictional losses and the hydrostatic head changes. This is the total pressure difference the instrument at the end of the line will see compared to the process tap.</p>
                        <div class="formula-block" style="font-weight: bold; font-size: 1.2rem;">
                            $\Delta P_{\text{total}} = \Delta P_{\text{friction}} + \Delta P_{\text{hydrostatic}}$
                        </div>
                    </li>
                </ol>
            </div>
            
            <div class="danger-box">
                <h4><i class="fas fa-exclamation-triangle"></i> A Critical Warning for DP Transmitters</h4>
                <p>The final $\Delta P_{\text{total}}$ must be calculated for <strong>both the High Pressure (HP) and Low Pressure (LP) impulse lines independently.</strong> The final error on your instrument is the *difference* between these two pressure drops.</p>
                <p><strong>Error = $\Delta P_{\text{total (HP line)}} - \Delta P_{\text{total (LP line)}}$</strong></p>
                <p>This is why it is best practice to:
                <ul>
                    <li>Make both impulse lines the <strong>same length</strong>.</li>
                    <li>Use the <strong>same tubing material and diameter</strong>.</li>
                    <li>Install the <strong>same number of bends and fittings</strong>.</li>
                    <li>Ensure they run together to experience the <strong>same ambient temperature</strong>.</li>
                </ul>
                <p>This helps ensure $\Delta P_{\text{total (HP)}}$ is as close as possible to $\Delta P_{\text{total (LP)}}$, causing the errors to cancel each other out and resulting in an accurate final measurement.</p>
            </div>
        </div>

    </main>

    <!-- NEW FOOTER (FROM CORRECT FILE) -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li>                        
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href="articles.html">Articles & Whitepapers</a></li>
                        <li><a href="sitemap2.html">Sitemap</a></li>                        
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--header-secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box (from original file) -->
    <div id="custom-message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- ORIGINAL JS, TWEAKED FOR MATHJAX ---
            
            const unitSystemSelect = document.getElementById('unit-system');
            const densityInputMethodRadios = document.querySelectorAll('input[name="density-input-method"]');
            const flowRateTypeRadios = document.querySelectorAll('input[name="flow-rate-type"]');
            const roughnessInputMethodRadios = document.querySelectorAll('input[name="roughness-input-method"]');
            const viscosityInputMethodRadios = document.querySelectorAll('input[name="viscosity-input-method"]');

            const fluidTemperatureInput = document.getElementById('fluid-temperature');
            const localGravityInput = document.getElementById('local-gravity');
            const dynamicViscosityInput = document.getElementById('dynamic-viscosity');
            const kinematicViscosityInput = document.getElementById('kinematic-viscosity');
            const fluidDensityInput = document.getElementById('fluid-density');
            const specificGravityInput = document.getElementById('specific-gravity');
            const innerDiameterInput = document.getElementById('inner-diameter');
            const tubingLengthInput = document.getElementById('tubing-length');
            const elevationChangeInput = document.getElementById('elevation-change');
            const tubingMaterialSelect = document.getElementById('tubing-material');
            const absoluteRoughnessInput = document.getElementById('absolute-roughness');
            const volumetricFlowRateInput = document.getElementById('volumetric-flow-rate');
            const massFlowRateInput = document.getElementById('mass-flow-rate');
            const totalKFactorInput = document.getElementById('total-k-factor');

            const densityInputGroup = document.getElementById('density-input-group');
            const specificGravityInputGroup = document.getElementById('specific-gravity-input-group');
            const volumetricFlowGroup = document.getElementById('volumetric-flow-group');
            const massFlowGroup = document.getElementById('mass-flow-group');
            const roughnessMaterialGroup = document.getElementById('roughness-material-group');
            const roughnessDirectGroup = document.getElementById('roughness-direct-group');
            const dynamicViscosityGroup = document.getElementById('dynamic-viscosity-group');
            const kinematicViscosityGroup = document.getElementById('kinematic-viscosity-group');
            const elevationChangeGroup = document.getElementById('elevation-change-group');

            const labelFluidTemperature = document.getElementById('label-fluid-temperature');
            const labelLocalGravity = document.getElementById('label-local-gravity');
            const labelDynamicViscosity = document.getElementById('label-dynamic-viscosity');
            const labelKinematicViscosity = document.getElementById('label-kinematic-viscosity');
            const labelFluidDensityActual = document.getElementById('label-fluid-density-actual');
            const labelSpecificGravity = document.getElementById('label-specific-gravity');
            const labelInnerDiameter = document.getElementById('label-inner-diameter');
            const labelTubingLength = document.getElementById('label-tubing-length');
            const labelElevationChange = document.getElementById('label-elevation-change');
            const labelAbsoluteRoughness = document.getElementById('label-absolute-roughness');
            const labelVolumetricFlowRate = document.getElementById('label-volumetric-flow-rate');
            const labelMassFlowRate = document.getElementById('label-mass-flow-rate');

            const calculatePressureDropBtn = document.getElementById('calculate-pressure-drop-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            const pressureBar = document.querySelector('.pressure-bar');
            const pressureDropDisplay = document.getElementById('pressure-drop-display');
            const flowRegimeDisplay = document.getElementById('flow-regime-display');

            // Constants
            const WATER_DENSITY_SI_REF = 1000; // kg/m³ (water at 4°C)
            const WATER_DENSITY_IMPERIAL_REF = 62.43; // lb/ft³ (water at 4°C)
            const GRAVITY_SI_DEFAULT = 9.80665; // m/s²
            const GRAVITY_IMPERIAL_DEFAULT = 32.174; // ft/s²

            // Roughness values in meters (for SI calculations)
            const roughnessValues = {
                '0.0000015': 0.0000015, // Drawn Tubing / Stainless Steel
                '0.000046': 0.000046,   // Commercial Steel
                '0.00015': 0.00015,     // Galvanized Iron
                '0.00026': 0.00026      // Cast Iron
            };

            // Default values for resetting form (Metric)
            const defaultValues = {
                'unit-system': 'metric',
                'density-input-method': 'density',
                'viscosity-input-method': 'dynamic',
                'flow-rate-type': 'volumetric',
                'roughness-input-method': 'material',
                'fluid-temperature': 25.0, // °C
                'local-gravity': GRAVITY_SI_DEFAULT,
                'dynamic-viscosity': 0.001, // Pa·s (for water at 20°C)
                'kinematic-viscosity': 0.000001, // m²/s (for water at 20°C)
                'fluid-density': 1000.0, // kg/m³
                'specific-gravity': 1.0,
                'inner-diameter': 0.006, // m (e.g., 1/4 inch tubing)
                'tubing-length': 10.0, // m
                'elevation-change': 0.0, // m
                'tubing-material': '0.0000015', // Stainless Steel default
                'absolute-roughness': 0.0000015, // m
                'volumetric-flow-rate': 0.000001, // m³/s (1 cm³/s = 1e-6 m³/s)
                'mass-flow-rate': 0.001, // kg/s
                'total-k-factor': 5.0
            };

            // Unit configurations
            const unitsConfig = {
                'metric': {
                    length: { label: 'm', tooltip: 'meters', toSI: 1, fromSI: 1, precision: 3 },
                    pressure: { label: 'Pa', tooltip: 'Pascals', toSI: 1, fromSI: 1, precision: 2 },
                    density: { label: 'kg/m³', tooltip: 'kilograms per cubic meter', toSI: 1, fromSI: 1, precision: 2 },
                    dynamic_viscosity: { label: 'Pa·s', tooltip: 'Pascal-seconds', toSI: 1, fromSI: 1, precision: 6 },
                    kinematic_viscosity: { label: 'm²/s', tooltip: 'square meters per second', toSI: 1, fromSI: 1, precision: 9 },
                    volumetric_flow: { label: 'm³/s', tooltip: 'cubic meters per second', toSI: 1, fromSI: 1, precision: 7 },
                    mass_flow: { label: 'kg/s', tooltip: 'kilograms per second', toSI: 1, fromSI: 1, precision: 6 },
                    temperature: { label: '°C', tooltip: 'Celsius' },
                    gravity_unit: 'm/s²',
                    waterDensityRef: WATER_DENSITY_SI_REF,
                    roughness_unit: 'm',
                    gravityPrecision: 3,
                    tempPrecision: 1
                },
                'imperial': {
                    length: { label: 'ft', tooltip: 'feet', toSI: 0.3048, fromSI: 3.28084, precision: 2 },
                    pressure: { label: 'psi', tooltip: 'pounds per square inch', toSI: 6894.76, fromSI: 0.000145038, precision: 3 },
                    density: { label: 'lb/ft³', tooltip: 'pounds per cubic foot', toSI: 16.0185, fromSI: 0.062428, precision: 2 },
                    dynamic_viscosity: { label: 'lb/(ft·s)', tooltip: 'pounds per foot-second', toSI: 1.48816, fromSI: 0.671969, precision: 6 },
                    kinematic_viscosity: { label: 'ft²/s', tooltip: 'square feet per second', toSI: 0.092903, fromSI: 10.7639, precision: 9 },
                    volumetric_flow: { label: 'ft³/s', tooltip: 'cubic feet per second', toSI: 0.0283168, fromSI: 35.3147, precision: 7 },
                    mass_flow: { label: 'lb/s', tooltip: 'pounds per second', toSI: 0.453592, fromSI: 2.20462, precision: 6 },
                    temperature: { label: '°F', tooltip: 'Fahrenheit' },
                    gravity_unit: 'ft/s²',
                    waterDensityRef: WATER_DENSITY_IMPERIAL_REF,
                    roughness_unit: 'ft',
                    gravityPrecision: 3,
                    tempPrecision: 1
                }
            };

            // Helper function to add rows to the result table
            function addResultRow(parameter, value) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
            }

            // Event Listeners
            unitSystemSelect.addEventListener('change', updateUnitLabelsAndTooltips);
            densityInputMethodRadios.forEach(radio => radio.addEventListener('change', updateDensityInputMethodVisibility));
            viscosityInputMethodRadios.forEach(radio => radio.addEventListener('change', updateViscosityInputMethodVisibility));
            flowRateTypeRadios.forEach(radio => radio.addEventListener('change', updateFlowRateTypeVisibility));
            roughnessInputMethodRadios.forEach(radio => radio.addEventListener('change', updateRoughnessInputMethodVisibility));
            tubingMaterialSelect.addEventListener('change', function() {
                if (document.querySelector('input[name="roughness-input-method"]:checked').value === 'material') {
                    // Update the absolute roughness input with the SI value (which is the option value)
                    const siRoughness = parseFloat(this.value);
                    const selectedSystem = unitSystemSelect.value;
                    const config = unitsConfig[selectedSystem];
                    
                    let displayRoughness;
                    if (selectedSystem === 'metric') {
                        displayRoughness = siRoughness;
                    } else {
                        // Convert SI value to Imperial for display in the input box
                        displayRoughness = siRoughness * config.length.fromSI;
                    }
                    // Store the SI value in the input, but maybe we should store the display value?
                    // Let's update the roughness input to the *display* value for the current unit system
                    absoluteRoughnessInput.value = displayRoughness.toExponential(4);
                }
            });
            calculatePressureDropBtn.addEventListener('click', calculatePressureDrop);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            // Initial setup
            updateUnitLabelsAndTooltips(); // Update labels based on initial system
            updateDensityInputMethodVisibility(); // Show/hide density/SG input fields
            updateViscosityInputMethodVisibility(); // Show/hide dynamic/kinematic viscosity input fields
            updateFlowRateTypeVisibility(); // Show/hide flow rate input fields
            updateRoughnessInputMethodVisibility(); // Show/hide roughness input fields
            
            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            function updateUnitLabelsAndTooltips() {
                const selectedSystem = unitSystemSelect.value;
                const config = unitsConfig[selectedSystem];
                const densityInputMethod = document.querySelector('input[name="density-input-method"]:checked').value;
                const viscosityInputMethod = document.querySelector('input[name="viscosity-input-method"]:checked').value;
                const flowRateType = document.querySelector('input[name="flow-rate-type"]:checked').value;
                const roughnessInputMethod = document.querySelector('input[name="roughness-input-method"]:checked').value;

                labelFluidTemperature.innerHTML = `Fluid Temperature (${config.temperature.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The operating temperature of the fluid. Important for accurate density and viscosity. Unit: ${config.temperature.tooltip}.</span></span>`;
                labelLocalGravity.innerHTML = `Local Gravity (g) (${config.gravity_unit}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The local acceleration due to gravity at your location. Standard is ${GRAVITY_SI_DEFAULT} m/s² or ${GRAVITY_IMPERIAL_DEFAULT} ft/s². Unit: ${config.gravity_unit}.</span></span>`;
                labelInnerDiameter.innerHTML = `Inner Diameter (D) (${config.length.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The internal diameter of the impulse tubing. Unit: ${config.length.tooltip}.</span></span>`;
                labelTubingLength.innerHTML = `Tubing Length (L) (${config.length.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The total length of the straight impulse tubing. Unit: ${config.length.tooltip}.</span></span>`;
                labelElevationChange.innerHTML = `Elevation Change (Δh) (${config.length.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The vertical change in height of the tubing from inlet to outlet. Positive for upward flow, negative for downward flow. Unit: ${config.length.tooltip}.</span></span>`;
                
                if (densityInputMethod === 'density') {
                    labelFluidDensityActual.innerHTML = `Fluid Density (ρ) (${config.density.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The density of the fluid at operating conditions. Unit: ${config.density.tooltip}.</span></span>`;
                } else {
                    labelSpecificGravity.innerHTML = `Specific Gravity (SG) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The ratio of the fluid's density to the density of a reference fluid (usually water at 4°C for liquids). This value should be at the operating temperature. Unit: Dimensionless.</span></span>`;
                }

                if (viscosityInputMethod === 'dynamic') {
                    labelDynamicViscosity.innerHTML = `Dynamic Viscosity (μ) (${config.dynamic_viscosity.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The dynamic viscosity of the fluid at operating conditions. Unit: ${config.dynamic_viscosity.tooltip}.</span></span>`;
                } else {
                    labelKinematicViscosity.innerHTML = `Kinematic Viscosity (ν) (${config.kinematic_viscosity.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The kinematic viscosity of the fluid at operating conditions. (μ / ρ). Unit: ${config.kinematic_viscosity.tooltip}.</span></span>`;
                }

                if (flowRateType === 'volumetric') {
                    labelVolumetricFlowRate.innerHTML = `Volumetric Flow Rate (Q) (${config.volumetric_flow.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-volumetric-flow-rate">The volume of fluid passing through the tubing per unit time.</span></span>`;
                } else {
                    labelMassFlowRate.innerHTML = `Mass Flow Rate (ṁ) (${config.mass_flow.label}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-mass-flow-rate">The mass of fluid passing through the tubing per unit time.</span></span>`;
                }

                if (roughnessInputMethod === 'direct') {
                    labelAbsoluteRoughness.innerHTML = `Absolute Roughness (ε) (${config.roughness_unit}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-absolute-roughness">The absolute roughness of the inner surface of the tubing. Unit: ${config.roughness_unit}.</span></span>`;
                }
                
                // Update input placeholders
                fluidTemperatureInput.placeholder = `e.g., ${config.temperature.label === '°C' ? '25.0' : '77.0'} ${config.temperature.label}`;
                localGravityInput.placeholder = `e.g., ${config.gravity_unit === 'm/s²' ? GRAVITY_SI_DEFAULT : GRAVITY_IMPERIAL_DEFAULT}`;
                dynamicViscosityInput.placeholder = `e.g., ${config.dynamic_viscosity.label === 'Pa·s' ? '0.001' : '0.00067'} ${config.dynamic_viscosity.label}`;
                kinematicViscosityInput.placeholder = `e.g., ${config.kinematic_viscosity.label === 'm²/s' ? '0.000001' : '0.00001'} ${config.kinematic_viscosity.label}`;
                fluidDensityInput.placeholder = `e.g., ${config.density.label === 'kg/m³' ? '1000' : '62.4'} ${config.density.label}`;
                specificGravityInput.placeholder = `e.g., 1.0`;
                innerDiameterInput.placeholder = `e.g., ${config.length.label === 'm' ? '0.006' : '0.02'} ${config.length.label}`;
                tubingLengthInput.placeholder = `e.g., ${config.length.label === 'm' ? '10.0' : '30.0'} ${config.length.label}`;
                elevationChangeInput.placeholder = `e.g., 0.0 ${config.length.label}`;
                volumetricFlowRateInput.placeholder = `e.g., ${config.volumetric_flow.label === 'm³/s' ? '0.000001' : '0.00003'} ${config.volumetric_flow.label}`;
                massFlowRateInput.placeholder = `e.g., ${config.mass_flow.label === 'kg/s' ? '0.001' : '0.002'} ${config.mass_flow.label}`;
                absoluteRoughnessInput.placeholder = `e.g., ${config.roughness_unit === 'm' ? '0.0000015' : '0.000005'} ${config.roughness_unit}`;

                // Update material options for imperial units (convert values)
                const currentRoughnessSI = parseFloat(tubingMaterialSelect.value || defaultValues['tubing-material']);
                tubingMaterialSelect.innerHTML = ''; // Clear existing options
                
                for (const siRoughnessKey in roughnessValues) {
                    const siRoughnessValue = roughnessValues[siRoughnessKey];
                    const option = document.createElement('option');
                    option.value = siRoughnessValue; // Value is ALWAYS SI
                    
                    let materialName;
                    if (siRoughnessValue === 0.0000015) materialName = "Drawn Tubing / Stainless Steel";
                    else if (siRoughnessValue === 0.000046) materialName = "Commercial Steel";
                    else if (siRoughnessValue === 0.00015) materialName = "Galvanized Iron";
                    else if (siRoughnessValue === 0.00026) materialName = "Cast Iron";
                    else materialName = "Unknown Material"; // Fallback

                    let displayRoughness;
                    if (selectedSystem === 'metric') {
                        displayRoughness = siRoughnessValue.toExponential(1) + ' m';
                    } else {
                        displayRoughness = (siRoughnessValue * config.length.fromSI).toExponential(1) + ' ft';
                    }
                    option.textContent = `${materialName} (${displayRoughness})`;
                    tubingMaterialSelect.appendChild(option);
                }
                // Re-select the correct SI value
                tubingMaterialSelect.value = currentRoughnessSI;
                
                // Update direct roughness input if material is selected
                if (roughnessInputMethod === 'material') {
                    let displayRoughness;
                    if (selectedSystem === 'metric') {
                        displayRoughness = currentRoughnessSI;
                    } else {
                        displayRoughness = currentRoughnessSI * config.length.fromSI;
                    }
                    absoluteRoughnessInput.value = displayRoughness.toExponential(4);
                }

                // Update default gravity value based on unit system
                if (parseFloat(localGravityInput.value) === GRAVITY_SI_DEFAULT || parseFloat(localGravityInput.value) === GRAVITY_IMPERIAL_DEFAULT)
                {
                    localGravityInput.value = (selectedSystem === 'metric' ? GRAVITY_SI_DEFAULT : GRAVITY_IMPERIAL_DEFAULT);
                }
            }

            function updateDensityInputMethodVisibility() {
                const selectedMethod = document.querySelector('input[name="density-input-method"]:checked').value;
                if (selectedMethod === 'density') {
                    densityInputGroup.classList.add('active');
                    specificGravityInputGroup.classList.remove('active');
                    fluidDensityInput.setAttribute('required', 'required');
                    specificGravityInput.removeAttribute('required');
                } else {
                    densityInputGroup.classList.remove('active');
                    specificGravityInputGroup.classList.add('active');
                    fluidDensityInput.removeAttribute('required');
                    specificGravityInput.setAttribute('required', 'required');
                }
                updateUnitLabelsAndTooltips(); // Update labels after visibility change
                clearResults(); // Clear results when input method changes
            }

            function updateViscosityInputMethodVisibility() {
                const selectedMethod = document.querySelector('input[name="viscosity-input-method"]:checked').value;
                if (selectedMethod === 'dynamic') {
                    dynamicViscosityGroup.classList.add('active');
                    kinematicViscosityGroup.classList.remove('active');
                    dynamicViscosityInput.setAttribute('required', 'required');
                    kinematicViscosityInput.removeAttribute('required');
                } else {
                    dynamicViscosityGroup.classList.remove('active');
                    kinematicViscosityGroup.classList.add('active');
                    dynamicViscosityInput.removeAttribute('required');
                    kinematicViscosityInput.setAttribute('required', 'required');
                }
                updateUnitLabelsAndTooltips(); // Update labels after visibility change
                clearResults(); // Clear results when input method changes
            }

            function updateFlowRateTypeVisibility() {
                const selectedType = document.querySelector('input[name="flow-rate-type"]:checked').value;
                if (selectedType === 'volumetric') {
                    volumetricFlowGroup.classList.add('active');
                    massFlowGroup.classList.remove('active');
                    volumetricFlowRateInput.setAttribute('required', 'required');
                    massFlowRateInput.removeAttribute('required');
                } else {
                    volumetricFlowGroup.classList.remove('active');
                    massFlowGroup.classList.add('active');
                    volumetricFlowRateInput.removeAttribute('required');
                    massFlowRateInput.setAttribute('required', 'required');
                }
                updateUnitLabelsAndTooltips(); // Update labels after visibility change
                clearResults(); // Clear results when input method changes
            }

            function updateRoughnessInputMethodVisibility() {
                const selectedMethod = document.querySelector('input[name="roughness-input-method"]:checked').value;
                
                if (selectedMethod === 'material') {
                    roughnessMaterialGroup.classList.add('active');
                    roughnessDirectGroup.classList.remove('active');
                    tubingMaterialSelect.setAttribute('required', 'required');
                    absoluteRoughnessInput.removeAttribute('required');
                    
                    // Set absolute roughness from selected material, converting to current units
                    const siRoughness = parseFloat(tubingMaterialSelect.value);
                    const config = unitsConfig[unitSystemSelect.value];
                    let displayRoughness = (unitSystemSelect.value === 'metric') ? siRoughness : (siRoughness * config.length.fromSI);
                    absoluteRoughnessInput.value = displayRoughness.toExponential(4);

                } else {
                    roughnessMaterialGroup.classList.remove('active');
                    roughnessDirectGroup.classList.add('active');
                    tubingMaterialSelect.removeAttribute('required');
                    absoluteRoughnessInput.setAttribute('required', 'required');
                }
                updateUnitLabelsAndTooltips(); // Update labels after visibility change
                clearResults(); // Clear results when input method changes
            }

            function clearResults() {
                resultContainer.classList.remove('show');
                // Add a small delay to allow the fade-out animation to complete
                setTimeout(() => {
                    if (!resultContainer.classList.contains('show')) {
                        resultContainer.style.display = 'none'; 
                        resultTableBody.innerHTML = '';
                        calculationDetailsDiv.innerHTML = '';
                        standardReference.innerHTML = '';
                    }
                }, 500); 
                
                pressureBar.style.width = '0%'; // Reset animation
                pressureDropDisplay.textContent = '0.00'; // Reset displayed value
                flowRegimeDisplay.textContent = 'N/A'; // Reset displayed value
            }

            function resetForm() {
                unitSystemSelect.value = defaultValues['unit-system'];
                
                // Reset radio buttons and trigger their change events
                document.querySelector(`input[name="density-input-method"][value="${defaultValues['density-input-method']}"]`).checked = true;
                document.querySelector(`input[name="viscosity-input-method"][value="${defaultValues['viscosity-input-method']}"]`).checked = true;
                document.querySelector(`input[name="flow-rate-type"][value="${defaultValues['flow-rate-type']}"]`).checked = true;
                document.querySelector(`input[name="roughness-input-method"][value="${defaultValues['roughness-input-method']}"]`).checked = true;

                fluidTemperatureInput.value = defaultValues['fluid-temperature'];
                localGravityInput.value = defaultValues['local-gravity'];
                dynamicViscosityInput.value = defaultValues['dynamic-viscosity'];
                kinematicViscosityInput.value = defaultValues['kinematic-viscosity'];
                fluidDensityInput.value = defaultValues['fluid-density'];
                specificGravityInput.value = defaultValues['specific-gravity'];
                innerDiameterInput.value = defaultValues['inner-diameter'];
                tubingLengthInput.value = defaultValues['tubing-length'];
                elevationChangeInput.value = defaultValues['elevation-change'];
                tubingMaterialSelect.value = defaultValues['tubing-material'];
                absoluteRoughnessInput.value = defaultValues['absolute-roughness']; // This will be reset by updateRoughness...
                volumetricFlowRateInput.value = defaultValues['volumetric-flow-rate'];
                massFlowRateInput.value = defaultValues['mass-flow-rate'];
                totalKFactorInput.value = defaultValues['total-k-factor'];
                
                // Call updates to reset labels and visibility
                updateUnitLabelsAndTooltips();
                updateDensityInputMethodVisibility();
                updateViscosityInputMethodVisibility();
                updateFlowRateTypeVisibility();
                updateRoughnessInputMethodVisibility(); // This will also set the roughness input
                
                clearResults(); // Clear results again after inputs are reset
                displayMessage("Form reset to default values (Metric).", "info");
            }

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    console.error("Message box element not found!");
                    return;
                }

                messageBox.textContent = message;
                messageBox.style.color = 'white'; // Default
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; /* Red */
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; /* Amber */
                    messageBox.style.color = '#333';
                } else { // info or success
                    messageBox.style.backgroundColor = '#28a745'; /* Green */
                }
                messageBox.style.display = 'flex'; // Make it visible
                setTimeout(() => { // Wait for display to apply before animating
                    messageBox.style.opacity = 1;
                    messageBox.style.transform = 'translateX(-50%) translateY(0)'; // Bring to position
                }, 10);

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)'; // Fade out and move up
                    setTimeout(() => { messageBox.style.display = 'none'; }, 500); // Hide after animation
                }, 5000);
            }

            function calculatePressureDrop() {
                // Clear previous results first
                resultContainer.classList.remove('show');
                resultContainer.style.display = 'none';
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                standardReference.innerHTML = '';

                const selectedSystem = unitSystemSelect.value;
                const config = unitsConfig[selectedSystem];

                let fluidTemperature = parseFloat(fluidTemperatureInput.value);
                let localGravity_input = parseFloat(localGravityInput.value);
                let dynamicViscosity_input = parseFloat(dynamicViscosityInput.value);
                let kinematicViscosity_input = parseFloat(kinematicViscosityInput.value);
                let fluidDensity_input = parseFloat(fluidDensityInput.value);
                let specificGravity_input = parseFloat(specificGravityInput.value);
                let innerDiameter_input = parseFloat(innerDiameterInput.value);
                let tubingLength_input = parseFloat(tubingLengthInput.value);
                let elevationChange_input = parseFloat(elevationChangeInput.value);
                let absoluteRoughness_input_val = parseFloat(absoluteRoughnessInput.value);
                let volumetricFlowRate_input = parseFloat(volumetricFlowRateInput.value);
                let massFlowRate_input = parseFloat(massFlowRateInput.value);
                let totalKFactor = parseFloat(totalKFactorInput.value);

                const densityInputMethod = document.querySelector('input[name="density-input-method"]:checked').value;
                const viscosityInputMethod = document.querySelector('input[name="viscosity-input-method"]:checked').value;
                const flowRateType = document.querySelector('input[name="flow-rate-type"]:checked').value;
                const roughnessInputMethod = document.querySelector('input[name="roughness-input-method"]:checked').value;

                // Input Validation
                if (isNaN(fluidTemperature)) { displayMessage("Please enter a valid Fluid Temperature.", "error"); return; }
                if (isNaN(localGravity_input) || localGravity_input <= 0) { displayMessage("Please enter a valid positive Local Gravity.", "error"); return; }
                if (densityInputMethod === 'density' && (isNaN(fluidDensity_input) || fluidDensity_input <= 0)) { displayMessage("Please enter a valid positive Fluid Density.", "error"); return; }
                if (densityInputMethod === 'specific-gravity' && (isNaN(specificGravity_input) || specificGravity_input <= 0)) { displayMessage("Please enter a valid positive Specific Gravity.", "error"); return; }
                if (viscosityInputMethod === 'dynamic' && (isNaN(dynamicViscosity_input) || dynamicViscosity_input <= 0)) { displayMessage("Please enter a valid positive Dynamic Viscosity.", "error"); return; }
                if (viscosityInputMethod === 'kinematic' && (isNaN(kinematicViscosity_input) || kinematicViscosity_input <= 0)) { displayMessage("Please enter a valid positive Kinematic Viscosity.", "error"); return; }
                if (isNaN(innerDiameter_input) || innerDiameter_input <= 0) { displayMessage("Please enter a valid positive Inner Diameter.", "error"); return; }
                if (isNaN(tubingLength_input) || tubingLength_input < 0) { displayMessage("Please enter a valid non-negative Tubing Length.", "error"); return; }
                if (isNaN(elevationChange_input)) { displayMessage("Please enter a valid Elevation Change.", "error"); return; }
                if (roughnessInputMethod === 'material' && isNaN(parseFloat(tubingMaterialSelect.value))) { displayMessage("Please select a valid Tubing Material.", "error"); return; }
                if (roughnessInputMethod === 'direct' && (isNaN(absoluteRoughness_input_val) || absoluteRoughness_input_val < 0)) { displayMessage("Please enter a valid non-negative Absolute Roughness.", "error"); return; }
                if (flowRateType === 'volumetric' && (isNaN(volumetricFlowRate_input) || volumetricFlowRate_input <= 0)) { displayMessage("Please enter a valid positive Volumetric Flow Rate.", "error"); return; }
                if (flowRateType === 'mass' && (isNaN(massFlowRate_input) || massFlowRate_input <= 0)) { displayMessage("Please enter a valid positive Mass Flow Rate.", "error"); return; }
                if (isNaN(totalKFactor) || totalKFactor < 0) { displayMessage("Please enter a valid non-negative Total K-Factor.", "error"); return; }

                
                // Determine Absolute Roughness in SI
                let absoluteRoughness_si;
                let absoluteRoughness_display_val;
                let absoluteRoughness_display_unit = config.roughness_unit;

                if (roughnessInputMethod === 'material') {
                    absoluteRoughness_si = parseFloat(tubingMaterialSelect.value); // Value is already SI
                    // Convert SI to display units for the results table
                    absoluteRoughness_display_val = (selectedSystem === 'metric') ? absoluteRoughness_si : (absoluteRoughness_si * config.length.fromSI);
                } else {
                    absoluteRoughness_si = absoluteRoughness_input_val * config.length.toSI;
                    absoluteRoughness_display_val = absoluteRoughness_input_val;
                }


                // Convert other inputs to SI units for calculation
                let fluidDensity_si;
                let fluidDensity_display_val;
                let fluidDensity_display_unit;

                if (densityInputMethod === 'density') {
                    fluidDensity_si = fluidDensity_input * config.density.toSI;
                    fluidDensity_display_val = fluidDensity_input.toFixed(config.density.precision);
                    fluidDensity_display_unit = config.density.label;
                } else {
                    // Use the reference density *in SI units*
                    fluidDensity_si = specificGravity_input * WATER_DENSITY_SI_REF; 
                    fluidDensity_display_val = specificGravity_input.toFixed(3);
                    fluidDensity_display_unit = 'SG';
                }

                let dynamicViscosity_si;
                let dynamicViscosity_display_val;
                let dynamicViscosity_display_unit;

                if (viscosityInputMethod === 'dynamic') {
                    dynamicViscosity_si = dynamicViscosity_input * config.dynamic_viscosity.toSI;
                    dynamicViscosity_display_val = dynamicViscosity_input.toFixed(config.dynamic_viscosity.precision);
                    dynamicViscosity_display_unit = config.dynamic_viscosity.label;
                } else { // kinematic
                    const kinematicViscosity_si = kinematicViscosity_input * config.kinematic_viscosity.toSI;
                    dynamicViscosity_si = kinematicViscosity_si * fluidDensity_si;
                    dynamicViscosity_display_val = kinematicViscosity_input.toFixed(config.kinematic_viscosity.precision);
                    dynamicViscosity_display_unit = config.kinematic_viscosity.label;
                }
                
                const innerDiameter_si = innerDiameter_input * config.length.toSI;
                const tubingLength_si = tubingLength_input * config.length.toSI;
                const elevationChange_si = elevationChange_input * config.length.toSI;
                const localGravity_si = localGravity_input * (selectedSystem === 'imperial' ? config.length.toSI : 1); // Convert ft/s² to m/s²

                let flowRate_si_volumetric; // We need volumetric flow for velocity
                let flowRate_display_val;
                let flowRate_display_unit;

                if (flowRateType === 'volumetric') {
                    flowRate_si_volumetric = volumetricFlowRate_input * config.volumetric_flow.toSI;
                    flowRate_display_val = volumetricFlowRate_input.toFixed(config.volumetric_flow.precision);
                    flowRate_display_unit = config.volumetric_flow.label;
                } else {
                    const massFlowRate_si = massFlowRate_input * config.mass_flow.toSI;
                    flowRate_si_volumetric = massFlowRate_si / fluidDensity_si; // Convert mass flow to volumetric
                    flowRate_display_val = massFlowRate_input.toFixed(config.mass_flow.precision);
                    flowRate_display_unit = config.mass_flow.label;
                }

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>Unit System:</strong> ${selectedSystem.toUpperCase()}</p>`;
                
                calculationHtml += `<p><strong>1. Input Parameters and Unit Conversions:</strong></p>`;
                calculationHtml += `<p>All input values are first converted to the International System of Units (SI) for consistent calculation, then converted back for display.</p>`;
                calculationHtml += `<p class="calculation-step">Fluid Temperature = ${fluidTemperature.toFixed(config.tempPrecision)} ${config.temperature.label}</p>`;
                calculationHtml += `<p class="calculation-step">Local Gravity (g) = ${localGravity_input.toFixed(config.gravityPrecision)} ${config.gravity_unit} = ${localGravity_si.toFixed(3)} m/s²</p>`;
                calculationHtml += `<p class="calculation-step">Fluid Density Input = ${fluidDensity_display_val} ${fluidDensity_display_unit}</p>`;
                calculationHtml += `<p class="calculation-step">Calculated Density (ρ) = ${fluidDensity_si.toFixed(2)} kg/m³</p>`;
                
                if (viscosityInputMethod === 'dynamic') {
                    calculationHtml += `<p class="calculation-step">Dynamic Viscosity (μ) = ${dynamicViscosity_display_val} ${dynamicViscosity_display_unit} = ${dynamicViscosity_si.toExponential(2)} Pa·s</p>`;
                } else {
                    calculationHtml += `<p class="calculation-step">Kinematic Viscosity (ν) = ${dynamicViscosity_display_val} ${dynamicViscosity_display_unit} = ${(kinematicViscosity_input * config.kinematic_viscosity.toSI).toExponential(2)} m²/s</p>`;
                    calculationHtml += `<p class="calculation-step">Calculated Dynamic Viscosity (μ) = ν × ρ = ${dynamicViscosity_si.toExponential(2)} Pa·s</p>`;
                }

                calculationHtml += `<p class="calculation-step">Inner Diameter (D) = ${innerDiameter_input.toFixed(config.length.precision)} ${config.length.label} = ${innerDiameter_si.toExponential(2)} m</p>`;
                calculationHtml += `<p class="calculation-step">Tubing Length (L) = ${tubingLength_input.toFixed(config.length.precision)} ${config.length.label} = ${tubingLength_si.toFixed(2)} m</p>`;
                calculationHtml += `<p class="calculation-step">Elevation Change (Δh) = ${elevationChange_input.toFixed(config.length.precision)} ${config.length.label} = ${elevationChange_si.toFixed(2)} m</p>`;
                calculationHtml += `<p class="calculation-step">Absolute Roughness (ε) = ${absoluteRoughness_display_val.toExponential(2)} ${absoluteRoughness_display_unit} = ${absoluteRoughness_si.toExponential(2)} m</p>`;
                
                if (flowRateType === 'volumetric') {
                     calculationHtml += `<p class="calculation-step">Volumetric Flow Rate (Q) = ${flowRate_display_val} ${flowRate_display_unit} = ${flowRate_si_volumetric.toExponential(2)} m³/s</p>`;
                } else {
                     calculationHtml += `<p class="calculation-step">Mass Flow Rate (ṁ) = ${flowRate_display_val} ${flowRate_display_unit} = ${(massFlowRate_input * config.mass_flow.toSI).toExponential(2)} kg/s</p>`;
                     calculationHtml += `<p class="calculation-step">Calculated Volumetric Flow (Q) = ṁ / ρ = ${flowRate_si_volumetric.toExponential(2)} m³/s</p>`;
                }
                calculationHtml += `<p class="calculation-step">Total K-Factor for Fittings (ΣK) = ${totalKFactor.toFixed(1)} (dimensionless)</p>`;

                // 2. Calculate Cross-sectional Area (A)
                const crossSectionalArea_si = Math.PI * Math.pow(innerDiameter_si / 2, 2);
                calculationHtml += `<p><strong>2. Calculate Cross-sectional Area (A):</strong></p>`;
                calculationHtml += `<p>The cross-sectional area of the tubing is needed to determine the fluid velocity.</p>`;
                calculationHtml += `<p class="formula">$$A = \\pi \\times (D / 2)^2$$</p>`;
                calculationHtml += `<p class="calculation-step">A = π × (${innerDiameter_si.toExponential(2)} m / 2)² = ${crossSectionalArea_si.toExponential(3)} m²</p>`;

                // 3. Calculate Average Flow Velocity (V)
                const averageVelocity_si = flowRate_si_volumetric / crossSectionalArea_si;
                calculationHtml += `<p><strong>3. Calculate Average Flow Velocity (V):</strong></p>`;
                calculationHtml += `<p>Velocity is the volumetric flow rate divided by the cross-sectional area.</p>`;
                calculationHtml += `<p class="formula">$$V = Q / A$$</p>`;
                calculationHtml += `<p class="calculation-step">V = ${flowRate_si_volumetric.toExponential(2)} m³/s / ${crossSectionalArea_si.toExponential(3)} m² = ${averageVelocity_si.toFixed(3)} m/s</p>`;
                
                // 4. Calculate Reynolds Number (Re)
                const reynoldsNumber = (fluidDensity_si * averageVelocity_si * innerDiameter_si) / dynamicViscosity_si;
                calculationHtml += `<p><strong>4. Calculate Reynolds Number (Re):</strong></p>`;
                calculationHtml += `<p>The Reynolds number predicts the flow pattern (laminar or turbulent).</p>`;
                calculationHtml += `<p class="formula">$$Re = (\\rho \\times V \\times D) / \\mu$$</p>`;
                calculationHtml += `<p class="calculation-step">Re = (${fluidDensity_si.toFixed(2)} × ${averageVelocity_si.toFixed(3)} × ${innerDiameter_si.toExponential(2)}) / ${dynamicViscosity_si.toExponential(2)}</p>`;
                calculationHtml += `<p class="calculation-step">Re = ${reynoldsNumber.toFixed(2)}</p>`;

                // 5. Determine Flow Regime and Calculate Friction Factor (f)
                let flowRegime;
                let frictionFactor;
                const relativeRoughness = absoluteRoughness_si / innerDiameter_si;

                if (reynoldsNumber < 2000) {
                    flowRegime = "Laminar";
                    frictionFactor = 64 / reynoldsNumber;
                    calculationHtml += `<p><strong>5. Determine Flow Regime and Calculate Friction Factor (f):</strong></p>`;
                    calculationHtml += `<p>Since Re < 2000, the flow is Laminar.</p>`;
                    calculationHtml += `<p class="formula">For Laminar Flow: $$f = 64 / Re$$</p>`;
                    calculationHtml += `<p class="calculation-step">f = 64 / ${reynoldsNumber.toFixed(2)} = ${frictionFactor.toFixed(5)}</p>`;
                } else if (reynoldsNumber >= 4000) {
                    flowRegime = "Turbulent";
                    // Swamee-Jain equation for turbulent flow
                    const term1 = (relativeRoughness / 3.7) + (5.74 / Math.pow(reynoldsNumber, 0.9));
                    frictionFactor = 0.25 / Math.pow(Math.log10(term1), 2);
                    calculationHtml += `<p><strong>5. Determine Flow Regime and Calculate Friction Factor (f):</strong></p>`;
                    calculationHtml += `<p>Since Re >= 4000, the flow is Turbulent.</p>`;
                    calculationHtml += `<p class="calculation-step">Relative Roughness (ε/D) = ${relativeRoughness.toExponential(2)}</p>`;
                    calculationHtml += `<p class="formula">For Turbulent Flow (Swamee-Jain): $$f = 0.25 / [log_{10}(\\frac{\\epsilon}{3.7D} + \\frac{5.74}{Re^{0.9}})]^2$$</p>`;
                    calculationHtml += `<p class="calculation-step">f = 0.25 / [log₁₀(${relativeRoughness.toExponential(2)} / 3.7 + 5.74 / ${reynoldsNumber.toFixed(2)}⁰·⁹)]² = ${frictionFactor.toFixed(5)}</p>`;
                } else {
                    flowRegime = "Transition (2000 <= Re < 4000)";
                    // Use turbulent friction factor for calculation, but note the transition zone.
                    const term1 = (relativeRoughness / 3.7) + (5.74 / Math.pow(reynoldsNumber, 0.9));
                    frictionFactor = 0.25 / Math.pow(Math.log10(term1), 2);
                    calculationHtml += `<p><strong>5. Determine Flow Regime and Calculate Friction Factor (f):</strong></p>`;
                    calculationHtml += `<p>Since 2000 <= Re < 4000, the flow is in the Transition region. Calculation uses a turbulent approximation.</p>`;
                    calculationHtml += `<p class="calculation-step">Relative Roughness (ε/D) = ${relativeRoughness.toExponential(2)}</p>`;
                    calculationHtml += `<p class="formula">Using Swamee-Jain Equation: $$f = 0.25 / [log_{10}(\\frac{\\epsilon}{3.7D} + \\frac{5.74}{Re^{0.9}})]^2$$</p>`;
                    calculationHtml += `<p class="calculation-step">f = 0.25 / [log₁₀(${relativeRoughness.toExponential(2)} / 3.7 + 5.74 / ${reynoldsNumber.toFixed(2)}⁰·⁹)]² = ${frictionFactor.toFixed(5)}</p>`;
                }

                // 6. Calculate Frictional Pressure Drop (ΔP_friction)
                const velocityHead_si = (fluidDensity_si * Math.pow(averageVelocity_si, 2)) / 2;
                const frictionalPressureDrop_si = (frictionFactor * (tubingLength_si / innerDiameter_si) + totalKFactor) * velocityHead_si;

                calculationHtml += `<p><strong>6. Calculate Frictional Pressure Drop ($\\Delta P_{\\text{friction}}$):</strong></p>`;
                calculationHtml += `<p>This is the pressure loss from friction (pipe + fittings) using the Darcy-Weisbach equation.</p>`;
                calculationHtml += `<p class="formula">$$\\Delta P_{\\text{friction}} = (f \\times \\frac{L}{D} + \\Sigma K) \\times (\\frac{\\rho \\times V^2}{2})$$</p>`;
                calculationHtml += `<p class="calculation-step">Velocity Head (ρV²/2) = ${velocityHead_si.toFixed(2)} Pa</p>`;
                calculationHtml += `<p class="calculation-step">Friction Term (f × L/D) = ${frictionFactor.toFixed(5)} × (${tubingLength_si.toFixed(2)} / ${innerDiameter_si.toExponential(2)}) = ${(frictionFactor * (tubingLength_si / innerDiameter_si)).toFixed(2)}</p>`;
                calculationHtml += `<p class="calculation-step">Total Resistance Term = ${(frictionFactor * (tubingLength_si / innerDiameter_si)).toFixed(2)} + ${totalKFactor.toFixed(1)} = ${(frictionFactor * (tubingLength_si / innerDiameter_si) + totalKFactor).toFixed(2)}</p>`;
                calculationHtml += `<p class="calculation-step">$\\Delta P_{\\text{friction}}$ = ${(frictionFactor * (tubingLength_si / innerDiameter_si) + totalKFactor).toFixed(2)} × ${velocityHead_si.toFixed(2)} Pa = ${frictionalPressureDrop_si.toFixed(2)} Pa</p>`;

                // 7. Calculate Hydrostatic Pressure Change (ΔP_hydro)
                const hydrostaticPressureChange_si = fluidDensity_si * localGravity_si * elevationChange_si;
                calculationHtml += `<p><strong>7. Calculate Hydrostatic Pressure Change ($\\Delta P_{\\text{hydro}}$):</strong></p>`;
                calculationHtml += `<p>This is the pressure change from the weight of the fluid column due to elevation change.</p>`;
                calculationHtml += `<p class="formula">$$\\Delta P_{\\text{hydro}} = \\rho \\times g \\times \\Delta h$$</p>`;
                calculationHtml += `<p class="calculation-step">$\\Delta P_{\\text{hydro}}$ = ${fluidDensity_si.toFixed(2)} × ${localGravity_si.toFixed(3)} × ${elevationChange_si.toFixed(2)} = ${hydrostaticPressureChange_si.toFixed(2)} Pa</p>`;

                // 8. Calculate Total Pressure Drop (ΔP_total)
                const totalPressureDrop_si = frictionalPressureDrop_si + hydrostaticPressureChange_si;
                calculationHtml += `<p><strong>8. Calculate Total Pressure Drop ($\\Delta P_{\\text{total}}$):</strong></p>`;
                calculationHtml += `<p>The total pressure drop is the sum of frictional and hydrostatic pressure changes.</p>`;
                calculationHtml += `<p class="formula">$$\\Delta P_{\\text{total}} = \\Delta P_{\\text{friction}} + \\Delta P_{\\text{hydro}}$$</p>`;
                calculationHtml += `<p class="calculation-step">$\\Delta P_{\\text{total}}$ = ${frictionalPressureDrop_si.toFixed(2)} Pa + ${hydrostaticPressureChange_si.toFixed(2)} Pa = ${totalPressureDrop_si.toFixed(2)} Pa</p>`;

                // Convert final pressure drop back to selected unit system for display
                const finalPressureDrop_display = totalPressureDrop_si * config.pressure.fromSI;
                const frictionalPressureDrop_display = frictionalPressureDrop_si * config.pressure.fromSI;
                const hydrostaticPressureChange_display = hydrostaticPressureChange_si * config.pressure.fromSI;

                // Display Results in table
                resultTableBody.innerHTML = '';
                addResultRow("Fluid Temperature", `${fluidTemperature.toFixed(config.tempPrecision)} ${config.temperature.label}`);
                addResultRow("Local Gravity (g)", `${localGravity_input.toFixed(config.gravityPrecision)} ${config.gravity_unit}`);
                addResultRow("Fluid Density Input", `${fluidDensity_display_val} ${fluidDensity_display_unit}`);
                addResultRow("Fluid Density (Calculated)", `${fluidDensity_si.toFixed(2)} kg/m³`);
                if (viscosityInputMethod === 'dynamic') {
                    addResultRow("Dynamic Viscosity (μ)", `${dynamicViscosity_display_val} ${dynamicViscosity_display_unit}`);
                } else {
                    addResultRow("Kinematic Viscosity (ν)", `${dynamicViscosity_display_val} ${config.kinematic_viscosity.label}`);
                    addResultRow("Dynamic Viscosity (Calculated)", `${dynamicViscosity_si.toExponential(2)} Pa·s`);
                }
                addResultRow("Inner Diameter (D)", `${innerDiameter_input.toFixed(config.length.precision)} ${config.length.label}`);
                addResultRow("Tubing Length (L)", `${tubingLength_input.toFixed(config.length.precision)} ${config.length.label}`);
                addResultRow("Elevation Change (Δh)", `${elevationChange_input.toFixed(config.length.precision)} ${config.length.label}`);
                addResultRow("Absolute Roughness (ε)", `${absoluteRoughness_display_val.toExponential(2)} ${absoluteRoughness_display_unit}`);
                addResultRow(flowRateType === 'volumetric' ? "Volumetric Flow Rate (Q)" : "Mass Flow Rate (ṁ)", `${flowRate_display_val} ${flowRate_display_unit}`);
                addResultRow("Total K-Factor for Fittings (ΣK)", `${totalKFactor.toFixed(1)}`);
                addResultRow("Cross-sectional Area (A)", `${crossSectionalArea_si.toExponential(3)} m²`);
                addResultRow("Average Flow Velocity (V)", `${averageVelocity_si.toFixed(3)} m/s`);
                addResultRow("Reynolds Number (Re)", `${reynoldsNumber.toFixed(2)}`);
                addResultRow("Flow Regime", flowRegime);
                addResultRow("Friction Factor (f)", `${frictionFactor.toFixed(5)}`);
                addResultRow("Frictional Pressure Drop (ΔP<sub>friction</sub>)", `${frictionalPressureDrop_display.toFixed(config.pressure.precision)} ${config.pressure.label}`);
                addResultRow("Hydrostatic Pressure Change (ΔP<sub>hydro</sub>)", `${hydrostaticPressureChange_display.toFixed(config.pressure.precision)} ${config.pressure.label}`);
                addResultRow("<strong>Calculated Total Pressure Drop (ΔP<sub>total</sub>)</strong>", `<strong>${finalPressureDrop_display.toFixed(config.pressure.precision)} ${config.pressure.label}</strong>`);
                
                // Update Pressure Drop Visualization
                const maxVizPressureDropSI = 10000; // Example max pressure drop for full bar in Pascals
                let vizWidth = (Math.abs(totalPressureDrop_si) / maxVizPressureDropSI) * 100;
                vizWidth = Math.max(0, Math.min(100, vizWidth)); // Clamp between 0 and 100%

                pressureBar.style.width = `${vizWidth}%`;
                pressureDropDisplay.textContent = `${finalPressureDrop_display.toFixed(config.pressure.precision)} ${config.pressure.label}`;
                flowRegimeDisplay.textContent = flowRegime;


                const standardRefText = `
                    <h4>International Standards Compliance:</h4>
                    <p>This calculator adheres to fundamental principles of fluid dynamics, aligning with common engineering standards:</p>
                    <ul>
                        <li><strong>Darcy-Weisbach Equation:</strong> The core calculation for frictional loss is based on this universally accepted formula, which is more accurate than older methods like Hazen-Williams.</li>
                        <li><strong>Colebrook-White & Swamee-Jain Equations:</strong> The friction factor ($f$) for turbulent flow is determined using the Swamee-Jain equation, a precise and explicit approximation of the implicit Colebrook-White equation. This is the industry standard for pipe flow calculations.</li>
                        <li><strong>Reynolds Number ($Re$):</strong> The calculation of $Re$ to determine flow regimes (Laminar, Turbulent) is a fundamental principle of fluid mechanics.</li>
                        <li><strong>ISO 5167 & ASME Codes (e.g., B31.3):</strong> While these standards cover broader topics (flow measurement, piping design), the principles used in this calculator are the same ones required to satisfy the design and accuracy requirements of those codes, particularly concerning flow and pressure calculations.</li>
                    </ul>
                    <p>This tool provides accurate calculations based on these widely accepted engineering principles. For critical applications, always refer to the latest official standards documents and consult with a qualified engineer.</p>
                `;
                standardReference.innerHTML = standardRefText;

                calculationDetailsDiv.innerHTML = calculationHtml; // Insert detailed steps
                
                // Typeset MathJax in the new dynamic content
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    window.MathJax.typesetPromise([calculationDetailsDiv])
                        .catch(function (err) { console.log('MathJax error: ' + err.message); });
                }

                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to results
                }, 10);
            }

            // Theme switch logic (from new header file)
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                // Check local storage for saved theme
                const currentTheme = localStorage.getItem('theme');
                if (currentTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                } else if (currentTheme === 'light') {
                     document.body.classList.remove('dark-mode');
                    themeSwitch.checked = false;
                } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && currentTheme !== 'light') {
                    // Default to system preference if no explicit choice
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>

