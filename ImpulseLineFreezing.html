<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impulse Line Freezing Risk & Heat Tracing Calculator - Industrial Grade</title>
    <meta name="description" content="Professional Impulse Line Freezing Calculator. Calculate Time to Freeze, Heat Loss, and Heat Tracing requirements for instrumentation tubing. Accounts for wind chill, insulation type, and fluid properties.">
    <meta name="keywords" content="impulse line freezing, heat tracing calculator, winterization, tubing heat loss, time to freeze, instrumentation winterization, heat loss calculation, aerogel insulation, steam tracing">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial - Matches Symmetrical Components) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Quick Load Buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .highlight { color: var(--success); font-weight: 700; }
        .danger-text { color: var(--danger); font-weight: 700; }

        /* Canvas Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Educational Section Styling */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .insight-card p, .insight-card ul {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text);
        }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(0,0,0,0.03);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid var(--success);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(255,255,255,0.05); }

        /* Vector Input Group Styling (Reused) */
        .vector-input-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Print Styling */
        @media print {
            header, footer, .education-section, .theme-toggle, .button-wrapper, .preset-container { display: none !important; }
            .card { border: none; shadow: none; padding: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 300px; page-break-inside: avoid; }
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles.html">Articles</a></li>
                    <li><a href="indexmech.html">Mechanical</a></li>
                    <li><a href="indexele.html">Electrical</a></li>
                    <li><a href="indexinst.html">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-snowflake"></i> Impulse Line Freezing Risk & Heat Tracing Calculator</h2>
            
            <div class="tool-description">
                <p>This industrial-grade calculator simulates the **thermodynamics of stagnant instrumentation lines**. It determines the **Time to Freeze** for water/condensate based on ambient conditions and calculates the required **Heat Tracing Power (W/m)** to prevent plugging. Critical for winterization of pressure transmitters and gauges.</p>
            </div>

            <div class="calculator-form">
                <form id="freeze-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('uninsulated')"><i class="fas fa-exclamation-triangle"></i> Bare Tubing (Risk)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('standard_ins')"><i class="fas fa-layer-group"></i> Std Insulation (1")</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('arctic')"><i class="fas fa-snowflake"></i> Arctic Conditions</button>
                            </div>
                        </div>
                    </div>

                    <!-- Tubing & Fluid -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. Tubing & Process Fluid</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-ruler-horizontal"></i> Tubing</div>
                            <div class="form-group">
                                <label for="tube-size">Size (OD)</label>
                                <select id="tube-size">
                                    <option value="0.25">1/4 inch (6mm)</option>
                                    <option value="0.375">3/8 inch (10mm)</option>
                                    <option value="0.5" selected>1/2 inch (12mm)</option>
                                    <option value="0.75">3/4 inch (20mm)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="tube-mat">Material</label>
                                <select id="tube-mat">
                                    <option value="ss316" selected>Stainless Steel 316</option>
                                    <option value="copper">Copper</option>
                                </select>
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-tint"></i> Fluid</div>
                            <div class="form-group">
                                <label for="fluid-type">Process Fluid</label>
                                <select id="fluid-type">
                                    <option value="water" selected>Water / Condensate</option>
                                    <option value="caustic">Caustic (Freezes @ 12°C)</option>
                                    <option value="benzene">Benzene (Freezes @ 5.5°C)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="init-temp">Initial Process Temp [°C]</label>
                                <input type="number" id="init-temp" value="50" step="1">
                            </div>
                        </div>
                    </div>

                    <!-- Environment & Insulation -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Environment & Winterization</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-cloud-sun"></i> Ambient</div>
                            <div class="form-group">
                                <label for="amb-temp">Min Ambient Temp [°C] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Worst case winter temperature.</span></span></label>
                                <input type="number" id="amb-temp" value="-10" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="wind-speed">Wind Speed [m/s] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Wind strips heat rapidly. 5-10 m/s is typical design.</span></span></label>
                                <input type="number" id="wind-speed" value="5" step="1">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-shield-alt"></i> Insulation</div>
                            <div class="form-group">
                                <label for="ins-type">Material</label>
                                <select id="ins-type">
                                    <option value="none">None (Bare)</option>
                                    <option value="fiberglass" selected>Fiberglass (Std)</option>
                                    <option value="mineral_wool">Mineral Wool</option>
                                    <option value="aerogel">Aerogel (High Perf)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="ins-thick">Thickness [mm]</label>
                                <input type="number" id="ins-thick" value="25" step="5">
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Freeze Risk</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download PDF Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Analysis Results</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Thermal Performance</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Unit</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-info-circle"></i> Status:</strong>
                            <div id="interpretation-text" style="margin-top: 5px; font-size: 0.95rem;"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Cool-Down Curve</h4>
                        <div class="chart-container">
                            <canvas id="coolingChart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                            <span style="color: #3B82F6;">● Fluid Temp</span> &nbsp;
                            <span style="color: #EF4444; border-bottom: 2px dashed #EF4444;">-- Freezing Point</span>
                        </div>
                    </div>
                    
                    <!-- Schematic -->
                     <div style="grid-column: 1 / -1; margin-top: 20px;">
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Heat Loss Diagram</h4>
                        <div class="chart-container" style="height: 300px; display:flex; justify-content:center;">
                            <canvas id="pipeCanvas" width="400" height="250"></canvas>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Calculations based on radial heat conduction $Q = 2\pi k L \Delta T / \ln(r_o/r_i)$ and Newtonian cooling. Safety factor of 1.25 applied to heat trace recommendations.
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (MASSIVE) -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: Winterization of Instrumentation</h2>
            
            <!-- Insight 1: The Physics of Freezing -->
            <div class="insight-card">
                <h4><i class="fas fa-snowflake"></i> 1. Why Impulse Lines Freeze First</h4>
                <p>Impulse lines (sensing lines) are typically small-bore tubing (1/2" or less). They contain a very small mass of fluid, meaning they have low <strong>Thermal Inertia</strong>. Unlike a large 10" process pipe which might take days to freeze after flow stops, a 1/2" tube can freeze in minutes.</p>
                <p>Furthermore, impulse lines are often "Dead Legs"—there is no flow. The fluid is stagnant. Without flow to replenish heat, the fluid loses energy to the environment until it reaches ambient temperature. If ambient is below freezing, ice plugs form, blocking the pressure signal to the transmitter. This leads to loss of control, false readings, or safety trips.</p>
            </div>

            <!-- Insight 2: Insulation vs Tracing -->
            <div class="insight-card">
                <h4><i class="fas fa-layer-group"></i> 2. Insulation Delays, Tracing Prevents</h4>
                <p><strong>Insulation (Lagging):</strong> Reduces the rate of heat loss. It buys you time. A well-insulated line might take 4 hours to freeze instead of 15 minutes. However, insulation alone cannot prevent freezing indefinitely if the line is stagnant and ambient is below freezing. Eventually, $T_{fluid} \to T_{ambient}$.</p>
                <p><strong>Heat Tracing (Active Heating):</strong> Adds energy back into the system to replace what is lost. Electric Heat Tracing (EHT) or Steam Tracing maintains the tube temperature above a setpoint (e.g., 5°C). This is the only way to guarantee protection for stagnant lines in freezing climates.</p>
            </div>

            <!-- Insight 3: Wind Chill -->
            <div class="insight-card">
                <h4><i class="fas fa-wind"></i> 3. The Wind Chill Factor</h4>
                <p>Convection heat transfer ($h$) is heavily dependent on air velocity. A 20 mph wind can increase heat loss by 3x to 5x compared to still air. This calculator uses a correlation for flow across a cylinder to estimate the convective coefficient based on wind speed. Always design for the "Worst Case" wind + "Worst Case" temperature.</p>
            </div>

            <!-- Insight 4: EHT vs Steam -->
            <div class="insight-card">
                <h4><i class="fas fa-bolt"></i> 4. Electric vs. Steam Tracing</h4>
                <ul>
                    <li><strong>Electric (Self-Regulating):</strong> Most common. The cable resistance increases as it gets hot, reducing power output. This prevents overheating (to a degree). Easy to control with thermostats.</li>
                    <li><strong>Steam Tracing:</strong> Using small copper tubes wrapped around the impulse line. Extremely powerful heat output, often too much. Can boil the fluid in the impulse line ("flashing"), causing measurement errors. Requires steam traps and maintenance. Best for heavy viscous fluids (tar/bitumen) requiring high maintain temps.</li>
                </ul>
            </div>
            
            <!-- Insight 5: Manifolds -->
            <div class="insight-card">
                <h4><i class="fas fa-random"></i> 5. The Vulnerable Manifold</h4>
                <p>The 3-valve or 5-valve manifold is a large chunk of metal that acts as a cooling fin. It often freezes before the tubing does. <strong>Best Practice:</strong> Use a "Winterization Enclosure" (Hot Box) that covers both the transmitter and the manifold, containing the heat from the tracing.</p>
            </div>
        </div>
    </main>    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele.html">Electrical</a></li>
                        <li><a href="indexmech.html">Mechanical</a></li>
                        <li><a href="indexinst.html">Instrumentation</a></li>                        
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="faq">FAQ.html</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles.html'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2.html'>Sitemap</a></li>                        
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let coolingChart = null;
        let lastResult = null;

        // Constants
        const PI = Math.PI;

        // Fluid Data (Freezing Point C, Density kg/m3, Cp J/kgK)
        const fluidDB = {
            'water': { freeze: 0, rho: 1000, cp: 4186, name: 'Water' },
            'caustic': { freeze: 12, rho: 1500, cp: 3000, name: 'Caustic Soda (50%)' },
            'benzene': { freeze: 5.5, rho: 876, cp: 1700, name: 'Benzene' }
        };

        // Insulation Data (Thermal Conductivity k in W/mK)
        const insDB = {
            'fiberglass': { k: 0.04, name: 'Fiberglass' },
            'mineral_wool': { k: 0.045, name: 'Mineral Wool' },
            'aerogel': { k: 0.015, name: 'Aerogel (Pyrogel)' },
            'none': { k: 100, name: 'None' } // High k for calc structure
        };

        function loadPreset(type) {
            if (type === 'uninsulated') {
                document.getElementById('tube-size').value = '0.5';
                document.getElementById('ins-type').value = 'none';
                document.getElementById('ins-thick').value = '0';
                document.getElementById('amb-temp').value = '-5';
                document.getElementById('wind-speed').value = '10';
            } else if (type === 'standard_ins') {
                document.getElementById('tube-size').value = '0.5';
                document.getElementById('ins-type').value = 'fiberglass';
                document.getElementById('ins-thick').value = '25';
                document.getElementById('amb-temp').value = '-10';
                document.getElementById('wind-speed').value = '5';
            } else if (type === 'arctic') {
                document.getElementById('tube-size').value = '0.5';
                document.getElementById('ins-type').value = 'aerogel';
                document.getElementById('ins-thick').value = '15';
                document.getElementById('amb-temp').value = '-40';
                document.getElementById('wind-speed').value = '15';
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Theme handling
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function performCalculation() {
            // 1. Get Inputs
            const d_tube_in = parseFloat(document.getElementById('tube-size').value);
            const tube_mat = document.getElementById('tube-mat').value;
            const fluidKey = document.getElementById('fluid-type').value;
            const t_init = parseFloat(document.getElementById('init-temp').value);
            const t_amb = parseFloat(document.getElementById('amb-temp').value);
            const wind = parseFloat(document.getElementById('wind-speed').value);
            const insKey = document.getElementById('ins-type').value;
            const t_ins_mm = parseFloat(document.getElementById('ins-thick').value);

            if (isNaN(t_init) || isNaN(t_amb) || isNaN(wind)) {
                displayMessage("Please enter valid numbers.", "error");
                return;
            }

            // 2. Physics Engine
            const fluid = fluidDB[fluidKey];
            const ins = insDB[insKey];

            // Dimensions
            const r_tube_out_m = (d_tube_in * 0.0254) / 2; // Radius OD
            const r_tube_in_m = r_tube_out_m - 0.00124; // Wall approx 0.049"
            
            // Insulation
            const r_ins_out_m = r_tube_out_m + (t_ins_mm / 1000);

            // Thermal Resistance
            // 1. Convection (Outside)
            // h_conv approx = 10 + 4 * wind (Linear approx for cylinder)
            // Or better: Nu = C Re^n... simplified wind chill:
            const h_conv = 10 + (3.5 * wind); 
            const R_conv = 1 / (2 * PI * r_ins_out_m * h_conv);

            // 2. Conduction (Insulation)
            let R_ins = 0;
            if (insKey !== 'none') {
                R_ins = Math.log(r_ins_out_m / r_tube_out_m) / (2 * PI * ins.k);
            }

            // Total R (K*m/W)
            const R_total = R_conv + R_ins;

            // Heat Loss Q (W/m)
            const delta_T = t_init - t_amb;
            const Q_wm = delta_T / R_total;

            // Time to Freeze
            // Mass per meter
            const Vol_fluid = PI * Math.pow(r_tube_in_m, 2) * 1.0;
            const m_fluid = Vol_fluid * fluid.rho;
            const m_tube = (PI * (Math.pow(r_tube_out_m,2) - Math.pow(r_tube_in_m,2))) * 8000; // Steel
            
            const Cp_fluid = fluid.cp;
            const Cp_tube = 500; // Steel

            const mCp_total = (m_fluid * Cp_fluid) + (m_tube * Cp_tube); // J/K per meter

            // Time Constant Tau = mCp * R_total
            const tau = mCp_total * R_total; // Seconds

            // Time to reach freeze point
            // T(t) = Tamb + (Tinit - Tamb) * exp(-t/tau)
            // Tfreeze - Tamb = (Tinit - Tamb) * exp
            // ln(...) = -t/tau
            let time_freeze_min = 9999;
            
            if (t_amb < fluid.freeze) {
                const ratio = (fluid.freeze - t_amb) / (t_init - t_amb);
                if (ratio > 0 && ratio < 1) {
                    const t_sec = -tau * Math.log(ratio);
                    time_freeze_min = t_sec / 60;
                } else if (ratio <= 0) {
                    time_freeze_min = 0; // Already frozen
                }
            } else {
                time_freeze_min = Infinity; // Won't freeze
            }

            // Required Tracing
            // Q_maintain = (T_maintain - T_amb) / R_total
            // Maintain at Freeze + 5C safety
            const t_maintain = fluid.freeze + 5;
            const Q_req = (t_maintain - t_amb) / R_total;
            const Q_rec = Q_req * 1.25; // 25% safety factor

            lastResult = { Q_wm, time_freeze_min, tau, mCp_total, R_total, Q_rec, fluid, ins, t_init, t_amb, wind };

            // 4. Render Step-by-Step
            let html = `<h4>Step 1: Geometry & Thermal Resistance</h4>`;
            html += `<div class="calculation-step">`;
            html += `Pipe OD: ${(r_tube_out_m*2000).toFixed(1)} mm. Insulation: ${t_ins_mm} mm (${ins.name}).<br>`;
            html += `Wind Coeff ($h_{conv}$): ${h_conv.toFixed(1)} W/m²K.<br>`;
            if (insKey !== 'none') {
                html += `$$ R_{ins} = \\frac{\\ln(r_o/r_i)}{2\\pi k} = \\frac{\\ln(${(r_ins_out_m/r_tube_out_m).toFixed(2)})}{2\\pi (${ins.k})} = ${R_ins.toFixed(2)} \\text{ Km/W} $$<br>`;
            }
            html += `$$ R_{total} = R_{ins} + R_{conv} = \\mathbf{${R_total.toFixed(2)} \\text{ Km/W}} $$`;
            html += `</div>`;

            html += `<h4>Step 2: Heat Loss ($Q$)</h4>`;
            html += `<div class="calculation-step">`;
            html += `At initial temp ${t_init}°C (Ambient ${t_amb}°C):<br>`;
            html += `$$ Q = \\frac{\\Delta T}{R_{total}} = \\frac{${delta_T.toFixed(1)}}{${R_total.toFixed(2)}} = \\mathbf{${Q_wm.toFixed(1)} \\text{ W/m}} $$`;
            html += `</div>`;

            html += `<h4>Step 3: Time to Freeze</h4>`;
            html += `<div class="calculation-step">`;
            html += `Thermal Mass ($mC_p$): ${mCp_total.toFixed(1)} J/mK.<br>`;
            html += `Time Constant ($\\tau$): ${(tau/60).toFixed(1)} min.<br>`;
            if (time_freeze_min === Infinity) {
                html += `<strong style="color:var(--success)">Ambient is above freezing. No risk.</strong>`;
            } else {
                html += `$$ t = -\\tau \\ln \\left( \\frac{T_{frz} - T_{amb}}{T_{init} - T_{amb}} \\right) = \\mathbf{${time_freeze_min.toFixed(0)} \\text{ min}} $$`;
            }
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;

            // 5. Update Table
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, u, c="") => {
                tbody.innerHTML += `<tr style="${c ? 'color:'+c : ''}"><td><strong>${n}</strong></td><td>${v}</td><td>${u}</td></tr>`;
            };
            addRow("Initial Heat Loss", Q_wm.toFixed(1), "W/m");
            addRow("Time to Freeze", time_freeze_min === Infinity ? "Never" : time_freeze_min.toFixed(0), "min", time_freeze_min < 60 ? "var(--danger)" : "");
            addRow("Trace Power Req", Q_rec.toFixed(1), "W/m", "var(--primary)");

            const interpEl = document.getElementById('interpretation-text');
            if (time_freeze_min < 30) {
                interpEl.innerHTML = `<span style="color:var(--danger); font-weight:bold;">CRITICAL RISK.</span> Line freezes in < 30 mins. Immediate heating required.`;
            } else if (time_freeze_min < 120) {
                interpEl.innerHTML = `<span style="color:var(--warning); font-weight:bold;">High Risk.</span> Freezes in < 2 hours. Insulation mandatory.`;
            } else {
                interpEl.innerHTML = `Stable.`;
            }

            // 6. Visuals
            drawChart(t_init, t_amb, fluid.freeze, tau);
            drawPipe(r_tube_out_m*1000, t_ins_mm, Q_wm);

            // 7. Show
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        function drawChart(T_init, T_amb, T_freeze, tau) {
            const ctx = document.getElementById('coolingChart').getContext('2d');
            if (window.myChart) window.myChart.destroy();

            const labels = [];
            const data = [];
            const dataFrz = [];
            const duration = tau * 4; // 4 time constants
            const steps = 50;

            for(let i=0; i<=steps; i++) {
                const t = (duration/steps)*i;
                labels.push((t/60).toFixed(0)); // mins
                const T = T_amb + (T_init - T_amb) * Math.exp(-t/tau);
                data.push(T);
                dataFrz.push(T_freeze);
            }

            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Fluid Temp',
                            data: data,
                            borderColor: '#3B82F6',
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: 'Freezing Point',
                            data: dataFrz,
                            borderColor: '#EF4444',
                            borderWidth: 2,
                            borderDash: [5,5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: {display:true, text:'Time (min)'} },
                        y: { title: {display:true, text:'Temp (°C)'} }
                    }
                }
            });
        }

        function drawPipe(d_od, th_ins, Q) {
            const canvas = document.getElementById('pipeCanvas');
            const ctx = canvas.getContext('2d');
            const cw = canvas.width;
            const ch = canvas.height;

            ctx.clearRect(0, 0, cw, ch);
            const cx = cw/2;
            const cy = ch/2;

            // Scale: let total dia fill 200px
            const total_dia = d_od + (2*th_ins);
            const scale = 180 / total_dia;

            // Insulation
            if (th_ins > 0) {
                ctx.fillStyle = '#FEF3C7'; // Amber tint
                ctx.beginPath();
                ctx.arc(cx, cy, (total_dia/2)*scale, 0, 2*PI);
                ctx.fill();
                ctx.strokeStyle = '#F59E0B';
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // Pipe
            ctx.fillStyle = '#9CA3AF'; // Steel
            ctx.beginPath();
            ctx.arc(cx, cy, (d_od/2)*scale, 0, 2*PI);
            ctx.fill();
            ctx.strokeStyle = '#374151';
            ctx.stroke();

            // Arrows (Heat Loss)
            ctx.strokeStyle = '#EF4444';
            ctx.lineWidth = 2;
            const r_start = (d_od/2)*scale;
            const r_end = (total_dia/2)*scale + 30;
            
            for(let i=0; i<8; i++) {
                const ang = (i * 45) * (PI/180);
                const x1 = cx + Math.cos(ang)*r_start;
                const y1 = cy + Math.sin(ang)*r_start;
                const x2 = cx + Math.cos(ang)*r_end;
                const y2 = cy + Math.sin(ang)*r_end;
                
                // Draw arrow out
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
                
                // Head
                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x2 - 5*Math.cos(ang-0.5), y2 - 5*Math.sin(ang-0.5));
                ctx.stroke();
            }

            ctx.fillStyle = '#EF4444';
            ctx.font = 'bold 14px Inter';
            ctx.fillText(`Q = ${Q.toFixed(1)} W/m`, cx - 40, cy + (total_dia/2)*scale + 20);
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(30, 58, 138); 
            pdf.text('Freeze Protection Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. Design Inputs', 14, y);
            y += 5;

            const inputData = [
                ['Fluid', lastResult.fluid.name],
                ['Freezing Point', `${lastResult.fluid.freeze} °C`],
                ['Ambient Temp', `${lastResult.t_amb} °C`],
                ['Insulation', lastResult.ins.name],
                ['Wind Speed', `${lastResult.wind} m/s`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. Analysis', 14, y);
            y += 5;

            const resData = [
                ['Heat Loss', `${lastResult.Q_wm.toFixed(2)} W/m`],
                ['Time Constant', `${(lastResult.tau/60).toFixed(1)} min`],
                ['Time to Freeze', lastResult.time_freeze_min === Infinity ? '> 24h' : `${lastResult.time_freeze_min.toFixed(0)} min`],
                ['Rec. Trace Power', `${lastResult.Q_rec.toFixed(1)} W/m`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] },
                didParseCell: function(data) {
                    if(data.row.index === 2) {
                        data.cell.styles.fontStyle = 'bold';
                    }
                }
            });

            pdf.save('Freeze_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }
    </script>
</body>
</html>
