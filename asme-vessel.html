<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASME VIII Industrial Pressure Vessel Calculator</title>
    <meta name="description" content="Professional ASME Section VIII Div 1 calculator for cylindrical shells, spherical shells, and 2:1 elliptical, hemispherical, and torispherical dished heads.">
    <meta name="keywords" content="ASME calculator, pressure vessel, UG-27, UG-32, elliptical head, torispherical head, MAWP, required thickness">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/asme-vessel.html" />

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-23Y1V450SR');
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">

    <style>
        /* Keyframe animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        /* CSS Variables for theming (light and dark mode) */
        :root {
            --primary-color: #1E3A8A; /* Dark Blue */
            --secondary-color: #2563EB; /* Bright Blue */
            --accent-color: #F59E0B; /* Amber */
            --success-color: #10B981; /* Green */
            --error-color: #EF4444; /* Red */
            --bg-color: #F8FAFC; /* Light Gray */
            --card-bg: #FFFFFF; /* White */
            --text-color: #4B5563; /* Gray */
            --heading-color: #111827; /* Dark Gray */
            --footer-bg: #0F172A; /* Very Dark Blue */
            --border-color: #E2E8F0; /* Light Gray Border */
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --primary-color-rgb: 30, 58, 138; /* For box-shadow */
        }
        /* Dark mode overrides */
        body.dark-mode {
            --primary-color: #10B981; /* Green */
            --secondary-color: #34D399; /* Light Green */
            --bg-color: #0F172A; /* Very Dark Blue */
            --card-bg: #1E293B; /* Dark Blue-Gray */
            --text-color: #CBD5E1; /* Light Gray */
            --heading-color: #F1F5F9; /* Off-White */
            --footer-bg: #020617; /* Near Black */
            --border-color: #334155; /* Mid Gray */
            --primary-color-rgb: 16, 185, 129; /* For box-shadow */
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
            transition: background-color 0.3s, color 0.3s;
            margin: 0;
            padding: 0;
        }
        /* Container for content width limitation and centering */
        .container {
            max-width: 1280px; /* Wider container for professional look */
            margin: 0 auto;
            padding: 0 24px;
        }
        /* HEADER */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            animation: slideIn 0.5s ease;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }
        .nav-links a:hover {
            color: var(--accent-color);
            transform: translateY(-2px);
        }
        /* Theme toggle switch styling */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .theme-toggle .icon {
            color: white;
            font-size: 1.2rem;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent-color);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Main content area styling */
        main {
            padding: 40px 0;
            max-width: 1000px; /* Max-width for the tool itself */
            margin: 0 auto;
        }
        /* Tool container styling */
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease;
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
        }
        .tool-description {
            margin-bottom: 25px;
            font-size: 1rem;
            line-height: 1.8;
        }
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }
        .tool-description strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        /* Calculator form styling */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
        }
        .form-group {
            margin-bottom: 20px;
            animation: slideIn 0.5s ease;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading-color);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 12px rgba(var(--primary-color-rgb), 0.25);
            outline: none;
            transform: scale(1.02);
        }
        /* Responsive form row layout */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        /* Calculate button styling */
        .calculate-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--gradient-primary);
            color: white;
            flex: 1;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(var(--primary-color-rgb), 0.3);
            width: 100%; /* Full width */
            margin-top: 20px;
        }
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(var(--primary-color-rgb), 0.4);
            animation: pulse 0.6s ease;
        }
        /* Result container styling */
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }
        .result-container.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
        }
        /* Result table styling */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
            animation: fadeInUp 0.8s ease;
        }
        .result-table th, .result-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 700;
        }
        .result-table tr:nth-child(even) {
            background-color: var(--bg-color); /* Use bg-color for striping */
        }
        .result-table tr:hover {
            background-color: rgba(var(--primary-color-rgb), 0.1);
            transform: scale(1.01);
            transition: all 0.3s;
        }
        /* Standard reference text styling */
        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            padding: 15px;
            background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.05));
            border-left: 4px solid var(--accent-color);
            border-radius: 6px;
            line-height: 1.7;
            animation: fadeInUp 0.9s ease;
        }
        /* Tooltip styling */
        .info-icon {
            color: var(--primary-color);
            margin-left: 6px;
            cursor: help;
            transition: transform 0.3s;
        }
        .info-icon:hover {
            transform: scale(1.2) rotate(10deg);
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 260px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 130%;
            left: 50%;
            margin-left: -130px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            white-space: normal;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        /* Custom message box for alerts */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #custom-message-box.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        #custom-message-box.info {
            background-color: var(--success-color);
        }
        #custom-message-box.error {
            background-color: var(--error-color);
        }
        #custom-message-box.warning {
            background-color: var(--accent-color);
            color: #333;
        }

        /* Calculation details section styling */
        #calculation-details {
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            animation: fadeInUp 0.7s ease;
            overflow-x: auto; /* Allow horizontal scrolling for formulas */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            text-align: center;
            padding: 15px;
            background: linear-gradient(90deg, transparent, rgba(var(--primary-color-rgb), 0.05), transparent);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            white-space: nowrap; /* Keep formulas on one line */
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--card-bg);
            padding: 10px 12px;
            border-radius: 4px;
            border-left: 4px solid var(--secondary-color);
            margin-bottom: 10px;
            overflow-x: auto;
            white-space: nowrap; /* Keep steps on one line */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        /* Specific styling for required inputs */
        input:required:invalid {
            border-color: var(--error-color);
        }
        input:required:valid {
            border-color: var(--success-color);
        }

        /* Styling specific to ASME Calculator */
        .calculation-mode-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        .calculation-mode-option {
            flex: 1 1 calc(50% - 10px);
            min-width: 200px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--bg-color);
        }
        .calculation-mode-option.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--secondary-color);
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.4);
            transform: translateY(-3px);
        }
        .calculation-mode-option:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .calculation-mode-option input[type="radio"] {
            display: none;
        }
        .calculation-mode-option label {
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 0;
            color: inherit;
        }
        .form-section {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            background-color: var(--bg-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        .form-section h3 {
            margin-top: 0;
            color: var(--secondary-color);
            border-bottom: 1px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        /* FOOTER */
        footer {
            background: var(--gradient-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 40px; /* Added margin */
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col ul li {
            margin-bottom: 10px;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: all 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent-color);
            transform: translateX(3px);
        }
        .footer-disclaimer {
            text-align: center;
            margin: 30px auto;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        .creator-name {
            color: var(--secondary-color);
            font-weight: bold;
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            text-decoration: none;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }

        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .calculation-mode-option { flex: 1 1 100%; }
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                </a>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href='/articles.html'>Articles</a></li>
                    <li><a href='/indexmech.html'>Mechanical</a></li>
                    <li><a href='/indexele.html'>Electrical</a></li>
                    <li><a href='/indexinst.html'>Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun icon"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon icon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Back button was here, now removed as requested -->
        
        <div class="tool-container">
            <h2>ASME Section VIII Div 1 Pressure Vessel Calculator</h2>
            <div class="tool-description">
                <p>This calculator determines the required wall thickness for a given internal design pressure, or the Maximum Allowable Working Pressure (MAWP) for a given wall thickness, based on <strong>ASME Boiler and Pressure Vessel Code, Section VIII, Division 1</strong>.</p>
                <p><strong>Calculations cover:</strong></p>
                <ul>
                    <li><strong>Cylindrical Shells</strong> (Part UG-27)</li>
                    <li><strong>Spherical Shells</strong> (Part UG-27)</li>
                    <li><strong>Hemispherical Heads</strong> (Part UG-32(b))</li>
                    <li><strong>2:1 Elliptical Heads</strong> (Part UG-32(c))</li>
                    <li><strong>Torispherical Heads</strong> (Part UG-32(d))</li>
                </ul>
                <p><strong>Units:</strong> Ensure consistency. If you use mm for length, use MPa for pressure and stress. If inches, use psi.</p>
                <p><strong>Disclaimer:</strong> This tool is for preliminary assessment and educational purposes. A detailed design must always be conducted by a qualified engineer using the full ASME BPVC code.</p>
            </div>

            <div class="calculator-form">
                <form id="asme-calculator-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (mm, MPa) or Imperial (inches, psi) units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (mm, MPa)</option>
                                <option value="imperial">Imperial (inches, psi)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vessel-type">Vessel Component: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the shell or head type.</span></span></label>
                            <select id="vessel-type" required>
                                <option value="cylinder">Cylindrical Shell</option>
                                <option value="sphere">Spherical Shell</option>
                                <option value="elliptical-head">Elliptical Head (2:1)</option>
                                <option value="hemispherical-head">Hemispherical Head</option>
                                <option value="torispherical-head">Torispherical Head</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Calculation Mode</h3>
                        <div class="calculation-mode-options">
                            <div class="calculation-mode-option" data-mode="thickness">
                                <input type="radio" id="mode-thickness" name="calculationMode" value="thickness" checked>
                                <label for="mode-thickness">Calculate Required Thickness</label>
                            </div>
                            <div class="calculation-mode-option" data-mode="mawp">
                                <input type="radio" id="mode-mawp" name="calculationMode" value="mawp">
                                <label for="mode-mawp">Calculate MAWP</label>
                            </div>
                        </div>
                    </div>

                    <div id="common-parameters-section" class="form-section">
                        <h3>Common Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="material-allowable-stress">Material Allowable Stress (S) <span class="stress-unit-label">(MPa)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum allowable stress value for the material at design temperature, from ASME Section II.</span></span></label>
                                <input type="number" id="material-allowable-stress" step="0.1" value="138" required>
                            </div>
                            <div class="form-group">
                                <label for="joint-efficiency">Joint Efficiency (E): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Weld joint efficiency (from ASME UW-12). Use 1.0 for seamless heads.</span></span></label>
                                <input type="number" id="joint-efficiency" step="0.01" min="0.1" max="1.0" value="1.0" required>
                            </div>
                        </div>
                        <div class="form-row">
                             <div class="form-group">
                                <label for="internal-diameter">Internal Diameter (ID or D) <span class="length-unit-label">(mm)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inside diameter of the shell or head skirt.</span></span></label>
                                <input type="number" id="internal-diameter" step="0.1" value="1000" required>
                            </div>
                            <div class="form-group">
                                <label for="corrosion-allowance">Corrosion Allowance (CA) <span class="length-unit-label">(mm)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Additional thickness added for corrosion.</span></span></label>
                                <input type="number" id="corrosion-allowance" step="0.01" value="1.5" required>
                            </div>
                        </div>
                    </div>

                    <!-- New section for Torispherical Head inputs -->
                    <div id="torispherical-head-inputs" class="form-section" style="display: none;">
                        <h3>Torispherical Head Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="crown-radius">Crown Radius (L) <span class="length-unit-label">(mm)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inside crown radius of the head. Often equal to ID.</span></span></label>
                                <input type="number" id="crown-radius" step="0.1" value="1000">
                            </div>
                            <div class="form-group">
                                <label for="knuckle-radius">Knuckle Radius (r) <span class="length-unit-label">(mm)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inside knuckle radius of the head. Often 10% of ID.</span></span></label>
                                <input type="number" id="knuckle-radius" step="0.1" value="100">
                            </div>
                        </div>
                    </div>

                    <div id="thickness-mode-inputs">
                        <div class="form-section">
                            <h3>Required Thickness Calculation Inputs</h3>
                            <div class="form-group">
                                <label for="design-pressure">Design Pressure (P) <span class="pressure-unit-label">(MPa)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal design pressure of the vessel.</span></span></label>
                                <input type="number" id="design-pressure" step="0.01" value="1.0" required>
                            </div>
                        </div>
                    </div>

                    <div id="mawp-mode-inputs" style="display: none;">
                        <div class="form-section">
                            <h3>MAWP Calculation Inputs</h3>
                            <div class="form-group">
                                <label for="nominal-thickness">Nominal Thickness (t_nom) <span class="length-unit-label">(mm)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Nominal or measured thickness of the vessel shell.</span></span></label>
                                <input type="number" id="nominal-thickness" step="0.1" value="10" required>
                            </div>
                        </div>
                    </div>

                    <button type="button" id="calculate-asme-btn" class="calculate-btn">
                        <i class="fas fa-calculator"></i> Calculate
                    </button>
                </form>
            </div>

            <div id="result-container" class="result-container">
                <h3><i class="fas fa-chart-line"></i> Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">The world's first comprehensive engineering calculator hub based on IEC, IEEE, ISA, ASME, and API standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href='/indexele.html'>Electrical</a></li>
                        <li><a href='/indexmech.html'>Mechanical</a></li>
                        <li><a href='/indexinst.html'>Instrumentation</a></li>                        
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href='/about.html'>About Us</a></li>
                        <li><a href='/contact.html'>Contact</a></li>
                        <li><a href='/faq.html'>FAQ</a></li>
                        <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                        <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles.html'>Articles</a></li>
                        <li><a href='/sitemap2.html'>Sitemap</a></li>
                        <li><a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer">YouTube Channel</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-disclaimer">
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines. This tool is for educational and preliminary assessment purposes. A detailed design must always be conducted by a qualified engineer.</p>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box Placeholder -->
    <div id="custom-message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to DOM elements
            const calculateBtn = document.getElementById('calculate-asme-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            // Input fields
            const unitSystemSelect = document.getElementById('unit-system');
            const vesselTypeSelect = document.getElementById('vessel-type');
            const calculationModeOptions = document.querySelectorAll('.calculation-mode-option');
            const thicknessModeInputs = document.getElementById('thickness-mode-inputs');
            const mawpModeInputs = document.getElementById('mawp-mode-inputs');

            const materialAllowableStressInput = document.getElementById('material-allowable-stress');
            const jointEfficiencyInput = document.getElementById('joint-efficiency');
            const internalDiameterInput = document.getElementById('internal-diameter');
            const corrosionAllowanceInput = document.getElementById('corrosion-allowance');
            const designPressureInput = document.getElementById('design-pressure');
            const nominalThicknessInput = document.getElementById('nominal-thickness');

            // New inputs for Torispherical heads
            const torisphericalInputs = document.getElementById('torispherical-head-inputs');
            const crownRadiusInput = document.getElementById('crown-radius');
            const knuckleRadiusInput = document.getElementById('knuckle-radius');

            // Unit labels
            const lengthUnitLabels = document.querySelectorAll('.length-unit-label');
            const stressUnitLabels = document.querySelectorAll('.stress-unit-label');
            const pressureUnitLabels = document.querySelectorAll('.pressure-unit-label');

            /** * Displays a custom message box at the top of the screen.             
             * @param {string} message - The message to display.             
             * @param {string} type - The type of message ('info', 'error', 'warning').             
             */
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add(type); // Add type class for styling
                messageBox.classList.add('show'); // Add show class to trigger animation

                // Hide message after 5 seconds
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 5000);
            }

            /** * Updates the unit labels in the UI based on the selected unit system.             
             */
            function updateUnitLabels() {
                const unitSystem = unitSystemSelect.value;
                const lengthUnit = unitSystem === 'imperial' ? '(in.)' : '(mm)';
                const stressUnit = unitSystem === 'imperial' ? '(psi)' : '(MPa)';
                const pressureUnit = unitSystem === 'imperial' ? '(psi)' : '(MPa)';

                lengthUnitLabels.forEach(label => label.textContent = lengthUnit);
                stressUnitLabels.forEach(label => label.textContent = stressUnit);
                pressureUnitLabels.forEach(label => label.textContent = pressureUnit);

                // Update input step values for better user experience based on units
                materialAllowableStressInput.step = unitSystem === 'imperial' ? '100' : '0.1';
                internalDiameterInput.step = unitSystem === 'imperial' ? '0.1' : '1';
                corrosionAllowanceInput.step = unitSystem === 'imperial' ? '0.001' : '0.01';
                designPressureInput.step = unitSystem === 'imperial' ? '1' : '0.01';
                nominalThicknessInput.step = unitSystem === 'imperial' ? '0.001' : '0.01';
                crownRadiusInput.step = unitSystem === 'imperial' ? '0.1' : '1';
                knuckleRadiusInput.step = unitSystem === 'imperial' ? '0.1' : '1';

                // Update default values based on units
                if (unitSystem === 'imperial') {
                    if(materialAllowableStressInput.value === "138") materialAllowableStressInput.value = "20000";
                    if(internalDiameterInput.value === "1000") internalDiameterInput.value = "40";
                    if(corrosionAllowanceInput.value === "1.5") corrosionAllowanceInput.value = "0.0625";
                    if(designPressureInput.value === "1.0") designPressureInput.value = "150";
                    if(nominalThicknessInput.value === "10") nominalThicknessInput.value = "0.5";
                    if(crownRadiusInput.value === "1000") crownRadiusInput.value = "40";
                    if(knuckleRadiusInput.value === "100") knuckleRadiusInput.value = "4";
                } else {
                    if(materialAllowableStressInput.value === "20000") materialAllowableStressInput.value = "138";
                    if(internalDiameterInput.value === "40") internalDiameterInput.value = "1000";
                    if(corrosionAllowanceInput.value === "0.0625") corrosionAllowanceInput.value = "1.5";
                    if(designPressureInput.value === "150") designPressureInput.value = "1.0";
                    if(nominalThicknessInput.value === "0.5") nominalThicknessInput.value = "10";
                    if(crownRadiusInput.value === "40") crownRadiusInput.value = "1000";
                    if(knuckleRadiusInput.value === "4") knuckleRadiusInput.value = "100";
                }
            }

            /** * Toggles visibility of input sections based on selected calculation mode.             
             */
            function toggleCalculationModeInputs() {
                const selectedMode = document.querySelector('input[name="calculationMode"]:checked').value;
                if (selectedMode === 'thickness') {
                    thicknessModeInputs.style.display = 'block';
                    mawpModeInputs.style.display = 'none';
                    designPressureInput.setAttribute('required', 'true');
                    nominalThicknessInput.removeAttribute('required');
                } else { // mawp mode
                    thicknessModeInputs.style.display = 'none';
                    mawpModeInputs.style.display = 'block';
                    nominalThicknessInput.setAttribute('required', 'true');
                    designPressureInput.removeAttribute('required');
                }
            }

            /**
             * Toggles visibility of head-specific inputs
             */
            function toggleHeadInputs() {
                const vesselType = vesselTypeSelect.value;
                if (vesselType === 'torispherical-head') {
                    torisphericalInputs.style.display = 'block';
                    crownRadiusInput.setAttribute('required', 'true');
                    knuckleRadiusInput.setAttribute('required', 'true');
                } else {
                    torisphericalInputs.style.display = 'none';
                    crownRadiusInput.removeAttribute('required');
                    knuckleRadiusInput.removeAttribute('required');
                }
            }

            // Event listeners
            unitSystemSelect.addEventListener('change', updateUnitLabels);
            vesselTypeSelect.addEventListener('change', toggleHeadInputs);

            calculationModeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    calculationModeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input[type="radio"]').checked = true;
                    toggleCalculationModeInputs();
                });
            });

            // Initial UI update on load
            updateUnitLabels();
            document.querySelector('.calculation-mode-option[data-mode="thickness"]').classList.add('selected');
            toggleCalculationModeInputs();
            toggleHeadInputs();

            /** * Adds a row to the result table.             
             * @param {string} parameterHtml - The HTML content for the parameter column.             
             * @param {string} valueHtml - The HTML content for the value column.             
             */
            function addResultRow(parameterHtml, valueHtml) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameterHtml;
                valueCell.innerHTML = valueHtml;
            }

            // Event listener for the calculate button
            calculateBtn.addEventListener('click', function() {
                const form = document.getElementById('asme-calculator-form');
                if (!form.checkValidity()) {
                    displayMessage("Please fill in all required fields correctly.", "error");
                    form.reportValidity();
                    return;
                }

                // Gather inputs
                const unitSystem = unitSystemSelect.value;
                const S = parseFloat(materialAllowableStressInput.value);
                const E = parseFloat(jointEfficiencyInput.value);
                const ID = parseFloat(internalDiameterInput.value);
                const CA = parseFloat(corrosionAllowanceInput.value);
                const vesselType = vesselTypeSelect.value;
                const calculationMode = document.querySelector('input[name="calculationMode"]:checked').value;
                const unit_len = unitSystem === 'imperial' ? 'in.' : 'mm';
                const unit_press = unitSystem === 'imperial' ? 'psi' : 'MPa';

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                resultTableBody.innerHTML = ''; // Clear previous results

                // Common calculations
                const R_internal = ID / 2; // Internal radius
                const D_internal = ID; // Internal diameter

                // Basic validation
                if (S <= 0 || E <= 0 || ID <= 0 || CA < 0 || E > 1) {
                    displayMessage("Please enter valid positive values for all parameters. Joint efficiency must be <= 1.0.", "error");
                    return;
                }
                
                let vesselTypeName = 'Unknown';
                switch(vesselType) {
                    case 'cylinder': vesselTypeName = 'Cylindrical Shell'; break;
                    case 'sphere': vesselTypeName = 'Spherical Shell'; break;
                    case 'elliptical-head': vesselTypeName = 'Elliptical Head (2:1)'; break;
                    case 'hemispherical-head': vesselTypeName = 'Hemispherical Head'; break;
                    case 'torispherical-head': vesselTypeName = 'Torispherical Head'; break;
                }

                addResultRow("Unit System", unitSystem === 'imperial' ? 'Imperial' : 'Metric');
                addResultRow("Vessel Component", vesselTypeName);
                addResultRow("Material Allowable Stress (S)", `${S} ${unit_press}`);
                addResultRow("Joint Efficiency (E)", E);
                addResultRow("Internal Diameter (D)", `${D_internal.toFixed(3)} ${unit_len}`);
                addResultRow("Internal Radius (R)", `${R_internal.toFixed(3)} ${unit_len}`);
                addResultRow("Corrosion Allowance (CA)", `${CA} ${unit_len}`);

                if (calculationMode === 'thickness') {
                    const P_design = parseFloat(designPressureInput.value);

                    if (P_design <= 0) {
                        displayMessage("Design Pressure must be a positive value.", "error");
                        return;
                    }
                    addResultRow("Design Pressure (P)", `${P_design} ${unit_press}`);
                    calculationHtml += `<p><strong>Calculation for Required Thickness (\\(t_{req}\\)):</strong></p>`;

                    let t_required_corroded;
                    let error = false;

                    switch (vesselType) {
                        case 'cylinder':
                            // UG-27(c)(1)
                            if ((S * E - 0.6 * P_design) <= 0) {
                                displayMessage("Calculation error: (SE - 0.6P) is zero or negative. Pressure is too high or material stress is too low.", "error");
                                error = true;
                                break;
                            }
                            t_required_corroded = (P_design * R_internal) / (S * E - 0.6 * P_design);
                            calculationHtml += `<p class="formula">For Cylindrical Shell (ASME UG-27(c)(1)):</p>`;
                            calculationHtml += `<p class="formula">\\[ t_{req,corroded} = \\frac{P R}{SE - 0.6P} \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(t_{req,corroded}\\) = (${P_design} &times; ${R_internal.toFixed(3)}) / (${S} &times; ${E} - 0.6 &times; ${P_design}) = ${t_required_corroded.toFixed(4)} ${unit_len}</p>`;
                            break;
                        
                        case 'sphere':
                        case 'hemispherical-head':
                            // UG-27(d)(1) for Sphere, UG-32(b) for Hemi-Head (uses L=R)
                            if ((2 * S * E - 0.2 * P_design) <= 0) {
                                displayMessage("Calculation error: (2SE - 0.2P) is zero or negative. Pressure is too high or material stress is too low.", "error");
                                error = true;
                                break;
                            }
                            // Note: R_internal is R (for sphere) or L (for hemi-head)
                            t_required_corroded = (P_design * R_internal) / (2 * S * E - 0.2 * P_design);
                            calculationHtml += `<p class="formula">For Spherical/Hemi-Head (ASME UG-27(d)(1) / UG-32(b)):</p>`;
                            calculationHtml += `<p class="formula">\\[ t_{req,corroded} = \\frac{P R}{2SE - 0.2P} \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(t_{req,corroded}\\) = (${P_design} &times; ${R_internal.toFixed(3)}) / (2 &times; ${S} &times; ${E} - 0.2 &times; ${P_design}) = ${t_required_corroded.toFixed(4)} ${unit_len}</p>`;
                            break;

                        case 'elliptical-head':
                            // UG-32(c) for 2:1 Elliptical Head (uses D = D_internal)
                            if ((2 * S * E - 0.2 * P_design) <= 0) {
                                displayMessage("Calculation error: (2SE - 0.2P) is zero or negative. Pressure is too high or material stress is too low.", "error");
                                error = true;
                                break;
                            }
                            t_required_corroded = (P_design * D_internal) / (2 * S * E - 0.2 * P_design);
                            calculationHtml += `<p class="formula">For 2:1 Elliptical Head (ASME UG-32(c)):</p>`;
                            calculationHtml += `<p class="formula">\\[ t_{req,corroded} = \\frac{P D}{2SE - 0.2P} \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(t_{req,corroded}\\) = (${P_design} &times; ${D_internal.toFixed(3)}) / (2 &times; ${S} &times; ${E} - 0.2 &times; ${P_design}) = ${t_required_corroded.toFixed(4)} ${unit_len}</p>`;
                            break;

                        case 'torispherical-head':
                            // UG-32(d)
                            const L_crown = parseFloat(crownRadiusInput.value);
                            const r_knuckle = parseFloat(knuckleRadiusInput.value);
                            if (L_crown <= 0 || r_knuckle <= 0) {
                                displayMessage("Crown Radius (L) and Knuckle Radius (r) must be positive values.", "error");
                                error = true;
                                break;
                            }
                            
                            const M = 0.25 * (3 + Math.sqrt(L_crown / r_knuckle));
                            if ((2 * S * E - 0.2 * P_design) <= 0) {
                                displayMessage("Calculation error: (2SE - 0.2P) is zero or negative. Pressure is too high or material stress is too low.", "error");
                                error = true;
                                break;
                            }
                            
                            t_required_corroded = (P_design * L_crown * M) / (2 * S * E - 0.2 * P_design);
                            
                            addResultRow("Crown Radius (L)", `${L_crown} ${unit_len}`);
                            addResultRow("Knuckle Radius (r)", `${r_knuckle} ${unit_len}`);
                            addResultRow("Shape Factor (M)", `${M.toFixed(4)}`);
                            calculationHtml += `<p class="formula">For Torispherical Head (ASME UG-32(d)):</p>`;
                            calculationHtml += `<p class="formula">\\[ M = \\frac{1}{4} \\left( 3 + \\sqrt{\\frac{L}{r}} \\right) \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(M\\) = 0.25 &times; (3 + &radic;(${L_crown} / ${r_knuckle})) = ${M.toFixed(4)}</p>`;
                            calculationHtml += `<p class="formula">\\[ t_{req,corroded} = \\frac{P L M}{2SE - 0.2P} \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(t_{req,corroded}\\) = (${P_design} &times; ${L_crown} &times; ${M.toFixed(4)}) / (2 &times; ${S} &times; ${E} - 0.2 &times; ${P_design}) = ${t_required_corroded.toFixed(4)} ${unit_len}</p>`;
                            break;
                    }
                    
                    if(error) return; // Stop if calculation failed

                    if (t_required_corroded < 0) {
                        displayMessage("Calculated required thickness is negative. Check inputs.", "error");
                        return;
                    }

                    // Add corrosion allowance to get nominal thickness
                    const t_required_nominal = t_required_corroded + CA;

                    addResultRow("Required Thickness (Corroded)", `\\( ${t_required_corroded.toFixed(4)} \\) ${unit_len}`);
                    addResultRow("Required Thickness (Nominal)", `<strong>\\( ${t_required_nominal.toFixed(4)} \\) ${unit_len}</strong>`);
                    calculationHtml += `<p><strong>Add Corrosion Allowance for Nominal Thickness:</strong></p>`;
                    calculationHtml += `<p class="formula">\\[ t_{req,nominal} = t_{req,corroded} + CA \\]</p>`;
                    calculationHtml += `<p class="calculation-step">\\(t_{req,nominal}\\) = ${t_required_corroded.toFixed(4)} + ${CA} = ${t_required_nominal.toFixed(4)} ${unit_len}</p>`;

                } else { // mawp mode
                    const t_nominal = parseFloat(nominalThicknessInput.value);

                    if (t_nominal <= 0) {
                        displayMessage("Nominal Thickness must be a positive value.", "error");
                        return;
                    }
                    if (t_nominal <= CA) {
                         displayMessage("Nominal Thickness must be greater than Corrosion Allowance.", "error");
                         return;
                    }

                    const t_corroded = t_nominal - CA; // Corroded thickness for MAWP calculation
                    addResultRow("Nominal Thickness (t_nom)", `${t_nominal} ${unit_len}`);
                    addResultRow("Corroded Thickness (t_corr)", `${t_corroded.toFixed(4)} ${unit_len}`);
                    calculationHtml += `<p><strong>Calculate Corroded Thickness:</strong></p>`;
                    calculationHtml += `<p class="formula">\\[ t_{corroded} = t_{nominal} - CA \\]</p>`;
                    calculationHtml += `<p class="calculation-step">\\(t_{corroded}\\) = ${t_nominal} - ${CA} = ${t_corroded.toFixed(4)} ${unit_len}</p>`;
                    calculationHtml += `<p><strong>Calculation for Maximum Allowable Working Pressure (MAWP):</strong></p>`;

                    let mawp;
                    let error = false;

                    switch(vesselType) {
                        case 'cylinder':
                            // UG-27(c)(1) rearranged for P
                            mawp = (S * E * t_corroded) / (R_internal + 0.6 * t_corroded);
                            calculationHtml += `<p class="formula">For Cylindrical Shell (ASME UG-27(c)(1)):</p>`;
                            calculationHtml += `<p class="formula">\\[ MAWP = \\frac{SEt_{corroded}}{R + 0.6t_{corroded}} \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(MAWP\\) = (${S} &times; ${E} &times; ${t_corroded.toFixed(4)}) / (${R_internal.toFixed(3)} + 0.6 &times; ${t_corroded.toFixed(4)}) = ${mawp.toFixed(3)} ${unit_press}</p>`;
                            break;
                        
                        case 'sphere':
                        case 'hemispherical-head':
                            // UG-27(d)(1) / UG-32(b) rearranged for P
                            mawp = (2 * S * E * t_corroded) / (R_internal + 0.2 * t_corroded);
                            calculationHtml += `<p class="formula">For Spherical/Hemi-Head (ASME UG-27(d)(1) / UG-32(b)):</p>`;
                            calculationHtml += `<p class="formula">\\[ MAWP = \\frac{2SEt_{corroded}}{R + 0.2t_{corroded}} \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(MAWP\\) = (2 &times; ${S} &times; ${E} &times; ${t_corroded.toFixed(4)}) / (${R_internal.toFixed(3)} + 0.2 &times; ${t_corroded.toFixed(4)}) = ${mawp.toFixed(3)} ${unit_press}</p>`;
                            break;

                        case 'elliptical-head':
                            // UG-32(c) rearranged for P
                            mawp = (2 * S * E * t_corroded) / (D_internal + 0.2 * t_corroded);
                            calculationHtml += `<p class="formula">For 2:1 Elliptical Head (ASME UG-32(c)):</p>`;
                            calculationHtml += `<p class="formula">\\[ MAWP = \\frac{2SEt_{corroded}}{D + 0.2t_{corroded}} \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(MAWP\\) = (2 &times; ${S} &times; ${E} &times; ${t_corroded.toFixed(4)}) / (${D_internal.toFixed(3)} + 0.2 &times; ${t_corroded.toFixed(4)}) = ${mawp.toFixed(3)} ${unit_press}</p>`;
                            break;
                        
                        case 'torispherical-head':
                            // UG-32(d) rearranged
                            const L_crown = parseFloat(crownRadiusInput.value);
                            const r_knuckle = parseFloat(knuckleRadiusInput.value);
                            if (L_crown <= 0 || r_knuckle <= 0) {
                                displayMessage("Crown Radius (L) and Knuckle Radius (r) must be positive values.", "error");
                                error = true;
                                break;
                            }
                            
                            const M = 0.25 * (3 + Math.sqrt(L_crown / r_knuckle));
                            mawp = (2 * S * E * t_corroded) / (L_crown * M + 0.2 * t_corroded);

                            addResultRow("Crown Radius (L)", `${L_crown} ${unit_len}`);
                            addResultRow("Knuckle Radius (r)", `${r_knuckle} ${unit_len}`);
                            addResultRow("Shape Factor (M)", `${M.toFixed(4)}`);
                            calculationHtml += `<p class="formula">For Torispherical Head (ASME UG-32(d)):</p>`;
                            calculationHtml += `<p class="formula">\\[ M = \\frac{1}{4} \\left( 3 + \\sqrt{\\frac{L}{r}} \\right) \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(M\\) = 0.25 &times; (3 + &radic;(${L_crown} / ${r_knuckle})) = ${M.toFixed(4)}</p>`;
                            calculationHtml += `<p class="formula">\\[ MAWP = \\frac{2SEt_{corroded}}{LM + 0.2t_{corroded}} \\]</p>`;
                            calculationHtml += `<p class="calculation-step">\\(MAWP\\) = (2 &times; ${S} &times; ${E} &times; ${t_corroded.toFixed(4)}) / (${L_crown} &times; ${M.toFixed(4)} + 0.2 &times; ${t_corroded.toFixed(4)}) = ${mawp.toFixed(3)} ${unit_press}</p>`;
                            break;
                    }

                    if(error) return; // Stop if calculation failed

                    if (mawp < 0) {
                        displayMessage("Calculated MAWP is negative. Check inputs.", "error");
                        return;
                    }
                    addResultRow("Maximum Allowable Working Pressure (MAWP)", `<strong>\\( ${mawp.toFixed(3)} \\) ${unit_press}</strong>`);
                }

                calculationDetailsDiv.innerHTML = calculationHtml;
                // Re-render MathJax equations
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv, resultTableBody])
                        .catch(function (err) { console.log('MathJax error: ', err); });
                }

                standardReference.innerHTML = "This calculation is based on principles from <strong>ASME Boiler and Pressure Vessel Code, Section VIII, Division 1, Part UG-27 (Shells) and UG-32 (Dished Heads)</strong>. For full compliance and complex design scenarios (e.g., external pressure, fatigue, impact, nozzles, transient conditions), refer to the latest edition of the ASME BPVC and consult a qualified pressure vessel engineer.";
                
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth' });

                displayMessage("Calculation completed successfully!", "info");
            });

            // Theme switch functionality (from new header)
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                 if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }
        });
    </script>
</body>
</html>

