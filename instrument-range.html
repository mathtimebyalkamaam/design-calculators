<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instrument Rangeability & Span Calculator - Design Calculators - Instrumentation</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional calculator for instrument rangeability, span, and turndown. Verify transmitter settings (LRV, URV) against sensor limits (LRL, URL) and process requirements.">
    <meta name="keywords" content="instrument rangeability, span calculator, lrv urv, lrl url, turndown ratio, transmitter span, instrumentation, process control">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' },
            options: {
                processHtmlClass: 'math-content', // Process elements with this class
                ignoreHtmlClass: 'no-mathjax'     // Ignore elements with this class
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- PDF Generation (Included from header file, but not used by this specific tool) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    <style>
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        /* Applied to the tool container */
        .tool-container {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .tool-description {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.05rem;
        }
        h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
        }
        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
             box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .calculator-form {
            background-color: var(--card);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
         .form-section {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        .form-section h3 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn-group .btn {
            flex: 1;
            min-width: 150px;
        }
        .btn.secondary {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn.accent {
            background: var(--accent);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        

        /* CALCULATION STEPS DISPLAY */
        .steps-container {
            display: none;
            margin-top: 30px;
        }
        .steps-container.active {
            display: block;
        }
        .step-card {
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px; /* Spacing between cards */
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
        }
        .step-card .number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        .step-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: start;
        }
        @media (max-width: 768px) {
            .step-content {
                grid-template-columns: 1fr;
            }
        }
        .step-content .formula-block {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid var(--border);
        }
        .step-content .formula-block p {
            margin-top: 0;
        }
        .step-content .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .step-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
            line-height: 1.2;
        }
        .step-unit {
            font-size: 1rem;
            color: var(--text);
            opacity: 0.8;
            font-weight: 500;
            margin-left: 5px;
        }
        .step-explanation {
            font-size: 1.05rem;
            line-height: 1.8;
        }

        /* Results */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th,
        .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) {
            background-color: var(--bg);
        }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .results-table .highlight {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--success);
        }
        .results-table .warning {
            font-weight: 700;
            color: var(--warning);
        }
         .results-table .error {
            font-weight: 700;
            color: var(--danger);
        }

        /* Educational Section */
        .education-section {
            margin-top: 60px;
        }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i {
            font-size: 1.5rem;
        }
        .insight-card p {
            margin: 10px 0;
            line-height: 1.8;
        }
        .insight-card ol,
        .insight-card ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .insight-card li {
            margin-bottom: 10px;
        }
        .stat-highlight {
            display: inline-block;
            background: var(--accent);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin: 0 4px;
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 {
            color: var(--danger);
            margin-top: 0;
        }
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h4 {
            color: var(--success);
            margin-top: 0;
        }


        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .btn-group { flex-direction: column; }
        }
        .hidden { display: none; }
        
        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 5px;
            cursor: help;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Adjusted width */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-family: 'Inter', sans-serif; /* Professional font */
            font-size: 0.85rem; /* Slightly smaller font size */
            line-height: 1.4; /* Better readability */
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Specific styles for Instrument Rangeability & Span Calculator */
        /* These were copied from the old file to ensure the visualization bar works */
        .range-visualization-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            flex-direction: column;
        }
        .range-bar-container {
            width: 80%;
            height: 40px;
            background-color: #ddd; /* Sensor full range */
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            box-sizing: border-box;
            font-size: 0.9em;
            color: #333;
        }
        .process-range-overlay {
            position: absolute;
            height: 100%;
            background-color: var(--primary); /* Process range */
            transition: left 1.5s ease-out, width 1.5s ease-out;
            border-radius: 5px;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .transmitter-span-overlay {
            position: absolute;
            height: 100%;
            background-color: var(--accent); /* Transmitter span */
            transition: left 1.5s ease-out, width 1.5s ease-out;
            border-radius: 5px;
            z-index: 2; /* On top of process range */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }
        .range-label {
            position: absolute;
            font-size: 0.8em;
            color: var(--text);
            z-index: 3;
            bottom: -20px;
        }        
        .range-label.lrl { left: 0; }        
        .range-label.url { right: 0; }        
        .range-label.pmin { left: 0; transform: translateX(-50%); }        
        .range-label.pmax { right: 0; transform: translateX(50%); }        
        .range-label.lrv { left: 0; transform: translateX(-50%); }        
        .range-label.urv { right: 0; transform: translateX(50%); }
        
        .range-status-display {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.5s, color 0.5s;
            text-align: center;
        }        
        .range-status-display.ok {
            background-color: var(--success);
            color: white;
        }        
        .range-status-display.error {
            background-color: var(--danger);
            color: white;
        }        
        .range-status-display.warning {
            background-color: var(--warning);
            color: #333;
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>

    <header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        
        <div class="tool-container">
            <h2><i class="fas fa-arrows-alt-h"></i> Instrument Rangeability & Span Calculator</h2>
                        
            <div class="tool-description">
                <p>This tool helps instrumentation engineers define and verify the optimal span and range settings for process transmitters. Proper range and span selection are crucial for measurement accuracy, resolution, and overall process control performance across various industries worldwide.</p>
            </div>
                    
            <div class="calculator-form">
                <form id="rangeability-calculator-form">
                    <!-- Sensor & Process Limits -->
                    <div class="form-section">
                        <h3>Sensor & Process Limits</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sensor-lrl">Sensor Lower Range Limit (LRL) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The absolute lowest measurement value the sensor can physically detect.</span></span></label>
                                <input type="number" id="sensor-lrl" step="0.1" value="0.0" required>
                            </div>
                            <div class="form-group">
                                <label for="sensor-url">Sensor Upper Range Limit (URL) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The absolute highest measurement value the sensor can physically detect.</span></span></label>
                                <input type="number" id="sensor-url" step="0.1" value="100.0" required>
                            </div>
                            <div class="form-group">
                                <label for="process-min">Required Process Minimum (P<sub>min</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The lowest process value expected to be measured or controlled.</span></span></label>
                                <input type="number" id="process-min" step="0.1" value="10.0" required>
                            </div>
                            <div class="form-group">
                                <label for="process-max">Required Process Maximum (P<sub>max</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The highest process value expected to be measured or controlled.</span></span></label>
                                <input type="number" id="process-max" step="0.1" value="90.0" required>
                            </div>
                        </div>
                    </div>

                    <!-- Transmitter Output & Desired Span -->
                    <div class="form-section">
                        <h3>Transmitter Output & Desired Span</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="output-min">Transmitter Output Minimum (O<sub>min</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The minimum output signal of the transmitter (e.g., 4 mA for 4-20 mA).</span></span></label>
                                <input type="number" id="output-min" step="0.1" value="4.0" required>
                            </div>
                            <div class="form-group">
                                <label for="output-max">Transmitter Output Maximum (O<sub>max</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum output signal of the transmitter (e.g., 20 mA for 4-20 mA).</span></span></label>
                                <input type="number" id="output-max" step="0.1" value="20.0" required>
                            </div>
                            <div class="form-group">
                                <label for="desired-lrv">Desired Transmitter LRV <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The desired Lower Range Value for the transmitter's calibrated span. This is the process value that corresponds to the minimum output signal.</span></span></label>
                                <input type="number" id="desired-lrv" step="0.1" value="0.0" required>
                            </div>
                            <div class="form-group">
                                <label for="desired-urv">Desired Transmitter URV <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The desired Upper Range Value for the transmitter's calibrated span. This is the process value that corresponds to the maximum output signal.</span></span></label>
                                <input type="number" id="desired-urv" step="0.1" value="100.0" required>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Instrument Parameters -->
                    <div class="form-section">
                        <h3>Advanced Instrument Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="instrument-hysteresis">Instrument Hysteresis <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum difference in output for a given input when the input is first increasing and then decreasing. Expressed as a percentage of the calibrated span.</span></span></label>
                                <input type="number" id="instrument-hysteresis" step="0.01" value="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="instrument-resolution-bits">Instrument Resolution (bits) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The number of bits used by the instrument's Analog-to-Digital Converter (ADC). Higher bits mean finer resolution. (e.g., 12, 16, 24)</span></span></label>
                                <input type="number" id="instrument-resolution-bits" step="1" value="12" required>
                            </div>
                            <div class="form-group">
                                <label for="zero-adjust-min-percent-url">Adjustable Zero Min (% URL) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The minimum zero adjustment limit of the instrument, as a percentage of its Upper Range Limit (URL). (e.g., -100 for -100% of URL)</span></span></label>
                                <input type="number" id="zero-adjust-min-percent-url" step="1" value="-100" required>
                            </div>
                            <div class="form-group">
                                <label for="zero-adjust-max-percent-url">Adjustable Zero Max (% URL) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum zero adjustment limit of the instrument, as a percentage of its Upper Range Limit (URL). (e.g., +100 for +100% of URL)</span></span></label>
                                <input type="number" id="zero-adjust-max-percent-url" step="1" value="100" required>
                            </div>
                            <div class="form-group">
                                <label for="span-adjust-min-percent-url">Adjustable Span Min (% URL) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The minimum span adjustment limit of the instrument, as a percentage of its Upper Range Limit (URL). (e.g., 10 for 10% of URL)</span></span></label>
                                <input type="number" id="span-adjust-min-percent-url" step="1" value="10" required>
                            </div>
                            <div class="form-group">
                                <label for="span-adjust-max-percent-url">Adjustable Span Max (% URL) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum span adjustment limit of the instrument, as a percentage of its Upper Range Limit (URL). (e.g., 100 for 100% of URL)</span></span></label>
                                <input type="number" id="span-adjust-max-percent-url" step="1" value="100" required>
                            </div>
                            <div class="form-group">
                                <label for="process-variable-unit">Process Variable Unit <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The unit of measurement for the process variable (e.g., psi, °C, LPM).</span></span></label>
                                <input type="text" id="process-variable-unit" value="%" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group" style="margin-top: 25px;">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Range & Span</button>
                        <button type="button" id="reset-form-btn" class="btn accent"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- NEW Step-by-Step Results Container -->
        <div id="steps-container" class="steps-container math-content">
            <!-- Step cards will be dynamically inserted here -->
        </div>
            
        <!-- Updated Results Section -->
        <div id="results-section" class="card hidden">
            <h3><i class="fas fa-clipboard-check"></i> Calculation Summary</h3>
            
            <!-- Visualization is part of the summary -->
            <div class="range-visualization-container">
                <p style="margin-bottom: 25px; font-weight: bold; color: var(--heading);">Sensor Range, Process Range, and Transmitter Span Visualization</p>
                <div class="range-bar-container">
                    <div class="process-range-overlay" id="process-range-overlay">Process Range</div>
                    <div class="transmitter-span-overlay" id="transmitter-span-overlay">Transmitter Span</div>
                    <span class="range-label lrl" id="sensor-lrl-label">LRL</span>
                    <span class="range-label url" id="sensor-url-label">URL</span>
                    <span class="range-label pmin" id="process-min-label" style="display: none;">Pmin</span>
                    <span class="range-label pmax" id="process-max-label" style="display: none;">Pmax</span>
                    <span class="range-label lrv" id="transmitter-lrv-label" style="display: none;">LRV</span>
                    <span class="range-label urv" id="transmitter-urv-label" style="display: none;">URV</span>
                </div>
                <p class="range-status-display" id="range-status-display">Status: N/A</p>
            </div>

            <table class="results-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    <!-- Results will be dynamically inserted here -->
                </tbody>
            </table>

            <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                <button type="button" id="clear-results-btn" class="btn accent"><i class="fas fa-times-circle"></i> Clear Results</button>
            </div>

            <div class="insight-card" id="standard-reference" style="margin-top: 30px;">
                <!-- Standard reference text will be inserted here -->
            </div>
        </div>

        <!-- NEW Educational Section on PID Tuning -->
        <div id="education-section" class="education-section card">
            <h2><i class="fas fa-cogs"></i> The Heart of Control: Why PID Tuning is Mission-Critical</h2>
            
            <div class="tool-description">
                <p>A <strong>Proportional-Integral-Derivative (PID) controller</strong> is the workhorse of the entire automation industry. Think of it as the "brain" that tirelessly works to keep a process variable (like temperature, pressure, or flow) exactly at its desired Setpoint (SP).</p>
                <p>But a powerful brain is useless if it's not "tuned" correctly. PID tuning is the process of finding the optimal values for the controller's three parameters (P, I, and D) to ensure the process is stable, efficient, and safe. An untuned or poorly tuned controller can be disastrous, while a well-tuned one is the key to profitability and quality.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-car"></i> A Simple Analogy: Driving a Car</h4>
                <p>Imagine you are driving a car (the "Controller") and your goal is to keep it in the center of your lane (the "Setpoint").</p>
                <ul>
                    <li>
                        <strong>Proportional (P) - The "Present":</strong> This is your immediate reaction. You see the car drift to the right (an "error"), so you turn the steering wheel to the left. The amount you turn is *proportional* to how far off-center you are.
                        <br><strong>Poor Tuning:</strong> Too much 'P' (a high gain) is like violently yanking the wheel for a small drift, causing you to swerve back and forth (oscillate). Too little 'P' is like barely moving the wheel, and you react too slowly.
                    </li>
                    <li>
                        <strong>Integral (I) - The "Past":</strong> This is your correction for persistent errors. Imagine a constant crosswind (a "process disturbance") is always pushing you slightly to the right. Even with your proportional steering, you might end up driving slightly right of center (a "steady-state error"). The Integral term notices this *persistent* error over time and adds a *little more* steering to the left, until you are perfectly centered again.
                        <br><strong>Poor Tuning:</strong> Too much 'I' (a high gain) causes the correction to "wind up," leading to massive overshoots.
                    </li>
                    <li>
                        <strong>Derivative (D) - The "Future":</strong> This is your anticipatory action. You see the car *starting* to turn quickly towards the edge of the lane (a high "rate of change"). Even if you're not far off-center *yet*, you anticipate the future error and *dampen* your steering correction to avoid overshooting. It adds a "braking" or "calming" influence.
                        <br><strong>Poor Tuning:</strong> Too much 'D' can make the controller "jumpy" and over-react to tiny, insignificant changes in measurement ("process noise").
                    </li>
                </ul>
            </div>

            <div class="success-box">
                <h4><i class="fas fa-check-circle"></i> The Significance: What Good Tuning Achieves</h4>
                <ol>
                    <li><strong>Process Stability:</strong> This is the #1 priority. A well-tuned loop ensures the process variable (PV) settles smoothly at the setpoint (SP) without "hunting" (oscillating) wildly. An unstable process can be dangerous and produce zero usable product. </li>
                    <li><strong>Performance & Efficiency:</strong> A tuned controller responds quickly to disturbances (like a change in demand or new material being added) and returns to the setpoint with minimal delay. For a heater, this means not wasting fuel by overshooting the temperature. For a pump, it means not wasting electricity by running erratically.</li>
                    <li><strong>Product Quality & Consistency:</strong> If you need to cook a product at exactly 150°C, a controller that oscillates between 140°C and 160°C will ruin the batch. A well-tuned controller holds the temperature steady, ensuring every product is made to the exact same specification, batch after batch.</li>
                    <li><strong>Safety:</strong> In many processes, overshooting the setpoint is not just inefficient—it's dangerous. A poorly tuned level controller could overfill a tank. A poorly tuned pressure controller could exceed the vessel's safety limits. Correct tuning, especially the Derivative (D) term, is critical for preventing these dangerous overshoots.</li>
                    <li><strong>Reduced Equipment Wear & Tear:</strong> A common side effect of poor tuning (especially too much 'P' or 'I') is oscillation. For a control valve, this means the valve actuator is *constantly* moving back and forth, 24/7. This "hunting" causes rapid mechanical wear on the valve stem, packing, and actuator, leading to expensive, premature failures and maintenance shutdowns.</li>
                </ol>
            </div>

            <div class="danger-box">
                <h4><i class="fas fa-exclamation-triangle"></i> Common Tuning Pitfalls & Why They Matter</h4>
                <ul>
                    <li><strong>"Default Settings" Are a Myth:</strong> Never assume the settings a controller ships with will work. Every process is unique. A 10,000-gallon tank and a 1-inch pipe have vastly different "personalities" (dynamics) and require completely different tuning values.</li>
                    <li><strong>Tuning for the Wrong Thing:</strong> A controller can be tuned for a *fast* response (an "aggressive" tune) or a *smooth* response (a "damped" tune). If you tune a massive process for a fast response, it will almost certainly become unstable. You must tune for the process's physical limitations.</li>
                    <li><strong>Ignoring the "I" (Integral Windup):</strong> If a controller is unable to reach its setpoint for a long time (e.g., a valve is fully open, but the tank is still heating up), the Integral term can "wind up" to a massive value. When the process *finally* reaches the setpoint, this huge "wound-up" value causes a massive, delayed overshoot. Modern controllers have "anti-windup" features, but it's a critical concept to understand.</li>
                    <li><strong>"Set It and Forget It":</strong> Processes change over time. Valves wear, heat exchangers get fouled, and product recipes change. A perfect tune from last year may be dangerously unstable today. Tuning is a lifecycle, not a one-time event.</li>
                </ul>
                <p>In short, PID tuning is not just a technical tweak; it is the single most important activity for ensuring an automated process is safe, stable, efficient, and profitable. This calculator, which helps you define the *input* to that controller (the 4-20mA signal), is the first and most critical step in ensuring the controller has a clear, accurate, and high-resolution view of the process it is trying to control.</p>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li>                        
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href="articles.html">Articles & Whitepapers</a></li>
                        <li><a href="sitemap2.html">Sitemap</a></li>                        
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Elements ---
            const sensorLRLInput = document.getElementById('sensor-lrl');
            const sensorURLInput = document.getElementById('sensor-url');
            const processMinInput = document.getElementById('process-min');
            const processMaxInput = document.getElementById('process-max');
            const outputMinInput = document.getElementById('output-min');
            const outputMaxInput = document.getElementById('output-max');
            const desiredLRVInput = document.getElementById('desired-lrv');
            const desiredURVInput = document.getElementById('desired-urv');
            
            const instrumentHysteresisInput = document.getElementById('instrument-hysteresis');
            const instrumentResolutionBitsInput = document.getElementById('instrument-resolution-bits');
            const zeroAdjustMinPercentURLInput = document.getElementById('zero-adjust-min-percent-url');
            const zeroAdjustMaxPercentURLInput = document.getElementById('zero-adjust-max-percent-url');
            const spanAdjustMinPercentURLInput = document.getElementById('span-adjust-min-percent-url');
            const spanAdjustMaxPercentURLInput = document.getElementById('span-adjust-max-percent-url');
            const processVariableUnitInput = document.getElementById('process-variable-unit');

            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            
            const resultContainer = document.getElementById('results-section');
            const stepsContainer = document.getElementById('steps-container'); // New steps container
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            
            const rangeStatusDisplay = document.getElementById('range-status-display');
            const processRangeOverlay = document.getElementById('process-range-overlay');
            const transmitterSpanOverlay = document.getElementById('transmitter-span-overlay');
            const sensorLRL_label = document.getElementById('sensor-lrl-label');
            const sensorURL_label = document.getElementById('sensor-url-label');
            const processMin_label = document.getElementById('process-min-label');
            const processMax_label = document.getElementById('process-max-label');
            const transmitterLRV_label = document.getElementById('transmitter-lrv-label');
            const transmitterURV_label = document.getElementById('transmitter-urv-label');

            const messageBox = document.getElementById('message-box'); // New message box

            // Default values for resetting form
            const defaultValues = {
                'sensor-lrl': 0.0,
                'sensor-url': 100.0,
                'process-min': 10.0,
                'process-max': 90.0,
                'output-min': 4.0,
                'output-max': 20.0,
                'desired-lrv': 0.0,
                'desired-urv': 100.0,
                'instrument-hysteresis': 0.01,
                'instrument-resolution-bits': 12,
                'zero-adjust-min-percent-url': -100,
                'zero-adjust-max-percent-url': 100,
                'span-adjust-min-percent-url': 10,
                'span-adjust-max-percent-url': 100,
                'process-variable-unit': '%',
            };

            // --- New showMessage function (from RTD file) ---
            function showMessage(msg, type = 'success') {
                messageBox.textContent = msg;
                if (type === 'error') {
                    messageBox.style.backgroundColor = 'var(--danger)';
                } else if (type === 'warning') {
                     messageBox.style.backgroundColor = 'var(--warning)';
                     messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                    messageBox.style.color = 'white';
                }
                messageBox.classList.add('show');
                setTimeout(() => messageBox.classList.remove('show'), 4000);
            }

            // Helper function to add rows to the result table
            function addResultRow(parameter, value, statusClass = '') {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
                if (statusClass) {
                    valueCell.classList.add(statusClass);
                }
            }

            function clearResults() {
                resultContainer.classList.add('hidden'); // Use hidden class
                stepsContainer.innerHTML = ''; // Clear steps
                stepsContainer.classList.remove('active'); // Hide steps
                resultTableBody.innerHTML = '';
                standardReference.innerHTML = '';
                rangeStatusDisplay.textContent = 'Status: N/A';
                rangeStatusDisplay.classList.remove('ok', 'error', 'warning');

                // Reset visualization
                processRangeOverlay.style.width = '0%';
                processRangeOverlay.style.left = '0%';
                transmitterSpanOverlay.style.width = '0%';
                transmitterSpanOverlay.style.left = '0%';
                processRangeOverlay.style.display = 'none';
                transmitterSpanOverlay.style.display = 'none';

                // Hide labels
                processMin_label.style.display = 'none';
                processMax_label.style.display = 'none';
                transmitterLRV_label.style.display = 'none';
                transmitterURV_label.style.display = 'none';
                sensorLRL_label.textContent = `LRL`; // Reset to generic
                sensorURL_label.textContent = `URL`; // Reset to generic
                
                showMessage("Results cleared.", "success");
            }

            function resetForm() {
                for (const key in defaultValues) {
                    document.getElementById(key).value = defaultValues[key];
                }
                clearResults();
                showMessage("Form reset to default values.", "success");
            }

            function calculateRangeability() {
                clearResults(); // Clear previous results
                
                // --- 1. Get All Inputs ---
                const sensorLRL = parseFloat(sensorLRLInput.value);
                const sensorURL = parseFloat(sensorURLInput.value);
                const processMin = parseFloat(processMinInput.value);
                const processMax = parseFloat(processMaxInput.value);
                const outputMin = parseFloat(outputMinInput.value);
                const outputMax = parseFloat(outputMaxInput.value);
                const desiredLRV = parseFloat(desiredLRVInput.value);
                const desiredURV = parseFloat(desiredURVInput.value);
                const instrumentHysteresis = parseFloat(instrumentHysteresisInput.value);
                const instrumentResolutionBits = parseInt(instrumentResolutionBitsInput.value);
                const zeroAdjustMinPercentURL = parseFloat(zeroAdjustMinPercentURLInput.value);
                const zeroAdjustMaxPercentURL = parseFloat(zeroAdjustMaxPercentURLInput.value);
                const spanAdjustMinPercentURL = parseFloat(spanAdjustMinPercentURLInput.value);
                const spanAdjustMaxPercentURL = parseFloat(spanAdjustMaxPercentURLInput.value);
                const processVariableUnit = processVariableUnitInput.value.trim() || '%'; // Default to %

                // --- 2. Input Validation ---
                if (isNaN(sensorLRL) || isNaN(sensorURL) || isNaN(processMin) || isNaN(processMax) ||
                    isNaN(outputMin) || isNaN(outputMax) || isNaN(desiredLRV) || isNaN(desiredURV) ||
                    isNaN(instrumentHysteresis) || isNaN(instrumentResolutionBits) ||
                    isNaN(zeroAdjustMinPercentURL) || isNaN(zeroAdjustMaxPercentURL) ||
                    isNaN(spanAdjustMinPercentURL) || isNaN(spanAdjustMaxPercentURL)) {
                    showMessage("Please fill in all input fields with valid numbers.", "error");
                    return;
                }
                if (sensorURL <= sensorLRL) {
                    showMessage("Sensor URL must be greater than Sensor LRL.", "error");
                    return;
                }
                if (processMax <= processMin) {
                    showMessage("Process Max must be greater than Process Min.", "error");
                    return;
                }
                if (outputMax <= outputMin) {
                    showMessage("Output Max must be greater than Output Min.", "error");
                    return;
                }
                if (desiredURV <= desiredLRV) {
                    showMessage("Desired URV must be greater than Desired LRV.", "error");
                    return;
                }
                if (instrumentHysteresis < 0) {
                    showMessage("Instrument Hysteresis cannot be negative.", "error");
                    return;
                }
                if (instrumentResolutionBits <= 0 || instrumentResolutionBits > 32) {
                    showMessage("Instrument Resolution (bits) must be a positive integer (e.g., 8-32).", "error");
                    return;
                }
                if (zeroAdjustMinPercentURL > zeroAdjustMaxPercentURL || spanAdjustMinPercentURL > spanAdjustMaxPercentURL) {
                    showMessage("Min adjustment percentage cannot be greater than Max adjustment percentage.", "error");
                    return;
                }

                let stepsHtml = ''; // Initialize the steps HTML string

                // --- Step 1: Input Parameters ---
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">1</span>Input Parameters</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <strong>Sensor Limits:</strong><br>
                            LRL: ${sensorLRL} ${processVariableUnit}<br>
                            URL: ${sensorURL} ${processVariableUnit}<br>
                            <strong>Process Range:</strong><br>
                            P<sub>min</sub>: ${processMin} ${processVariableUnit}<br>
                            P<sub>max</sub>: ${processMax} ${processVariableUnit}
                        </div>
                        <div class="step-explanation">
                            <strong>Transmitter Span:</strong><br>
                            LRV: ${desiredLRV} ${processVariableUnit}<br>
                            URV: ${desiredURV} ${processVariableUnit}<br>
                            <strong>Output Signal:</strong><br>
                            O<sub>min</sub>: ${outputMin} mA<br>
                            O<sub>max</sub>: ${outputMax} mA
                        </div>
                    </div>
                </div>`;

                // --- 3. Perform Calculations ---

                // Step 2: Sensor Span
                const sensorSpan = sensorURL - sensorLRL;
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">2</span>Sensor Span (S<sub>sensor</sub>)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This is the total measurement capability of the sensor, from its absolute minimum (LRL) to its absolute maximum (URL).</p>
                            <p class="formula">S<sub>sensor</sub> = URL - LRL</p>
                            <p class="formula">S<sub>sensor</sub> = ${sensorURL} - ${sensorLRL}</p>
                        </div>
                        <div>
                            <p><strong>Sensor Span:</strong></p>
                            <div class="step-value">${sensorSpan.toFixed(2)}<span class="step-unit">${processVariableUnit}</span></div>
                        </div>
                    </div>
                </div>`;

                // Step 3: Process Span
                const processSpan = processMax - processMin;
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">3</span>Process Span (S<sub>process</sub>)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This is the normal operating range of your process that you need to measure accurately.</p>
                            <p class="formula">S<sub>process</sub> = P<sub>max</sub> - P<sub>min</sub></p>
                            <p class="formula">S<sub>process</sub> = ${processMax} - ${processMin}</p>
                        </div>
                        <div>
                            <p><strong>Process Span:</strong></p>
                            <div class="step-value">${processSpan.toFixed(2)}<span class="step-unit">${processVariableUnit}</span></div>
                        </div>
                    </div>
                </div>`;

                // Step 4: Transmitter Calibrated Span
                const transmitterSpan = desiredURV - desiredLRV;
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">4</span>Transmitter Calibrated Span (S<sub>transmitter</sub>)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This is the span you configure in the transmitter. The LRV (Lower Range Value) will correspond to the minimum output (e.g., 4 mA) and the URV (Upper Range Value) will correspond to the maximum output (e.g., 20 mA).</p>
                            <p class="formula">S<sub>transmitter</sub> = URV - LRV</p>
                            <p class="formula">S<sub>transmitter</sub> = ${desiredURV} - ${desiredLRV}</p>
                        </div>
                        <div>
                            <p><strong>Transmitter Span:</strong></p>
                            <div class="step-value">${transmitterSpan.toFixed(2)}<span class="step-unit">${processVariableUnit}</span></div>
                        </div>
                    </div>
                </div>`;

                // Step 5: Output Span
                const outputSpan = outputMax - outputMin;
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">5</span>Output Span (S<sub>output</sub>)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This is the range of the analog signal, typically 16 mA for a 4-20 mA transmitter.</p>
                            <p class="formula">S<sub>output</sub> = O<sub>max</sub> - O<sub>min</sub></p>
                            <p class="formula">S<sub>output</sub> = ${outputMax} - ${outputMin}</p>
                        </div>
                        <div>
                            <p><strong>Output Span:</strong></p>
                            <div class="step-value">${outputSpan.toFixed(1)}<span class="step-unit">mA</span></div>
                        </div>
                    </div>
                </div>`;
                
                // Step 6: Rangeability / Turndown Ratio
                let sensorRangeability = (sensorLRL !== 0) ? (sensorURL / sensorLRL).toFixed(2) + ":1" : 'Undefined (LRL is 0)';
                let processRangeability = (processMin !== 0) ? (processMax / processMin).toFixed(2) + ":1" : 'Undefined (Pmin is 0)';
                let transmitterRangeability = (desiredLRV !== 0) ? (desiredURV / desiredLRV).toFixed(2) + ":1" : 'Undefined (LRV is 0)';
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">6</span>Rangeability (Turndown Ratio)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>Rangeability (or Turndown) is the ratio of the maximum value to the minimum value. A higher ratio means a wider operational range. It is calculated as <strong>Max / Min</strong>.</p>
                            <p class="formula">Sensor Rangeability = ${sensorURL} / ${sensorLRL}</p>
                            <p class="formula">Process Rangeability = ${processMax} / ${processMin}</p>
                            <p class="formula">Transmitter Rangeability = ${desiredURV} / ${desiredLRV}</p>
                        </div>
                        <div>
                            <p><strong>Sensor:</strong> <span class="step-value" style="font-size: 1.5rem;">${sensorRangeability}</span></p>
                            <p><strong>Process:</strong> <span class="step-value" style="font-size: 1.5rem;">${processRangeability}</span></p>
                            <p><strong>Transmitter:</strong> <span class="step-value" style="font-size: 1.5rem;">${transmitterRangeability}</span></p>
                        </div>
                    </div>
                </div>`;

                // Step 7: Output at Process Points
                const outputAtPmin = outputMin + (processMin - desiredLRV) * (outputSpan / transmitterSpan);
                const outputAtPmax = outputMin + (processMax - desiredLRV) * (outputSpan / transmitterSpan);
                stepsHtml += `<div class="step-card math-content">
                    <h4><span class="number">7</span>Output Signal at Process Limits</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This calculation determines what the transmitter's output signal will be at your minimum and maximum *process* values.</p>
                            <p class="formula">$$Output = O_{min} + \frac{(PV - LRV)}{(URV - LRV)} \times S_{output}$$</p>
                            <p class="formula">At P<sub>min</sub>: ${outputMin} + ((${processMin} - ${desiredLRV}) / ${transmitterSpan}) * ${outputSpan}</p>
                            <p class="formula">At P<sub>max</sub>: ${outputMin} + ((${processMax} - ${desiredLRV}) / ${transmitterSpan}) * ${outputSpan}</p>
                        </div>
                        <div>
                            <p><strong>Output at P<sub>min</sub>:</strong></p>
                            <div class="step-value">${outputAtPmin.toFixed(3)}<span class="step-unit">mA</span></div>
                            <p><strong>Output at P<sub>max</sub>:</strong></p>
                            <div class="step-value">${outputAtPmax.toFixed(3)}<span class="step-unit">mA</span></div>
                        </div>
                    </div>
                </div>`;

                // Step 8: Percentage of Span at Process Points
                const percentAtPmin = ((processMin - desiredLRV) / transmitterSpan) * 100;
                const percentAtPmax = ((processMax - desiredLRV) / transmitterSpan) * 100;
                stepsHtml += `<div class="step-card math-content">
                    <h4><span class="number">8</span>Process Range as % of Transmitter Span</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This shows where your normal process operation (P<sub>min</sub> to P<sub>max</sub>) falls within the transmitter's calibrated span (LRV to URV). Ideally, this should be a large portion of the span for better resolution.</p>
                            <p class="formula">$$ \% Span = \frac{(PV - LRV)}{S_{transmitter}} \times 100$$</p>
                        </div>
                        <div>
                            <p><strong>P<sub>min</sub> is at:</strong></p>
                            <div class="step-value">${percentAtPmin.toFixed(2)}<span class="step-unit">% of Span</span></div>
                            <p><strong>P<sub>max</sub> is at:</strong></p>
                            <div class="step-value">${percentAtPmax.toFixed(2)}<span class="step-unit">% of Span</span></div>
                        </div>
                    </div>
                </div>`;

                // Step 9: Resolution & Hysteresis
                const numSteps = Math.pow(2, instrumentResolutionBits);
                const resolutionPerStep = transmitterSpan / numSteps;
                const hysteresisInUnits = (instrumentHysteresis / 100) * transmitterSpan;
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">9</span>Instrument Resolution & Hysteresis</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p><strong>Resolution:</strong> The smallest change the instrument can detect, based on its ${instrumentResolutionBits}-bit A/D converter.</p>
                            <p class="formula">Resolution = ${transmitterSpan.toFixed(2)} ${processVariableUnit} / 2^${instrumentResolutionBits}</p>
                            <p><strong>Hysteresis:</strong> The "deadband" of the sensor (from ${instrumentHysteresis}% spec) in process units. A larger value can cause control problems.</p>
                            <p class="formula">Hysteresis = (${instrumentHysteresis} / 100) * ${transmitterSpan.toFixed(2)} ${processVariableUnit}</p>
                        </div>
                        <div>
                            <p><strong>Resolution per Step:</strong></p>
                            <div class="step-value">${resolutionPerStep.toExponential(2)}<span class="step-unit">${processVariableUnit}</span></div>
                            <p><strong>Hysteresis in Units:</strong></p>
                            <div class="step-value">${hysteresisInUnits.toFixed(3)}<span class="step-unit">${processVariableUnit}</span></div>
                        </div>
                    </div>
                </div>`;

                // Step 10: Achievability Check
                const sensorFullSpan = sensorURL - sensorLRL;
                const desiredLRVRelativeToSensorSpan = ((desiredLRV - sensorLRL) / sensorFullSpan) * 100;
                const desiredSpanRelativeToSensorSpan = (transmitterSpan / sensorFullSpan) * 100;

                let zeroAdjustStatus = "OK";
                let zeroAdjustClass = "ok";
                if (desiredLRVRelativeToSensorSpan < zeroAdjustMinPercentURL || desiredLRVRelativeToSensorSpan > zeroAdjustMaxPercentURL) {
                    zeroAdjustStatus = "WARNING: Desired LRV is outside instrument's adjustable zero range.";
                    zeroAdjustClass = "warning";
                }

                let spanAdjustStatus = "OK";
                let spanAdjustClass = "ok";
                if (desiredSpanRelativeToSensorSpan < spanAdjustMinPercentURL || desiredSpanRelativeToSensorSpan > spanAdjustMaxPercentURL) {
                    spanAdjustStatus = "WARNING: Desired Span is outside instrument's adjustable span range.";
                    spanAdjustClass = "warning";
                }
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">10</span>Zero & Span Achievability Check</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>This checks if the instrument can *actually* be configured to your desired LRV and Span based on its hardware limits (which are relative to its full URL/Span).</p>
                            <p><strong>Zero Limit:</strong> ${zeroAdjustMinPercentURL}% to ${zeroAdjustMaxPercentURL}%<br><strong>Your LRV %:</strong> ${desiredLRVRelativeToSensorSpan.toFixed(2)}%</p>
                            <p><strong>Span Limit:</strong> ${spanAdjustMinPercentURL}% to ${spanAdjustMaxPercentURL}%<br><strong>Your Span %:</strong> ${desiredSpanRelativeToSensorSpan.toFixed(2)}%</p>
                        </div>
                        <div>
                            <p><strong>Zero Adjustment Status:</strong></p>
                            <div class="step-value ${zeroAdjustClass}" style="font-size: 1.2rem;">${zeroAdjustStatus}</div>
                            <p><strong>Span Adjustment Status:</strong></p>
                            <div class="step-value ${spanAdjustClass}" style="font-size: 1.2rem;">${spanAdjustStatus}</div>
                        </div>
                    </div>
                </div>`;

                // --- 4. Final Status & Warnings ---
                let overallStatusMessage = "Configuration is valid.";
                let overallStatusClass = "ok";
                let warnings = [];

                if (desiredLRV < sensorLRL || desiredURV > sensorURL) {
                    warnings.push("Transmitter span (LRV/URV) exceeds sensor's physical limits (LRL/URL). Measurement will be inaccurate or impossible.");
                }
                if (processMin < desiredLRV || processMax > desiredURV) {
                    warnings.push("Process operating range (Pmin/Pmax) is outside the transmitter's calibrated span (LRV/URV). Some process values will be 'off-scale' and not measured correctly.");
                }
                if (processMin < sensorLRL || processMax > sensorURL) {
                    warnings.push("Process operating range (Pmin/Pmax) is outside the sensor's physical limits (LRL/URL). Sensor may be damaged or unable to measure.");
                }
                if (transmitterSpan < (sensorSpan * 0.1)) {
                    warnings.push("Transmitter span is less than 10% of the sensor's full span. This is a very high turndown and may lead to poor accuracy and resolution.");
                }
                 if (transmitterSpan > sensorSpan) {
                    warnings.push("Transmitter span is greater than the sensor's full span. This configuration is not possible.");
                }
                if (hysteresisInUnits > resolutionPerStep * 5) { // Hysteresis 5x larger than resolution
                    warnings.push("Hysteresis is significantly larger than resolution. This may lead to poor control or measurement instability.");
                }
                if (zeroAdjustStatus.includes("WARNING")) warnings.push(zeroAdjustStatus);
                if (spanAdjustStatus.includes("WARNING")) warnings.push(spanAdjustStatus);

                if (warnings.length > 0) {
                    overallStatusMessage = "Configuration has warnings. Review summary table.";
                    overallStatusClass = "warning";
                    if (warnings.some(w => w.includes("impossible") || w.includes("exceeds"))) {
                         overallStatusMessage = "Configuration is invalid. Review summary table.";
                         overallStatusClass = "error";
                    }
                    showMessage(overallStatusMessage, overallStatusClass);
                } else {
                    showMessage(overallStatusMessage, "success");
                }

                // --- 5. Populate Summary Table ---
                resultTableBody.innerHTML = ''; // Clear old results
                addResultRow("<strong>Overall Configuration Status</strong>", `<strong>${overallStatusMessage}</strong>`, overallStatusClass);
                addResultRow("Sensor Range (LRL to URL)", `${sensorLRL.toFixed(2)} to ${sensorURL.toFixed(2)} ${processVariableUnit}`);
                addResultRow("Sensor Span", `${sensorSpan.toFixed(2)} ${processVariableUnit}`);
                addResultRow("Process Range (Pmin to Pmax)", `${processMin.toFixed(2)} to ${processMax.toFixed(2)} ${processVariableUnit}`);
                addResultRow("Process Span", `${processSpan.toFixed(2)} ${processVariableUnit}`);
                addResultRow("Transmitter Range (LRV to URV)", `${desiredLRV.toFixed(2)} to ${desiredURV.toFixed(2)} ${processVariableUnit}`);
                addResultRow("Transmitter Calibrated Span", `${transmitterSpan.toFixed(2)} ${processVariableUnit}`);
                addResultRow("Output at Pmin", `${outputAtPmin.toFixed(3)} mA`);
                addResultRow("Output at Pmax", `${outputAtPmax.toFixed(3)} mA`);
                addResultRow("Process Range as % of Span", `${percentAtPmin.toFixed(2)}% to ${percentAtPmax.toFixed(2)}%`);
                addResultRow("Resolution per Step", `${resolutionPerStep.toExponential(2)} ${processVariableUnit}`);
                addResultRow("Hysteresis in Units", `${hysteresisInUnits.toFixed(3)} ${processVariableUnit}`);
                addResultRow("Zero Adjustment Status", zeroAdjustStatus, zeroAdjustClass);
                addResultRow("Span Adjustment Status", spanAdjustStatus, spanAdjustClass);
                
                // Add warnings to table
                if (warnings.length > 0) {
                    addResultRow("<strong>Warnings</strong>", `<ul style='margin:0; padding-left: 20px;'>${warnings.map(w => `<li>${w}</li>`).join('')}</ul>`, overallStatusClass);
                }


                // --- 6. Update Visualization ---
                const fullSensorRange = sensorURL - sensorLRL;
                const getPercentage = (value) => ((value - sensorLRL) / fullSensorRange) * 100;
                const getWidthPercentage = (span) => (span / fullSensorRange) * 100;

                const processRangeStartPercent = getPercentage(processMin);
                const processRangeWidthPercent = getWidthPercentage(processSpan);
                processRangeOverlay.style.left = `${Math.max(0, processRangeStartPercent)}%`;
                processRangeOverlay.style.width = `${Math.min(100 - Math.max(0, processRangeStartPercent), processRangeWidthPercent)}%`;
                processRangeOverlay.textContent = `P: ${processMin} to ${processMax}`;
                processRangeOverlay.style.display = 'flex';

                const transmitterSpanStartPercent = getPercentage(desiredLRV);
                const transmitterSpanWidthPercent = getWidthPercentage(transmitterSpan);
                transmitterSpanOverlay.style.left = `${Math.max(0, transmitterSpanStartPercent)}%`;
                transmitterSpanOverlay.style.width = `${Math.min(100 - Math.max(0, transmitterSpanStartPercent), transmitterSpanWidthPercent)}%`;
                transmitterSpanOverlay.textContent = `TX: ${desiredLRV} to ${desiredURV}`;
                transmitterSpanOverlay.style.display = 'flex';

                sensorLRL_label.textContent = `LRL: ${sensorLRL.toFixed(2)}`;
                sensorURL_label.textContent = `URL: ${sensorURL.toFixed(2)}`;
                
                const positionLabel = (labelElement, value, prefix) => {
                    const percentPos = getPercentage(value);
                    labelElement.textContent = `${prefix}: ${value.toFixed(2)}`;
                    labelElement.style.left = `${Math.min(100, Math.max(0, percentPos))}%`; // Clamp label position
                    labelElement.style.transform = `translateX(-50%)`;
                    labelElement.style.display = 'block';
                };

                positionLabel(processMin_label, processMin, 'Pmin');
                positionLabel(processMax_label, processMax, 'Pmax');
                positionLabel(transmitterLRV_label, desiredLRV, 'LRV');
                positionLabel(transmitterURV_label, desiredURV, 'URV');

                rangeStatusDisplay.textContent = `Status: ${overallStatusMessage}`;
                rangeStatusDisplay.classList.remove('ok', 'error', 'warning');
                rangeStatusDisplay.classList.add(overallStatusClass);

                // --- 7. Add Standard Reference Text ---
                const standardRefText = `
                    <h4><i class="fas fa-book"></i> International Standards Compliance & Best Practices</h4>
                    <p>Proper instrument rangeability and span selection are fundamental to achieving accurate and reliable process measurements, aligning with several international standards and industry best practices:</p>
                    <ul>
                        <li><strong>ISA-5.1-2007: Instrumentation Symbols and Identification.</strong> This standard underpins the clear definition of instrument ranges (LRL, URL, LRV, URV) and their representation in documentation, which is essential for consistent setup.</li>
                        <li><strong>IEC 60381-1: Analogue signals for process control systems.</strong> This standard (e.g., for 4-20 mA) defines the signal range, which directly relates to the output span (O<sub>max</sub> - O<sub>min</sub>) of the transmitter.</li>
                        <li><strong>ANSI/ISA-TR20.00.01-2006: Specification Forms for Process Measurement and Control Instruments.</strong> These technical reports guide engineers in documenting instrument requirements, including range and span, ensuring that the selected instrument meets the process needs.</li>
                        <li><strong>Measurement Uncertainty and Accuracy (e.g., ISO/IEC Guide 98):</strong> Selecting an appropriate span that considers resolution, hysteresis, and linearity is critical for minimizing uncertainty and maximizing accuracy.</li>
                        <li><strong>Manufacturer Specifications:</strong> Always refer to the instrument manufacturer's data sheet for precise LRL, URL, adjustable zero, span limits, hysteresis, and resolution, as these vary significantly between models and types.</li>
                    </ul>
                    <p>This tool provides calculations and checks based on these widely accepted engineering principles. For critical applications, always refer to the latest official standards documents and device manufacturer specifications.</p>
                `;
                standardReference.innerHTML = standardRefText;

                // --- 8. Show Results ---
                stepsContainer.innerHTML = stepsHtml; // Insert detailed steps
                stepsContainer.classList.add('active'); // Show steps
                resultContainer.classList.remove('hidden'); // Show summary card
                
                // Typeset MathJax if available
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    setTimeout(() => {
                        window.MathJax.typesetPromise([stepsContainer]);
                    }, 50); 
                }

                setTimeout(() => {
                    stepsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to steps
                }, 100);
            }

            // --- Event Listeners ---
            calculateBtn.addEventListener('click', calculateRangeability);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            // --- Theme switch logic (from RTD file) ---
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                // Check local storage on load
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                // Add listener for changes
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>
