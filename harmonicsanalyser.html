<!DOCTYPE html>
<html lang="en">

<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
        crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>

    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmonic Signature Identifier & IEEE 519 Analyzer</title>
    <meta name="description"
        content="Professional Harmonic Analysis Tool. Features Waveform Synthesis, Real-time FFT, IEEE 519 Compliance Checking, and Automatic Source Identification (VFD, SMPS, Saturation).">
    <meta name="keywords"
        content="harmonic analyzer, FFT calculator, thd calculator, IEEE 519 check, harmonic synthesis, VFD harmonics, electrical engineering tool, power quality">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&family=Roboto+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js (UMD) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Strictly Preserved) --- */
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);

            /* Commercial Additions */
            --input-bg: #F1F5F9;
            --text-light: #64748b;
            --font-mono: 'Roboto Mono', monospace;
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
            --input-bg: #0f172a;
            --text-light: #94a3b8;
        }

        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-bottom: none;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }

        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }

        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            font-size: 1rem;
        }

        .nav-links a:hover {
            color: var(--accent);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.2);
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--accent);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        /* Content */
        main {
            padding: 40px 0;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }

        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        .tool-description {
            padding: 20px 0;
            background: transparent;
            color: var(--text);
            font-size: 1rem;
        }

        /* Inputs */
        .input-section {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 25px 20px 20px 20px;
            margin-bottom: 24px;
            position: relative;
        }

        .section-title {
            position: absolute;
            top: -12px;
            left: 16px;
            background: var(--card);
            padding: 0 10px;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid var(--border);
            border-radius: 4px;
        }

        body.dark-mode .section-title {
            background: var(--card);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 0;
            position: relative;
        }

        .form-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--card);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: var(--font-mono);
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .tab-btn:hover {
            color: var(--primary);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Range Sliders for Synthesis */
        .range-wrap {
            margin-bottom: 15px;
        }

        .range-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text);
        }

        .range-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 6px;
            background: var(--border);
            border-radius: 5px;
            outline: none;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--secondary);
            cursor: pointer;
            transition: background .15s ease-in-out;
        }

        .range-slider::-webkit-slider-thumb:hover {
            background: var(--primary);
        }

        /* File Upload */
        .file-drop-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--input-bg);
            margin-bottom: 20px;
        }

        .file-drop-area:hover,
        .file-drop-area.drag-over {
            border-color: var(--secondary);
            background: rgba(37, 99, 235, 0.05);
        }

        .file-icon {
            font-size: 3rem;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .file-msg {
            font-weight: 600;
            color: var(--text);
        }

        .file-sub {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        input[type=file] {
            display: none;
        }

        .info-icon {
            color: var(--secondary);
            cursor: help;
            font-size: 0.9em;
            opacity: 0.7;
        }

        .tooltip-container {
            position: relative;
            display: inline-block;
        }

        .tooltip-container .tooltip-text {
            visibility: hidden;
            width: 240px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 100;
            bottom: 135%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            pointer-events: none;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-container .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        /* Buttons & Presets */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }

        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
        }

        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-radius: 8px;
            overflow: hidden;
        }

        .results-table th,
        .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }

        .results-table tr:nth-child(even) {
            background-color: var(--bg);
        }

        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }

        .results-table .val {
            font-family: var(--font-mono);
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* Recommendation Cards (Adapted for Source ID) */
        .rec-card {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .dark-mode .rec-card {
            background: var(--card);
        }

        .rec-card.high-confidence {
            border-left: 5px solid var(--success);
        }

        .rec-card.med-confidence {
            border-left: 5px solid var(--warning);
        }

        .rec-card.low-confidence {
            border-left: 5px solid var(--danger);
        }

        .rec-title {
            color: var(--heading);
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rec-tag {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 20px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .tag-vfd {
            background: #dbeafe;
            color: #1e40af;
        }

        .tag-smps {
            background: #fce7f3;
            color: #9d174d;
        }

        .tag-sat {
            background: #fef9c3;
            color: #854d0e;
        }

        .thd-meter {
            display: flex;
            align-items: baseline;
            gap: 10px;
            margin: 15px 0;
        }

        .thd-val {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary);
            font-family: var(--font-mono);
            line-height: 1;
        }

        .thd-label {
            font-size: 0.9rem;
            color: var(--text);
            font-weight: 600;
        }

        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 350px;
            width: 100%;
            margin-bottom: 20px;
        }

        /* IEEE Table */
        .compliance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .compliance-table th {
            background: rgba(0, 0, 0, 0.05);
            text-align: left;
            padding: 8px;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        .compliance-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border);
        }

        .pass {
            color: var(--success);
            font-weight: 700;
        }

        .fail {
            color: var(--danger);
            font-weight: 700;
        }

        /* Education */
        .education-section {
            margin-top: 50px;
        }

        .tech-article {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 40px;
            align-items: start;
        }

        @media (max-width: 800px) {
            .tech-article {
                grid-template-columns: 1fr;
            }
        }

        .toc-sticky {
            position: sticky;
            top: 20px;
            background: var(--bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .toc-sticky h4 {
            margin-top: 0;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
        }

        .toc-sticky ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .toc-sticky li {
            margin-bottom: 8px;
        }

        .toc-sticky a {
            text-decoration: none;
            color: var(--text);
            font-size: 0.95rem;
            transition: color 0.2s;
            display: block;
            padding: 4px 0;
        }

        .toc-sticky a:hover {
            color: var(--secondary);
            transform: translateX(5px);
        }

        .article-content h3 {
            color: var(--secondary);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 40px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .article-content p {
            line-height: 1.8;
            margin-bottom: 20px;
            font-size: 1.05rem;
            color: var(--text);
        }

        .highlight-box {
            background: rgba(37, 99, 235, 0.05);
            border-left: 4px solid var(--secondary);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
        }

        /* Message */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }

        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        .hidden {
            display: none;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-col {
            flex: 1;
            min-width: 200px;
        }

        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-col a:hover {
            color: var(--accent);
        }

        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .social-btn:hover {
            transform: translateY(-4px);
        }

        .social-btn.linkedin {
            background-color: #0A66C2;
        }

        .social-btn.youtube {
            background-color: #FF0000;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            .navbar {
                flex-direction: column;
                gap: 20px;
            }

            .nav-links {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 20px;
            }

            .footer-content {
                flex-direction: column;
                gap: 25px;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .tech-article {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <div id="message-box" class="message-box"></div>

    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-wave-square"></i> Harmonic Signature Identifier & Waveform Builder</h2>

            <div class="tool-description">
                <p>Comprehensive Power Quality Studio. <strong>Mode 1:</strong> Upload raw current data to diagnose
                    sources (VFD/SMPS/Saturation). <strong>Mode 2:</strong> Synthesize waveforms from scratch by
                    adjusting harmonic sliders to visualize distortions and check IEEE 519 compliance in real-time.</p>
            </div>

            <div class="calculator-form">

                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('tab-upload')"><i class="fas fa-file-upload"></i>
                        Analyze File (CSV)</button>
                    <button class="tab-btn" onclick="switchTab('tab-build')"><i class="fas fa-sliders-h"></i> Waveform
                        Builder (Synthesis)</button>
                </div>

                <!-- TAB 1: CSV Upload -->
                <div id="tab-upload" class="tab-content active">
                    <div class="form-group">
                        <label>Quick Start (Demo Files):</label>
                        <div class="preset-container" style="margin-bottom: 0;">
                            <button type="button" class="preset-btn" onclick="loadDemo('vfd')"><i
                                    class="fas fa-bolt"></i> VFD (6-Pulse)</button>
                            <button type="button" class="preset-btn" onclick="loadDemo('smps')"><i
                                    class="fas fa-desktop"></i> SMPS (IT Load)</button>
                            <button type="button" class="preset-btn" onclick="loadDemo('sat')"><i
                                    class="fas fa-magnet"></i> Saturation</button>
                        </div>
                    </div>

                    <div class="input-section">
                        <div class="section-title">Data Input</div>
                        <label for="csvInput" class="file-drop-area" id="dropArea">
                            <i class="fas fa-file-csv file-icon"></i>
                            <div class="file-msg">Click or Drag CSV File Here</div>
                            <div class="file-sub">Format: Single column [Amps] OR [Time, Amps]</div>
                            <input type="file" id="csvInput" accept=".csv">
                        </label>
                    </div>
                </div>

                <!-- TAB 2: Builder -->
                <div id="tab-build" class="tab-content">
                    <div class="input-section">
                        <div class="section-title">Harmonic Synthesis</div>
                        <p style="font-size:0.9rem; color:var(--text-light); margin-bottom:20px;">Adjust sliders to
                            inject harmonics relative to Fundamental (50Hz/60Hz).</p>

                        <div class="form-row">
                            <div style="flex:1;">
                                <!-- H3 -->
                                <div class="range-wrap">
                                    <div class="range-header"><span>3rd Harmonic (150/180Hz)</span> <span
                                            id="val-h3">0%</span></div>
                                    <input type="range" class="range-slider" min="0" max="100" value="0" id="slider-h3"
                                        oninput="updateBuilder(3, this.value)">
                                </div>
                                <!-- H5 -->
                                <div class="range-wrap">
                                    <div class="range-header"><span>5th Harmonic (250/300Hz)</span> <span
                                            id="val-h5">0%</span></div>
                                    <input type="range" class="range-slider" min="0" max="100" value="0" id="slider-h5"
                                        oninput="updateBuilder(5, this.value)">
                                </div>
                                <!-- H7 -->
                                <div class="range-wrap">
                                    <div class="range-header"><span>7th Harmonic (350/420Hz)</span> <span
                                            id="val-h7">0%</span></div>
                                    <input type="range" class="range-slider" min="0" max="100" value="0" id="slider-h7"
                                        oninput="updateBuilder(7, this.value)">
                                </div>
                            </div>
                            <div style="flex:1;">
                                <!-- H9 -->
                                <div class="range-wrap">
                                    <div class="range-header"><span>9th Harmonic</span> <span id="val-h9">0%</span>
                                    </div>
                                    <input type="range" class="range-slider" min="0" max="50" value="0" id="slider-h9"
                                        oninput="updateBuilder(9, this.value)">
                                </div>
                                <!-- H11 -->
                                <div class="range-wrap">
                                    <div class="range-header"><span>11th Harmonic</span> <span id="val-h11">0%</span>
                                    </div>
                                    <input type="range" class="range-slider" min="0" max="50" value="0" id="slider-h11"
                                        oninput="updateBuilder(11, this.value)">
                                </div>
                                <!-- H13 -->
                                <div class="range-wrap">
                                    <div class="range-header"><span>13th Harmonic</span> <span id="val-h13">0%</span>
                                    </div>
                                    <input type="range" class="range-slider" min="0" max="50" value="0" id="slider-h13"
                                        oninput="updateBuilder(13, this.value)">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>White Noise Injection (%)</label>
                            <input type="range" class="range-slider" min="0" max="20" value="0" id="slider-noise"
                                oninput="updateBuilder('noise', this.value)">
                        </div>
                    </div>
                </div>

                <!-- Global Settings -->
                <div class="input-section" style="margin-top: 20px;">
                    <div class="section-title">System Parameters</div>
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="form-group">
                            <label>Frequency (Hz)</label>
                            <input type="number" id="sys-freq" value="50" step="10">
                        </div>
                        <div class="form-group">
                            <label>Sampling Rate (Hz)</label>
                            <input type="number" id="sample-rate" placeholder="Auto / 3200">
                        </div>
                        <div class="form-group">
                            <label>Grid SCR (Stiffness) <div class="tooltip-container"><i
                                        class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Short
                                        Circuit Ratio (I_sc / I_load). Determines IEEE 519 limits. < 20 is Weak,> 1000
                                            is Stiff.</span></div></label>
                            <select id="grid-scr">
                                <option value="10">&lt; 20 (Weak Grid)</option>
                                <option value="20" selected>20 - 50</option>
                                <option value="50">50 - 100</option>
                                <option value="100">100 - 1000</option>
                                <option value="1000">&gt; 1000 (Stiff)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="button-wrapper">
                    <button type="button" id="process-btn" class="btn"><i class="fas fa-search-dollar"></i> Run
                        Analysis</button>
                    <button type="button" id="export-btn" class="btn btn-outline" style="display:none;"
                        onclick="exportData()"><i class="fas fa-download"></i> Export CSV</button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Diagnostic Report</h3>

                <div class="results-grid">
                    <!-- Left Col: Analysis -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Harmonic Profile</h4>

                        <div class="rec-card high-confidence" id="diag-card">
                            <div class="rec-title">
                                <span>Source ID</span>
                                <span class="rec-tag tag-vfd" id="source-tag">UNKNOWN</span>
                            </div>
                            <div class="thd-meter">
                                <div class="thd-val" id="res-thd">0.0%</div>
                                <div class="thd-label">Total THD</div>
                            </div>
                            <div style="font-size: 0.95rem; line-height: 1.6;" id="source-desc">
                                ...
                            </div>
                        </div>

                        <div class="rec-card" style="border-left-color: var(--secondary);">
                            <div class="rec-title">
                                <span>IEEE 519-2014 Compliance</span>
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <table class="compliance-table">
                                <thead>
                                    <tr>
                                        <th>Order (h)</th>
                                        <th>Limit %</th>
                                        <th>Actual %</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="ieee-body">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                            <div style="font-size:0.75rem; color:var(--text-light); margin-top:5px; text-align:right;">
                                Based on selected SCR category.</div>
                        </div>

                        <table class="results-table" style="margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Fundamental (I1)</td>
                                    <td id="res-fund" class="font-mono">0 A</td>
                                </tr>
                                <tr>
                                    <td>RMS Current</td>
                                    <td id="res-rms" class="font-mono">0 A</td>
                                </tr>
                                <tr>
                                    <td>Dominant Order</td>
                                    <td id="res-dom" class="font-mono">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Right Col: Charts -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 10px;">Frequency Spectrum (FFT)
                        </h4>
                        <div class="chart-container">
                            <canvas id="freqChart"></canvas>
                        </div>

                        <h4 style="margin-top: 20px; color: var(--primary); margin-bottom: 10px;">Time Domain Waveform
                        </h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="timeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT -->
        <div class="education-section card">
            <div class="card-header" style="margin-bottom:25px;">
                <h2><i class="fas fa-book-reader"></i> The Art of Harmonic Fingerprinting: A Comprehensive Guide</h2>
            </div>

            <div class="tech-article">
                <div class="toc-sticky">
                    <h4>Navigation</h4>
                    <ul>
                        <li><a href="#intro">1. The Music of the Grid</a></li>
                        <li><a href="#sig-vfd">2. The "Double-Hump": VFDs</a></li>
                        <li><a href="#sig-smps">3. The "Shark Fin": SMPS</a></li>
                        <li><a href="#sig-sat">4. The "Lopsided": Saturation</a></li>
                        <li><a href="#sig-arc">5. The "Chaos": Arc Furnaces</a></li>
                        <li><a href="#mitigation">6. Impact & Mitigation</a></li>
                    </ul>
                </div>

                <div class="article-content">
                    <div id="intro">
                        <h3>1. The Music of the Grid: What are Harmonics?</h3>
                        <p>Imagine your electrical grid is an orchestra. The "Fundamental Frequency" (50Hz or 60Hz) is
                            the deep, pure bass note that carries all the energy. It should be a smooth, perfect sine
                            wave.</p>
                        <p><strong>Harmonics are the unwanted overtones.</strong> They are integer multiples of that
                            fundamental frequency (e.g., 150Hz, 250Hz, 300Hz). Just as overtones change the sound of an
                            instrument from a pure whistle to a screechy violin, electrical harmonics distort the pure
                            voltage sine wave into jagged, irregular shapes.</p>
                        <p>In power systems, we generally do not want this "music." These extra frequencies do no useful
                            work; they only create heat, vibration, and interference. Understanding which "instrument"
                            (load) is playing these bad notes is the art of Harmonic Fingerprinting.</p>
                    </div>

                    <div id="sig-vfd">
                        <h3>2. The "Double-Hump" Camel: 6-Pulse Drives (VFDs)</h3>
                        <p>Variable Frequency Drives (VFDs) are the workhorses of modern industry, controlling motors
                            for pumps, fans, and conveyors. However, they are notorious harmonic generators.</p>
                        <p><strong>The Mechanism:</strong> The input stage of a standard VFD is a 3-phase bridge
                            rectifier made of 6 diodes. These diodes switch on and off in pairs to convert AC to DC.
                            This switching action draws current in two distinct "humps" per half-cycle, rather than a
                            smooth continuous flow.</p>
                        <p><strong>The Math ($h = np \pm 1$):</strong> The harmonic orders produced by a rectifier are
                            determined by the number of pulses ($p$). For a 6-pulse drive:<br>
                            $$ h = 6(1) \pm 1 \Rightarrow 5^{th}, 7^{th} $$<br>
                            $$ h = 6(2) \pm 1 \Rightarrow 11^{th}, 13^{th} $$</p>
                        <div class="highlight-box">
                            <strong>The Fingerprint:</strong> A spectrum dominated by the <strong>5th</strong>
                            (typically 25-35%) and <strong>7th</strong> (10-15%) harmonics. If you see this pattern,
                            look for a motor drive without a line reactor.
                        </div>
                        <p><strong>Why it matters:</strong> The 5th harmonic is a "Negative Sequence" harmonic. It
                            creates a magnetic field in your motors that rotates <em>backwards</em>, fighting the
                            motor's rotation. This causes intense overheating and vibration in motors powered by the
                            same bus.</p>
                    </div>

                    <div id="sig-smps">
                        <h3>3. The "Shark Fin": Switch Mode Power Supplies (SMPS)</h3>
                        <p>This profile belongs to the modern office: Server racks, PC workstations, and LED lighting.
                            Unlike big industrial motors, these are single-phase electronic loads.</p>
                        <p><strong>The Mechanism:</strong> An SMPS converts AC to DC using a capacitor. The diode bridge
                            only conducts electricity when the grid voltage is <em>higher</em> than the voltage stored
                            in the capacitor. This happens only at the very peak of the sine wave. The power supply
                            takes a quick "gulp" of current at the top of the wave and then shuts off. The waveform
                            looks like a thin shark fin.</p>
                        <div class="highlight-box">
                            <strong>The Fingerprint:</strong> Because the pulse is so narrow, it is incredibly rich in
                            <strong>Triplen Harmonics</strong> (multiples of 3: 3rd, 9th, 15th). The 3rd harmonic can
                            often exceed 70-80% of the fundamental!
                        </div>
                        <p><strong>The Neutral Danger:</strong> In a 3-phase Wye system, the fundamental currents (A, B,
                            C) cancel each other out in the neutral wire. However, 3rd harmonics are "Zero
                            Sequence"—they are all in phase with each other. Instead of canceling, <strong>they add
                                up</strong>.
                            <br><em>Result:</em> You can measure 0 Amps on the phases but have the neutral wire glowing
                            red hot with 1.73x phase current. This is a common cause of electrical fires in office
                            buildings.
                        </p>
                    </div>

                    <div id="sig-sat">
                        <h3>4. The "Lopsided" Wave: Transformer Saturation</h3>
                        <p>Transformers are designed to operate within a specific magnetic limit. If you push them past
                            this limit (during energization inrush or over-voltage events), the iron core "saturates."
                        </p>
                        <p><strong>The Mechanism:</strong> Think of the core as a bucket. Once it's full of magnetic
                            flux, you can't pour more in. The relationship between Voltage and Current stops being
                            linear. The current spikes disproportionately high on one side of the wave while remaining
                            normal on the other, creating a lopsided, asymmetrical waveform.</p>
                        <div class="highlight-box">
                            <strong>The Fingerprint:</strong> Fourier analysis tells us that any <em>asymmetrical</em>
                            waveform must contain <strong>Even Harmonics</strong>. A strong presence of the <strong>2nd
                                Harmonic</strong> (and sometimes 4th) is the definitive signature of saturation or
                            inrush.
                        </div>
                        <p><strong>Protection Tip:</strong> Differential relays use this specific fingerprint (2nd
                            Harmonic Restraint) to prevent tripping when you energize a transformer. If the relay sees
                            high current + high 2nd harmonic, it knows it's just saturation, not a short circuit.</p>
                    </div>

                    <div id="sig-arc">
                        <h3>5. The "Chaos": Arc Furnaces & Welders</h3>
                        <p>Electric Arc Furnaces (EAFs) used in steelmaking are among the most difficult loads to
                            manage. They melt scrap metal by striking a massive electrical arc.</p>
                        <p><strong>The Mechanism:</strong> An electric arc is violent and chaotic. The resistance of the
                            arc changes thousands of times per second as the scrap metal melts and shifts. This chaotic
                            draw creates distortion at <em>every</em> frequency, not just integer multiples.</p>
                        <div class="highlight-box">
                            <strong>The Fingerprint:</strong> A raised "noise floor" across the entire spectrum.
                            Crucially, you will see <strong>Interharmonics</strong> (frequencies like 185Hz or 2.5th
                            harmonic). This looks like "grass" or noise between the main harmonic bars.
                        </div>
                        <p><strong>Consequences:</strong> Interharmonics interact with the fundamental to create "beat
                            frequencies" in the 1Hz–30Hz range. This frequency range is visible to the human eye,
                            causing light bulbs to strobe or flicker (Voltage Flicker), which can induce nausea in
                            humans.</p>
                    </div>

                    <div id="mitigation">
                        <h3>6. Impact & Mitigation Strategies</h3>
                        <ul>
                            <li><strong>Overheating:</strong> High frequency currents flow on the outer skin of
                                conductors (Skin Effect), effectively reducing the wire size and increasing resistance.
                                <em>Mitigation:</em> Oversize cables or use multi-strand conductors.
                            </li>
                            <li><strong>Resonance:</strong> If a harmonic frequency matches the resonant frequency of
                                your power factor correction capacitors, they can explode. <em>Mitigation:</em> Install
                                "Detuned Reactors" in series with capacitors.</li>
                            <li><strong>K-Rated Transformers:</strong> Standard transformers overheat with harmonic
                                loads. K-Rated transformers have beefier neutrals and special winding designs to handle
                                the heat.</li>
                            <li><strong>Active Filters:</strong> These advanced devices inject "anti-noise" (current
                                equal and opposite to the harmonics) to cancel out distortion in real-time.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- THEME & UI ---
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if (themeSwitch) {
                themeSwitch.addEventListener('change', function () {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                    updateChartTheme();
                });
            }

            const dropArea = document.getElementById('dropArea');
            const fileInput = document.getElementById('csvInput');

            if (dropArea) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, preventDefaults, false);
                });
                function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropArea.addEventListener(eventName, () => dropArea.classList.add('drag-over'), false);
                });
                ['dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, () => dropArea.classList.remove('drag-over'), false);
                });
                dropArea.addEventListener('drop', handleDrop, false);
                dropArea.addEventListener('click', () => fileInput.click());
            }

            if (fileInput) {
                fileInput.addEventListener('change', function () { handleFiles(this.files) });
            }

            const processBtn = document.getElementById('process-btn');
            if (processBtn) processBtn.addEventListener('click', () => analyze(false));
        });

        let rawData = []; // {t, v}
        let buildState = { h3: 0, h5: 0, h7: 0, h9: 0, h11: 0, h13: 0, noise: 0 };
        let activeTab = 'tab-upload';

        function handleDrop(e) {
            const dt = e.dataTransfer;
            handleFiles(dt.files);
        }

        function handleFiles(files) {
            const file = files[0];
            if (file) {
                const msgEl = document.querySelector('.file-msg');
                if (msgEl) msgEl.textContent = file.name;
                const reader = new FileReader();
                reader.onload = function (e) {
                    parseCSV(e.target.result);
                };
                reader.readAsText(file);
            }
        }

        function parseCSV(text) {
            const lines = text.split(/\r\n|\n/);
            rawData = [];
            let hasTime = false;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line || isNaN(line[0]) && line[0] !== '-') continue;

                const parts = line.split(/[,\t;]+/);
                if (parts.length >= 2) {
                    hasTime = true;
                    rawData.push({ t: parseFloat(parts[0]), v: parseFloat(parts[1]) });
                } else if (parts.length === 1 && !isNaN(parts[0])) {
                    rawData.push({ v: parseFloat(parts[0]) });
                }
            }

            if (hasTime && rawData.length > 10) {
                const dt = (rawData[rawData.length - 1].t - rawData[0].t) / (rawData.length - 1);
                let fs = 1 / dt;
                if (fs < 10) fs = fs * 1000;
                const rateEl = document.getElementById('sample-rate');
                if (rateEl) rateEl.value = Math.round(fs);
            }
            displayMessage("File Parsed: " + rawData.length + " samples", "success");
        }

        // --- TAB LOGIC ---
        function switchTab(id) {
            activeTab = id;
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            const target = document.getElementById(id);
            if (target) target.classList.add('active');

            const btns = document.querySelectorAll('.tab-btn');
            if (id === 'tab-upload' && btns[0]) btns[0].classList.add('active');
            else if (btns[1]) btns[1].classList.add('active');

            const pBtn = document.getElementById('process-btn');
            if (pBtn) {
                if (id === 'tab-build') {
                    pBtn.innerHTML = '<i class="fas fa-wave-square"></i> Synthesize & Analyze';
                    generateFromBuilder();
                } else {
                    pBtn.innerHTML = '<i class="fas fa-search-dollar"></i> Run Analysis';
                }
            }
        }

        // --- DEMO / BUILDER ---
        function loadDemo(type) {
            if (activeTab === 'tab-upload') {
                generateInternal(type);
                const msgEl = document.querySelector('.file-msg');
                if (msgEl) msgEl.textContent = "Demo: " + type.toUpperCase();
                analyze();
            } else {
                if (type === 'vfd') setSliders({ h5: 25, h7: 14, h11: 9, h13: 7, h3: 0 });
                else if (type === 'smps') setSliders({ h3: 70, h5: 40, h7: 20, h9: 10 });
                else if (type === 'sat') setSliders({ h3: 0, h5: 5 });
                generateFromBuilder();
            }
        }

        function setSliders(obj) {
            // Reset all first
            buildState = { h3: 0, h5: 0, h7: 0, h9: 0, h11: 0, h13: 0, noise: 0 };
            // Merge
            for (const k in obj) buildState[k] = obj[k];

            // Update UI elements
            for (const k in buildState) {
                const cleanKey = k.replace('h', ''); // 3, 5, or 'noise'
                const elId = k === 'noise' ? 'slider-noise' : 'slider-h' + cleanKey;
                const el = document.getElementById(elId);

                if (el) el.value = buildState[k];

                const spanId = k === 'noise' ? 'val-noise' : 'val-h' + cleanKey;
                const span = document.getElementById(spanId);
                if (span) span.textContent = buildState[k] + '%';
            }
        }

        window.updateBuilder = function (h, val) {
            const key = h === 'noise' ? 'noise' : 'h' + h;
            buildState[key] = parseFloat(val);
            const spanId = h === 'noise' ? 'val-noise' : 'val-h' + h;
            const span = document.getElementById(spanId);
            if (span) span.textContent = val + '%';
            generateFromBuilder();
        }

        function generateFromBuilder() {
            rawData = [];
            const fs = 3200;
            const f = 50;
            const cycles = 2;
            const points = (fs / f) * cycles;

            for (let i = 0; i < points; i++) {
                const t = i / fs;
                let v = 100 * Math.sin(2 * Math.PI * f * t);

                for (const k in buildState) {
                    if (k === 'noise') continue;
                    const order = parseInt(k.replace('h', ''));
                    if (buildState[k] > 0) {
                        // Phase logic for realism
                        // SMPS (Triplen) usually peaks to align with Voltage peak (0 phase relative to sin)
                        // VFD (5/7) usually counter-act.
                        // Simplified: Align all to 0 for "Peak Addition" worst case viz
                        let phase = 0;
                        if (order === 3) phase = Math.PI; // Invert to create "peaky" current typical of SMPS

                        v += buildState[k] * Math.sin(2 * Math.PI * order * f * t + phase);
                    }
                }
                if (buildState.noise > 0) {
                    v += (Math.random() - 0.5) * 2 * buildState.noise;
                }
                rawData.push({ t: t, v: v });
            }
            analyze(true);
        }

        function generateInternal(type) {
            rawData = [];
            const fs = 3200;
            const f = 50;
            const points = (fs / f) * 4;
            const freqEl = document.getElementById('sys-freq');
            if (freqEl) freqEl.value = 50;
            const rateEl = document.getElementById('sample-rate');
            if (rateEl) rateEl.value = fs;

            for (let i = 0; i < points; i++) {
                const t = i / fs;
                let v = 0;
                if (type === 'vfd') {
                    v = 100 * Math.sin(2 * Math.PI * f * t) + 25 * Math.sin(2 * Math.PI * 5 * f * t) + 14 * Math.sin(2 * Math.PI * 7 * f * t) + 9 * Math.sin(2 * Math.PI * 11 * f * t);
                } else if (type === 'smps') {
                    v = 100 * Math.sin(2 * Math.PI * f * t) + 70 * Math.sin(2 * Math.PI * 3 * f * t + Math.PI) + 40 * Math.sin(2 * Math.PI * 5 * f * t);
                } else if (type === 'sat') {
                    v = 100 * Math.sin(2 * Math.PI * f * t) + 30 * Math.sin(2 * Math.PI * 2 * f * t) + 10 * Math.sin(2 * Math.PI * 4 * f * t);
                }
                rawData.push({ t: t, v: v });
            }
        }

        // --- CORE ANALYSIS ---
        let timeChart = null;
        let freqChart = null;

        function analyze(silent = false) {
            if (rawData.length === 0) return !silent && displayMessage("No Data Loaded", "error");

            const freqEl = document.getElementById('sys-freq');
            const sysFreq = freqEl ? parseFloat(freqEl.value) || 50 : 50;

            const rateEl = document.getElementById('sample-rate');
            let fs = rateEl ? parseFloat(rateEl.value) : 3200;

            if (!fs || isNaN(fs)) fs = 3200;

            // 1. FFT
            const N = Math.pow(2, Math.floor(Math.log2(rawData.length)));
            if (N < 32) return !silent && displayMessage("Not enough samples", "error");

            const samples = rawData.slice(0, N).map(d => d.v);
            const windowed = samples.map((v, i) => v * (0.5 * (1 - Math.cos(2 * Math.PI * i / (N - 1)))));

            const re = [...windowed];
            const im = new Array(N).fill(0);
            fft(re, im);

            const binWidth = fs / N;
            const magnitudes = [];
            for (let i = 0; i < N / 2; i++) magnitudes.push(Math.sqrt(re[i] * re[i] + im[i] * im[i]) * 2 / N);

            // 2. Extract Harmonics
            const fundBinGuess = Math.round(sysFreq / binWidth);
            let fundIndex = fundBinGuess;
            let maxVal = 0;
            const searchRange = Math.max(1, Math.round(5 / binWidth));

            for (let i = Math.max(1, fundBinGuess - searchRange); i <= Math.min(N / 2, fundBinGuess + searchRange); i++) {
                if (magnitudes[i] > maxVal) { maxVal = magnitudes[i]; fundIndex = i; }
            }

            const I1 = maxVal;
            const harmonics = [];

            for (let h = 2; h <= 35; h++) {
                const targetFreq = h * (fundIndex * binWidth);
                const targetBin = Math.round(targetFreq / binWidth);
                if (targetBin < magnitudes.length) {
                    let hMag = 0;
                    for (let k = -1; k <= 1; k++) if (magnitudes[targetBin + k] > hMag) hMag = magnitudes[targetBin + k];
                    harmonics.push({ h: h, mag: hMag, pct: (hMag / I1) * 100 });
                }
            }

            // 3. THD
            const sumSquares = harmonics.reduce((acc, curr) => acc + curr.mag * curr.mag, 0);
            const THD = (Math.sqrt(sumSquares) / I1) * 100;

            // 4. Identification
            let diagnosis = "Unknown / Linear";
            let desc = "Low harmonic content.";
            let cardClass = "high-confidence";
            let tagClass = "tag-vfd";
            let domH = "-";

            const sortedH = [...harmonics].sort((a, b) => b.mag - a.mag);
            if (sortedH.length > 0 && sortedH[0].pct > 2) domH = sortedH[0].h + "th";

            if (THD < 3) {
                diagnosis = "Linear Load";
                tagClass = "tag-sat";
            } else {
                const h5 = harmonics.find(x => x.h === 5)?.pct || 0;
                const h7 = harmonics.find(x => x.h === 7)?.pct || 0;
                const h3 = harmonics.find(x => x.h === 3)?.pct || 0;
                const h2 = harmonics.find(x => x.h === 2)?.pct || 0;

                if (h5 > 10 && h5 > h3 && h5 > h2) {
                    diagnosis = "6-Pulse Drive (VFD)";
                    desc = "Strong 5th & 7th harmonics. Typical of 3-phase rectifiers.";
                    tagClass = "tag-vfd";
                } else if (h3 > 15 && h3 > h5) {
                    diagnosis = "SMPS (IT Load)";
                    desc = "Dominant 3rd harmonic. Typical of single-phase electronics.";
                    tagClass = "tag-smps";
                } else if (h2 > 5 || (harmonics.find(x => x.h === 4)?.pct || 0) > 2) {
                    diagnosis = "Transformer Saturation";
                    desc = "Even harmonics (2nd, 4th). Indicates asymmetry/inrush.";
                    tagClass = "tag-sat";
                } else {
                    diagnosis = "Complex / Mixed";
                    desc = "High distortion with no single dominant profile.";
                    cardClass = "med-confidence";
                    tagClass = "tag-sat";
                }
            }

            // 5. Render
            const safeSetText = (id, txt) => { const e = document.getElementById(id); if (e) e.textContent = txt; };

            safeSetText('res-thd', THD.toFixed(1) + "%");
            safeSetText('res-fund', I1.toFixed(1) + " A");
            safeSetText('res-rms', Math.sqrt(I1 * I1 / 2 + sumSquares / 2).toFixed(1) + " A");
            safeSetText('res-dom', domH);

            const diagCard = document.getElementById('diag-card');
            if (diagCard) diagCard.className = `rec-card ${cardClass}`;

            const sTag = document.getElementById('source-tag');
            if (sTag) { sTag.textContent = diagnosis; sTag.className = `rec-tag ${tagClass}`; }

            safeSetText('source-desc', desc);

            checkIEEE519(THD, harmonics);
            renderCharts(samples, magnitudes, binWidth, fundIndex, N);

            if (!silent) {
                const resCont = document.getElementById('result-container');
                if (resCont) {
                    resCont.classList.remove('hidden');
                    resCont.scrollIntoView({ behavior: 'smooth' });
                }
            }

            // Show Export Button if data exists
            const exBtn = document.getElementById('export-btn');
            if (exBtn) exBtn.style.display = 'inline-flex';
        }

        function checkIEEE519(thd, harmonics) {
            const scrEl = document.getElementById('grid-scr');
            const scr = scrEl ? parseInt(scrEl.value) : 20;

            let limits = {};
            if (scr < 20) limits = { h11: 4.0, h17: 2.0, h23: 1.5, h35: 0.6, tdd: 5.0 };
            else if (scr < 50) limits = { h11: 7.0, h17: 3.5, h23: 2.5, h35: 1.0, tdd: 8.0 };
            else if (scr < 100) limits = { h11: 10.0, h17: 4.5, h23: 4.0, h35: 1.5, tdd: 12.0 };
            else if (scr < 1000) limits = { h11: 12.0, h17: 5.5, h23: 5.0, h35: 2.0, tdd: 15.0 };
            else limits = { h11: 15.0, h17: 7.0, h23: 6.0, h35: 2.5, tdd: 20.0 };

            let oddH = { g1: 0, g2: 0, g3: 0, g4: 0 };
            harmonics.forEach(h => {
                if (h.h % 2 !== 0) {
                    if (h.h < 11) oddH.g1 = Math.max(oddH.g1, h.pct);
                    else if (h.h < 17) oddH.g2 = Math.max(oddH.g2, h.pct);
                    else if (h.h < 23) oddH.g3 = Math.max(oddH.g3, h.pct);
                    else if (h.h < 35) oddH.g4 = Math.max(oddH.g4, h.pct);
                }
            });

            const rows = [
                { l: "h < 11", v: oddH.g1, lim: limits.h11 },
                { l: "11 ≤ h < 17", v: oddH.g2, lim: limits.h17 },
                { l: "17 ≤ h < 23", v: oddH.g3, lim: limits.h23 },
                { l: "23 ≤ h < 35", v: oddH.g4, lim: limits.h35 },
                { l: "Total TDD/THD", v: thd, lim: limits.tdd }
            ];

            let html = "";
            rows.forEach(r => {
                const status = r.v <= r.lim ? '<span class="pass">PASS</span>' : '<span class="fail">FAIL</span>';
                html += `<tr><td>${r.l}</td><td>${r.lim.toFixed(1)}%</td><td>${r.v.toFixed(1)}%</td><td>${status}</td></tr>`;
            });
            const tableBody = document.getElementById('ieee-body');
            if (tableBody) tableBody.innerHTML = html;
        }

        function fft(re, im) {
            const n = re.length;
            let j = 0;
            for (let i = 0; i < n - 1; i++) {
                if (i < j) { [re[i], re[j]] = [re[j], re[i]];[im[i], im[j]] = [im[j], im[i]]; }
                let k = n / 2;
                while (k <= j) { j -= k; k /= 2; }
                j += k;
            }
            for (let l = 2; l <= n; l *= 2) {
                const angle = -2 * Math.PI / l;
                const w_re = Math.cos(angle);
                const w_im = Math.sin(angle);
                for (let i = 0; i < n; i += l) {
                    let u_re = 1, u_im = 0;
                    for (let k = 0; k < l / 2; k++) {
                        const idx = i + k + l / 2;
                        const t_re = u_re * re[idx] - u_im * im[idx];
                        const t_im = u_re * im[idx] + u_im * re[idx];
                        re[idx] = re[i + k] - t_re;
                        im[idx] = im[i + k] - t_im;
                        re[i + k] += t_re;
                        im[i + k] += t_im;
                        const temp_u_re = u_re * w_re - u_im * w_im;
                        u_im = u_re * w_im + u_im * w_re;
                        u_re = temp_u_re;
                    }
                }
            }
        }

        function renderCharts(timeData, freqData, binWidth, fundIndex, N) {
            const isDark = document.body.classList.contains('dark-mode');
            const gridColor = isDark ? '#334155' : '#E2E8F0';
            const textColor = isDark ? '#94a3b8' : '#64748b';

            const ctxT = document.getElementById('timeChart').getContext('2d');
            if (timeChart) timeChart.destroy();

            let renderTime = timeData;
            let labelsT = timeData.map((_, i) => i);
            if (timeData.length > 800) {
                renderTime = timeData.filter((_, i) => i % 2 === 0);
                labelsT = labelsT.filter((_, i) => i % 2 === 0);
            }

            timeChart = new Chart(ctxT, {
                type: 'line',
                data: {
                    labels: labelsT,
                    datasets: [{
                        label: 'Current (A)',
                        data: renderTime,
                        borderColor: '#2563EB',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { grid: { color: gridColor }, ticks: { color: textColor } }
                    }
                }
            });

            const ctxF = document.getElementById('freqChart').getContext('2d');
            if (freqChart) freqChart.destroy();

            const maxH = 25;
            const maxFreq = maxH * (fundIndex * binWidth);
            const maxBin = Math.min(Math.round(maxFreq / binWidth) + 5, N / 2);

            const freqLabels = [];
            const freqValues = [];

            for (let i = 0; i < maxBin; i++) {
                freqLabels.push((i * binWidth).toFixed(0));
                freqValues.push(freqData[i]);
            }

            freqChart = new Chart(ctxF, {
                type: 'bar',
                data: {
                    labels: freqLabels,
                    datasets: [{
                        label: 'Mag',
                        data: freqValues,
                        backgroundColor: '#F59E0B',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { title: { display: true, text: 'Hz', color: textColor }, grid: { display: false }, ticks: { color: textColor, maxTicksLimit: 15 } },
                        y: { grid: { color: gridColor }, ticks: { color: textColor } }
                    }
                }
            });
        }

        function updateChartTheme() {
            if (timeChart) {
                const isDark = document.body.classList.contains('dark-mode');
                const grid = isDark ? '#334155' : '#E2E8F0';
                const text = isDark ? '#94a3b8' : '#64748b';
                timeChart.options.scales.y.grid.color = grid;
                timeChart.options.scales.y.ticks.color = text;
                timeChart.update();
            }
            if (freqChart) {
                const isDark = document.body.classList.contains('dark-mode');
                const grid = isDark ? '#334155' : '#E2E8F0';
                const text = isDark ? '#94a3b8' : '#64748b';
                freqChart.options.scales.x.ticks.color = text;
                freqChart.options.scales.y.grid.color = grid;
                freqChart.options.scales.y.ticks.color = text;
                freqChart.update();
            }
        }

        function displayMessage(msg, type) {
            const box = document.getElementById('message-box');
            if (!box) return;
            box.textContent = msg;
            box.style.backgroundColor = type === 'error' ? 'var(--danger)' : (type === 'warning' ? 'var(--warning)' : 'var(--success)');
            box.classList.add('show');
            setTimeout(() => box.classList.remove('show'), 3000);
        }

        // Feature: Export Data
        window.exportData = function () {
            if (rawData.length === 0) return displayMessage("No data to export", "error");
            let csvContent = "data:text/csv;charset=utf-8,Time(s),Current(A)\n";
            rawData.forEach(function (row) {
                csvContent += `${row.t},${row.v}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "harmonic_waveform.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>

</html>
