<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battery Charging Time & C-Rate Calculator - Industrial & Residential</title>
    <meta name="description" content="Professional Battery Charging Calculator. Calculate charge time for Lead Acid, Li-ion, LiFePO4, and EV batteries using Peukert's Law and efficiency factors. Includes formulas and safety guides.">
    <meta name="keywords" content="battery charge time calculator, c-rate calculator, lead acid charging formula, lifepo4 charge calculator, EV charging time, solar battery calculator, ampere hour calculator, battery efficiency, peukert's law">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/batterycharging" />

    <!-- JSON-LD Schema for Google SEO & LLMs -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Battery Charging Time Calculator",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "A comprehensive engineering tool to calculate battery charging times, C-rates, and solar storage requirements for Lead Acid, Li-ion, and LiFePO4 chemistries.",
      "featureList": "Mobile Fast Charging, Home Inverter Calculation, Industrial Battery Banks, EV Solar Charging, C-Rate Conversion",
      "author": {
        "@type": "Organization",
        "name": "Design Calculators"
      }
    }
    </script>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #334155;
            --heading: #0F172A;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --input-bg: #FFFFFF;
        }

        body.dark-mode {
            --primary: #3B82F6;
            --secondary: #60A5FA;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #E2E8F0;
            --heading: #F8FAFC;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #FBBF24;
            --input-bg: #334155;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: -0.5px;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #DBEAFE;
            font-weight: 500;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            opacity: 0.9;
        }
        .nav-links a:hover { opacity: 1; transform: translateY(-1px); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 52px;
            height: 28px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255,255,255,0.2);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px; width: 20px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--success); border-color: var(--success); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* Main Content */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.75rem;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
            font-size: 0.95rem;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        /* Tool Switcher */
        .tool-switcher {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .tool-btn {
            background: var(--card);
            border: 2px solid var(--border);
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tool-btn:hover { border-color: var(--secondary); transform: translateY(-2px); }
        .tool-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }

        /* Module Containers */
        .tool-module { display: none; animation: fadeIn 0.4s ease-out; }
        .tool-module.active { display: block; }

        /* Results Big Display */
        .result-box {
            text-align: center;
            padding: 25px;
            background: var(--card);
            border: 2px solid var(--primary);
            border-radius: 12px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        .result-box::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 6px;
            background: var(--grad);
        }
        .main-value {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary);
            font-family: 'Montserrat', sans-serif;
            margin: 10px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .sub-value {
            font-size: 1.1rem;
            color: var(--text);
            opacity: 0.9;
            font-weight: 500;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Calculation Steps Styling */
        .calc-steps {
            text-align: left;
            margin-top: 25px;
            background: var(--bg);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text);
        }
        .calc-steps h4 { margin-top:0; color:var(--primary); font-family: 'Inter', sans-serif; }

        /* Battery Visualizer */
        .battery-viz-container {
            height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        .battery-shell {
            width: 200px;
            height: 100px;
            border: 4px solid var(--text);
            border-radius: 8px;
            position: relative;
            padding: 4px;
            background: var(--bg);
        }
        .battery-shell::after {
            content: "";
            position: absolute;
            top: 30px;
            right: -12px;
            width: 8px;
            height: 40px;
            background: var(--text);
            border-radius: 0 4px 4px 0;
        }
        .battery-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #10B981, #34D399);
            border-radius: 4px;
            transition: width 1s ease-out;
            position: relative;
            overflow: hidden;
        }
        /* Animated charging effect */
        .charging-anim {
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(45deg, rgba(255,255,255,.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.2) 50%, rgba(255,255,255,.2) 75%, transparent 75%, transparent);
            background-size: 20px 20px;
            animation: move-stripes 1s linear infinite;
            z-index: 2;
        }
        @keyframes move-stripes { from { background-position: 0 0; } to { background-position: 20px 0; } }

        .viz-label {
            position: absolute;
            width: 100%;
            text-align: center;
            top: 50%;
            transform: translateY(-50%);
            font-weight: 800;
            font-size: 1.5rem;
            color: var(--heading);
            z-index: 3;
            text-shadow: 0 0 5px white;
        }

        /* Chart */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            height: 300px;
            position: relative;
            margin-top: 20px;
        }

        /* Buttons (Shared) */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(37, 99, 235, 0.35); }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text); box-shadow: none; }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); background: rgba(37, 99, 235, 0.05); }

        /* Message Box */
        .message-box {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            padding: 16px 24px; border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 9999;
            font-weight: 600; color: white; opacity: 0; transition: all 0.3s; display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }

        /* Educational Section */
        .education-section { padding: 40px; }
        .article-content { font-family: 'Inter', sans-serif; color: var(--text); }
        .article-block { margin-bottom: 40px; }
        .article-block h3 { color: var(--primary); border-left: 5px solid var(--accent); padding-left: 15px; margin-bottom: 20px; font-size: 1.4rem; }
        .article-block h4 { color: var(--heading); margin-top: 20px; font-weight: 700; font-size: 1.1rem; }
        .article-block p { line-height: 1.8; margin-bottom: 15px; text-align: justify; }
        .article-block ul { padding-left: 20px; margin-bottom: 15px; }
        .article-block li { margin-bottom: 10px; }
        .formula { background: var(--bg); padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; font-size: 1.1rem; border: 1px solid var(--border); }

        /* Technical Docs Section (SEO Optimized) */
        .tech-docs {
            background: var(--bg);
            border-radius: 12px;
            padding: 25px;
            margin: 40px 0;
            border: 1px solid var(--border);
        }
        .tech-docs h3 { color: var(--secondary); margin-top: 0; font-size: 1.3rem; }
        .tech-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .tech-item { background: var(--card); padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* Footer */
        footer { background: var(--grad-dark); color: #94A3B8; padding: 60px 0 30px 0; margin-top: 80px; }
        .footer-content { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 40px; margin-bottom: 40px; }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 20px; font-weight: 700; font-size: 1.1rem; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col li { margin-bottom: 12px; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.2s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 20px; }
        .social-btn { width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; background: rgba(255,255,255,0.05); color: white; border-radius: 50%; font-size: 1rem; transition: all 0.2s; }
        .social-btn:hover { background: var(--secondary); transform: translateY(-3px); }
        .footer-disclaimer { text-align: center; padding-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); max-width: 900px; margin: 0 auto; font-size: 0.85rem; line-height: 1.6; }
        .footer-bottom { text-align: center; padding-top: 20px; font-size: 0.85rem; }
        .hidden { display: none; }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; width: 100%; text-align: center; }
            .tool-switcher { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href='/articles'>Articles</a></li>
                    <li><a href='/indexmech'>Mechanical</a></li>
                    <li><a href='/indexele'>Electrical</a></li>
                    <li><a href='/indexinst'>Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-battery-full"></i> Complete Battery Charging Suite</h2>
            <div class="tool-description">
                <p>Commercial-grade calculator for all battery types. Includes modules for <strong>Mobiles/Electronics</strong> (USB-PD, Fast Charging), <strong>Home Inverters</strong> (Lead Acid Tubular), <strong>Industrial Banks</strong>, and <strong>EV/Solar</strong> systems. Calculations account for Peukert's Law, Efficiency, and CC/CV curves.</p>
            </div>

            <!-- Tool Switcher -->
            <div class="tool-switcher">
                <button class="tool-btn active" onclick="switchTool('mobile')"><i class="fas fa-mobile-alt"></i> Mobile / USB</button>
                <button class="tool-btn" onclick="switchTool('inverter')"><i class="fas fa-home"></i> Home Inverter</button>
                <button class="tool-btn" onclick="switchTool('std')"><i class="fas fa-industry"></i> Industrial / Generic</button>
                <button class="tool-btn" onclick="switchTool('solar')"><i class="fas fa-solar-panel"></i> Solar / EV</button>
                <button class="tool-btn" onclick="switchTool('crate')"><i class="fas fa-tachometer-alt"></i> C-Rate</button>
            </div>

            <!-- Visualizer -->
            <div class="battery-viz-container">
                <div class="battery-shell">
                    <div class="battery-fill" id="viz-fill">
                        <div class="charging-anim"></div>
                    </div>
                    <div class="viz-label" id="viz-text">0.0 hrs</div>
                </div>
            </div>

            <!-- MODULE 1: MOBILE / SMALL ELECTRONICS -->
            <div id="mod-mobile" class="tool-module active">
                <div class="form-row">
                    <div class="form-group">
                        <label>Battery Capacity (mAh)</label>
                        <input type="number" id="mob-cap" value="5000">
                    </div>
                    <div class="form-group">
                        <label>Charger Rating</label>
                        <select id="mob-charger" onchange="toggleMobCustom()">
                            <option value="5">5W (Standard USB 1.0/2.0)</option>
                            <option value="10">10W (5V 2A)</option>
                            <option value="18">18W (QC 3.0 / PD)</option>
                            <option value="20">20W (iPhone Fast Charge)</option>
                            <option value="30">30W (PD Standard)</option>
                            <option value="65">65W (Laptop/SuperVOOC)</option>
                            <option value="custom">Custom Wattage</option>
                        </select>
                    </div>
                    <div class="form-group" id="mob-custom-grp" style="display:none;">
                        <label>Custom Watts (W)</label>
                        <input type="number" id="mob-custom-w" value="45">
                    </div>
                </div>
                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcMobile()">Calculate Mobile Charge</button>
                </div>
            </div>

            <!-- MODULE 2: HOME INVERTER -->
            <div id="mod-inverter" class="tool-module">
                <div class="form-row">
                    <div class="form-group">
                        <label>Battery Type</label>
                        <select id="inv-type">
                            <option value="tubular">Tall Tubular (Lead Acid) - C10/C20</option>
                            <option value="flat">Flat Plate (Lead Acid)</option>
                            <option value="gel">Gel / AGM (VRLA)</option>
                            <option value="lfp">Lithium (LiFePO4) Retrofit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Capacity (Ah)</label>
                        <input type="number" id="inv-cap" value="150" step="10">
                    </div>
                    <div class="form-group">
                        <label>Charging Current (A)</label>
                        <input type="number" id="inv-amp" value="15">
                        <p style="font-size:0.8rem; color:var(--text); margin-top:2px;">Standard is 10% of Capacity (e.g. 15A for 150Ah)</p>
                    </div>
                </div>
                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcInverter()">Calculate Inverter Charge</button>
                </div>
            </div>

            <!-- MODULE 3: STANDARD / INDUSTRIAL -->
            <div id="mod-std" class="tool-module">
                <div class="form-row">
                    <div class="form-group">
                        <label>Battery Capacity (Ah)</label>
                        <input type="number" id="std-cap" value="500">
                    </div>
                    <div class="form-group">
                        <label>Charging Current (Amps)</label>
                        <input type="number" id="std-current" value="50">
                    </div>
                    <div class="form-group">
                        <label>Chemistry / Efficiency</label>
                        <select id="std-chem" onchange="updateEfficiency('std')">
                            <option value="la-flooded">Lead Acid (Flooded) - 70% Eff</option>
                            <option value="la-agm">Lead Acid (AGM/Gel) - 85% Eff</option>
                            <option value="lfp">LiFePO4 (LFP) - 95% Eff</option>
                            <option value="li-ion">Li-ion (NMC) - 90% Eff</option>
                            <option value="nicd">NiCd / NiMH - 70% Eff</option>
                            <option value="custom">Custom Efficiency</option>
                        </select>
                    </div>
                </div>
                <div class="form-row" id="std-eff-row" style="display:none;">
                    <div class="form-group">
                        <label>Efficiency Factor (1.0 = 100%)</label>
                        <input type="number" id="std-eff" value="1.4" step="0.05">
                    </div>
                </div>
                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcStd()">Calculate Industrial</button>
                </div>
            </div>

            <!-- MODULE 4: SOLAR / EV -->
            <div id="mod-solar" class="tool-module">
                <div class="form-row">
                    <div class="form-group">
                        <label>Battery Energy (kWh)</label>
                        <input type="number" id="sol-kwh" value="60.0" step="0.1">
                        <p style="font-size:0.8rem; color:var(--text); margin-top:2px;">e.g., Tesla M3 (60), Powerwall (13.5)</p>
                    </div>
                    <div class="form-group">
                        <label>Charger Power (kW)</label>
                        <input type="number" id="sol-power" value="7.2" step="0.1">
                        <p style="font-size:0.8rem; color:var(--text); margin-top:2px;">Level 2 Home Charger (7.2 - 11 kW)</p>
                    </div>
                    <div class="form-group">
                        <label>Starting SoC (%)</label>
                        <input type="number" id="sol-soc" value="10" max="100">
                    </div>
                </div>
                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcSolar()">Calculate EV/Solar</button>
                </div>
            </div>

            <!-- MODULE 5: C-RATE -->
            <div id="mod-crate" class="tool-module">
                <div class="form-row">
                    <div class="form-group">
                        <label>Battery Capacity (Ah)</label>
                        <input type="number" id="crate-cap" value="100">
                    </div>
                    <div class="form-group">
                        <label>Solve For:</label>
                        <select id="crate-mode" onchange="toggleCrateInputs()">
                            <option value="time">Time (from C-Rate)</option>
                            <option value="current">Current (from C-Rate)</option>
                            <option value="crate">C-Rate (from Current)</option>
                        </select>
                    </div>
                    <div class="form-group" id="grp-crate-val">
                        <label>C-Rate (e.g. 1C, 0.5C)</label>
                        <input type="number" id="crate-val" value="0.5" step="0.1">
                    </div>
                    <div class="form-group" id="grp-crate-curr" style="display:none;">
                        <label>Current (Amps)</label>
                        <input type="number" id="crate-curr" value="20">
                    </div>
                </div>
                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcCrate()">Calculate</button>
                </div>
            </div>

            <!-- RESULTS & CHART -->
            <div class="result-box" id="main-result" style="display:none;">
                <div class="sub-value">Estimated Time to Full Charge</div>
                <div id="res-time" class="main-value">0h 0m</div>
                <div id="res-details" class="sub-value"></div>
                
                <div class="calc-steps" id="calc-steps-box"></div>

                <div class="chart-container">
                    <canvas id="chargeChart"></canvas>
                </div>
            </div>
            
            <div class="button-wrapper" style="margin-top:40px;">
                <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download Detailed Report</button>
            </div>
        </div>

        <!-- NEW SEO/LLM OPTIMIZED SECTION: How it works & Formulas -->
        <div class="card">
            <h2><i class="fas fa-microchip"></i> Calculator Technical Documentation</h2>
            <div class="article-content">
                <div class="tech-grid">
                    <div class="tech-item">
                        <h3><i class="fas fa-calculator"></i> 1. What This Tool Does</h3>
                        <p>This software models the electrochemical charging process for various battery chemistries. It solves for <strong>Charge Time (T)</strong>, <strong>Current (I)</strong>, and <strong>C-Rates</strong> by factoring in efficiency losses ($\eta$) and charging phases (Bulk/Absorption/Float).</p>
                        <ul>
                            <li><strong>Mobile:</strong> Models non-linear Li-ion fast charging curves (USB-PD/QC).</li>
                            <li><strong>Inverter:</strong> Applies heavy efficiency penalties for Lead Acid Tubular batteries used in residential backup.</li>
                            <li><strong>Industrial:</strong> Generic algorithms for large Forklift/Telecom banks.</li>
                        </ul>
                    </div>
                    <div class="tech-item">
                        <h3><i class="fas fa-square-root-alt"></i> 2. The Formulas Used</h3>
                        <p>Engineers value transparency. Here are the governing equations used in the backend:</p>
                        <div class="formula">
                            $$ T_{charge} = \frac{Capacity_{Ah}}{Current_{A}} \times \frac{1}{\eta_{eff}} + T_{absorb} $$
                        </div>
                        <p>Where:</p>
                        <ul style="font-size: 0.9rem;">
                            <li>$T_{charge}$: Total time in hours.</li>
                            <li>$\eta_{eff}$: Coulombic Efficiency (e.g., 0.7 for Flooded Lead Acid, 0.95 for LiFePO4).</li>
                            <li>$T_{absorb}$: Time added for Constant Voltage (CV) saturation phase.</li>
                        </ul>
                        <p><strong>C-Rate Formula:</strong> $$ C_{rate} = \frac{Current (A)}{Capacity (Ah)} $$</p>
                    </div>
                </div>

                <div class="tech-docs" style="margin-bottom:0;">
                    <h3><i class="fas fa-pencil-alt"></i> 3. Step-by-Step Example Calculation</h3>
                    <p><strong>Scenario:</strong> You have a 150Ah Tubular Lead Acid battery and a 15A charger.</p>
                    <ol>
                        <li><strong>Theoretical Time:</strong> Divide Capacity by Current. <br> $150Ah / 15A = 10 \text{ hours}$.</li>
                        <li><strong>Apply Inefficiency:</strong> Lead acid batteries heat up and gas during charging. We apply an efficiency factor ($\eta \approx 1.4$). <br> $10 \text{ hours} \times 1.4 = 14 \text{ hours}$.</li>
                        <li><strong>Result:</strong> The battery will take approximately 14 hours to reach 100% SoC.</li>
                    </ol>
                </div>

                <div class="tech-item" style="margin-top:30px; border-left: 4px solid var(--danger);">
                    <h3><i class="fas fa-shield-alt"></i> 4. Why This is Important for Safety & Reliability</h3>
                    <p>Calculating the correct charge time and C-rate is not just about convenience; it is critical for safety.</p>
                    <ul>
                        <li><strong>Thermal Runaway:</strong> Charging a battery faster than its C-Rate limit (e.g., >1C for standard Li-ion) causes internal resistance heat buildup, leading to fire.</li>
                        <li><strong>Lithium Plating:</strong> Charging Li-ion at low temperatures or high currents causes metallic lithium to plate on the anode, permanently damaging capacity and creating short-circuit risks.</li>
                        <li><strong>Cable Sizing:</strong> Knowing the current (Amps) ensures you select the right wire gauge (AWG) to prevent voltage drop and melting cables.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL SECTION (EXISTING) -->
        <div class="card education-section">
            <h2><i class="fas fa-book-open"></i> The Complete Guide to Battery Charging Physics</h2>
            <div class="article-content">
                
                <div class="article-block">
                    <h3>1. Fundamentals of Electrochemical Storage</h3>
                    <p>A battery stores electrical energy in the form of chemical energy. During charging, an external electrical source forces electrons into the anode (negative electrode) and ions move through the electrolyte to balance the charge. This process is inherently inefficient due to internal resistance ($I^2R$ losses) and secondary chemical reactions (like electrolysis/gassing in lead-acid or SEI layer formation in Lithium).</p>
                    <p>Understanding the specific chemistry is crucial because different batteries accept charge differently. "Forcing" energy into a battery faster than the chemical reaction can occur results in heat, gassing, and permanent damage.</p>
                </div>

                <div class="article-block">
                    <h3>2. Lead Acid Physics (The Peukert Effect & Efficiency)</h3>
                    <h4>Chemistry & Inefficiency</h4>
                    <p>Lead Acid batteries (Flooded, AGM, Gel) operate on the reaction between Lead Dioxide ($PbO_2$), Sponge Lead ($Pb$), and Sulfuric Acid ($H_2SO_4$). When charging, lead sulfate ($PbSO_4$) on the plates is converted back to active material. This process is only about <strong>70-85% efficient</strong>.</p>
                    <p><strong>The "Coulombic Efficiency":</strong> To put 100Ah into a flooded lead-acid battery, you typically need to supply ~120-140Ah. The excess energy is dissipated as heat and used to electrolyze water (gassing), which is why flooded cells need water topping.</p>
                    <h4>The 3-Stage Charging Algorithm</h4>
                    <ul>
                        <li><strong>Bulk (Stage 1):</strong> Constant Current (CC). The charger pushes max current. Voltage rises. Charges to ~80%.</li>
                        <li><strong>Absorption (Stage 2):</strong> Constant Voltage (CV). Voltage is held at absorption level (e.g., 14.4V). Current tapers off as internal resistance rises. This takes significant time.</li>
                        <li><strong>Float (Stage 3):</strong> Maintenance charge (e.g., 13.5V) to counteract self-discharge.</li>
                    </ul>
                </div>

                <div class="article-block">
                    <h3>3. Lithium-Ion & LiFePO4 Physics</h3>
                    <p>Lithium batteries function by moving Lithium ions ($Li^+$) between the cathode and anode (intercalation). This process is highly efficient (95-99%).</p>
                    <h4>Charging Profile (CC/CV)</h4>
                    <p>Lithium charging is strictly controlled to prevent metallic lithium plating (which causes fires).</p>
                    <ul>
                        <li><strong>Constant Current (CC):</strong> Fast charging phase. Voltage rises linearly.</li>
                        <li><strong>Constant Voltage (CV):</strong> Once the cell hits 4.2V (Li-ion) or 3.65V (LFP), voltage is clamped. Current drops exponentially. This last 10-20% of capacity can take 30-45 minutes regardless of how powerful the charger is.</li>
                    </ul>
                    <p><strong>Fast Charging limits:</strong> The rate of intercalation is limited by temperature and anode design. Pushing too hard causes Lithium Plating. Most EVs taper their charge rate significantly after 80% SoC for this reason.</p>
                </div>

                <div class="article-block">
                    <h3>4. Mobile & USB-PD Physics</h3>
                    <p>Modern smartphones use sophisticated Battery Management Systems (BMS) and protocols like <strong>USB Power Delivery (PD)</strong> or <strong>Qualcomm Quick Charge</strong>.</p>
                    <p>Unlike a dumb resistor, the phone communicates with the charger ("Handshake") to request specific voltages (5V, 9V, 12V, 20V). The charging is <strong>Thermal Limited</strong>. A 65W charger will not pump 65W into a phone continuously. It might peak at 65W for 10 minutes, then drop to 30W as the battery heats up, and finally trickle charge the last 10%.</p>
                    <p>This calculator applies a "Fast Charge Curve Factor" to approximate this non-linear behavior.</p>
                </div>

                <div class="article-block">
                    <h3>5. The C-Rate Definition</h3>
                    <p>C-Rate normalizes charge/discharge current against capacity.</p>
                    <div class="formula">$$ C-Rate = \frac{Current (A)}{Capacity (Ah)} $$</div>
                    <ul>
                        <li><strong>1C:</strong> Theoretically charges/discharges in 1 hour (e.g., 100A for 100Ah).</li>
                        <li><strong>0.5C:</strong> Charges in 2 hours (Gentle, good for longevity).</li>
                        <li><strong>3C+:</strong> High power applications (Drones, Power Tools), charges in <20 mins.</li>
                    </ul>
                </div>

                <div class="article-block">
                    <h3>6. Industrial & Inverter Battery Banks</h3>
                    <p>Large battery banks (e.g., 48V 600Ah forklift or home backup) face unique challenges:</p>
                    <ul>
                        <li><strong>Cable Resistance:</strong> High currents cause voltage drop ($V=IR$) in cables, causing the charger to see a false high voltage and switch to absorption phase too early, leading to undercharging.</li>
                        <li><strong>Equalization:</strong> Periodically, lead-acid banks need a controlled overcharge (Equalization) to balance the specific gravity of individual cells and remove sulfation.</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Empowering engineers with precision tools for complex analysis. If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons"><a href="#" class="social-btn linkedin"><i class="fab fa-linkedin-in"></i></a><a href="#" class="social-btn youtube"><i class="fab fa-youtube"></i></a><a href="#" class="social-btn twitter"><i class="fab fa-twitter"></i></a><a href="#" class="social-btn facebook"><i class="fab fa-facebook-f"></i></a></div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href='/indexele'>Electrical</a></li>
                        <li><a href='/indexmech'>Mechanical</a></li>
                        <li><a href='/indexinst'>Instrumentation</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>Calculations for educational use. Always verify component datasheets.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let chartInstance = null;
        let lastResult = {};

        // Data: Efficiency Factors (Multiplier applied to Ideal Time)
        const EFFICIENCY = {
            'la-flooded': 1.4,
            'la-agm': 1.15,
            'lfp': 1.05,
            'li-ion': 1.1,
            'nicd': 1.4,
            'custom': 1.0
        };

        // UI Logic
        document.addEventListener('DOMContentLoaded', () => {
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
            
            // Register Chart Plugin
            Chart.register(ChartDataLabels);
        });

        function switchTool(toolId) {
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            document.querySelectorAll('.tool-module').forEach(m => m.classList.remove('active'));
            document.getElementById('mod-' + toolId).classList.add('active');
            
            // Reset Result
            document.getElementById('main-result').style.display = 'none';
            document.getElementById('viz-fill').style.width = '0%';
            document.getElementById('viz-text').innerText = '0.0 hrs';
        }

        function updateEfficiency(prefix) {
            const type = document.getElementById(prefix + '-chem').value;
            const row = document.getElementById(prefix + '-eff-row');
            if (type === 'custom') {
                row.style.display = 'block';
            } else {
                row.style.display = 'none';
            }
        }

        function toggleCrateInputs() {
            const mode = document.getElementById('crate-mode').value;
            const grpC = document.getElementById('grp-crate-val');
            const grpA = document.getElementById('grp-crate-curr');
            
            if (mode === 'crate') {
                grpC.style.display = 'none';
                grpA.style.display = 'block';
            } else {
                grpC.style.display = 'block';
                grpA.style.display = 'none';
            }
        }

        function toggleMobCustom() {
            const val = document.getElementById('mob-charger').value;
            const row = document.getElementById('mob-custom-grp');
            row.style.display = (val === 'custom') ? 'block' : 'none';
        }

        // --- MATH ENGINES ---

        // 1. MOBILE CALCULATION
        function calcMobile() {
            const mah = parseFloat(document.getElementById('mob-cap').value);
            let watts = document.getElementById('mob-charger').value;
            if(watts === 'custom') watts = parseFloat(document.getElementById('mob-custom-w').value);
            else watts = parseFloat(watts);

            if(mah <= 0 || watts <= 0) return;

            // Convert Capacity to Wh (Assume 3.85V avg for modern Li-ion)
            const voltage = 3.85; 
            const energyWh = (mah * voltage) / 1000;

            // Fast Charging is non-linear. 
            // Efficiency factor varies: High power chargers throttle early.
            // Simplified Model: 
            // - Average effective charging power is ~70% of peak rating for 0-100%
            // - Add fixed overhead for CV phase trickle (approx 20 mins)
            
            const effectivePower = watts * 0.75; // avg power
            let hours = energyWh / effectivePower;
            
            // Add fixed CV overhead (approx 0.3 hrs)
            hours += 0.3;

            // Generate Steps
            let steps = `<h4>Calculation Steps (Mobile/Li-ion)</h4>`;
            steps += `1. <strong>Energy Capacity:</strong> $${mah}mAh \\times ${voltage}V = ${(mah*voltage).toFixed(0)} mWh = ${energyWh.toFixed(2)} Wh$<br>`;
            steps += `2. <strong>Effective Power:</strong> Rated ${watts}W charger averages ~75% due to thermal throttling = ${effectivePower.toFixed(1)}W.<br>`;
            steps += `3. <strong>Bulk Time:</strong> $${energyWh.toFixed(2)}Wh / ${effectivePower.toFixed(1)}W = ${((energyWh/effectivePower)*60).toFixed(0)} min$<br>`;
            steps += `4. <strong>CV Phase Overhead:</strong> Adding ~20-30 min for trickle charging last 10%.`;

            displayResult(hours, `Capacity: ${mah}mAh | Charger: ${watts}W`, steps);
            renderChart(hours, 'Mobile Fast Charge Profile', true);
        }

        // 2. INVERTER CALCULATION
        function calcInverter() {
            const type = document.getElementById('inv-type').value;
            const ah = parseFloat(document.getElementById('inv-cap').value);
            const amps = parseFloat(document.getElementById('inv-amp').value);
            
            if(ah <= 0 || amps <= 0) return;

            let eff = 1.4; // Default Flooded
            if(type === 'gel') eff = 1.2;
            if(type === 'lfp') eff = 1.05;

            const idealTime = ah / amps;
            const totalTime = idealTime * eff;

            let steps = `<h4>Calculation Steps (Inverter/Lead Acid)</h4>`;
            steps += `1. <strong>Ideal Time:</strong> $${ah}Ah / ${amps}A = ${idealTime.toFixed(1)} hours$<br>`;
            steps += `2. <strong>Efficiency Loss:</strong> ${type.toUpperCase()} chemistry efficiency factor is approx ${eff}.<br>`;
            steps += `3. <strong>Total Time:</strong> $${idealTime.toFixed(1)} \\times ${eff} = ${totalTime.toFixed(1)} hours$<br>`;
            steps += `<em>Note: Lead acid batteries require a slow absorption phase (last 20%) which extends time significantly.</em>`;

            displayResult(totalTime, `Type: ${type.toUpperCase()} | ${ah}Ah @ ${amps}A`, steps);
            renderChart(totalTime, 'Inverter Charge Curve');
        }

        // 3. STANDARD / INDUSTRIAL
        function calcStd() {
            const ah = parseFloat(document.getElementById('std-cap').value);
            const amps = parseFloat(document.getElementById('std-current').value);
            const type = document.getElementById('std-chem').value;
            let eff = 1.0;
            
            if (type === 'custom') eff = parseFloat(document.getElementById('std-eff').value);
            else eff = EFFICIENCY[type];

            if (ah <= 0 || amps <= 0) return;

            const idealHrs = ah / amps;
            let realHrs = idealHrs * eff;
            
            // Lithium adjustment
            if ((type === 'lfp' || type === 'li-ion') && idealHrs < 2) {
                realHrs += 0.5; 
            }

            let steps = `<h4>Calculation Breakdown</h4>`;
            steps += `1. <strong>Theoretical Time:</strong> Capacity / Current = ${idealHrs.toFixed(2)} hrs.<br>`;
            steps += `2. <strong>Efficiency Adjustment:</strong> Applied factor ${eff}x for ${type} chemistry.<br>`;
            if((type === 'lfp' || type === 'li-ion') && idealHrs < 2) {
                steps += `3. <strong>CV Phase Correction:</strong> Added 30 mins for Lithium constant voltage saturation.<br>`;
            }
            steps += `4. <strong>Final Estimate:</strong> ${realHrs.toFixed(2)} hours.`;

            displayResult(realHrs, `Capacity: ${ah}Ah | Current: ${amps}A`, steps);
            renderChart(realHrs, 'Standard Charge Curve');
        }

        // 4. SOLAR / EV
        function calcSolar() {
            const kwh = parseFloat(document.getElementById('sol-kwh').value);
            const kw = parseFloat(document.getElementById('sol-power').value);
            const soc = parseFloat(document.getElementById('sol-soc').value);
            
            if (kwh <= 0 || kw <= 0) return;

            const neededKwh = kwh * (1 - (soc/100));
            const eff = 1.1; // System losses
            const hours = (neededKwh / kw) * eff;
            
            let steps = `<h4>EV/Solar Calculation</h4>`;
            steps += `1. <strong>Energy Deficit:</strong> ${kwh}kWh $\\times$ (100% - ${soc}%) = ${neededKwh.toFixed(2)} kWh needed.<br>`;
            steps += `2. <strong>Charging Power:</strong> ${kw} kW source.<br>`;
            steps += `3. <strong>System Losses:</strong> Assuming 90% charger efficiency (1.1x factor).<br>`;
            steps += `4. <strong>Time:</strong> (${neededKwh.toFixed(2)} / ${kw}) $\\times$ 1.1 = ${hours.toFixed(2)} hours.`;

            displayResult(hours, `Target: ${neededKwh.toFixed(1)} kWh needed | Power: ${kw} kW`, steps);
            renderChart(hours, 'EV/Solar Charge Profile');
        }

        // 5. C-RATE
        function calcCrate() {
            const ah = parseFloat(document.getElementById('crate-cap').value);
            const mode = document.getElementById('crate-mode').value;
            
            let time = 0;
            let detail = "";
            let steps = "<h4>C-Rate Analysis</h4>";

            if (mode === 'time' || mode === 'current') {
                const c = parseFloat(document.getElementById('crate-val').value);
                if (mode === 'time') {
                    time = 1 / c; 
                    detail = `Rate: ${c}C | Current: ${ah * c} A`;
                    steps += `1. <strong>Formula:</strong> Time (h) = 1 / C-Rate.<br>`;
                    steps += `2. <strong>Result:</strong> 1 / ${c} = ${time.toFixed(2)} hours (Theoretical).`;
                } else {
                    const amps = ah * c;
                    const mainVal = amps.toFixed(1) + " A";
                    document.getElementById('res-time').innerText = mainVal;
                    document.getElementById('res-details').innerText = `Current required for ${c}C rate`;
                    document.getElementById('calc-steps-box').innerHTML = `Current = Capacity $\\times$ C-Rate = ${ah} $\\times$ ${c} = ${amps}A`;
                    document.getElementById('main-result').style.display = 'block';
                    document.getElementById('viz-fill').style.width = '100%';
                    document.getElementById('viz-text').innerText = mainVal;
                    if(chartInstance) chartInstance.destroy();
                    return;
                }
            } else {
                const amps = parseFloat(document.getElementById('crate-curr').value);
                const c = amps / ah;
                const mainVal = c.toFixed(2) + " C";
                document.getElementById('res-time').innerText = mainVal;
                document.getElementById('res-details').innerText = `Charge Rate based on ${amps}A`;
                document.getElementById('calc-steps-box').innerHTML = `C-Rate = Current / Capacity = ${amps} / ${ah} = ${c.toFixed(2)}C`;
                document.getElementById('main-result').style.display = 'block';
                document.getElementById('viz-fill').style.width = '100%';
                document.getElementById('viz-text').innerText = mainVal;
                if(chartInstance) chartInstance.destroy();
                return;
            }

            displayResult(time, detail, steps);
            renderChart(time, 'Theoretical C-Rate Curve');
        }

        // --- VISUALIZATION ---

        function displayResult(hours, details, stepsHtml) {
            const h = Math.floor(hours);
            const m = Math.round((hours - h) * 60);
            const timeStr = `${h}h ${m}m`;

            document.getElementById('main-result').style.display = 'block';
            document.getElementById('res-time').innerText = timeStr;
            document.getElementById('res-details').innerText = details;
            document.getElementById('calc-steps-box').innerHTML = stepsHtml;
            
            if(window.MathJax) window.MathJax.typesetPromise();

            // Anim
            document.getElementById('viz-text').innerText = timeStr;
            document.getElementById('viz-fill').style.width = '0%';
            setTimeout(() => {
                document.getElementById('viz-fill').style.width = '100%';
            }, 100);

            lastResult = { timeStr, details, hours };
        }

        function renderChart(totalHours, label, isFastCharge = false) {
            const ctx = document.getElementById('chargeChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();

            const points = 20;
            const labels = [];
            const data = [];
            
            for(let i=0; i<=points; i++) {
                const t_ratio = i/points; 
                const t_val = t_ratio * totalHours;
                labels.push(t_val.toFixed(1) + 'h');
                
                let soc = 0;
                // Fast charge profile: Very fast to 50%, then slows
                if(isFastCharge) {
                    if (t_ratio < 0.4) soc = (t_ratio / 0.4) * 60; // 0-60% in 40% time
                    else if (t_ratio < 0.8) soc = 60 + ((t_ratio-0.4)/0.4)*30; // 60-90% next 40%
                    else soc = 90 + ((t_ratio-0.8)/0.2)*10; // 90-100% last 20%
                } else {
                    // Standard CC/CV
                    if (t_ratio < 0.7) {
                        soc = (t_ratio / 0.7) * 80;
                    } else {
                        const remaining_ratio = (t_ratio - 0.7) / 0.3;
                        soc = 80 + (20 * Math.sin(remaining_ratio * Math.PI / 2)); 
                    }
                }
                
                if(soc > 100) soc = 100;
                data.push(soc);
            }

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'State of Charge (%)',
                        data: data,
                        borderColor: '#1E3A8A',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            title: { display: true, text: 'Charge %' }
                        },
                        x: {
                            title: { display: true, text: 'Time (Hours)' }
                        }
                    },
                    plugins: {
                        datalabels: { display: false }
                    }
                }
            });
        }

        function generatePDF() {
            if(!lastResult.timeStr) {
                alert("Calculate first!"); return;
            }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(18); doc.setTextColor(30, 58, 138);
            doc.text("Battery Charging Report", 14, 20);
            doc.setFontSize(12); doc.setTextColor(0);
            
            doc.text(`Estimated Time: ${lastResult.timeStr}`, 14, 40);
            doc.text(`Parameters: ${lastResult.details}`, 14, 50);
            
            const stepsText = document.getElementById('calc-steps-box').innerText;
            const splitSteps = doc.splitTextToSize(stepsText, 180);
            doc.text(splitSteps, 14, 70);
            
            doc.save('battery_report.pdf');
        }
    </script>
</body>
</html>
