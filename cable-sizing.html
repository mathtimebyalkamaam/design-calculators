<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Cable Sizing Calculator - IEC/BS/NEC Standards | Design Calculators</title>
    <meta name="description" content="Industry-grade cable sizing calculator complying with IEC 60364, BS 7671, and NEC standards. Professional tool for electrical engineers.">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    <style>
        :root {
            --primary-color: #1E3A8A;
            --secondary-color: #2563EB;
            --accent-color: #F59E0B;
            --success-color: #10B981;
            --warning-color: #F59E0B;
            --danger-color: #EF4444;
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-color: #4B5563;
            --heading-color: #111827;
            --footer-bg: #0F172A;
            --border-color: #E2E8F0;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --hover-color: #F1F5F9;
            --button-hover-shadow: 0 6px 20px rgba(30, 58, 138, 0.25);
            --highlight-bg: rgba(245, 158, 11, 0.15);
            --info-bg: rgba(37, 99, 235, 0.1);
            --success-bg: rgba(16, 185, 129, 0.1);
            --warning-bg: rgba(245, 158, 11, 0.1);
            --danger-bg: rgba(239, 68, 68, 0.1);
        }
        
        body.dark-mode {
            --primary-color: #3B82F6;
            --secondary-color: #60A5FA;
            --accent-color: #FBBF24;
            --success-color: #34D399;
            --warning-color: #FBBF24;
            --danger-color: #F87171;
            --bg-color: #0F172A;
            --card-bg: #1E293B;
            --text-color: #CBD5E1;
            --heading-color: #F1F5F9;
            --footer-bg: #020617;
            --border-color: #334155;
            --hover-color: #334155;
            --highlight-bg: rgba(251, 191, 36, 0.2);
            --info-bg: rgba(59, 130, 246, 0.2);
            --success-bg: rgba(52, 211, 153, 0.2);
            --warning-bg: rgba(251, 191, 36, 0.2);
            --danger-bg: rgba(248, 113, 113, 0.2);
        }

        /* FIX: Ensure FontAwesome solid icons render correctly by setting the required font-weight. */
        .fas, .fa-solid {
            font-weight: 900;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }
        
        .container { 
            max-width: 1280px; 
            margin: 0 auto; 
            padding: 0 24px; 
        }
        
        .content-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ===== HEADER ===== */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 24px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .navbar { 
            display: flex; 
            justify-content: space-between;
            align-items: center; 
        }
        
        .logo-container { 
            display: flex; 
            align-items: center; 
            gap: 16px; 
            text-decoration: none; 
            color: white;
            transition: transform 0.3s ease;
        }
        
        .logo-container:hover {
            transform: translateY(-2px);
        }
        
        .logo { 
            height: 56px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .theme-toggle { 
            display: flex; 
            align-items: center; 
            gap: 12px;
        }
        
        .theme-toggle .icon { 
            color: white; 
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }
        
        .theme-toggle .icon:hover {
            transform: scale(1.2);
        }
        
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 56px; 
            height: 30px;
        }
        
        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0;
            right: 0; 
            bottom: 0; 
            background-color: rgba(0,0,0,0.2); 
            transition: .4s; 
            border-radius: 30px; 
        }
        
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 22px; 
            width: 22px;
            left: 4px; 
            bottom: 4px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        input:checked + .slider { 
            background-color: var(--accent-color);
        }
        
        input:checked + .slider:before { 
            transform: translateX(26px); 
        }
        
        /* ===== MAIN CONTENT ===== */
        main { 
            padding: 40px 0 80px 0;
            min-height: calc(100vh - 200px);
        }
        
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--gradient-primary);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--button-hover-shadow);
        }
        
        /* ===== CALCULATOR CONTAINER ===== */
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 32px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .tool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .tool-header h2 {
            color: var(--primary-color);
            font-size: 2rem;
            font-weight: 800;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .professional-badge {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3);
        }
        
        .tool-actions {
            display: flex;
            gap: 12px;
        }
        
        .action-btn {
            background-color: var(--card-bg);
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .action-btn:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--button-hover-shadow);
        }
        
        .tool-description {
            background: var(--info-bg);
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tool-description p {
            margin-bottom: 10px;
            line-height: 1.8;
        }
        
        .tool-description p:last-child {
            margin-bottom: 0;
        }
        
        .standards-compliant {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
        }
        
        .standard-badge {
            background-color: var(--success-color);
            color: white;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }
        
        /* ===== FORM SECTIONS ===== */
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }
        
        .form-section:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            user-select: none;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--heading-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-icon {
            color: var(--primary-color);
            font-size: 1.4rem;
        }

        .section-content {
            max-height: 2000px; /* Kept for potential future use, but not actively collapsed */
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.4s ease;
            opacity: 1;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .required-mark {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select {
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.1);
            transform: translateY(-1px);
        }
        
        .form-group input:hover,
        .form-group select:hover {
            border-color: var(--secondary-color);
        }
        
        .form-group input[type="number"] {
            font-family: 'Roboto Mono', monospace;
        }
        
        .input-unit {
            position: relative;
        }
        
        .input-unit input {
            padding-right: 50px;
        }
        
        .unit-label {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            font-weight: 600;
            font-size: 0.9rem;
            pointer-events: none;
        }
        
        /* ===== TOOLTIPS ===== */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .info-icon {
            color: var(--primary-color);
            cursor: help;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .info-icon:hover {
            color: var(--secondary-color);
            transform: scale(1.2);
        }
        
        .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: #1F2937;
            color: white;
            text-align: left;
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 0.85rem;
            line-height: 1.5;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1F2937 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* ===== BUTTONS ===== */
        .button-group {
            display: flex;
            gap: 16px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .calculate-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--button-hover-shadow);
        }
        
        .calculate-btn:active {
            transform: translateY(-1px);
        }
        
        .calculate-btn .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.6);
            animation: ripple-effect 0.6s ease-out;
            transform: scale(0);
            pointer-events: none;
        }
        
        @keyframes ripple-effect {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .reset-btn {
            background-color: transparent;
            color: var(--text-color);
            border: 2px solid var(--border-color);
            padding: 16px 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background-color: var(--hover-color);
            border-color: var(--text-color);
        }
        
        /* ===== RESULTS CONTAINER ===== */
        .result-container {
            margin-top: 40px;
            padding: 32px;
            border-radius: 12px;
            background: var(--card-bg);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            display: none;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        
        .result-container.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 3px solid var(--success-color);
        }
        
        .result-header h3 {
            color: var(--success-color);
            font-size: 1.75rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
        }
        
        .export-btn {
            background-color: var(--card-bg);
            border: 2px solid var(--success-color);
            color: var(--success-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .export-btn:hover {
            background-color: var(--success-color);
            color: white;
        }
        
        /* ===== CALCULATION SUMMARY ===== */
        .calculation-summary {
            background: var(--success-bg);
            border: 2px solid var(--success-color);
            border-radius: 10px;
            padding: 24px;
            margin-bottom: 30px;
        }
        
        .summary-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--success-color);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .summary-item {
            text-align: center;
            padding: 16px;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        
        .summary-label {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 8px;
        }
        
        .summary-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--success-color);
            font-family: 'Roboto Mono', monospace;
        }
        
        .summary-unit {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
        }
        
        /* ===== CALCULATION DETAILS ===== */
        .calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 24px;
            margin-bottom: 30px;
        }
        
        .details-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .calculation-step {
            margin-bottom: 24px;
            animation: slideInLeft 0.5s ease-out;
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .step-header {
            font-weight: 700;
            color: var(--heading-color);
            margin-bottom: 10px;
            font-size: 1.05rem;
        }
        
        .step-description {
            color: var(--text-color);
            margin-bottom: 8px;
            line-height: 1.7;
        }
        
        .formula-box {
            background-color: var(--card-bg);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            font-family: 'Roboto Mono', monospace;
            overflow-x: auto;
            text-align: center;
            font-size: 1.1rem;
            color: var(--heading-color);
        }

        .calculation-value {
            background-color: var(--highlight-bg);
            padding: 12px;
            border-radius: 6px;
            font-family: 'Roboto Mono', monospace;
            margin: 8px 0;
            border-left: 4px solid var(--accent-color);
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .standard-note {
            font-style: italic;
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin-top: 8px;
            padding: 8px 12px;
            background-color: var(--info-bg);
            border-radius: 6px;
        }
        
        /* ===== RESULT TABLE ===== */
        .result-table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .result-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: var(--card-bg);
        }
        
        .result-table thead {
            background: var(--gradient-primary);
            color: white;
        }
        
        .result-table th {
            padding: 16px;
            text-align: left;
            font-weight: 700;
            font-size: 1rem;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .result-table th:first-child {
            border-top-left-radius: 10px;
        }
        
        .result-table th:last-child {
            border-top-right-radius: 10px;
        }
        
        .result-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }
        
        .result-table tbody tr {
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeInTableRow 0.5s ease-out forwards;
        }
        
        @keyframes fadeInTableRow {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .result-table tbody tr:hover {
            background-color: var(--hover-color);
        }
        
        .result-table tbody tr.highlight {
            background-color: var(--highlight-bg);
            font-weight: 700;
            color: var(--heading-color) !important;
        }

        .result-table tbody tr.highlight td {
            color: var(--heading-color);
        }
        
        .result-table tbody tr.highlight:hover {
            background-color: var(--highlight-bg);
        }
        
        .result-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .status-pass {
            background-color: var(--success-bg);
            color: var(--success-color);
        }
        
        .status-warning {
            background-color: var(--warning-bg);
            color: var(--warning-color);
        }
        
        .status-fail {
            background-color: var(--danger-bg);
            color: var(--danger-color);
        }
        
        /* ===== WARNINGS & NOTES ===== */
        .warning-box {
            background-color: var(--warning-bg);
            border-left: 4px solid var(--warning-color);
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .warning-box h4 {
            color: var(--warning-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-box {
            background-color: var(--info-bg);
            border-left: 4px solid var(--primary-color);
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .info-box h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .standard-reference {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .standard-reference h4 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        
        .standard-reference ul {
            list-style: none;
            padding: 0;
        }
        
        .standard-reference li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .standard-reference li:last-child {
            border-bottom: none;
        }
        
        .standard-reference li i {
            color: var(--success-color);
            margin-top: 4px;
        }
        
        /* ===== MESSAGE BOX ===== */
        .message-box {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transform: translateX(400px);
            transition: all 0.4s ease;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .message-box.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .message-box.success { background-color: var(--success-color); }
        .message-box.error { background-color: var(--danger-color); }
        .message-box.warning { background-color: var(--warning-color); color: #333; }
        .message-box.info { background-color: var(--primary-color); }
        
        /* ===== FOOTER ===== */
        footer { 
            background: var(--gradient-dark);
            color: #CBD5E1;
            padding: 80px 0 30px 0;
            margin-top: 80px;
        }
        
        .footer-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-col h4 { 
            font-size: 1.2rem;
            color: white; 
            margin-bottom: 1.5rem; 
            font-weight: 700;
        }
        
        .footer-col ul { 
            list-style: none; 
            padding: 0; 
        }
        
        .footer-col ul li { 
            margin-bottom: 1rem; 
        }
        
        .footer-col a { 
            color: #CBD5E1; 
            text-decoration: none; 
            transition: color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .footer-col a:hover { 
            color: var(--accent-color);
        }
        
        .footer-disclaimer {
            text-align: center;
            margin: 40px auto;
            padding-top: 40px;
            border-top: 1px solid #334155;
            max-width: 800px;
        }
        
        .footer-disclaimer h4 {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 1rem;
        }
        
        .footer-bottom { 
            text-align: center; 
            padding-top: 20px; 
            font-size: 0.9rem; 
            color: #94A3B8;
        }
        
        .footer-bottom a {
            color: #CBD5E1; 
            text-decoration: none; 
            transition: color 0.3s;
        }
        
        .footer-bottom a:hover {
            color: var(--accent-color);
        }
        
        .creator-name { 
            color: var(--secondary-color); 
            font-weight: bold; 
        }
        
        /* ===== LOADING SPINNER ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .loading-overlay.show {
            display: flex;
            opacity: 1;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .navbar { 
                flex-direction: column;
                gap: 20px; 
            }
            
            .logo-text {
                font-size: 1.5rem;
            }
            
            .tool-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .tool-actions {
                width: 100%;
                justify-content: flex-start;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .calculate-btn,
            .reset-btn {
                width: 100%;
                justify-content: center;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .export-buttons {
                width: 100%;
            }
            
            .export-btn {
                flex: 1;
                justify-content: center;
            }
            
            .message-box {
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .tooltiptext {
                width: 200px;
                margin-left: -100px;
            }
        }
        
        @media print {
            .header,
            .back-button,
            .tool-actions,
            .export-buttons,
            .button-group,
            footer {
                display: none !important;
            }
            
            .tool-container,
            .result-container {
                box-shadow: none;
                border: 1px solid #000;
            }
        }
    </style>
</head>
<body>

<header class="header">
    <div class="container">
        <nav class="navbar">
            <a href="/" class="logo-container">
                <!-- Using a placeholder for the logo -->
                <img src="https://placehold.co/100x100/1E3A8A/FFFFFF?text=DC" alt="Design Calculators Logo" class="logo">
                <span class="logo-text">Design Calculators</span>
            </a>
            <div class="theme-toggle">
                <i class="fas fa-sun icon"></i>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider"></span>
                </label>
                <i class="fas fa-moon icon"></i>
            </div>
        </nav>
    </div>
</header>

<main class="content-container">
    <a class='back-button' href="index.html">
        <i class="fas fa-arrow-left"></i> Back to Electrical Tools
    </a>
    
    <div class="tool-container">
        <div class="tool-header">
            <h2>
                <i class="fas fa-bolt"></i>
                Professional Cable Sizing Calculator
                <span class="professional-badge">Industry Grade</span>
            </h2>
            <div class="tool-actions">
                <button class="action-btn" onclick="saveCalculation()">
                    <i class="fas fa-save"></i> Save
                </button>
                <button class="action-btn" onclick="loadCalculation()">
                    <i class="fas fa-folder-open"></i> Load
                </button>
            </div>
        </div>
        
        <div class="tool-description">
            <p><strong>Welcome to the most comprehensive cable sizing calculator available online.</strong> This professional-grade tool performs complete cable sizing calculations in accordance with international electrical standards.</p>
            <p>Our calculator considers all critical factors: voltage drop, current carrying capacity (ampacity), thermal derating, short-circuit withstand capability, and protection coordination. Suitable for AC (single-phase and three-phase) and DC systems across all voltage levels.</p>
            
            <div class="standards-compliant">
                <span class="standard-badge"><i class="fas fa-check-circle"></i> IEC 60364</span>
                <span class="standard-badge"><i class="fas fa-check-circle"></i> BS 7671</span>
                <span class="standard-badge"><i class="fas fa-check-circle"></i> NEC (NFPA 70)</span>
                <span class="standard-badge"><i class="fas fa-check-circle"></i> IEC 60287</span>
            </div>
        </div>
        
        <form id="cable-sizing-form">
            <!-- SECTION 1: Basic Load Parameters -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-plug section-icon"></i>
                        Load & System Parameters
                    </div>
                </div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                System Type
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Select the electrical system configuration: DC, Single-Phase AC (2-wire), or Three-Phase AC (3-wire or 4-wire). This determines voltage drop calculation method.</span>
                                </span>
                            </label>
                            <select id="system-type" required>
                                <option value="three-phase">Three-Phase AC</option>
                                <option value="single-phase">Single-Phase AC</option>
                                <option value="dc">DC</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                System Voltage (V)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Nominal system voltage. For 3-phase: line-to-line voltage (e.g., 400V, 690V). For single-phase: line-to-neutral voltage (e.g., 230V). For DC: system voltage.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="voltage" min="1" max="1000000" step="1" value="400" required>
                                <span class="unit-label">V</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Load Current (A)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Maximum continuous operating current of the load (I<sub>B</sub>). For motors, enter rated full-load current (FLA). For other loads, enter maximum operating current.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="load-current" min="0.1" max="100000" step="0.1" value="100" required>
                                <span class="unit-label">A</span>
                            </div>
                        </div>
                        
                        <div class="form-group" id="power-factor-group">
                            <label>
                                <span class="required-mark">*</span>
                                Power Factor (cos φ)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Load power factor (0.1 to 1.0). Typical values: Resistive loads = 1.0, Inductive loads = 0.8-0.95, Motors = 0.85-0.9. Affects voltage drop calculation.</span>
                                </span>
                            </label>
                            <input type="number" id="power-factor" min="0.1" max="1" step="0.01" value="0.85" required>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Load Type
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Load characteristics affecting design current: Continuous (100%), Intermittent (80%), Motor Starting (125%), Welding (varies by duty cycle).</span>
                                </span>
                            </label>
                            <select id="load-type" required>
                                <option value="continuous">Continuous Load (100%)</option>
                                <option value="intermittent">Intermittent Load (80%)</option>
                                <option value="motor">Motor Load (125%)</option>
                                <option value="welding">Welding Load (Variable)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row" id="welding-duty-group" style="display: none;">
                        <div class="form-group">
                            <label>
                                Welding Duty Cycle (%)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Percentage of time the welding load is active. Affects the diversity factor for cable sizing.</span>
                                </span>
                            </label>
                            <input type="number" id="welding-duty" min="10" max="100" step="5" value="60">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Cable Length (m)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Total one-way cable length from source to load. Include all bends and vertical runs. Critical for voltage drop calculation.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="cable-length" min="0.1" max="100000" step="0.1" value="150" required>
                                <span class="unit-label">m</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Max Voltage Drop (%)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Maximum permissible voltage drop. IEC 60364-5-52: 3% for lighting, 5% for other loads. BS 7671: 3% for lighting (230V), 5% for other loads. Can be adjusted based on project requirements.</span>
                                </span>
                            </label>
                            <input type="number" id="max-voltage-drop" min="0.1" max="10" step="0.1" value="3" required>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECTION 2: Cable Configuration -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-cog section-icon"></i>
                        Cable Construction & Material
                    </div>
                </div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Conductor Material
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Copper: Higher conductivity, smaller size, more expensive. Aluminum: Lower conductivity, larger size, more economical for large cables. Copper resistivity = 17.24 nΩ·m, Aluminum = 28.26 nΩ·m @ 20°C.</span>
                                </span>
                            </label>
                            <select id="cable-material" required>
                                <option value="copper">Copper (Cu)</option>
                                <option value="aluminum">Aluminum (Al)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Insulation Type
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">PVC (70°C): Economical, max operating temp 70°C. XLPE/EPR (90°C): Higher current capacity, max operating temp 90°C, better for high temperatures. Silicone (180°C): Special applications.</span>
                                </span>
                            </label>
                            <select id="insulation-type" required>
                                <option value="pvc">PVC (70°C Max)</option>
                                <option value="xlpe">XLPE/EPR (90°C Max)</option>
                                <option value="silicone">Silicone Rubber (180°C Max)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Number of Cores
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Single-core: Separate cables per phase. Multi-core: All conductors in one cable. Affects current capacity due to mutual heating.</span>
                                </span>
                            </label>
                            <select id="num-cores" required>
                                <option value="single">Single Core</option>
                                <option value="2">2-Core</option>
                                <option value="3">3-Core</option>
                                <option value="4">4-Core</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                Cable Armoring
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Armored cables provide mechanical protection. SWA (Steel Wire Armour) or AWA (Aluminum Wire Armour). Affects AC losses and installation method.</span>
                                </span>
                            </label>
                            <select id="armor-type">
                                <option value="none">Unarmored</option>
                                <option value="swa">Steel Wire Armored (SWA)</option>
                                <option value="awa">Aluminum Wire Armored (AWA)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                Number of Parallel Runs
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Number of identical cables running in parallel to carry the load. Used for very high currents. Each cable carries equal current.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="parallel-runs" min="1" max="20" step="1" value="1">
                                <span class="unit-label">cables</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECTION 3: Installation Conditions -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-hard-hat section-icon"></i>
                        Installation Method & Environment
                    </div>
                </div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Installation Method
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Installation method affects heat dissipation and current carrying capacity. Reference: IEC 60364-5-52, Table 52-1 & Appendix A. BS 7671, Table 4A1-4E4.</span>
                                </span>
                            </label>
                            <select id="installation-method" required>
                                <optgroup label="Enclosed (Reduced Heat Dissipation)">
                                    <option value="A1">A1: Insulated conductors in conduit in thermally insulated wall</option>
                                    <option value="A2">A2: Multi-core cable in conduit in thermally insulated wall</option>
                                    <option value="B1">B1: Insulated conductors in conduit on/in masonry wall</option>
                                    <option value="B2">B2: Multi-core cable in conduit on/in masonry wall</option>
                                </optgroup>
                                <optgroup label="Clipped/Supported">
                                    <option value="C" selected>C: Cables clipped direct to surface or on cable tray (standard)</option>
                                    <option value="E">E: Cables in free air, spaced from surface</option>
                                    <option value="F">F: Single-core cables touching, in free air (trefoil or flat)</option>
                                    <option value="G">G: Single-core cables spaced, in free air</option>
                                </optgroup>
                                <optgroup label="Underground">
                                    <option value="D1">D1: Multi-core cable direct buried in ground</option>
                                    <option value="D2">D2: Multi-core cable in buried conduit/duct</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Ambient Temperature (°C)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Air temperature for aerial/surface cables, ground temperature for buried cables. Standard reference: 30°C (air), 20°C (ground). Ref: IEC 60364-5-52, Tables B.52.14 & B.52.15.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="ambient-temp" min="-50" max="100" step="1" value="30" required>
                                <span class="unit-label">°C</span>
                            </div>
                        </div>
                        
                        <div class="form-group" id="soil-resistivity-group" style="display: none;">
                            <label>
                                Soil Thermal Resistivity (K·m/W)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Thermal resistivity of soil for buried cables. Standard: 2.5 K·m/W (dry soil). Values: 1.0 (very wet), 1.5 (moist), 2.0 (normal), 2.5 (dry), 3.0 (very dry). Ref: IEC 60364-5-52, Table B.52.16.</span>
                                </span>
                            </label>
                            <select id="soil-resistivity">
                                <option value="1.0">1.0 - Very Wet Soil</option>
                                <option value="1.5">1.5 - Moist Soil</option>
                                <option value="2.0">2.0 - Normal Soil</option>
                                <option value="2.5" selected>2.5 - Dry Soil (Standard)</option>
                                <option value="3.0">3.0 - Very Dry Soil</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Number of Circuits/Cables in Group
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Number of loaded circuits/cables bunched or grouped together. Causes mutual heating, requiring derating. Ref: IEC 60364-5-52, Table B.52.17. BS 7671, Tables 4C1-4C6.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="num-circuits" min="1" max="50" step="1" value="1" required>
                                <span class="unit-label">circuits</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                Depth of Burial (m)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Depth below ground surface for buried cables. Standard: 0.7-0.8m. Affects derating factor. Deeper burial = better heat dissipation up to certain depth.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="burial-depth" min="0" max="10" step="0.1" value="0.8">
                                <span class="unit-label">m</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                Conduit/Tray Fill Factor (%)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Percentage of conduit/tray cross-section filled with cables. Affects heat dissipation. Standard: 40% for conduits, 60% for trays. Higher fill = more derating.</span>
                                </span>
                            </label>
                            <input type="number" id="fill-factor" min="10" max="100" step="5" value="40">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECTION 4: Protection & Fault Considerations -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-shield-alt section-icon"></i>
                        Short Circuit & Protection
                    </div>
                </div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Prospective Short Circuit Current (kA)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Maximum fault current (I<sub>sc</sub>) at cable origin. Used to verify cable can withstand short-circuit energy. Ref: IEC 60364-4-43, Clause 434.3. Obtain from fault level study.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="short-circuit-current" min="0.1" max="500" step="0.1" value="25" required>
                                <span class="unit-label">kA</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <span class="required-mark">*</span>
                                Fault Clearance Time (s)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Maximum time for protective device to clear fault (t). Typical: 0.1s (MCB), 0.2-5s (fuse). Used with I<sub>sc</sub> to calculate minimum cable size using adiabatic equation: S = I·√t/k</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="short-circuit-duration" min="0.01" max="5" step="0.01" value="0.1" required>
                                <span class="unit-label">s</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                Earth Fault Loop Impedance (Ω)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Maximum earth fault loop impedance (Z<sub>s</sub>) for ensuring automatic disconnection. Optional: Used for protection coordination verification. Ref: IEC 60364-4-41, BS 7671 Chapter 41.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="earth-loop-impedance" min="0" max="100" step="0.01" value="0.35">
                                <span class="unit-label">Ω</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                Protective Device Type
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Type of overcurrent protective device. Affects disconnection time and coordination. MCB: Fast, thermal-magnetic. Fuse: Slower, I2t characteristic. MCCB: Adjustable.</span>
                                </span>
                            </label>
                            <select id="protection-type">
                                <option value="mcb">MCB (Miniature Circuit Breaker)</option>
                                <option value="mccb">MCCB (Molded Case Circuit Breaker)</option>
                                <option value="fuse">Fuse (BS 88 / IEC 60269)</option>
                                <option value="acb">ACB (Air Circuit Breaker)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                Protective Device Rating (A)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Nominal rating of protective device (I<sub>n</sub>). Cable current capacity (I<sub>z</sub>) must be ? I<sub>n</sub>. Coordination: I<sub>B</sub> ? I<sub>n</sub> ? I<sub>z</sub>. Ref: IEC 60364-5-52, Clause 433.1.</span>
                                </span>
                            </label>
                            <div class="input-unit">
                                <input type="number" id="protection-rating" min="1" max="10000" step="1" value="125">
                                <span class="unit-label">A</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECTION 5: Advanced Options -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-sliders-h section-icon"></i>
                        Advanced Options
                    </div>
                </div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                Calculation Standard
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Select the electrical standard for calculations. IEC 60364 (International), BS 7671 (UK), NEC (USA). Different standards may have different voltage drop limits and derating factors.</span>
                                </span>
                            </label>
                            <select id="standard">
                                <option value="iec">IEC 60364 (International)</option>
                                <option value="bs">BS 7671 (UK Wiring Regulations)</option>
                                <option value="nec">NEC - NFPA 70 (USA)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                Harmonic Content (THD %)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Total Harmonic Distortion of load current. Non-linear loads (VFDs, UPS, LED) create harmonics. THD > 15% requires derating and may need oversized neutral. Ref: IEC 61000-2-2.</span>
                                </span>
                            </label>
                            <input type="number" id="thd" min="0" max="100" step="1" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label>
                                Diversity Factor
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Ratio of actual maximum demand to total connected load (0.1 to 1.0). Accounts for not all loads operating simultaneously. 1.0 = no diversity (conservative). < 1.0 = diversity applied.</span>
                                </span>
                            </label>
                            <input type="number" id="diversity-factor" min="0.1" max="1" step="0.05" value="1">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                Future Load Growth (%)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Anticipated increase in load over cable lifetime. E.g., 20% growth factor multiplies load current by 1.20. Good practice for future-proofing installations.</span>
                                </span>
                            </label>
                            <input type="number" id="future-growth" min="0" max="100" step="5" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label>
                                Economic Conductor Size Optimization
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Enable to calculate economically optimal conductor size considering capital cost vs. energy losses over cable lifetime. Requires electricity cost and project lifetime.</span>
                                </span>
                            </label>
                            <select id="economic-optimization">
                                <option value="no">No - Technical Sizing Only</option>
                                <option value="yes">Yes - Include Economic Analysis</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row" id="economic-params" style="display: none;">
                        <div class="form-group">
                            <label>Electricity Cost ($/kWh)</label>
                            <div class="input-unit">
                                <input type="number" id="electricity-cost" min="0" max="1" step="0.01" value="0.12">
                                <span class="unit-label">$/kWh</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Cable Lifetime (years)</label>
                            <div class="input-unit">
                                <input type="number" id="cable-lifetime" min="1" max="50" step="1" value="25">
                                <span class="unit-label">years</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Annual Operating Hours (h/year)</label>
                            <div class="input-unit">
                                <input type="number" id="operating-hours" min="1" max="8760" step="1" value="8760">
                                <span class="unit-label">h/year</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CALCULATION BUTTONS -->
            <div class="button-group">
                <button type="button" id="calculate-btn" class="calculate-btn">
                    <i class="fas fa-calculator"></i>
                    Calculate Cable Size
                </button>
                <button type="button" class="reset-btn" onclick="resetForm()">
                    <i class="fas fa-redo"></i>
                    Reset Form
                </button>
            </div>
        </form>
        
        <!-- RESULTS SECTION -->
        <div id="result-container" class="result-container">
            <div class="result-header">
                <h3>
                    <i class="fas fa-check-circle"></i>
                    Calculation Results
                </h3>
                <div class="export-buttons">
                    <button class="export-btn" onclick="printResults()">
                        <i class="fas fa-print"></i>
                        Print
                    </button>
                    <button class="export-btn" onclick="exportPDF()">
                        <i class="fas fa-file-pdf"></i>
                        Export PDF
                    </button>
                </div>
            </div>
            
            <!-- SUMMARY -->
            <div class="calculation-summary">
                <div class="summary-title">
                    <i class="fas fa-star"></i>
                    Recommended Cable Size
                </div>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Cable Size</div>
                        <div class="summary-value" id="summary-cable-size">—</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Actual Voltage Drop</div>
                        <div class="summary-value" id="summary-voltage-drop">—</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Derated Ampacity</div>
                        <div class="summary-value" id="summary-ampacity">—</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Governing Criterion</div>
                        <div class="summary-value" id="summary-criterion" style="font-size: 1.2rem;">—</div>
                    </div>
                </div>
            </div>
            
            <!-- DETAILED CALCULATIONS -->
            <div class="calculation-details" id="calculation-details">
                <!-- Populated by JavaScript -->
            </div>
            
            <!-- RESULTS TABLE -->
            <div class="details-title">
                <i class="fas fa-stream"></i>
                Final Cable Verification
            </div>
            <div class="result-table-container">
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Requirement</th>
                            <th>Calculated Value</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- WARNINGS/NOTES -->
            <div id="warnings-container">
                <!-- Populated by JavaScript -->
            </div>
            
            <!-- STANDARD REFERENCES -->
            <div class="standard-reference">
                <h4><i class="fas fa-book"></i> Applicable Standards & Clauses</h4>
                <ul id="standards-list">
                    <!-- Populated by JavaScript -->
                </ul>
            </div>
        </div>
    </div>
</main>

<footer>
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="indexele.html"><i class="fas fa-bolt"></i> Electrical Tools</a></li>
                    <li><a href="indexmech.html"><i class="fas fa-cog"></i> Mechanical Tools</a></li>
                    <li><a href="indexinst.html"><i class="fas fa-gauge"></i> Instrumentation Tools</a></li>
                    <li><a href="index.html"><i class="fas fa-blog"></i> Blog & Articles</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Legal</h4>
                <ul>
                    <li><a href="privacy-policy.html"><i class="fas fa-shield-alt"></i> Privacy Policy</a></li>
                    <li><a href="terms-of-service.html"><i class="fas fa-file-contract"></i> Terms of Service</a></li>
                    <li><a href="sitemap2.html"><i class="fas fa-sitemap"></i> Sitemap</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>About</h4>
                <ul>
                    <li><a href="about.html"><i class="fas fa-info-circle"></i> About Us</a></li>
                    <li><a href="contact.html"><i class="fas fa-envelope"></i> Contact Us</a></li>
                    <li><a href="faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-disclaimer">
            <h4><i class="fas fa-exclamation-triangle"></i> Professional Disclaimer</h4>
            <p>This calculator provides engineering guidance based on international standards. All results must be verified by a qualified professional engineer and checked against local electrical codes, project specifications, and manufacturer data. </p>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
        </div>
    </div>
</footer>

<div class="message-box" id="message-box"></div>
<div class="loading-overlay" id="loading-overlay">
    <div class="spinner"></div>
</div>

<script>
// ==========================================
// PROFESSIONAL CABLE SIZING CALCULATOR
// Version: 2.5 (UI & Verbosity Enhancements)
// Standards: IEC 60364, BS 7671, NEC
// ==========================================

document.addEventListener('DOMContentLoaded', function() {
    initializeCalculator();
});

// ========== INITIALIZATION ==========
function initializeCalculator() {
    setupEventListeners();
    loadSavedData();
    updateConditionalFields();
}

// ========== EVENT LISTENERS ==========
function setupEventListeners() {
    const calculateBtn = document.getElementById('calculate-btn');
    const systemType = document.getElementById('system-type');
    const loadType = document.getElementById('load-type');
    const installationMethod = document.getElementById('installation-method');
    const economicOpt = document.getElementById('economic-optimization');
    const themeSwitch = document.getElementById('theme-switch');

    calculateBtn.addEventListener('click', handleCalculation);
    systemType.addEventListener('change', updateConditionalFields);
    loadType.addEventListener('change', updateConditionalFields);
    installationMethod.addEventListener('change', updateConditionalFields);
    economicOpt.addEventListener('change', updateConditionalFields);
    
    // Ripple effect
    calculateBtn.addEventListener('click', createRipple);

    // Theme switcher logic
    themeSwitch.addEventListener('change', () => {
        document.body.classList.toggle('dark-mode');
    });
}

function createRipple(e) {
    const button = e.currentTarget;
    const ripple = document.createElement('span');
    const diameter = Math.max(button.clientWidth, button.clientHeight);
    const radius = diameter / 2;
    
    ripple.style.width = ripple.style.height = `${diameter}px`;
    ripple.style.left = `${e.clientX - button.getBoundingClientRect().left - radius}px`;
    ripple.style.top = `${e.clientY - button.getBoundingClientRect().top - radius}px`;
    ripple.classList.add('ripple');
    
    const existingRipple = button.querySelector('.ripple');
    if (existingRipple) {
        existingRipple.remove();
    }
    
    button.appendChild(ripple);
    ripple.addEventListener('animationend', () => ripple.remove());
}


function updateConditionalFields() {
    const systemType = document.getElementById('system-type').value;
    const loadType = document.getElementById('load-type').value;
    const installation = document.getElementById('installation-method').value;
    const economicOpt = document.getElementById('economic-optimization').value;
    
    document.getElementById('power-factor-group').style.display = systemType === 'dc' ? 'none' : 'flex';
    document.getElementById('welding-duty-group').style.display = loadType === 'welding' ? 'flex' : 'none';
    document.getElementById('soil-resistivity-group').style.display = installation.startsWith('D') ? 'flex' : 'none';
    document.getElementById('economic-params').style.display = economicOpt === 'yes' ? 'flex' : 'none';
}

// This function is no longer needed as all sections are visible.
// function toggleSection(headerElement) { ... }

// ========== CORE DATA TABLES ==========
const CONDUCTOR_DATA = {
    copper: {
        resistivity20: 0.01724, // Ω·mm²/m at 20°C
        tempCoeff: 0.00393, // 1/°C
        density: 8.96, // g/cm³
        specificHeat: 385, // J/(kg·K)
    },
    aluminum: {
        resistivity20: 0.02826,
        tempCoeff: 0.00403,
        density: 2.70,
        specificHeat: 897,
    },
};

const TEMP_CORRECTION_AIR = {
    pvc: { 10:1.22, 15:1.17, 20:1.12, 25:1.06, 30:1.0, 35:0.94, 40:0.87, 45:0.79, 50:0.71, 55:0.61, 60:0.5, 65:0.35 },
    xlpe: { 10:1.15, 15:1.12, 20:1.08, 25:1.04, 30:1.0, 35:0.96, 40:0.91, 45:0.87, 50:0.82, 55:0.76, 60:0.71, 65:0.65, 70:0.58, 75:0.5, 80:0.41, 85:0.29 },
    silicone: { 10:1.04, 25:1.02, 40:1.0, 55:0.98, 70:0.95, 85:0.93, 100:0.9, 115:0.87, 130:0.83, 145:0.78, 160:0.71 }
};

const TEMP_CORRECTION_GROUND = {
    pvc: { 10:1.1, 15:1.05, 20:1.0, 25:0.95, 30:0.89, 35:0.84, 40:0.77, 45:0.71, 50:0.63, 55:0.55, 60:0.45 },
    xlpe: { 10:1.07, 15:1.04, 20:1.0, 25:0.96, 30:0.93, 35:0.89, 40:0.85, 45:0.8, 50:0.76, 55:0.71, 60:0.65, 65:0.6, 70:0.53, 75:0.46, 80:0.38 },
    silicone: { 10:1.03, 25:1.01, 40:1.0, 55:0.98, 70:0.97, 85:0.95, 100:0.93, 115:0.91, 130:0.88, 145:0.85 }
};

const SOIL_RESISTIVITY_FACTOR = { "1.0":1.18, "1.5":1.1, "2.0":1.05, "2.5":1.0, "3.0":0.96 };

const GROUPING_FACTOR = { 1:1.0, 2:0.8, 3:0.7, 4:0.65, 5:0.6, 6:0.57, 7:0.54, 8:0.52, 9:0.5, 10:0.48, 12:0.45, 14:0.43, 16:0.41, 18:0.39, 20:0.38 };

const STANDARD_SIZES = [ 1.5, 2.5, 4, 6, 10, 16, 25, 35, 50, 70, 95, 120, 150, 185, 240, 300, 400, 500, 630, 800, 1000 ];

const CURRENT_CAPACITY = {
    copper: {
        pvc: { A1:{1.5:13.5,2.5:18,4:24,6:30,10:42,16:56,25:73,35:89,50:108,70:136,95:164,120:188,150:216,185:245,240:286,300:328,400:382,500:435,630:500}, A2:{1.5:12.5,2.5:16.5,4:22,6:28,10:38,16:52,25:68,35:84,50:99,70:125,95:150,120:172,150:196,185:223,240:260,300:297,400:346,500:394,630:453}, B1:{1.5:17.5,2.5:24,4:32,6:41,10:57,16:76,25:101,35:125,50:151,70:192,95:232,120:269,150:309,185:353,240:415,300:477,400:558,500:641,630:741}, B2:{1.5:15.5,2.5:21,4:28,6:36,10:50,16:68,25:89,35:110,50:134,70:171,95:207,120:239,150:275,185:314,240:370,300:426,400:499,500:572,630:662}, C:{1.5:19.5,2.5:26,4:35,6:45,10:61,16:81,25:106,35:131,50:158,70:200,95:242,120:278,150:319,185:364,240:430,300:497,400:583,500:669,630:779}, D1:{1.5:17,2.5:23,4:30,6:38,10:52,16:69,25:90,35:111,50:134,70:171,95:207,120:239,150:275,185:314,240:370,300:426,400:499,500:572,630:662}, D2:{1.5:16,2.5:21,4:28,6:35,10:48,16:63,25:82,35:101,50:122,70:156,95:188,120:217,150:249,185:284,240:335,300:386,400:452,500:518,630:599}, E:{1.5:22,2.5:30,4:40,6:51,10:70,16:94,25:119,35:148,50:180,70:232,95:282,120:328,150:379,185:434,240:514,300:593,400:700,500:807,630:946}, F:{1.5:26,2.5:35,4:46,6:59,10:81,16:108,25:138,35:171,50:209,70:269,95:328,120:382,150:441,185:506,240:599,300:693,400:821,500:947,630:1112}, G:{1.5:28,2.5:38,4:50,6:64,10:88,16:117,25:149,35:185,50:225,70:289,95:352,120:410,150:473,185:542,240:642,300:742,400:878,500:1012,630:1188}, },
        xlpe: { A1:{1.5:17,2.5:23,4:30,6:38,10:52,16:69,25:90,35:111,50:133,70:168,95:201,120:232,150:265,185:300,240:351,300:401,400:464,500:526,630:604}, A2:{1.5:15.5,2.5:21,4:27,6:35,10:47,16:63,25:81,35:100,50:121,70:154,95:185,120:214,150:245,185:279,240:328,300:376,400:437,500:497,630:571}, B1:{1.5:23,2.5:31,4:41,6:52,10:71,16:96,25:126,35:158,50:192,70:246,95:298,120:346,150:399,185:456,240:539,300:622,400:735,500:848,630:986}, B2:{1.5:20,2.5:27,4:36,6:46,10:63,16:85,25:112,35:138,50:168,70:216,95:261,120:303,150:349,185:399,240:471,300:543,400:641,500:738,630:859}, C:{1.5:25,2.5:34,4:45,6:58,10:79,16:107,25:138,35:171,50:209,70:269,95:328,120:382,150:441,185:506,240:599,300:693,400:821,500:947,630:1112}, D1:{1.5:21,2.5:29,4:38,6:48,10:65,16:86,25:112,35:138,50:167,70:213,95:258,120:299,150:344,185:392,240:462,300:533,400:629,500:725,630:843}, D2:{1.5:20,2.5:26,4:35,6:44,10:60,16:79,25:103,35:127,50:154,70:196,95:237,120:275,150:316,185:361,240:426,300:491,400:580,500:669,630:778}, E:{1.5:28,2.5:38,4:51,6:65,10:89,16:119,25:153,35:189,50:230,70:296,95:360,120:419,150:483,185:551,240:652,300:753,400:892,500:1030,630:1209}, F:{1.5:33,2.5:45,4:60,6:77,10:105,16:141,25:181,35:225,50:275,70:353,95:430,120:501,150:579,185:663,240:785,300:907,400:1075,500:1242,630:1459}, G:{1.5:36,2.5:49,4:65,6:83,10:114,16:153,25:196,35:243,50:297,70:382,95:465,120:542,150:626,185:717,240:849,300:981,400:1162,500:1343,630:1577}, }
    },
    aluminum: { // NOTE: Reduced dataset for brevity. A full database would be much larger.
        pvc: { C:{2.5:20,4:26,6:34,10:46,16:61,25:80,35:99,50:119,70:151,95:182,120:210,150:240,185:273,240:321,300:367,400:429,500:490,630:571} },
        xlpe: { C:{2.5:26,4:34,6:44,10:60,16:80,25:104,35:129,50:156,70:198,95:239,120:276,150:317,185:361,240:424,300:487,400:571,500:654,630:762} }
    }
};

const CABLE_IMPEDANCE = {
    copper: { 1.5:{R:12.1,X:0.08}, 2.5:{R:7.41,X:0.085}, 4:{R:4.61,X:0.09}, 6:{R:3.08,X:0.095}, 10:{R:1.84,X:0.1}, 16:{R:1.15,X:0.105}, 25:{R:0.727,X:0.11}, 35:{R:0.524,X:0.115}, 50:{R:0.387,X:0.12}, 70:{R:0.268,X:0.125}, 95:{R:0.193,X:0.13}, 120:{R:0.153,X:0.135}, 150:{R:0.124,X:0.14}, 185:{R:0.099,X:0.145}, 240:{R:0.0778,X:0.15}, 300:{R:0.0622,X:0.155}, 400:{R:0.0486,X:0.16}, 500:{R:0.0389,X:0.165}, 630:{R:0.0308,X:0.17} },
    aluminum: { 2.5:{R:12.2,X:0.085}, 4:{R:7.56,X:0.09}, 6:{R:5.08,X:0.095}, 10:{R:3.08,X:0.1}, 16:{R:1.91,X:0.105}, 25:{R:1.2,X:0.11}, 35:{R:0.868,X:0.115}, 50:{R:0.641,X:0.12}, 70:{R:0.443,X:0.125}, 95:{R:0.32,X:0.13}, 120:{R:0.253,X:0.135}, 150:{R:0.206,X:0.14}, 185:{R:0.164,X:0.145}, 240:{R:0.125,X:0.15}, 300:{R:0.1,X:0.155}, 400:{R:0.0778,X:0.16}, 500:{R:0.0605,X:0.165}, 630:{R:0.0469,X:0.17} }
};

const SHORT_CIRCUIT_K = {
    copper: { pvc: 115, xlpe: 143, silicone: 132 },
    aluminum: { pvc: 76, xlpe: 94, silicone: 89 }
};

// ========== MAIN CALCULATION FUNCTION ==========
function handleCalculation(e) {
    e.preventDefault();
    if (!validateInputs()) return;
    
    showLoading();
    
    setTimeout(() => {
        try {
            const inputs = gatherInputs();
            const results = performComprehensiveCalculation(inputs);
            displayResults(results, inputs);
            hideLoading();
            showMessage('Calculation completed successfully!', 'success');
        } catch (error) {
            hideLoading();
            showMessage(`Error in calculation: ${error.message}`, 'error');
            console.error(error);
        }
    }, 500); // Delay for UI update
}

// ========== INPUT VALIDATION ==========
function validateInputs() {
    const form = document.getElementById('cable-sizing-form');
    if (!form.checkValidity()) {
        form.reportValidity();
        showMessage('Please fill in all required fields correctly.', 'error');
        return false;
    }
    if (document.getElementById('system-type').value !== 'dc') {
        const pf = document.getElementById('power-factor');
        if (!pf.value || parseFloat(pf.value) < 0.1 || parseFloat(pf.value) > 1) {
            showMessage('Power factor must be between 0.1 and 1.0 for AC systems.', 'error');
            pf.focus();
            return false;
        }
    }
    return true;
}

// ========== GATHER INPUTS ==========
function gatherInputs() {
    const getValue = id => document.getElementById(id).value;
    const getNumber = id => parseFloat(getValue(id));
    
    return {
        systemType: getValue('system-type'), voltage: getNumber('voltage'), loadCurrent: getNumber('load-current'),
        powerFactor: getValue('system-type') !== 'dc' ? getNumber('power-factor') : 1.0,
        loadType: getValue('load-type'), weldingDuty: getValue('load-type') === 'welding' ? getNumber('welding-duty') : null,
        cableLength: getNumber('cable-length'), maxVoltageDropPercent: getNumber('max-voltage-drop'),
        cableMaterial: getValue('cable-material'), insulationType: getValue('insulation-type'), numCores: getValue('num-cores'),
        armorType: getValue('armor-type'), parallelRuns: getNumber('parallel-runs') || 1, installationMethod: getValue('installation-method'),
        ambientTemp: getNumber('ambient-temp'), soilResistivity: getValue('soil-resistivity'), numCircuits: getNumber('num-circuits'),
        burialDepth: getNumber('burial-depth') || 0, fillFactor: getNumber('fill-factor') || 40,
        scCurrent: getNumber('short-circuit-current'), scDuration: getNumber('short-circuit-duration'),
        earthLoopImpedance: getNumber('earth-loop-impedance') || 0, protectionType: getValue('protection-type'),
        protectionRating: getNumber('protection-rating') || 0, standard: getValue('standard'), thd: getNumber('thd') || 0,
        diversityFactor: getNumber('diversity-factor') || 1, futureGrowth: getNumber('future-growth') || 0,
        economicOpt: getValue('economic-optimization') === 'yes', electricityCost: getNumber('electricity-cost') || 0,
        cableLifetime: getNumber('cable-lifetime') || 0, operatingHours: getNumber('operating-hours') || 0
    };
}

// ========== COMPREHENSIVE CALCULATION LOGIC ==========
function performComprehensiveCalculation(inputs) {
    let log = [];
    
    const designCurrentResult = calculateDesignCurrent(inputs);
    log.push(...designCurrentResult.log);
    const designCurrent = designCurrentResult.value;

    const deratingResult = calculateDeratingFactors(inputs);
    log.push(...deratingResult.log);
    const totalDerating = deratingResult.total;

    const requiredCapacity = designCurrent / totalDerating;
    log.push({
        title: "3. Required Current Carrying Capacity (I_z)",
        description: "This is the minimum continuous current a cable must handle after all environmental and installation derating factors are applied.",
        formula: "$$ I_z = \\frac{I_B'}{C_{total}} $$",
        calculation: `$$ I_z = \\frac{${designCurrent.toFixed(2)}}{${totalDerating.toFixed(3)}} = ${requiredCapacity.toFixed(2)} \\text{ A} $$`
    });

    const shortCircuitResult = calculateMinShortCircuitSize(inputs);
    log.push(...shortCircuitResult.log);
    const minSizeSC = shortCircuitResult.value;

    const evaluationResult = findAndEvaluateCandidates(inputs, requiredCapacity, minSizeSC);
    if (evaluationResult.error) {
        throw new Error(evaluationResult.error);
    }
    log.push(...evaluationResult.log);

    const finalSelection = selectRecommendedCable(evaluationResult.candidates, inputs.maxVoltageDropPercent);
    
    if (finalSelection.recommended) {
        const verificationLog = generateFinalVerificationLog(finalSelection.recommended, inputs, designCurrent, minSizeSC);
        log.push(...verificationLog);
    } else {
        log.push(...finalSelection.log);
    }
    
    return {
        calculationLog: log,
        candidates: evaluationResult.candidates,
        recommended: finalSelection.recommended,
        governingCriterion: finalSelection.criterion
    };
}

function calculateDesignCurrent(inputs) {
    let log = [];
    let calcSteps = [inputs.loadCurrent.toFixed(2)];
    
    log.push({
        title: "1. Design Current (I_B')",
        description: "The design current is the initial load current adjusted for various operational factors like load type, diversity, and future growth."
    });

    let current = inputs.loadCurrent;
    let loadFactor = 1.0;
    if (inputs.loadType !== 'continuous') {
        switch (inputs.loadType) {
            case 'intermittent': loadFactor = 0.8; break;
            case 'motor': loadFactor = 1.25; break;
            case 'welding': loadFactor = Math.sqrt(inputs.weldingDuty / 100); break;
        }
        current *= loadFactor;
        calcSteps.push(`\\times ${loadFactor.toFixed(2)}`);
    }
    
    if (inputs.diversityFactor < 1) {
        current *= inputs.diversityFactor;
        calcSteps.push(`\\times ${inputs.diversityFactor.toFixed(2)}`);
    }
    
    if (inputs.futureGrowth > 0) {
        const growthFactor = (1 + inputs.futureGrowth / 100);
        current *= growthFactor;
        calcSteps.push(`\\times ${growthFactor.toFixed(2)}`);
    }

    let thdDenominator = "";
    if (inputs.thd > 15) {
        const thdFactor = 0.86;
        current /= thdFactor;
        thdDenominator = `\\times ${thdFactor.toFixed(2)}`;
    }
    
    const currentPerRun = current / inputs.parallelRuns;

    log.push({
        formula: "$$ I_B' = \\frac{I_{load} \\times F_{load} \\times F_{diversity} \\times F_{growth}}{N_{runs} \\times F_{harmonics}} $$",
        calculation: `$$ I_B' = \\frac{${calcSteps.join(' ')}}{${inputs.parallelRuns} ${thdDenominator}} = ${currentPerRun.toFixed(2)} \\text{ A per run} $$`
    });
    
    return { value: currentPerRun, log: log };
}

function calculateDeratingFactors(inputs) {
    let log = [{
        title: "2. Determine All Correction Factors",
        description: "The cable's base current rating is adjusted for the specific installation conditions. Each condition has a corresponding correction factor (C-factor)."
    }];
    let factors = {};

    factors.temperature = getTemperatureCorrectionFactor(inputs);
    log.push({
        subHeader: "Temperature Correction Factor (C_T)",
        description: `For an ambient temperature of ${inputs.ambientTemp}°C and ${inputs.insulationType.toUpperCase()} insulation, the correction factor is found from standard tables.`,
        standardNote: "Reference: IEC 60364-5-52, Tables B.52.14 & B.52.15.",
        calculation: `$$ C_T = ${factors.temperature.toFixed(3)} $$`
    });

    factors.grouping = GROUPING_FACTOR[inputs.numCircuits] || GROUPING_FACTOR[Object.keys(GROUPING_FACTOR).pop()];
    if (inputs.numCircuits > 1) {
        log.push({
            subHeader: "Grouping Correction Factor (C_G)",
            description: `For a group of ${inputs.numCircuits} circuits touching, mutual heating reduces ampacity.`,
            standardNote: "Reference: IEC 60364-5-52, Table B.52.17.",
            calculation: `$$ C_G = ${factors.grouping.toFixed(3)} $$`
        });
    }

    factors.soilResistivity = 1.0;
    if (inputs.installationMethod.startsWith('D')) {
        factors.soilResistivity = SOIL_RESISTIVITY_FACTOR[inputs.soilResistivity];
        log.push({
            subHeader: "Soil Thermal Resistivity Factor (C_S)",
            description: `For buried cables with a soil resistivity of ${inputs.soilResistivity} K·m/W.`,
            standardNote: "Reference: IEC 60364-5-52, Table B.52.16.",
            calculation: `$$ C_S = ${factors.soilResistivity.toFixed(3)} $$`
        });
    }

    let total = Object.values(factors).reduce((acc, val) => acc * val, 1.0);
    let activeFactors = Object.values(factors).filter(f => f !== 1.0);
    
    log.push({
        title: "Total Correction Factor (C_total)",
        description: "The individual correction factors are multiplied together to get the total derating factor.",
        formula: "$$ C_{total} = C_T \\times C_G \\times C_S \\times \\dots $$",
        calculation: `$$ C_{total} = ${activeFactors.length > 0 ? activeFactors.map(f => f.toFixed(3)).join(' \\times ') : '1.0'} = ${total.toFixed(3)} $$`
    });

    return { total: total, log: log };
}

function getTemperatureCorrectionFactor(inputs) {
    const isBuried = inputs.installationMethod.startsWith('D');
    const tempTable = isBuried ? TEMP_CORRECTION_GROUND : TEMP_CORRECTION_AIR;
    const insulationTable = tempTable[inputs.insulationType];
    const temps = Object.keys(insulationTable).map(Number).sort((a, b) => a - b);
    
    if (inputs.ambientTemp <= temps[0]) return insulationTable[temps[0]];
    if (inputs.ambientTemp >= temps[temps.length - 1]) return insulationTable[temps[temps.length - 1]];
    
    for (let i = 0; i < temps.length - 1; i++) {
        if (inputs.ambientTemp >= temps[i] && inputs.ambientTemp <= temps[i+1]) {
            const t1 = temps[i], t2 = temps[i+1];
            const f1 = insulationTable[t1], f2 = insulationTable[t2];
            return f1 + ((f2 - f1) * (inputs.ambientTemp - t1)) / (t2 - t1);
        }
    }
    return 1.0;
}

function calculateMinShortCircuitSize(inputs) {
    let log = [];
    const k = SHORT_CIRCUIT_K[inputs.cableMaterial][inputs.insulationType];
    const I_sc = inputs.scCurrent * 1000;
    const t = inputs.scDuration;
    const S = (I_sc * Math.sqrt(t)) / k;
    
    const minSize = STANDARD_SIZES.find(size => size >= S) || STANDARD_SIZES[STANDARD_SIZES.length - 1];

    log.push({
        title: "4. Minimum Size for Short Circuit Withstand (S_min)",
        description: "The cable must be thick enough to survive the thermal energy of a short circuit fault without melting its insulation. This is calculated using the adiabatic equation.",
        standardNote: "As per IEC 60364-4-43, Table 43A."
    }, {
        formula: "$$ S_{min} = \\frac{I_{sc} \\sqrt{t}}{k} $$",
        calculation: `$$ S_{min} = \\frac{${I_sc} \\times \\sqrt{${t}}}{${k}} = ${S.toFixed(2)} \\text{ mm}^2 $$`,
        result: `The next standard size is ${minSize} mm².`
    });
    
    return { value: minSize, log: log };
}

function findAndEvaluateCandidates(inputs, requiredCapacity, minSizeSC) {
    let log = [{
        title: "5. Evaluating Candidate Cable Sizes",
        description: `We will check standard cable sizes (starting from ${minSizeSC}mm² for short-circuit safety) against the required current capacity of ${requiredCapacity.toFixed(2)} A.`
    }];
    let candidates = [];
    
    const availableSizes = STANDARD_SIZES.filter(size => size >= minSizeSC);
    const capTable = CURRENT_CAPACITY[inputs.cableMaterial]?.[inputs.insulationType]?.[inputs.installationMethod];

    if (!capTable) {
        return { error: `Current capacity data is not available for ${inputs.cableMaterial}/${inputs.insulationType}/${inputs.installationMethod}.` };
    }
    
    for (const size of availableSizes) {
        const baseCapacity = capTable[size];
        if (baseCapacity === undefined) continue;
        
        if (baseCapacity >= requiredCapacity) {
            const deratedCapacity = baseCapacity * calculateDeratingFactors(inputs).total;
            const vdResult = calculateVoltageDrop(inputs, size);
            
            candidates.push({
                size, baseCapacity, deratedCapacity,
                voltageDrop: vdResult.vd, voltageDropPercent: vdResult.vdPercent,
                vdFormula: vdResult.formula, vdCalculation: vdResult.calculation
            });
        }
    }

    if(candidates.length === 0){
         log.push({ isWarning: true, text: `No standard cable size found that meets the required capacity of ${requiredCapacity.toFixed(2)} A.` });
    } else {
         log.push({ text: `Found ${candidates.length} potential cable sizes that meet ampacity and short-circuit requirements. Now checking voltage drop for each.` });
    }

    return { candidates, log };
}

function calculateVoltageDrop(inputs, size) {
    const impedance = CABLE_IMPEDANCE[inputs.cableMaterial]?.[size];
    if (!impedance) return { vd: NaN, vdPercent: NaN, formula: "", calculation: "" };

    const R = impedance.R / 1000;
    const X = impedance.X / 1000;
    const L = inputs.cableLength;
    const I = inputs.loadCurrent;
    const pf = inputs.powerFactor;
    const sin_phi = Math.sin(Math.acos(pf));
    
    let vd, formula, calculation;

    if (inputs.systemType === 'three-phase') {
        vd = Math.sqrt(3) * I * L * (R * pf + X * sin_phi);
        formula = "$$ \\Delta V = \\sqrt{3} \\times I_B \\times L \\times (R \\cos\\phi + X \\sin\\phi) $$";
        calculation = `$$ \\Delta V = \\sqrt{3} \\times ${I} \\times ${L} \\times (${R.toExponential(2)} \\times ${pf} + ${X.toExponential(2)} \\times ${sin_phi.toFixed(2)}) = ${vd.toFixed(2)} \\text{ V} $$`;
    } else if (inputs.systemType === 'single-phase') {
        vd = 2 * I * L * (R * pf + X * sin_phi);
        formula = "$$ \\Delta V = 2 \\times I_B \\times L \\times (R \\cos\\phi + X \\sin\\phi) $$";
        calculation = `$$ \\Delta V = 2 \\times ${I} \\times ${L} \\times (${R.toExponential(2)} \\times ${pf} + ${X.toExponential(2)} \\times ${sin_phi.toFixed(2)}) = ${vd.toFixed(2)} \\text{ V} $$`;
    } else {
        vd = 2 * I * L * R;
        formula = "$$ \\Delta V = 2 \\times I_B \\times L \\times R $$";
        calculation = `$$ \\Delta V = 2 \\times ${I} \\times ${L} \\times ${R.toExponential(2)} = ${vd.toFixed(2)} \\text{ V} $$`;
    }
    
    const vdPercent = (vd / inputs.voltage) * 100;
    return { vd, vdPercent, formula, calculation };
}

function selectRecommendedCable(candidates, maxVd) {
    let log = [];
    if (candidates.length === 0) {
        return { 
            recommended: null, 
            criterion: 'None', 
            log: [{ title: "6. Final Recommendation", isError: true, text: "No suitable cable found. The load may be too high or derating factors too severe." }]
        };
    }
    
    const compliantCables = candidates.filter(c => c.voltageDropPercent <= maxVd);
    
    let recommended, criterion;

    if (compliantCables.length > 0) {
        recommended = compliantCables[0];
    } else {
        recommended = candidates[0];
        log.push({ isWarning: true, text: `No cable meets the maximum voltage drop of ${maxVd}%. The smallest size based on ampacity is shown, but it fails the voltage drop requirement.` });
    }

    const smallestForAmpacityAndSC = candidates[0].size;
    criterion = recommended.size > smallestForAmpacityAndSC ? 'Voltage Drop' : 'Ampacity';

    if (recommended.voltageDropPercent > maxVd) {
        criterion = 'Voltage Drop (Failed)';
    }

    return { recommended, criterion, log };
}

function generateFinalVerificationLog(recommended, inputs, designCurrent, minSizeSC) {
    let log = [{
        title: `6. Final Verification for Recommended Size: ${recommended.size} mm²`,
        description: "The selected cable size is now checked against all three fundamental criteria: Protection Coordination/Ampacity, Voltage Drop, and Short Circuit Withstand."
    }];

    log.push({
        subHeader: "Criterion 1: Ampacity & Protection Coordination",
        description: "The cable's derated current capacity (I_z') must be greater than the design current (I_B'), and also greater than the rating of the protective device (I_n).",
        formula: "$$ I_B' \\le I_n \\le I_z' $$",
        calculation: `$$ ${designCurrent.toFixed(2)}A \\le ${inputs.protectionRating}A \\le ${recommended.deratedCapacity.toFixed(2)}A $$`,
        result: (designCurrent <= inputs.protectionRating && inputs.protectionRating <= recommended.deratedCapacity) ? "Condition is satisfied." : "Condition is NOT satisfied. Re-evaluate protective device or cable size."
    });

    const maxVd = inputs.maxVoltageDropPercent;
    log.push({
        subHeader: "Criterion 2: Voltage Drop",
        description: "The calculated percentage voltage drop must not exceed the maximum allowed value.",
        formula: "$$ \\Delta V_{\\%} \\le \\Delta V_{max\\%} $$",
        calculation: `$$ ${recommended.voltageDropPercent.toFixed(2)}\\% \\le ${maxVd.toFixed(2)}\\% $$`,
        result: (recommended.voltageDropPercent <= maxVd) ? "Condition is satisfied." : "Condition is NOT satisfied. A larger cable size is required."
    });

    log.push({
        subHeader: "Criterion 3: Short Circuit Withstand",
        description: "The selected cable size (S) must be greater than or equal to the minimum size required (S_min).",
        formula: "$$ S \\ge S_{min} $$",
        calculation: `$$ ${recommended.size} mm^2 \\ge ${minSizeSC.toFixed(2)} mm^2 $$`,
        result: (recommended.size >= minSizeSC) ? "Condition is satisfied." : "Condition is NOT satisfied."
    });

    return log;
}

// ========== DISPLAY RESULTS ==========
function displayResults(results, inputs) {
    const { calculationLog, recommended, governingCriterion } = results;

    const detailsDiv = document.getElementById('calculation-details');
    const tableBody = document.getElementById('result-table-body');
    const warningsDiv = document.getElementById('warnings-container');
    const standardsDiv = document.getElementById('standards-list');
    
    detailsDiv.innerHTML = `<div class="details-title"><i class="fas fa-calculator"></i> Step-by-Step Calculations</div>`;
    tableBody.innerHTML = '';
    warningsDiv.innerHTML = '';
    standardsDiv.innerHTML = '';

    calculationLog.forEach(step => {
        if (step.isError) {
             warningsDiv.innerHTML += `<div class="warning-box" style="border-color: var(--danger-color); background-color: var(--danger-bg);"><h4 style="color: var(--danger-color);"><i class="fas fa-times-circle"></i> Error</h4><p>${step.text}</p></div>`;
             return;
        }
         if (step.isWarning) {
             warningsDiv.innerHTML += `<div class="warning-box"><h4><i class="fas fa-exclamation-triangle"></i> Warning</h4><p>${step.text}</p></div>`;
             return;
        }
        
        let stepHtml = `<div class="calculation-step">`;
        if (step.title) stepHtml += `<div class="step-header">${step.title}</div>`;
        if (step.subHeader) stepHtml += `<div class="step-header" style="font-size: 1rem; color: var(--primary-color); margin-top: 12px; border-left: 3px solid var(--primary-color); padding-left: 8px;">${step.subHeader}</div>`;
        if (step.description) stepHtml += `<p class="step-description">${step.description}</p>`;
        if (step.formula) stepHtml += `<div class="formula-box">${step.formula}</div>`;
        if (step.calculation) stepHtml += `<div class="calculation-value">${step.calculation}</div>`;
        if (step.result) stepHtml += `<p class="step-description"><strong>Result:</strong> ${step.result}</p>`;
        if (step.standardNote) stepHtml += `<div class="standard-note"><i class="fas fa-book-open"></i> ${step.standardNote}</div>`;
        stepHtml += `</div>`;
        detailsDiv.innerHTML += stepHtml;
    });

    if (recommended) {
        document.getElementById('summary-cable-size').innerHTML = `${recommended.size} <span class="summary-unit">mm²</span>`;
        document.getElementById('summary-voltage-drop').innerHTML = `${recommended.voltageDropPercent.toFixed(2)} <span class="summary-unit">%</span>`;
        document.getElementById('summary-ampacity').innerHTML = `${recommended.deratedCapacity.toFixed(1)} <span class="summary-unit">A</span>`;
        document.getElementById('summary-criterion').textContent = governingCriterion;

        const designCurrentLog = calculationLog.find(s => s.calculation && s.calculation.includes("I_B'"));
        const designCurrentMatch = designCurrentLog ? designCurrentLog.calculation.match(/= ([\d\.]+) \\text{ A per run}/) : null;
        const designCurrent = designCurrentMatch ? parseFloat(designCurrentMatch[1]) : 0;
        
        const scSizeLog = calculationLog.find(s => s.title && s.title.includes('Short Circuit') && s.result);
        const scSizeMatch = scSizeLog ? scSizeLog.result.match(/is ([\d\.]+) mm²/) : null;
        const minScSize = scSizeMatch ? parseFloat(scSizeMatch[1]) : 0;

        const checks = [
            { param: "Protection (I_B' ≤ I_n)", req: `≤ ${inputs.protectionRating} A`, val: `${designCurrent.toFixed(1)} A`, pass: designCurrent <= inputs.protectionRating },
            { param: "Protection (I_n ≤ I_z')", req: `≤ ${recommended.deratedCapacity.toFixed(1)} A`, val: `${inputs.protectionRating} A`, pass: inputs.protectionRating <= recommended.deratedCapacity },
            { param: 'Voltage Drop (ΔV%)', req: `≤ ${inputs.maxVoltageDropPercent}%`, val: `${recommended.voltageDropPercent.toFixed(2)}%`, pass: recommended.voltageDropPercent <= inputs.maxVoltageDropPercent },
            { param: 'Short Circuit (S ≥ S_min)', req: `≥ ${minScSize} mm²`, val: `${recommended.size} mm²`, pass: recommended.size >= minScSize }
        ];

        checks.forEach(c => {
            const statusClass = c.pass ? 'status-pass' : 'status-fail';
            const statusIcon = c.pass ? 'fa-check-circle' : 'fa-times-circle';
            const isGoverning = (c.param.includes('Voltage Drop') && governingCriterion.includes('Voltage Drop')) || (c.param.includes('Protection') && governingCriterion === 'Ampacity');
            const highlightClass = isGoverning && !c.pass ? 'highlight-fail' : (isGoverning ? 'highlight' : ''); // Use a different highlight for failed governing criteria if needed
            
            tableBody.innerHTML += `
                <tr class="${highlightClass}">
                    <td>${c.param}</td>
                    <td>${c.req}</td>
                    <td>${c.val}</td>
                    <td><span class="status-indicator ${statusClass}"><i class="fas ${statusIcon}"></i> ${c.pass ? 'Pass' : 'Fail'}</span></td>
                </tr>
            `;
        });
    }

    standardsDiv.innerHTML = `
        <li><i class="fas fa-check"></i><div><strong>IEC 60364-5-52:</strong> Governs current carrying capacities, installation methods, and derating factors.</div></li>
        <li><i class="fas fa-check"></i><div><strong>IEC 60364-4-43:</strong> Specifies requirements for protection against overcurrent, including the adiabatic equation.</div></li>
    `;

    document.getElementById('result-container').classList.add('show');
    document.getElementById('result-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
    if (window.MathJax) {
        MathJax.typesetPromise();
    }
}


// ========== LOADING & MESSAGE HANDLING ==========
function showLoading() { document.getElementById('loading-overlay').classList.add('show'); }
function hideLoading() { document.getElementById('loading-overlay').classList.remove('show'); }
function showMessage(msg, type) {
    const box = document.getElementById('message-box');
    box.innerHTML = `<i class="fas ${type === 'error' ? 'fa-times-circle' : 'fa-check-circle'}"></i> ${msg}`;
    box.className = `message-box show ${type}`;
    setTimeout(() => { box.classList.remove('show'); }, 4000);
}

// ========== SAVE/LOAD & UTILITY ==========
function loadSavedData() {
    // Placeholder for future implementation
}
function saveCalculation() { showMessage('Save functionality is not implemented.', 'info'); }
function loadCalculation() { showMessage('Load functionality is not implemented.', 'info'); }
function resetForm() {
    document.getElementById('cable-sizing-form').reset();
    updateConditionalFields();
    document.getElementById('result-container').classList.remove('show');
}

function printResults() { window.print(); }
function exportPDF() {
    const element = document.getElementById('result-container');
    if (!element) return;
    showMessage('Generating PDF...', 'info');
    const opt = {
      margin:       0.5,
      filename:     'Cable-Sizing-Calculation.pdf',
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2, useCORS: true },
      jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(element).save();
}

</script>

</body>
</html>



