<!DOCTYPE html>
<html lang="en">
<head>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');  
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World-Class VFD Selection Tool - Design Calculators - Electrical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); /* Slightly stronger shadow */
            --hover-color: #e2e6ea;
            --input-border-focus: #4CAF50;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #446688;
            --input-border-focus: #66BB6A; /* Lighter green for dark mode focus */
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.4s ease-in-out, color 0.4s ease-in-out; /* Smoother transition */
        }

        .container {
            max-width: 1000px; /* Slightly wider container */
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0; /* Increased padding */
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.8em; /* Slightly larger heading */
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2); /* Subtle text shadow */
        }

        header .subtitle {
            margin: 8px 0 0; /* Adjusted margin */
            font-size: 1.1em;
            color: #bdc3c7;
        }

        main {
            padding: 25px 0; /* Increased padding */
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px; /* More rounded corners */
            padding: 30px; /* More padding */
            box-shadow: var(--card-shadow);
            margin-bottom: 30px; /* More margin */
            opacity: 0; /* Initial state for fade-in */
            transform: translateY(20px); /* Initial state for slide-up */
            animation: fadeInUp 0.8s ease-out forwards; /* Animation on load */
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 15px; /* More padding */
            margin-top: 0;
            margin-bottom: 25px; /* More margin */
            font-size: 2em; /* Larger heading */
        }

        .tool-description {
            margin-bottom: 25px; /* More margin */
            color: var(--text-color);
            font-size: 1.05em;
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px; /* Larger padding */
            border-radius: 6px; /* More rounded */
            text-decoration: none;
            margin-bottom: 25px; /* More margin */
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            align-self: flex-start; /* Ensure left alignment in flex parent */
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateX(-5px) scale(1.02); /* More pronounced animation */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 25px; /* Adjusted position */
            right: 25px; /* Adjusted position */
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px; /* More spacing */
            font-size: 1.3em; /* Larger icons */
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px; /* Already rounded */
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%; /* Already rounded */
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0; /* Increased padding */
            text-align: center;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 40px; /* More margin */
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px; /* More margin */
            font-size: 1.3em;
        }

        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
            max-width: 800px; /* Constrain text width */
            margin: 0 auto 15px; /* Center and add margin */
        }

        .social-buttons {
            margin-top: 20px; /* More margin */
            display: flex;
            justify-content: center;
            gap: 15px; /* More spacing */
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px; /* Larger buttons */
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em; /* Larger icons */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease;
            box-shadow: 0 3px 6px rgba(0,0,0,0.15); /* Subtle initial shadow */
        }

        .social-btn:hover {
            transform: translateY(-5px) rotate(5deg); /* More dynamic animation */
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        /* Specific Social Media Colors */
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
            opacity: 0; /* Initial state for fade-in */
            transform: translateY(20px); /* Initial state for slide-up */
            animation: fadeInUp 0.8s ease-out 0.2s forwards; /* Animated entry with slight delay */
        }
        
        .form-group {
            margin-bottom: 20px; /* More spacing */
            position: relative;
            opacity: 0; /* For individual form-group animation */
            transform: translateY(10px);
            animation: fadeInUp 0.5s ease-out forwards; /* Apply animation to each group */
        }

        .form-group:nth-child(1) { animation-delay: 0.3s; }
        .form-group:nth-child(2) { animation-delay: 0.4s; }
        .form-group:nth-child(3) { animation-delay: 0.5s; }
        .form-group:nth-child(4) { animation-delay: 0.6s; }
        .form-group:nth-child(5) { animation-delay: 0.7s; }
        .form-group:nth-child(6) { animation-delay: 0.8s; }
        .form-group:nth-child(7) { animation-delay: 0.9s; }
        /* Add more if needed, or use JS to dynamically add delays */

        
        .form-group label {
            display: flex; /* Use flexbox for label and icon alignment */
            align-items: center; /* Vertically center icon with text */
            margin-bottom: 8px; /* More spacing */
            font-weight: bold;
            font-size: 1.05em;
            color: var(--text-color);
            position: relative; /* Make label the positioning context for tooltip text */
            cursor: default; /* Change label cursor to default as icon is interactive */
        }
        
        .form-group input, .form-group select {
            width: calc(100% - 20px); /* Account for padding */
            padding: 12px; /* Increased padding */
            border: 1px solid var(--border-color);
            border-radius: 6px; /* More rounded */
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease-out, background-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--input-border-focus);
            box-shadow: 0 0 12px rgba(76, 175, 80, 0.7); /* Stronger glow */
            outline: none;
            transform: translateY(-3px) scale(1.01); /* More distinct lift */
        }

        /* Adjusted form-row for better justification */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* Increased gap */
            justify-content: space-between; /* Justify items */
        }
        
        .form-row .form-group {
            flex: 1 1 calc(50% - 10px); /* Adjusted for larger gap */
            min-width: 250px; /* Ensure better minimum width for readability */
            box-sizing: border-box; /* Include padding/border in width */
        }

        .calculate-btn-wrapper {
            display: flex;
            justify-content: center; /* Center the button */
            margin-top: 30px; /* More margin */
        }

        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px; /* Larger button */
            border-radius: 8px; /* More rounded */
            cursor: pointer;
            font-size: 1.2em; /* Larger text */
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); /* Stronger shadow */
            transition: background-color 0.3s ease, transform 0.2s ease-out, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .calculate-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-5px); /* More lift */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        /* Ripple effect for button */
        .calculate-btn::before { /* Ripple effect */
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            opacity: 0;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }

        .calculate-btn:active::before {
            width: 200%;
            height: 200%;
            opacity: 1;
            transition: all 0.0s ease;
        }
        
        .result-container {
            margin-top: 40px; /* More margin */
            padding: 25px;
            border-radius: 10px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out; /* Slower and smoother */
        }

        .result-container.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px; /* Rounded table corners */
            overflow: hidden; /* Ensures rounded corners apply to content */
        }
        
        .result-table th, .result-table td {
            padding: 15px; /* More padding */
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s ease;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color);
        }

        /* Animation for result table rows */
        .result-table tbody tr {
            opacity: 0;
            transform: translateX(-20px);
            animation: slideInLeft 0.4s ease-out forwards;
        }

        /* Dynamically apply delay to table rows */
        .result-table tbody tr:nth-child(1) { animation-delay: 0.1s; }
        .result-table tbody tr:nth-child(2) { animation-delay: 0.15s; }
        .result-table tbody tr:nth-child(3) { animation-delay: 0.2s; }
        .result-table tbody tr:nth-child(4) { animation-delay: 0.25s; }
        .result-table tbody tr:nth-child(5) { animation-delay: 0.3s; }
        .result-table tbody tr:nth-child(6) { animation-delay: 0.35s; }
        .result-table tbody tr:nth-child(7) { animation-delay: 0.4s; }
        .result-table tbody tr:nth-child(8) { animation-delay: 0.45s; }
        .result-table tbody tr:nth-child(9) { animation-delay: 0.5s; }
        .result-table tbody tr:nth-child(10) { animation-delay: 0.55s; }
        .result-table tbody tr:nth-child(11) { animation-delay: 0.6s; }
        .result-table tbody tr:nth-child(12) { animation-delay: 0.65s; }
        .result-table tbody tr:nth-child(13) { animation-delay: 0.7s; }
        .result-table tbody tr:nth-child(14) { animation-delay: 0.75s; }
        .result-table tbody tr:nth-child(15) { animation-delay: 0.8s; }
        .result-table tbody tr:nth-child(16) { animation-delay: 0.85s; }
        .result-table tbody tr:nth-child(17) { animation-delay: 0.9s; }
        .result-table tbody tr:nth-child(18) { animation-delay: 0.95s; }
        .result-table tbody tr:nth-child(19) { animation-delay: 1.0s; }
        .result-table tbody tr:nth-child(20) { animation-delay: 1.05s; }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .info-icon {
            font-size: 0.9em; /* Keep icon size */
            margin-left: 8px; /* Space between text and icon */
            cursor: help;
            color: var(--primary-color);
            transition: transform 0.2s ease, color 0.2s ease;
        }

        .info-icon:hover {
            transform: scale(1.2);
            color: var(--secondary-color);
        }
        
        /* The tooltip text container itself */
        .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: rgba(45, 45, 45, 0.98);
            color: #fff;
            text-align: left; /* Align text left within tooltip */
            border-radius: 8px;
            padding: 12px 15px;
            position: absolute; /* Position relative to the parent label */
            z-index: 100;
            top: calc(100% + 5px); /* Position below the label, with a small gap */
            left: 0; /* Align with the start of the label */
            opacity: 0;
            transition: opacity 0.3s ease-out, visibility 0.3s ease, transform 0.3s ease;
            font-size: 0.9em;
            line-height: 1.5;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            white-space: normal;
            transform: translateY(10px); /* Initial state for subtle slide-down */
        }

        /* Tooltip arrow - now points up from the tooltip */
        .tooltiptext::before {
            content: "";
            position: absolute;
            bottom: 100%; /* At the top of the tooltip */
            left: 20px; /* Aligned with the left side, adjusted for aesthetics */
            margin-left: -8px; /* Center arrow with this left position */
            border-width: 8px;
            border-style: solid;
            border-color: transparent transparent rgba(45, 45, 45, 0.98) transparent;
        }

        /* Show tooltip when the info icon inside the label is hovered */
        .form-group label .info-icon:hover + .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 25px; /* Adjusted position */
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px; /* Larger padding */
            border-radius: 10px; /* More rounded */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 2000; /* Very high z-index */
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.6s ease-in-out; /* Slower fade */
            font-size: 1.1em;
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.98em;
            transition: background-color 0.3s, border-color 0.3s;
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.15em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            transition: background-color 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); /* Inner shadow */
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            transition: background-color 0.3s;
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 10px;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
        }

        /* Responsive adjustments */
        @media (max-width: 900px) {
            .container {
                padding: 15px;
            }
            .tool-container {
                padding: 20px;
            }
            .tool-container h2 {
                font-size: 1.8em;
            }
            header h1 {
                font-size: 2.2em;
            }
        }

        @media (max-width: 768px) {
            .form-row .form-group {
                flex: 1 1 100%; /* Stack elements on smaller screens */
                min-width: unset; /* Remove min-width to allow full flexibility */
            }
            /* Adjust tooltip on small screens */
            .form-group .tooltiptext {
                position: relative; /* Make it flow normally within the document */
                width: calc(100% - 20px); /* Fill available width with some margin */
                left: 0;
                top: auto;
                margin-top: 10px; /* Space below input */
                margin-bottom: 5px; /* Space above next element */
                visibility: hidden; /* Hide by default */
                opacity: 0;
                transform: none; /* No slide animation on mobile */
                box-shadow: none;
                background-color: transparent; /* Transparent background */
                color: var(--text-color); /* Use regular text color */
                padding: 0; /* No padding */
                font-size: 0.85em; /* Smaller font */
                font-style: italic; /* Italicize */
            }

            .tooltiptext::before { /* Hide arrow on mobile */
                display: none;
            }

            /* For touch devices, showing tooltip on touch might need JS.
               For CSS-only, we can still use :hover or :focus
               but it might not be ideal touch UX.
               The current logic for desktop hover will work on touch too.
               The primary goal here is to prevent layout breaking.
            */

            .theme-toggle {
                position: static; /* Position toggle normally on small screens */
                justify-content: center;
                margin-top: 15px;
            }
            header {
                padding: 15px 0;
            }
            header h1 {
                font-size: 2em;
            }
            header .subtitle {
                font-size: 0.9em;
            }
            .social-buttons {
                flex-wrap: wrap;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            .tool-container {
                padding: 15px;
                border-radius: 8px;
            }
            .calculate-btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 1.1em;
            }
            .form-group input, .form-group select {
                padding: 10px;
            }
            .result-table th, .result-table td {
                padding: 10px;
                font-size: 0.9em;
            }
            #custom-message-box {
                padding: 12px 20px;
                font-size: 0.95em;
            }
            .standard-reference {
                padding: 10px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy — Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        
        <div class="tool-container">
            <h2>World-Class VFD Selection Tool</h2>
            
            <div class="tool-description">
                <p>This calculator helps select a Variable Frequency Drive (VFD) based on motor parameters, application type, system requirements, and advanced considerations like efficiency, power factor, cable length, braking, harmonics, and environmental factors. It follows general industry guidelines compatible with IEC and IEEE standards, designed for robust industrial use.</p>
            </div>
        
            <div class="calculator-form">
                <form id="vfd-selection-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="motor-power-hp">Motor Rated Power (HP)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The nominal output power of the motor in Horsepower (HP). This is a key parameter for initial VFD sizing.</span>
                            </label>
                            <input type="number" id="motor-power-hp" min="0.1" step="0.1" value="5" required>
                        </div>
                        <div class="form-group">
                            <label for="motor-voltage">Motor Rated Voltage (V)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The nominal voltage rating of the motor. This is the voltage at the motor terminals and should ideally match the VFD output voltage.</span>
                            </label>
                            <input type="number" id="motor-voltage" min="1" step="1" value="400" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="motor-current">Motor Rated Current (A)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The full load current (FLC) of the motor as per its nameplate. This is critical for accurate VFD current capacity matching.</span>
                            </label>
                            <input type="number" id="motor-current" min="0.1" step="0.1" value="8.5" required>
                        </div>
                        <div class="form-group">
                            <label for="motor-phase-type">Motor Phase Type
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Select whether the motor is single-phase or three-phase. Industrial VFDs primarily control three-phase AC induction motors.</span>
                            </label>
                            <select id="motor-phase-type" required>
                                <option value="three">Three-Phase</option>
                                <option value="single">Single-Phase (Note: Single-phase VFDs are limited in power and application).</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="motor-efficiency">Motor Efficiency (%)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The efficiency of the motor at full load, typically found on the motor nameplate (e.g., 90 for 90%). Higher efficiency means less energy wasted as heat.</span>
                            </label>
                            <input type="number" id="motor-efficiency" min="50" max="100" step="0.1" value="87" required>
                        </div>
                        <div class="form-group">
                            <label for="motor-power-factor">Motor Power Factor
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The power factor of the motor at full load, usually between 0.75 and 0.95 (e.g., 0.8 for 0.8 PF). It indicates how effectively electrical power is converted into useful work.</span></span>
                            </label>
                            <input type="number" id="motor-power-factor" min="0.5" max="1.0" step="0.01" value="0.82" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="application-type">Application Type
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The type of load the VFD will control (e.g., fans/pumps are variable torque; conveyors/extruders are constant torque; cranes/hoists are heavy duty). This significantly affects the required VFD overload capacity.</span>
                            </label>
                            <select id="application-type" required>
                                <option value="variable-torque">Variable Torque (Fans, Pumps, Centrifugal)</option>
                                <option value="constant-torque">Constant Torque (Conveyors, Extruders, Mixers)</option>
                                <option value="heavy-duty">Heavy Duty (Cranes, Hoists, Machine Tools)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="supply-voltage">Supply Voltage (V)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The input supply voltage to the VFD. This must match the available facility voltage and should be compatible with the motor voltage.</span>
                            </label>
                            <input type="number" id="supply-voltage" min="1" step="1" value="400" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="safety-factor">VFD Sizing Safety Factor (%)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Additional capacity margin for VFD sizing, e.g., 10% (enter 10). Recommended for critical applications, aging motors, or when load characteristics are not precisely known.</span>
                            </label>
                            <input type="number" id="safety-factor" min="0" max="50" step="1" value="10" required>
                        </div>
                        <div class="form-group">
                            <label for="motor-service-factor">Motor Service Factor (SF)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">A multiplier indicating the permissible continuous overload a motor can handle at rated conditions (e.g., 1.15 for 115% overload capability). Enter 1.0 if not specified on motor nameplate.</span>
                            </label>
                            <input type="number" id="motor-service-factor" min="1.0" max="1.5" step="0.01" value="1.15" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cable-length">Cable Length (meters)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The approximate length of the cable run between the VFD and the motor. Longer cables (e.g., >50-100m) can cause voltage drop, reflections, and premature motor insulation failure, potentially requiring VFD derating or output filters.</span>
                            </label>
                            <input type="number" id="cable-length" min="0" step="1" value="20" required>
                        </div>
                        <div class="form-group">
                            <label for="motor-insulation-class">Motor Insulation Class
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Indicates the maximum operating temperature of the motor winding insulation. Higher classes (e.g., H) tolerate more heat and voltage stress (dv/dt spikes from VFDs).</span>
                            </label>
                            <select id="motor-insulation-class" required>
                                <option value="F">Class F (155°C)</option>
                                <option value="H">Class H (180°C)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="ambient-temperature">Ambient Temperature (&#8451;)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The maximum ambient air temperature where the VFD will be installed. High temperatures (e.g., >40°C) reduce a VFD's current capacity and may require derating or additional cooling.</span>
                            </label>
                            <input type="number" id="ambient-temperature" min="0" max="50" step="1" value="30" required>
                        </div>
                        <div class="form-group">
                            <label for="altitude">Altitude (meters)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The elevation above sea level where the VFD will be installed. Higher altitudes lead to thinner air, reducing cooling efficiency and requiring VFD derating.</span>
                            </label>
                            <input type="number" id="altitude" min="0" step="10" value="500" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="enclosure-type">Enclosure Type
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The NEMA or IP rating required for the VFD's installation environment to protect its internal components against dust, water, and corrosion. (e.g., NEMA 1 for indoor general purpose, NEMA 4X for washdown/corrosive environments).</span>
                            </label>
                            <select id="enclosure-type" required>
                                <option value="nema1">NEMA 1 (IP20/IP21) - General Purpose, Indoor</option>
                                <option value="nema12">NEMA 12 (IP54) - Dust/Drip Tight, Indoor</option>
                                <option value="nema4">NEMA 4 (IP66) - Washdown, Indoor/Outdoor</option>
                                <option value="nema4x">NEMA 4X (IP66) - Corrosion Resistant, Indoor/Outdoor</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="braking-required">Braking Required?
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Select 'Yes' if the application requires rapid deceleration or stopping of the motor (e.g., high inertia loads like centrifuges, flywheels), which may necessitate a dynamic braking resistor to dissipate regenerative energy.</span>
                            </label>
                            <select id="braking-required">
                                <option value="no">No</option>
                                <option value="yes">Yes (Dynamic Braking)</option>
                            </select>
                        </div>
                    </div>

                     <div class="form-row">
                        <div class="form-group">
                            <label for="line-reactor-required">Line/Load Reactor Needed?
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Line reactors (on input side) help mitigate input harmonics and protect the VFD. Load reactors (on output side) help with long motor cables and protect motor insulation. Select 'Auto' for a basic recommendation.</span>
                            </label>
                            <select id="line-reactor-required" required>
                                <option value="auto">Auto-Recommend</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vfd-control-type">VFD Control Type
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Choose the VFD control method. V/f (Scalar) is simpler for basic applications. Vector control (Sensorless or Closed-Loop) offers higher performance, better torque control at low speeds, and improved dynamic response.</span>
                            </label>
                            <select id="vfd-control-type" required>
                                <option value="v-f">V/f Control (Scalar)</option>
                                <option value="vector-sensorless">Vector Control (Sensorless)</option>
                                <option value="vector-closed-loop">Vector Control (Closed-Loop, with encoder)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="grid-stiffness">Power Grid Stiffness
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Indicates the short-circuit capacity of the power supply relative to the VFD's power. A 'weak' grid (low short-circuit current) is more susceptible to harmonic distortion and voltage fluctuations caused by VFDs.</span>
                            </label>
                            <select id="grid-stiffness" required>
                                <option value="stiff">Stiff Grid (High Short Circuit Capacity)</option>
                                <option value="weak">Weak Grid (Low Short Circuit Capacity)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="harmonic-mitigation">Harmonic Mitigation Level
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Select the desired level of harmonic mitigation. 'Basic' relies on VFD's internal filters. 'Standard' often implies line reactors. 'Advanced' could mean active filters or 12/18-pulse VFDs for very sensitive grids or strict compliance (e.g., IEEE 519).</span>
                            </label>
                            <select id="harmonic-mitigation" required>
                                <option value="basic">Basic (Internal VFD Filters)</option>
                                <option value="standard">Standard (with Line Reactor)</option>
                                <option value="advanced">Advanced (Active Filter / 12-Pulse)</option>
                            </select>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold mb-3 mt-6 text-gray-700 dark:text-white">Economic Analysis Parameters (Optional)</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="motor-load-factor">Motor Operating Load Factor (%)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The average percentage of the motor's rated power at which it operates. Used for estimating energy consumption.</span>
                            </label>
                            <input type="number" id="motor-load-factor" min="0" max="100" step="1" value="75">
                        </div>
                        <div class="form-group">
                            <label for="operating-hours-per-year">Operating Hours per Year (hours)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The estimated annual operating hours of the motor.</span>
                            </label>
                            <input type="number" id="operating-hours-per-year" min="0" step="1" value="4000">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="electricity-cost-per-kwh">Electricity Cost (per kWh)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">Your average electricity cost per kilowatt-hour.</span>
                            </label>
                            <input type="number" id="electricity-cost-per-kwh" min="0" step="0.001" value="0.12">
                        </div>
                        <div class="form-group">
                            <label for="analysis-period-years">Analysis Period (Years)
                                <span class="info-icon"><i class="fas fa-info-circle"></i></span>
                                <span class="tooltiptext">The number of years over which to calculate cumulative energy savings.</span>
                            </label>
                            <input type="number" id="analysis-period-years" min="1" step="1" value="5">
                        </div>
                    </div>

                    <div class="calculate-btn-wrapper">
                        <button type="button" id="calculate-vfd-btn" class="calculate-btn">Select VFD</button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>VFD Selection Results</h3>
                <div id="calculation-details">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div id="economic-analysis-section" class="recommendation-section">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Economic Analysis of VFD Benefits</h3>
                    <div id="economic-analysis-results">
                        <!-- Economic analysis results will be inserted here -->
                    </div>
                </div>

                <div id="advanced-recommendations-section" class="recommendation-section">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Advanced Recommendations for Optimal VFD System</h3>
                    <p class="mb-4">For a truly robust, efficient, and reliable VFD system, consider these advanced aspects:</p>
                    <ul class="list-disc pl-5">
                        <li><strong>Integrated Drive Systems:</strong> For complex applications, consider VFDs with integrated PLCs, advanced communication protocols (Ethernet/IP, Profinet), and built-in safety functions (STO, SS1). This simplifies wiring, programming, and diagnostics.</li>
                        <li><strong>Active Front End (AFE) VFDs:</strong> If harmonic distortion is a major concern (e.g., for sensitive electronics, compliance with strict IEEE 519 limits), AFE VFDs offer near-unity power factor and very low harmonic distortion back to the grid. They can also regenerate energy back to the grid.</li>
                        <li><strong>Liquid Cooled VFDs:</strong> For high power applications or harsh environments (high ambient temperature, dusty areas), liquid-cooled VFDs offer superior thermal management, allowing for smaller enclosures and operation in challenging conditions without derating.</li>
                        <li><strong>Multi-Motor Control:</strong> If multiple motors need to be controlled in a synchronized manner, consider VFDs designed for multi-motor applications or a centralized VFD system with distributed I/O.</li>
                        <li><strong>Energy Monitoring & Analytics:</strong> Implement energy monitoring solutions to track VFD performance, identify energy saving opportunities, and predict maintenance needs. Many modern VFDs offer built-in data logging and connectivity.</li>
                        <li><strong>Preventive Maintenance:</strong> Regular checks of VFD cooling fans, capacitor health, and terminal connections are crucial. Thermal imaging can identify hot spots.</li>
                        <li><strong>Cybersecurity:</strong> For networked VFDs, ensure appropriate cybersecurity measures are in place to protect against unauthorized access and control.</li>
                    </ul>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400"><em>The **most reliable solution** often involves a combination of appropriate VFD sizing, robust ancillary components (reactors, filters), and advanced features (like AFE) tailored to the specific application and grid conditions. Always prioritize safety and compliance with international standards.</em></p>
                </div>

                <div class="standard-reference" id="standard-reference">
                    <p>VFD selection and implementation should always adhere to the latest revisions of relevant international standards, including but not limited to: <br>
                    - <strong>IEC 61800 Series:</strong> Adjustable speed electrical power drive systems (e.g., IEC 61800-3 for EMC requirements and harmonic limits, IEC 61800-5-1 for safety requirements). <br>
                    - <strong>IEEE 519:</strong> IEEE Recommended Practice and Requirements for Harmonic Control in Electric Power Systems. This standard sets limits for harmonic distortion at the Point of Common Coupling (PCC). <br>
                    - <strong>NEMA MG 1:</strong> Motors and Generators (for motor compatibility and insulation requirements with VFDs). <br>
                    - <strong>IEC 60034-17 / NEMA MG 1 Part 30/31:</strong> Standards specifically addressing the application of VFDs to motors, including voltage spike (dv/dt) considerations and motor insulation requirements. <br>
                    - <strong>IEC 60364 Series:</strong> Electrical installations of buildings (for general wiring and installation safety). <br>
                    - <strong>Local Electrical Codes:</strong> Such as the National Electrical Code (NEC) in the USA, or country-specific wiring regulations, which dictate installation practices and safety requirements.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                
                <p>Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box -->
    <div id="custom-message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-vfd-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const economicAnalysisSection = document.getElementById('economic-analysis-section');
            const economicAnalysisResultsDiv = document.getElementById('economic-analysis-results');
            const advancedRecommendationsSection = document.getElementById('advanced-recommendations-section');


            // Set default values for inputs
            document.getElementById('motor-power-hp').value = 5;
            document.getElementById('motor-voltage').value = 400;
            document.getElementById('motor-current').value = 8.5;
            document.getElementById('motor-efficiency').value = 87;
            document.getElementById('motor-power-factor').value = 0.82;
            document.getElementById('supply-voltage').value = 400;
            document.getElementById('safety-factor').value = 10;
            document.getElementById('motor-service-factor').value = 1.15;
            document.getElementById('cable-length').value = 20;
            document.getElementById('ambient-temperature').value = 30;
            document.getElementById('altitude').value = 500;
            document.getElementById('motor-load-factor').value = 75; 
            document.getElementById('operating-hours-per-year').value = 4000;
            document.getElementById('electricity-cost-per-kwh').value = 0.12; 
            document.getElementById('analysis-period-years').value = 5; 


            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                // Check for saved theme preference
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Custom Message Box Functionality
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    // Styles are already defined in CSS for #custom-message-box
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                // Reset background and color to ensure proper application of type-specific styles
                messageBox.style.backgroundColor = ''; 
                messageBox.style.color = 'white'; 

                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; /* Red */
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; /* Amber */
                    messageBox.style.color = '#333'; /* Dark text for orange background */
                } else {
                    messageBox.style.backgroundColor = '#28a745'; /* Green */
                }
                messageBox.style.opacity = 1;

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            calculateBtn.addEventListener('click', function() {
                // Get input values
                const motorPowerHP = parseFloat(document.getElementById('motor-power-hp').value);
                const motorVoltage = parseFloat(document.getElementById('motor-voltage').value);
                const motorCurrent = parseFloat(document.getElementById('motor-current').value);
                const motorPhaseType = document.getElementById('motor-phase-type').value;
                const motorEfficiency = parseFloat(document.getElementById('motor-efficiency').value) / 100; // Convert to decimal
                const motorPowerFactor = parseFloat(document.getElementById('motor-power-factor').value);
                const applicationType = document.getElementById('application-type').value;
                const supplyVoltage = parseFloat(document.getElementById('supply-voltage').value);
                const safetyFactor = parseFloat(document.getElementById('safety-factor').value) / 100; // Convert to decimal
                const motorServiceFactor = parseFloat(document.getElementById('motor-service-factor').value);
                const cableLength = parseFloat(document.getElementById('cable-length').value);
                const motorInsulationClass = document.getElementById('motor-insulation-class').value;
                const ambientTemperature = parseFloat(document.getElementById('ambient-temperature').value);
                const altitude = parseFloat(document.getElementById('altitude').value);
                const enclosureType = document.getElementById('enclosure-type').value;
                const brakingRequired = document.getElementById('braking-required').value;
                const lineReactorRequired = document.getElementById('line-reactor-required').value;
                const vfdControlType = document.getElementById('vfd-control-type').value;
                const gridStiffness = document.getElementById('grid-stiffness').value;
                const harmonicMitigation = document.getElementById('harmonic-mitigation').value;
                const motorLoadFactor = parseFloat(document.getElementById('motor-load-factor').value) / 100; // New input: Load factor
                const electricityCostPerKWh = parseFloat(document.getElementById('electricity-cost-per-kwh').value);
                const operatingHoursPerYear = parseFloat(document.getElementById('operating-hours-per-year').value);
                const analysisPeriodYears = parseFloat(document.getElementById('analysis-period-years').value);


                // Input validation
                if (isNaN(motorPowerHP) || isNaN(motorVoltage) || isNaN(motorCurrent) || isNaN(motorEfficiency) || isNaN(motorPowerFactor) || isNaN(supplyVoltage) || isNaN(safetyFactor) || isNaN(motorServiceFactor) || isNaN(cableLength) || isNaN(ambientTemperature) || isNaN(altitude) || isNaN(motorLoadFactor) || isNaN(electricityCostPerKWh) || isNaN(operatingHoursPerYear) || isNaN(analysisPeriodYears)) {
                    displayMessage("Please fill in all required fields with valid numbers.", "error");
                    return;
                }

                if (motorPowerHP <= 0 || motorVoltage <= 0 || motorCurrent <= 0 || motorEfficiency <= 0 || motorEfficiency > 1 || motorPowerFactor <= 0.1 || motorPowerFactor > 1 || supplyVoltage <= 0 || safetyFactor < 0 || safetyFactor > 0.5 || motorServiceFactor < 1 || motorServiceFactor > 1.5 || cableLength < 0 || ambientTemperature < 0 || ambientTemperature > 50 || altitude < 0 || motorLoadFactor < 0 || motorLoadFactor > 1 || electricityCostPerKWh < 0 || operatingHoursPerYear < 0 || analysisPeriodYears < 1) {
                    displayMessage("Please enter valid positive values. Motor efficiency and power factor should be between 0.1 and 1. Safety factor between 0 and 50%. Service factor between 1.0 and 1.5. Ambient temperature between 0 and 50 °C. Altitude cannot be negative. Load factor between 0 and 100%. Electricity cost and operating hours must be positive. Analysis period must be at least 1 year.", "error");
                    return;
                }
                
                // Clear previous results and hide sections
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '<h4>Detailed Calculation Steps:</h4>';
                economicAnalysisResultsDiv.innerHTML = '';

                resultContainer.classList.remove('show');
                economicAnalysisSection.classList.remove('show');
                advancedRecommendationsSection.classList.remove('show');

                // --- VFD Selection Logic ---
                // Step 1: Convert motor power from HP to kW (1 HP = 0.7457 kW)
                const motorRatedPowerKW = motorPowerHP * 0.7457;
                calculationDetailsDiv.innerHTML += `<p><strong>1. Convert Motor Rated Power (HP to kW):</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>Motor power is often given in Horsepower (HP), but VFDs are typically rated in kilowatts (kW) or by current capacity. We convert HP to kW using the conversion factor of $1 HP = 0.7457 kW$.</p>`;
                calculationDetailsDiv.innerHTML += `<p class="formula">$$P_{kW} = P_{HP} \\times 0.7457$$</p>`;
                calculationDetailsDiv.innerHTML += `<ul>
                    <li>Motor Rated Power (HP) = ${motorPowerHP.toFixed(2)} HP</li>
                </ul>`;
                // Removed $ from calculation step for plain text display
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    P_kW = ${motorPowerHP.toFixed(2)} x 0.7457 = ${motorRatedPowerKW.toFixed(2)} kW
                </p>`;

                // Step 2: Calculate motor apparent power (kVA) and full load current (FLC) adjusted for efficiency and power factor
                let motorRatedKVA = 0;
                let motorRatedInputCurrent = 0; // This is the calculated input current based on output power, efficiency, PF
                let kvaFormula = '';
                let currentFormula = '';

                if (motorPhaseType === 'single') {
                    // P_in = P_out / Efficiency
                    const motorRatedInputPowerKW = motorRatedPowerKW / motorEfficiency;
                    motorRatedInputCurrent = (motorRatedInputPowerKW * 1000) / (motorVoltage * motorPowerFactor);
                    motorRatedKVA = (motorVoltage * motorRatedInputCurrent) / 1000;

                    kvaFormula = `$$S_{rated} = \\frac{V_{motor} \\times I_{motor,rated\_input}}{1000}$$`;
                    currentFormula = `$$I_{motor,rated\_input} = \\frac{P_{kW,rated} \\times 1000}{V_{motor} \\times PF \\times Eff}$$`;

                } else { // Three-phase
                    const motorRatedInputPowerKW = motorRatedPowerKW / motorEfficiency;
                    motorRatedInputCurrent = (motorRatedInputPowerKW * 1000) / (Math.sqrt(3) * motorVoltage * motorPowerFactor);
                    motorRatedKVA = (Math.sqrt(3) * motorVoltage * motorRatedInputCurrent) / 1000;

                    kvaFormula = `$$S_{rated} = \\frac{\\sqrt{3} \\times V_{motor} \\times I_{motor,rated\_input}}{1000}$$`;
                    currentFormula = `$$I_{motor,rated\_input} = \\frac{P_{kW,rated} \\times 1000}{\\sqrt{3} \\times V_{motor} \\times PF \\times Eff}$$`;
                }

                // Use the greater of nameplate current or calculated rated input current for conservative sizing
                const effectiveMotorRatedCurrent = Math.max(motorCurrent, motorRatedInputCurrent); // motorCurrent is nameplate current
                
                calculationDetailsDiv.innerHTML += `<p><strong>2. Calculate Motor Rated Apparent Power (kVA) and Rated Input Current:</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>Apparent power represents the total power in the circuit. The calculated rated input current is derived from the motor's rated output power, efficiency, and power factor. We use the higher of the nameplate current or this calculated current for a more robust VFD selection.</p>`;
                calculationDetailsDiv.innerHTML += `<p class="formula">${kvaFormula}</p>`;
                calculationDetailsDiv.innerHTML += `<p class="formula">${currentFormula}</p>`;
                calculationDetailsDiv.innerHTML += `<ul>
                    <li>Motor Rated Voltage ($V_{motor}$) = ${motorVoltage.toFixed(2)} V</li>
                    <li>Motor Rated Current (Nameplate $I_{motor}$) = ${motorCurrent.toFixed(2)} A</li>
                    <li>Motor Power Factor (PF) = ${motorPowerFactor.toFixed(2)}</li>
                    <li>Motor Efficiency (Eff) = ${(motorEfficiency * 100).toFixed(2)}%</li>
                    <li>Motor Rated Input Power = ${(motorRatedPowerKW / motorEfficiency).toFixed(2)} kW</li>
                </ul>`;
                // Removed $ from calculation steps for plain text display
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    Calculated Rated Input Current = ${motorRatedInputCurrent.toFixed(2)} A
                </p>`;
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    Effective Motor Rated Current (max of nameplate and calculated) = ${effectiveMotorRatedCurrent.toFixed(2)} A
                </p>`;
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    Motor Rated Apparent Power (S_rated) = ${motorRatedKVA.toFixed(2)} kVA
                </p>`;


                // Step 3: Determine VFD Overload Factor based on Application Type
                let applicationOverloadFactor = 1.0; // Base for continuous operation
                let overloadExplanation = '';
                if (applicationType === 'variable-torque') {
                    applicationOverloadFactor = 1.10; // 110% for 1 min
                    overloadExplanation = "Variable Torque applications (fans, pumps) typically require VFDs with 110% overload capacity for 60 seconds.";
                } else if (applicationType === 'constant-torque') {
                    applicationOverloadFactor = 1.15; // 115% for 1 min
                    overloadExplanation = "Constant Torque applications (conveyors, extruders) typically require VFDs with 115% overload capacity for 60 seconds.";
                } else if (applicationType === 'heavy-duty') {
                    applicationOverloadFactor = 1.50; // 150% for 1 min
                    overloadExplanation = "Heavy Duty applications (cranes, hoists) demand VFDs with 150% overload capacity for 60 seconds.";
                }

                calculationDetailsDiv.innerHTML += `<p><strong>3. Determine VFD Application Overload Factor:</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>${overloadExplanation}</p>`;
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">Application Overload Factor = ${applicationOverloadFactor.toFixed(2)}</p>`;

                // Step 4: Calculate VFD Current Requirement considering Application Overload and Safety Factor
                let vfdCurrentRequirement = effectiveMotorRatedCurrent * applicationOverloadFactor * (1 + safetyFactor);
                
                // Also consider motor service factor: VFD should be able to supply (FLC * SF) continuously
                const minVFDContinuousCurrent = effectiveMotorRatedCurrent * motorServiceFactor;
                vfdCurrentRequirement = Math.max(vfdCurrentRequirement, minVFDContinuousCurrent);

                calculationDetailsDiv.innerHTML += `<p><strong>4. Calculate VFD Current Requirement (Base):</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>This is the fundamental current capacity the VFD must provide, considering the motor's full load current, the application's overload demands, and a safety margin. We also ensure it can continuously supply the motor's full load current multiplied by its service factor.</p>`;
                calculationDetailsDiv.innerHTML += `<p class="formula">$$I_{VFD,base} = \\text{max}(I_{motor,eff} \\times \\text{App. Overload Factor} \\times (1 + \\text{SF}_{sizing}), \\quad I_{motor,eff} \\times \\text{Motor SF})$$</p>`;
                calculationDetailsDiv.innerHTML += `<ul>
                    <li>Effective Motor Rated Current ($I_{motor,eff}$) = ${effectiveMotorRatedCurrent.toFixed(2)} A</li>
                    <li>Application Overload Factor = ${applicationOverloadFactor.toFixed(2)}</li>
                    <li>VFD Sizing Safety Factor ($\\text{SF}_{sizing}$) = ${(safetyFactor * 100).toFixed(0)}%</li>
                    <li>Motor Service Factor (Motor SF) = ${motorServiceFactor.toFixed(2)}</li>
                </ul>`;
                // Removed $ from calculation steps for plain text display
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    I_VFD,base = max(${effectiveMotorRatedCurrent.toFixed(2)} x ${applicationOverloadFactor.toFixed(2)} x (1 + ${safetyFactor.toFixed(2)}), ${effectiveMotorRatedCurrent.toFixed(2)} x ${motorServiceFactor.toFixed(2)})
                </p>`;
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    I_VFD,base = ${vfdCurrentRequirement.toFixed(2)} A
                </p>`;

                // Step 5: Apply Temperature Derating Factor
                let tempDeratingFactor = 1.0;
                let tempDeratingExplanation = 'No temperature derating applied.';
                if (ambientTemperature > 40) { // Assuming 40°C is base, derate by 2.5% per °C above 40
                    tempDeratingFactor = 1 + ((ambientTemperature - 40) * 0.025);
                    tempDeratingExplanation = `Due to ambient temperature of ${ambientTemperature}°C (above 40°C), a temperature derating factor of ${tempDeratingFactor.toFixed(2)} is applied.`;
                }
                const vfdCurrentAfterTempDerating = vfdCurrentRequirement * tempDeratingFactor;

                calculationDetailsDiv.innerHTML += `<p><strong>5. Apply Temperature Derating:</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>${tempDeratingExplanation}</p>`;
                if (ambientTemperature > 40) {
                    calculationDetailsDiv.innerHTML += `<p class="formula">$$I_{VFD,temp} = I_{VFD,base} \\times (1 + (T_{ambient} - 40) \\times 0.025)$$</p>`;
                    // Removed $ from calculation steps for plain text display
                    calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                        I_VFD,temp = ${vfdCurrentRequirement.toFixed(2)} x (1 + (${ambientTemperature} - 40) x 0.025) = ${vfdCurrentAfterTempDerating.toFixed(2)} A
                    </p>`;
                } else {
                    calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                        I_VFD,temp = I_VFD,base = ${vfdCurrentAfterTempDerating.toFixed(2)} A
                    </p>`;
                }

                // Step 6: Apply Altitude Derating Factor
                let altitudeDeratingFactor = 1.0;
                let altitudeDeratingExplanation = 'No altitude derating applied.';
                if (altitude > 1000) { // Assuming 1000m is base, derate by 1% per 100m above 1000m
                    altitudeDeratingFactor = 1 + (Math.floor((altitude - 1000) / 100) * 0.01);
                    altitudeDeratingExplanation = `Due to altitude of ${altitude} meters (above 1000m), an altitude derating factor of ${altitudeDeratingFactor.toFixed(2)} is applied due to reduced air density and cooling efficiency.`;
                }
                const vfdCurrentAfterAltitudeDerating = vfdCurrentAfterTempDerating * altitudeDeratingFactor;

                calculationDetailsDiv.innerHTML += `<p><strong>6. Apply Altitude Derating:</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>${altitudeDeratingExplanation}</p>`;
                if (altitude > 1000) {
                    calculationDetailsDiv.innerHTML += `<p class="formula">$$I_{VFD,alt} = I_{VFD,temp} \\times (1 + \\lfloor \\frac{H_{altitude} - 1000}{100} \\rfloor \\times 0.01)$$</p>`;
                    // Removed $ from calculation steps for plain text display
                    calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                        I_VFD,alt = ${vfdCurrentAfterTempDerating.toFixed(2)} x (1 + floor((${altitude} - 1000) / 100) x 0.01) = ${vfdCurrentAfterAltitudeDerating.toFixed(2)} A
                    </p>`;
                } else {
                    calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                        I_VFD,alt = I_VFD,temp = ${vfdCurrentAfterAltitudeDerating.toFixed(2)} A
                    </p>`;
                }

                // Step 7: Cable Length Derating & Output Filter Recommendation
                let cableDeratingFactor = 1.0;
                let cableDeratingExplanation = 'No specific cable length derating applied.';
                let outputFilterRecommendation = 'Not explicitly required for typical cable lengths.';

                if (cableLength > 50 && cableLength <= 100) {
                    cableDeratingFactor = 1 + (Math.floor((cableLength - 50) / 50) * 0.05); // 5% derating for every additional 50m
                    cableDeratingExplanation = `For cable length of ${cableLength} meters (exceeding 50m), a cable derating factor of ${cableDeratingFactor.toFixed(2)} is applied. Consider a dv/dt filter or line reactor on the VFD output for motor protection.`;
                    outputFilterRecommendation = 'Recommended: dv/dt filter or output reactor.';
                } else if (cableLength > 100) {
                    cableDeratingFactor = 1 + (Math.floor((cableLength - 50) / 50) * 0.05);
                    cableDeratingExplanation = `For long cable length of ${cableLength} meters, a significant cable derating factor of ${cableDeratingFactor.toFixed(2)} is applied. A Sine Wave filter or a dv/dt filter with a motor suitable for VFD duty and long cables is strongly recommended.`;
                    outputFilterRecommendation = 'Strongly Recommended: Sine Wave filter or dv/dt filter.';
                }

                const vfdCurrentAfterCableDerating = vfdCurrentAfterAltitudeDerating * cableDeratingFactor;

                calculationDetailsDiv.innerHTML += `<p><strong>7. Apply Cable Length Derating and Output Filter Considerations:</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>${cableDeratingExplanation}</p>`;
                if (cableLength > 50) {
                    calculationDetailsDiv.innerHTML += `<p class="formula">$$I_{VFD,cable} = I_{VFD,alt} \\times (1 + \\lfloor \\frac{L_{cable} - 50}{50} \\rfloor \\times 0.05) \\quad (\\text{for } L_{cable} > 50m)$$</p>`;
                    // Removed $ from calculation steps for plain text display
                    calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                        I_VFD,cable = ${vfdCurrentAfterAltitudeDerating.toFixed(2)} x (1 + floor((${cableLength} - 50) / 50) x 0.05) = ${vfdCurrentAfterCableDerating.toFixed(2)} A
                    </p>`;
                } else {
                    calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                        I_VFD,cable = I_VFD,alt = ${vfdCurrentAfterCableDerating.toFixed(2)} A
                    </p>`;
                }
                calculationDetailsDiv.innerHTML += `<p><strong>Output Filter Recommendation:</strong> ${outputFilterRecommendation}</p>`;

                // Final VFD current needed
                const finalRequiredVFDCurrent = vfdCurrentAfterCableDerating;

                // Step 8: Convert VFD current capacity back to kVA and then HP/kW at target voltage
                const vfdKVAFromCurrent = (motorPhaseType === 'three' ? Math.sqrt(3) : 1) * supplyVoltage * finalRequiredVFDCurrent / 1000;
                const suggestedVFD_KW = vfdKVAFromCurrent; // For simplicity, assume PF=1 for VFD output rating for kW equivalence
                const suggestedVFD_HP = suggestedVFD_KW / 0.7457;

                calculationDetailsDiv.innerHTML += `<p><strong>8. Estimate Suggested VFD Power Rating (HP/kW):</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>While VFDs are primarily sized by current, they are often marketed by their equivalent horsepower or kilowatt rating. This conversion provides a comparable power rating based on the final calculated current capacity and the supply voltage.</p>`;
                
                let powerConversionFactor = motorPhaseType === 'three' ? '\\sqrt{3}' : '1';
                calculationDetailsDiv.innerHTML += `<p class="formula">$$S_{VFD} = \\frac{${powerConversionFactor} \\times V_{supply} \\times I_{VFD, final}}{1000} \\quad (\\text{in kVA})$$</p>`;
                calculationDetailsDiv.innerHTML += `<p class="formula">$$P_{VFD, kW} = S_{VFD} \\quad (\\text{assuming power factor of 1 for VFD output})$$</p>`;
                calculationDetailsDiv.innerHTML += `<p class="formula">$$P_{VFD, HP} = \\frac{P_{VFD, kW}}{0.7457}$$</p>`;

                calculationDetailsDiv.innerHTML += `<ul>
                    <li>Supply Voltage ($V_{supply}$) = ${supplyVoltage.toFixed(2)} V</li>
                    <li>Final Required VFD Current Capacity ($I_{VFD, final}$) = ${finalRequiredVFDCurrent.toFixed(2)} A</li>
                </ul>`;
                // Removed $ from calculation steps for plain text display
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    S_VFD = ${motorPhaseType === 'three' ? 'sqrt(3) x' : ''} ${supplyVoltage.toFixed(2)} x ${finalRequiredVFDCurrent.toFixed(2)} / 1000 = ${vfdKVAFromCurrent.toFixed(2)} kVA
                </p>`;
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    P_VFD, kW = ${suggestedVFD_KW.toFixed(2)} kW
                </p>`;
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    P_VFD, HP = ${suggestedVFD_HP.toFixed(2)} HP
                </p>`;

                // Step 9: Find the nearest common VFD HP size
                const commonVFD_HP_sizes = [
                    0.5, 1, 2, 3, 5, 7.5, 10, 15, 20, 25, 30, 40, 50, 60, 75, 100,
                    125, 150, 200, 250, 300, 350, 400, 450, 500, 600, 700, 800, 900, 1000,
                    1250, 1500, 1750, 2000, 2250, 2500, 3000, 3500, 4000, 4500, 5000
                ];
                
                let finalSuggestedVFD_HP = commonVFD_HP_sizes.find(size => size >= suggestedVFD_HP);
                if (!finalSuggestedVFD_HP) {
                    finalSuggestedVFD_HP = commonVFD_HP_sizes[commonVFD_HP_sizes.length - 1]; // Use largest if none found
                    displayMessage("Calculated VFD size is larger than common listed sizes. A larger custom VFD or multiple units might be required.", "warning");
                }
                const finalSuggestedVFD_KW = finalSuggestedVFD_HP * 0.7457;

                calculationDetailsDiv.innerHTML += `<p><strong>9. Select Nearest Standard VFD Size:</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>VFDs are manufactured in standard power ratings. We select the smallest standard size that is greater than or equal to our estimated required VFD horsepower.</p>`;
                calculationDetailsDiv.innerHTML += `<ul>
                    <li>Estimated Required VFD HP = ${suggestedVFD_HP.toFixed(2)} HP</li>
                    <li>Available Standard HP Sizes: ${commonVFD_HP_sizes.join(', ')} HP</li>
                </ul>`;
                calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                    Selected VFD HP = ${finalSuggestedVFD_HP.toFixed(2)} HP
                </p>`;

                // Step 10: Braking Resistor Sizing (Simplified)
                let brakingResistorRecommendation = 'Not required.';
                if (brakingRequired === 'yes') {
                    brakingResistorRecommendation = 'Dynamic braking resistor may be required. Sizing depends on load inertia, deceleration time, and duty cycle. Consult VFD manufacturer’s guidelines. A rough estimate for continuous braking power is 10-20% of motor KW.';
                    const estimatedBrakingPowerKW = motorRatedPowerKW * 0.15; // 15% of motor KW as a rough estimate
                    calculationDetailsDiv.innerHTML += `<p><strong>10. Braking Resistor Consideration:</strong></p>`;
                    calculationDetailsDiv.innerHTML += `<p>${brakingResistorRecommendation}</p>`;
                    // Removed $ from calculation steps for plain text display
                    calculationDetailsDiv.innerHTML += `<p class="calculation-step">
                        Estimated Braking Power (continuous) approx 15% x P_motor, kW = 0.15 x ${motorRatedPowerKW.toFixed(2)} kW = ${estimatedBrakingPowerKW.toFixed(2)} kW
                    </p>`;
                } else {
                    calculationDetailsDiv.innerHTML += `<p><strong>10. Braking Resistor Consideration:</strong></p>`;
                    calculationDetailsDiv.innerHTML += `<p>Dynamic braking resistor is not required for this application.</p>`;
                }

                // Step 11: Line/Load Reactor Recommendation
                let lineLoadReactorRecommendation = '';
                if (lineReactorRequired === 'yes') {
                    lineLoadReactorRecommendation = 'Line and/or Load Reactors are explicitly requested. They are beneficial for input harmonic reduction, mitigating voltage spikes on the motor, and protecting the VFD from transients.';
                } else if (lineReactorRequired === 'auto') {
                    if (cableLength > 50 || gridStiffness === 'weak' || harmonicMitigation !== 'basic') {
                        lineLoadReactorRecommendation = 'Line and Load Reactors are recommended due to factors like cable length, grid stiffness, or harmonic mitigation requirements. Load reactors reduce dv/dt stress on motor insulation and help with reflected waves. Line reactors help mitigate input harmonics and protect the VFD.';
                    } else {
                        lineLoadReactorRecommendation = 'Line/Load Reactors are not automatically recommended for this configuration, but may be considered for additional system protection or harmonic mitigation if site conditions require.';
                    }
                } else { // 'no'
                    lineLoadReactorRecommendation = 'Line/Load Reactors are not required based on current selection.';
                }
                calculationDetailsDiv.innerHTML += `<p><strong>11. Line/Load Reactor Recommendation:</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>${lineLoadReactorRecommendation}</p>`;

                // Step 12: Harmonic Mitigation Recommendation
                let harmonicMitigationRecommendation = '';
                if (harmonicMitigation === 'basic') {
                    harmonicMitigationRecommendation = 'Basic harmonic mitigation relies on the VFD’s internal DC bus choke or inductor. This is suitable for applications where harmonic distortion is not a critical concern or where the VFD power is small relative to the grid capacity.';
                } else if (harmonicMitigation === 'standard') {
                    harmonicMitigationRecommendation = 'Standard harmonic mitigation involves using a line reactor on the input side of the VFD. This significantly reduces input current harmonics (THDi) and improves the input power factor, helping to comply with basic harmonic standards.';
                } else if (harmonicMitigation === 'advanced') {
                    harmonicMitigationRecommendation = 'Advanced harmonic mitigation is recommended for sensitive grids, large VFDs, or strict compliance with standards like IEEE 519. This typically involves active harmonic filters (AHF) or 12/18-pulse VFDs, which can reduce THDi to very low levels (e.g., <5%).';
                }
                calculationDetailsDiv.innerHTML += `<p><strong>12. Harmonic Mitigation Recommendation:</strong></p>`;
                calculationDetailsDiv.innerHTML += `<p>${harmonicMitigationRecommendation}</p>`;


                // Economic Analysis (Enhanced)
                let currentMotorInputPowerKW = 0;
                if (motorEfficiency > 0) {
                    currentMotorInputPowerKW = (motorRatedPowerKW * motorLoadFactor) / motorEfficiency;
                } else {
                    displayMessage("Motor efficiency cannot be zero for economic analysis.", "warning");
                    currentMotorInputPowerKW = 0;
                }

                // Calculate energy savings if VFD is used for variable torque applications
                let estimatedEnergySavingsPercent = 0;
                let energySavingsExplanation = "Energy savings from VFDs are primarily realized in variable torque applications by reducing motor speed, which significantly reduces power consumption (power is proportional to cube of speed).";
                if (applicationType === 'variable-torque' && motorLoadFactor < 1) { // Only for variable torque and if not at full load
                    // Assuming average speed reduction to 75% of max speed for pumps/fans
                    // Power_new / Power_old = (Speed_new / Speed_old)^3
                    // If average speed is 75%, then power is (0.75)^3 = 0.421875 of full power
                    // This is a simplified model. Actual savings depend on load profile.
                    const averageSpeedReductionFactor = 0.75; // Example: average operating speed is 75% of max
                    const powerAtReducedSpeedFactor = Math.pow(averageSpeedReductionFactor, 3);
                    estimatedEnergySavingsPercent = (1 - powerAtReducedSpeedFactor) * 100;
                    energySavingsExplanation += ` For variable torque applications, reducing speed to an average of ${averageSpeedReductionFactor * 100}% can lead to approximately ${estimatedEnergySavingsPercent.toFixed(1)}% energy savings.`;
                } else if (applicationType === 'constant-torque' || applicationType === 'heavy-duty') {
                    energySavingsExplanation += " For constant torque or heavy-duty applications, VFDs offer less direct energy savings from speed reduction, but provide benefits in process control, reduced mechanical stress, and improved power factor.";
                }

                const annualEnergyConsumptionWithoutVFD = currentMotorInputPowerKW * operatingHoursPerYear;
                const annualEnergyCostWithoutVFD = annualEnergyConsumptionWithoutVFD * electricityCostPerKWh;

                const annualEnergyConsumptionWithVFD = annualEnergyConsumptionWithoutVFD * (1 - (estimatedEnergySavingsPercent / 100));
                const annualEnergyCostWithVFD = annualEnergyConsumptionWithVFD * electricityCostPerKWh;
                
                const annualCostSavings = annualEnergyCostWithoutVFD - annualEnergyCostWithVFD;
                const cumulativeSavings = annualCostSavings * analysisPeriodYears;

                // Carbon Emission Reduction (assuming typical emission factor, e.g., 0.5 kg CO2 per kWh)
                const carbonEmissionFactor = 0.5; // kg CO2 per kWh, approximate
                const annualCarbonReduction = (annualEnergyConsumptionWithoutVFD - annualEnergyConsumptionWithVFD) * carbonEmissionFactor;

                economicAnalysisResultsDiv.innerHTML = `
                    <p class="mb-2"><strong>Energy Savings Potential:</strong> ${energySavingsExplanation}</p>
                    <p class="mb-2">Estimated Annual Energy Consumption (without VFD): <strong>${annualEnergyConsumptionWithoutVFD.toFixed(2)} kWh</strong></p>
                    <p class="mb-2">Estimated Annual Energy Cost (without VFD): <strong>${annualEnergyCostWithoutVFD.toFixed(2)}</strong></p>
                    <p class="mb-2">Estimated Annual Energy Consumption (with VFD): <strong>${annualEnergyConsumptionWithVFD.toFixed(2)} kWh</strong></p>
                    <p class="mb-2">Estimated Annual Energy Cost (with VFD): <strong>${annualEnergyCostWithVFD.toFixed(2)}</strong></p>
                    <p class="mb-2 text-green-700 dark:text-green-400"><strong>Estimated Annual Cost Savings: ${annualCostSavings.toFixed(2)}</strong></p>
                    <p class="mb-2 text-green-700 dark:text-green-400"><strong>Estimated Cumulative Savings over ${analysisPeriodYears} years: ${cumulativeSavings.toFixed(2)}</strong></p>
                    <p class="mb-2 text-blue-700 dark:text-blue-400"><strong>Estimated Annual Carbon Emission Reduction: ${annualCarbonReduction.toFixed(2)} kg CO2</strong></p>
                `;

                // Display summarized results in the table
                resultTableBody.innerHTML = ''; // Clear previous results
                
                function addResultRow(parameter, value) {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.textContent = parameter; // Use textContent to prevent MathJax parsing
                    valueCell.textContent = value;     // Use textContent to prevent MathJax parsing
                }

                addResultRow("Motor Rated Power", motorPowerHP.toFixed(2) + " HP (" + motorRatedPowerKW.toFixed(2) + " kW)");
                addResultRow("Motor Rated Voltage", motorVoltage.toFixed(2) + " V");
                addResultRow("Motor Nameplate Current", motorCurrent.toFixed(2) + " A");
                addResultRow("Calculated Motor Rated Input Current", motorRatedInputCurrent.toFixed(2) + " A");
                addResultRow("Effective Motor Rated Current (for VFD sizing)", effectiveMotorRatedCurrent.toFixed(2) + " A");
                addResultRow("Motor Phase Type", motorPhaseType === "single" ? "Single-Phase" : "Three-Phase");
                addResultRow("Motor Efficiency", (motorEfficiency * 100).toFixed(2) + "%");
                addResultRow("Motor Power Factor", motorPowerFactor.toFixed(2));
                addResultRow("Motor Service Factor", motorServiceFactor.toFixed(2));
                addResultRow("Application Type", applicationType.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '));
                addResultRow("Supply Voltage", supplyVoltage.toFixed(2) + " V");
                addResultRow("Applied Safety Factor", (safetyFactor * 100).toFixed(0) + "%");
                addResultRow("Cable Length", cableLength.toFixed(0) + " meters");
                addResultRow("Motor Insulation Class", motorInsulationClass === "F" ? "Class F (155°C)" : "Class H (180°C)");
                addResultRow("Ambient Temperature", ambientTemperature.toFixed(0) + " °C");
                addResultRow("Altitude", altitude.toFixed(0) + " meters");
                addResultRow("Estimated Required VFD Current (before derating)", vfdCurrentRequirement.toFixed(2) + " A");
                addResultRow("Final Recommended VFD Current Capacity", finalRequiredVFDCurrent.toFixed(2) + " A");
                addResultRow("Recommended VFD HP", finalSuggestedVFD_HP.toFixed(2) + " HP");
                addResultRow("Recommended VFD kW", finalSuggestedVFD_KW.toFixed(2) + " kW");
                addResultRow("Recommended Enclosure Type", enclosureType.toUpperCase());
                addResultRow("Braking Resistor Recommendation", brakingRequired === 'yes' ? "Recommended. " + brakingResistorRecommendation : "Not Required.");
                addResultRow("Line/Load Reactor Recommendation", lineLoadReactorRecommendation);
                addResultRow("VFD Control Type", vfdControlType.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '));
                addResultRow("Power Grid Stiffness", gridStiffness === 'stiff' ? "Stiff Grid" : "Weak Grid");
                addResultRow("Harmonic Mitigation Level", harmonicMitigation.charAt(0).toUpperCase() + harmonicMitigation.slice(1));


                resultContainer.classList.add('show'); // Use class for animation
                economicAnalysisSection.classList.add('show');
                advancedRecommendationsSection.classList.add('show');
                resultContainer.scrollIntoView({ behavior: 'smooth' }); // Scroll to results

                // Trigger MathJax to render the new content
                // Only process calculationDetailsDiv, economicAnalysisResultsDiv, advancedRecommendationsSection, standardReference
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv, economicAnalysisResultsDiv, advancedRecommendationsSection, standardReference]);
                }

                // Theme switch functionality (already present, ensuring it works)
                const themeToggle = document.getElementById('theme-switch');
                if (themeToggle) {
                    if (localStorage.getItem('theme') === 'dark') {
                        document.body.classList.add('dark-mode');
                        themeToggle.checked = true;
                    }
                    themeToggle.addEventListener('change', function() {
                        if (this.checked) {
                            document.body.classList.add('dark-mode');
                            localStorage.setItem('theme', 'dark');
                        } else {
                            document.body.classList.remove('dark-mode');
                            localStorage.setItem('theme', 'light');
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>