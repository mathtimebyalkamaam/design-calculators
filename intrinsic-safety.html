<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ex i Intrinsically Safe Loop - Design Calculators - Instrumentation</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional calculator for validating Ex i intrinsically safe loop parameters. Checks Uo, Io, Po, Ca, and La against Ui, Ii, Pi, Ci, and Li per IEC 60079-11.">
    <meta name="keywords" content="intrinsic safety, ex i calculator, entity concept, iec 60079-11, atex, hazardous area, loop validation, instrumentation">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/intrinsic-safety.html" />
    
    <!-- AdSense & Analytics (from new header) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts & Icons (from new header) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for Formulas (from new header) -->
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['\\(', '\\)'], ['$', '$']],
            displayMath: [['\\[', '\\]'], ['$$', '$$']]
        },
        svg: { fontCache: 'global' },
        options: {
            processHtmlClass: 'math-content', // Process elements with this class
            ignoreHtmlClass: 'no-mathjax' // Ignore elements with this class
        }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- PDF Generation (Not used by this tool but included in header) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Favicon (from new header) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- New Styles from template file -->
    <style>
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
            /* Specific colors for this tool */
            --ok-color: #10B981;
            --error-color: #DC2626;
            --warning-color: #F59E0B;
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --ok-color: #10B981;
            --error-color: #e74c3c;
            --warning-color: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        /* Applied to the tool container */
        .tool-container {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .tool-description {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.05rem;
        }
        h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        /* Small hack for combined input/select */
        .form-group select {
            width: 30%; /* Give some space for the select */
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        .form-group input + select {
             width: 30%;
        }
         .form-group input {
            width: 70%;
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            display: inline-block; /* Allow select to sit next to it */
        }
        /* Full width for inputs without a select */
        .form-group input[type="number"]:only-child,
        .form-group input[type="number"][placeholder] {
             width: 100%;
             border-right: 2px solid var(--border);
             border-radius: 6px;
        }


        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .calculator-form {
            background-color: var(--card); /* Re-using card style */
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .form-section {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        .form-section h3 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn-group .btn {
            flex: 1;
            min-width: 150px;
        }
        .btn.secondary {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn.accent {
            background: var(--accent);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        .btn.accent:hover {
             box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }
        .btn.danger {
            background: var(--danger);
             box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        .btn.danger:hover {
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }
        .btn.small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }


        /* CALCULATION STEPS DISPLAY */
        .steps-container {
            display: none;
            margin-top: 30px;
        }
        .steps-container.active {
            display: block;
        }
        .step-card {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box; /* v6 */
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px; /* Spacing between cards */
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: block; /* Changed from flex */
        }
        .step-card h4::after {
            content: "";
            display: table;
            clear: both;
        }
        .step-card .number {
            float: left; /* Changed to float */
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            /* Removed flex-shrink */
        }
        .step-content {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box; /* v6 */
            display: grid;
            grid-template-columns: 1fr !important;
            gap: 25px;
            align-items: start;
        }
        .step-content > * { min-width: 0; }
        .step-content .formula-block {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid var(--border);
        }
        .step-content .formula-block p {
            margin-top: 0;
        }
        .step-content .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .step-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
            line-height: 1.2;
        }
        .step-unit {
            font-size: 1rem;
            color: var(--text);
            opacity: 0.8;
            font-weight: 500;
            margin-left: 5px;
        }
        .step-explanation {
            font-size: 1.05rem;
            line-height: 1.8;
        }
        /* Specific class for calculation steps */
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--bg);
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 8px;
            color: var(--text);
            white-space: pre-wrap;
            word-break: break-word;
            border: 1px solid var(--border);
        }


        /* Results */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th,
        .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) {
            background-color: var(--bg);
        }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .results-table .highlight {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--success);
        }
        .results-table .warning {
            font-weight: 700;
            color: var(--warning);
        }
        .results-table .error {
            font-weight: 700;
            color: var(--danger);
        }

        /* Educational Section */
        .education-section {
            margin-top: 60px;
        }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i {
            font-size: 1.5rem;
        }
        .insight-card p {
            margin: 10px 0;
            line-height: 1.8;
        }
        .insight-card ol,
        .insight-card ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .insight-card li {
            margin-bottom: 10px;
        }
        .stat-highlight {
            display: inline-block;
            background: var(--accent);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin: 0 4px;
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 {
            color: var(--danger);
            margin-top: 0;
        }
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h4 {
            color: var(--success);
            margin-top: 0;
        }


        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .btn-group { flex-direction: column; }
        }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 5px;
            cursor: help;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Adjusted width */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-family: 'Inter', sans-serif; /* Professional font */
            font-size: 0.85rem; /* Slightly smaller font size */
            line-height: 1.4; /* Better readability */
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Specific styles for Ex i Calculator */
        .status-display {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.5s, color 0.5s;
            text-align: center;
            width: 100%;
        }
        .status-display.optimal {
            background-color: var(--ok-color);
            color: white;
        }
        .status-display.adequate, .status-display.warning { /* Grouping warning colors */
            background-color: var(--warning-color);
            color: var(--heading);
        }
        .status-display.critical {
            background-color: var(--error-color);
            color: white;
        }
        
        #dynamic-recommendations {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--bg);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            color: var(--text);
            border: 1px solid var(--border);
        }
        #dynamic-recommendations h4 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        #dynamic-recommendations ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #dynamic-recommendations ul li {
            margin-bottom: 8px;
        }
        
        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            color: white;
            font-size: 1.5em;
            flex-direction: column;
            gap: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
    <link rel="stylesheet" href="styles.css">
    <meta property="og:title" content="Ex i Intrinsically Safe Loop - Design Calculators - Instrumentation">
    <meta property="og:description" content="Professional calculator for validating Ex i intrinsically safe loop parameters. Checks Uo, Io, Po, Ca, and La against Ui, Ii, Pi, Ci, and Li per IEC 60079-11.">
</head>
<body oncontextmenu="return false;">
    <!-- Message box for notifications -->
    <div id="message-box" class="message-box"></div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- New Header from file.txt -->
    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <!-- Main Tool Container -->
        <div class="tool-container">
            <h2><i class="fas fa-exclamation-triangle"></i> Ex i Intrinsically Safe Loop Calculator</h2>
                        
            <div class="tool-description">
                <p>This calculator validates the parameters of an intrinsically safe (Ex i) loop to ensure compliance with intrinsic safety standards. It checks voltage, current, power, capacitance, and inductance limits for safe operation in hazardous areas based on the <strong>Entity Concept</strong>.</p>
            </div>
                    
            <div class="calculator-form">
                <form id="is-loop-calculator-form">
                    <!-- Barrier (Source) Parameters -->
                    <div class="form-section">
                        <h3><i class="fas fa-shield-alt"></i> Barrier (Source) Parameters (from Certificate)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="barrier-uo">Barrier Uo (Voc) [Max Output Voltage] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum output voltage of the barrier under open circuit conditions.</span></span></label>
                                <input type="number" id="barrier-uo" step="0.01" value="28" required>
                                <select id="barrier-uo-unit">
                                    <option value="V">V</option>
                                    <option value="mV">mV</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="barrier-io">Barrier Io (Isc) [Max Short Circuit Current] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum output current of the barrier under short circuit conditions.</span></span></label>
                                <input type="number" id="barrier-io" step="0.01" value="93" required>
                                <select id="barrier-io-unit">
                                    <option value="mA">mA</option>
                                    <option value="A">A</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="barrier-po">Barrier Po (Pa) [Max Output Power] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum output power of the barrier.</span></span></label>
                                <input type="number" id="barrier-po" step="0.001" value="0.65" required>
                                <select id="barrier-po-unit">
                                    <option value="W">W</option>
                                    <option value="mW">mW</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="barrier-ca">Barrier Ca (Max External Capacitance) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum permissible external capacitance that can be connected to the barrier.</span></span></label>
                                <input type="number" id="barrier-ca" step="0.001" value="0.083" required>
                                <select id="barrier-ca-unit">
                                    <option value="uF">uF</option>
                                    <option value="nF">nF</option>
                                    <option value="pF">pF</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="barrier-la">Barrier La (Max External Inductance) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum permissible external inductance that can be connected to the barrier.</span></span></label>
                                <input type="number" id="barrier-la" step="0.001" value="2.3" required>
                                <select id="barrier-la-unit">
                                    <option value="mH">mH</option>
                                    <option value="uH">uH</option>
                                    <option value="nH">nH</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Field Device Parameters -->
                    <div class="form-section">
                        <h3><i class="fas fa-tachometer-alt"></i> Field Device Parameters (from Certificate)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="device-ui">Device Ui (Vi_max) [Max Input Voltage] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum input voltage the field device can safely receive.</span></span></label>
                                <input type="number" id="device-ui" step="0.01" value="30" required>
                                <select id="device-ui-unit">
                                    <option value="V">V</option>
                                    <option value="mV">mV</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="device-ii">Device Ii (Ii_max) [Max Input Current] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum input current the field device can safely receive.</span></span></label>
                                <input type="number" id="device-ii" step="0.01" value="100" required>
                                <select id="device-ii-unit">
                                    <option value="mA">mA</option>
                                    <option value="A">A</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="device-pi">Device Pi (Pi_max) [Max Input Power] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum input power the field device can safely receive.</span></span></label>
                                <input type="number" id="device-pi" step="0.001" value="0.75" required>
                                <select id="device-pi-unit">
                                    <option value="W">W</option>
                                    <option value="mW">mW</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="device-ci">Device Ci (Max Internal Capacitance) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum internal capacitance of the field device.</span></span></label>
                                <input type="number" id="device-ci" step="0.001" value="0.001" required>
                                <select id="device-ci-unit">
                                    <option value="uF">uF</option>
                                    <option value="nF">nF</option>
                                    <option value="pF">pF</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="device-li">Device Li (Max Internal Inductance) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum internal inductance of the field device.</span></span></label>
                                <input type="number" id="device-li" step="0.001" value="0.001" required>
                                <select id="device-li-unit">
                                    <option value="mH">mH</option>
                                    <option value="uH">uH</option>
                                    <option value="nH">nH</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Cable Parameters -->
                    <div class="form-section">
                        <h3><i class="fas fa-wave-square"></i> Cable Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cable-length">Cable Length <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total length of the cable connecting the barrier and the field device.</span></span></label>
                                <input type="number" id="cable-length" step="0.1" value="100" required>
                                <select id="cable-length-unit">
                                    <option value="m">meter</option>
                                    <option value="ft">feet</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cable-capacitance-per-meter">Cable Capacitance per unit length <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Capacitance of the cable per unit of its length. (nF/m)</span></span></label>
                                <input type="number" id="cable-capacitance-per-meter" step="0.001" value="0.15" required>
                                <select id="cable-capacitance-per-meter-unit">
                                    <option value="nF/m">nF/m</option>
                                    <option value="pF/ft">pF/ft</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cable-inductance-per-meter">Cable Inductance per unit length <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inductance of the cable per unit of its length. (uH/m)</span></span></label>
                                <input type="number" id="cable-inductance-per-meter" step="0.001" value="0.5" required>
                                <select id="cable-inductance-per-meter-unit">
                                    <option value="uH/m">uH/m</option>
                                    <option value="nH/ft">nH/ft</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cable-resistance-per-meter">Cable Resistance per unit length <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Resistance of the cable per unit of its length. (Ohm/m)</span></span></label>
                                <input type="number" id="cable-resistance-per-meter" step="0.001" value="0.05" required>
                                <select id="cable-resistance-per-meter-unit">
                                    <option value="Ohm/m">Ohm/m</option>
                                    <option value="Ohm/ft">Ohm/ft</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Safety Factors -->
                    <div class="form-section">
                        <h3><i class="fas fa-user-shield"></i> Safety Factors (Optional, but Recommended)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="safety-factor-c">Capacitance Safety Factor <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Multiplier applied to cable capacitance for additional safety margin (e.g., 1.5).</span></span></label>
                                <input type="number" id="safety-factor-c" step="0.1" value="1.5" min="1">
                            </div>
                            <div class="form-group">
                                <label for="safety-factor-l">Inductance Safety Factor <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Multiplier applied to cable inductance for additional safety margin (e.g., 1.5).</span></span></label>
                                <input type="number" id="safety-factor-l" step="0.1" value="1.5" min="1">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculation Buttons -->
                    <div class="btn-group" style="margin-top: 25px;">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-check-circle"></i> Validate Loop</button>
                        <button type="button" id="reset-form-btn" class="btn accent"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- NEW Step-by-Step Results Container -->
        <div id="steps-container" class="steps-container math-content">
            <!-- Step cards will be dynamically inserted here -->
        </div>

        <!-- Updated Results Section -->
        <div id="results-section" class="card hidden">
            <h3><i class="fas fa-clipboard-check"></i> Intrinsic Safety Validation Results</h3>
            <p class="status-display" id="loop-status-display">Loop Status: N/A</p>
            
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Barrier (Source)</th>
                        <th>Field Device</th>
                        <th>Cable (Total)</th>
                        <th>Check Status</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    <!-- Results will be dynamically inserted here -->
                </tbody>
            </table>

            <!-- Dynamic Recommendations -->
            <div id="dynamic-recommendations" style="display: none;">
                <h4><i class="fas fa-lightbulb"></i> Practical Considerations & Recommendations</h4>
                <ul id="recommendations-list">
                    <!-- Recommendations will be dynamically inserted here -->
                </ul>
            </div>

            <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                <button type="button" id="clear-results-btn" class="btn accent"><i class="fas fa-times-circle"></i> Clear Results</button>
            </div>

            <!-- Static Standard Reference -->
            <div class="insight-card" id="standard-reference" style="margin-top: 30px;">
                 <h4><i class="fas fa-book"></i> Applicable Standards and Guidelines</h4>
                 <p>Intrinsic safety is a protection concept governed by rigorous international standards to prevent ignition in hazardous areas.</p>
                 <ul>
                    <li><strong>IEC 60079-11: Explosive atmospheres - Part 11: Equipment protection by intrinsic safety "i".</strong> This is the primary international standard for intrinsic safety.</li>
                    <li><strong>ATEX Directive (2014/34/EU):</strong> The mandatory framework for the European Union.</li>
                    <li><strong>NEC Article 504 (NFPA 70):</strong> The primary code for IS installations in North America.</li>
                    <li><strong>Entity Parameters:</strong> The core of IS validation relies on comparing "entity parameters" from the certificates of the barrier (associated apparatus) and the field device (intrinsically safe apparatus).</li>
                    <li><strong>Loop Validation Criteria:</strong> For a loop to be safe, the following conditions *must* be met:
                        <ul>
                            <li>$U_o \le U_i$</li>
                            <li>$I_o \le I_i$</li>
                            <li>$P_o \le P_i$</li>
                            <li>$C_c + C_i \le C_a$</li>
                            <li>$L_c + L_i \le L_a$</li>
                        </ul>
                    </li>
                </ul>
                <p>This tool provides a calculation aid for loop validation. It does not replace the need for thorough understanding of the relevant standards and review by certified experts.</p>
            </div>
        </div>
        
        <!-- NEW 800-word Educational Section -->
        <div id="education-section" class="education-section card math-content">
            <h2><i class="fas fa-book-open"></i> Engineer's Guide to Intrinsic Safety (Ex i)</h2>

            <div class="tool-description">
                <p>Intrinsic Safety (IS), or "Ex i," is an explosion protection technique used for electrical equipment in hazardous areas. Unlike "Explosion Proof" (Ex d) which *contains* an explosion, Intrinsic Safety *prevents* the explosion from ever occurring. It does this by ensuring that the electrical energy (voltage, current, and power) and stored energy (capacitance and inductance) in a circuit are so low that they are incapable of producing a spark or hot surface sufficient to ignite a specific flammable atmosphere (gas, vapor, or dust).</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-project-diagram"></i> The Core: The "Entity Concept"</h4>
                <p>The "Entity Concept" is the fundamental method for validating an IS loop. It allows for the interconnection of IS equipment (field devices) and "associated apparatus" (barriers/isolators) from different manufacturers without individual system certification, as long as their "Entity Parameters" are compatible. Every certified IS device has these parameters on its certificate or drawing.</p>
                <p>An IS loop has three parts:
                <ol>
                    <li><strong>Associated Apparatus (The Barrier):</strong> The device in the "safe area" (e.g., control room) that limits energy. It has *output* parameters: $U_o$, $I_o$, $P_o$, $C_a$, $L_a$.</li>
                    <li><strong>Intrinsically Safe Apparatus (The Field Device):</strong> The device in the "hazardous area" (e.g., a transmitter). It has *input* parameters: $U_i$, $I_i$, $P_i$, $C_i$, $L_i$.</li>
                    <li><strong>The Cable:</strong> The wire connecting the two, which has its own capacitance ($C_c$) and inductance ($L_c$).</li>
                </ol>
            </div>

            <div class="success-box">
                <h4><i class="fas fa-check-circle"></i> The 5 Checks for IS Loop Validation</h4>
                <p>For a loop to be compliant, all five of these checks must pass. This calculator performs these checks.</p>
                
                <h4 style="color: var(--success); margin-top: 20px;">Check 1: Voltage ($U_o \le U_i$)</h4>
                <ul>
                    <li><strong>$U_o$ (Barrier Output Voltage):</strong> The *maximum* voltage the barrier can ever output, even under fault conditions.</li>
                    <li><strong>$U_i$ (Device Input Voltage):</strong> The *maximum* voltage the field device can receive without being damaged or becoming unsafe.</li>
                    <li><strong>The Check:</strong> The barrier's max output voltage must be less than or equal to the device's max allowed input voltage.</li>
                </ul>

                <h4 style="color: var(--success); margin-top: 20px;">Check 2: Current ($I_o \le I_i$)</h4>
                <ul>
                    <li><strong>$I_o$ (Barrier Output Current):</strong> The *maximum* current (short-circuit) the barrier can ever output, even under fault conditions.</li>
                    <li><strong>$I_i$ (Device Input Current):</strong> The *maximum* current the field device can receive without being damaged or becoming unsafe.</li>
                    <li><strong>The Check:</strong> The barrier's max output current must be less than or equal to the device's max allowed input current.</li>
                </ul>
                
                <h4 style="color: var(--success); margin-top: 20px;">Check 3: Power ($P_o \le P_i$)</h4>
                <ul>
                    <li><strong>$P_o$ (Barrier Output Power):</strong> The *maximum* power the barrier can ever output.</li>
                    <li><strong>$P_i$ (Device Input Power):</strong> The *maximum* power the field device can safely dissipate without creating a hot surface.</li>
                    <li><strong>The Check:</strong> The barrier's max output power must be less than or equal to the device's max allowed input power.</li>
                </ul>
            </div>

            <div class="danger-box">
                <h4><i class="fas fa-battery-half"></i> The Stored Energy Checks (The Most Critical Part)</h4>
                <p>The first three checks are simple. The next two are what make IS tricky. A circuit can be safe in a steady state, but the energy *stored* in the cable's capacitance and the device's inductance could be released in a single spark (e.g., if a wire is cut or shorted). We must check that this stored energy is also below the ignition level.</p>

                <h4 style="color: var(--danger); margin-top: 20px;">Check 4: Capacitance ($C_{total} \le C_a$)</h4>
                <ul>
                    <li><strong>$C_a$ (Barrier Allowed Capacitance):</strong> The *maximum* total capacitance the barrier is certified to safely handle in the loop.</li>
                    <li><strong>$C_i$ (Device Internal Capacitance):</strong> The internal capacitance of the field device. This is usually a very small value (e.g., a few nF).</li>
                    <li><strong>$C_c$ (Cable Capacitance):</strong> The total capacitance of the cable. This is calculated: $C_c = (\text{Capacitance per meter}) \times (\text{Length in meters})$.</li>
                    <li><strong>The Check:</strong> $C_i + C_c \le C_a$. The total capacitance of the device *plus* the cable must be less than what the barrier allows.</li>
                </ul>

                <h4 style="color: var(--danger); margin-top: 20px;">Check 5: Inductance ($L_{total} \le L_a$)</h4>
                <ul>
                    <li><strong>$L_a$ (Barrier Allowed Inductance):</strong> The *maximum* total inductance the barrier is certified to safely handle in the loop.</li>
                    <li><strong>$L_i$ (Device Internal Inductance):</strong> The internal inductance of the field device. This is often negligible (e.g., a few µH) but must be included.</li>
                    <li><strong>$L_c$ (Cable Inductance):</strong> The total inductance of the cable. This is calculated: $L_c = (\text{Inductance per meter}) \times (\text{Length in meters})$.</li>
                    <li><strong>The Check:</strong> $L_i + L_c \le L_a$. The total inductance of the device *plus* the cable must be less than what the barrier allows.</li>
                </ul>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-tasks"></i> Practical Considerations & Best Practices</h4>
                <p>Passing the 5 checks is just the first step. Proper installation is mandatory.</p>
                <ul>
                    <li><strong>The "L/R Ratio" Check:</strong> For some specific applications (especially in IIC gas groups), you may also need to check the cable's L/R ratio (Inductance / Resistance). If $L_a / R_a$ and $L_i / R_i$ are provided, you must check $L_c / R_c \le L_a / R_a$ or $L_c / R_c \le L_i / R_i$. This calculator focuses on the primary C and L checks.</li>
                    <li><strong>Safety Factors:</strong> While not always required by standards, it is strong engineering practice to apply a safety factor (e.g., 1.5) to the calculated $C_c$ and $L_c$ values, as cable parameters can vary. This calculator includes this as an option.</li>
                    <li><strong>Cable Segregation:</strong> IS cables (typically light blue) *must* be physically segregated from all non-IS (e.g., 24VDC or 120VAC) cables. This prevents "creepage" of unsafe energy into the IS loop.</li>
                    <li><strong>Grounding:</strong> This is the most complex part of IS. "Zener barriers" (passive devices) *must* be connected to a high-integrity IS ground (typically < 1 Ohm). Modern "Galvanic Isolators" (active devices) do not require this special ground, making them much simpler to install.</li>
                    <li><strong>Documentation:</strong> You must create and maintain an "IS Loop Drawing" that lists all components (barrier, cable, device), their entity parameters, and this calculation. This is a legal document required for plant safety and audits.</li>
                </ul>
            </div>
        </div>
    </main>

    <!-- New Footer from file.txt -->
        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Updated JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Form Elements ---
            const barrierUoInput = document.getElementById('barrier-uo');
            const barrierUoUnitSelect = document.getElementById('barrier-uo-unit');
            const barrierIoInput = document.getElementById('barrier-io');
            const barrierIoUnitSelect = document.getElementById('barrier-io-unit');
            const barrierPoInput = document.getElementById('barrier-po');
            const barrierPoUnitSelect = document.getElementById('barrier-po-unit');
            const barrierCaInput = document.getElementById('barrier-ca');
            const barrierCaUnitSelect = document.getElementById('barrier-ca-unit');
            const barrierLaInput = document.getElementById('barrier-la');
            const barrierLaUnitSelect = document.getElementById('barrier-la-unit');
            const deviceUiInput = document.getElementById('device-ui');
            const deviceUiUnitSelect = document.getElementById('device-ui-unit');
            const deviceIiInput = document.getElementById('device-ii');
            const deviceIiUnitSelect = document.getElementById('device-ii-unit');
            const devicePiInput = document.getElementById('device-pi');
            const devicePiUnitSelect = document.getElementById('device-pi-unit');
            const deviceCiInput = document.getElementById('device-ci');
            const deviceCiUnitSelect = document.getElementById('device-ci-unit');
            const deviceLiInput = document.getElementById('device-li');
            const deviceLiUnitSelect = document.getElementById('device-li-unit');
            const cableLengthInput = document.getElementById('cable-length');
            const cableLengthUnitSelect = document.getElementById('cable-length-unit');
            const cableCapacitancePerMeterInput = document.getElementById('cable-capacitance-per-meter');
            const cableCapacitancePerMeterUnitSelect = document.getElementById('cable-capacitance-per-meter-unit');
            const cableInductancePerMeterInput = document.getElementById('cable-inductance-per-meter');
            const cableInductancePerMeterUnitSelect = document.getElementById('cable-inductance-per-meter-unit');
            const cableResistancePerMeterInput = document.getElementById('cable-resistance-per-meter');
            const cableResistancePerMeterUnitSelect = document.getElementById('cable-resistance-per-meter-unit');
            const safetyFactorCInput = document.getElementById('safety-factor-c');
            const safetyFactorLInput = document.getElementById('safety-factor-l');

            // --- Button & Result Elements ---
            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            
            const resultsSection = document.getElementById('results-section');
            const stepsContainer = document.getElementById('steps-container'); // New steps container
            const resultTableBody = document.getElementById('result-table-body');
            const loopStatusDisplay = document.getElementById('loop-status-display');
            const dynamicRecommendationsDiv = document.getElementById('dynamic-recommendations');
            const recommendationsList = document.getElementById('recommendations-list');
            const messageBox = document.getElementById('message-box');
            const loadingOverlay = document.getElementById('loading-overlay'); // From old file, added to new HTML

            // --- Default values for resetting form ---
            const defaultValues = {
                'barrier-uo': 28, 'barrier-uo-unit': 'V',
                'barrier-io': 93, 'barrier-io-unit': 'mA',
                'barrier-po': 0.65, 'barrier-po-unit': 'W',
                'barrier-ca': 0.083, 'barrier-ca-unit': 'uF',
                'barrier-la': 2.3, 'barrier-la-unit': 'mH',
                'device-ui': 30, 'device-ui-unit': 'V',
                'device-ii': 100, 'device-ii-unit': 'mA',
                'device-pi': 0.75, 'device-pi-unit': 'W',
                'device-ci': 0.001, 'device-ci-unit': 'uF',
                'device-li': 0.001, 'device-li-unit': 'mH',
                'cable-length': 100, 'cable-length-unit': 'm',
                'cable-capacitance-per-meter': 0.15, 'cable-capacitance-per-meter-unit': 'nF/m',
                'cable-inductance-per-meter': 0.5, 'cable-inductance-per-meter-unit': 'uH/m',
                'cable-resistance-per-meter': 0.05, 'cable-resistance-per-meter-unit': 'Ohm/m',
                'safety-factor-c': 1.5,
                'safety-factor-l': 1.5
            };

            // --- Helper for unit conversions to SI base units ---
            const unitConversions = {
                voltage: { 'V': 1, 'mV': 0.001 },
                current: { 'A': 1, 'mA': 0.001 },
                power: { 'W': 1, 'mW': 0.001 },
                capacitance: { 'F': 1, 'uF': 1e-6, 'nF': 1e-9, 'pF': 1e-12 },
                inductance: { 'H': 1, 'mH': 1e-3, 'uH': 1e-6, 'nH': 1e-9 },
                length: { 'm': 1, 'ft': 0.3048 },
                capacitance_per_length: { 'F/m': 1, 'uF/m': 1e-6, 'nF/m': 1e-9, 'pF/m': 1e-12, 'pF/ft': (1e-12 / 0.3048) },
                inductance_per_length: { 'H/m': 1, 'mH/m': 1e-3, 'uH/m': 1e-6, 'nH/m': 1e-9, 'nH/ft': (1e-9 / 0.3048) },
                resistance_per_length: { 'Ohm/m': 1, 'Ohm/ft': 1 / 0.3048 }
            };

            // --- New showMessage function (from template) ---
            function showMessage(msg, type = 'success') {
                messageBox.textContent = msg;
                if (type === 'error') {
                    messageBox.style.backgroundColor = 'var(--danger)';
                    messageBox.style.color = 'white';
                } else if (type === 'warning') {
                    messageBox.style.backgroundColor = 'var(--warning)';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                    messageBox.style.color = 'white';
                }
                messageBox.classList.add('show');
                setTimeout(() => messageBox.classList.remove('show'), 4000);
            }

            // Function to show/hide loading overlay
            function showLoading(message = "Loading...") {
                loadingOverlay.querySelector('p').textContent = message;
                loadingOverlay.classList.add('show');
            }
            function hideLoading() {
                loadingOverlay.classList.remove('show');
            }

            // --- Helper function to add rows to the result table ---
            function addResultRow(parameter, barrier, device, cable, status, statusClass = '') {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell(0);
                const barrierCell = row.insertCell(1);
                const deviceCell = row.insertCell(2);
                const cableCell = row.insertCell(3);
                const statusCell = row.insertCell(4);

                paramCell.innerHTML = parameter;
                barrierCell.textContent = barrier;
                deviceCell.textContent = device;
                cableCell.textContent = cable;
                statusCell.textContent = status;
                statusCell.style.fontWeight = 'bold';
                statusCell.className = statusClass; // 'pass' or 'fail'
            }
            
            // --- Clear Results Function ---
            function clearResults() {
                resultsSection.classList.add('hidden');
                stepsContainer.innerHTML = '';
                stepsContainer.classList.remove('active');
                resultTableBody.innerHTML = '';
                dynamicRecommendationsDiv.style.display = 'none';
                recommendationsList.innerHTML = '';
                loopStatusDisplay.textContent = 'Loop Status: N/A';
                loopStatusDisplay.className = 'status-display';
                showMessage("Results cleared.", "success");
            }

            // --- Reset Form Function ---
            function resetForm() {
                for (const key in defaultValues) {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = defaultValues[key];
                    }
                }
                // Need to reset selects
                const selects = document.querySelectorAll('form select');
                selects.forEach(select => {
                    const defaultKey = select.id;
                    if (defaultValues[defaultKey]) {
                        select.value = defaultValues[defaultKey];
                    }
                });
                
                clearResults();
                showMessage("Form reset to default values.", "success");
            }

            // --- Event Listeners ---
            calculateBtn.addEventListener('click', calculateISLoop);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);
            
            // --- Main Calculation Function ---
            function calculateISLoop() {
                clearResults(); // Clear previous results
                
                let stepsHtml = '';
                let overallPass = true;
                let recommendations = [];

                // --- 1. Get and Validate Inputs ---
                let barrierUo = parseFloat(barrierUoInput.value) * unitConversions.voltage[barrierUoUnitSelect.value];
                let barrierIo = parseFloat(barrierIoInput.value) * unitConversions.current[barrierIoUnitSelect.value];
                let barrierPo = parseFloat(barrierPoInput.value) * unitConversions.power[barrierPoUnitSelect.value];
                let barrierCa = parseFloat(barrierCaInput.value) * unitConversions.capacitance[barrierCaUnitSelect.value];
                let barrierLa = parseFloat(barrierLaInput.value) * unitConversions.inductance[barrierLaUnitSelect.value];
                let deviceUi = parseFloat(deviceUiInput.value) * unitConversions.voltage[deviceUiUnitSelect.value];
                let deviceIi = parseFloat(deviceIiInput.value) * unitConversions.current[deviceIiUnitSelect.value];
                let devicePi = parseFloat(devicePiInput.value) * unitConversions.power[devicePiUnitSelect.value];
                let deviceCi = parseFloat(deviceCiInput.value) * unitConversions.capacitance[deviceCiUnitSelect.value];
                let deviceLi = parseFloat(deviceLiInput.value) * unitConversions.inductance[deviceLiUnitSelect.value];
                let cableLength = parseFloat(cableLengthInput.value) * unitConversions.length[cableLengthUnitSelect.value];
                let cableCapacitancePerLength = parseFloat(cableCapacitancePerMeterInput.value) * unitConversions.capacitance_per_length[cableCapacitancePerMeterUnitSelect.value];
                let cableInductancePerLength = parseFloat(cableInductancePerMeterInput.value) * unitConversions.inductance_per_length[cableInductancePerMeterUnitSelect.value];
                let cableResistancePerLength = parseFloat(cableResistancePerMeterInput.value) * unitConversions.resistance_per_length[cableResistancePerMeterUnitSelect.value];
                let safetyFactorC = parseFloat(safetyFactorCInput.value);
                let safetyFactorL = parseFloat(safetyFactorLInput.value);
                
                // Simple validation
                const inputs = { barrierUo, barrierIo, barrierPo, barrierCa, barrierLa, deviceUi, deviceIi, devicePi, deviceCi, deviceLi, cableLength, cableCapacitancePerLength, cableInductancePerLength, cableResistancePerLength, safetyFactorC, safetyFactorL };
                for (const key in inputs) {
                    if (isNaN(inputs[key])) {
                        showMessage(`Invalid input for ${key}. Please enter a valid number.`, 'error');
                        return;
                    }
                    if (inputs[key] < 0) {
                         showMessage(`${key} cannot be negative.`, 'error');
                         return;
                    }
                }
                if (safetyFactorC < 1 || safetyFactorL < 1) {
                     showMessage(`Safety factors must be 1 or greater.`, 'error');
                     return;
                }
                
                // --- Step 1: Input Parameters & SI Conversion ---
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">1</span>Input Parameters (Converted to SI Units)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>All entity parameters are converted to base SI units (Volts, Amps, Watts, Farads, Henrys, Meters) for calculation.</p>
                            <p class="calculation-step">Barrier Uo: ${barrierUo.toFixed(3)} V</p>
                            <p class="calculation-step">Barrier Io: ${barrierIo.toFixed(3)} A</p>
                            <p class="calculation-step">Barrier Po: ${barrierPo.toFixed(3)} W</p>
                            <p class="calculation-step">Barrier Ca: ${barrierCa.toExponential(2)} F</p>
                            <p class="calculation-step">Barrier La: ${barrierLa.toExponential(2)} H</p>
                        </div>
                        <div class="step-explanation">
                             <p class="calculation-step">Device Ui: ${deviceUi.toFixed(3)} V</p>
                             <p class="calculation-step">Device Ii: ${deviceIi.toFixed(3)} A</p>
                             <p class="calculation-step">Device Pi: ${devicePi.toFixed(3)} W</p>
                             <p class="calculation-step">Device Ci: ${deviceCi.toExponential(2)} F</p>
                             <p class="calculation-step">Device Li: ${deviceLi.toExponential(2)} H</p>
                        </div>
                    </div>
                </div>`;
                
                // --- Step 2: Calculate Total Cable Parameters ---
                const totalCableCapacitance = cableCapacitancePerLength * cableLength;
                const totalCableInductance = cableInductancePerLength * cableLength;
                const totalCableResistance = cableResistancePerLength * cableLength; // Not used in primary checks, but good to have
                const factoredCableCapacitance = totalCableCapacitance * safetyFactorC;
                const factoredCableInductance = totalCableInductance * safetyFactorL;

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">2</span>Calculate Total Cable Parameters</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>The cable's total capacitance and inductance are calculated from its per-length properties and the total length. Safety factors are then applied.</p>
                            <p class="calculation-step">Cable Length: ${cableLength.toFixed(2)} m</p>
                            <p class="calculation-step">Cc (unfactored): ${cableCapacitancePerLength.toExponential(2)} F/m * ${cableLength.toFixed(2)} m = ${totalCableCapacitance.toExponential(2)} F</p>
                            <p class="calculation-step">Lc (unfactored): ${cableInductancePerLength.toExponential(2)} H/m * ${cableLength.toFixed(2)} m = ${totalCableInductance.toExponential(2)} H</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Factored Cable Values:</strong></p>
                            <p class="formula">$$C_{c-factored} = C_c \times SF_C$$</p>
                            <p class="formula">$$L_{c-factored} = L_c \times SF_L$$</p>
                            <p><strong>Factored Cable C (Cc_f):</strong></p>
                            <div class="step-value" style="font-size: 1.5rem;">${factoredCableCapacitance.toExponential(2)}<span class="step-unit">F</span></div>
                            <p><strong>Factored Cable L (Lc_f):</strong></p>
                            <div class="step-value" style="font-size: 1.5rem;">${factoredCableInductance.toExponential(2)}<span class="step-unit">H</span></div>
                        </div>
                    </div>
                </div>`;
                
                // --- Step 3: Perform Intrinsic Safety Checks ---
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">3</span>Loop Validation Checks</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>The barrier's output limits must be less than or equal to the device's input limits. The total stored energy (Device + Cable) must be less than what the barrier allows.</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Validation Formulas:</strong></p>
                            <p class="formula">$$U_o \le U_i$$</p>
                            <p class="formula">$$I_o \le I_i$$</p>
                            <p class="formula">$$P_o \le P_i$$</p>
                            <p class="formula">$$C_i + C_{c-factored} \le C_a$$</p>
                            <p class="formula">$$L_i + L_{c-factored} \le L_a$$</p>
                        </div>
                    </div>
                </div>`;
                
                // --- Perform Checks and Populate Table ---
                resultTableBody.innerHTML = ''; // Clear table
                
                // Voltage Check
                const voltageCheck = barrierUo <= deviceUi;
                if (!voltageCheck) {
                    overallPass = false;
                    recommendations.push("<strong>Voltage Check FAILED:</strong> Barrier Uo must be $\le$ Device Ui. Select a barrier with lower Uo or a device with higher Ui.");
                }
                addResultRow('Voltage Check ($U_o \le U_i$)', 
                             `${barrierUo.toFixed(3)} V`, 
                             `${deviceUi.toFixed(3)} V`, 
                             'N/A', 
                             voltageCheck ? 'PASS' : 'FAIL', 
                             voltageCheck ? 'highlight' : 'error');

                // Current Check
                const currentCheck = barrierIo <= deviceIi;
                if (!currentCheck) {
                    overallPass = false;
                    recommendations.push("<strong>Current Check FAILED:</strong> Barrier Io must be $\le$ Device Ii. Select a barrier with lower Io or a device with higher Ii.");
                }
                addResultRow('Current Check ($I_o \le I_i$)', 
                             `${barrierIo.toFixed(3)} A`, 
                             `${deviceIi.toFixed(3)} A`, 
                             'N/A', 
                             currentCheck ? 'PASS' : 'FAIL', 
                             currentCheck ? 'highlight' : 'error');

                // Power Check
                const powerCheck = barrierPo <= devicePi;
                if (!powerCheck) {
                    overallPass = false;
                    recommendations.push("<strong>Power Check FAILED:</strong> Barrier Po must be $\le$ Device Pi. Select a barrier with lower Po or a device with higher Pi.");
                }
                addResultRow('Power Check ($P_o \le P_i$)', 
                             `${barrierPo.toFixed(3)} W`, 
                             `${devicePi.toFixed(3)} W`, 
                             'N/A', 
                             powerCheck ? 'PASS' : 'FAIL', 
                             powerCheck ? 'highlight' : 'error');

                // Capacitance Check
                const totalLoopCapacitance = deviceCi + factoredCableCapacitance;
                const capacitanceCheck = totalLoopCapacitance <= barrierCa;
                if (!capacitanceCheck) {
                    overallPass = false;
                    recommendations.push("<strong>Capacitance Check FAILED:</strong> Total Loop C ($C_i + C_c$) must be $\le$ Barrier Ca. Use a shorter/lower-capacitance cable or a barrier with higher Ca.");
                }
                addResultRow('Capacitance Check ($C_i + C_c \le C_a$)', 
                             `$\le ${barrierCa.toExponential(2)} F$`, 
                             `${deviceCi.toExponential(2)} F`, 
                             `${factoredCableCapacitance.toExponential(2)} F (Factored)`, 
                             capacitanceCheck ? 'PASS' : 'FAIL', 
                             capacitanceCheck ? 'highlight' : 'error');
                
                // Inductance Check
                const totalLoopInductance = deviceLi + factoredCableInductance;
                const inductanceCheck = totalLoopInductance <= barrierLa;
                if (!inductanceCheck) {
                    overallPass = false;
                    recommendations.push("<strong>Inductance Check FAILED:</strong> Total Loop L ($L_i + L_c$) must be $\le$ Barrier La. Use a shorter/lower-inductance cable or a barrier with higher La.");
                }
                addResultRow('Inductance Check ($L_i + L_c \le L_a$)', 
                             `$\le ${barrierLa.toExponential(2)} H$`, 
                             `${deviceLi.toExponential(2)} H`, 
                             `${factoredCableInductance.toExponential(2)} H (Factored)`, 
                             inductanceCheck ? 'PASS' : 'FAIL', 
                             inductanceCheck ? 'highlight' : 'error');

                // --- Update Status Display and Recommendations ---
                let statusText = 'Loop Status: ';
                let statusClass = 'status-display ';
                
                if (overallPass) {
                    statusText += 'COMPLIANT (All Checks Passed)';
                    statusClass += 'optimal';
                    recommendations.unshift("<strong>The intrinsic safety loop is COMPLIANT with the entered parameters.</strong>");
                } else {
                    statusText += 'NON-COMPLIANT (Failure in one or more checks)';
                    statusClass += 'critical';
                    recommendations.unshift("<strong>The intrinsic safety loop is NON-COMPLIANT. Review the failed checks.</strong>");
                }

                recommendations.push("Always verify calculations against component certificates and local regulations.");
                recommendations.push("Ensure IS cables (light blue) are properly segregated from non-IS cables.");
                
                recommendationsList.innerHTML = '';
                recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.innerHTML = rec; // Use innerHTML for bold tags
                    recommendationsList.appendChild(li);
                });
                dynamicRecommendationsDiv.style.display = 'block';

                loopStatusDisplay.textContent = statusText;
                loopStatusDisplay.className = statusClass;

                // --- Show Results ---
                stepsContainer.innerHTML = stepsHtml; // <-- Fix: This line was missing
                resultsSection.classList.remove('hidden');
                stepsContainer.classList.add('active'); // Show steps
                
                // Typeset MathJax
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    setTimeout(() => {
                        window.MathJax.typesetPromise([stepsContainer, resultsSection, document.getElementById('education-section')]);
                    }, 50); 
                }

                setTimeout(() => {
                    stepsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }

            // --- Theme switch logic (from new file) ---
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // --- Initial setup calls ---
            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });
        });
    </script>
</body>
</html>

