<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fan Laws Calculator - Design Calculators - Mechanical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        // MathJax configuration to support inline and display LaTeX
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <style>
        /* CSS Variables for theming (light and dark mode) */
        :root {
            --primary-color: #2196F3;
            --secondary-color: #1976D2;
            --accent-color: #FFC107;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --header-bg: #2C3E50;
            --footer-bg: #34495E;
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            --hover-color: #e2e6ea;
            --primary-color-rgb: 33, 150, 243;
            --success-color: #28a745;
            --error-color: #dc3545;
        }
        /* Dark mode overrides */
        body.dark-mode {
            --primary-color: #5DADE2;
            --secondary-color: #2874A6;
            --bg-color: #252D3A;
            --card-bg: #2F3C4C;
            --text-color: #E0E6EB;
            --header-bg: #252D3A;
            --footer-bg: #252D3A;
            --border-color: #4C5C70;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #3A475C;
            --primary-color-rgb: 93, 173, 226;
            --success-color: #4CAF50;
            --error-color: #F44336;
        }
        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, var(--bg-color) 0%, rgba(244, 247, 246, 0.8) 100%);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s, background-image 0.3s;
        }
        /* Container for content width limitation and centering */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }
        /* Header styling */
        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        header h1 {
            margin: 0;
            font-size: 2.8em;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        header .subtitle {
            margin: 8px 0 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }
        /* Main content area styling */
        main {
            padding: 30px 0;
        }
        /* Tool container styling */
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            transition: transform 0.3s ease-in-out;
        }
        .tool-container:hover {
            transform: translateY(-5px);
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 2em;
        }
        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1.05em;
        }
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }
        .tool-description strong {
            color: var(--primary-color);
        }
        /* Back button styling */
        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 25px;
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            font-weight: bold;
        }
        .back-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.03);
        }
        /* Theme toggle switch styling */
        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
        }
        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px;
            font-size: 1.3em;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 65px;
            height: 38px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(27px);
        }
        .slider.round {
            border-radius: 38px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        /* Footer styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }
        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.3em;
        }
        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }
        .social-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        /* Specific social button colors */
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #7f8c8d; }
        /* Calculator form styling */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.05em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.3);
            outline: none;
        }
        /* Responsive form row layout */
        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap; /* Allows items to wrap on smaller screens */
        }
        .form-row .form-group {
            flex: 1 1 calc(50% - 10px); /* Two columns, with gap */
            min-width: 280px; /* Minimum width before wrapping */
        }
        /* Media query for single column on small screens */
        @media (max-width: 600px) {
            .form-row .form-group {
                flex: 1 1 100%; /* Single column */
            }
        }
        /* Calculate button styling */
        .calculate-btn {
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-image 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%; /* Full width button */
        }
        .calculate-btn:hover {
            background-image: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        /* Result container styling */
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: block; /* Always block, but opacity controls visibility */
            opacity: 0;
            transition: opacity 0.6s ease-out;
            pointer-events: none; /* Prevents interaction when hidden */
        }
        .result-container.show {
            opacity: 1;
            pointer-events: auto; /* Allows interaction when shown */
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        /* Result table styling */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            font-size: 1.1em;
        }
        .result-table tr:last-child td {
            border-bottom: none;
        }
        /* Standard reference text styling */
        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            line-height: 1.5;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        /* Tooltip styling */
        .info-icon {
            color: var(--primary-color);
            margin-left: 8px;
            cursor: help;
            font-size: 1em;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the element */
            left: 50%;
            margin-left: -110px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%; /* Arrow at the bottom */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        /* Custom message box for alerts */
        #custom-message-box {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, background-color 0.3s;
            font-size: 1.1em;
        }
        #custom-message-box.info {
            background-color: var(--success-color);
        }
        #custom-message-box.error {
            background-color: var(--error-color);
        }
        #custom-message-box.warning {
            background-color: var(--accent-color);
            color: #333;
        }

        /* Calculation details section styling */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.98em;
            overflow-x: auto; /* Allow horizontal scrolling for formulas if needed */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            border: 1px dashed var(--border-color);
            white-space: nowrap; /* Prevent formula from wrapping */
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 0.95em;
            white-space: nowrap; /* Prevent calculation steps from wrapping */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #calculation-details ul li {
            margin-bottom: 5px;
        }
        /* Specific styling for required inputs to highlight visually */
        input:required:invalid {
            border-color: var(--error-color);
        }
        input:required:valid {
            border-color: var(--success-color);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Mechanical</h1>
            <p class="subtitle">Smart Tools for Modern Mechanical Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Back to Tools link -->
        <a href="indexMech.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Tools
        </a>

        <div class="tool-container">
            <h2>Fan Laws Calculator</h2>
            <div class="tool-description">
                <p>This calculator applies the Fan Laws to predict changes in fan performance (Flow, Pressure, Power) when altering fan speed, impeller diameter, or air density. It's a fundamental tool for system design and troubleshooting.</p>
                <p><strong>Key Inputs:</strong></p>
                <ul>
                    <li><strong>Unit System:</strong> Select Metric (m&#179;/s, Pa, kW, RPM, mm, kg/m&#179;) or Imperial (CFM, in.wc, HP, RPM, inch, lb/ft&#179;).</li>
                    <li><strong>Original Fan Performance:</strong> Initial Flow Rate (\(Q_1\)), Static Pressure (\(SP_1\)), and Power (\(P_1\)).</li>
                    <li><strong>Original Fan Parameters:</strong> Initial Fan Speed (\(N_1\)) and Impeller Diameter (\(D_1\)).</li>
                    <li><strong>Change Parameters:</strong>
                        <ul>
                            <li><strong>New Fan Speed (\(N_2\)):</strong> If fan speed changes (original diameter).</li>
                            <li><strong>New Impeller Diameter (\(D_2\)):</strong> If impeller diameter changes (original speed).</li>
                            <li><strong>New Air Density (\(\rho_2\)):</strong> If air density changes (e.g., due to temperature/altitude, keeping N & D same initially).</li>
                        </ul>
                    </li>
                </ul>
                <p><strong>Calculated Outputs (New Performance):</strong></p>
                <ul>
                    <li><strong>Original Fan Efficiency (\(\eta_1\)):</strong> The efficiency of the fan at its original operating point.</li>
                    <li><strong>New Flow Rate (\(Q_2\)):</strong> Predicted volumetric flow rate.</li>
                    <li><strong>New Static Pressure (\(SP_2\)):</strong> Predicted static pressure (or head).</li>
                    <li><strong>New Power (\(P_2\)):</strong> Predicted fan power consumption.</li>
                </ul>
            </div>

            <div class="calculator-form">
                <form id="fan-laws-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric or Imperial units for all inputs and outputs.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric</option>
                                <option value="imperial">Imperial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="calc-type">Calculation Type: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Choose if you're changing fan speed, impeller diameter, or just air density.</span></span></label>
                            <select id="calc-type" required>
                                <option value="speed-change">Change Fan Speed</option>
                                <option value="diameter-change">Change Impeller Diameter</option>
                                <option value="density-change">Change Air Density (Speed/Dia Constant)</option>
                                <option value="speed-and-density-change">Change Speed & Density</option>
                                <option value="diameter-and-density-change">Change Diameter & Density</option>
                            </select>
                        </div>
                    </div>

                    <h3>Original Fan Performance (\(Q_1, SP_1, P_1\))</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="q1">Original Flow Rate (\(Q_1\)) <span class="flow-unit-label">(m&#179;/s)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Initial volumetric flow rate of the fan.</span></span></label>
                            <input type="number" id="q1" step="any" value="1.0" required min="0.001">
                        </div>
                        <div class="form-group">
                            <label for="sp1">Original Static Pressure (\(SP_1\)) <span class="pressure-unit-label">(Pa)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Initial static pressure developed by the fan.</span></span></label>
                            <input type="number" id="sp1" step="any" value="250" required min="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="p1">Original Power (\(P_1\)) <span class="power-unit-label">(kW)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Initial shaft power consumed by the fan.</span></span></label>
                            <input type="number" id="p1" step="any" value="0.5" required min="0.001">
                        </div>
                        <div class="form-group">
                            <label for="rho1">Original Air Density (\(\rho_1\)) <span class="density-unit-label">(kg/m&#179;)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Initial density of the air being handled by the fan (e.g., 1.2 kg/m&#179; for standard air).</span></span></label>
                            <input type="number" id="rho1" step="any" value="1.2" required min="0.01">
                        </div>
                    </div>

                    <h3>Original Fan Parameters (\(N_1, D_1\))</h3>
                    <div class="form-row">
                        <div class="form-group" id="n1-group">
                            <label for="n1">Original Fan Speed (\(N_1\)) (RPM): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Initial rotational speed of the fan impeller.</span></span></label>
                            <input type="number" id="n1" step="any" value="1000" required min="0.01">
                        </div>
                        <div class="form-group" id="d1-group">
                            <label for="d1">Original Impeller Diameter (\(D_1\)) <span class="diameter-unit-label">(mm)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Initial diameter of the fan impeller.</span></span></label>
                            <input type="number" id="d1" step="any" value="500" required min="0.01">
                        </div>
                    </div>

                    <h3>New Fan Parameters (\(N_2, D_2, \rho_2\))</h3>
                    <div class="form-row">
                        <div class="form-group" id="n2-group">
                            <label for="n2">New Fan Speed (\(N_2\)) (RPM): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The new rotational speed of the fan impeller.</span></span></label>
                            <input type="number" id="n2" step="any" value="1200" required min="0.01">
                        </div>
                        <div class="form-group" id="d2-group" style="display: none;">
                            <label for="d2">New Impeller Diameter (\(D_2\)) <span class="diameter-unit-label">(mm)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The new diameter of the fan impeller.</span></span></label>
                            <input type="number" id="d2" step="any" value="600" required min="0.01">
                        </div>
                    </div>
                    <div class="form-group" id="rho2-group" style="display: none;">
                        <label for="rho2">New Air Density (\(\rho_2\)) <span class="density-unit-label">(kg/m&#179;)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The new density of the air being handled. Affected by temperature, pressure, humidity.</span></span></label>
                        <input type="number" id="rho2" step="any" value="1.1" required min="0.01">
                    </div>
                    
                    <button type="button" id="calculate-fan-laws-btn" class="calculate-btn">Calculate New Fan Performance</button>
                </form>
            </div>

            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>This tool applies the standard Fan Laws for performance prediction. These laws are based on ideal assumptions and are most accurate when changes are small and fan efficiency remains relatively constant. The calculated efficiency (\(\eta_1\)) assumes the provided inputs are at a single, consistent operating point.</p>
                <p><strong>It does NOT account for:</strong> Significant changes in fan efficiency at different operating points (which often requires fan curve analysis), system curve changes, specific fan types (e.g., axial vs. centrifugal) which may have different characteristic curves, compressibility effects at very high pressures, or specific international standards like AMCA (Air Movement and Control Association International) which provide detailed test codes and ratings. Fan Laws are best applied to dynamically similar fans and operating conditions where efficiency is assumed constant.</p>
                <p>For accurate design, selection, and safety in real-world industrial applications, it is <strong>imperative</strong> to consult fan manufacturer's detailed performance curves, comprehensive HVAC or fluid dynamics handbooks, specialized simulation software, and qualified mechanical engineers.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Mechanical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Mechanical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="mailto:?subject=Check out Design Calculators - Mechanical!&body=I found this amazing Fan Laws Calculator and other mechanical tools: https://designcalculators.co.in" class="social-btn email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to DOM elements
            const calculateBtn = document.getElementById('calculate-fan-laws-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            // Input fields
            const unitSystemSelect = document.getElementById('unit-system');
            const calcTypeSelect = document.getElementById('calc-type');
            const q1Input = document.getElementById('q1');
            const sp1Input = document.getElementById('sp1');
            const p1Input = document.getElementById('p1');
            const rho1Input = document.getElementById('rho1');
            const n1Input = document.getElementById('n1');
            const d1Input = document.getElementById('d1');
            const n2Input = document.getElementById('n2');
            const d2Input = document.getElementById('d2');
            const rho2Input = document.getElementById('rho2');

            // Groups for dynamic display
            const n1Group = document.getElementById('n1-group');
            const d1Group = document.getElementById('d1-group');
            const n2Group = document.getElementById('n2-group');
            const d2Group = document.getElementById('d2-group');
            const rho2Group = document.getElementById('rho2-group');

            // Unit labels
            const flowUnitLabel = document.querySelector('.flow-unit-label');
            const pressureUnitLabel = document.querySelector('.pressure-unit-label');
            const powerUnitLabel = document.querySelector('.power-unit-label');
            const densityUnitLabels = document.querySelectorAll('.density-unit-label'); // Query all, as there are two
            const diameterUnitLabels = document.querySelectorAll('.diameter-unit-label'); // Query all, as there are two

            /**
             * Displays a custom message box at the top of the screen.
             * @param {string} message - The message to display.
             * @param {string} type - The type of message ('info', 'error', 'warning').
             */
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add(type); // Add type class for styling
                messageBox.style.opacity = 1;

                // Hide message after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            /**
             * Updates unit labels and input visibility/defaults based on selected unit system and calculation type.
             */
            function updateUnitLabelsAndDefaults() {
                const unitSystem = unitSystemSelect.value;
                
                if (unitSystem === 'metric') {
                    flowUnitLabel.innerHTML = '(m&#179;/s)';
                    pressureUnitLabel.innerHTML = '(Pa)';
                    powerUnitLabel.innerHTML = '(kW)';
                    densityUnitLabels.forEach(label => label.innerHTML = '(kg/m&#179;)');
                    diameterUnitLabels.forEach(label => label.innerHTML = '(mm)');

                    // Set metric defaults
                    q1Input.value = "1.0";
                    sp1Input.value = "250";
                    p1Input.value = "0.5";
                    rho1Input.value = "1.2";
                    n1Input.value = "1000";
                    d1Input.value = "500";
                    n2Input.value = "1200";
                    d2Input.value = "600";
                    rho2Input.value = "1.1";

                } else { // Imperial
                    flowUnitLabel.innerHTML = '(CFM)';
                    pressureUnitLabel.innerHTML = '(in.wc)'; // inches of water column
                    powerUnitLabel.innerHTML = '(HP)';
                    densityUnitLabels.forEach(label => label.innerHTML = '(lb/ft&#179;)');
                    diameterUnitLabels.forEach(label => label.innerHTML = '(inch)');

                    // Set imperial defaults
                    q1Input.value = "2000";
                    sp1Input.value = "1.0";
                    p1Input.value = "0.75";
                    rho1Input.value = "0.075"; // Standard air density at 70°F, 14.7 psi
                    n1Input.value = "1000";
                    d1Input.value = "20";
                    n2Input.value = "1200";
                    d2Input.value = "24";
                    rho2Input.value = "0.07";
                }
                toggleInputVisibility();
            }

            /**
             * Toggles visibility and required status of inputs based on calculation type.
             */
            function toggleInputVisibility() {
                const calcType = calcTypeSelect.value;

                // Reset all to hidden/not required initially
                n1Group.style.display = 'none';
                d1Group.style.display = 'none';
                n2Group.style.display = 'none';
                d2Group.style.display = 'none';
                rho2Group.style.display = 'none';

                n1Input.removeAttribute('required');
                d1Input.removeAttribute('required');
                n2Input.removeAttribute('required');
                d2Input.removeAttribute('required');
                rho2Input.removeAttribute('required');

                // Set required inputs based on calcType
                switch (calcType) {
                    case 'speed-change':
                        n1Group.style.display = 'block';
                        n2Group.style.display = 'block';
                        n1Input.setAttribute('required', 'true');
                        n2Input.setAttribute('required', 'true');
                        break;
                    case 'diameter-change':
                        d1Group.style.display = 'block';
                        d2Group.style.display = 'block';
                        d1Input.setAttribute('required', 'true');
                        d2Input.setAttribute('required', 'true');
                        break;
                    case 'density-change':
                        rho2Group.style.display = 'block';
                        rho2Input.setAttribute('required', 'true');
                        // Speed and Diameter are assumed constant, so N1/D1 inputs are not needed
                        break;
                    case 'speed-and-density-change':
                        n1Group.style.display = 'block';
                        n2Group.style.display = 'block';
                        rho2Group.style.display = 'block';
                        n1Input.setAttribute('required', 'true');
                        n2Input.setAttribute('required', 'true');
                        rho2Input.setAttribute('required', 'true');
                        break;
                    case 'diameter-and-density-change':
                        d1Group.style.display = 'block';
                        d2Group.style.display = 'block';
                        rho2Group.style.display = 'block';
                        d1Input.setAttribute('required', 'true');
                        d2Input.setAttribute('required', 'true');
                        rho2Input.setAttribute('required', 'true');
                        break;
                }

                // Always required for initial performance
                q1Input.setAttribute('required', 'true');
                sp1Input.setAttribute('required', 'true');
                p1Input.setAttribute('required', 'true');
                rho1Input.setAttribute('required', 'true'); // Original density is always needed for efficiency or density change
            }


            // Event listeners
            unitSystemSelect.addEventListener('change', updateUnitLabelsAndDefaults);
            calcTypeSelect.addEventListener('change', toggleInputVisibility);


            // Initial UI setup on load
            updateUnitLabelsAndDefaults();

            /**
             * Adds a row to the result table.
             * @param {string} parameterHtml - The HTML content for the parameter column.
             * @param {string} valueHtml - The HTML content for the value column.
             */
            function addResultRow(parameterHtml, valueHtml) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameterHtml;
                valueCell.innerHTML = valueHtml;
            }

            // Main Calculation Logic
            calculateBtn.addEventListener('click', function() {
                const form = document.getElementById('fan-laws-form');
                if (!form.checkValidity()) {
                    displayMessage("Please fill in all required fields correctly.", "error");
                    form.reportValidity(); // Show native browser validation messages
                    return;
                }

                const unitSystem = unitSystemSelect.value;
                const calcType = calcTypeSelect.value;

                // Original values
                const Q1_input = parseFloat(q1Input.value);
                const SP1_input = parseFloat(sp1Input.value);
                const P1_input = parseFloat(p1Input.value);
                const Rho1_input = parseFloat(rho1Input.value);
                const N1_input = parseFloat(n1Input.value);
                const D1_input = parseFloat(d1Input.value);

                // New values (may not all be used depending on calcType)
                const N2_input = parseFloat(n2Input.value);
                const D2_input = parseFloat(d2Input.value);
                const Rho2_input = parseFloat(rho2Input.value);

                // Input validation (common for all types)
                if (Q1_input <= 0 || SP1_input <= 0 || P1_input <= 0 || Rho1_input <= 0) {
                    displayMessage("Original Flow, Pressure, Power, and Density must be positive.", "error");
                    return;
                }

                if (calcType === 'speed-change' || calcType === 'speed-and-density-change') {
                    if (N1_input <= 0 || N2_input <= 0) {
                        displayMessage("Fan Speeds (N1, N2) must be positive.", "error");
                        return;
                    }
                }
                if (calcType === 'diameter-change' || calcType === 'diameter-and-density-change') {
                    if (D1_input <= 0 || D2_input <= 0) {
                        displayMessage("Impeller Diameters (D1, D2) must be positive.", "error");
                        return;
                    }
                }
                if (calcType === 'density-change' || calcType === 'speed-and-density-change' || calcType === 'diameter-and-density-change') {
                    if (Rho2_input <= 0) {
                        displayMessage("New Air Density (Rho2) must be positive.", "error");
                        return;
                    }
                }

                // Convert all inputs to SI for internal consistency
                let Q1_si, SP1_si, P1_si_watts, Rho1_si; // m³/s, Pa, W, kg/m³
                let N1_si_rps, D1_si_m; // rps, m

                if (unitSystem === 'metric') {
                    Q1_si = Q1_input;          // m³/s (already correct)
                    SP1_si = SP1_input;        // Pa (already correct)
                    P1_si_watts = P1_input * 1000; // kW to Watts
                    Rho1_si = Rho1_input;      // kg/m³ (already correct)
                    N1_si_rps = N1_input / 60;   // RPM to rps
                    D1_si_m = D1_input / 1000;   // mm to m
                } else { // Imperial
                    Q1_si = Q1_input * 0.0004719474; // CFM to m³/s
                    SP1_si = SP1_input * 249.088;    // in.wc to Pa (1 in.wc = 249.088 Pa)
                    P1_si_watts = P1_input * 745.7;  // HP to Watts
                    Rho1_si = Rho1_input * 16.0185;  // lb/ft³ to kg/m³
                    N1_si_rps = N1_input / 60;   // RPM to rps
                    D1_si_m = D1_input * 0.0254;   // inch to m
                }

                // Calculate Original Fan Hydraulic Power (Watts)
                const P_hyd1_watts = Q1_si * SP1_si;

                // Calculate Original Fan Efficiency (%)
                let eta1_percent = 0;
                if (P1_si_watts > 0) {
                    eta1_percent = (P_hyd1_watts / P1_si_watts) * 100;
                }

                // Prepare new values in SI for calculation
                let N2_si_rps = N1_si_rps; // Default to original if not changing
                let D2_si_m = D1_si_m;   // Default to original if not changing
                let Rho2_si = Rho1_si;   // Default to original if not changing

                if (calcType === 'speed-change' || calcType === 'speed-and-density-change') {
                    N2_si_rps = N2_input / 60; // New RPM to rps
                }
                if (calcType === 'diameter-change' || calcType === 'diameter-and-density-change') {
                    D2_si_m = D2_input / 1000; // New mm to m (or new inch to m if imperial D2_input * 0.0254)
                    if (unitSystem === 'imperial') {
                        D2_si_m = D2_input * 0.0254; // Correct imperial D2 to m conversion
                    }
                }
                if (calcType.includes('density-change')) {
                    Rho2_si = (unitSystem === 'metric') ? Rho2_input : Rho2_input * 16.0185; // New density to kg/m³
                }

                let Q2_calc_si = Q1_si;
                let SP2_calc_si = SP1_si;
                let P2_calc_si_watts = P1_si_watts;

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>1. Input Parameters & Initial Calculations:</strong></p><ul>
                    <li>Original Flow Rate (\\(Q_1\\)): ${Q1_input.toFixed(2)} ${flowUnitLabel.textContent} \\( \\rightarrow \\) ${Q1_si.toFixed(3)} m&#179;/s</li>
                    <li>Original Static Pressure (\\(SP_1\\)): ${SP1_input.toFixed(2)} ${pressureUnitLabel.textContent} \\( \\rightarrow \\) ${SP1_si.toFixed(2)} Pa</li>
                    <li>Original Power (\\(P_1\\)): ${P1_input.toFixed(2)} ${powerUnitLabel.textContent} \\( \\rightarrow \\) ${P1_si_watts.toFixed(2)} W</li>
                    <li>Original Air Density (\\(\\rho_1\\)): ${Rho1_input.toFixed(2)} ${densityUnitLabels[0].textContent} \\( \\rightarrow \\) ${Rho1_si.toFixed(2)} kg/m&#179;</li>
                    <li>Original Fan Speed (\\(N_1\\)): ${N1_input.toFixed(0)} RPM \\( \\rightarrow \\) ${N1_si_rps.toFixed(2)} rps</li>
                    <li>Original Impeller Diameter (\\(D_1\\)): ${D1_input.toFixed(0)} ${diameterUnitLabels[0].textContent} \\( \\rightarrow \\) ${D1_si_m.toFixed(3)} m</li>
                `;
                if (calcType === 'speed-change' || calcType === 'speed-and-density-change') {
                    calculationHtml += `<li>New Fan Speed (\\(N_2\\)): ${N2_input.toFixed(0)} RPM \\( \\rightarrow \\) ${N2_si_rps.toFixed(2)} rps</li>`;
                }
                if (calcType === 'diameter-change' || calcType === 'diameter-and-density-change') {
                    calculationHtml += `<li>New Impeller Diameter (\\(D_2\\)): ${D2_input.toFixed(0)} ${diameterUnitLabels[0].textContent} \\( \\rightarrow \\) ${D2_si_m.toFixed(3)} m</li>`;
                }
                if (calcType.includes('density-change')) {
                    calculationHtml += `<li>New Air Density (\\(\\rho_2\\)): ${Rho2_input.toFixed(2)} ${densityUnitLabels[1].textContent} \\( \\rightarrow \\) ${Rho2_si.toFixed(2)} kg/m&#179;</li>`;
                }
                calculationHtml += `</ul>`;

                // Calculate Original Fan Hydraulic Power & Efficiency
                calculationHtml += `<p><strong>1.1. Calculate Original Fan Hydraulic Power and Efficiency:</strong></p>`;
                calculationHtml += `<p class="formula">\\[ P_{hyd,1} = Q_1 \\cdot SP_1 \\]</p>`;
                calculationHtml += `<p class="calculation-step">
                    \\( P_{hyd,1} \\) = ${Q1_si.toFixed(3)} m&#179;/s \\( \\times \\) ${SP1_si.toFixed(2)} Pa = ${P_hyd1_watts.toFixed(2)} Watts
                </p>`;
                calculationHtml += `<p class="formula">\\[ \\eta_1 = \\frac{P_{hyd,1}}{P_1} \\times 100\\% \\]</p>`;
                calculationHtml += `<p class="calculation-step">
                    \\( \\eta_1 \\) = (${P_hyd1_watts.toFixed(2)} W / ${P1_si_watts.toFixed(2)} W) \\( \\times \\) 100\\% = ${eta1_percent.toFixed(2)} %
                </p>`;


                // Apply Fan Laws
                calculationHtml += `<p><strong>2. Applying Fan Laws for New Performance:</strong></p>`;

                switch (calcType) {
                    case 'speed-change':
                        // Law 1: Speed Change (same fan, same density)
                        // Q2/Q1 = N2/N1
                        // SP2/SP1 = (N2/N1)^2
                        // P2/P1 = (N2/N1)^3
                        Q2_calc_si = Q1_si * (N2_si_rps / N1_si_rps);
                        SP2_calc_si = SP1_si * Math.pow((N2_si_rps / N1_si_rps), 2);
                        P2_calc_si_watts = P1_si_watts * Math.pow((N2_si_rps / N1_si_rps), 3);
                        calculationHtml += `<p class="formula">\\[ \\frac{Q_2}{Q_1} = \\frac{N_2}{N_1} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( Q_2 \\) = ${Q1_si.toFixed(3)} \\( \\times \\) (${N2_si_rps.toFixed(2)} / ${N1_si_rps.toFixed(2)}) = ${Q2_calc_si.toFixed(3)} m&#179;/s</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{SP_2}{SP_1} = \\left( \\frac{N_2}{N_1} \\right)^2 \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( SP_2 \\) = ${SP1_si.toFixed(2)} \\( \\times \\) (${N2_si_rps.toFixed(2)} / ${N1_si_rps.toFixed(2)})^2 = ${SP2_calc_si.toFixed(2)} Pa</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{P_2}{P_1} = \\left( \\frac{N_2}{N_1} \\right)^3 \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( P_2 \\) = ${P1_si_watts.toFixed(2)} \\( \\times \\) (${N2_si_rps.toFixed(2)} / ${N1_si_rps.toFixed(2)})^3 = ${P2_calc_si_watts.toFixed(2)} Watts</p>`;
                        break;

                    case 'diameter-change':
                        // Law 2: Diameter Change (same speed, same density)
                        // Q2/Q1 = (D2/D1)^3
                        // SP2/SP1 = (D2/D1)^2
                        // P2/P1 = (D2/D1)^5
                        Q2_calc_si = Q1_si * Math.pow((D2_si_m / D1_si_m), 3);
                        SP2_calc_si = SP1_si * Math.pow((D2_si_m / D1_si_m), 2);
                        P2_calc_si_watts = P1_si_watts * Math.pow((D2_si_m / D1_si_m), 5);
                        calculationHtml += `<p class="formula">\\[ \\frac{Q_2}{Q_1} = \\left( \\frac{D_2}{D_1} \\right)^3 \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( Q_2 \\) = ${Q1_si.toFixed(3)} \\( \\times \\) (${D2_si_m.toFixed(3)} / ${D1_si_m.toFixed(3)})^3 = ${Q2_calc_si.toFixed(3)} m&#179;/s</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{SP_2}{SP_1} = \\left( \\frac{D_2}{D_1} \\right)^2 \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( SP_2 \\) = ${SP1_si.toFixed(2)} \\( \\times \\) (${D2_si_m.toFixed(3)} / ${D1_si_m.toFixed(3)})^2 = ${SP2_calc_si.toFixed(2)} Pa</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{P_2}{P_1} = \\left( \\frac{D_2}{D_1} \\right)^5 \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( P_2 \\) = ${P1_si_watts.toFixed(2)} \\( \\times \\) (${D2_si_m.toFixed(3)} / ${D1_si_m.toFixed(3)})^5 = ${P2_calc_si_watts.toFixed(2)} Watts</p>`;
                        break;

                    case 'density-change':
                        // Law 3: Density Change (same fan, same speed)
                        // Q2 = Q1 (Flow rate is independent of density for a given fan and speed)
                        // SP2/SP1 = Rho2/Rho1
                        // P2/P1 = Rho2/Rho1
                        Q2_calc_si = Q1_si; // Flow rate is unaffected by density change at constant speed/diameter
                        SP2_calc_si = SP1_si * (Rho2_si / Rho1_si);
                        P2_calc_si_watts = P1_si_watts * (Rho2_si / Rho1_si);
                        calculationHtml += `<p class="formula">\\[ Q_2 = Q_1 \\quad (\\text{flow rate is unaffected by density change}) \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( Q_2 \\) = ${Q1_si.toFixed(3)} m&#179;/s</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{SP_2}{SP_1} = \\frac{\\rho_2}{\\rho_1} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( SP_2 \\) = ${SP1_si.toFixed(2)} \\( \\times \\) (${Rho2_si.toFixed(2)} / ${Rho1_si.toFixed(2)}) = ${SP2_calc_si.toFixed(2)} Pa</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{P_2}{P_1} = \\frac{\\rho_2}{\\rho_1} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( P_2 \\) = ${P1_si_watts.toFixed(2)} \\( \\times \\) (${Rho2_si.toFixed(2)} / ${Rho1_si.toFixed(2)}) = ${P2_calc_si_watts.toFixed(2)} Watts</p>`;
                        break;

                    case 'speed-and-density-change':
                        // Combine Law 1 and Law 3
                        // Q2/Q1 = N2/N1
                        // SP2/SP1 = (N2/N1)^2 * (Rho2/Rho1)
                        // P2/P1 = (N2/N1)^3 * (Rho2/Rho1)
                        Q2_calc_si = Q1_si * (N2_si_rps / N1_si_rps);
                        SP2_calc_si = SP1_si * Math.pow((N2_si_rps / N1_si_rps), 2) * (Rho2_si / Rho1_si);
                        P2_calc_si_watts = P1_si_watts * Math.pow((N2_si_rps / N1_si_rps), 3) * (Rho2_si / Rho1_si);
                        calculationHtml += `<p class="formula">\\[ \\frac{Q_2}{Q_1} = \\frac{N_2}{N_1} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( Q_2 \\) = ${Q1_si.toFixed(3)} \\( \\times \\) (${N2_si_rps.toFixed(2)} / ${N1_si_rps.toFixed(2)}) = ${Q2_calc_si.toFixed(3)} m&#179;/s</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{SP_2}{SP_1} = \\left( \\frac{N_2}{N_1} \\right)^2 \\cdot \\frac{\\rho_2}{\\rho_1} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( SP_2 \\) = ${SP1_si.toFixed(2)} \\( \\times \\) (${N2_si_rps.toFixed(2)} / ${N1_si_rps.toFixed(2)})^2 \\( \\times \\) (${Rho2_si.toFixed(2)} / ${Rho1_si.toFixed(2)}) = ${SP2_calc_si.toFixed(2)} Pa</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{P_2}{P_1} = \\left( \\frac{N_2}{N_1} \\right)^3 \\cdot \\frac{\\rho_2}{\\rho_1} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( P_2 \\) = ${P1_si_watts.toFixed(2)} \\( \\times \\) (${N2_si_rps.toFixed(2)} / ${N1_si_rps.toFixed(2)})^3 \\( \\times \\) (${Rho2_si.toFixed(2)} / ${Rho1_si.toFixed(2)}) = ${P2_calc_si_watts.toFixed(2)} Watts</p>`;
                        break;

                    case 'diameter-and-density-change':
                        // Combine Law 2 and Law 3
                        // Q2/Q1 = (D2/D1)^3
                        // SP2/SP1 = (D2/D1)^2 * (Rho2/Rho1)
                        // P2/P1 = (D2/D1)^5 * (Rho2/Rho1)
                        Q2_calc_si = Q1_si * Math.pow((D2_si_m / D1_si_m), 3);
                        SP2_calc_si = SP1_si * Math.pow((D2_si_m / D1_si_m), 2) * (Rho2_si / Rho1_si);
                        P2_calc_si_watts = P1_si_watts * Math.pow((D2_si_m / D1_si_m), 5) * (Rho2_si / Rho1_si);
                        calculationHtml += `<p class="formula">\\[ \\frac{Q_2}{Q_1} = \\left( \\frac{D_2}{D_1} \\right)^3 \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( Q_2 \\) = ${Q1_si.toFixed(3)} \\( \\times \\) (${D2_si_m.toFixed(3)} / ${D1_si_m.toFixed(3)})^3 = ${Q2_calc_si.toFixed(3)} m&#179;/s</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{SP_2}{SP_1} = \\left( \\frac{D_2}{D_1} \\right)^2 \\cdot \\frac{\\rho_2}{\\rho_1} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( SP_2 \\) = ${SP1_si.toFixed(2)} \\( \\times \\) (${D2_si_m.toFixed(3)} / ${D1_si_m.toFixed(3)})^2 \\( \\times \\) (${Rho2_si.toFixed(2)} / ${Rho1_si.toFixed(2)}) = ${SP2_calc_si.toFixed(2)} Pa</p>`;
                        calculationHtml += `<p class="formula">\\[ \\frac{P_2}{P_1} = \\left( \\frac{D_2}{D_1} \\right)^5 \\cdot \\frac{\\rho_2}{\\rho_1} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\( P_2 \\) = ${P1_si_watts.toFixed(2)} \\( \\times \\) (${D2_si_m.toFixed(3)} / ${D1_si_m.toFixed(3)})^5 \\( \\times \\) (${Rho2_si.toFixed(2)} / ${Rho1_si.toFixed(2)}) = ${P2_calc_si_watts.toFixed(2)} Watts</p>`;
                        break;
                }
                
                // Clear previous results
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = calculationHtml;

                // Add original parameters to results table
                addResultRow("Unit System", unitSystem === 'imperial' ? 'Imperial' : 'Metric');
                addResultRow("Calculation Type", calcTypeSelect.options[calcTypeSelect.selectedIndex].text);
                addResultRow("Original Flow Rate (\\(Q_1\\))", `${Q1_input.toFixed(2)} ${flowUnitLabel.textContent}`);
                addResultRow("Original Static Pressure (\\(SP_1\\))", `${SP1_input.toFixed(2)} ${pressureUnitLabel.textContent}`);
                addResultRow("Original Power (\\(P_1\\))", `${P1_input.toFixed(2)} ${powerUnitLabel.textContent}`);
                addResultRow("Original Air Density (\\(\\rho_1\\))", `${Rho1_input.toFixed(2)} ${densityUnitLabels[0].textContent}`);
                addResultRow("Original Fan Efficiency (\\(\\eta_1\\))", `<strong>\\( ${eta1_percent.toFixed(2)} \\)%</strong>`);


                if (calcType === 'speed-change' || calcType === 'speed-and-density-change') {
                    addResultRow("Original Fan Speed (\\(N_1\\))", `${N1_input.toFixed(0)} RPM`);
                    addResultRow("New Fan Speed (\\(N_2\\))", `${N2_input.toFixed(0)} RPM`);
                } else {
                     addResultRow("Original Fan Speed (\\(N_1\\))", `N/A (Constant)`);
                }

                if (calcType === 'diameter-change' || calcType === 'diameter-and-density-change') {
                    addResultRow("Original Impeller Diameter (\\(D_1\\))", `${D1_input.toFixed(0)} ${diameterUnitLabels[0].textContent}`);
                    addResultRow("New Impeller Diameter (\\(D_2\\))", `${D2_input.toFixed(0)} ${diameterUnitLabels[0].textContent}`);
                } else {
                    addResultRow("Original Impeller Diameter (\\(D_1\\))", `N/A (Constant)`);
                }

                if (calcType.includes('density-change')) {
                    addResultRow("New Air Density (\\(\\rho_2\\))", `${Rho2_input.toFixed(2)} ${densityUnitLabels[1].textContent}`);
                } else {
                    addResultRow("New Air Density (\\(\\rho_2\\))", `N/A (Constant)`);
                }

                // Convert calculated SI results back to display units
                let Q2_display, SP2_display, P2_display;
                if (unitSystem === 'metric') {
                    Q2_display = Q2_calc_si; // m³/s
                    SP2_display = SP2_calc_si; // Pa
                    P2_display = P2_calc_si_watts / 1000; // Watts to kW
                } else { // Imperial
                    Q2_display = Q2_calc_si / 0.0004719474; // m³/s to CFM
                    SP2_display = SP2_calc_si / 249.088;    // Pa to in.wc
                    P2_display = P2_calc_si_watts / 745.7;  // Watts to HP
                }

                // Add calculated results
                addResultRow("New Flow Rate (\\(Q_2\\))", `<strong>\\( ${Q2_display.toFixed(2)} \\) ${flowUnitLabel.textContent}</strong>`);
                addResultRow("New Static Pressure (\\(SP_2\\))", `<strong>\\( ${SP2_display.toFixed(2)} \\) ${pressureUnitLabel.textContent}</strong>`);
                addResultRow("New Power (\\(P_2\\))", `<strong>\\( ${P2_display.toFixed(2)} \\) ${powerUnitLabel.textContent}</strong>`);

                // Re-render MathJax equations - ensure MathJax is fully loaded
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    window.MathJax.typesetPromise([calculationDetailsDiv, resultTableBody]);
                }

                // Display standard reference
                standardReference.innerHTML = "This tool applies the standard Fan Laws for performance prediction. These laws are based on ideal assumptions and are most accurate when changes are small and fan efficiency remains relatively constant. The calculated efficiency (\\(\\eta_1\\)) assumes the provided inputs are at a single, consistent operating point. It does NOT account for: Significant changes in fan efficiency at different operating points (which often requires fan curve analysis), system curve changes, specific fan types (e.g., axial vs. centrifugal) which may have different characteristic curves, compressibility effects at very high pressures, or specific international standards like AMCA (Air Movement and Control Association International) which provide detailed test codes and ratings. Fan Laws are best applied to dynamically similar fans and operating conditions where efficiency is assumed constant. For accurate design, selection, and safety in real-world industrial applications, it is <strong>imperative</strong> to consult fan manufacturer's detailed performance curves, comprehensive HVAC or fluid dynamics handbooks, specialized simulation software, and qualified mechanical engineers.";

                // Show results container
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth' });

                displayMessage("Fan Laws Calculation completed successfully!", "info");
            });

            // Theme switch functionality
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>