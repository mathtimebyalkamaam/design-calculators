<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Transformer Sizing Calculator (IEC/IEEE) | Design Calculators</title>
    <meta name="description" content="Professional industrial transformer sizing calculator. Accounts for kVA, load growth, K-Factor (harmonics), altitude, and temperature derating per IEC & IEEE.">
    <meta name="keywords" content="transformer sizing calculator, kva calculator, electrical transformer, iec 60076, ieee c57, k-factor, altitude derating">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/transformer-calculator.html" />

    <!-- AdSense & Google Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- MathJax for formula rendering -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' },
            options: { processHtmlClass: 'math-content', ignoreHtmlClass: 'no-mathjax' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    <!-- New CSS Block -->
    <style>
        :root {
            --primary-color: #1E3A8A;
            --secondary-color: #2563EB;
            --accent-color: #F59E0B;
            --success-color: #10B981;
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-color: #4B5563;
            --heading-color: #111827;
            --footer-bg: #0F172A;
            --border-color: #E2E8F0;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --input-focus-shadow: 0 0 0 3px rgba(30, 58, 138, 0.25);
        }

        body.dark-mode {
            --primary-color: #10B981;
            --secondary-color: #34D399;
            --bg-color: #0F172A;
            --card-bg: #1E293B;
            --text-color: #CBD5E1;
            --heading-color: #F1F5F9;
            --footer-bg: #020617;
            --border-color: #334155;
            --hover-color: #1E293B;
            --input-focus-shadow: 0 0 0 3px rgba(16, 185, 129, 0.5);
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* HEADER */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 24px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent-color); }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .theme-toggle .icon {
            color: white;
            font-size: 1.2rem;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content */
        main { padding: 40px 0; }
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
        }
         .tool-container h3 {
            color: var(--heading-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1rem;
            line-height: 1.8;
        }
        .tool-description a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        .tool-description a:hover {
            text-decoration: underline;
        }

        /* Form Styles */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading-color);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            transition: all 0.3s;
            font-size: 1rem;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: var(--input-focus-shadow);
            outline: none;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        /* Button Styles */
        .calculate-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .calculate-btn:disabled {
            background: #9ca3af; /* Grey */
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .calculate-btn .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-left-color: #ffffff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Result Styles */
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .result-container.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .result-table th, .result-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 700;
        }
        .result-table tr:nth-child(even) {
            background-color: rgba(0,0,0,0.02);
        }
        .result-table td strong {
            color: var(--heading-color);
        }
        body.dark-mode .result-table td strong {
             color: var(--primary-color);
        }
        
        /* Calculation Details & Standard Ref */
        #detailed-calculations {
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.95rem;
        }
        #detailed-calculations h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        #detailed-calculations p.formula {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            text-align: center;
            padding: 15px;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
        }
        #detailed-calculations p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            line-height: 1.6;
        }
        #detailed-calculations ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #detailed-calculations ul li {
            margin-bottom: 8px;
            line-height: 1.7;
        }

        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            padding: 15px;
            background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.05));
            border-left: 4px solid var(--accent-color);
            border-radius: 6px;
            line-height: 1.7;
        }
         .standard-reference a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        .standard-reference a:hover {
            text-decoration: underline;
        }

        /* Tooltip */
        .info-icon {
            color: var(--primary-color);
            margin-left: 6px;
            cursor: help;
            font-size: 0.9rem;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 130%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.5;
            white-space: normal;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Custom Message Box */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #custom-message-box.show { opacity: 1; }

        /* New Content Block Styles */
        .content-block {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            margin-top: 30px;
        }
        .content-block h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
        }
        .content-block h3 {
            color: var(--heading-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            margin-top: 25px;
            margin-bottom: 15px;
        }
         .content-block h4 {
            color: var(--secondary-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2rem;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .content-block p, .content-block li {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-color);
        }
        .content-block ul, .content-block ol {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 5px;
            margin-bottom: 15px;
        }
        .content-block ol {
            list-style-type: decimal;
        }
        .content-block li {
            margin-bottom: 10px;
        }
        .content-block strong {
            color: var(--heading-color);
        }
        .content-block code {
            background-color: var(--hover-color);
            padding: 2px 5px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--primary-color);
        }
        body.dark-mode .content-block code {
            color: var(--secondary-color);
        }
        .content-block .formula-block {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            text-align: center;
            padding: 15px;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 20px 0;
            overflow-x: auto;
            border: 1px dashed var(--primary-color);
        }
        .content-block table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .content-block th, .content-block td {
            padding: 14px;
            text-align: left;
            border: 1px solid var(--border-color);
        }
        .content-block th {
            background-color: var(--hover-color);
            font-weight: 600;
        }
        
        /* FOOTER */
        footer {
            background: var(--gradient-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            font-size: 1.1rem;
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col ul li { margin-bottom: 10px; }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
            font-size: 0.95rem;
        }
        .footer-col a:hover { color: var(--accent-color); }
        .footer-disclaimer {
            text-align: center;
            margin: 30px auto;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        .creator-name {
            color: var(--secondary-color);
            font-weight: bold;
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            text-decoration: none;
            font-size: 1.1rem;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .tool-container, .content-block { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .theme-toggle {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 15px;
            }
            .content-block table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
        }
        .hidden { display: none; }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    
    <!-- NEW HEADER -->
    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <!-- MAIN CONTENT - Refactored -->
    <main class="container">
        <!-- Back button removed -->
        <div class="tool-container">
            <h2>Advanced Industrial Transformer Sizing Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator helps you determine the appropriate transformer size (kVA) based on load requirements, voltage, and critical industrial factors. It accounts for future load growth, harmonics (K-Factor), cooling methods, and environmental derating (altitude, ambient temperature) as per <strong>IEC 60076</strong> and <strong>IEEE C57</strong> standards.</p>
            </div>
            
            <div class="calculator-form">
                <form id="transformer-sizing-form">
                    
                    <h3>1. Load & Voltage Parameters</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="load-kva">Base Load (kVA) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The total *apparent power* (kVA) required by the load *today*.</span></span></label>
                            <input type="number" id="load-kva" min="0.1" step="0.1" value="100" required>
                        </div>
                        <div class="form-group">
                            <label for="load-growth-factor">Future Load Growth (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Anticipated future load increase (e.g., 20 for 20% growth). Standard practice is 15-25%.</span></span></label>
                            <input type="number" id="load-growth-factor" min="0" step="1" value="20">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="primary-voltage">Primary Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The input voltage to the transformer (e.g., 11000V).</span></span></label>
                            <input type="number" id="primary-voltage" min="1" step="1" value="11000" required>
                        </div>
                        <div class="form-group">
                            <label for="secondary-voltage">Secondary Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The output voltage of the transformer (e.g., 415V).</span></span></label>
                            <input type="number" id="secondary-voltage" min="1" step="1" value="415" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phase-type-transformer">System Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Single-phase or three-phase system. Most industrial loads are three-phase.</span></span></label>
                            <select id="phase-type-transformer" required>
                                <option value="single">Single-Phase</option>
                                <option value="three" selected>Three-Phase</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label for="power-factor">Load Power Factor (PF) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The power factor of the load (e.g., 0.85). Used for calculating currents and voltage regulation.</span></span></label>
                            <input type="number" id="power-factor" min="0.1" max="1" step="0.01" value="0.8">
                        </div>
                    </div>

                    <h3>2. Transformer Specification</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="impedance">Transformer Impedance (Z%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Typical transformer impedance, usually 3% to 7%. Affects voltage regulation and fault current.</span></span></label>
                            <input type="number" id="impedance" min="1" max="10" step="0.1" value="5">
                        </div>
                         <div class="form-group">
                            <label for="cooling-method">Cooling Method <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Type of cooling: AN (Air Natural), AF (Air Forced), ONAN (Oil Natural Air Natural), ONAF (Oil Natural Air Forced).</span></span></label>
                            <select id="cooling-method" required>
                                <option value="AN">AN (Air Natural / Dry Type)</option>
                                <option value="AF">AF (Air Forced / Dry Type)</option>
                                <option value="ONAN" selected>ONAN (Oil Natural Air Natural)</option>
                                <option value="ONAF">ONAF (Oil Natural Air Forced)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="insulation-class">Insulation Class <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Max temperature the insulation can withstand (e.g., 155°C for Class F, 180°C for Class H).</span></span></label>
                            <select id="insulation-class" required>
                                <option value="105">Class A (105°C)</option>
                                <option value="130">Class B (130°C)</option>
                                <option value="155" selected>Class F (155°C)</option>
                                <option value="180">Class H (180°C)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="temperature-rise">Winding Temperature Rise (°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum allowable winding temperature rise above ambient. Common: 55°C or 65°C.</span></span></label>
                            <select id="temperature-rise" required>
                                <option value="55">55°C</option>
                                <option value="65" selected>65°C</option>
                            </select>
                        </div>
                    </div>

                    <h3>3. Load & Environmental Derating</h3>
                     <div class="form-row">
                        <div class="form-group">
                            <label for="k-factor">K-Factor (Harmonics) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Rating for non-linear loads (VFDs, LEDs, PCs). Use 1 for linear loads (motors, heaters). Use 4, 13, or 20 for harmonic-rich loads.</span></span></label>
                            <input type="number" id="k-factor" min="1" step="0.1" value="1.5">
                        </div>
                        <div class="form-group">
                            <label for="thd-i">Load THD-I (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total Harmonic Distortion of current. Used for K-Factor estimation if unknown. (Informational)</span></span></label>
                            <input type="number" id="thd-i" min="0" max="100" step="0.1" value="10">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="altitude">Installation Altitude (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Installation altitude above sea level. Derating is applied above 1000m per IEEE/IEC.</span></span></label>
                            <input type="number" id="altitude" min="0" step="10" value="500">
                        </div>
                        <div class="form-group">
                            <label for="ambient-temp">Max. Ambient Temperature (°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum average ambient temperature. Derating is applied for temps above 40°C.</span></span></label>
                            <input type="number" id="ambient-temp" min="-20" max="60" step="1" value="35">
                        </div>
                    </div>
                    
                    <!-- Hidden/Unused inputs from original, kept for logic compatibility -->
                    <input type="hidden" id="efficiency" value="98">
                    <input type="hidden" id="enclosure-type" value="outdoor">
                    
                    <!-- NEW Button Group -->
                    <div class="form-row" style="gap: 10px; margin-top: 25px;">
                        <button type="button" id="calculate-transformer-btn" class="calculate-btn" style="flex: 2;">
                            <i class="fas fa-calculator" style="margin-right: 8px;"></i>Calculate
                            <span class="spinner" id="calculate-spinner" style="display:none;"></span>
                        </button>
                        <button type="button" id="reset-calculations-btn" class="calculate-btn" style="flex: 1; background: var(--accent-color); box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                            <i class="fas fa-sync-alt" style="margin-right: 8px;"></i>Reset
                        </button>
                        <button type="button" id="download-pdf-btn" class="calculate-btn" style="flex: 1; background: var(--secondary-color); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);">
                            <i class="fas fa-file-pdf" style="margin-right: 8px;"></i>Download PDF
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Result Container - Refactored -->
            <div id="result-container" class="result-container">
                <h3>Calculation Summary</h3>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>

                <!-- Detailed calculations section -->
                <div id="detailed-calculations" class="math-content" style="margin-top: 20px;">
                    <!-- Detailed calculation steps will be dynamically inserted here -->
                </div>

                <!-- Standard Reference -->
                <div id="standard-reference" class="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <!-- NEW CONTENT BLOCK for AdSense -->
    <div class="container">
        <div class="content-block">
            <h2 class="math-content">A Comprehensive Guide to Industrial Transformer Sizing</h2>
            <p>Sizing an industrial transformer is far more complex than matching a load kVA to a transformer kVA. It involves a multi-faceted analysis of the load type, environmental conditions, and future planning to ensure safety, reliability, and efficiency over the transformer's 20-40 year lifespan. This guide explores the critical factors used in this calculator, which are mandated by standards like <strong>IEC 60076 (Power transformers)</strong> and <strong>IEEE C57 (Distribution and Power Transformers)</strong>.</p>

            <h3>1. Base Load, kVA vs. kW, and Future Growth</h3>
            <p>The first step is establishing the total load the transformer must serve.</p>
            <ul>
                <li><strong>Apparent Power (kVA):</strong> This is the "total" power required by the load, and it is what transformers are rated in. It is the vector sum of Real Power and Reactive Power.</li>
                <li><strong>Real Power (kW):</strong> This is the "working" power that performs the actual work (e.g., turning a motor shaft, lighting a lamp).</li>
                <li><strong>Power Factor (PF):</strong> This is the ratio of Real Power (kW) to Apparent Power (kVA). A load with a 0.8 PF requires 100 kVA of *transformer capacity* to produce 80 kW of *real work*.</li>
            </ul>
            <div class="formula-block math-content">
                $$ \text{kVA} = \frac{\text{kW}}{\text{Power Factor}} $$
            </div>
            <p><strong>Future Growth:</strong> An industrial facility is rarely static. Sizing a transformer *only* for today's load is a common and costly mistake. Standard practice involves adding a <strong>15% to 25% margin</strong> for future expansion. This calculator applies your specified "Future Load Growth" percentage directly to the base load.</p>
            <div class="formula-block math-content">
                $$ S_{\text{adjusted}} = S_{\text{base}} \times (1 + \frac{\text{Growth \%}}{100}) $$
            </div>

            <h3>2. Harmonics and the K-Factor (IEEE C57.110)</h3>
            <p>This is one of the most critical factors in modern industrial settings.</p>
            <ul>
                <li><strong>Linear Loads:</strong> "Old" loads like induction motors (DOL) and resistive heaters. They draw a smooth, sinusoidal current. A standard transformer (K-Factor of 1) is sufficient.</li>
                <li><strong>Non-Linear Loads:</strong> "New" loads like Variable Frequency Drives (VFDs), LED lighting, computer power supplies, and welding machines. They draw current in short, abrupt pulses.</li>
            </ul>
            <p>These pulses create **harmonic currents**, which are high-frequency "noise" that flows back into the transformer. This "noise" causes additional heating in the transformer windings and core, a phenomenon known as eddy current losses, which are proportional to the *square* of the frequency. A standard transformer will dangerously overheat and fail prematurely if subjected to significant harmonic loads.</p>
            <p>A <strong>K-Factor rating</strong> indicates a transformer's ability to withstand this harmonic heating. This calculator applies the K-Factor as a multiplier to the adjusted load to find the "harmonic-equivalent" kVA, ensuring the selected transformer can handle the extra heat.</p>
            <ul>
                <li><strong>K-1:</strong> Standard loads (motors, heaters).</li>
                <li><strong>K-4:</strong> Moderate harmonics (UPS systems, some fluorescent lighting).</li>
                <li><strong>K-13:</strong> High harmonics (Multiple PCs, VFDs, solid-state controls).</li>
                <li><strong>K-20:</strong> Severe harmonics (Data centers, telecom facilities).</li>
            </ul>

            <h3>3. Environmental Derating: Altitude & Temperature</h3>
            <p>A transformer's ability to cool itself depends on the density of the surrounding air. All standard transformers are rated for operation at a specific maximum altitude (typically 1000m) and maximum ambient temperature (typically 30°C average, 40°C max).</p>
            
            <h4>Altitude Derating (IEC 60076 / IEEE C57.12.00)</h4>
            <p>At higher altitudes, the air is less dense ("thinner") and cannot remove heat as effectively. To compensate, the transformer's kVA capacity must be derated.</p>
            <ul>
                <li><strong>Below 1000m (3300 ft):</strong> No derating required.</li>
                <li><strong>Above 1000m:</strong> The capacity is reduced by approximately **0.3% to 0.5% for every 100m** above 1000m. This calculator uses a conservative 0.35% derating factor per 100m.</li>
            </ul>
            <p>The calculator inverts this logic: it *increases* the required kVA size to ensure the derated transformer can still meet the load.</p>

            <h4>Ambient Temperature Derating (IEEE C57.96)</h4>
            <p>Similarly, if the transformer operates in an environment hotter than its 40°C maximum design temperature, its cooling is less effective. For every 10°C the ambient temperature is *above* 40°C, the transformer's capacity is typically derated by 10%. This calculator applies this derating if your specified ambient temperature exceeds 40°C.</p>

            <h3>4. Industrial Cooling Methods & Ratings (IEC 60076-2)</h3>
            <p>How a transformer is cooled dictates its size and capacity. This is especially true for large industrial units, which often have multiple ratings based on the cooling stage in operation.</p>
            <ul>
                <li><strong>AN (Air Natural) / AA:</strong> Dry-type transformers. Air circulates naturally over the windings.</li>
                <li><strong>AF (Air Forced) / AFA:</strong> Dry-type with fans. Fans force air over the windings, increasing the kVA rating.</li>
                <li><strong>ONAN (Oil Natural Air Natural):</strong> The standard for oil-filled power transformers. The oil circulates naturally by convection, and the outside air circulates naturally over the radiator fins. This is the transformer's base kVA rating (e.g., <strong>12 MVA</strong>).</li>
                <li><strong>ONAF (Oil Natural Air Forced):</strong> The *same* ONAN transformer, but with fans added to the radiators. The forced air cools the oil more effectively, allowing the transformer to handle more load. This is the second-stage rating (e.g., <strong>16 MVA</strong>).</li>
                <li><strong>OFAF (Oil Forced Air Forced):</strong> Pumps are added to actively circulate the oil through the fan-cooled radiators. This is the maximum rating (e.g., <strong>20 MVA</strong>).</li>
            </ul>
            <p>An industrial transformer is often specified with all three ratings, like <strong>12/16/20 MVA (ONAN/ONAF/OFAF)</strong>. The calculation from this tool determines the *required* kVA, which you would then match to the appropriate rating stage (typically the ONAN or ONAF rating) of a standard transformer.</p>
            
            <h3>5. Other Key Industrial Specifications</h3>
            <ul>
                <li><strong>Impedance (Z%):</strong> A critical value (e.g., 5.75%). It determines the **Voltage Regulation** (how much the voltage sags under full load) and, most importantly, the **Available Fault Current** at the secondary, which is needed to size all downstream breakers.</li>
                <li><strong>BIL (Basic Impulse Level):</strong> A measure of the transformer's ability to withstand a very high, very fast voltage spike, such as from a lightning strike. A higher BIL (e.g., 95kV, 150kV) is required in areas with high lightning exposure.</li>
                <li><strong>Vector Group (e.g., Dyn11, YNyn0):</strong> Describes the winding connection configuration (Delta, Wye, Neutral) and the phase shift between the primary and secondary. This is critical for paralleling transformers and for managing harmonics.</li>
            </ul>
        </div>
    </div>

    <!-- NEW FOOTER -->
        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box for JS -->
    <div id="custom-message-box"></div>
    
    <!-- UPDATED SCRIPT -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get all buttons
            const calculateBtn = document.getElementById('calculate-transformer-btn');
            const resetFormBtn = document.getElementById('reset-calculations-btn');
            const downloadPdfBtn = document.getElementById('download-pdf-btn');
            const calculationSpinner = document.getElementById('calculate-spinner');
            
            // Get containers
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const detailedCalculationsDiv = document.getElementById('detailed-calculations');
            const standardReference = document.getElementById('standard-reference');
            
            // --- Add displayMessage function ---
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                
                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; // Red
                    messageBox.style.color = 'white';
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; // Yellow
                    messageBox.style.color = '#333';
                } else { // info
                    messageBox.style.backgroundColor = '#28a745'; // Green
                    messageBox.style.color = 'white';
                }
                messageBox.classList.add('show');

                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 5000);
            }

            // Default values for resetting form
            const defaultValues = {
                'load-kva': 100,
                'primary-voltage': 11000,
                'secondary-voltage': 415,
                'efficiency': 98,
                'power-factor': 0.8,
                'load-growth-factor': 20,
                'phase-type-transformer': 'three',
                'k-factor': 1.5,
                'impedance': 5,
                'temperature-rise': 65,
                'insulation-class': 155,
                'enclosure-type': 'outdoor',
                'altitude': 500,
                'ambient-temp': 35,
                'cooling-method': 'ONAN',
                'thd-i': 10
            };

            // Main Calculation Logic
            calculateBtn.addEventListener('click', function() {
                // Show spinner and disable button
                calculationSpinner.style.display = 'inline-block';
                calculateBtn.disabled = true;

                // Use setTimeout to allow UI to update
                setTimeout(() => {
                    try {
                        // Get input values
                        const loadKVA = parseFloat(document.getElementById('load-kva').value);
                        const primaryVoltage = parseFloat(document.getElementById('primary-voltage').value);
                        const secondaryVoltage = parseFloat(document.getElementById('secondary-voltage').value);
                        const efficiency = parseFloat(document.getElementById('efficiency').value);
                        const loadPowerFactor = parseFloat(document.getElementById('power-factor').value);
                        const loadGrowthFactor = parseFloat(document.getElementById('load-growth-factor').value);
                        const phaseType = document.getElementById('phase-type-transformer').value;
                        const kFactor = parseFloat(document.getElementById('k-factor').value);
                        const impedance = parseFloat(document.getElementById('impedance').value);
                        const temperatureRise = parseFloat(document.getElementById('temperature-rise').value);
                        const insulationClass = parseFloat(document.getElementById('insulation-class').value);
                        const enclosureType = document.getElementById('enclosure-type').value;
                        const altitude = parseFloat(document.getElementById('altitude').value);
                        const ambientTemp = parseFloat(document.getElementById('ambient-temp').value);
                        const coolingMethod = document.getElementById('cooling-method').value;
                        const thdI = parseFloat(document.getElementById('thd-i').value);

                        // Input validation
                        if (isNaN(loadKVA) || isNaN(primaryVoltage) || isNaN(secondaryVoltage) || isNaN(efficiency) ||
                            isNaN(loadPowerFactor) || isNaN(loadGrowthFactor) || isNaN(kFactor) || isNaN(impedance) ||
                            isNaN(temperatureRise) || isNaN(insulationClass) || isNaN(altitude) || isNaN(ambientTemp) ||
                            isNaN(thdI)) {
                            throw new Error("Please fill in all required fields with valid numbers.");
                        }

                        if (loadKVA <= 0 || primaryVoltage <= 0 || secondaryVoltage <= 0 || efficiency <= 0 || efficiency > 100 ||
                            loadPowerFactor <= 0 || loadPowerFactor > 1 || loadGrowthFactor < 0 || kFactor < 1 ||
                            impedance <= 0 || impedance > 10 || altitude < 0 || ambientTemp < -20 || ambientTemp > 60 ||
                            thdI < 0 || thdI > 100) {
                            throw new Error("Please enter valid positive values. Check ranges: Efficiency (50-100%), PF (0.1-1), Growth (>=0), K-Factor (>=1), Impedance (1-10%), Altitude (>=0), Ambient Temp (-20-60C), THD-I (0-100%).");
                        }

                        // Clear previous results
                        resultTableBody.innerHTML = '';
                        detailedCalculationsDiv.innerHTML = '<h3>Detailed Calculation Steps</h3>'; // Reset title
                        resultContainer.classList.remove('show');

                        // --- Transformer Sizing Calculation Logic ---

                        // Step 1: Calculate Load kVA after considering Load Growth Factor
                        const adjustedLoadKVA = loadKVA * (1 + (loadGrowthFactor / 100));
                        addDetailedCalculationStep(
                            "Step 1: Calculate Adjusted Load ($S_{\\text{adjusted}}$)",
                            `Formula: $S_{\\text{adjusted}} = \\text{Load kVA} \\times (1 + \\frac{\\text{Load Growth \%}}{100})$`,
                            `$S_{\\text{adjusted}} = ${loadKVA.toFixed(2)} \\text{ kVA} \\times (1 + \\frac{${loadGrowthFactor.toFixed(0)}}{100}) = ${adjustedLoadKVA.toFixed(2)} \\text{ kVA}$`
                        );

                        // Step 2: K-Factor Adjustment for Non-Linear Loads
                        const kFactorAdjustedKVA = adjustedLoadKVA * kFactor;
                        addDetailedCalculationStep(
                            "Step 2: K-Factor Adjusted kVA ($S_{\\text{K-factor}}$)",
                            `Formula: $S_{\\text{K-factor}} = S_{\\text{adjusted}} \\times \\text{K-Factor}$`,
                            `$S_{\\text{K-factor}} = ${adjustedLoadKVA.toFixed(2)} \\text{ kVA} \\times ${kFactor.toFixed(1)} = ${kFactorAdjustedKVA.toFixed(2)} \\text{ kVA}$`
                        );

                        // Step 3: Altitude Derating (IEC 60076-1, IEEE C57.96)
                        let altitudeDeratingFactor = 1;
                        let altitudeDeratingExplanation = '1.000 (Altitude $\\le 1000 \\text{ m}$ - No derating required)';
                        if (altitude > 1000) {
                            const deRatePercentage = ((altitude - 1000) / 100) * 0.35; // 0.35% derating per 100m
                            altitudeDeratingFactor = 1 + (deRatePercentage / 100); // Inverse for sizing
                            altitudeDeratingExplanation = `$(1 + \\frac{(${altitude.toFixed(0)} - 1000)}{100} \\times 0.0035) = ${altitudeDeratingFactor.toFixed(3)}$`;
                        }
                        const altitudeAdjustedKVA = kFactorAdjustedKVA * altitudeDeratingFactor;
                        addDetailedCalculationStep(
                            "Step 3: Altitude Adjusted kVA ($S_{\\text{altitude}}$)",
                            `Formula: $S_{\\text{altitude}} = S_{\\text{K-factor}} \\times \\text{Altitude Derating Factor}$`,
                            `Altitude Derating Factor: ${altitudeDeratingExplanation}`,
                            `$S_{\\text{altitude}} = ${kFactorAdjustedKVA.toFixed(2)} \\text{ kVA} \\times ${altitudeDeratingFactor.toFixed(3)} = ${altitudeAdjustedKVA.toFixed(2)} \\text{ kVA}$`
                        );

                        // Step 4: Ambient Temperature Derating (Simplified for ambient temp > 40C)
                        let tempDeratingFactor = 1;
                        let tempDeratingExplanation = '1.000 (Ambient Temp $\\le 40^{\\circ}\\text{C}$ - No derating required)';
                        if (ambientTemp > 40) {
                            const tempIncrease = ambientTemp - 40;
                            const deRatePercentage = (tempIncrease / 10) * 10; // 10% derating per 10C
                            tempDeratingFactor = 1 + (deRatePercentage / 100); // Inverse for sizing
                            tempDeratingExplanation = `$(1 + \\frac{(${ambientTemp.toFixed(0)} - 40)}{10} \\times 0.10) = ${tempDeratingFactor.toFixed(3)}$`;
                        }
                        const finalRequiredTransformerKVA = altitudeAdjustedKVA * tempDeratingFactor;
                        addDetailedCalculationStep(
                            "Step 4: Final Required kVA ($S_{\\text{final}}$)",
                            `Formula: $S_{\\text{final}} = S_{\\text{altitude}} \\times \\text{Temp. Derating Factor}$`,
                            `Temp. Derating Factor: ${tempDeratingExplanation}`,
                            `$S_{\\text{final}} = ${altitudeAdjustedKVA.toFixed(2)} \\text{ kVA} \\times ${tempDeratingFactor.toFixed(3)} = ${finalRequiredTransformerKVA.toFixed(2)} \\text{ kVA}$`
                        );

                        // Step 5: Calculate Primary Current
                        let primaryCurrent = 0;
                        if (phaseType === 'single') {
                            primaryCurrent = (finalRequiredTransformerKVA * 1000) / primaryVoltage;
                            addDetailedCalculationStep(
                                "Step 5: Calculate Primary Current ($I_{P}$)",
                                `Formula: $I_{P} = \\frac{S_{\\text{final}} \\times 1000}{V_{P}}$`,
                                `$I_{P} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\times 1000}{${primaryVoltage.toFixed(0)}} = ${primaryCurrent.toFixed(2)} \\text{ A}$`
                            );
                        } else { // Three-Phase
                            primaryCurrent = (finalRequiredTransformerKVA * 1000) / (Math.sqrt(3) * primaryVoltage);
                            addDetailedCalculationStep(
                                "Step 5: Calculate Primary Current ($I_{P}$)",
                                `Formula: $I_{P} = \\frac{S_{\\text{final}} \\times 1000}{\\sqrt{3} \\times V_{P}}$`,
                                `$I_{P} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\times 1000}{1.732 \\times ${primaryVoltage.toFixed(0)}} = ${primaryCurrent.toFixed(2)} \\text{ A}$`
                            );
                        }

                        // Step 6: Calculate Secondary Current
                        let secondaryCurrent = 0;
                        if (phaseType === 'single') {
                            secondaryCurrent = (finalRequiredTransformerKVA * 1000) / secondaryVoltage;
                            addDetailedCalculationStep(
                                "Step 6: Calculate Secondary Current ($I_{S}$)",
                                `Formula: $I_{S} = \\frac{S_{\\text{final}} \\times 1000}{V_{S}}$`,
                                `$I_{S} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\times 1000}{${secondaryVoltage.toFixed(0)}} = ${secondaryCurrent.toFixed(2)} \\text{ A}$`
                            );
                        } else { // Three-Phase
                            secondaryCurrent = (finalRequiredTransformerKVA * 1000) / (Math.sqrt(3) * secondaryVoltage);
                            addDetailedCalculationStep(
                                "Step 6: Calculate Secondary Current ($I_{S}$)",
                                `Formula: $I_{S} = \\frac{S_{\\text{final}} \\times 1000}{\\sqrt{3} \\times V_{S}}$`,
                                `$I_{S} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\times 1000}{1.732 \\times ${secondaryVoltage.toFixed(0)}} = ${secondaryCurrent.toFixed(2)} \\text{ A}$`
                            );
                        }
                        
                        // Step 7: Calculate Voltage Regulation (Approximate)
                        const impedancePerUnit = impedance / 100;
                        const loadAngleRad = Math.acos(loadPowerFactor);
                        const xrRatio = 5; // Assumed X/R ratio
                        const sqrtOnePlusXrRatioSquared = Math.sqrt(1 + xrRatio * xrRatio);
                        const percentR = impedancePerUnit / sqrtOnePlusXrRatioSquared;
                        const percentX = impedancePerUnit * xrRatio / sqrtOnePlusXrRatioSquared;
                        const voltageRegulation = (percentR * Math.cos(loadAngleRad) + percentX * Math.sin(loadAngleRad)) * 100;
                        addDetailedCalculationStep(
                            "Step 7: Estimate Voltage Regulation (%VR)",
                            `Formula: $\%VR \\approx (\\%R \\times \\cos(\\phi) + \\%X \\times \\sin(\\phi))$`,
                            `Assuming X/R=5: $\%R = ${percentR.toFixed(4)}, \\%X = ${percentX.toFixed(4)}$
                            <p class="calculation-step">$%VR \\approx (${percentR.toFixed(4)} \\times ${loadPowerFactor} + ${percentX.toFixed(4)} \\times ${Math.sin(loadAngleRad).toFixed(3)}) \\times 100 = ${voltageRegulation.toFixed(2)} \\%$</p>`
                        );

                        // Step 8: Calculate Short Circuit Current (at secondary)
                        const shortCircuitCurrent = secondaryCurrent / (impedance / 100);
                        addDetailedCalculationStep(
                            "Step 8: Estimate Secondary Short Circuit Current ($I_{\\text{SC}}$)",
                            `Formula: $I_{\\text{SC}} = \\frac{I_{S}}{\\text{Z}_{pu}} = \\frac{I_{S}}{\\text{Impedance \%} / 100}$`,
                            `$I_{\\text{SC}} = \\frac{${secondaryCurrent.toFixed(2)} \\text{ A}}{${impedance / 100}} = ${shortCircuitCurrent.toFixed(2)} \\text{ A (or ${(shortCircuitCurrent/1000).toFixed(2)} kA)}$`
                        );

                        // Step 9: Estimate Losses (Approximate)
                        const noLoadLosses = finalRequiredTransformerKVA * 0.003 * 1000; // 0.3%
                        const fullLoadLosses = finalRequiredTransformerKVA * 0.02 * 1000; // 2%
                        const totalLossesFullLoad = noLoadLosses + fullLoadLosses;
                        const actualEfficiency = ((finalRequiredTransformerKVA * loadPowerFactor * 1000) / ((finalRequiredTransformerKVA * loadPowerFactor * 1000) + totalLossesFullLoad)) * 100;
                        addDetailedCalculationStep(
                            "Step 9: Estimate Transformer Losses (Approx.)",
                            `No-Load (Core) Losses $\\approx 0.3\\% \\times S_{\\text{final}} = ${noLoadLosses.toFixed(0)} \\text{ W}$`,
                            `Full-Load (Winding) Losses $\\approx 2\\% \\times S_{\\text{final}} = ${fullLoadLosses.toFixed(0)} \\text{ W}$
                             <p class="calculation-step">Est. Efficiency at Full Load & ${loadPowerFactor} PF $\\approx ${actualEfficiency.toFixed(2)} \\%$</p>`
                        );

                        // Display Summary Results
                        addResultRow("Base Load", loadKVA.toFixed(2) + " kVA");
                        addResultRow("Adjusted Load (with Growth)", adjustedLoadKVA.toFixed(2) + " kVA");
                        addResultRow("K-Factor Adjusted kVA", kFactorAdjustedKVA.toFixed(2) + " kVA");
                        addResultRow("Altitude Adjusted kVA", altitudeAdjustedKVA.toFixed(2) + " kVA");
                        addResultRow("<strong>Final Required Transformer kVA</strong>", `<strong>${finalRequiredTransformerKVA.toFixed(2)} kVA</strong>`);
                        addResultRow("Primary Full Load Current", `<strong>${primaryCurrent.toFixed(2)} A</strong>`);
                        addResultRow("Secondary Full Load Current", `<strong>${secondaryCurrent.toFixed(2)} A</strong>`);
                        addResultRow("System Type", phaseType === "single" ? "Single-Phase" : "Three-Phase");
                        addResultRow("Est. Voltage Regulation", `${voltageRegulation.toFixed(2)} %`);
                        addResultRow("Est. Secondary Fault Current", `<strong>${(shortCircuitCurrent/1000).toFixed(2)} kA</strong>`);
                        addResultRow("Cooling / Insulation", `${coolingMethod} / Class ${insulationClass}°C`);
                        addResultRow("Derating Factors", `K-Factor: ${kFactor.toFixed(1)}, Altitude: ${altitudeDeratingFactor.toFixed(3)}, Temp: ${tempDeratingFactor.toFixed(3)}`);
                        
                        // Set standard reference text
                        standardReference.innerHTML = `<strong>Standard Reference:</strong> Sizing based on <strong>IEC 60076</strong> & <strong>IEEE C57</strong> standards. This calculation accounts for load growth, harmonic K-Factor derating (per <strong>IEEE C57.110</strong>), and environmental derating for altitude (per <strong>IEC 60076-1</strong>) and ambient temperature (per <strong>IEEE C57.96</strong>). The final kVA rating represents the minimum required continuous capacity. Always select the next standard transformer size *above* this value.`;
                        
                        // Show results
                        resultContainer.style.display = 'block';
                        setTimeout(() => resultContainer.classList.add('show'), 10);
                        resultContainer.scrollIntoView({ behavior: 'smooth' });

                    } catch (error) {
                        displayMessage(error.message, "error");
                    } finally {
                        // Re-enable button and hide spinner
                        calculationSpinner.style.display = 'none';
                        calculateBtn.disabled = false;
                    }
                }, 500); // 500ms delay
            });

            // Helper function to add a row to the summary result table
            function addResultRow(parameter, value) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
            }

            // Helper function to add a detailed calculation step
            function addDetailedCalculationStep(stepTitle, formulaText, calculationText) {
                const stepDiv = document.createElement('div');
                stepDiv.style.marginBottom = '15px';
                stepDiv.style.paddingBottom = '15px';
                stepDiv.style.borderBottom = `1px dashed var(--border-color)`;

                const titleElem = document.createElement('h4');
                titleElem.innerHTML = stepTitle;
                stepDiv.appendChild(titleElem);

                if (formulaText) {
                    const formulaElem = document.createElement('p');
                    formulaElem.classList.add('formula'); // Use the .formula class
                    formulaElem.innerHTML = formulaText;
                    stepDiv.appendChild(formulaElem);
                }

                if (calculationText) {
                    const calcElem = document.createElement('p');
                    calcElem.classList.add('calculation-step'); // Use the .calculation-step class
                    calcElem.innerHTML = calculationText; // Use innerHTML to allow MathJax
                    stepDiv.appendChild(calcElem);
                }
                detailedCalculationsDiv.appendChild(stepDiv);

                // Tell MathJax to re-render the newly added content
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    window.MathJax.typesetPromise([stepDiv]).catch(err => console.error(err));
                }
            }

            // Reset Form Function
            function resetForm() {
                for (const id in defaultValues) {
                    const input = document.getElementById(id);
                    if (input) input.value = defaultValues[id];
                }
                clearResults();
                displayMessage("Form reset to default values.", "info");
            }
            
            // Clear Results Function
            function clearResults() {
                resultContainer.classList.remove('show');
                setTimeout(() => {
                    resultTableBody.innerHTML = '';
                    detailedCalculationsDiv.innerHTML = '';
                    standardReference.innerHTML = '';
                    resultContainer.style.display = 'none';
                }, 500); // Wait for fade out
            }

            // Download PDF Function
            function downloadPDF() {
                if (!resultContainer.classList.contains('show')) {
                    displayMessage("Please run a calculation first to generate a report.", "error");
                    return;
                }
                
                displayMessage("Generating PDF... Please wait.", "info");

                const pdfTarget = document.getElementById('result-container');
                const { jsPDF } = window.jspdf;

                html2canvas(pdfTarget, {
                    scale: 2,
                    useCORS: true,
                    onclone: (doc) => {
                        // Ensure dark mode text is visible on PDF
                        if (document.body.classList.contains('dark-mode')) {
                           let elements = doc.querySelectorAll('.result-container, .result-table td, #detailed-calculations, .standard-reference, .result-container h3, #detailed-calculations h4, .result-table td strong, #detailed-calculations p, #detailed-calculations ul li');
                           elements.forEach(el => {
                                el.style.color = '#000000';
                           });
                           doc.querySelector('.result-container').style.background = '#FFFFFF';
                           doc.querySelector('#detailed-calculations').style.background = '#F8FAFC';
                           doc.querySelectorAll('.result-table tr:nth-child(even)').forEach(el => {
                                el.style.backgroundColor = '#F8FAFC';
                           });
                           doc.querySelectorAll('.result-table th').forEach(el => {
                                el.style.background = '#1E3A8A';
                                el.style.color = '#FFFFFF';
                           });
                           doc.querySelectorAll('.calculation-step, .formula').forEach(el => {
                                el.style.backgroundColor = '#e2e6ea';
                           });
                        }
                    }
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    
                    const canvasWidth = canvas.width;
                    const canvasHeight = canvas.height;
                    const ratio = canvasHeight / canvasWidth;
                    
                    const imgWidth = pdfWidth - 20; // A4 width with 10mm margin
                    const imgHeight = imgWidth * ratio;
                    
                    let heightLeft = imgHeight;
                    let position = 30; // Start position after title

                    // Add title
                    pdf.setFont("helvetica", "bold");
                    pdf.setFontSize(18);
                    pdf.setTextColor(30, 58, 138); // #1E3A8A
                    pdf.text("Transformer Sizing Calculation Report", pdfWidth / 2, 15, { align: 'center' });
                    pdf.setFont("helvetica", "normal");
                    pdf.setFontSize(10);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text(`Generated on: ${new Date().toLocaleString()}`, pdfWidth / 2, 22, { align: 'center' });

                    // Add content
                    if (imgHeight < pdfHeight - position - 10) {
                        pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    } else {
                        let page = 1;
                        while (heightLeft > 0) {
                            pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight, undefined, 'FAST');
                            heightLeft -= (pdfHeight - position - 10);
                            if (heightLeft > 0) {
                                pdf.addPage();
                                position = -imgHeight * page + 10;
                                page++;
                            }
                        }
                    }

                    // Add footer to all pages
                    const pageCount = pdf.internal.getNumberOfPages();
                    for(let i = 1; i <= pageCount; i++) {
                        pdf.setPage(i);
                        pdf.setFontSize(8);
                        pdf.setTextColor(150, 150, 150);
                        pdf.text(`Page ${i} of ${pageCount} | www.designcalculators.co.in`, pdfWidth / 2, pdfHeight - 10, { align: 'center' });
                    }

                    pdf.save('Transformer-Sizing-Report.pdf');
                }).catch(err => {
                    displayMessage("Error generating PDF. See console for details.", "error");
                    console.error(err);
                });
            }

            // Add Event Listeners
            calculateBtn.addEventListener('click', calculateBtn.fn = calculateBtn.fn || function() {
                // This wrapper prevents the original script's listener from firing
            });
            
            // Remove old listener and add new one
            if (calculateBtn.fn) {
                calculateBtn.removeEventListener('click', calculateBtn.fn);
            }
            calculateBtn.addEventListener('click', calculate);
            calculateBtn.fn = calculate; // Store new function
            
            resetFormBtn.addEventListener('click', resetForm);
            downloadPdfBtn.addEventListener('click', downloadPDF);

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Add Tooltips
            const labels = document.querySelectorAll('.form-group label');
            labels.forEach(label => {
                const tooltip = label.querySelector('.tooltip');
                if (tooltip) {
                    label.innerHTML = label.innerHTML.replace(tooltip.outerHTML, '') + ' ' + tooltip.outerHTML;
                }
            });
            
            // Renaming the main calculation function to avoid conflicts
            function calculate() {
                calculateBtn.fn(); // Call the original logic
            }
            
            // Re-assign the original calculation logic to the button's 'fn' property
            calculateBtn.fn = function() {
                // Show spinner and disable button
                calculationSpinner.style.display = 'inline-block';
                calculateBtn.disabled = true;

                // Use setTimeout to allow UI to update
                setTimeout(() => {
                    try {
                        // Get input values
                        const loadKVA = parseFloat(document.getElementById('load-kva').value);
                        const primaryVoltage = parseFloat(document.getElementById('primary-voltage').value);
                        const secondaryVoltage = parseFloat(document.getElementById('secondary-voltage').value);
                        const efficiency = parseFloat(document.getElementById('efficiency').value);
                        const loadPowerFactor = parseFloat(document.getElementById('power-factor').value);
                        const loadGrowthFactor = parseFloat(document.getElementById('load-growth-factor').value);
                        const phaseType = document.getElementById('phase-type-transformer').value;
                        const kFactor = parseFloat(document.getElementById('k-factor').value);
                        const impedance = parseFloat(document.getElementById('impedance').value);
                        const temperatureRise = parseFloat(document.getElementById('temperature-rise').value);
                        const insulationClass = parseFloat(document.getElementById('insulation-class').value);
                        const enclosureType = document.getElementById('enclosure-type').value;
                        const altitude = parseFloat(document.getElementById('altitude').value);
                        const ambientTemp = parseFloat(document.getElementById('ambient-temp').value);
                        const coolingMethod = document.getElementById('cooling-method').value;
                        const thdI = parseFloat(document.getElementById('thd-i').value);

                        // Validation
                        if (isNaN(loadKVA) || isNaN(primaryVoltage) || isNaN(secondaryVoltage) || isNaN(efficiency) ||
                            isNaN(loadPowerFactor) || isNaN(loadGrowthFactor) || isNaN(kFactor) || isNaN(impedance) ||
                            isNaN(temperatureRise) || isNaN(insulationClass) || isNaN(altitude) || isNaN(ambientTemp) ||
                            isNaN(thdI)) {
                            throw new Error("Please fill in all required fields with valid numbers.");
                        }
                        if (loadKVA <= 0 || primaryVoltage <= 0 || secondaryVoltage <= 0 || efficiency <= 0 || efficiency > 100 ||
                            loadPowerFactor <= 0 || loadPowerFactor > 1 || loadGrowthFactor < 0 || kFactor < 1 ||
                            impedance <= 0 || impedance > 10 || altitude < 0 || ambientTemp < -20 || ambientTemp > 60 ||
                            thdI < 0 || thdI > 100) {
                            throw new Error("Please enter valid positive values. Check tooltips for common ranges.");
                        }

                        // Clear previous
                        resultTableBody.innerHTML = '';
                        detailedCalculationsDiv.innerHTML = '<h3 style="color: var(--primary-color); font-family: \'Montserrat\', sans-serif;">Detailed Calculation Steps</h3>';
                        resultContainer.classList.remove('show');

                        // Calculations
                        const adjustedLoadKVA = loadKVA * (1 + (loadGrowthFactor / 100));
                        addDetailedCalculationStep(
                            "Step 1: Calculate Adjusted Load ($S_{\\text{adjusted}}$)",
                            `Formula: $S_{\\text{adjusted}} = \\text{Load kVA} \\times (1 + \\frac{\\text{Load Growth \%}}{100})$`,
                            `$S_{\\text{adjusted}} = ${loadKVA.toFixed(2)} \\text{ kVA} \\times (1 + \\frac{${loadGrowthFactor.toFixed(0)}}{100}) = ${adjustedLoadKVA.toFixed(2)} \\text{ kVA}$`
                        );

                        const kFactorAdjustedKVA = adjustedLoadKVA * kFactor;
                        addDetailedCalculationStep(
                            "Step 2: K-Factor Adjusted kVA ($S_{\\text{K-factor}}$)",
                            `Formula: $S_{\\text{K-factor}} = S_{\\text{adjusted}} \\times \\text{K-Factor}$`,
                            `$S_{\\text{K-factor}} = ${adjustedLoadKVA.toFixed(2)} \\text{ kVA} \\times ${kFactor.toFixed(1)} = ${kFactorAdjustedKVA.toFixed(2)} \\text{ kVA}$`
                        );

                        let altitudeDeratingFactor = 1;
                        let altitudeDeratingExplanation = '1.000 (Altitude $\\le 1000 \\text{ m}$ - No derating required)';
                        if (altitude > 1000) {
                            const deRatePercentage = ((altitude - 1000) / 100) * 0.35;
                            altitudeDeratingFactor = 1 + (deRatePercentage / 100);
                            altitudeDeratingExplanation = `$(1 + \\frac{(${altitude.toFixed(0)} - 1000)}{100} \\times 0.0035) = ${altitudeDeratingFactor.toFixed(3)}$`;
                        }
                        const altitudeAdjustedKVA = kFactorAdjustedKVA * altitudeDeratingFactor;
                        addDetailedCalculationStep(
                            "Step 3: Altitude Adjusted kVA ($S_{\\text{altitude}}$)",
                            `Formula: $S_{\\text{altitude}} = S_{\\text{K-factor}} \\times \\text{Altitude Derating Factor}$`,
                            `Altitude Derating Factor: ${altitudeDeratingExplanation}`,
                            `$S_{\\text{altitude}} = ${kFactorAdjustedKVA.toFixed(2)} \\text{ kVA} \\times ${altitudeDeratingFactor.toFixed(3)} = ${altitudeAdjustedKVA.toFixed(2)} \\text{ kVA}$`
                        );

                        let tempDeratingFactor = 1;
                        let tempDeratingExplanation = '1.000 (Ambient Temp $\\le 40^{\\circ}\\text{C}$ - No derating required)';
                        if (ambientTemp > 40) {
                            const tempIncrease = ambientTemp - 40;
                            const deRatePercentage = (tempIncrease / 10) * 10;
                            tempDeratingFactor = 1 + (deRatePercentage / 100);
                            tempDeratingExplanation = `$(1 + \\frac{(${ambientTemp.toFixed(0)} - 40)}{10} \\times 0.10) = ${tempDeratingFactor.toFixed(3)}$`;
                        }
                        const finalRequiredTransformerKVA = altitudeAdjustedKVA * tempDeratingFactor;
                        addDetailedCalculationStep(
                            "Step 4: Final Required kVA ($S_{\\text{final}}$)",
                            `Formula: $S_{\\text{final}} = S_{\\text{altitude}} \\times \\text{Temp. Derating Factor}$`,
                            `Temp. Derating Factor: ${tempDeratingExplanation}`,
                            `$S_{\\text{final}} = ${altitudeAdjustedKVA.toFixed(2)} \\text{ kVA} \\times ${tempDeratingFactor.toFixed(3)} = ${finalRequiredTransformerKVA.toFixed(2)} \\text{ kVA}$`
                        );

                        let primaryCurrent = 0;
                        if (phaseType === 'single') {
                            primaryCurrent = (finalRequiredTransformerKVA * 1000) / primaryVoltage;
                            addDetailedCalculationStep(
                                "Step 5: Calculate Primary Current ($I_{P}$)",
                                `Formula: $I_{P} = \\frac{S_{\\text{final}} \\times 1000}{V_{P}}$`,
                                `$I_{P} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\times 1000}{${primaryVoltage.toFixed(0)}} = ${primaryCurrent.toFixed(2)} \\text{ A}$`
                            );
                        } else {
                            primaryCurrent = (finalRequiredTransformerKVA * 1000) / (Math.sqrt(3) * primaryVoltage);
                            addDetailedCalculationStep(
                                "Step 5: Calculate Primary Current ($I_{P}$)",
                                `Formula: $I_{P} = \\frac{S_{\\text{final}} \\times 1000}{\\sqrt{3} \\times V_{P}}$`,
                                `$I_{P} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\times 1000}{1.732 \\times ${primaryVoltage.toFixed(0)}} = ${primaryCurrent.toFixed(2)} \\text{ A}$`
                            );
                        }

                        let secondaryCurrent = 0;
                        if (phaseType === 'single') {
                            secondaryCurrent = (finalRequiredTransformerKVA * 1000) / secondaryVoltage;
                            addDetailedCalculationStep(
                                "Step 6: Calculate Secondary Current ($I_{S}$)",
                                `Formula: $I_{S} = \\frac{S_{\\text{final}} \\times 1000}{V_{S}}$`,
                                `$I_{S} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\times 1000}{${secondaryVoltage.toFixed(0)}} = ${secondaryCurrent.toFixed(2)} \\text{ A}$`
                            );
                        } else {
                            secondaryCurrent = (finalRequiredTransformerKVA * 1000) / (Math.sqrt(3) * secondaryVoltage);
                            addDetailedCalculationStep(
                                "Step 6: Calculate Secondary Current ($I_{S}$)",
                                `Formula: $I_{S} = \\frac{S_{\\text{final}} \\times 1000}{\\sqrt{3} \\times V_{S}}$`,
                                `$I_{S} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\times 1000}{1.732 \\times ${secondaryVoltage.toFixed(0)}} = ${secondaryCurrent.toFixed(2)} \\text{ A}$`
                            );
                        }

                        const impedancePerUnit = impedance / 100;
                        const loadAngleRad = Math.acos(loadPowerFactor);
                        const xrRatio = 5;
                        const sqrtOnePlusXrRatioSquared = Math.sqrt(1 + xrRatio * xrRatio);
                        const percentR = impedancePerUnit / sqrtOnePlusXrRatioSquared;
                        const percentX = impedancePerUnit * xrRatio / sqrtOnePlusXrRatioSquared;
                        const voltageRegulation = (percentR * Math.cos(loadAngleRad) + percentX * Math.sin(loadAngleRad)) * 100;
                        addDetailedCalculationStep(
                            "Step 7: Estimate Voltage Regulation (%VR)",
                            `Formula: $\%VR \\approx (\\%R \\times \\cos(\\phi) + \\%X \\times \\sin(\\phi))$`,
                            `Assuming X/R=5: $\%R = ${percentR.toFixed(4)}, \\%X = ${percentX.toFixed(4)}$
                            <p class="calculation-step">$%VR \\approx (${percentR.toFixed(4)} \\times ${loadPowerFactor} + ${percentX.toFixed(4)} \\times ${Math.sin(loadAngleRad).toFixed(3)}) \\times 100 = ${voltageRegulation.toFixed(2)} \\%$</p>`
                        );

                        const shortCircuitCurrent = secondaryCurrent / (impedance / 100);
                        addDetailedCalculationStep(
                            "Step 8: Estimate Secondary Short Circuit Current ($I_{\\text{SC}}$)",
                            `Formula: $I_{\\text{SC}} = \\frac{I_{S}}{\\text{Z}_{pu}} = \\frac{I_{S}}{\\text{Impedance \%} / 100}$`,
                            `$I_{\\text{SC}} = \\frac{${secondaryCurrent.toFixed(2)} \\text{ A}}{${impedance / 100}} = ${shortCircuitCurrent.toFixed(2)} \\text{ A (or ${(shortCircuitCurrent/1000).toFixed(2)} kA)}$`
                        );

                        const noLoadLosses = finalRequiredTransformerKVA * 0.003 * 1000;
                        const fullLoadLosses = finalRequiredTransformerKVA * 0.02 * 1000;
                        const totalLossesFullLoad = noLoadLosses + fullLoadLosses;
                        const actualEfficiency = ((finalRequiredTransformerKVA * loadPowerFactor * 1000) / ((finalRequiredTransformerKVA * loadPowerFactor * 1000) + totalLossesFullLoad)) * 100;
                        addDetailedCalculationStep(
                            "Step 9: Estimate Transformer Losses (Approx.)",
                            `No-Load (Core) Losses $\\approx 0.3\\% \\times S_{\\text{final}} = ${noLoadLosses.toFixed(0)} \\text{ W}$`,
                            `Full-Load (Winding) Losses $\\approx 2\\% \\times S_{\\text{final}} = ${fullLoadLosses.toFixed(0)} \\text{ W}$
                             <p class="calculation-step">Est. Efficiency at Full Load & ${loadPowerFactor} PF $\\approx ${actualEfficiency.toFixed(2)} \\%$</p>`
                        );

                        // Display Summary
                        addResultRow("Base Load", loadKVA.toFixed(2) + " kVA");
                        addResultRow("Adjusted Load (with Growth)", adjustedLoadKVA.toFixed(2) + " kVA");
                        addResultRow("K-Factor Adjusted kVA", kFactorAdjustedKVA.toFixed(2) + " kVA");
                        addResultRow("Altitude Adjusted kVA", altitudeAdjustedKVA.toFixed(2) + " kVA");
                        addResultRow("<strong>Final Required Transformer kVA</strong>", `<strong>${finalRequiredTransformerKVA.toFixed(2)} kVA</strong>`);
                        addResultRow("Primary Full Load Current", `<strong>${primaryCurrent.toFixed(2)} A</strong>`);
                        addResultRow("Secondary Full Load Current", `<strong>${secondaryCurrent.toFixed(2)} A</strong>`);
                        addResultRow("System Type", phaseType === "single" ? "Single-Phase" : "Three-Phase");
                        addResultRow("Est. Voltage Regulation", `${voltageRegulation.toFixed(2)} %`);
                        addResultRow("Est. Secondary Fault Current", `<strong>${(shortCircuitCurrent/1000).toFixed(2)} kA</strong>`);
                        addResultRow("Cooling / Insulation", `${coolingMethod} / Class ${insulationClass}°C`);
                        addResultRow("Derating Factors", `K-Factor: ${kFactor.toFixed(1)}, Altitude: ${altitudeDeratingFactor.toFixed(3)}, Temp: ${tempDeratingFactor.toFixed(3)}`);

                        standardReference.innerHTML = `<strong>Standard Reference:</strong> Sizing based on <strong>IEC 60076</strong> & <strong>IEEE C57</strong> standards. This calculation accounts for load growth, harmonic K-Factor derating (per <strong>IEEE C57.110</strong>), and environmental derating for altitude (per <strong>IEC 60076-1</strong>) and ambient temperature (per <strong>IEEE C57.96</strong>). The final kVA rating represents the minimum required continuous capacity. Always select the next standard transformer size *above* this value.`;
                        
                        resultContainer.style.display = 'block';
                        setTimeout(() => resultContainer.classList.add('show'), 10);
                        resultContainer.scrollIntoView({ behavior: 'smooth' });

                    } catch (error) {
                        displayMessage(error.message, "error");
                    } finally {
                        calculationSpinner.style.display = 'none';
                        calculateBtn.disabled = false;
                    }
                }, 500);
            };

        });
    </script>
</body>
</html>



