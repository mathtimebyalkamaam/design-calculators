<!DOCTYPE html>
<html lang="en">
<head>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR'); 
   
    </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Transformer Sizing Calculator - Design Calculators - Electrical</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --input-bg: #ffffff;
            --input-border-focus: #4CAF50;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.3);
            --hover-color: #446688;
            --input-bg: #446688;
            --input-border-focus: #4CAF50;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }
        /* Ensure H2 is visible in dark mode */
        body.dark-mode .tool-container h2 {
            color: white; /* Explicitly set to white for visibility */
            border-bottom-color: white;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color); /* Ensure label text is visible */
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--input-border-focus);
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.5); /* Primary color with transparency */
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1 1 200px;
        }
        
        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .calculate-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .calculate-btn .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }

        .calculate-btn.loading .spinner {
            display: inline-block;
        }

        .calculate-btn.loading {
            cursor: not-allowed;
            opacity: 0.8;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        /* Ensure H3 is visible in dark mode */
        body.dark-mode .result-container h3 {
            color: white; /* Explicitly set to white for visibility */
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color); /* Ensure visibility in dark mode */
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: transform 0.2s ease-in-out;
        }
        .info-icon:hover {
            transform: scale(1.1);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Increased width for more text */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 10px; /* Increased padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of new width */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.3;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            min-width: 300px;
            text-align: center;
        }
        #custom-message-box.error { background-color: #dc3545; } /* Red */
        #custom-message-box.warning { background-color: #ffc107; color: #333; } /* Amber */
        #custom-message-box.info { background-color: #28a745; } /* Green */

        /* Styles for detailed calculation steps and tips */
        .detailed-calculations, .transformer-sizing-tips {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--hover-color); /* A lighter background for contrast */
            color: var(--text-color); /* Ensure text visibility */
            animation: fadeIn 0.8s ease-out; /* Add fade-in animation */
        }

        body.dark-mode .detailed-calculations, body.dark-mode .transformer-sizing-tips {
            background-color: #3a475a; /* Darker background for contrast in dark mode */
            border-color: #6a7a8f;
        }

        .detailed-calculations h4, .transformer-sizing-tips h4 {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary-color); /* Highlight heading */
        }
        body.dark-mode .detailed-calculations h4, body.dark-mode .transformer-sizing-tips h4 {
            color: var(--primary-color); /* Use lighter primary color in dark mode */
        }

        .detailed-calculations p, .transformer-sizing-tips p, .transformer-sizing-tips ul {
            margin-bottom: 5px;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .transformer-sizing-tips ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        .detailed-calculations strong, .transformer-sizing-tips strong {
            color: var(--secondary-color); /* Highlight key terms in formulas */
        }
        body.dark-mode .detailed-calculations strong, body.dark-mode .transformer-sizing-tips strong {
            color: var(--primary-color); /* Use lighter primary color for highlights in dark mode */
        }

        /* MathJax rendered formulas will have the desired styling */
        .formula {
            font-family: 'Courier New', Courier, monospace; /* Not strictly needed with MathJax, but good for raw */
            background-color: rgba(0,0,0,0.05); /* Light tint for formula background */
            padding: 2px 5px;
            border-radius: 3px;
            display: inline-block; /* Helps with MathJax inline rendering */
            margin-top: 5px;
            font-size: 0.9em;
        }
        body.dark-mode .formula {
            background-color: rgba(255,255,255,0.05);
        }

        .calculation-step {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .detailed-calculations .calculation-step:last-child {
            border-bottom: none; /* No border after the last step */
        }

        /* Animation for recommended transformer size */
        @keyframes pulseHighlight {
            0% { background-color: transparent; }
            50% { background-color: var(--accent-color); }
            100% { background-color: transparent; }
        }

        .highlight-result {
            animation: pulseHighlight 2s ease-in-out 2; /* Pulse twice */
        }

        /* Animation for table rows */
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-table-row-animated {
            animation: slideInUp 0.5s ease-out forwards;
        }
    </style>
    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                processHtmlClass: 'math-content', // Process elements with this class
                ignoreHtmlClass: 'no-mathjax'      // Ignore elements with this class
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy — Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        
        <div class="tool-container">
            <h2>Advanced Transformer Sizing Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator helps you determine the appropriate transformer size based on load requirements, voltage, and other critical industry factors, including harmonics, losses, and environmental conditions. All calculations adhere to international standards.</p>
            </div>
        
            <div class="calculator-form">
                <form id="transformer-sizing-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="load-kva">Load Apparent Power (kVA) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The total apparent power (kVA) required by the load.</span></span></label>
                            <input type="number" id="load-kva" min="0.1" step="0.1" value="100" required>
                        </div>
                        <div class="form-group">
                            <label for="primary-voltage">Primary Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The input voltage to the transformer.</span></span></label>
                            <input type="number" id="primary-voltage" min="1" step="1" value="11000" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="secondary-voltage">Secondary Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The output voltage of the transformer.</span></span></label>
                            <input type="number" id="secondary-voltage" min="1" step="1" value="415" required>
                        </div>
                        <div class="form-group">
                            <label for="efficiency">Estimated Efficiency (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Typical transformer full-load efficiency, e.g., 98 for 98%.</span></span></label>
                            <input type="number" id="efficiency" min="50" max="100" step="0.1" value="98" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="power-factor">Load Power Factor (PF) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The power factor of the load (e.g., 0.8 for 80% lagging).</span></span></label>
                            <input type="number" id="power-factor" min="0.1" max="1" step="0.01" value="0.8">
                        </div>
                        <div class="form-group">
                            <label for="load-growth-factor">Load Growth Factor (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Anticipated future load increase (e.g., 20 for 20% growth).</span></span></label>
                            <input type="number" id="load-growth-factor" min="0" step="1" value="20">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="phase-type-transformer">System Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Single-phase or three-phase system.</span></span></label>
                            <select id="phase-type-transformer" required>
                                <option value="single">Single-Phase</option>
                                <option value="three" selected>Three-Phase</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="k-factor">K-Factor <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Multiplier for non-linear loads. Use 1 for linear loads. Higher for more distortion. (IEEE C57.110)</span></span></label>
                            <input type="number" id="k-factor" min="1" step="0.1" value="1.5"> <!-- Changed default to 1.5 for non-linear example -->
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="impedance">Transformer Impedance (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Typical transformer impedance, usually 3% to 7%. Affects voltage regulation and fault current.</span></span></label>
                            <input type="number" id="impedance" min="1" max="10" step="0.1" value="5">
                        </div>
                        <div class="form-group">
                            <label for="temperature-rise">Temperature Rise (&#8451;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Maximum allowable winding temperature rise above ambient. Common values: 55&#8451; or 65&#8451;. (IEC 60076-2)</span></span></label>
                            <select id="temperature-rise" required>
                                <option value="55">55 &#8451;</option>
                                <option value="65" selected>65 &#8451;</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="insulation-class">Insulation Class <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum temperature the insulation system can withstand. (e.g., 105&#8451; for Class A, 130&#8451; for Class B, 155&#8451; for Class F, 180&#8451; for Class H)</span></span></label>
                            <select id="insulation-class" required>
                                <option value="105">Class A (105 &#8451;)</option>
                                <option value="130">Class B (130 &#8451;)</option>
                                <option value="155" selected>Class F (155 &#8451;)</option>
                                <option value="180">Class H (180 &#8451;)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="enclosure-type">Enclosure Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">NEMA or IP rating for environmental protection. Affects cooling and placement. (e.g., NEMA 1, IP20 for indoor; NEMA 3R, IP54 for outdoor)</span></span></label>
                            <select id="enclosure-type" required>
                                <option value="indoor">Indoor (e.g., NEMA 1, IP20)</option>
                                <option value="outdoor" selected>Outdoor (e.g., NEMA 3R, IP54)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="altitude">Altitude (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Installation altitude above sea level. Higher altitudes may require derating. (IEC 60076-1)</span></span></label>
                            <input type="number" id="altitude" min="0" step="10" value="500"> <!-- Changed default to 500 for a more common scenario -->
                        </div>
                        <div class="form-group">
                            <label for="ambient-temp">Ambient Temperature (&#8451;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Average ambient temperature. Higher temperatures may require derating.</span></span></label>
                            <input type="number" id="ambient-temp" min="-20" max="60" step="1" value="35"> <!-- Changed default to 35 -->
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cooling-method">Cooling Method <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Type of cooling: AN (Air Natural), AF (Air Forced), ONAN (Oil Natural Air Natural), ONAF (Oil Natural Air Forced).</span></span></label>
                            <select id="cooling-method" required>
                                <option value="AN">AN (Air Natural / Dry Type)</option>
                                <option value="AF">AF (Air Forced / Dry Type)</option>
                                <option value="ONAN" selected>ONAN (Oil Natural Air Natural)</option>
                                <option value="ONAF">ONAF (Oil Natural Air Forced)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="thd-i">Total Harmonic Distortion Current (THD-I %) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total harmonic distortion of current, indicates non-linear load impact. (IEEE 519)</span></span></label>
                            <input type="number" id="thd-i" min="0" max="100" step="0.1" value="10"> <!-- Changed default to 10 for a more non-linear example -->
                        </div>
                    </div>
                    
                    <button type="button" id="calculate-transformer-btn" class="calculate-btn">
                        Calculate Transformer Size <span class="spinner"></span>
                    </button>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Calculation Summary</h3>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <!-- Detailed calculations section -->
                <div id="detailed-calculations" class="detailed-calculations mt-6 math-content">
                    <h3>Detailed Calculation Steps</h3>
                    <!-- Detailed calculation steps will be dynamically inserted here -->
                </div>

                <!-- NEW: Transformer Sizing Tips Section -->
                <div id="transformer-sizing-tips" class="transformer-sizing-tips mt-6">
                    <h3>Important Considerations for Transformer Sizing</h3>
                    <p>Accurate transformer sizing is critical for system efficiency, reliability, and safety. Beyond the basic kVA calculation, consider these factors:</p>
                    <ul>
                        <li>
                            <strong>Load Type:</strong>
                            <ul>
                                <li><strong>Linear Loads:</strong> Resistive (heaters, incandescent lights), Inductive (motors, solenoids). For these, the primary kVA calculation is often sufficient.</li>
                                <li><strong>Non-linear Loads:</strong> Electronic devices (computers, LED drivers, VFDs, rectifiers) draw non-sinusoidal currents, introducing harmonics. For these, a K-rated transformer or derating of a standard transformer may be necessary. The K-factor indicates the transformer's ability to handle harmonic currents without overheating. (Refer to IEEE C57.110)</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Load Growth & Future Expansion:</strong> Always factor in anticipated future load growth. Oversizing slightly (e.g., 15-25%) can save significant costs in the long run by avoiding premature replacement or additions.
                        </li>
                        <li>
                            <strong>Diversity Factor & Demand Factor:</strong> If multiple loads are connected, it's unlikely all will operate at their peak simultaneously. A diversity factor (less than 1) can be applied to the sum of individual loads to arrive at a more realistic total demand, preventing unnecessary oversizing. Demand factor is the ratio of maximum demand to total connected load.
                        </li>
                        <li>
                            <strong>Voltage Regulation:</strong> This is the percentage change in secondary voltage from no-load to full-load. Transformers with lower impedance generally have better voltage regulation. Ensure the chosen transformer's voltage regulation is acceptable for sensitive loads. (Refer to IEEE C57.12.00)
                        </li>
                        <li>
                            <strong>Short Circuit Current:</strong> The transformer's impedance directly affects the short-circuit current available at its secondary. A higher impedance limits fault currents, which can reduce the interrupting capacity requirements for downstream protective devices. (Refer to IEEE C57.12.00)
                        </li>
                        <li>
                            <strong>Efficiency & Losses:</strong> Higher efficiency transformers (e.g., IE2, IE3, NEMA Premium) have lower operating losses (no-load and load losses) over their lifespan, leading to significant energy savings. Initial higher cost is often offset by operational savings. (Refer to NEMA TP 1, IEC 60076-1)
                        </li>
                        <li>
                            <strong>Cooling Method & Temperature Rise:</strong>
                            <ul>
                                <li><strong>Oil-Immersed (ONAN, ONAF, OFAF):</strong> Common for outdoor and high-power applications, offering excellent cooling.</li>
                                <li><strong>Dry-Type (AN, AF, AA):</strong> Used indoors, in commercial buildings, or where fire safety is a concern. Less efficient for very large sizes, but safer.</li>
                                <li>Temperature rise limits (e.g., 55&#8451;/65&#8451;) are crucial for insulation life.</li>
                            </ul>
                            (Refer to IEC 60076-2, IEEE C57.12.00, IEEE C57.12.01)
                        </li>
                        <li>
                            <strong>Environmental Conditions:</strong> Ambient temperature and altitude can significantly affect transformer performance and longevity. Derating may be required for harsh conditions or high altitudes. (Refer to IEC 60076-1, IEEE C57.96)
                        </li>
                        <li>
                            <strong>Insulation Class:</strong> Matches the transformer's thermal capabilities with expected operating temperatures.
                        </li>
                        <li>
                            <strong>Enclosure Type:</strong> Provides necessary protection against environmental factors (dust, water) and physical access, influencing installation location (indoor/outdoor).
                        </li>
                    </ul>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400"><em>Transformer sizing is a critical engineering decision. This tool provides an estimate. Always consult with a qualified electrical engineer and adhere to local electrical codes and international standards (e.g., IEEE C57 series, IEC 60076 series, NEMA TP 1, IEEE 519) for precise sizing and safety compliance.</em></p>
                </div>
                <!-- END NEW: Transformer Sizing Tips Section -->

                <div class="standard-reference" id="standard-reference-text">
                    <p>Transformer sizing calculations should adhere to relevant international standards and recommended practices such as: <br>
                    - <strong>IEEE C57.12.00:</strong> IEEE Standard for General Requirements for Liquid-Immersed Distribution, Power, and Regulating Transformers. <br>
                    - <strong>IEEE C57.12.01:</strong> IEEE Standard for General Requirements for Dry-Type Distribution and Power Transformers. <br>
                    - <strong>IEC 60076 series:</strong> Power Transformers (various parts covering general requirements, temperature rise, impedance, etc.). <br>
                    - <strong>NEMA TP 1:</strong> Guide for Determining Energy Efficiency for Distribution Transformers. <br>
                    - <strong>IEEE Std 519:</strong> IEEE Recommended Practice and Requirements for Harmonic Control in Electric Power Systems. <br>
                    - <strong>IEEE C57.110:</strong> IEEE Recommended Practice for Establishing Transformer Capability When Supplying Nonsinusoidal Load Currents. <br>
                    - <strong>IEEE C57.96:</strong> IEEE Guide for Loading Dry-Type Distribution and Power Transformers. <br>
                    - <strong>National Electrical Code (NEC) / IEC 60364:</strong> Electrical installations of buildings (for installation and safety considerations).</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                
                <p>Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Electrical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Electrical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Electrical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box -->
    <div id="custom-message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-transformer-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const detailedCalculationsDiv = document.getElementById('detailed-calculations');
            const transformerSizingTipsDiv = document.getElementById('transformer-sizing-tips');
            
            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                // Check for saved theme preference
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            calculateBtn.addEventListener('click', function() {
                // Show spinner and disable button
                calculateBtn.classList.add('loading');
                calculateBtn.disabled = true;

                // Get input values
                const loadKVA = parseFloat(document.getElementById('load-kva').value);
                const primaryVoltage = parseFloat(document.getElementById('primary-voltage').value);
                const secondaryVoltage = parseFloat(document.getElementById('secondary-voltage').value);
                const efficiency = parseFloat(document.getElementById('efficiency').value);
                const loadPowerFactor = parseFloat(document.getElementById('power-factor').value);
                const loadGrowthFactor = parseFloat(document.getElementById('load-growth-factor').value);
                const phaseType = document.getElementById('phase-type-transformer').value;
                const kFactor = parseFloat(document.getElementById('k-factor').value);
                const impedance = parseFloat(document.getElementById('impedance').value);
                const temperatureRise = parseFloat(document.getElementById('temperature-rise').value);
                const insulationClass = parseFloat(document.getElementById('insulation-class').value);
                const enclosureType = document.getElementById('enclosure-type').value;
                const altitude = parseFloat(document.getElementById('altitude').value);
                const ambientTemp = parseFloat(document.getElementById('ambient-temp').value);
                const coolingMethod = document.getElementById('cooling-method').value;
                const thdI = parseFloat(document.getElementById('thd-i').value);

                // Input validation
                if (isNaN(loadKVA) || isNaN(primaryVoltage) || isNaN(secondaryVoltage) || isNaN(efficiency) || 
                    isNaN(loadPowerFactor) || isNaN(loadGrowthFactor) || isNaN(kFactor) || isNaN(impedance) ||
                    isNaN(temperatureRise) || isNaN(insulationClass) || isNaN(altitude) || isNaN(ambientTemp) ||
                    isNaN(thdI)) {
                    displayMessage("Please fill in all required fields with valid numbers.", "error");
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }

                if (loadKVA <= 0 || primaryVoltage <= 0 || secondaryVoltage <= 0 || efficiency <= 0 || efficiency > 100 || 
                    loadPowerFactor <= 0 || loadPowerFactor > 1 || loadGrowthFactor < 0 || kFactor < 1 ||
                    impedance <= 0 || impedance > 10 || altitude < 0 || ambientTemp < -20 || ambientTemp > 60 ||
                    thdI < 0 || thdI > 100) {
                    displayMessage("Please enter valid positive values. Check ranges: Efficiency (50-100%), PF (0.1-1), Growth (>=0), K-Factor (>=1), Impedance (1-10%), Altitude (>=0), Ambient Temp (-20-60C), THD-I (0-100%).", "error");
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }

                // Clear previous results and sections
                resultTableBody.innerHTML = '';
                detailedCalculationsDiv.innerHTML = '<h3 class="text-xl font-semibold mb-3 text-gray-700 dark:text-white">Detailed Calculation Steps</h3>';
                transformerSizingTipsDiv.style.display = 'block'; // Ensure tips are visible for all calcs
                resultContainer.style.display = 'none';

                // --- Transformer Sizing Calculation Logic ---

                // Step 1: Calculate Load kVA after considering Load Growth Factor
                // This accounts for anticipated future expansion, a key industrial design consideration.
                addDetailedCalculationStep(
                    "Step 1: Calculate Adjusted Load Apparent Power ($S_{\\text{adjusted}}$)",
                    `Formula: $S_{\\text{adjusted}} = \\text{Load kVA} \\cdot \\left(1 + \\frac{\\text{Load Growth Factor}}{100}\\right)$`,
                    `Calculation: $S_{\\text{adjusted}} = ${loadKVA.toFixed(2)} \\text{ kVA} \\cdot \\left(1 + \\frac{${loadGrowthFactor.toFixed(0)}}{100}\\right) = ${(loadKVA * (1 + (loadGrowthFactor / 100))).toFixed(2)} \\text{ kVA}$`
                );
                const adjustedLoadKVA = loadKVA * (1 + (loadGrowthFactor / 100));


                // Step 2: K-Factor Adjustment for Non-Linear Loads
                // K-factor (IEEE C57.110) accounts for the additional heating effects of harmonic currents.
                // A higher K-factor indicates a greater need for a K-rated transformer or significant derating.
                addDetailedCalculationStep(
                    "Step 2: K-Factor Adjusted kVA ($S_{\\text{K-factor}}$) (IEEE C57.110)",
                    `Formula: $S_{\\text{K-factor}} = S_{\\text{adjusted}} \\cdot \\text{K-Factor}$`,
                    `Calculation: $S_{\\text{K-factor}} = ${adjustedLoadKVA.toFixed(2)} \\text{ kVA} \\cdot ${kFactor.toFixed(1)} = ${(adjustedLoadKVA * kFactor).toFixed(2)} \\text{ kVA}$`
                );
                const kFactorAdjustedKVA = adjustedLoadKVA * kFactor;

                // Step 3: Altitude Derating (IEC 60076-1, IEEE C57.96)
                // Air density decreases with altitude, reducing cooling efficiency.
                // Transformers are typically rated for altitudes up to 1000m without derating.
                // A common derating factor is 0.35% per 100m above 1000m for dry-type and liquid-filled transformers.
                let altitudeDeratingFactor = 1;
                let altitudeDeratingExplanation = '1 (Altitude $\\le 1000 \\text{ m}$ - No derating required)';
                if (altitude > 1000) {
                    const deRatePercentage = ((altitude - 1000) / 100) * 0.35; // 0.35% derating per 100m
                    altitudeDeratingFactor = 1 + (deRatePercentage / 100); // Inverse for sizing (need a larger transformer)
                    altitudeDeratingExplanation = `$(1 + \\frac{(${altitude.toFixed(0)} - 1000)}{100} \\cdot 0.0035) = ${altitudeDeratingFactor.toFixed(3)}$ (Derating applied as per IEC 60076-1 / IEEE C57.96)`;
                }
                addDetailedCalculationStep(
                    "Step 3: Altitude Adjusted kVA ($S_{\\text{altitude}}$) (IEC 60076-1, IEEE C57.96)",
                    `Formula: $S_{\\text{altitude}} = S_{\\text{K-factor}} \\cdot \\text{Altitude Derating Factor}$`,
                    `Altitude Derating Factor: ${altitudeDeratingExplanation}`,
                    `Calculation: $S_{\\text{altitude}} = ${kFactorAdjustedKVA.toFixed(2)} \\text{ kVA} \\cdot ${altitudeDeratingFactor.toFixed(3)} = ${(kFactorAdjustedKVA * altitudeDeratingFactor).toFixed(2)} \\text{ kVA}$`
                );
                const altitudeAdjustedKVA = kFactorAdjustedKVA * altitudeDeratingFactor;

                // Step 4: Ambient Temperature Derating (Simplified for ambient temp > 40C)
                // Transformers are typically rated for a 40°C ambient temperature. Higher temperatures reduce insulation life and capacity.
                // A common rule of thumb is 10% derating for every 10°C above 40°C.
                let tempDeratingFactor = 1;
                let tempDeratingExplanation = '1 (Ambient Temp $\\le 40 \\text{ }\\text{&#8451;}$ - No derating required)';
                if (ambientTemp > 40) {
                    const tempIncrease = ambientTemp - 40;
                    const deRatePercentage = (tempIncrease / 10) * 10; // 10% derating per 10C above 40C
                    tempDeratingFactor = 1 + (deRatePercentage / 100); // Inverse for sizing (need a larger transformer)
                    tempDeratingExplanation = `$(1 + \\frac{(${ambientTemp.toFixed(0)} - 40)}{10} \\cdot 0.10) = ${tempDeratingFactor.toFixed(3)}$ (Derating applied for higher ambient temperature)`;
                }
                addDetailedCalculationStep(
                    "Step 4: Ambient Temperature Adjusted kVA ($S_{\\text{final}}$)",
                    `Formula: $S_{\\text{final}} = S_{\\text{altitude}} \\cdot \\text{Temperature Derating Factor}$`,
                    `Temperature Derating Factor: ${tempDeratingExplanation}`,
                    `Calculation: $S_{\\text{final}} = ${altitudeAdjustedKVA.toFixed(2)} \\text{ kVA} \\cdot ${tempDeratingFactor.toFixed(3)} = ${(altitudeAdjustedKVA * tempDeratingFactor).toFixed(2)} \\text{ kVA}$`
                );
                const finalRequiredTransformerKVA = altitudeAdjustedKVA * tempDeratingFactor;

                // Step 5: Calculate Primary Current
                // Crucial for sizing upstream protective devices and cables.
                let primaryCurrent = 0;
                if (primaryVoltage > 0) {
                    if (phaseType === 'single') {
                        primaryCurrent = (finalRequiredTransformerKVA * 1000) / primaryVoltage;
                        addDetailedCalculationStep(
                            "Step 5: Calculate Primary Current ($I_{P}$) (Single-Phase)",
                            `Formula: $I_{P} = \\frac{S_{\\text{final}} \\cdot 1000}{V_{P}}$`,
                            `Calculation: $I_{P} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\cdot 1000}{${primaryVoltage.toFixed(2)}} = ${primaryCurrent.toFixed(2)} \\text{ A}$`
                        );
                    } else { // Three-Phase
                        primaryCurrent = (finalRequiredTransformerKVA * 1000) / (Math.sqrt(3) * primaryVoltage);
                        addDetailedCalculationStep(
                            "Step 5: Calculate Primary Current ($I_{P}$) (Three-Phase)",
                            `Formula: $I_{P} = \\frac{S_{\\text{final}} \\cdot 1000}{\\sqrt{3} \\cdot V_{P}}$`,
                            `Calculation: $I_{P} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\cdot 1000}{\\sqrt{3} \\cdot ${primaryVoltage.toFixed(2)}} = ${primaryCurrent.toFixed(2)} \\text{ A}$`
                        );
                    }
                }

                // Step 6: Calculate Secondary Current
                // Essential for sizing downstream protective devices and cables.
                let secondaryCurrent = 0;
                if (secondaryVoltage > 0) {
                    if (phaseType === 'single') {
                        secondaryCurrent = (finalRequiredTransformerKVA * 1000) / secondaryVoltage;
                        addDetailedCalculationStep(
                            "Step 6: Calculate Secondary Current ($I_{S}$) (Single-Phase)",
                            `Formula: $I_{S} = \\frac{S_{\\text{final}} \\cdot 1000}{V_{S}}$`,
                            `Calculation: $I_{S} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\cdot 1000}{${secondaryVoltage.toFixed(2)}} = ${secondaryCurrent.toFixed(2)} \\text{ A}$`
                        );
                    } else { // Three-Phase
                        secondaryCurrent = (finalRequiredTransformerKVA * 1000) / (Math.sqrt(3) * secondaryVoltage);
                        addDetailedCalculationStep(
                            "Step 6: Calculate Secondary Current ($I_{S}$) (Three-Phase)",
                            `Formula: $I_{S} = \\frac{S_{\\text{final}} \\cdot 1000}{\\sqrt{3} \\cdot V_{S}}$`,
                            `Calculation: $I_{S} = \\frac{${finalRequiredTransformerKVA.toFixed(2)} \\cdot 1000}{\\sqrt{3} \\cdot ${secondaryVoltage.toFixed(2)}} = ${secondaryCurrent.toFixed(2)} \\text{ A}$`
                        );
                    }
                }

                // Step 7: Calculate Voltage Regulation (Approximate) (IEEE C57.12.00)
                // Voltage regulation indicates how much the secondary voltage changes from no-load to full-load.
                // A lower percentage is generally better for sensitive loads.
                const impedancePerUnit = impedance / 100;
                const loadAngleRad = Math.acos(loadPowerFactor);
                const xrRatio = 5; // Assumed X/R ratio of 5 for power transformers for calculation. This is a typical value.
                // More accurate approximation for voltage regulation: %VR = (%R * cos(phi) + %X * sin(phi))
                // Where %R = %Z / sqrt(1 + (X/R)^2) and %X = %Z * (X/R) / sqrt(1 + (X/R)^2)
                const sqrtOnePlusXrRatioSquared = Math.sqrt(1 + xrRatio * xrRatio);
                const percentR = impedancePerUnit / sqrtOnePlusXrRatioSquared;
                const percentX = impedancePerUnit * xrRatio / sqrtOnePlusXrRatioSquared;
                const voltageRegulation = (percentR * Math.cos(loadAngleRad) + percentX * Math.sin(loadAngleRad)) * 100;

                addDetailedCalculationStep(
                    "Step 7: Calculate Voltage Regulation (Approximate) (%VR) (IEEE C57.12.00)",
                    `Formula: $\%VR \\approx \\left(\\frac{\\text{Impedance (\\%)}}{100 \\cdot \\sqrt{1 + (X/R)^2}} \\cdot \\cos(\\phi) + \\frac{\\text{Impedance (\\%)}}{100 \\cdot \\sqrt{1 + (X/R)^2}} \\cdot \\frac{X}{R} \\cdot \\sin(\\phi)\\right) \\cdot 100$ <br> (Where $\\phi = \\arccos(\\text{Load PF})$. Assumed X/R ratio of ${xrRatio}$ for estimation)`,
                    `Calculation: $\%VR \\approx \\left(\\frac{${impedance.toFixed(1)}}{100 \\cdot ${sqrtOnePlusXrRatioSquared.toFixed(3)}} \\cdot ${Math.cos(loadAngleRad).toFixed(3)} + \\frac{${impedance.toFixed(1)}}{100 \\cdot ${sqrtOnePlusXrRatioSquared.toFixed(3)}} \\cdot ${xrRatio} \\cdot ${Math.sin(loadAngleRad).toFixed(3)}\\right) \\cdot 100 = ${voltageRegulation.toFixed(2)} \\%$`
                );

                // Step 8: Calculate Short Circuit Current (at secondary) (IEEE C57.12.00)
                // This is crucial for selecting appropriate circuit breakers and protective devices downstream.
                const secondaryRatedCurrentAtFullSize = (finalRequiredTransformerKVA * 1000) / (phaseType === 'single' ? secondaryVoltage : Math.sqrt(3) * secondaryVoltage);
                const shortCircuitCurrent = secondaryRatedCurrentAtFullSize / (impedance / 100);
                addDetailedCalculationStep(
                    "Step 8: Calculate Secondary Short Circuit Current ($I_{\\text{SC}}$) (IEEE C57.12.00)",
                    `Formula: $I_{\\text{SC}} = \\frac{I_{\\text{rated secondary}}}{\\text{Per Unit Impedance}} = \\frac{I_{\\text{rated secondary}}}{\\text{Impedance (\\%)} / 100}$`,
                    `Rated Secondary Current ($I_{\\text{rated secondary}}$) = ${secondaryRatedCurrentAtFullSize.toFixed(2)} A <br> Calculation: $I_{\\text{SC}} = \\frac{${secondaryRatedCurrentAtFullSize.toFixed(2)}}{\\left(${impedance.toFixed(1)} / 100\\right)} = ${shortCircuitCurrent.toFixed(2)} \\text{ A}$`
                );

                // Step 9: Estimate No-Load and Full-Load Losses and Actual Efficiency (NEMA TP 1, IEC 60076-1)
                // Losses impact operational costs and heat generation.
                // No-load losses (core losses) are relatively constant regardless of load.
                // Full-load losses (copper losses) vary with the square of the load current.
                const noLoadLosses = finalRequiredTransformerKVA * (0.003 * 1000); // Approx 0.3% of KVA in Watts for no-load losses
                const fullLoadLosses = finalRequiredTransformerKVA * (0.02 * 1000); // Approx 2% of KVA in Watts for full-load losses
                const totalLossesFullLoad = noLoadLosses + fullLoadLosses;
                const actualEfficiency = ((finalRequiredTransformerKVA * loadPowerFactor * 1000) / ((finalRequiredTransformerKVA * loadPowerFactor * 1000) + totalLossesFullLoad)) * 100;
                
                addDetailedCalculationStep(
                    "Step 9: Estimate Transformer Losses and Actual Efficiency (NEMA TP 1, IEC 60076-1)",
                    `Formulas: <br> $\\text{No-Load Losses (Core)} \\approx \\text{0.3\\%} \\cdot S_{\\text{final}} \\text{ kVA}$ <br> $\\text{Full-Load Losses (Copper)} \\approx \\text{2\\%} \\cdot S_{\\text{final}} \\text{ kVA}$ <br> $\\text{Actual Efficiency} = \\frac{S_{\\text{final}} \\cdot \\text{Load PF} \\cdot 1000}{\\left(S_{\\text{final}} \\cdot \\text{Load PF} \\cdot 1000 + \\text{Total Losses}\\right)} \\cdot 100$`,
                    `$\\text{No-Load Losses} \\approx ${finalRequiredTransformerKVA.toFixed(2)} \\text{ kVA} \\cdot 0.003 = ${(noLoadLosses).toFixed(2)} \\text{ W}$ <br> $\\text{Full-Load Losses} \\approx ${finalRequiredTransformerKVA.toFixed(2)} \\text{ kVA} \\cdot 0.02 = ${(fullLoadLosses).toFixed(2)} \\text{ W}$ <br> $\\text{Total Losses} = ${(totalLossesFullLoad).toFixed(2)} \\text{ W}$ <br> $\\text{Actual Efficiency} = \\frac{${(finalRequiredTransformerKVA * loadPowerFactor * 1000).toFixed(2)}}{\\left(${(finalRequiredTransformerKVA * loadPowerFactor * 1000).toFixed(2)} + ${(totalLossesFullLoad).toFixed(2)}\\right)} \\cdot 100 = ${actualEfficiency.toFixed(2)} \\%$`
                );

                // Display Summary Results
                addResultRow("Initial Load Apparent Power", loadKVA.toFixed(2) + " kVA");
                addResultRow("Adjusted Load Apparent Power (with growth)", adjustedLoadKVA.toFixed(2) + " kVA");
                addResultRow("K-Factor Adjusted kVA", kFactorAdjustedKVA.toFixed(2) + " kVA");
                addResultRow("Altitude Adjusted kVA", altitudeAdjustedKVA.toFixed(2) + " kVA");
                addResultRow("Temperature Adjusted kVA", finalRequiredTransformerKVA.toFixed(2) + " kVA");
                addResultRow("<strong>Recommended Transformer Size</strong>", `<strong>${finalRequiredTransformerKVA.toFixed(2)} kVA</strong>`, true); // Add highlight flag
                addResultRow("Primary Voltage", primaryVoltage.toFixed(0) + " V");
                addResultRow("Secondary Voltage", secondaryVoltage.toFixed(0) + " V");
                addResultRow("Primary Current (Estimated)", primaryCurrent.toFixed(2) + " A");
                addResultRow("Secondary Current (Estimated)", secondaryCurrent.toFixed(2) + " A");
                addResultRow("System Type", phaseType === "single" ? "Single-Phase" : "Three-Phase");
                addResultRow("Load Power Factor", loadPowerFactor.toFixed(2));
                addResultRow("Load Growth Factor", loadGrowthFactor.toFixed(0) + "%");
                addResultRow("K-Factor", kFactor.toFixed(1));
                addResultRow("Transformer Impedance", impedance.toFixed(1) + "%");
                addResultRow("Estimated Voltage Regulation", voltageRegulation.toFixed(2) + "%");
                addResultRow("Estimated Secondary Short Circuit Current", shortCircuitCurrent.toFixed(2) + " A");
                addResultRow("Estimated No-Load Losses", noLoadLosses.toFixed(2) + " W");
                addResultRow("Estimated Full-Load Losses", fullLoadLosses.toFixed(2) + " W");
                addResultRow("Actual Estimated Efficiency at Full Load", actualEfficiency.toFixed(2) + "%");
                addResultRow("Temperature Rise Class", temperatureRise.toFixed(0) + " &#8451;");
                // Dynamically determine insulation class letter based on temperature
                let insulationClassLetter = '';
                if (insulationClass === 105) insulationClassLetter = 'A';
                else if (insulationClass === 130) insulationClassLetter = 'B';
                else if (insulationClass === 155) insulationClassLetter = 'F';
                else if (insulationClass === 180) insulationClassLetter = 'H';
                addResultRow("Insulation Class", `Class ${insulationClassLetter} (${insulationClass} &#8451;)`); 
                addResultRow("Enclosure Type", enclosureType === "indoor" ? "Indoor (e.g., NEMA 1, IP20)" : "Outdoor (e.g., NEMA 3R, IP54)");
                addResultRow("Installation Altitude", altitude.toFixed(0) + " m");
                addResultRow("Ambient Temperature", ambientTemp.toFixed(0) + " &#8451;");
                addResultRow("Cooling Method", coolingMethod);
                addResultRow("Total Harmonic Distortion Current (THD-I)", thdI.toFixed(1) + "%");

                // Show results and tips
                resultContainer.style.display = 'block';
                resultContainer.scrollIntoView({ behavior: 'smooth' }); // Scroll to results

                // Re-enable button and hide spinner immediately after calculations are done.
                calculateBtn.classList.remove('loading');
                calculateBtn.disabled = false;
            });

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                // Remove previous type classes
                messageBox.classList.remove('error', 'warning', 'info');
                messageBox.classList.add(type);
                messageBox.style.opacity = 1;

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            // Helper function to add a row to the summary result table
            function addResultRow(parameter, value, highlight = false) {
                const row = document.createElement('tr');
                
                const paramCell = document.createElement('td');
                paramCell.innerHTML = parameter; // Use innerHTML to allow strong tag
                paramCell.classList.add('font-medium');
                
                const valueCell = document.createElement('td');
                valueCell.innerHTML = value; // Use innerHTML to allow strong tag
                
                row.appendChild(paramCell);
                row.appendChild(valueCell);
                
                resultTableBody.appendChild(row);

                // Add animation class to the newly added row
                row.classList.add('result-table-row-animated');

                if (highlight) {
                    row.classList.add('highlight-result');
                }
            }

            // Helper function to add a detailed calculation step
            function addDetailedCalculationStep(stepTitle, formulaText, calculationText) {
                const stepDiv = document.createElement('div');
                stepDiv.classList.add('calculation-step');

                const titleElem = document.createElement('h4');
                titleElem.textContent = stepTitle;
                stepDiv.appendChild(titleElem);

                if (formulaText) {
                    const formulaElem = document.createElement('p');
                    formulaElem.innerHTML = formulaText; 
                    stepDiv.appendChild(formulaElem);
                }

                if (calculationText) {
                    const calcElem = document.createElement('p');
                    calcElem.innerHTML = calculationText; // Use innerHTML to allow MathJax to process
                    stepDiv.appendChild(calcElem);
                }
                detailedCalculationsDiv.appendChild(stepDiv);

                // IMPORTANT: Tell MathJax to re-render the newly added content immediately
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    window.MathJax.typesetPromise([stepDiv]);
                }
            }
        });
    </script>
</body>

</html>
