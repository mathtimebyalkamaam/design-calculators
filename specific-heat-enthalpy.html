<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Specific Heat & Enthalpy Change - Design Calculators - Mechanical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        // MathJax configuration to support inline and display LaTeX
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <style>
        /* CSS Variables for theming (light and dark mode) */
        :root {
            --primary-color: #2196F3;
            --secondary-color: #1976D2;
            --accent-color: #FFC100; /* Adjusted for better visibility */
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --header-bg: #2C3E50;
            --footer-bg: #34495E;
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            --hover-color: #e2e6ea;
            --primary-color-rgb: 33, 150, 243;
            --success-color: #28a745;
            --error-color: #dc3545;
        }
        /* Dark mode overrides */
        body.dark-mode {
            --primary-color: #5DADE2;
            --secondary-color: #2874A6;
            --bg-color: #252D3A;
            --card-bg: #2F3C4C;
            --text-color: #E0E6EB;
            --header-bg: #252D3A;
            --footer-bg: #252D3A;
            --border-color: #4C5C70;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #3A475C;
            --primary-color-rgb: 93, 173, 226;
            --success-color: #4CAF50;
            --error-color: #F44336;
        }
        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, var(--bg-color) 0%, rgba(244, 247, 246, 0.8) 100%);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s, background-image 0.3s;
        }
        /* Container for content width limitation and centering */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }
        /* Header styling */
        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        header h1 {
            margin: 0;
            font-size: 2.8em;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        header .subtitle {
            margin: 8px 0 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }
        /* Main content area styling */
        main {
            padding: 30px 0;
        }
        /* Tool container styling */
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            transition: transform 0.3s ease-in-out;
        }
        .tool-container:hover {
            transform: translateY(-5px);
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 2em;
        }
        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1.05em;
        }
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }
        .tool-description strong {
            color: var(--primary-color);
        }
        /* Back button styling */
        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 25px;
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            font-weight: bold;
        }
        .back-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.03);
        }
        /* Theme toggle switch styling */
        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
        }
        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px;
            font-size: 1.3em;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 65px;
            height: 38px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(27px);
        }
        .slider.round {
            border-radius: 38px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        /* Footer styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }
        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.3em;
        }
        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }
        .social-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        /* Specific social button colors */
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #7f8c8d; }
        /* Calculator form styling */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.05em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.3);
            outline: none;
        }
        /* Radio button group styling */
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
            margin-bottom: 0;
        }
        .radio-group input[type="radio"] {
            width: auto;
            margin-right: 8px;
            accent-color: var(--primary-color);
        }

        /* Checkbox styling */
        .checkbox-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            transform: scale(1.2);
            accent-color: var(--primary-color);
        }
        .checkbox-group label {
            margin-bottom: 0;
        }

        /* Responsive form row layout */
        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap; /* Allows items to wrap on smaller screens */
        }
        .form-row .form-group {
            flex: 1 1 calc(50% - 10px); /* Two columns, with gap */
            min-width: 280px; /* Minimum width before wrapping */
        }
        /* Media query for single column on small screens */
        @media (max-width: 600px) {
            .form-row .form-group {
                flex: 1 1 100%; /* Single column */
            }
        }
        /* Calculate button styling */
        .calculate-btn {
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-image 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%; /* Full width button */
        }
        .calculate-btn:hover {
            background-image: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        /* Result container styling */
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: block; /* Always block, but opacity controls visibility */
            opacity: 0;
            transition: opacity 0.6s ease-out;
            pointer-events: none; /* Prevents interaction when hidden */
        }
        .result-container.show {
            opacity: 1;
            pointer-events: auto; /* Allows interaction when shown */
        }
        /* Result table styling */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            font-size: 1.1em;
        }
        .result-table tr:last-child td {
            border-bottom: none;
        }
        /* Standard reference text styling */
        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            line-height: 1.5;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        /* Tooltip styling */
        .info-icon {
            color: var(--primary-color);
            margin-left: 8px;
            cursor: help;
            font-size: 1em;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the element */
            left: 50%;
            margin-left: -110px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%; /* Arrow at the bottom */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        /* Custom message box for alerts */
        #custom-message-box {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, background-color 0.3s;
            font-size: 1.1em;
        }
        #custom-message-box.info {
            background-color: var(--success-color);
        }
        #custom-message-box.error {
            background-color: var(--error-color);
        }
        #custom-message-box.warning {
            background-color: var(--accent-color);
            color: #333;
        }

        /* Calculation details section styling */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.98em;
            overflow-x: auto; /* Allow horizontal scrolling for formulas if needed */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            border: 1px dashed var(--border-color);
            white-space: nowrap; /* Prevent formula from wrapping */
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 0.95em;
            white-space: nowrap; /* Prevent calculation steps from wrapping */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #calculation-details ul li {
            margin-bottom: 5px;
        }
        /* Specific styling for required inputs to highlight visually */
        input:required:invalid {
            border-color: var(--error-color);
        }
        input:required:valid {
            border-color: var(--success-color);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Mechanical</h1>
            <p class="subtitle">Smart Tools for Modern Mechanical Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Back to Tools link (placeholder, replace with actual index.html if available) -->
        <a href="indexMech.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Tools
        </a>

        <div class="tool-container">
            <h2>Specific Heat & Enthalpy Change Calculator (Industrial Grade)</h2>
            <div class="tool-description">
                <p>This calculator is an industrial-grade tool to determine the <strong>net heat transfer (Q)</strong> for a substance undergoing changes in its thermodynamic state. It combines fundamental principles of thermodynamics, allowing for calculations involving **enthalpy differences**, **sensible heat**, **latent heat (phase change)**, and **shaft work**, crucial for accurate energy balances in complex industrial processes, equipment sizing, and performance analysis.</p>
                <p><strong>Key Inputs:</strong></p>
                <ul>
                    <li><strong>Unit System:</strong> Select Metric (kg, kJ, °C) or Imperial (lb, BTU, °F) for consistent units.</li>
                    <li><strong>Mass Flow Rate (M):</strong> The mass flow rate of the substance (e.g., fluid in a heat exchanger, steam in a turbine). Obtain from calibrated flow meters under steady-state conditions.</li>
                    <li><strong>Thermodynamic Calculation Method:</strong> Choose the primary method based on available, validated data:
                        <ul>
                            <li><strong>Using Inlet/Outlet Enthalpies (h<sub>in</sub>, h<sub>out</sub>):</strong> **Highly Recommended for critical applications**, especially for fluids undergoing complex phase changes or when specific heat is highly variable. Enthalpy values **must** be obtained from reliable, industry-recognized thermodynamic property tables (e.g., ASME Steam Tables, NIST databases, specialized process simulation software) corresponding to the measured pressure and temperature.</li>
                            <li><strong>Using Temperatures & Specific Heat (T<sub>in</sub>, T<sub>out</sub>, C<sub>p</sub>):</strong> Suitable for sensible heating/cooling of substances (no phase change expected) where the specific heat capacity (\(C_p\)) can be assumed constant over the temperature range. Refer to validated engineering handbooks or material property databases for accurate \(C_p\) values.</li>
                        </ul>
                    </li>
                    <li>**Phase Change (Optional, with Temperatures & Specific Heat):** If a phase change occurs (e.g., vaporization or condensation) while using the temperature-based method, enable this option to include:
                        <ul>
                            <li>**Latent Heat of Vaporization/Condensation (\(h_{fg}\)):** The energy required for a complete phase change at constant temperature/pressure.</li>
                            <li>**Fraction of Fluid Undergoing Phase Change (\(\alpha\)):** The portion of the mass flow that actually undergoes the phase change (0 to 1, or 0% to 100%).</li>
                        </ul>
                    </li>
                    <li>**Shaft Work (Optional):** Include external work done on or by the fluid (e.g., pumps, compressors, turbines).
                        <ul>
                            <li>**Shaft Work Rate (W<sub>shaft</sub>):** The magnitude of power exchanged with the fluid.</li>
                            <li>**Work Direction:** Specify if work is "Done ON Fluid" (e.g., pump, compressor) or "Done BY Fluid" (e.g., turbine, expander).</li>
                        </ul>
                    </li>
                </ul>
                <p><strong>Calculated Outputs:</strong></p>
                <ul>
                    <li><strong>Specific Enthalpy Change (\(\Delta h\)):</strong> The change in enthalpy per unit mass of the substance (e.g., kJ/kg or BTU/lb). A positive value indicates energy absorbed, negative indicates energy released.</li>
                    <li><strong>Heat Transferred (Q):</strong> The net heat transferred to the substance per unit time (e.g., kJ/hr, BTU/hr, or **MW**). A positive value indicates heat absorbed by the substance (endothermic process); a negative value indicates heat rejected by the substance (exothermic process).</li>
                </ul>
                <p><strong>Industrial Application Note:</strong> For accurate and reliable results in complex industrial applications (e.g., heat exchanger sizing, pump/turbine power requirements, chemical reactor energy balances), it is paramount to use highly accurate, measured, and consistent thermodynamic property data. This calculator serves as a powerful validation or preliminary design tool for experienced professionals; it is **not a substitute for detailed engineering analysis** or process simulation software.</p>
            </div>

            <div class="calculator-form">
                <form id="enthalpy-calculator-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (kg, kJ, °C) or Imperial (lb, BTU, °F) for consistent units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (kg/hr, kJ/kg, °C)</option>
                                <option value="imperial">Imperial (lb/hr, BTU/lb, °F)</option>
                            </select>
                        </div>
                    </div>

                    <h3>Input Parameters</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mass-flow-rate">Mass Flow Rate (M) <span class="mass-rate-unit">(kg/hr)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Mass flow rate of the substance. Use data from calibrated industrial flow meters.</span></span></label>
                            <input type="number" id="mass-flow-rate" step="any" value="1000" required min="0.01">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Thermodynamic Calculation Method:</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="enthalpy-method" value="direct-enthalpy" checked>
                                Using Inlet/Outlet Enthalpies
                            </label>
                            <label>
                                <input type="radio" name="enthalpy-method" value="temp-cp">
                                Using Temperatures & Specific Heat (\(C_p\))
                            </label>
                        </div>
                    </div>

                    <div id="direct-enthalpy-inputs" class="form-row">
                        <div class="form-group">
                            <label for="enthalpy-in">Inlet Enthalpy (h<sub>in</sub>) <span class="enthalpy-unit">(kJ/kg)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Specific enthalpy at inlet. **Critical Input**: Obtain from validated thermodynamic property tables (e.g., ASME Steam Tables, NIST) or process simulation software at P, T.</span></span></label>
                            <input type="number" id="enthalpy-in" step="any" value="200" required>
                        </div>
                        <div class="form-group">
                            <label for="enthalpy-out">Outlet Enthalpy (h<sub>out</sub>) <span class="enthalpy-unit">(kJ/kg)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Specific enthalpy at outlet. **Critical Input**: Obtain from validated thermodynamic property tables (e.g., ASME Steam Tables, NIST) or process simulation software at P, T.</span></span></label>
                            <input type="number" id="enthalpy-out" step="any" value="1500" required>
                        </div>
                    </div>

                    <div id="temp-cp-inputs" class="form-row" style="display: none;">
                        <div class="form-group">
                            <label for="temperature-in">Inlet Temperature (T<sub>in</sub>) <span class="temp-unit">(°C)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inlet temperature of the substance. Ensure accurate sensor readings.</span></span></label>
                            <input type="number" id="temperature-in" step="any" value="30" required>
                        </div>
                        <div class="form-group">
                            <label for="temperature-out">Outlet Temperature (T<sub>out</sub>) <span class="temp-unit">(°C)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Outlet temperature of the substance. Ensure accurate sensor readings.</span></span></label>
                            <input type="number" id="temperature-out" step="any" value="300" required>
                        </div>
                        <div class="form-group">
                            <label for="specific-heat">Specific Heat Capacity (C<sub>p</sub>) <span class="cp-unit">(kJ/kg·°C)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Average specific heat capacity over the temperature range. Use accurate, validated data from engineering handbooks or databases. For wide ranges, an integrated average or temperature-dependent correlation is needed.</span></span></label>
                            <input type="number" id="specific-heat" step="any" value="2.0" required min="0.001">
                        </div>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="include-phase-change">
                            <label for="include-phase-change">Include Phase Change (e.g., vaporization, condensation)</label>
                        </div>
                        <div id="phase-change-inputs" class="form-row" style="display: none;">
                            <div class="form-group">
                                <label for="latent-heat">Latent Heat (\(h_{fg}\)) <span class="enthalpy-unit">(kJ/kg)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Latent heat of vaporization or condensation at the phase change temperature/pressure. Obtain from thermodynamic tables.</span></span></label>
                                <input type="number" id="latent-heat" step="any" value="2257.06" min="0">
                            </div>
                            <div class="form-group">
                                <label for="phase-fraction">Fraction Undergoing Phase Change (\(\alpha\)): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Fraction of the mass flow that changes phase (0.0 to 1.0, or 0% to 100%). E.g., 0.5 for 50% vaporized.</span></span></label>
                                <input type="number" id="phase-fraction" step="0.01" value="1.0" min="0" max="1">
                            </div>
                        </div>
                    </div>

                    <h3>Work Parameters (Optional)</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shaft-work-rate">Shaft Work Rate (W<sub>shaft</sub>) <span class="total-energy-unit">(kJ/hr)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Magnitude of external work exchanged with the fluid. Positive value.</span></span></label>
                            <input type="number" id="shaft-work-rate" step="any" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <label for="work-direction">Work Direction:</label>
                            <select id="work-direction" disabled>
                                <option value="on-fluid">Work Done ON Fluid (e.g., Pump, Compressor)</option>
                                <option value="by-fluid">Work Done BY Fluid (e.g., Turbine, Expander)</option>
                            </select>
                            <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select if work is done ON the fluid (energy added, like a pump) or BY the fluid (energy removed, like a turbine).</span></span>
                        </div>
                    </div>
                    
                    <button type="button" id="calculate-enthalpy-btn" class="calculate-btn">Calculate Net Heat Transfer</button>
                </form>
            </div>

            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>This Specific Heat & Enthalpy Change Calculator provides a fundamental thermodynamic calculation of energy change. It is designed as a practical, industrial-grade tool for preliminary assessments, process design, and energy balance calculations.</p>
                <p><strong>Key Considerations and Limitations for Industrial Use:</strong></p>
                <ul>
                    <li><strong>Data Accuracy is Critical:</strong> The precision of calculated enthalpy changes is entirely dependent on the accuracy of input data. For exact values, especially involving phase changes (e.g., vaporization, condensation) or at high pressures/temperatures, specific enthalpy values **must** be sourced from validated thermodynamic property tables (e.g., ASME Steam Tables, NIST databases) or specialized process simulation software. **Do NOT use this tool with unverified or estimated property data for critical applications.**</li>
                    <li><strong>Specific Heat Variability:</strong> When using the "Temperatures & Specific Heat" method, it's crucial to understand that specific heat capacity (\(C_p\)) can vary significantly with temperature, pressure, and phase (liquid, gas, solid). This calculator assumes a constant average \(C_p\) over the specified temperature range. For wide temperature ranges, high pressures, or when phase changes occur, variable \(C_p\) correlations or direct enthalpy data are **required for accuracy**.</li>
                    <li><strong>Phase Changes:</strong> This calculator, particularly the "Temperature & Specific Heat" method when "Include Phase Change" is enabled, simplifies the phase change calculation by assuming it occurs isothermally and isobarically at a known latent heat. For complex mixtures or multi-component phase changes, advanced thermodynamic models are **necessary**. Ensure the latent heat and fraction apply correctly to your specific process conditions.</li>
                    <li><strong>Mixtures & Chemical Reactions:</strong> This tool is designed primarily for a single pure substance or a mixture with well-defined average properties. For complex mixtures, especially with varying compositions or those undergoing chemical reactions, dedicated chemical engineering thermodynamics software (e.g., Aspen HYSYS, PRO/II) is **necessary**.</li>
                    <li><strong>Ideal Gas vs. Real Gas Behavior:</strong> For gases at high pressures, low temperatures, or near saturation, ideal gas assumptions (where enthalpy is primarily a function of temperature) may not hold. In such cases, accurate direct enthalpy data from real gas property tables is **essential**.</li>
                    <li><strong>Instrumentation & Measurement:</strong> Accurate field measurements of mass flow rates, temperatures, and pressures from **calibrated industrial instruments** are foundational for applying this calculator effectively in real-world industrial scenarios. Inaccurate measurements will lead to incorrect results.</li>
                    <li><strong>Beyond This Tool:</strong> This calculator provides the energy balance for the fluid stream itself based on the First Law of Thermodynamics ($Q - W_{shaft} = \Delta H$). It does not account for equipment inefficiencies (e.g., heat exchanger effectiveness, pump/turbine isentropic efficiencies), which require separate, more comprehensive system energy balance calculations for overall thermal design and optimization.</li>
                </ul>
                <p>For critical industrial processes, detailed system design, troubleshooting complex thermal systems, process optimization, or regulatory compliance, it is **imperative** to utilize comprehensive engineering principles, advanced thermodynamic modeling software, and consult with experienced chemical, process, or mechanical engineers specializing in thermal systems.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Mechanical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Mechanical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="mailto:?subject=Check out Design Calculators - Mechanical!&body=I found this amazing Specific Heat & Enthalpy Change Calculator and other design calculators: https://designcalculators.co.in" class="social-btn email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to DOM elements
            const calculateBtn = document.getElementById('calculate-enthalpy-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            // Input fields
            const unitSystemSelect = document.getElementById('unit-system');
            const massFlowRateInput = document.getElementById('mass-flow-rate');

            // Calculation method selectors
            const enthalpyMethodRadios = document.querySelectorAll('input[name="enthalpy-method"]');
            const directEnthalpyInputsDiv = document.getElementById('direct-enthalpy-inputs');
            const tempCpInputsDiv = document.getElementById('temp-cp-inputs');

            // Direct Enthalpy inputs
            const enthalpyInInput = document.getElementById('enthalpy-in');
            const enthalpyOutInput = document.getElementById('enthalpy-out');

            // Temperature/Cp inputs
            const temperatureInInput = document.getElementById('temperature-in');
            const temperatureOutInput = document.getElementById('temperature-out');
            const specificHeatInput = document.getElementById('specific-heat');
            const includePhaseChangeCheckbox = document.getElementById('include-phase-change');
            const phaseChangeInputsDiv = document.getElementById('phase-change-inputs');
            const latentHeatInput = document.getElementById('latent-heat');
            const phaseFractionInput = document.getElementById('phase-fraction');

            // Work parameters
            const shaftWorkRateInput = document.getElementById('shaft-work-rate');
            const workDirectionSelect = document.getElementById('work-direction');
            
            // Labels that change text
            const massRateUnitLabel = document.querySelector('.mass-rate-unit');
            const enthalpyUnitLabels = document.querySelectorAll('.enthalpy-unit');
            const tempUnitLabels = document.querySelectorAll('.temp-unit');
            const cpUnitLabel = document.querySelector('.cp-unit');
            const totalEnergyUnitLabels = document.querySelectorAll('.total-energy-unit');


            /**
             * Displays a custom message box at the top of the screen.
             * @param {string} message - The message to display.
             * @param {string} type - The type of message ('info', 'error', 'warning').
             */
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add(type); // Add type class for styling
                messageBox.style.opacity = 1;

                // Hide message after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            /**
             * Converts an energy value from kJ/hr or BTU/hr to MW.
             * 1 MW = 3600 kJ/hr
             * 1 MW = 3,412,142 BTU/hr (approx)
             * @param {number} value - The energy value in kJ/hr or BTU/hr.
             * @param {string} unitSystem - 'metric' or 'imperial'.
             * @returns {number} The energy value in MW.
             */
            function convertToMW(value, unitSystem) {
                if (unitSystem === 'metric') {
                    return value / 3600; // kJ/hr to MW
                } else {
                    return value / 3412142; // BTU/hr to MW
                }
            }

            /**
             * Updates unit labels and input defaults based on selected unit system.
             */
            function updateUnitLabelsAndDefaults() {
                const unitSystem = unitSystemSelect.value;
                const isMetric = unitSystem === 'metric';

                // Update common units
                massRateUnitLabel.textContent = isMetric ? '(kg/hr)' : '(lb/hr)';
                enthalpyUnitLabels.forEach(label => label.textContent = isMetric ? '(kJ/kg)' : '(BTU/lb)');
                tempUnitLabels.forEach(label => label.textContent = isMetric ? '(°C)' : '(°F)');
                cpUnitLabel.textContent = isMetric ? '(kJ/kg·°C)' : '(BTU/lb·°F)';
                totalEnergyUnitLabels.forEach(label => label.textContent = isMetric ? '(kJ/hr)' : '(BTU/hr)');


                // Set default values based on unit system
                if (isMetric) {
                    massFlowRateInput.value = "1000";
                    enthalpyInInput.value = "200";
                    enthalpyOutInput.value = "1500";
                    temperatureInInput.value = "30";
                    temperatureOutInput.value = "300";
                    specificHeatInput.value = "2.0";
                    latentHeatInput.value = "2257.06"; // Latent heat of water at 100°C
                    shaftWorkRateInput.value = "0";
                } else { // Imperial
                    massFlowRateInput.value = "2200"; // approx 1000 kg/hr
                    enthalpyInInput.value = "86"; // approx 200 kJ/kg
                    enthalpyOutInput.value = "645"; // approx 1500 kJ/kg
                    temperatureInInput.value = "86"; // approx 30°C
                    temperatureOutInput.value = "572"; // approx 300°C
                    specificHeatInput.value = "0.48"; // approx 2.0 kJ/kgC
                    latentHeatInput.value = "970.3"; // Latent heat of water at 212°F
                    shaftWorkRateInput.value = "0";
                }
                phaseFractionInput.value = "1.0"; // Default to full phase change

                toggleEnthalpyMethod(); // Adjust input fields based on default type
                togglePhaseChangeInputs(); // Adjust phase change inputs visibility
                toggleWorkDirectionEnabled(); // Adjust work direction dropdown
            }

            /**
             * Toggles visibility and required status of enthalpy calculation method input fields.
             */
            function toggleEnthalpyMethod() {
                const selectedMethod = document.querySelector('input[name="enthalpy-method"]:checked').value;

                if (selectedMethod === 'direct-enthalpy') {
                    directEnthalpyInputsDiv.style.display = 'flex';
                    tempCpInputsDiv.style.display = 'none';

                    enthalpyInInput.setAttribute('required', 'true');
                    enthalpyOutInput.setAttribute('required', 'true');
                    temperatureInInput.removeAttribute('required');
                    temperatureOutInput.removeAttribute('required');
                    specificHeatInput.removeAttribute('required');
                    // Phase change inputs should be hidden and not required if switching from temp-cp
                    includePhaseChangeCheckbox.checked = false;
                    latentHeatInput.removeAttribute('required');
                    phaseFractionInput.removeAttribute('required');
                } else {
                    directEnthalpyInputsDiv.style.display = 'none';
                    tempCpInputsDiv.style.display = 'flex';
                    
                    enthalpyInInput.removeAttribute('required');
                    enthalpyOutInput.removeAttribute('required');
                    temperatureInInput.setAttribute('required', 'true');
                    temperatureOutInput.setAttribute('required', 'true');
                    specificHeatInput.setAttribute('required', 'true');
                    // Reset phase change inputs state
                    togglePhaseChangeInputs();
                }
            }

            /**
             * Toggles visibility and required status of phase change input fields.
             */
            function togglePhaseChangeInputs() {
                if (includePhaseChangeCheckbox.checked) {
                    phaseChangeInputsDiv.style.display = 'flex';
                    latentHeatInput.setAttribute('required', 'true');
                    phaseFractionInput.setAttribute('required', 'true');
                } else {
                    phaseChangeInputsDiv.style.display = 'none';
                    latentHeatInput.removeAttribute('required');
                    phaseFractionInput.removeAttribute('required');
                }
            }

            /**
             * Enables/disables work direction dropdown based on shaft work rate input.
             */
            function toggleWorkDirectionEnabled() {
                if (parseFloat(shaftWorkRateInput.value) > 0) {
                    workDirectionSelect.removeAttribute('disabled');
                } else {
                    workDirectionSelect.setAttribute('disabled', 'true');
                }
            }

            // Event listeners
            unitSystemSelect.addEventListener('change', updateUnitLabelsAndDefaults);
            enthalpyMethodRadios.forEach(radio => {
                radio.addEventListener('change', toggleEnthalpyMethod);
            });
            includePhaseChangeCheckbox.addEventListener('change', togglePhaseChangeInputs);
            shaftWorkRateInput.addEventListener('input', toggleWorkDirectionEnabled);


            // Initial UI setup on load
            updateUnitLabelsAndDefaults();

            /**
             * Adds a row to the result table.
             * @param {string} parameterHtml - The HTML content for the parameter column.
             * @param {string} valueHtml - The HTML content for the value column.
             */
            function addResultRow(parameterHtml, valueHtml) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameterHtml;
                valueCell.innerHTML = valueHtml;
            }

            // Main Calculation Logic
            calculateBtn.addEventListener('click', function() {
                const form = document.getElementById('enthalpy-calculator-form');
                if (!form.checkValidity()) {
                    displayMessage("Please fill in all required fields correctly.", "error");
                    form.reportValidity(); // Show native browser validation messages
                    return;
                }

                const unitSystem = unitSystemSelect.value;
                const massFlowRate = parseFloat(massFlowRateInput.value);
                const selectedMethod = document.querySelector('input[name="enthalpy-method"]:checked').value;
                const shaftWorkRate = parseFloat(shaftWorkRateInput.value || 0); // Default to 0 if empty
                const workDirection = workDirectionSelect.value;

                let specificEnthalpyChangeFluid = 0; // Δh of the fluid only
                let totalEnthalpyChangeFluid = 0; // M * Δh of the fluid only
                let netHeatTransferred = 0; // Q = M * Δh + W_shaft (First Law)

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                
                // Units for display
                const massRateUnit = unitSystem === 'metric' ? 'kg/hr' : 'lb/hr';
                const energyPerMassUnit = unitSystem === 'metric' ? 'kJ/kg' : 'BTU/lb';
                const tempUnit = unitSystem === 'metric' ? '°C' : '°F';
                const cpUnit = unitSystem === 'metric' ? 'kJ/kg·°C' : 'BTU/lb·°F';
                const totalEnergyUnit = unitSystem === 'metric' ? 'kJ/hr' : 'BTU/hr';

                // --- 1. Calculate Total Enthalpy Change of the Fluid (ΔH_fluid) ---
                if (selectedMethod === 'direct-enthalpy') {
                    const enthalpyIn = parseFloat(enthalpyInInput.value);
                    const enthalpyOut = parseFloat(enthalpyOutInput.value);

                    specificEnthalpyChangeFluid = enthalpyOut - enthalpyIn;
                    totalEnthalpyChangeFluid = massFlowRate * specificEnthalpyChangeFluid;

                    calculationHtml += `<p><strong>1. Calculate Specific Enthalpy Change of Fluid (\\(\\Delta h\\)):</strong></p>
                                        <p class="formula">\\[ \\Delta h = h_{out} - h_{in} \\]</p>
                                        <p class="calculation-step">
                                            \\( \\Delta h \\) = ${enthalpyOut.toFixed(2)} ${energyPerMassUnit} - ${enthalpyIn.toFixed(2)} ${energyPerMassUnit} = ${specificEnthalpyChangeFluid.toFixed(2)} ${energyPerMassUnit}
                                        </p>`;
                    calculationHtml += `<p><strong>2. Calculate Total Enthalpy Change of Fluid (\\(\\Delta H_{fluid}\\)):</strong></p>
                                        <p class="formula">\\[ \\Delta H_{fluid} = M \\times \\Delta h \\]</p>
                                        <p class="calculation-step">
                                            \\( \\Delta H_{fluid} \\) = ${massFlowRate.toFixed(2)} ${massRateUnit} \\( \\times \\) ${specificEnthalpyChangeFluid.toFixed(2)} ${energyPerMassUnit} = ${totalEnthalpyChangeFluid.toFixed(2)} ${totalEnergyUnit}
                                        </p>`;

                } else { // temp-cp method
                    const temperatureIn = parseFloat(temperatureInInput.value);
                    const temperatureOut = parseFloat(temperatureOutInput.value);
                    const specificHeat = parseFloat(specificHeatInput.value);

                    let sensibleHeatChange = specificHeat * (temperatureOut - temperatureIn);
                    let latentHeatChange = 0;

                    if (includePhaseChangeCheckbox.checked) {
                        const latentHeat = parseFloat(latentHeatInput.value);
                        const phaseFraction = parseFloat(phaseFractionInput.value);

                        if (latentHeat < 0) { displayMessage("Latent Heat must be non-negative.", "error"); return; }
                        if (phaseFraction < 0 || phaseFraction > 1) { displayMessage("Phase Fraction must be between 0 and 1.", "error"); return; }

                        latentHeatChange = latentHeat * phaseFraction;
                        calculationHtml += `<p><strong>1.1. Calculate Specific Latent Heat Change:</strong></p>
                                            <p class="formula">\\[ \\Delta h_{latent} = h_{fg} \\times \\alpha \\]</p>
                                            <p class="calculation-step">
                                                \\( \\Delta h_{latent} \\) = ${latentHeat.toFixed(2)} ${energyPerMassUnit} \\( \\times \\) ${phaseFraction.toFixed(2)} = ${latentHeatChange.toFixed(2)} ${energyPerMassUnit}
                                            </p>`;
                    }

                    specificEnthalpyChangeFluid = sensibleHeatChange + latentHeatChange;
                    totalEnthalpyChangeFluid = massFlowRate * specificEnthalpyChangeFluid;

                    calculationHtml += `<p><strong>1. Calculate Specific Sensible Heat Change (\\(\\Delta h_{sensible}\\)):</strong></p>
                                        <p class="formula">\\[ \\Delta h_{sensible} = C_p \\times (T_{out} - T_{in}) \\]</p>
                                        <p class="calculation-step">
                                            \\( \\Delta h_{sensible} \\) = ${specificHeat.toFixed(3)} ${cpUnit} \\( \\times \\) (${temperatureOut.toFixed(2)} - ${temperatureIn.toFixed(2)}) ${tempUnit} = ${sensibleHeatChange.toFixed(2)} ${energyPerMassUnit}
                                        </p>`;
                    if (includePhaseChangeCheckbox.checked) {
                        calculationHtml += `<p><strong>1.2. Calculate Total Specific Enthalpy Change (\\(\\Delta h\\)):</strong></p>
                                            <p class="formula">\\[ \\Delta h = \\Delta h_{sensible} + \\Delta h_{latent} \\]</p>
                                            <p class="calculation-step">
                                                \\( \\Delta h \\) = ${sensibleHeatChange.toFixed(2)} ${energyPerMassUnit} + ${latentHeatChange.toFixed(2)} ${energyPerMassUnit} = ${specificEnthalpyChangeFluid.toFixed(2)} ${energyPerMassUnit}
                                            </p>`;
                    }
                    calculationHtml += `<p><strong>2. Calculate Total Enthalpy Change of Fluid (\\(\\Delta H_{fluid}\\)):</strong></p>
                                        <p class="formula">\\[ \\Delta H_{fluid} = M \\times \\Delta h \\]</p>
                                        <p class="calculation-step">
                                            \\( \\Delta H_{fluid} \\) = ${massFlowRate.toFixed(2)} ${massRateUnit} \\( \\times \\) ${specificEnthalpyChangeFluid.toFixed(2)} ${energyPerMassUnit} = ${totalEnthalpyChangeFluid.toFixed(2)} ${totalEnergyUnit}
                                        </p>`;
                }

                // --- 3. Incorporate Shaft Work into Net Heat Transfer ---
                let shaftWorkSign = 0; // Positive for work done BY fluid, negative for work done ON fluid
                if (shaftWorkRate > 0) {
                    if (workDirection === 'on-fluid') {
                        shaftWorkSign = -1; // Work done ON fluid (e.g., pump), so W_shaft is negative in Q - W = Delta H
                        calculationHtml += `<p><strong>3. Shaft Work Term (W<sub>shaft</sub>):</strong> Work Done ON Fluid (Pump/Compressor) </p>
                                            <p class="calculation-step">
                                                \\( W_{shaft} \\) = -${shaftWorkRate.toFixed(2)} ${totalEnergyUnit}
                                            </p>`;
                    } else { // 'by-fluid'
                        shaftWorkSign = 1; // Work done BY fluid (e.g., turbine), so W_shaft is positive in Q - W = Delta H
                         calculationHtml += `<p><strong>3. Shaft Work Term (W<sub>shaft</sub>):</strong> Work Done BY Fluid (Turbine/Expander) </p>
                                            <p class="calculation-step">
                                                \\( W_{shaft} \\) = +${shaftWorkRate.toFixed(2)} ${totalEnergyUnit}
                                            </p>`;
                    }
                } else {
                    calculationHtml += `<p><strong>3. Shaft Work Term (W<sub>shaft</sub>):</strong> No shaft work considered (0 ${totalEnergyUnit}).</p>`;
                }

                // First Law of Thermodynamics: Q - W = ΔH => Q = ΔH + W
                // Note: W here is W_shaft (work done BY system). If work is done ON system, W is negative.
                netHeatTransferred = totalEnthalpyChangeFluid + (shaftWorkSign * shaftWorkRate);

                calculationHtml += `<p><strong>4. Calculate Net Heat Transferred (Q) using First Law of Thermodynamics:</strong></p>
                                    <p class="formula">\\[ Q - W_{shaft} = \\Delta H_{fluid} \\implies Q = \\Delta H_{fluid} + W_{shaft} \\]</p>
                                    <p class="calculation-step">
                                        \\( Q \\) = ${totalEnthalpyChangeFluid.toFixed(2)} ${totalEnergyUnit} ${shaftWorkSign === 1 ? '+' : ''} ${shaftWorkSign === -1 ? '-' : ''} ${shaftWorkRate.toFixed(2)} ${totalEnergyUnit} = ${netHeatTransferred.toFixed(2)} ${totalEnergyUnit}
                                    </p>`;

                // Convert total heat transferred to MW
                const netHeatTransferredMW = convertToMW(netHeatTransferred, unitSystem);
                calculationHtml += `<p class="calculation-step">
                                    Net Heat Transferred in MW = ${netHeatTransferred.toFixed(2)} ${totalEnergyUnit} / ${unitSystem === 'metric' ? '3600 kJ/hr/MW' : '3,412,142 BTU/hr/MW'} = ${netHeatTransferredMW.toFixed(3)} MW
                                </p>`;


                // Clear previous results
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = calculationHtml;

                // Populate results table
                addResultRow("Unit System", unitSystem === 'imperial' ? 'Imperial' : 'Metric');
                addResultRow("Mass Flow Rate (M)", `${massFlowRate.toFixed(2)} ${massRateUnit}`);
                addResultRow("Calculation Method", selectedMethod === 'direct-enthalpy' ? 'Using Inlet/Outlet Enthalpies' : 'Using Temperatures & C<sub>p</sub>');
                
                if (selectedMethod === 'direct-enthalpy') {
                    addResultRow("Inlet Enthalpy (h<sub>in</sub>)", `${parseFloat(enthalpyInInput.value).toFixed(2)} ${energyPerMassUnit}`);
                    addResultRow("Outlet Enthalpy (h<sub>out</sub>)", `${parseFloat(enthalpyOutInput.value).toFixed(2)} ${energyPerMassUnit}`);
                } else {
                    addResultRow("Inlet Temperature (T<sub>in</sub>)", `${parseFloat(temperatureInInput.value).toFixed(2)} ${tempUnit}`);
                    addResultRow("Outlet Temperature (T<sub>out</sub>)", `${parseFloat(temperatureOutInput.value).toFixed(2)} ${tempUnit}`);
                    addResultRow("Specific Heat Capacity (C<sub>p</sub>)", `${parseFloat(specificHeatInput.value).toFixed(3)} ${cpUnit}`);
                    if (includePhaseChangeCheckbox.checked) {
                        addResultRow("Latent Heat (h<sub>fg</sub>)", `${parseFloat(latentHeatInput.value).toFixed(2)} ${energyPerMassUnit}`);
                        addResultRow("Fraction Phase Changed (\\(\\alpha\\))", `${parseFloat(phaseFractionInput.value).toFixed(2)}`);
                    } else {
                        addResultRow("Phase Change", "Not Included");
                    }
                }
                
                addResultRow("Shaft Work Rate (W<sub>shaft</sub>)", `${shaftWorkRate.toFixed(2)} ${totalEnergyUnit}`);
                if (shaftWorkRate > 0) {
                    addResultRow("Work Direction", workDirection === 'on-fluid' ? 'Work Done ON Fluid' : 'Work Done BY Fluid');
                } else {
                    addResultRow("Work Direction", "N/A (No Work)");
                }

                // Final results
                addResultRow("Specific Enthalpy Change (\\(\\Delta h\\))", `<strong>${specificEnthalpyChangeFluid.toFixed(2)} ${energyPerMassUnit}</strong>`);
                addResultRow("Total Enthalpy Change of Fluid (\\(\\Delta H_{fluid}\\))", `<strong>${totalEnthalpyChangeFluid.toFixed(2)} ${totalEnergyUnit}</strong>`);
                addResultRow("Net Heat Transferred (Q)", `<strong>${netHeatTransferred.toFixed(2)} ${totalEnergyUnit} (${netHeatTransferredMW.toFixed(3)} MW)</strong>`);
                addResultRow("Interpretation of Q", `A ${netHeatTransferred >= 0 ? 'positive' : 'negative'} value indicates heat ${netHeatTransferred >= 0 ? 'absorbed by' : 'rejected by'} the substance.`);


                // Re-render MathJax equations - ensure MathJax is fully loaded
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    window.MathJax.typesetPromise([calculationDetailsDiv, resultTableBody]);
                }

                // Display standard reference
                standardReference.innerHTML = "This Specific Heat & Enthalpy Change Calculator provides a fundamental thermodynamic calculation of energy change. It is designed as a practical, industrial-grade tool for preliminary assessments, process design, and energy balance calculations. <strong>Key Considerations and Limitations for Industrial Use:</strong> <strong>Data Accuracy is Critical:</strong> The precision of calculated enthalpy changes is entirely dependent on the accuracy of input data. For exact values, especially involving phase changes (e.g., vaporization, condensation) or at high pressures/temperatures, specific enthalpy values **must** be sourced from validated thermodynamic property tables (e.g., ASME Steam Tables, NIST databases) or specialized process simulation software. **Do NOT use this tool with unverified or estimated property data for critical applications.** <strong>Specific Heat Variability:</strong> When using the \"Temperatures & Specific Heat\" method, it's crucial to understand that specific heat capacity (\\(C_p\\)) can vary significantly with temperature, pressure, and phase (liquid, gas, solid). This calculator assumes a constant average \\(C_p\\) over the specified temperature range. For wide temperature ranges, high pressures, or when phase changes occur, variable \\(C_p\\) correlations or direct enthalpy data are **required for accuracy**. <strong>Phase Changes:</strong> This calculator, particularly the \"Temperature & Specific Heat\" method when \"Include Phase Change\" is enabled, simplifies the phase change calculation by assuming it occurs isothermally and isobarically at a known latent heat. For complex mixtures or multi-component phase changes, advanced thermodynamic models are **necessary**. Ensure the latent heat and fraction apply correctly to your specific process conditions. <strong>Mixtures & Chemical Reactions:</strong> This tool is designed primarily for a single pure substance or a mixture with well-defined average properties. For complex mixtures, especially with varying compositions or those undergoing chemical reactions, dedicated chemical engineering thermodynamics software (e.g., Aspen HYSYS, PRO/II) is **necessary**. <strong>Ideal Gas vs. Real Gas Behavior:</strong> For gases at high pressures, low temperatures, or near saturation, ideal gas assumptions (where enthalpy is only a function of temperature) may not hold. In such cases, accurate direct enthalpy data from real gas property tables is **essential**. <strong>Instrumentation & Measurement:</strong> Accurate field measurements of mass flow rates, temperatures, and pressures from **calibrated industrial instruments** are foundational for applying this calculator effectively in real-world industrial scenarios. Inaccurate measurements will lead to incorrect results. <strong>Beyond This Tool:</strong> This calculator provides the energy balance for the fluid stream itself based on the First Law of Thermodynamics ($Q - W_{shaft} = \\Delta H$). It does not account for equipment inefficiencies (e.g., heat exchanger effectiveness, pump/turbine isentropic efficiencies), which require separate, more comprehensive system energy balance calculations for overall thermal design and optimization. For critical industrial processes, detailed system design, troubleshooting complex thermal systems, or regulatory compliance, it is <strong>imperative</strong> to utilize comprehensive engineering principles, advanced thermodynamic modeling software, and consult with experienced chemical, process, or mechanical engineers.";

                // Ensure result container is visible and transitions smoothly
                resultContainer.style.display = 'block'; // Make element visible
                resultContainer.offsetHeight; // Force reflow to ensure display change is registered before transition
                resultContainer.classList.add('show'); // Apply class that sets opacity to 1 and allows interaction

                resultContainer.scrollIntoView({ behavior: 'smooth' });

                displayMessage("Net heat transfer calculation completed successfully!", "info");
            });

            // Theme switch functionality
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>