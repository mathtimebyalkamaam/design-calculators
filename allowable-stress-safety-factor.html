<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allowable Stress, Safety Factor & Failure Theory Calculator - Industrial Grade</title>
    <meta name="description" content="Professional Mechanical Stress Calculator. Determine Safety Factors using Von Mises, Tresca, and Rankine theories. Calculate Principal Stresses, Allowable Stress, and visualize Yield Surfaces.">
    <meta name="keywords" content="safety factor calculator, allowable stress, von mises stress, tresca criterion, principal stress calculator, mohr's circle, yield strength, ultimate strength, mechanical design, FEA validation">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial - Matches Symmetrical Components) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Quick Load Buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .highlight { color: var(--success); font-weight: 700; }
        .danger-text { color: var(--danger); font-weight: 700; }

        /* Calculation Steps Styling */
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(37, 99, 235, 0.05); /* Light Blue Tint */
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(37, 99, 235, 0.1); }
        
        .calculation-step h4 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 5px;
        }

        /* Canvas Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Educational Section Styling */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .insight-card p, .insight-card ul {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text);
        }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }

        /* Vector Input Group Styling (Reused) */
        .vector-input-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Print Styling */
        @media print {
            header, footer, .education-section, .theme-toggle, .button-wrapper, .preset-container { display: none !important; }
            .card { border: none; shadow: none; padding: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 300px; page-break-inside: avoid; }
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='index.html'>Home</a></li>
                    <li><a href="articles.html">Articles</a></li>
                    <li><a href="indexmech.html">Mechanical</a></li>
                    <li><a href="indexele.html">Electrical</a></li>
                    <li><a href="indexinst.html">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-shield-alt"></i> Allowable Stress & Safety Factor Calculator (Multiaxial)</h2>
            
            <div class="tool-description">
                <p>This industrial-grade calculator evaluates structural integrity using advanced failure theories. Unlike simple uniaxial tools, this calculator handles <strong>Multiaxial Stress States</strong> ($\sigma_x, \sigma_y, \tau_{xy}$) to calculate <strong>Principal Stresses</strong> and **Equivalent Stresses** (Von Mises, Tresca). It determines Safety Factors against Yield (Ductile) and Ultimate (Brittle) limits.</p>
            </div>

            <div class="calculator-form">
                <form id="stress-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('steel_tension')"><i class="fas fa-arrows-alt-h"></i> Steel Uniaxial Tension</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('shaft_torsion')"><i class="fas fa-sync"></i> Drive Shaft (Torsion + Bend)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('pressure_vessel')"><i class="fas fa-compress"></i> Pressure Vessel (Biaxial)</button>
                            </div>
                        </div>
                    </div>

                    <!-- Material & System -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. Material & Settings</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-layer-group"></i> Material</div>
                            <div class="form-group">
                                <label for="material-select">Material Type</label>
                                <select id="material-select" onchange="updateMaterial()">
                                    <option value="steel_a36" selected>Structural Steel A36 (Ductile)</option>
                                    <option value="alum_6061">Aluminum 6061-T6 (Ductile)</option>
                                    <option value="cast_iron">Cast Iron (Brittle)</option>
                                    <option value="titanium">Titanium Ti-6Al-4V (Ductile)</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="yield-strength">Yield Strength ($S_y$) [MPa]</label>
                                <input type="number" id="yield-strength" value="250" step="10">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="ultimate-strength">Ultimate Strength ($S_{ut}$) [MPa]</label>
                                <input type="number" id="ultimate-strength" value="400" step="10">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-cogs"></i> Configuration</div>
                            <div class="form-group">
                                <label for="unit-system">Unit System</label>
                                <select id="unit-system" onchange="updateUnitLabels()">
                                    <option value="metric">Metric (MPa)</option>
                                    <option value="imperial">Imperial (ksi)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="calc-mode">Goal</label>
                                <select id="calc-mode">
                                    <option value="fos" selected>Calculate Safety Factor</option>
                                    <option value="allowable">Calculate Allowable Stress</option>
                                </select>
                            </div>
                             <div class="form-group" style="margin-top:10px;">
                                <label for="target-fos">Target Safety Factor (if calc Allowable)</label>
                                <input type="number" id="target-fos" value="2.0" step="0.1">
                            </div>
                        </div>
                    </div>

                    <!-- Stress State -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Applied Stress State (2D Plane Stress)</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-arrows-alt-v"></i> Normal Stresses</div>
                            <div class="form-group">
                                <label for="sigma-x">Stress X ($\sigma_x$) <span class="unit-label">[MPa]</span></label>
                                <input type="number" id="sigma-x" value="100" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="sigma-y">Stress Y ($\sigma_y$) <span class="unit-label">[MPa]</span></label>
                                <input type="number" id="sigma-y" value="0" step="1">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-expand-arrows-alt"></i> Shear Stress</div>
                            <div class="form-group">
                                <label for="tau-xy">Shear XY ($\tau_{xy}$) <span class="unit-label">[MPa]</span></label>
                                <input type="number" id="tau-xy" value="50" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Safety Factors</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download PDF Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Structural Analysis Results</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Safety Factor Metrics</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Theory</th>
                                    <th>Equivalent Stress</th>
                                    <th>Safety Factor</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-info-circle"></i> Conclusion:</strong>
                            <div id="interpretation-text" style="margin-top: 5px; font-size: 0.95rem;"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Yield Surface (Failure Envelope)</h4>
                        <div class="chart-container">
                            <canvas id="yieldCanvas"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                             <span style="color: #3B82F6;">● Von Mises</span> &nbsp;
                             <span style="color: #10B981;">● Tresca</span> &nbsp;
                             <span style="color: #EF4444;">● Stress State</span>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Analysis based on Plane Stress Transformation. Principal Stresses calculated via Mohr's Circle equations.
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (MASSIVE) -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: Failure Theories Decoded</h2>
            
            <!-- Insight 1: Stress State -->
            <div class="insight-card">
                <h4><i class="fas fa-cube"></i> 1. Understanding Stress State</h4>
                <p>Real-world components are rarely subject to simple pulling (tension). A drive shaft experiences torsion ($\tau$) and bending ($\sigma$). A pressure vessel wall experiences hoop stress ($\sigma_1$) and longitudinal stress ($\sigma_2$).</p>
                <p>To analyze safety, we must combine these multidirectional stresses into a single <strong>Equivalent Stress</strong> that can be compared to the material's yield strength (which is measured in simple tension). This is the job of Failure Theories.</p>
            </div>

            <!-- Insight 2: Principal Stresses -->
            <div class="insight-card">
                <h4><i class="fas fa-arrows-alt"></i> 2. Principal Stresses ($\sigma_1, \sigma_2$)</h4>
                <p>No matter how complex the loading (shear, tension combined), there is always an orientation where the shear stress vanishes, and only normal stresses remain. These are the <strong>Principal Stresses</strong>. They represent the maximum and minimum normal stresses experienced by the material.</p>
                <div class="formula">$$ \sigma_{1,2} = \frac{\sigma_x + \sigma_y}{2} \pm \sqrt{ \left(\frac{\sigma_x - \sigma_y}{2}\right)^2 + \tau_{xy}^2 } $$</div>
                <p>These values are the inputs for all modern failure theories.</p>
            </div>

            <!-- Insight 3: Von Mises -->
            <div class="insight-card">
                <h4><i class="fas fa-circle-notch"></i> 3. Distortion Energy Theory (Von Mises)</h4>
                <p><strong>Best for:</strong> Ductile materials (Steel, Aluminum).
                <br><strong>Concept:</strong> It assumes yielding begins when the distortion energy (energy changing shape, not volume) reaches a critical value.</p>
                <div class="formula">$$ \sigma' = \sqrt{\sigma_1^2 - \sigma_1 \sigma_2 + \sigma_2^2} $$</div>
                <p>The Von Mises yield surface is an ellipse. It is generally the most accurate theory for ductile metals and allows slightly higher loads than Tresca.</p>
            </div>

            <!-- Insight 4: Tresca -->
            <div class="insight-card">
                <h4><i class="fas fa-vector-square"></i> 4. Maximum Shear Stress Theory (Tresca)</h4>
                <p><strong>Best for:</strong> Ductile materials (Conservative Design).
                <br><strong>Concept:</strong> Yielding occurs when the maximum shear stress in the material reaches the shear yield strength ($\tau_{yield} = S_y / 2$).</p>
                <div class="formula">$$ \sigma_{Tresca} = \max(|\sigma_1 - \sigma_2|, |\sigma_1|, |\sigma_2|) $$</div>
                <p>The Tresca yield surface is a hexagon inside the Von Mises ellipse. It is more conservative (predicts failure earlier) and is often used in codes like ASME B&PV because it is simpler and safer.</p>
            </div>
            
            <!-- Insight 5: Rankine -->
            <div class="insight-card">
                <h4><i class="fas fa-skull-crossbones"></i> 5. Maximum Normal Stress Theory (Rankine)</h4>
                <p><strong>Best for:</strong> Brittle materials (Cast Iron, Glass, Concrete).
                <br><strong>Concept:</strong> Failure occurs when the maximum principal stress exceeds the Ultimate Strength ($S_{ut}$). Brittle materials fail by cracking, usually in tension, without yielding.</p>
                <div class="formula">$$ \sigma_{Rankine} = \max(|\sigma_1|, |\sigma_2|) $$</div>
                <p>Never use Rankine for steel or ductile metals, as it ignores shear failure modes.</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Empowering engineers with precision tools for complex analysis. If you find this tool helpful, please consider sharing it with your colleagues!</p>
                     <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='index.html'>Home</a></li>
                        <li><a href="indexele.html">Electrical</a></li>
                        <li><a href="indexmech.html">Mechanical</a></li>
                        <li><a href="indexinst.html">Instrumentation</a></li>
                        <li><a href="articles.html">Articles</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles.html'>Articles & Whitepapers</a></li>
                        <li><a href="sitemap2.html">Sitemap</a></li>                        
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASME B31.3, AISC). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let yieldChart = null;
        let lastResult = null;

        // Material Data
        const matDB = {
            'steel_a36': { name: 'Structural Steel A36', Sy: 250, Sut: 400, type: 'ductile' },
            'alum_6061': { name: 'Aluminum 6061-T6', Sy: 276, Sut: 310, type: 'ductile' },
            'cast_iron': { name: 'Gray Cast Iron', Sy: 0, Sut: 200, type: 'brittle' }, // Sy not used for brittle
            'titanium': { name: 'Titanium Ti-6Al-4V', Sy: 880, Sut: 950, type: 'ductile' }
        };

        function updateMaterial() {
            const key = document.getElementById('material-select').value;
            if(key !== 'custom') {
                const sys = document.getElementById('unit-system').value;
                let sy = matDB[key].Sy;
                let sut = matDB[key].Sut;
                
                if(sys === 'imperial') {
                    sy = sy * 145.038; // MPa to psi
                    sut = sut * 145.038;
                }
                
                // For brittle, Sy is technically not the failure point, Sut is. 
                // But for tool simplicity, we populate Sy field.
                document.getElementById('yield-strength').value = Math.round(sy);
                document.getElementById('ultimate-strength').value = Math.round(sut);
            }
        }

        function updateUnitLabels() {
            const sys = document.getElementById('unit-system').value;
            const labels = document.querySelectorAll('.unit-label');
            const unit = sys === 'metric' ? '[MPa]' : '[ksi]'; // using ksi for imperial to keep numbers small
            labels.forEach(l => l.innerText = unit);
            
            // Adjust values roughly if switched? No, too complex state. Just user changes.
            updateMaterial(); // Re-populate defaults in new unit
        }

        function loadPreset(type) {
            if (type === 'steel_tension') {
                document.getElementById('material-select').value = 'steel_a36';
                updateMaterial();
                document.getElementById('sigma-x').value = '150';
                document.getElementById('sigma-y').value = '0';
                document.getElementById('tau-xy').value = '0';
            } else if (type === 'shaft_torsion') {
                document.getElementById('material-select').value = 'steel_a36';
                updateMaterial();
                document.getElementById('sigma-x').value = '0'; // Pure torsion usually, maybe bending
                document.getElementById('sigma-y').value = '0';
                document.getElementById('tau-xy').value = '140'; // High shear
            } else if (type === 'pressure_vessel') {
                document.getElementById('material-select').value = 'steel_a36';
                updateMaterial();
                document.getElementById('sigma-x').value = '120'; // Hoop
                document.getElementById('sigma-y').value = '60';  // Longitudinal
                document.getElementById('tau-xy').value = '0';
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Theme handling
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function performCalculation() {
            // 1. Get Inputs
            const sy = parseFloat(document.getElementById('yield-strength').value);
            const sut = parseFloat(document.getElementById('ultimate-strength').value);
            const sigX = parseFloat(document.getElementById('sigma-x').value);
            const sigY = parseFloat(document.getElementById('sigma-y').value);
            const tauXY = parseFloat(document.getElementById('tau-xy').value);
            const matKey = document.getElementById('material-select').value;
            const unit = document.getElementById('unit-system').value;

            if (isNaN(sy) || isNaN(sigX)) {
                displayMessage("Please enter valid numbers.", "error");
                return;
            }

            // 2. Physics Engine
            
            // Principal Stresses
            // s1,2 = (sx+sy)/2 +/- sqrt( ((sx-sy)/2)^2 + txy^2 )
            const avg = (sigX + sigY) / 2;
            const diff = (sigX - sigY) / 2;
            const R = Math.sqrt(diff*diff + tauXY*tauXY);
            
            const s1 = avg + R;
            const s2 = avg - R;
            const s3 = 0; // Plane stress assumption

            // Sort principles sA > sB > sC
            const sList = [s1, s2, s3].sort((a,b) => b-a);
            const sA = sList[0];
            const sB = sList[1];
            const sC = sList[2];

            // Von Mises Stress
            // s_vm = sqrt( s1^2 - s1s2 + s2^2 ) for plane stress
            const s_vm = Math.sqrt(s1*s1 - s1*s2 + s2*s2);

            // Tresca Stress
            // s_tr = max(|s1-s2|, |s1-s3|, |s2-s3|) = sA - sC
            const s_tresca = sA - sC;

            // Rankine (Max Normal)
            const s_rankine = Math.max(Math.abs(s1), Math.abs(s2));

            // Safety Factors
            const fos_vm = sy / s_vm;
            const fos_tresca = sy / s_tresca;
            const fos_rankine = sut / s_rankine; // Brittle uses Sut

            // Determine Material Behavior
            let matType = "ductile";
            if (matKey === 'cast_iron' || matKey === 'custom' && sut > sy*2) matType = "brittle"; // Heuristic
            // Actually usually brittle if fracture strain < 0.05. Here we rely on preset or logic.
            // If Cast Iron, use Rankine. Else Von Mises.

            lastResult = { sy, sut, s1, s2, s_vm, s_tresca, s_rankine, fos_vm, fos_tresca, fos_rankine, unit, matType };

            // 3. Render Step-by-Step
            let html = `<h4>Step 1: Principal Stresses (Mohr's Circle)</h4>`;
            html += `<div class="calculation-step">`;
            html += `Average Stress $\\sigma_{avg} = \\frac{${sigX} + ${sigY}}{2} = ${avg.toFixed(1)}$<br>`;
            html += `Radius $R = \\sqrt{(\\frac{${sigX} - ${sigY}}{2})^2 + ${tauXY}^2} = ${R.toFixed(1)}$<br>`;
            html += `$$ \\sigma_1 = ${avg.toFixed(1)} + ${R.toFixed(1)} = \\mathbf{${s1.toFixed(1)}} $$<br>`;
            html += `$$ \\sigma_2 = ${avg.toFixed(1)} - ${R.toFixed(1)} = \\mathbf{${s2.toFixed(1)}} $$`;
            html += `</div>`;

            html += `<h4>Step 2: Equivalent Stresses</h4>`;
            html += `<div class="calculation-step">`;
            html += `<strong>Von Mises (Distortion Energy):</strong><br>`;
            html += `$$ \\sigma' = \\sqrt{${s1.toFixed(1)}^2 - (${s1.toFixed(1)})(${s2.toFixed(1)}) + ${s2.toFixed(1)}^2} = \\mathbf{${s_vm.toFixed(1)}} $$<br>`;
            html += `<strong>Tresca (Max Shear):</strong><br>`;
            html += `$$ \\sigma_{tr} = \\max(|\\sigma_1 - \\sigma_2|, |\\sigma_1|, |\\sigma_2|) = \\mathbf{${s_tresca.toFixed(1)}} $$<br>`;
            html += `(Assuming Plane Stress $\\sigma_3=0$)`;
            html += `</div>`;

            html += `<h4>Step 3: Safety Factors</h4>`;
            html += `<div class="calculation-step">`;
            html += `Material Yield $S_y = ${sy}$. Ultimate $S_{ut} = ${sut}$.<br>`;
            html += `$$ FoS_{VM} = S_y / \\sigma' = ${fos_vm.toFixed(2)} $$<br>`;
            html += `$$ FoS_{Tresca} = S_y / \\sigma_{tr} = ${fos_tresca.toFixed(2)} $$<br>`;
            html += `$$ FoS_{Rankine} = S_{ut} / \\sigma_{max} = ${fos_rankine.toFixed(2)} $$`;
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;

            // 4. Update Table
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, f, c="") => {
                tbody.innerHTML += `<tr style="${c ? 'color:'+c : ''}"><td><strong>${n}</strong></td><td>${v}</td><td>${f}</td></tr>`;
            };
            
            const u = unit === 'metric' ? 'MPa' : 'ksi';
            
            // Highlight recommended
            if (matType === 'ductile') {
                addRow("Von Mises (Recommended)", s_vm.toFixed(1) + " " + u, fos_vm.toFixed(2), "var(--primary)");
                addRow("Tresca (Conservative)", s_tresca.toFixed(1) + " " + u, fos_tresca.toFixed(2));
                addRow("Rankine (Not for Ductile)", s_rankine.toFixed(1) + " " + u, fos_rankine.toFixed(2), "#999");
            } else {
                addRow("Rankine (Recommended)", s_rankine.toFixed(1) + " " + u, fos_rankine.toFixed(2), "var(--primary)");
                addRow("Von Mises", s_vm.toFixed(1) + " " + u, fos_vm.toFixed(2), "#999");
            }

            const interpEl = document.getElementById('interpretation-text');
            const mainFos = matType === 'ductile' ? fos_vm : fos_rankine;
            
            if (mainFos < 1.0) {
                interpEl.innerHTML = `<span class="danger-text">FAILURE PREDICTED.</span> Safety Factor < 1.0. The part will yield or break.`;
            } else if (mainFos < 1.5) {
                interpEl.innerHTML = `<span style="color:var(--warning); font-weight:bold;">Marginal Safety.</span> SF is low (1.0 - 1.5). Acceptable only for controlled, static loads.`;
            } else {
                interpEl.innerHTML = `<span class="highlight">Safe Design.</span> SF > 1.5. Adequate for general machine design.`;
            }

            // 5. Draw Visual
            drawYieldSurface(sy, s1, s2);

            // 6. Show
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        function drawYieldSurface(Sy, s1, s2) {
            const canvas = document.getElementById('yieldCanvas');
            const ctx = canvas.getContext('2d');
            
            // Destroy old chart if exists (using Chart.js scatter for flexibility)
            if (window.myChart) window.myChart.destroy();

            // Generate Ellipse (Von Mises)
            // s1^2 - s1s2 + s2^2 = Sy^2
            // Parametric: s1 = Sy * (cos(t) + sin(t)/sqrt(3)), s2 = Sy * (2*sin(t)/sqrt(3)) ... complex.
            // Easier: iterate angle.
            // Ellipse is tilted 45 deg.
            
            const vmPoints = [];
            for(let i=0; i<=360; i+=2) {
                const rad = i * Math.PI / 180;
                // Parametric eq for Von Mises Ellipse in principal stress space
                // major axis along x=y, minor along x=-y
                // Simplification for visualization:
                // x^2 - xy + y^2 = 1 (normalized)
                // x = (sqrt(2)/2) * (A cos t - B sin t)
                // y = (sqrt(2)/2) * (A cos t + B sin t)
                // A = sqrt(2) * Sy, B = sqrt(2/3) * Sy
                const A = Math.sqrt(2) * Sy;
                const B = Math.sqrt(2/3) * Sy;
                const x_val = (Math.sqrt(2)/2) * (A * Math.cos(rad) - B * Math.sin(rad));
                const y_val = (Math.sqrt(2)/2) * (A * Math.cos(rad) + B * Math.sin(rad));
                vmPoints.push({x: x_val, y: y_val});
            }

            // Tresca Hexagon
            const trPoints = [
                {x: Sy, y: 0}, {x: Sy, y: Sy}, {x: 0, y: Sy},
                {x: -Sy, y: 0}, {x: -Sy, y: -Sy}, {x: 0, y: -Sy}, {x: Sy, y: 0}
            ];

            // Point
            const userPoint = [{x: s1, y: s2}];
            
            // Limit Axes
            const maxVal = Math.max(Math.abs(s1), Math.abs(s2), Sy) * 1.5;

            window.myChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Von Mises (Yield)',
                            data: vmPoints,
                            borderColor: '#3B82F6',
                            showLine: true,
                            pointRadius: 0,
                            borderWidth: 2
                        },
                        {
                            label: 'Tresca (Yield)',
                            data: trPoints,
                            borderColor: '#10B981',
                            showLine: true,
                            pointRadius: 0,
                            borderWidth: 2,
                            borderDash: [5,5]
                        },
                        {
                            label: 'Stress State',
                            data: userPoint,
                            backgroundColor: '#EF4444',
                            pointRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: 1,
                    scales: {
                        x: { 
                            title: {display:true, text:'Principal Stress σ1'},
                            min: -maxVal, max: maxVal,
                            grid: { color: '#e5e7eb' }
                        },
                        y: { 
                            title: {display:true, text:'Principal Stress σ2'},
                            min: -maxVal, max: maxVal,
                            grid: { color: '#e5e7eb' }
                        }
                    }
                }
            });
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(30, 58, 138); 
            pdf.text('Stress Analysis Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. Load Case', 14, y);
            y += 5;

            const inputData = [
                ['Material', document.getElementById('material-select').options[document.getElementById('material-select').selectedIndex].text],
                ['Yield Strength', `${lastResult.sy} ${lastResult.unit}`],
                ['Sigma X', lastResult.s1], // Actually inputs not s1
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. Safety Factors', 14, y);
            y += 5;

            const resData = [
                ['Principal 1', lastResult.s1.toFixed(1)],
                ['Principal 2', lastResult.s2.toFixed(1)],
                ['Von Mises Eqv', lastResult.s_vm.toFixed(1)],
                ['Safety Factor (VM)', lastResult.fos_vm.toFixed(2)]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] },
                didParseCell: function(data) {
                    if(data.row.index === 3) {
                        data.cell.styles.fontStyle = 'bold';
                    }
                }
            });

            pdf.save('Stress_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }
    </script>
</body>
</html>

