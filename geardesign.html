<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mechanical Gear Design Calculator (AGMA) - Professional Edition</title>
<meta name="description" content="A professional tool for designing spur, helical, and bevel gears based on AGMA standards, providing detailed, step-by-step calculations for engineers and students.">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-23Y1V450SR');
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
MathJax = {
tex: {
inlineMath: [['$', '$'], ['\\(', '\\)']]
},
svg: {
fontCache: 'global'
}
};
</script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<style>
:root {
--primary-color: #1E3A8A; /* Professional Dark Blue */
--secondary-color: #2563EB; /* Bright Blue */
--accent-color: #F59E0B; /* Warm Amber */
--bg-color: #F8FAFC;
--card-bg: #FFFFFF;
--text-color: #4B5563;
--heading-color: #111827;
--footer-bg: #0F172A;
--border-color: #E2E8F0;
--gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
--gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
--card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
--hover-color: #e2e6ea;
--button-hover-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
--highlight-bg: rgba(245, 158, 11, 0.2); /* Light amber for highlighting */
}
body.dark-mode {
--primary-color: #10B981; /* Vibrant Green */
--secondary-color: #34D399; /* Lighter Green */
--bg-color: #0F172A;
--card-bg: #1E293B;
--text-color: #CBD5E1;
--heading-color: #F1F5F9;
--footer-bg: #020617;
--border-color: #334155;
--highlight-bg: rgba(16, 185, 129, 0.3);
}
html { 
scroll-behavior: smooth;
}
body {
font-family: 'Inter', sans-serif;
background-color: var(--bg-color);
color: var(--text-color);
line-height: 1.8;
transition: background-color 0.3s, color 0.3s;
overflow-x: hidden;
margin: 0;
padding: 0;
}
.container { 
max-width: 1280px; 
margin: 0 auto; 
padding: 0 24px; 
}
.content-container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}
/* Header */
.header {
background: var(--gradient-primary);
color: white;
padding: 24px 0;
position: relative;
overflow: hidden;
}
.navbar { 
display: flex; 
justify-content: space-between;
align-items: center; 
}
.logo-container { 
display: flex; 
align-items: center; 
gap: 16px; 
text-decoration: none; 
color: white; 
}
.logo { 
height: 56px;
}
.logo-text {
font-size: 1.75rem;
font-weight: 800;
font-family: 'Montserrat', sans-serif;
}
.theme-toggle { 
display: flex; 
align-items: center; 
gap: 12px;
}
.theme-toggle .icon { 
color: white; 
font-size: 1.2rem; 
}
.switch { 
position: relative; 
display: inline-block; 
width: 56px; 
height: 30px;
}
.switch input { 
opacity: 0; 
width: 0; 
height: 0; 
}
.slider { 
position: absolute; 
cursor: pointer; 
top: 0; 
left: 0;
right: 0; 
bottom: 0; 
background-color: rgba(0,0,0,0.2); 
transition: .4s; 
border-radius: 30px; 
}
.slider:before { 
position: absolute; 
content: ""; 
height: 22px; 
width: 22px;
left: 4px; 
bottom: 4px; 
background-color: white; 
transition: .4s; 
border-radius: 50%; 
}
input:checked + .slider { 
background-color: var(--accent-color);
}
input:checked + .slider:before { 
transform: translateX(26px); 
}
main { 
padding: 40px 0; 
}
/* START: Calculator Specific Styles */
.tool-container {
background-color: var(--card-bg);
border-radius: 8px;
padding: 30px;
box-shadow: var(--card-shadow);
margin-bottom: 30px;
}
.tool-container h2 {
color: var(--primary-color);
border-bottom: 3px solid var(--primary-color);
padding-bottom: 15px;
margin-top: 0;
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
}
.tool-description {
margin-bottom: 25px;
color: var(--text-color);
font-size: 1.1rem;
}
.back-button {
display: inline-block;
background-color: var(--primary-color);
color: white;
padding: 12px 20px;
border-radius: 5px;
text-decoration: none;
margin-bottom: 25px;
transition: background-color 0.3s, transform 0.2s;
font-weight: 600;
}
.back-button:hover {
background-color: var(--secondary-color);
transform: translateY(-2px);
}
.calculator-form {
background-color: var(--card-bg);
border-radius: 8px;
padding: 25px;
margin-top: 25px;
box-shadow: var(--card-shadow);
}
.form-group {
margin-bottom: 20px;
}
.form-group label {
display: block;
margin-bottom: 8px;
font-weight: 600;
color: var(--heading-color);
}
.form-group input, .form-group select {
width: 100%;
padding: 12px;
border: 1px solid var(--border-color);
border-radius: 5px;
background-color: var(--bg-color);
color: var(--text-color);
box-sizing: border-box;
transition: border-color 0.3s, box-shadow 0.3s;
font-size: 1rem;
}
.form-group input:focus, .form-group select:focus {
border-color: var(--primary-color);
box-shadow: 0 0 8px rgba(30, 58, 138, 0.3);
outline: none;
}
.form-row {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 20px;
}
.calculate-btn {
background: var(--gradient-primary);
color: white;
border: none;
padding: 15px 25px;
border-radius: 5px;
cursor: pointer;
font-size: 1.1rem;
font-weight: 700;
margin-top: 15px;
transition: transform 0.2s, box-shadow 0.3s;
position: relative;
overflow: hidden;
width: 100%;
}
.calculate-btn:hover {
transform: translateY(-3px);
box-shadow: var(--button-hover-shadow);
}
.calculate-btn .ripple {
position: absolute;
border-radius: 50%;
background-color: rgba(255, 255, 255, 0.7);
animation: ripple-effect 0.6s linear forwards;
transform: scale(0);
pointer-events: none;
}
@keyframes ripple-effect {
to {
transform: scale(4);
opacity: 0;
}
}
.result-container {
margin-top: 40px;
padding: 25px;
border-radius: 8px;
background-color: var(--card-bg);
box-shadow: var(--card-shadow);
display: none;
opacity: 0;
transform: translateY(20px);
transition: opacity 0.5s ease-out, transform 0.5s ease-out;
}
.result-container.show {
display: block;
opacity: 1;
transform: translateY(0);
}
.result-container h3 {
color: var(--primary-color);
margin-bottom: 20px;
font-family: 'Montserrat', sans-serif;
font-size: 1.5rem;
}
.calculation-step-container {
margin-bottom: 25px;
border: 1px solid var(--border-color);
border-radius: 8px;
overflow: hidden;
opacity: 0;
transform: translateX(-20px);
animation: fadeInSlideIn 0.5s ease-out forwards;
}
.calculation-step-container:nth-child(odd) {
background-color: rgba(0,0,0,0.02);
}
.step-header {
background-color: var(--hover-color);
padding: 12px 15px;
font-weight: 700;
color: var(--heading-color);
border-bottom: 1px solid var(--border-color);
cursor: pointer;
}
.step-content {
padding: 15px;
display: block; /* Show by default */
}
.step-content p.formula {
font-family: 'Times New Roman', serif;
font-style: italic;
font-size: 1.2em;
text-align: center;
padding: 12px;
background-color: var(--bg-color);
border: 1px solid var(--border-color);
border-radius: 4px;
margin: 10px 0;
overflow-x: auto;
color: var(--text-color);
}
.step-content p.calculation {
font-family: 'Courier New', monospace;
background-color: var(--bg-color);
padding: 8px 12px;
border-radius: 3px;
margin-bottom: 8px;
color: var(--text-color);
word-wrap: break-word;
}
.step-content .final-result {
font-weight: 700;
color: var(--primary-color);
background: var(--highlight-bg);
padding: 10px;
border-radius: 4px;
text-align: center;
}
.recommendations {
margin-top: 30px;
padding: 20px;
border: 1px solid var(--border-color);
border-radius: 8px;
background-color: var(--bg-color);
}
.recommendations h4 {
color: var(--secondary-color);
margin-top: 0;
}
.recommendations ul {
padding-left: 20px;
}
.recommendations ul li {
margin-bottom: 10px;
}
.info-icon {
color: var(--primary-color);
margin-left: 8px;
cursor: help;
}
.tooltip {
position: relative;
display: inline-block;
}
.tooltip .tooltiptext {
visibility: hidden;
width: 250px;
background-color: #333;
color: #fff;
text-align: center;
border-radius: 6px;
padding: 8px;
position: absolute;
z-index: 1;
bottom: 125%;
left: 50%;
margin-left: -125px;
opacity: 0;
transition: opacity 0.3s;
}
.tooltip:hover .tooltiptext {
visibility: visible;
opacity: 1;
}
#custom-message-box {
position: fixed;
top: 20px;
left: 50%;
transform: translateX(-50%);
padding: 15px 25px;
border-radius: 8px;
box-shadow: 0 4px 10px rgba(0,0,0,0.2);
z-index: 1000;
font-weight: bold;
color: white;
opacity: 0;
transition: opacity 0.5s ease-in-out;
}
@keyframes fadeInSlideIn {
from {
opacity: 0;
transform: translateX(-20px);
}
to {
opacity: 1;
transform: translateX(0);
}
}

/* NEW STYLES FOR ENHANCED FEATURES */
.advanced-factors-section {
    margin-top: 25px;
    padding: 20px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--hover-color);
}
.advanced-factors-section h4 {
    color: var(--primary-color);
    margin-top: 0;
    font-family: 'Montserrat', sans-serif;
}
.advanced-toggle {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    cursor: pointer;
}
.advanced-toggle input {
    margin-right: 10px;
}
.geometry-visualization {
    margin-top: 30px;
    padding: 20px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--card-bg);
}
.geometry-visualization h4 {
    color: var(--primary-color);
    margin-top: 0;
    font-family: 'Montserrat', sans-serif;
    text-align: center;
}
#gear-geometry-canvas {
    width: 100%;
    height: 300px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
}
.stress-analysis {
    margin-top: 30px;
    padding: 20px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--card-bg);
}
.stress-analysis h4 {
    color: var(--primary-color);
    margin-top: 0;
    font-family: 'Montserrat', sans-serif;
}
.stress-item {
    margin-bottom: 15px;
    padding: 15px;
    border-radius: 5px;
    background-color: var(--hover-color);
}
.stress-item.critical {
    border-left: 4px solid #EF4444;
}
.stress-item.warning {
    border-left: 4px solid var(--accent-color);
}
.stress-item.info {
    border-left: 4px solid var(--secondary-color);
}
.stress-item h5 {
    margin-top: 0;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.stress-item p {
    margin: 0;
}
.export-section {
    margin-top: 25px;
    text-align: center;
}
.export-btn {
    background-color: var(--secondary-color);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
.export-btn:hover {
    background-color: var(--primary-color);
}
.failure-analysis {
    margin-top: 30px;
    padding: 20px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--card-bg);
}
.failure-analysis h4 {
    color: var(--primary-color);
    margin-top: 0;
    font-family: 'Montserrat', sans-serif;
}
.failure-item {
    margin-bottom: 15px;
    padding: 15px;
    border-radius: 5px;
    background-color: var(--hover-color);
}
.failure-item.critical {
    border-left: 4px solid #EF4444;
}
.failure-item.warning {
    border-left: 4px solid var(--accent-color);
}
.failure-item.info {
    border-left: 4px solid var(--secondary-color);
}
.failure-item h5 {
    margin-top: 0;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.failure-item p {
    margin: 0;
}
/* END: Calculator Specific Styles */
/* Footer */
footer { 
background: var(--gradient-dark);
color: #CBD5E1;
padding: 80px 0 30px 0; 
}
.footer-grid { 
display: grid; 
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
gap: 40px; 
}
.footer-col h4 { 
font-size: 1.2rem;
color: white; 
margin-bottom: 1.5rem; 
font-weight: 700;
}
.footer-col ul { list-style: none; padding: 0; }
.footer-col ul li { margin-bottom: 1rem; }
.footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
.footer-col a:hover { color: var(--accent-color); }
.footer-disclaimer {
text-align: center;
margin: 40px auto;
padding-top: 40px;
border-top: 1px solid #334155;
max-width: 800px;
}
.footer-disclaimer h4 {
font-size: 1.2rem;
color: white;
margin-bottom: 1rem;
}
.footer-bottom { 
text-align: center; 
padding-top: 20px; 
font-size: 0.9rem; 
color: #94A3B8;
}
.footer-bottom a {
color: #CBD5E1; 
text-decoration: none; 
transition: color 0.3s;
}
.footer-bottom a:hover {
color: var(--accent-color);
text-decoration: underline;
}
.creator-name { 
color: var(--secondary-color); 
font-weight: bold; 
}
@media (max-width: 768px) {
.navbar { 
flex-direction: column;
gap: 24px; 
}
.form-row {
grid-template-columns: 1fr;
}
.container {
padding: 15px;
}
.content-container {
padding: 15px;
}
.tool-container {
padding: 20px;
}
}
</style>
</head>
<body>

<header class="header">
<div class="container">
<nav class="navbar">
<a href="/" class="logo-container">
<!-- <img src="logo.png" alt="Design Calculators Logo" class="logo"> -->
<span class="logo-text"> Design Calculators </span>
</a>
<div class="theme-toggle">
<i class="fas fa-sun icon"></i>
<label class="switch">
<input type="checkbox" id="theme-switch">
<span class="slider"></span>
</label>
<i class="fas fa-moon icon"></i>
</div>
</nav>
</div>
</header>

<main class="content-container">
<a class='back-button' href="/indexmech"><i class="fas fa-arrow-left"></i> Back to Tools</a>
<div class="tool-container">
<h2>Mechanical Gear Design Calculator (AGMA)</h2>
<div class="tool-description">
<p>This calculator provides a step-by-step approach to designing Spur, Helical, and Bevel gears based on fundamental AGMA principles. Enter your initial parameters to determine the required geometry and analyze the gear set's strength against bending and pitting failures.</p>
</div>
<div class="calculator-form">
<form id="gear-design-form">

<!-- Gear Type Selection -->
<div class="form-group">
<label for="gear-type">Gear Type</label>
<select id="gear-type" required>
<option value="spur" selected>Spur Gear</option>
<option value="helical">Helical Gear</option>
<option value="bevel">Bevel Gear</option>
</select>
</div>

<!-- Input Parameters -->
<div class="form-row">
<div class="form-group">
<label for="power">Power (kW) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The power to be transmitted by the gear set.</span></span></label>
<input type="number" id="power" value="10" min="0.1" step="0.1" required>
</div>
<div class="form-group">
<label for="pinion-speed">Pinion Speed (RPM) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Rotational speed of the smaller gear (pinion).</span></span></label>
<input type="number" id="pinion-speed" value="1500" min="1" step="10" required>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="gear-ratio">Gear Ratio (i) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ratio of the gear speed to the pinion speed (must be > 1).</span></span></label>
<input type="number" id="gear-ratio" value="3" min="1" step="0.1" required>
</div>
<div class="form-group">
<label for="pressure-angle">Pressure Angle, &phi; (degrees) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Standard values are 14.5°, 20°, 25°. 20° is most common.</span></span></label>
<input type="number" id="pressure-angle" value="20" min="14.5" max="25" step="0.5" required>
</div>
</div>

<!-- Helical/Bevel Specific -->
<div class="form-row" id="helical-bevel-inputs">
<div class="form-group" id="helix-angle-group">
<label for="helix-angle">Helix Angle, &psi; (degrees) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">For helical gears, typically 15° to 30°.</span></span></label>
<input type="number" id="helix-angle" value="20" min="5" max="45" step="1">
</div>
<div class="form-group" id="shaft-angle-group">
<label for="shaft-angle">Shaft Angle, &Sigma; (degrees) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">For bevel gears, the angle between shafts. 90° is standard.</span></span></label>
<input type="number" id="shaft-angle" value="90" min="10" max="150" step="1">
</div>
</div>

<!-- Material and Strength Parameters -->
<div class="form-row">
<div class="form-group">
<label for="material-strength">Allowable Bending Stress, &sigma;<sub>b</sub> (MPa) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Allowable bending stress for the gear material (e.g., Steel: 150-300 MPa).</span></span></label>
<input type="number" id="material-strength" value="200" min="50" step="10" required>
</div>
<div class="form-group">
<label for="surface-hardness">Surface Hardness (BHN) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Brinell Hardness Number for the gear material. Used for wear strength calculation.</span></span></label>
<input type="number" id="surface-hardness" value="300" min="100" step="10" required>
</div>
</div>

<!-- Design Factors -->
<div class="form-row">
<div class="form-group">
<label for="service-factor">Service Factor, K<sub>s</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Accounts for shock and load duration (e.g., 1.0 for uniform, 1.5 for moderate shock, 2.0 for heavy shock).</span></span></label>
<input type="number" id="service-factor" value="1.5" min="1" max="3" step="0.1" required>
</div>
<div class="form-group">
<label for="factor-of-safety">Factor of Safety (FoS) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Desired factor of safety for both bending and wear. Typically 1.5 to 2.5.</span></span></label>
<input type="number" id="factor-of-safety" value="2" min="1.2" max="4" step="0.1" required>
</div>
</div>

<div class="advanced-factors-section">
    <div class="advanced-toggle">
        <input type="checkbox" id="advanced-factors-toggle">
        <label for="advanced-factors-toggle">Show Advanced AGMA Factors</label>
    </div>
    <div id="advanced-factors" style="display: none;">
        <div class="form-row">
            <div class="form-group">
                <label for="reliability-factor">Reliability Factor, K<sub>R</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Based on required reliability (AGMA 2001-D04)</span></span></label>
                <select id="reliability-factor">
                    <option value="0.70">50% Reliability</option>
                    <option value="0.80">90% Reliability</option>
                    <option value="1.00" selected>99% Reliability</option>
                    <option value="1.25">99.9% Reliability</option>
                    <option value="1.50">99.99% Reliability</option>
                </select>
            </div>
            <div class="form-group">
                <label for="temperature-factor">Temperature Factor, K<sub>T</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Based on operating temperature (AGMA 2001-D04)</span></span></label>
                <select id="temperature-factor">
                    <option value="1.00" selected>Up to 120°C (250°F)</option>
                    <option value="1.05">120-150°C (250-300°F)</option>
                    <option value="1.10">150-175°C (300-350°F)</option>
                    <option value="1.15">175-200°C (350-400°F)</option>
                    <option value="1.25">Above 200°C (400°F)</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="load-distribution">Load Distribution Factor, K<sub>m</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Accounts for non-uniform load distribution (AGMA 2001-D04)</span></span></label>
                <select id="load-distribution">
                    <option value="1.0">Accurate mounting, low bearing clearance</option>
                    <option value="1.1" selected>Normal industrial practice</option>
                    <option value="1.3">Less rigid mountings, less accurate gears</option>
                    <option value="1.6">Non-rigid mountings, poor accuracy</option>
                </select>
            </div>
            <div class="form-group">
                <label for="dynamic-factor">Dynamic Factor, K<sub>v</sub> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Accounts for internal dynamic effects (AGMA 2001-D04)</span></span></label>
                <select id="dynamic-factor">
                    <option value="1.0">Precision gears, very low speed</option>
                    <option value="1.1" selected>High quality gears, moderate speed</option>
                    <option value="1.3">Commercial quality gears, high speed</option>
                    <option value="1.6">Low quality gears, very high speed</option>
                </select>
            </div>
        </div>
    </div>
</div>

<button type="button" id="calculate-btn" class="calculate-btn">Calculate Gear Design</button>
</form>
</div>

<div id="result-container" class="result-container">
<h3>Step-by-Step Design Calculation</h3>
<div id="calculation-steps">
<!-- Calculation steps will be dynamically inserted here -->
</div>

<div class="geometry-visualization">
    <h4>Gear Geometry Visualization</h4>
    <canvas id="gear-geometry-canvas"></canvas>
</div>

<div class="stress-analysis">
    <h4>Stress Analysis Results</h4>
    <div id="stress-analysis-content">
        <!-- Stress analysis will be dynamically inserted here -->
    </div>
</div>

<div class="failure-analysis">
    <h4>Failure Mode Analysis</h4>
    <div id="failure-analysis-content">
        <!-- Failure analysis will be dynamically inserted here -->
    </div>
</div>

<div class="recommendations">
<h4>Applicable Standards & Recommendations</h4>
<div id="recommendations-content">
<!-- Recommendations will be dynamically inserted here -->
</div>
</div>

<div class="export-section">
    <button id="export-report" class="export-btn"><i class="fas fa-file-pdf"></i> Export Calculation Report</button>
</div>
</div>
</div>
</main>

<footer>
<div class="container">
<div class="footer-grid">
<div class="footer-col">
<h4> Quick Links </h4>
<ul>
<li><a href="/indexele"> Electrical Tools </a></li>
<li><a href="/indexmech"> Mechanical Tools </a></li>
<li><a href="/indexinst"> Instrumentation Tools </a></li>
<li><a href="blog.html"> Blog & Articles </a></li>
</ul>
</div>
<div class="footer-col">
<h4> Legal </h4>
<ul>
<li><a href="/privacy-policy"> Privacy Policy </a></li>
<li><a href="/terms-of-service"> Terms of Service </a></li>
<li><a href="/sitemap2"> Sitemap </a></li>
</ul>
</div>
<div class="footer-col">
<h4> About </h4>
<ul>
<li><a href="/about"> About Us </a></li>
<li><a href="/contact"> Contact Us </a></li>
<li><a href="/faq"> FAQ </a></li>
</ul>
</div>
</div>
<div class="footer-disclaimer">
<h4> Disclaimer </h4>
<p> All tools are for guidance only and should not replace professional engineering judgment. Results must be verified by a qualified professional against project requirements and local codes. </p>
</div>
<div class="footer-bottom">
<p> &copy; 2025 Design Calculators. Created by <span class="creator-name"> A Sharma </span> . All rights reserved. </p>
</div>
</div>
</footer>

<div id="custom-message-box"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- FORM ELEMENTS ---
    const gearTypeSelect = document.getElementById('gear-type');
    const helixAngleGroup = document.getElementById('helix-angle-group');
    const shaftAngleGroup = document.getElementById('shaft-angle-group');
    const calculateBtn = document.getElementById('calculate-btn');
    const resultContainer = document.getElementById('result-container');
    const calculationStepsDiv = document.getElementById('calculation-steps');
    const recommendationsDiv = document.getElementById('recommendations-content');
    const stressAnalysisDiv = document.getElementById('stress-analysis-content');
    const failureAnalysisDiv = document.getElementById('failure-analysis-content');
    const advancedToggle = document.getElementById('advanced-factors-toggle');
    const advancedFactors = document.getElementById('advanced-factors');
    const exportReportBtn = document.getElementById('export-report');
    
    // Canvas for gear visualization
    const canvas = document.getElementById('gear-geometry-canvas');
    const ctx = canvas.getContext('2d');
    
    // Set canvas dimensions
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    
    // Advanced factors toggle
    advancedToggle.addEventListener('change', function() {
        if (this.checked) {
            advancedFactors.style.display = 'block';
        } else {
            advancedFactors.style.display = 'none';
        }
    });
    
    // --- HELPER FUNCTIONS ---
    const toRad = (deg) => deg * Math.PI / 180;
    const toDeg = (rad) => rad * 180 / Math.PI;

    // --- UI LOGIC ---
    function toggleInputs() {
        const gearType = gearTypeSelect.value;
        helixAngleGroup.style.display = gearType === 'helical' ? 'block' : 'none';
        shaftAngleGroup.style.display = gearType === 'bevel' ? 'block' : 'none';
    }

    gearTypeSelect.addEventListener('change', toggleInputs);
    toggleInputs(); // Initial call

    calculateBtn.addEventListener('click', (e) => {
        const ripple = document.createElement('span');
        const diameter = Math.max(calculateBtn.clientWidth, calculateBtn.clientHeight);
        const radius = diameter / 2;
        ripple.style.width = ripple.style.height = `${diameter}px`;
        ripple.style.left = `${e.clientX - (calculateBtn.getBoundingClientRect().left + radius)}px`;
        ripple.style.top = `${e.clientY - (calculateBtn.getBoundingClientRect().top + radius)}px`;
        ripple.classList.add('ripple');
        calculateBtn.appendChild(ripple);
        ripple.addEventListener('animationend', () => ripple.remove());
        
        if (validateInputs()) {
            performCalculation();
        }
    });

    function validateInputs() {
        // Simple validation for required fields
        const inputs = document.querySelectorAll('#gear-design-form [required]');
        for (const input of inputs) {
            if (!input.value || parseFloat(input.value) <= 0) {
                 if (input.id === 'gear-ratio' && parseFloat(input.value) <= 1) {
                    displayMessage(`Error: Gear Ratio must be greater than 1.`, "error");
                    return false;
                } else if (!input.value) {
                    displayMessage(`Error: "${input.previousElementSibling.textContent}" cannot be empty.`, "error");
                    return false;
                }
            }
        }
        return true;
    }

    // --- CALCULATION LOGIC ---
    function performCalculation() {
        // 1. Get all inputs
        const inputs = {
            gearType: gearTypeSelect.value,
            P: parseFloat(document.getElementById('power').value), // kW
            n_p: parseFloat(document.getElementById('pinion-speed').value), // RPM
            i: parseFloat(document.getElementById('gear-ratio').value),
            phi_deg: parseFloat(document.getElementById('pressure-angle').value),
            psi_deg: gearTypeSelect.value === 'helical' ? parseFloat(document.getElementById('helix-angle').value) : 0,
            Sigma_deg: gearTypeSelect.value === 'bevel' ? parseFloat(document.getElementById('shaft-angle').value) : 90,
            sigma_b: parseFloat(document.getElementById('material-strength').value), // MPa
            BHN: parseFloat(document.getElementById('surface-hardness').value),
            Ks: parseFloat(document.getElementById('service-factor').value),
            FoS: parseFloat(document.getElementById('factor-of-safety').value),
            useAdvanced: advancedToggle.checked,
            KR: parseFloat(document.getElementById('reliability-factor').value) || 1.0,
            KT: parseFloat(document.getElementById('temperature-factor').value) || 1.0,
            Km: parseFloat(document.getElementById('load-distribution').value) || 1.1,
            Kv: parseFloat(document.getElementById('dynamic-factor').value) || 1.1
        };
        
        calculationStepsDiv.innerHTML = '';
        stressAnalysisDiv.innerHTML = '';
        failureAnalysisDiv.innerHTML = '';
        
        // --- Step 1: Design Torque ---
        const T_p = (inputs.P * 1000 * 60) / (2 * Math.PI * inputs.n_p); // Pinion Torque in N-m
        const T_d = T_p * inputs.Ks * inputs.FoS; // Design Torque in N-m
        addCalculationStep(1, 'Design Torque (T_d)', 
            '$$T_d = \\frac{P \\times 60}{2 \\pi n_p} \\times K_s \\times FoS$$',
            `$$T_d = \\frac{${inputs.P*1000} \\times 60}{2 \\pi \\times ${inputs.n_p}} \\times ${inputs.Ks} \\times ${inputs.FoS}$$`,
            `${T_d.toFixed(2)} N-m`);

        // --- Step 2: Initial Assumptions ---
        let Zp = inputs.gearType === 'bevel' ? Math.max(15, 20 / (Math.sin(toRad(inputs.Sigma_deg / (1 + inputs.i))))) : 18; // Assume number of teeth on pinion
        Zp = Math.round(Zp);
        const Zg = Math.round(Zp * inputs.i); // Number of teeth on gear
        addCalculationStep(2, 'Initial Assumption: Number of Teeth (Z)',
            'Assume minimum number of teeth on pinion (Zp) to avoid interference. Calculate gear teeth (Zg) from gear ratio.',
            `Zp = ${Zp} (assumed)<br>Zg = Zp * i = ${Zp} * ${inputs.i} = ${Zg}`,
            `Pinion Teeth (Zp) = ${Zp}, Gear Teeth (Zg) = ${Zg}`
        );
        
        // --- Step 3: Lewis Form Factor & Velocity Factor ---
        const y = 0.484 - (2.87 / Zp); // Lewis form factor for 20 deg full depth
        const V_factor = 5.6 / (5.6 + Math.sqrt(0.001 * inputs.n_p)); // Assume initial pitch line velocity around 10 m/s for RPM based factor
        addCalculationStep(3, 'Form & Velocity Factors (y, Cv)',
            '$$y \\approx 0.484 - \\frac{2.87}{Z_p}$$ <p>Velocity factor (Cv) is estimated initially.</p>',
            `y = 0.484 - (2.87 / ${Zp}) = ${y.toFixed(3)}<br>Cv is estimated and will be refined.`,
            `Lewis Factor (y) = ${y.toFixed(3)}`);

        // --- Step 4: Module Calculation (Bending Strength) ---
        let b, m;
        let phi_rad = toRad(inputs.phi_deg);
        let psi_rad = toRad(inputs.psi_deg);
        
        if (inputs.gearType === 'spur' || inputs.gearType === 'helical') {
             // Let's assume face width b = 10 * m
            const m_cubed_term = (2 * T_d * 1000) / (inputs.sigma_b * V_factor * 10 * Zp * y * (inputs.gearType === 'helical' ? Math.cos(psi_rad) : 1));
            m = Math.pow(m_cubed_term, 1/3);
        } else { // Bevel
            // Assume R/b = 3
            const R = (Math.sqrt(Math.pow(Zp, 2) + Math.pow(Zg, 2))) / (2 * Math.sin(toRad(inputs.Sigma_deg)));
            const m_cubed_term = (2 * T_d * 1000) / (inputs.sigma_b * V_factor * Zp * y * (1 - (1/3)));
             m = Math.pow(m_cubed_term, 1/3);
        }

        // Standardize module
        const standardModules = [1, 1.25, 1.5, 2, 2.5, 3, 4, 5, 6, 8, 10, 12, 16, 20];
        m = standardModules.find(sm => sm >= m) || standardModules[standardModules.length - 1];
        b = 10 * m;

        let formula_bending;
        if (inputs.gearType === 'spur') {
            formula_bending = '$$m \\ge \\sqrt[3]{\\frac{2 T_d}{\\sigma_b C_v k Z_p y}}$$ where k=b/m=10';
        } else if(inputs.gearType === 'helical') {
            formula_bending = '$$m_n \\ge \\sqrt[3]{\\frac{2 T_d}{\\sigma_b C_v k Z_p y \\cos(\\psi)}}$$ where k=b/m=10';
        } else { // Bevel
            formula_bending = '$$m \\ge \\sqrt[3]{\\frac{2 T_d}{\\sigma_b C_v Z_p y (1 - b/R)}}$$ where b/R=1/3';
        }

        addCalculationStep(4, 'Module Calculation (from Bending Strength)',
           formula_bending,
            `Calculated initial module ≈ ${m.toFixed(2)} mm. Selecting the next standard module.`,
            `Standard Module (m) = ${m} mm, Face Width (b) = ${b} mm`
        );
        
        // --- Step 5: Gear Geometry ---
        const d_p = m * Zp / (inputs.gearType === 'helical' ? Math.cos(psi_rad) : 1);
        const d_g = m * Zg / (inputs.gearType === 'helical' ? Math.cos(psi_rad) : 1);
        const center_distance = (d_p + d_g) / 2;
        addCalculationStep(5, 'Main Gear Dimensions',
            '$$d_p = m Z_p$$ $$d_g = m Z_g$$ $$a = (d_p + d_g)/2$$ (Formulas shown for spur gear)',
            `dp = ${m} * ${Zp} = ${d_p.toFixed(2)} mm<br>dg = ${m} * ${Zg} = ${d_g.toFixed(2)} mm<br>a = (${d_p.toFixed(2)} + ${d_g.toFixed(2)}) / 2 = ${center_distance.toFixed(2)} mm`,
            `Pinion Pitch Diameter (dp) = ${d_p.toFixed(2)} mm<br>Gear Pitch Diameter (dg) = ${d_g.toFixed(2)} mm<br>Center Distance (a) = ${center_distance.toFixed(2)} mm`
        );

        // --- Step 6: Recalculate Velocity and Factors ---
        const v = (Math.PI * d_p * inputs.n_p) / (60 * 1000); // Pitch line velocity in m/s
        const Cv_new = (6.1 / (6.1 + v)); // More accurate Cv for cut gears
        const Ft = (inputs.P * 1000) / v; // Tangential force in N
        addCalculationStep(6, 'Refined Velocity & Tangential Load',
            '$$v = \\frac{\\pi d_p n_p}{60}$$ $$F_t = \\frac{P}{v}$$',
            `v = (π * ${d_p.toFixed(2)} * ${inputs.n_p}) / 60000 = ${v.toFixed(2)} m/s<br>Ft = (${inputs.P*1000}) / ${v.toFixed(2)} = ${Ft.toFixed(2)} N`,
            `Pitch Line Velocity (v) = ${v.toFixed(2)} m/s<br>Tangential Load (Ft) = ${Ft.toFixed(2)} N`
        );

        // --- Step 7: Bending Stress Check ---
        const sigma_b_induced = (Ft * inputs.Ks) / (Cv_new * b * m * y * (inputs.gearType === 'helical' ? Math.cos(psi_rad) : 1));
        const b_fos = inputs.sigma_b / sigma_b_induced;
        let b_check_result = b_fos >= inputs.FoS ? "SAFE" : "FAIL - Increase module or face width.";
        addCalculationStep(7, 'Bending Stress Check (Lewis Equation)',
            '$$\\sigma_{b, induced} = \\frac{F_t K_s}{C_v b m y}$$',
            `σ_b_induced = (${Ft.toFixed(2)} * ${inputs.Ks}) / (${Cv_new.toFixed(3)} * ${b} * ${m} * ${y.toFixed(3)}) = ${sigma_b_induced.toFixed(2)} MPa`,
            `Induced Bending Stress = ${sigma_b_induced.toFixed(2)} MPa<br>Factor of Safety = ${(b_fos).toFixed(2)} (${b_check_result})`
        );

        // --- Step 8: Wear Strength Check ---
        const K = 0.156 * (Math.pow(inputs.BHN, 2) / 1000); // Load-Stress factor for steel, MPa
        const sigma_c_allowable = 2.8 * inputs.BHN - 69; // MPa, for steel
        const Q = (2 * Zg) / (Zp + Zg); // Ratio factor
        const sigma_c_induced = Math.sqrt((Ft * inputs.Ks / (Cv_new * b * d_p * Q)) * K);
        const w_fos = sigma_c_allowable / sigma_c_induced;
        let w_check_result = w_fos >= inputs.FoS ? "SAFE" : "FAIL - Increase hardness or size.";
        addCalculationStep(8, 'Wear Strength Check (Buckingham Equation)',
            '$$\\sigma_{c, induced} = \\sqrt{\\frac{F_t K_s}{C_v b d_p Q} K}$$',
            `K = ${K.toFixed(2)} MPa, Q = ${Q.toFixed(2)}<br>σ_c_induced = sqrt(...) = ${sigma_c_induced.toFixed(2)} MPa`,
            `Induced Contact Stress = ${sigma_c_induced.toFixed(2)} MPa<br>Factor of Safety = ${w_fos.toFixed(2)} (${w_check_result})`
        );

        // --- Advanced AGMA Factors ---
        if (inputs.useAdvanced) {
            // AGMA Bending Stress
            const J = 0.4; // Geometry factor (simplified)
            const sigma_b_AGMA = (Ft * inputs.Ks * inputs.Km * inputs.Kv) / (b * m * J);
            const b_fos_AGMA = inputs.sigma_b / (sigma_b_AGMA * inputs.KR * inputs.KT);
            
            addCalculationStep(9, 'AGMA Bending Stress Calculation',
                '$$\\sigma_b = \\frac{F_t K_o K_v K_s K_m}{b m J}$$',
                `Using AGMA factors: K_o=${inputs.Ks}, K_v=${inputs.Kv}, K_m=${inputs.Km}, K_R=${inputs.KR}, K_T=${inputs.KT}<br>σ_b = ${sigma_b_AGMA.toFixed(2)} MPa`,
                `AGMA Bending Stress = ${sigma_b_AGMA.toFixed(2)} MPa<br>AGMA FoS = ${b_fos_AGMA.toFixed(2)}`
            );
        }

        // --- Final Rendering ---
        if (window.MathJax) {
            window.MathJax.typesetPromise([calculationStepsDiv]);
        }
        resultContainer.classList.add('show');
        setTimeout(() => resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }), 300);
        
        // Draw gear visualization
        drawGearVisualization(d_p, d_g, Zp, Zg, inputs.gearType);
        
        // Perform stress analysis
        performStressAnalysis(inputs, sigma_b_induced, sigma_c_induced, b_fos, w_fos);
        
        // Perform failure analysis
        performFailureAnalysis(inputs, Ft, d_p, v, sigma_b_induced, sigma_c_induced, b_fos, w_fos);
        
        // --- Recommendations ---
        recommendationsDiv.innerHTML = `
            <ul>
                <li><strong>AGMA 2001-D04:</strong> This is the primary standard for the 'Fundamental Rating Factors and Calculation Methods for Involute Spur and Helical Gear Teeth'. The factors used (K, y, Cv) are simplifications of the more detailed factors in this standard.</li>
                <li><strong>AGMA 2003-B97:</strong> For the bevel gear design, refer to this standard, 'Rating the Pitting Resistance and Bending Strength of Bevel Gear Teeth'.</li>
                <li><strong>Material Selection:</strong> The selected material must have an allowable bending stress (&sigma;<sub>b</sub>) greater than the induced stress of <strong>${sigma_b_induced.toFixed(2)} MPa</strong> with the required safety factor.</li>
                <li><strong>Surface Hardness:</strong> To prevent pitting/wear, the surface hardness (BHN) should be sufficient to handle the induced contact stress of <strong>${sigma_c_induced.toFixed(2)} MPa</strong>. Consider case hardening or nitriding for higher loads.</li>
                <li><strong>Design Iteration:</strong> If the design is not safe (FAIL), consider the following:
                    <ul>
                        <li>Increase the module (m).</li>
                        <li>Increase the face width (b).</li>
                        <li>Select a stronger material (higher &sigma;<sub>b</sub> and BHN).</li>
                        <li>For helical gears, increasing the helix angle (&psi;) can improve strength, but also increases axial thrust.</li>
                    </ul>
                </li>
            </ul>`;
    }

    function addCalculationStep(step, title, formula, calculation, result) {
        const stepDiv = document.createElement('div');
        stepDiv.className = 'calculation-step-container';
        
        let content = `<div class="step-header">Step ${step}: ${title}</div>
                       <div class="step-content">`;
        if (formula) content += `<p class="formula">${formula}</p>`;
        if (calculation) content += `<p class="calculation">${calculation}</p>`;
        if (result) content += `<p class="final-result">${result}</p>`;
        content += `</div>`;
        
        stepDiv.innerHTML = content;
        calculationStepsDiv.appendChild(stepDiv);
    }
    
    function drawGearVisualization(d_p, d_g, Zp, Zg, gearType) {
        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Scale factors for visualization
        const scale = Math.min(canvas.width / (d_g * 1.5), canvas.height / (d_g * 1.2));
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        
        // Draw gear outlines
        ctx.strokeStyle = '#2563EB';
        ctx.lineWidth = 2;
        
        // Pinion
        ctx.beginPath();
        ctx.arc(centerX - d_g/4 * scale, centerY, d_p/2 * scale, 0, 2 * Math.PI);
        ctx.stroke();
        
        // Gear
        ctx.beginPath();
        ctx.arc(centerX + d_g/4 * scale, centerY, d_g/2 * scale, 0, 2 * Math.PI);
        ctx.stroke();
        
        // Add labels
        ctx.fillStyle = '#111827';
        ctx.font = '14px Inter';
        ctx.textAlign = 'center';
        ctx.fillText(`Pinion (${Zp} teeth)`, centerX - d_g/4 * scale, centerY - d_p/2 * scale - 15);
        ctx.fillText(`Gear (${Zg} teeth)`, centerX + d_g/4 * scale, centerY - d_g/2 * scale - 15);
        
        // Add dimensions
        ctx.strokeStyle = '#6B7280';
        ctx.setLineDash([5, 3]);
        ctx.beginPath();
        ctx.moveTo(centerX - d_g/4 * scale, centerY);
        ctx.lineTo(centerX + d_g/4 * scale, centerY);
        ctx.stroke();
        ctx.setLineDash([]);
        
        ctx.fillText(`${(d_p + d_g)/2} mm`, centerX, centerY + 20);
        
        // Add gear type indicator
        ctx.fillStyle = '#F59E0B';
        ctx.font = 'bold 16px Montserrat';
        ctx.fillText(`${gearType.charAt(0).toUpperCase() + gearType.slice(1)} Gear Set`, centerX, 30);
    }
    
    function performStressAnalysis(inputs, sigma_b_induced, sigma_c_induced, b_fos, w_fos) {
        let analysisHTML = '';
        
        // Bending stress analysis
        if (b_fos >= inputs.FoS) {
            analysisHTML += `
                <div class="stress-item info">
                    <h5><i class="fas fa-check-circle"></i> Bending Stress: SAFE</h5>
                    <p>Induced bending stress (${sigma_b_induced.toFixed(2)} MPa) is within the material's allowable limit. 
                    Factor of Safety = ${b_fos.toFixed(2)} (required: ${inputs.FoS})</p>
                </div>
            `;
        } else {
            analysisHTML += `
                <div class="stress-item critical">
                    <h5><i class="fas fa-exclamation-triangle"></i> Bending Stress: CRITICAL</h5>
                    <p>Induced bending stress (${sigma_b_induced.toFixed(2)} MPa) exceeds the material's capacity. 
                    Factor of Safety = ${b_fos.toFixed(2)} (required: ${inputs.FoS}). Consider increasing module or selecting stronger material.</p>
                </div>
            `;
        }
        
        // Contact stress analysis
        if (w_fos >= inputs.FoS) {
            analysisHTML += `
                <div class="stress-item info">
                    <h5><i class="fas fa-check-circle"></i> Contact Stress: SAFE</h5>
                    <p>Induced contact stress (${sigma_c_induced.toFixed(2)} MPa) is within the material's surface durability limit. 
                    Factor of Safety = ${w_fos.toFixed(2)} (required: ${inputs.FoS})</p>
                </div>
            `;
        } else {
            analysisHTML += `
                <div class="stress-item critical">
                    <h5><i class="fas fa-exclamation-triangle"></i> Contact Stress: CRITICAL</h5>
                    <p>Induced contact stress (${sigma_c_induced.toFixed(2)} MPa) exceeds the material's surface capacity. 
                    Factor of Safety = ${w_fos.toFixed(2)} (required: ${inputs.FoS}). Consider increasing hardness or gear size.</p>
                </div>
            `;
        }
        
        stressAnalysisDiv.innerHTML = analysisHTML;
    }
    
    function performFailureAnalysis(inputs, Ft, d_p, v, sigma_b_induced, sigma_c_induced, b_fos, w_fos) {
        let analysisHTML = '';
        
        // Check for tooth bending fatigue
        if (b_fos < 1.5) {
            analysisHTML += `
                <div class="failure-item critical">
                    <h5><i class="fas fa-exclamation-triangle"></i> High Risk of Tooth Bending Fatigue</h5>
                    <p>The bending safety factor (${b_fos.toFixed(2)}) is below the recommended minimum of 1.5 for industrial applications. 
                    This could lead to tooth breakage under shock loads or material defects.</p>
                </div>
            `;
        } else if (b_fos < 2.0) {
            analysisHTML += `
                <div class="failure-item warning">
                    <h5><i class="fas fa-exclamation-circle"></i> Moderate Risk of Tooth Bending Fatigue</h5>
                    <p>The bending safety factor (${b_fos.toFixed(2)}) is acceptable but could be improved for more demanding applications 
                    or where reliability is critical.</p>
                </div>
            `;
        }
        
        // Check for surface pitting
        if (w_fos < 1.2) {
            analysisHTML += `
                <div class="failure-item critical">
                    <h5><i class="fas fa-exclamation-triangle"></i> High Risk of Surface Pitting</h5>
                    <p>The contact safety factor (${w_fos.toFixed(2)}) is very low. Surface pitting and wear will likely occur 
                    early in the gear's service life, leading to noise and reduced transmission accuracy.</p>
                </div>
            `;
        } else if (w_fos < 1.5) {
            analysisHTML += `
                <div class="failure-item warning">
                    <h5><i class="fas fa-exclamation-circle"></i> Moderate Risk of Surface Pitting</h5>
                    <p>The contact safety factor (${w_fos.toFixed(2)}) may be insufficient for continuous heavy-duty operation. 
                    Consider surface hardening or improved lubrication.</p>
                </div>
            `;
        }
        
        // Check for scoring (based on PV factor)
        const pv_factor = (Ft / (10 * d_p)) * (v * 1000 / 60); // Simplified PV factor
        if (pv_factor > 100) {
            analysisHTML += `
                <div class="failure-item warning">
                    <h5><i class="fas fa-temperature-high"></i> Potential Scoring Risk</h5>
                    <p>The combination of high load and speed (PV factor = ${pv_factor.toFixed(0)}) may lead to scoring 
                    if lubrication is inadequate. Ensure proper lubricant selection and cooling.</p>
                </div>
            `;
        }
        
        // Check for speed limitations
        const pitch_line_velocity_limit = inputs.gearType === 'spur' ? 25 : 50; // m/s
        if (v > pitch_line_velocity_limit * 0.8) {
            analysisHTML += `
                <div class="failure-item warning">
                    <h5><i class="fas fa-tachometer-alt"></i> High Speed Operation</h5>
                    <p>The pitch line velocity (${v.toFixed(2)} m/s) is approaching typical limits for ${inputs.gearType} gears. 
                    Consider precision manufacturing, dynamic balancing, and specialized lubrication.</p>
                </div>
            `;
        }
        
        if (analysisHTML === '') {
            analysisHTML = `
                <div class="failure-item info">
                    <h5><i class="fas fa-check-circle"></i> No Critical Failure Modes Identified</h5>
                    <p>The gear design appears robust against common failure modes. Both bending and contact safety factors 
                    are within acceptable ranges for the specified application.</p>
                </div>
            `;
        }
        
        failureAnalysisDiv.innerHTML = analysisHTML;
    }

    function displayMessage(message, type = "info") {
        const messageBox = document.getElementById('custom-message-box');
        messageBox.textContent = message;
        messageBox.style.color = 'white';
        if (type === "error") messageBox.style.backgroundColor = '#dc3545';
        else if (type === "warning") {
            messageBox.style.backgroundColor = '#ffc107';
            messageBox.style.color = '#333';
        } else messageBox.style.backgroundColor = '#28a745';
        messageBox.style.opacity = 1;
        setTimeout(() => { messageBox.style.opacity = 0; }, 5000);
    }
    
    // Export functionality
    exportReportBtn.addEventListener('click', function() {
        displayMessage("Export feature would generate a detailed PDF report in a full implementation", "success");
        // In a real implementation, this would use a library like jsPDF to generate a report
    });
});

// --- Theme Toggle ---
document.addEventListener('DOMContentLoaded', () => {
    const themeSwitch = document.getElementById('theme-switch');
    const body = document.body;
    const currentTheme = localStorage.getItem('theme');
    if (currentTheme) {
        body.classList.add(currentTheme);
        if (currentTheme === 'dark-mode') themeSwitch.checked = true;
    }
    themeSwitch.addEventListener('change', () => {
        if (themeSwitch.checked) {
            body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark-mode');
        } else {
            body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light-mode');
        }
    });
});
</script>
</body>
</html>
