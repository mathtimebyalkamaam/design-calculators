<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLC Scan Time & PID Impact Calculator - Industrial Grade Analysis</title>
    <meta name="description" content="Professional PLC Scan Time Impact Calculator. Analyze the effect of Cycle Time, I/O Update Rate, and Jitter on PID Loop Stability. Calculate Phase Lag and Tuning degradation.">
    <meta name="keywords" content="PLC scan time, PID cycle time, phase lag calculator, control loop stability, digital control delay, jitter, nyquist aliasing, instrumentation, automation">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Exact Blue Scheme from Symmetrical Components) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Quick Load Buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .highlight { color: var(--success); font-weight: 700; }
        .danger-text { color: var(--danger); font-weight: 700; }

        /* Canvas Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Educational Section Styling */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .insight-card p, .insight-card ul {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text);
        }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(0,0,0,0.03);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid var(--success);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(255,255,255,0.05); }

        /* Vector Input Group Styling (Reused) */
        .vector-input-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Print Styling */
        @media print {
            header, footer, .education-section, .theme-toggle, .button-wrapper, .preset-container { display: none !important; }
            .card { border: none; shadow: none; padding: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 300px; page-break-inside: avoid; }
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-stopwatch"></i> PLC Scan Time & PID Impact Calculator</h2>
            
            <div class="tool-description">
                <p>This industrial-grade calculator quantifies the impact of <strong>PLC Scan Time</strong> and <strong>PID Update Rates</strong> on control loop performance. It calculates the <strong>Phase Lag</strong> introduced by digital latency, checks for <strong>Aliasing</strong> (Nyquist violation), estimates <strong>Max Safe Controller Gain ($K_{max}$)</strong> reduction, and evaluates <strong>Jitter</strong> effects on stability margins.</p>
            </div>

            <div class="calculator-form">
                <form id="scan-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('fast_flow')"><i class="fas fa-water"></i> Fast Flow Loop (20ms)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('slow_temp')"><i class="fas fa-thermometer-half"></i> Temperature Loop</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('pressure')"><i class="fas fa-tachometer-alt"></i> Pressure Control</button>
                            </div>
                        </div>
                    </div>

                    <!-- PLC & Loop Specs -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. Controller & Loop Configuration</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-microchip"></i> Controller Timing</div>
                            <div class="form-group">
                                <label for="scan-time">PLC Scan Time ($T_{scan}$) [ms]</label>
                                <input type="number" id="scan-time" value="20" step="1">
                            </div>
                            <div class="form-group" style="margin-top: 10px;">
                                <label for="pid-update">PID Update Rate ($T_{s}$) [ms]</label>
                                <input type="number" id="pid-update" value="100" step="10">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-sync"></i> Execution Type</div>
                            <div class="form-group">
                                <label for="task-type">Task Class</label>
                                <select id="task-type">
                                    <option value="cyclic" selected>Cyclic / Periodic (OB35/Task)</option>
                                    <option value="continuous">Continuous / Free Running (OB1)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top: 10px;">
                                <label for="io-jitter">I/O Jitter (Est.) [ms] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Random delay from remote I/O or network.</span></span></label>
                                <input type="number" id="io-jitter" value="5" step="1">
                            </div>
                        </div>
                    </div>

                    <!-- Process Dynamics -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Process Dynamics</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dead-time">Process Dead Time ($\theta_p$) [sec]</label>
                            <input type="number" id="dead-time" value="2.0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="time-constant">Time Constant ($\tau_p$) [sec]</label>
                            <input type="number" id="time-constant" value="5.0" step="0.5">
                        </div>
                        <div class="form-group">
                            <label for="target-freq">Crossover Freq ($f_c$) [Hz] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Frequency where loop gain is 1. Critical for stability. Approx 1/(2*pi*Tau).</span></span></label>
                            <input type="number" id="target-freq" value="0.5" step="0.01">
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Impact</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download PDF Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Analysis Results</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Stability Metrics</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-info-circle"></i> Tuning Recommendation:</strong>
                            <div id="interpretation-text" style="margin-top: 5px; font-size: 0.95rem;"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Phase Lag Impact (Bode Plot)</h4>
                        <div class="chart-container">
                            <canvas id="bodeChart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                            <span style="color: #10B981;">● Analog (Ideal)</span> &nbsp;
                            <span style="color: #EF4444;">● With Digital Delay</span>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Analysis based on Sampled Data Control Theory. Phase Lag $\phi = -360 \cdot f \cdot T_{delay}$.
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (EXPANDED TO ~1500 WORDS EQUIVALENT) -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: The Physics of Digital Control</h2>
            
            <!-- Insight 1: Digital Delay Anatomy -->
            <div class="insight-card">
                <h4><i class="fas fa-microchip"></i> 1. The Anatomy of a Digital Delay</h4>
                <p>Unlike continuous analog controllers (pneumatic, op-amp), a PLC operates in discrete time steps. This quantization of time introduces unavoidable delays that act as pure dead time in the control loop. The total delay is not just the scan time; it is a sum of several asynchronous components.</p>
                <ul>
                    <li><strong>Input Latency:</strong> Time for the A/D converter to digitize the signal (often 10-100ms depending on the module filter settings) plus the bus transmission time to the CPU.</li>
                    <li><strong>Program Execution ($T_{scan}$):</strong> The time it takes the CPU to solve the PID algorithm. In a continuous task (OB1), this varies with code load. In a cyclic task (OB35), it is fixed but acts as a sample-and-hold delay.</li>
                    <li><strong>Output Latency:</strong> Time to write the result to the output card, plus the D/A conversion time, plus the actuator response time.</li>
                </ul>
                <p><strong>The "One-Cycle" Myth:</strong> Many engineers assume the delay is just the scan time. In reality, due to the asynchronous nature of inputs vs program vs outputs, the statistical average delay is often closer to <strong>1.5 to 2.0 times the scan time</strong> plus jitter. This tool calculates the <em>Effective Dead Time ($D_{eff}$)</em> based on these factors.</p>
            </div>

            <!-- Insight 2: Phase Lag -->
            <div class="insight-card">
                <h4><i class="fas fa-wave-square"></i> 2. Phase Lag: Why Fast Loops Destabilize</h4>
                <p>Dead time is the enemy of feedback control because it creates <strong>Phase Lag</strong> ($\phi$). Phase lag grows linearly with frequency ($f$).</p>
                <div class="formula">$$ \phi_{lag} = -360^\circ \times f \times T_{delay} $$</div>
                <p>Consider a Flow Loop oscillating at 1 Hz ($T=1s$). If your PLC introduces a total effective delay of 100ms (0.1s), you introduce an extra phase shift of:</p>
                <p>$$ -360 \times 1 \times 0.1 = -36^\circ $$</p>
                <p>A robust PID loop typically has a <strong>Phase Margin</strong> of about 45°. If you subtract 36° from that margin, you are left with only 9°. The loop becomes barely stable, ringing excessively after any setpoint change. If the delay increases slightly (e.g., network traffic increases jitter), the loop will go unstable.</p>
            </div>

            <!-- Insight 3: Aliasing & The Nyquist Limit -->
            <div class="insight-card">
                <h4><i class="fas fa-ghost"></i> 3. Aliasing: The "Ghost Signal" Problem</h4>
                <p>Digital sampling creates a unique problem called Aliasing. According to the <strong>Nyquist-Shannon Sampling Theorem</strong>, you must sample a signal at least twice as fast as its highest frequency component ($f_s > 2 f_{max}$).</p>
                <p>If your pressure transmitter has noise at 10 Hz (from pump pulsation), but your PLC scans at 50ms (20 Hz), you are right on the limit. If the noise shifts to 15 Hz, your 20 Hz sampler will "see" a ghost signal at 5 Hz ($20 - 15 = 5$).</p>
                <p>The PID controller will try to fight this 5 Hz "ghost" oscillation, moving the valve unnecessarily. This wears out the valve packing and destabilizes the process. <strong>Solution:</strong> Always ensure your scan rate is 5x to 10x faster than the process dynamics, or use analog low-pass filters on the input cards.</p>
            </div>

            <!-- Insight 4: Jitter & Determinism -->
            <div class="insight-card">
                <h4><i class="fas fa-random"></i> 4. Jitter: Variance is Worse than Latency</h4>
                <p><strong>Jitter</strong> is the variation in loop execution time. A loop running exactly every 100ms is easier to tune than a loop running at 10ms +/- 8ms.</p>
                <p>Why? PID derivative action ($D$) relies on $\Delta Error / \Delta Time$. If $\Delta Time$ fluctuates randomly due to jitter, the calculated Derivative kick fluctuates wildly, injecting noise into the output. This is why derivative action is often turned off in PLCs with poor determinism (Continuous Task loops).</p>
                <p><strong>Best Practice:</strong> Always put PID loops in a <strong>Cyclic Interrupt / Periodic Task</strong> (e.g., OB30/35 in Siemens, Periodic Task in Rockwell). This enforces a fixed $\Delta T$, eliminating calculation jitter.</p>
            </div>

            <!-- Insight 5: Tuning Strategy -->
            <div class="insight-card">
                <h4><i class="fas fa-sliders-h"></i> 5. Tuning for Digital Delays</h4>
                <p>If you cannot speed up the PLC (e.g., large legacy system), you must detune the loop. The added digital dead time ($\theta_{dig}$) adds to the process dead time ($\theta_p$).</p>
                <p>Using the Lambda tuning rule (where closed loop time constant $\lambda$ is chosen based on dead time), the maximum aggressive gain is inversely proportional to the total dead time:</p>
                <div class="formula">$$ K_c \propto \frac{\tau_p}{K_p (\theta_p + \theta_{dig})} $$</div>
                <p>If digital delay adds 20% to your total dead time, you must reduce your Controller Gain ($K_c$) by roughly 20% to maintain the same stability margin. This tool calculates that specific <strong>Detune Factor</strong> for you.</p>
            </div>
        </div>
    </main>    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li>                        
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li>                        
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let bodeChart = null;
        let lastResult = null;

        function loadPreset(type) {
            if (type === 'fast_flow') {
                document.getElementById('scan-time').value = '10';
                document.getElementById('pid-update').value = '50';
                document.getElementById('task-type').value = 'cyclic';
                document.getElementById('io-jitter').value = '2';
                document.getElementById('dead-time').value = '0.2';
                document.getElementById('time-constant').value = '1.0';
                document.getElementById('target-freq').value = '1.0';
            } else if (type === 'slow_temp') {
                document.getElementById('scan-time').value = '50';
                document.getElementById('pid-update').value = '500';
                document.getElementById('task-type').value = 'cyclic';
                document.getElementById('io-jitter').value = '10';
                document.getElementById('dead-time').value = '10.0';
                document.getElementById('time-constant').value = '120.0';
                document.getElementById('target-freq').value = '0.01';
            } else if (type === 'pressure') {
                document.getElementById('scan-time').value = '5';
                document.getElementById('pid-update').value = '20';
                document.getElementById('task-type').value = 'continuous';
                document.getElementById('io-jitter').value = '5';
                document.getElementById('dead-time').value = '0.1';
                document.getElementById('time-constant').value = '0.5';
                document.getElementById('target-freq').value = '2.0';
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Theme handling
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function performCalculation() {
            // 1. Get Inputs
            const t_scan = parseFloat(document.getElementById('scan-time').value); // ms
            const t_update = parseFloat(document.getElementById('pid-update').value); // ms
            const type = document.getElementById('task-type').value;
            const jitter = parseFloat(document.getElementById('io-jitter').value); // ms
            
            const dead_time = parseFloat(document.getElementById('dead-time').value); // s
            const tau = parseFloat(document.getElementById('time-constant').value); // s
            const freq = parseFloat(document.getElementById('target-freq').value); // Hz

            if ([t_scan, t_update, jitter, dead_time, tau, freq].some(isNaN) || t_scan <= 0) {
                displayMessage("Please enter valid positive numbers.", "error");
                return;
            }

            // 2. Physics Engine Calculation
            
            // Effective Digital Delay (T_digital)
            let t_digital_ms = 0;
            if (type === 'cyclic') {
                // Fixed rate task + Jitter + 1/2 update latency inherent
                t_digital_ms = t_update + jitter; 
            } else {
                // Continuous scans vary. Avg delay is 1.5 * Scan + Jitter
                t_digital_ms = 1.5 * t_scan + jitter;
            }
            
            const t_digital_sec = t_digital_ms / 1000;
            const total_dead_time = dead_time + t_digital_sec;
            
            // Phase Lag Calculation at Target Freq
            const phi_process = -360 * freq * dead_time;
            const phi_digital = -360 * freq * t_digital_sec;
            const phi_total = phi_process + phi_digital;

            // Percentage Increase in Dead Time
            const pct_increase = (t_digital_sec / dead_time) * 100;

            // Recommended Gain Reduction
            const detune_factor = dead_time / total_dead_time; // Ratio old/new. E.g. 0.8 means reduce gain to 80%
            const gain_reduction_pct = (1 - detune_factor) * 100;
            
            // Nyquist Check
            const effective_scan_s = (type === 'cyclic' ? t_update : t_scan) / 1000;
            const f_nyquist = 1 / (2 * effective_scan_s);
            const isAliasing = freq > (f_nyquist * 0.5); // Safety margin 0.5

            lastResult = { t_digital_ms, total_dead_time, phi_digital, pct_increase, detune_factor, f_nyquist, isAliasing, freq, dead_time, tau };

            // 4. Render Step-by-Step (Whiteboard Style)
            let html = `<h4>Step 1: Effective Digital Latency ($D_{eff}$)</h4>`;
            html += `<div class="calculation-step">`;
            html += `<strong>Execution Mode:</strong> ${type.toUpperCase()}<br>`;
            html += `The total digital latency is the sum of Input Scan, Logic Execution, Output Scan, and Network Jitter.<br>`;
            
            if(type === 'cyclic') {
                html += `For Cyclic Tasks, the update rate ($T_{up}$) dominates:<br>`;
                html += `$$ D_{eff} \\approx T_{up} + Jitter = ${t_update} + ${jitter} = \\mathbf{${t_digital_ms.toFixed(1)} \\text{ ms}} $$<br>`;
            } else {
                html += `For Continuous Tasks, the average delay is $1.5 \\times T_{scan}$:<br>`;
                html += `$$ D_{eff} \\approx 1.5 \\times T_{scan} + Jitter = 1.5(${t_scan}) + ${jitter} = \\mathbf{${t_digital_ms.toFixed(1)} \\text{ ms}} $$<br>`;
            }
            html += `This adds <strong>${t_digital_sec.toFixed(4)} s</strong> of pure dead time to the control loop.`;
            html += `</div>`;

            html += `<h4>Step 2: Phase Lag Analysis (@ ${freq} Hz)</h4>`;
            html += `<div class="calculation-step">`;
            html += `Calculating the phase erosion caused by this delay at the loop's crossover frequency.<br>`;
            html += `$$ \\phi_{digital} = -360^\\circ \\times f \\times D_{eff} $$`;
            html += `$$ \\phi_{digital} = -360 \\times ${freq} \\times ${t_digital_sec.toFixed(4)} = \\mathbf{${phi_digital.toFixed(2)}^\\circ} $$`;
            html += `<br><strong>Total Loop Delay:</strong><br>`;
            html += `$$ \\theta_{total} = \\theta_{process} + D_{eff} = ${dead_time} + ${t_digital_sec.toFixed(4)} = \\mathbf{${total_dead_time.toFixed(4)} \\text{ s}} $$`;
            html += `</div>`;

            html += `<h4>Step 3: Controller Tuning Impact</h4>`;
            html += `<div class="calculation-step">`;
            html += `To maintain stability margins with increased dead time, the controller gain ($K_c$) must be reduced.<br>`;
            html += `$$ K_{new} \\approx K_{old} \\times \\frac{\\theta_{process}}{\\theta_{total}} $$`;
            html += `$$ \\text{Reduction Factor} = \\frac{${dead_time}}{${total_dead_time.toFixed(4)}} = \\mathbf{${detune_factor.toFixed(2)}} $$`;
            html += `Recommendation: Reduce $K_c$ by <strong>${gain_reduction_pct.toFixed(1)}%</strong>.`;
            html += `</div>`;

            html += `<h4>Step 4: Sampling Stability (Nyquist)</h4>`;
            html += `<div class="calculation-step">`;
            html += `Sampling Frequency $F_s = 1 / ${effective_scan_s} = ${(1/effective_scan_s).toFixed(1)} \\text{ Hz}$.<br>`;
            html += `Nyquist Limit ($F_s/2$) = <strong>${f_nyquist.toFixed(1)} Hz</strong>.<br>`;
            html += `Signal Frequency ($f$) = ${freq} Hz.<br>`;
            html += isAliasing ? `<span style="color:var(--danger)">WARNING: Signal frequency (${freq}Hz) is > 50% of Nyquist Limit. Aliasing likely.</span>` 
                               : `<span style="color:var(--success)">PASS: Sampling rate is adequate (> 4x signal).</span>`;
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;

            // 5. Update Table
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, s, c="") => {
                tbody.innerHTML += `<tr style="${c ? 'color:'+c : ''}"><td><strong>${n}</strong></td><td>${v}</td><td>${s}</td></tr>`;
            };
            addRow("Added Digital Delay", t_digital_ms.toFixed(1) + " ms", `+${pct_increase.toFixed(1)}% Lag`);
            addRow("Added Phase Shift", phi_digital.toFixed(2) + "°", "At " + freq + " Hz", "var(--danger)");
            addRow("Max Gain Reduction", gain_reduction_pct.toFixed(1) + "%", `Factor: ${detune_factor.toFixed(2)}x`);

            const interpEl = document.getElementById('interpretation-text');
            if (pct_increase > 20) {
                interpEl.innerHTML = `<span style="color:var(--danger); font-weight:bold;">Critical Impact.</span> The PLC scan is adding significant lag (>20% of process dead time). You MUST detune the loop or increase the scan rate.`;
            } else if (pct_increase > 5) {
                interpEl.innerHTML = `<span style="color:var(--warning); font-weight:bold;">Moderate Impact.</span> Slight retuning recommended.`;
            } else {
                interpEl.innerHTML = `<span style="color:var(--success); font-weight:bold;">Negligible.</span> The PLC is fast enough for this process.`;
            }

            // 6. Draw Chart
            drawChart(t_digital_sec, dead_time);

            // 7. Show
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        function drawChart(t_dig, t_proc) {
            const ctx = document.getElementById('bodeChart').getContext('2d');
            if (bodeChart) bodeChart.destroy();

            // Generate Data Points (Freq log scale approx)
            const labels = [];
            const dataIdeal = [];
            const dataActual = [];
            const maxFreq = 2.0 / t_proc; // Show up to reasonable freq
            const steps = 50;
            
            for (let i = 1; i <= steps; i++) {
                const f = (maxFreq / steps) * i;
                const phi_ideal = -360 * f * t_proc;
                const phi_actual = -360 * f * (t_proc + t_dig);
                
                labels.push(f.toFixed(2));
                dataIdeal.push(phi_ideal);
                dataActual.push(phi_actual);
            }

            bodeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Ideal Analog',
                            data: dataIdeal,
                            borderColor: '#10B981',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'With Digital Delay',
                            data: dataActual,
                            borderColor: '#EF4444',
                            borderWidth: 2,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Frequency (Hz)' } },
                        y: { title: { display: true, text: 'Phase Lag (Degrees)' } }
                    }
                }
            });
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            // Header
            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(30, 58, 138); // Blue
            pdf.text('Scan Time Impact Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. Loop Configuration', 14, y);
            y += 5;

            const inputData = [
                ['Scan/Update Time', `${lastResult.t_digital_ms.toFixed(1)} ms`],
                ['Process Dead Time', `${lastResult.dead_time} s`],
                ['Process Tau', `${lastResult.tau} s`],
                ['Target Freq', `${lastResult.freq} Hz`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. Stability Analysis', 14, y);
            y += 5;

            const resData = [
                ['Added Phase Lag', `${lastResult.phi_digital.toFixed(2)} deg`],
                ['Dead Time Increase', `${lastResult.pct_increase.toFixed(1)} %`],
                ['Recommended Detune', `${lastResult.detune_factor.toFixed(2)} x`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] },
                didParseCell: function(data) {
                    if(data.row.index === 0) {
                        data.cell.styles.fontStyle = 'bold';
                    }
                }
            });

            // Footer
            y = pdf.lastAutoTable.finalY + 20;
            pdf.setFontSize(8);
            pdf.setTextColor(150);
            pdf.text('Estimates based on Sampled Data Control Theory.', 105, y, { align: 'center' });

            pdf.save('Scan_Time_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }
    </script>
</body>
</html>
