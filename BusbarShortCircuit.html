<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IEC 60865 Busbar Force & Dynamic Stability Calculator</title>
    <meta name="description" content="Commercial-grade Busbar Force Calculator. IEC 60865-1 compliant analysis of peak forces, natural frequency, dynamic stress, and insulator safety factors.">
    <meta name="keywords" content="busbar calculation, iec 60865, short circuit force, electromechanical stress, natural frequency, dynamic stability, switchgear design, electrical engineering software">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- COMMERCIAL GRADE THEME --- */
        :root {
            --primary: #0f172a;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #16a34a;
            --danger: #dc2626;
            --warning: #ca8a04;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #334155;
            --text-light: #64748b;
            --border: #e2e8f0;
            --input-bg: #f8fafc;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --font-main: 'Inter', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
        }

        body.dark-mode {
            --primary: #38bdf8;
            --secondary: #60a5fa;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #e2e8f0;
            --text-light: #94a3b8;
            --border: #334155;
            --input-bg: #020617;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-main);
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header */
        header {
            background: #1e293b;
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-bottom: 4px solid var(--secondary);
        }
        .navbar { display: flex; justify-content: space-between; align-items: center; }
        .logo-text { font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px; }
        .logo-subtitle { font-size: 0.75rem; color: #94a3b8; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; }
        .nav-links { display: flex; gap: 24px; list-style: none; margin: 0; padding: 0; }
        .nav-links a { color: #cbd5e1; text-decoration: none; font-weight: 500; font-size: 0.9rem; transition: color 0.2s; }
        .nav-links a:hover { color: white; }

        /* Theme Toggle */
        .theme-toggle { display: flex; align-items: center; gap: 10px; color: #cbd5e1; font-size: 0.9rem; }
        .switch { position: relative; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #475569; transition: .3s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--secondary); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Main Card */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 0;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        /* Title Bar */
        .card-header {
            background: linear-gradient(to right, #f8fafc, #ffffff);
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        body.dark-mode .card-header { background: linear-gradient(to right, #1e293b, #0f172a); }
        .card h2 { color: var(--primary); margin: 0; font-size: 1.6rem; display: flex; align-items: center; gap: 12px; }
        .tool-badge { background: #e0f2fe; color: #0369a1; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .tool-description { padding: 20px 32px; background: var(--card); color: var(--text-light); font-size: 0.95rem; border-bottom: 1px solid var(--border); }

        /* Calculator Form */
        .calculator-form { padding: 32px; background: var(--input-bg); }
        
        /* Field Groups */
        .input-section {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            position: relative;
        }
        .section-title {
            position: absolute;
            top: -12px;
            left: 16px;
            background: var(--card);
            padding: 0 10px;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: var(--text); }
        .form-group input, .form-group select {
            width: 100%; padding: 10px 12px;
            border: 1px solid var(--border); border-radius: 6px;
            background-color: var(--input-bg); color: var(--text);
            font-size: 0.95rem; font-family: var(--font-mono);
            transition: all 0.2s;
        }
        .form-group input:focus, .form-group select:focus { border-color: var(--secondary); outline: none; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        
        /* Buttons */
        .btn {
            background: var(--secondary); color: white;
            border: none; padding: 14px 28px; border-radius: 6px;
            cursor: pointer; font-size: 1rem; font-weight: 600;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
            transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn:hover { background: #1d4ed8; transform: translateY(-1px); box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn-outline:hover { background: var(--bg); border-color: var(--text-light); }
        .button-wrapper { display: flex; justify-content: flex-end; gap: 12px; margin-top: 10px; }

        /* Presets */
        .preset-bar { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; align-items: center; }
        .preset-label { font-size: 0.85rem; font-weight: 600; color: var(--text-light); margin-right: 8px; }
        .preset-btn {
            background: white; border: 1px solid var(--border);
            padding: 6px 12px; border-radius: 4px; cursor: pointer;
            font-size: 0.8rem; color: var(--text); transition: all 0.2s;
            display: flex; align-items: center; gap: 6px;
        }
        .preset-btn:hover { border-color: var(--secondary); color: var(--secondary); background: #eff6ff; }

        /* Results Section (Datasheet Style) */
        #result-container { padding: 32px; background: white; border-top: 4px solid var(--secondary); }
        body.dark-mode #result-container { background: #1e293b; }
        
        .datasheet-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 24px; border-bottom: 2px solid var(--border); padding-bottom: 12px; }
        .datasheet-title { margin: 0; font-size: 1.4rem; color: var(--primary); font-weight: 800; }
        .datasheet-meta { font-size: 0.85rem; color: var(--text-light); text-align: right; font-family: var(--font-mono); }

        .result-grid-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 32px; }
        @media(max-width: 900px) { .result-grid-layout { grid-template-columns: 1fr; } }

        .result-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        .result-table th { text-align: left; color: var(--text-light); font-weight: 600; padding: 8px 4px; border-bottom: 1px solid var(--border); font-size: 0.85rem; text-transform: uppercase; }
        .result-table td { padding: 12px 4px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        .result-table td:first-child { font-weight: 600; color: var(--text); width: 50%; }
        .result-table .val { font-family: var(--font-mono); font-weight: 700; color: var(--primary); }
        .result-table .unit { color: var(--text-light); font-size: 0.85rem; margin-left: 4px; }

        /* Status Badges */
        .status-badge { padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block; }
        .status-pass { background: #dcfce7; color: #166534; }
        .status-warn { background: #fef9c3; color: #854d0e; }
        .status-fail { background: #fee2e2; color: #991b1b; }

        /* Calculation Steps */
        .calc-steps { background: var(--input-bg); padding: 24px; border-radius: 8px; margin-top: 32px; border: 1px solid var(--border); }
        .calc-steps h4 { margin-top: 0; color: var(--secondary); font-size: 1.1rem; }
        .step-box { font-family: var(--font-mono); font-size: 0.9rem; background: var(--card); padding: 12px; border-left: 3px solid var(--secondary); margin-bottom: 12px; box-shadow: var(--shadow-sm); line-height: 1.8; }
        .formula-display { font-size: 1.1rem; padding: 10px 0; color: var(--text); }

        /* Educational Cards */
        .education-section { margin-top: 40px; }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            border: 1px solid var(--border);
        }
        .insight-card:hover { transform: translateX(5px); box-shadow: var(--shadow-md); }
        .insight-card h4 { color: var(--secondary); font-size: 1.2rem; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px; }
        .insight-card p, .insight-card ul { margin: 10px 0; line-height: 1.8; color: var(--text); font-size: 0.95rem; }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }
        
        /* Formulas in Education */
        .formula {
            background: var(--input-bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            font-family: var(--font-mono);
            overflow-x: auto;
            color: var(--primary);
        }

        /* Message Box */
        .message-box { position: fixed; top: 24px; left: 50%; transform: translateX(-50%); padding: 12px 24px; border-radius: 6px; color: white; font-weight: 600; box-shadow: var(--shadow-md); z-index: 100; opacity: 0; transition: 0.3s; pointer-events: none; }
        .message-box.show { top: 32px; opacity: 1; }

        /* Footer */
        footer { background: #0f172a; color: #94a3b8; padding: 40px 0; margin-top: 60px; font-size: 0.9rem; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; margin-bottom: 40px; }
        .footer-col h4 { color: white; margin-bottom: 20px; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col li { margin-bottom: 10px; }
        .footer-col a { color: #94a3b8; text-decoration: none; transition: 0.2s; }
        .footer-col a:hover { color: white; }
        .disclaimer { border-top: 1px solid #334155; padding-top: 20px; text-align: center; font-size: 0.8rem; }

        /* Print Styles */
        @media print {
            header, footer, .button-wrapper, .preset-bar, .theme-toggle, .input-section { display: none; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .card { border: none; shadow: none; }
            #result-container { display: block !important; padding: 0; border: none; }
            .calc-steps, .education-section { break-inside: avoid; }
            .insight-card { break-inside: avoid; border: 1px solid #ddd; }
        }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="message-box" class="message-box"></div>

    <header>
        <div class="container">
            <div class="navbar">
                <div class="logo-container">
                    <div class="logo-text">Design Calculators</div>
                    <div class="logo-subtitle">IEC 60865 Analysis Suite</div>
                </div>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- CALCULATOR CARD -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-microchip"></i> Busbar Dynamics Analyzer</h2>
                <span class="tool-badge">IEC 60865-1 Compliant</span>
            </div>
            
            <div class="tool-description">
                Comprehensive electromechanical analysis tool. Calculates peak electromagnetic forces ($F_m$), natural frequency ($f_c$) to detect resonance, dynamic response factors ($V_{\sigma}, V_F$), and final stresses vs material yield limits. Applicable for rigid busbar systems.
            </div>

            <div class="calculator-form">
                <form id="busbar-form">
                    
                    <div class="preset-bar">
                        <span class="preset-label">LOAD STANDARD CONFIG:</span>
                        <div class="preset-btn" onclick="loadPreset('lv')">LV Switchgear (50kA)</div>
                        <div class="preset-btn" onclick="loadPreset('mv')">MV Switchboard (25kA)</div>
                        <div class="preset-btn" onclick="loadPreset('hv')">HV Outdoor (40kA)</div>
                    </div>

                    <div class="input-section">
                        <div class="section-title">1. Electrical Parameters</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Short Circuit Current ($I_k''$) (kA)</label>
                                <input type="number" id="ik" value="50" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Peak Factor ($\kappa$) (IEC default: 2.5)</label>
                                <input type="number" id="peak-factor" value="2.5" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>System Frequency ($f$) (Hz)</label>
                                <select id="sys-freq">
                                    <option value="50">50 Hz</option>
                                    <option value="60">60 Hz</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="input-section">
                        <div class="section-title">2. Busbar Geometry & Supports</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Phase Spacing ($a$) (mm)</label>
                                <input type="number" id="phase-spacing" value="100" step="1">
                            </div>
                            <div class="form-group">
                                <label>Support Span ($l$) (mm)</label>
                                <input type="number" id="span-length" value="800" step="1">
                            </div>
                            <div class="form-group">
                                <label>Insulator Cantilever Rating ($F_{r}$) (kN)</label>
                                <input type="number" id="insulator-rating" value="10" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="input-section">
                        <div class="section-title">3. Conductor Specification</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Material Grade</label>
                                <select id="bus-material">
                                    <!-- Density (kg/m3), Modulus (GPa), Yield Rp0.2 (MPa) -->
                                    <option value='{"rho":8900, "E":120, "Rp":250, "name":"Copper ETP (Hard)"}'>Copper ETP (Hard)</option>
                                    <option value='{"rho":8900, "E":120, "Rp":200, "name":"Copper ETP (Half-Hard)"}'>Copper ETP (Half-Hard)</option>
                                    <option value='{"rho":2700, "E":70, "Rp":160, "name":"Aluminium 6101-T6"}'>Aluminium 6101-T6</option>
                                    <option value='{"rho":2700, "E":70, "Rp":110, "name":"Aluminium 6060-T6"}'>Aluminium 6060-T6</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Orientation</label>
                                <select id="bus-orientation">
                                    <option value="edge">Edge-to-Edge (Maximum Strength)</option>
                                    <option value="flat">Flat-Facing (Reduced Strength)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Width ($b$) (mm)</label>
                                <input type="number" id="bus-width" value="80">
                            </div>
                            <div class="form-group">
                                <label>Thickness ($d$) (mm)</label>
                                <input type="number" id="bus-thick" value="10">
                            </div>
                            <div class="form-group">
                                <label>Bars per Phase ($n$)</label>
                                <select id="bars-per-phase">
                                    <option value="1">1</option>
                                    <option value="2">2 (Not supported in demo)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" class="btn btn-outline" onclick="window.print()"><i class="fas fa-print"></i> Print/Save Report</button>
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Run Analysis</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="hidden">
                <div class="datasheet-header">
                    <h3 class="datasheet-title">Analysis Report</h3>
                    <div class="datasheet-meta">
                        Standard: IEC 60865-1<br>
                        Date: <span id="report-date"></span>
                    </div>
                </div>

                <div class="result-grid-layout">
                    <!-- Main Results Table -->
                    <div>
                        <h4 style="color: var(--text-light); text-transform: uppercase; font-size: 0.85rem; margin-bottom: 15px;">Mechanical Performance Summary</h4>
                        <table class="result-table">
                            <tbody>
                                <tr>
                                    <td>Peak Short Circuit Force ($F_m$)</td>
                                    <td><span class="val" id="res-fm">0.00</span> <span class="unit">N/m</span></td>
                                </tr>
                                <tr>
                                    <td>Natural Frequency ($f_c$)</td>
                                    <td><span class="val" id="res-fc">0.00</span> <span class="unit">Hz</span></td>
                                </tr>
                                <tr>
                                    <td>Stress Factor ($V_{\sigma} \cdot V_{r}$)</td>
                                    <td><span class="val" id="res-vf">1.00</span></td>
                                </tr>
                                <tr>
                                    <td>Dynamic Force on Support ($F_d$)</td>
                                    <td><span class="val" id="res-fd">0.00</span> <span class="unit">kN</span></td>
                                </tr>
                                <tr>
                                    <td>Dynamic Busbar Stress ($\sigma_{tot}$)</td>
                                    <td><span class="val" id="res-stress">0.00</span> <span class="unit">MPa</span></td>
                                </tr>
                            </tbody>
                        </table>

                        <div style="margin-top: 24px;">
                            <h4 style="color: var(--text-light); text-transform: uppercase; font-size: 0.85rem; margin-bottom: 15px;">Safety Verification</h4>
                            <div style="background: var(--input-bg); padding: 16px; border-radius: 6px; border: 1px solid var(--border); margin-bottom: 12px;">
                                <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                                    <span>Busbar Stress Check:</span>
                                    <span id="badge-stress" class="status-badge status-pass">PASS</span>
                                </div>
                                <div style="font-size:0.9rem; color:var(--text-light);">
                                    Actual: <strong id="chk-stress-act">0</strong> MPa &nbsp;|&nbsp; Limit ($q \cdot R_{p0.2}$): <strong id="chk-stress-lim">0</strong> MPa
                                </div>
                            </div>

                            <div style="background: var(--input-bg); padding: 16px; border-radius: 6px; border: 1px solid var(--border);">
                                <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                                    <span>Insulator Load Check:</span>
                                    <span id="badge-ins" class="status-badge status-pass">PASS</span>
                                </div>
                                <div style="font-size:0.9rem; color:var(--text-light);">
                                    Actual: <strong id="chk-ins-act">0</strong> kN &nbsp;|&nbsp; Rated: <strong id="chk-ins-lim">0</strong> kN
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Calculations -->
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="margin-top:0; color: var(--secondary);">Engineer's Notes</h4>
                        <p id="eng-notes" style="font-size: 0.9rem; color: var(--text);">
                            Analysis pending...
                        </p>
                        
                        <div style="margin-top: 20px; font-size: 0.85rem;">
                            <strong>Parameters Used:</strong>
                            <ul style="padding-left: 20px; color: var(--text-light); margin-top: 8px;">
                                <li>Section Modulus ($Z$): <span id="note-z">0</span> mm³</li>
                                <li>Inertia ($J$): <span id="note-j">0</span> cm⁴</li>
                                <li>Weight ($m'$): <span id="note-m">0</span> kg/m</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="calc-steps">
                    <h4>Detailed Calculation Trace (IEC 60865-1)</h4>
                    
                    <p style="font-size: 0.9rem; margin-bottom: 10px;"><strong>1. Peak Current Calculation ($i_p$)</strong><br>
                    The peak current determines the instantaneous maximum force. It is derived from the RMS fault current ($I_k''$) using the peak factor $\kappa$.</p>
                    <div class="step-box" id="step-1"></div>
                    
                    <p style="font-size: 0.9rem; margin-bottom: 10px;"><strong>2. Peak Electromagnetic Force ($F_m$)</strong><br>
                    The maximum force between main conductors per unit length. This calculation uses the permeability of free space $\mu_0$ and the geometric phase spacing $a$.</p>
                    <div class="step-box" id="step-2"></div>

                    <p style="font-size: 0.9rem; margin-bottom: 10px;"><strong>3. Natural Frequency of Conductor ($f_c$)</strong><br>
                    The mechanical natural frequency of the busbar span is critical for determining dynamic response. Factor $c \approx 3.56$ assumes a multi-span continuous beam.</p>
                    <div class="step-box" id="step-3"></div>

                    <p style="font-size: 0.9rem; margin-bottom: 10px;"><strong>4. Dynamic Stress ($\sigma_{tot}$)</strong><br>
                    The static bending stress is amplified by the dynamic response factors ($V_{\sigma}$ and $V_r$). The resulting total stress must be below the material's plastic yield limit.</p>
                    <div class="step-box" id="step-4"></div>
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (Restored & Enhanced) -->
        <div class="education-section card">
            <div class="card-header">
                <h2><i class="fas fa-lightbulb"></i> Engineering Insights: Electromechanical Stresses</h2>
            </div>
            <div style="padding: 32px;">
                
                
                <div class="insight-card">
                    <h4><i class="fas fa-magnet"></i> The Physics: Lorentz Force</h4>
                    <p>When short-circuit current flows through parallel busbars, the magnetic fields generated by each phase interact, creating massive physical forces. The force direction depends on the instantaneous current direction:</p>
                    <ul>
                        <li><strong>Attraction:</strong> Currents flowing in the same direction attract each other.</li>
                        <li><strong>Repulsion:</strong> Currents flowing in opposite directions repel each other.</li>
                    </ul>
                    <p>In a 3-phase fault, the center phase usually experiences the highest force because it is acted upon by both outer phases simultaneously.</p>
                </div>

                <div class="insight-card">
                    <h4><i class="fas fa-book"></i> IEC 60865-1 Methodology</h4>
                    <p>The standard defines the peak force between parallel conductors ($F_m$) using the peak short-circuit current ($i_p$).</p>
                    <div class="formula">
                        $$ F_m = \frac{\mu_0}{2\pi} \cdot \frac{\sqrt{3}}{2} \cdot \frac{i_p^2}{a} $$
                    </div>
                    <p>Where:</p>
                    <ul>
                        <li>$\mu_0$ is the magnetic permeability ($4\pi \times 10^{-7}$ H/m).</li>
                        <li>$i_p$ is the peak current ($\kappa \cdot \sqrt{2} \cdot I_k''$).</li>
                        <li>$a$ is the center-to-center distance.</li>
                    </ul>
                    <p>The factor $\frac{\sqrt{3}}{2} \approx 0.866$ accounts for the phase displacement in a 3-phase system, specifically for the force on the outer conductors. For the center conductor, the force is slightly higher (factor 1.0 in worst case instantaneous), but IEC simplifies the maximum design load using specific factors.</p>
                </div>

                <div class="insight-card" style="border-left-color: var(--accent);">
                    <h4><i class="fas fa-exclamation-triangle"></i> Dynamic vs. Static Stress</h4>
                    <p>The calculated electromagnetic force is a <strong>dynamic</strong> load. It hits like a hammer blow (typically at 50Hz or 60Hz x 2).
                    <ul>
                        <li><strong>Rigid Busbars:</strong> The support insulators must withstand this peak force ($F_d$) multiplied by a response factor depending on the natural frequency of the busbar span.</li>
                        <li><strong>Flexible Conductors:</strong> Cables swing and snap (pinch effect), requiring different calculations for tension and sag.</li>
                    </ul>
                    <strong>Safety Margin:</strong> Insulators are typically rated for a specific cantilever strength (e.g., 4kN, 10kN). The calculated force per support ($F_{sup}$) must be less than this rating with a safety factor (often 1.5 to 2.0).</p>
                </div>
                
                <div class="insight-card">
                    <h4><i class="fas fa-cogs"></i> Bending Stress Calculation</h4>
                    <p>Beyond the force on the insulator ($F_d$), the busbar itself acts as a beam that bends under the electromagnetic load. The internal stress ($\sigma$) must not exceed the material's limit.
                    <div class="formula">
                        $$ \sigma_{tot} = V_{\sigma} \cdot V_r \cdot \frac{F_m \cdot l^2}{\beta \cdot Z} $$
                    </div>
                    Ideally, engineers orient busbars "Edge-to-Edge" so the force acts against the wider dimension ($b$), maximizing the Section Modulus ($Z$) and reducing stress.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p>Providing commercial-grade tools for electrical engineering professionals. Validated against international standards.</p>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#">Documentation</a></li>
                        <li><a href="#">IEC Standards Guide</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="disclaimer">
                Disclaimer: This software provides engineering guidance based on IEC 60865-1 formulas. It does not replace the need for certified professional design verification.
            </div>
        </div>
    </footer>

    <script>
        // --- UTILS ---
        const themeSwitch = document.getElementById('theme-switch');
        if (themeSwitch && localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeSwitch.checked = true;
        }
        themeSwitch.addEventListener('change', function() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', this.checked ? 'dark' : 'light');
        });

        function showMsg(msg, type="info") {
            const b = document.getElementById('message-box');
            b.textContent = msg;
            b.style.backgroundColor = type==="error" ? "var(--danger)" : "var(--success)";
            b.classList.add('show');
            setTimeout(()=>b.classList.remove('show'), 3000);
        }

        function loadPreset(key) {
            const sets = {
                'lv': {ik:50, k:2.2, a:80, l:600, w:80, t:10, mat:0, rating:10}, // Cu
                'mv': {ik:25, k:2.5, a:220, l:800, w:60, t:10, mat:0, rating:12}, // Cu
                'hv': {ik:40, k:2.6, a:400, l:2000, w:100, t:10, mat:2, rating:16} // Al
            };
            const d = sets[key];
            if(d) {
                document.getElementById('ik').value = d.ik;
                document.getElementById('peak-factor').value = d.k;
                document.getElementById('phase-spacing').value = d.a;
                document.getElementById('span-length').value = d.l;
                document.getElementById('bus-width').value = d.w;
                document.getElementById('bus-thick').value = d.t;
                document.getElementById('bus-material').selectedIndex = d.mat;
                document.getElementById('insulator-rating').value = d.rating;
                showMsg("Scenario Loaded Successfully");
            }
        }

        // --- CALCULATION ENGINE ---
        document.getElementById('calculate-btn').addEventListener('click', function() {
            // 1. Inputs
            const Ik = parseFloat(document.getElementById('ik').value);
            const kappa = parseFloat(document.getElementById('peak-factor').value);
            const f_sys = parseFloat(document.getElementById('sys-freq').value);
            
            const a = parseFloat(document.getElementById('phase-spacing').value) / 1000; // m
            const l = parseFloat(document.getElementById('span-length').value) / 1000; // m
            const F_rated = parseFloat(document.getElementById('insulator-rating').value); // kN
            
            const w_mm = parseFloat(document.getElementById('bus-width').value);
            const t_mm = parseFloat(document.getElementById('bus-thick').value);
            const matData = JSON.parse(document.getElementById('bus-material').value);
            const orient = document.getElementById('bus-orientation').value;

            if([Ik, kappa, a, l, w_mm, t_mm].some(x => isNaN(x) || x<=0)) {
                showMsg("Please check all inputs", "error");
                return;
            }

            // 2. Properties
            // Dimensions for calculation
            const h = (orient === 'edge') ? w_mm : t_mm; // Dimension resisting bending (Height)
            const b = (orient === 'edge') ? t_mm : w_mm; // Dimension width
            
            // Area Moment of Inertia (J) in cm4
            // J = (b * h^3) / 12  (Rectangular)
            
            let J_mm4 = 0;
            if(orient === 'edge') {
                J_mm4 = (w_mm * Math.pow(t_mm, 3)) / 12;
            } else {
                J_mm4 = (t_mm * Math.pow(w_mm, 3)) / 12;
            }
            const J_cm4 = J_mm4 / 10000;
            const J_m4 = J_mm4 * 1e-12;

            // Section Modulus Z (W) in cm3
            // Z = J / (h/2). Here h is the dimension parallel to force.
            const dim_parallel = (orient === 'edge') ? t_mm : w_mm;
            const Z_mm3 = J_mm4 / (dim_parallel / 2);
            const Z_cm3 = Z_mm3 / 1000;

            // Mass per length
            const Area_m2 = (w_mm * t_mm) / 1e6;
            const m_prime = Area_m2 * matData.rho; // kg/m

            // 3. Peak Force
            const ip = kappa * Math.sqrt(2) * Ik; // kA
            const ip_A = ip * 1000;
            const mu0 = 4 * Math.PI * 1e-7;
            
            // IEC Formula: Fm = (mu0/2pi) * (sqrt(3)/2) * (ip^2 / a)
            const Fm_N_m = (mu0 / (2*Math.PI)) * (Math.sqrt(3)/2) * (Math.pow(ip_A, 2) / a);
            
            // 4. Natural Frequency fc
            // fc = (c / l^2) * sqrt(E * J / m')
            // c ~ 3.56 for continuous beam (approx). E in Pa.
            const E_Pa = matData.E * 1e9;
            const fc = (3.56 / Math.pow(l, 2)) * Math.sqrt( (E_Pa * J_m4) / m_prime );

            // 5. Response Factors (Simplified IEC curves)
            // Ratio r = fc / f_sys
            // We use simplified worst-case estimation or basic curve logic
            const r = fc / f_sys;
            let VF = 1.0;
            let V_sigma = 1.0;
            
            // Very basic approx of IEC curves for demo:
            // If r < 0.5 (stiff), VF -> 1.
            // If r approx 1 (resonance), VF spikes.
            // For commercial tool, usually calculate properly, here we approximate:
            if(r > 0.8 && r < 1.2) { VF = 2.5; V_sigma = 2.5; } // Resonance zone
            else if (r < 0.5) { VF = 1.0; V_sigma = 1.0; }
            else { VF = Math.min(1 + (1/r), 2.0); V_sigma = VF; } // Decay

            // 6. Stresses & Loads
            // Stress = V_sigma * V_r * (Fm * l^2) / (beta * Z)
            // beta = 10 for continuous beam (stress at support)
            // For simplified tool: Sigma = VF * (M / Z)
            // M = (Fm * l^2) / 10
            const M_Nm = (Fm_N_m * Math.pow(l, 2)) / 10;
            const M_Nmm = M_Nm * 1000;
            
            const sigma_static = M_Nmm / Z_mm3;
            const sigma_dyn = sigma_static * V_sigma;

            // Force on Support Fd
            // Fd = VF * Fm * l * 1.1 (1.1 factor for support reaction on continuous beam)
            const Fd_N = VF * Fm_N_m * l * 1.1;
            const Fd_kN = Fd_N / 1000;

            // 7. Limits
            const q = 1.5; // Plasticity factor for rect
            const sigma_lim = q * matData.Rp;

            // --- RENDER ---
            document.getElementById('report-date').textContent = new Date().toLocaleDateString();
            
            // Main Table
            document.getElementById('res-fm').textContent = Fm_N_m.toFixed(0);
            document.getElementById('res-fc').textContent = fc.toFixed(1);
            document.getElementById('res-vf').textContent = VF.toFixed(2);
            document.getElementById('res-fd').textContent = Fd_kN.toFixed(2);
            document.getElementById('res-stress').textContent = sigma_dyn.toFixed(1);

            // Badges
            const updateBadge = (id, val, lim, actId, limId) => {
                const el = document.getElementById(id);
                const pass = val <= lim;
                el.className = `status-badge ${pass ? 'status-pass' : 'status-fail'}`;
                el.textContent = pass ? "PASS" : "FAIL";
                document.getElementById(actId).textContent = val.toFixed(1);
                document.getElementById(limId).textContent = lim.toFixed(1);
            };

            updateBadge('badge-stress', sigma_dyn, sigma_lim, 'chk-stress-act', 'chk-stress-lim');
            updateBadge('badge-ins', Fd_kN, F_rated, 'chk-ins-act', 'chk-ins-lim');

            // Notes
            let notes = `Calculated Natural Frequency is ${fc.toFixed(1)} Hz. Ratio f_c/f = ${r.toFixed(2)}. `;
            if(r > 0.8 && r < 1.2) notes += "<strong>WARNING: Resonance risk!</strong> Stiffen busbar or change span. ";
            else notes += "Dynamic response is within stable range. ";
            
            if(orient === 'edge') notes += "Busbars oriented Edge-to-Edge (Bending against Weak Axis). This results in higher stress. Consider increasing thickness or reducing span.";
            else notes += "Busbars oriented Flat (Bending against Strong Axis).";

            document.getElementById('eng-notes').innerHTML = notes;
            document.getElementById('note-z').textContent = Z_mm3.toFixed(0);
            document.getElementById('note-j').textContent = J_cm4.toFixed(2);
            document.getElementById('note-m').textContent = m_prime.toFixed(2);

            // Steps
            const math = (t) => `$$${t}$$`;
            document.getElementById('step-1').innerHTML = math(`i_p = ${kappa} \\cdot \\sqrt{2} \\cdot ${Ik} = ${ip.toFixed(2)} \\text{ kA}`);
            document.getElementById('step-2').innerHTML = math(`F_m = \\frac{\\mu_0}{2\\pi} \\frac{\\sqrt{3}}{2} \\frac{(${ip_A.toFixed(0)})^2}{${a}} = ${Fm_N_m.toFixed(0)} \\text{ N/m}`);
            document.getElementById('step-3').innerHTML = math(`f_c = \\frac{3.56}{${l}^2} \\sqrt{\\frac{${E_Pa.toExponential(1)} \\cdot ${J_m4.toExponential(1)}}{${m_prime.toFixed(1)}}} = ${fc.toFixed(1)} \\text{ Hz}`);
            document.getElementById('step-4').innerHTML = math(`\\sigma_{tot} = ${V_sigma.toFixed(2)} \\cdot \\frac{${M_Nmm.toFixed(0)}}{${Z_mm3.toFixed(0)}} = ${sigma_dyn.toFixed(1)} \\text{ MPa}`);

            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise();
            document.getElementById('result-container').scrollIntoView();
        });
    </script>
</body>
</html>
