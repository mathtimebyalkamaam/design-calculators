<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pH Sensor Temperature Compensation - Design Calculators - Instrumentation</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional calculator for pH temperature compensation. Corrects measured pH for both Nernstian sensor slope and solution temperature coefficient.">
    <meta name="keywords" content="ph temperature compensation, nernst equation, ph calculator, atc, automatic temperature compensation, solution temperature coefficient, instrumentation">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    
    <!-- AdSense & Analytics (from new header) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts & Icons (from new header) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for Formulas (from new header) -->
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['\\(', '\\)'], ['$', '$']],
            displayMath: [['\\[', '\\]'], ['$$', '$$']]
        },
        svg: { fontCache: 'global' },
        options: {
            processHtmlClass: 'math-content', // Process elements with this class
            ignoreHtmlClass: 'no-mathjax' // Ignore elements with this class
        }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- PDF Generation (Not used by this tool but included in header) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Favicon (from new header) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- New Styles from template file -->
    <style>
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
            /* Specific colors for this tool */
            --ok-color: #10B981;
            --error-color: #DC2626;
            --warning-color: #F59E0B;
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --ok-color: #10B981;
            --error-color: #e74c3c;
            --warning-color: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        /* Applied to the tool container */
        .tool-container {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .tool-description {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.05rem;
        }
        h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        /* Small hack for combined input/select */
        .form-group select {
            width: 30%; /* Give some space for the select */
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        .form-group input + select {
             width: 30%;
        }
         .form-group input {
            width: 70%;
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            display: inline-block; /* Allow select to sit next to it */
        }
        /* Full width for inputs without a select */
        .form-group input[type="number"]:only-child,
        .form-group input[type="number"][placeholder] {
             width: 100%;
             border-right: 2px solid var(--border);
             border-radius: 6px;
        }


        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .calculator-form {
            background-color: var(--card); /* Re-using card style */
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .form-section {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        .form-section h3 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn-group .btn {
            flex: 1;
            min-width: 150px;
        }
        .btn.secondary {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn.accent {
            background: var(--accent);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        .btn.accent:hover {
             box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }
        .btn.danger {
            background: var(--danger);
             box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        .btn.danger:hover {
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }
        .btn.small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }


        /* CALCULATION STEPS DISPLAY */
        .steps-container {
            display: none;
            margin-top: 30px;
        }
        .steps-container.active {
            display: block;
        }
        .step-card {
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px; /* Spacing between cards */
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
        }
        .step-card .number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        .step-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: start;
        }
        @media (max-width: 768px) {
            .step-content {
                grid-template-columns: 1fr;
            }
        }
        .step-content .formula-block {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid var(--border);
        }
        .step-content .formula-block p {
            margin-top: 0;
        }
        .step-content .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .step-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
            line-height: 1.2;
        }
        .step-unit {
            font-size: 1rem;
            color: var(--text);
            opacity: 0.8;
            font-weight: 500;
            margin-left: 5px;
        }
        .step-explanation {
            font-size: 1.05rem;
            line-height: 1.8;
        }
        /* Specific class for calculation steps */
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--bg);
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 8px;
            color: var(--text);
            white-space: pre-wrap;
            word-break: break-word;
            border: 1px solid var(--border);
        }


        /* Results */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th,
        .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) {
            background-color: var(--bg);
        }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .results-table .highlight {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--success);
        }
        .results-table .warning {
            font-weight: 700;
            color: var(--warning);
        }
        .results-table .error {
            font-weight: 700;
            color: var(--danger);
        }

        /* Educational Section */
        .education-section {
            margin-top: 60px;
        }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i {
            font-size: 1.5rem;
        }
        .insight-card p {
            margin: 10px 0;
            line-height: 1.8;
        }
        .insight-card ol,
        .insight-card ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .insight-card li {
            margin-bottom: 10px;
        }
        .stat-highlight {
            display: inline-block;
            background: var(--accent);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin: 0 4px;
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 {
            color: var(--danger);
            margin-top: 0;
        }
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h4 {
            color: var(--success);
            margin-top: 0;
        }


        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .btn-group { flex-direction: column; }
        }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 5px;
            cursor: help;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Adjusted width */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-family: 'Inter', sans-serif; /* Professional font */
            font-size: 0.85rem; /* Slightly smaller font size */
            line-height: 1.4; /* Better readability */
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Specific styles for pH Calculator */
        .status-display {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.5s, color 0.5s;
            text-align: center;
            width: 100%;
        }
        .status-display.optimal {
            background-color: var(--ok-color);
            color: white;
        }
        .status-display.adequate {
            background-color: #34D399; /* Lighter green */
            color: white;
        }
        .status-display.warning {
            background-color: var(--warning-color);
            color: var(--heading);
        }
        .status-display.critical {
            background-color: var(--error-color);
            color: white;
        }
        
        #dynamic-recommendations {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--bg);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            color: var(--text);
            border: 1px solid var(--border);
        }
        #dynamic-recommendations h4 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        #dynamic-recommendations ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #dynamic-recommendations ul li {
            margin-bottom: 8px;
        }

    </style>
</head>
<body>
    <!-- Message box for notifications -->
    <div id="message-box" class="message-box"></div>

    <!-- New Header from file.txt -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a class='logo-container' href='/'>
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Main Tool Container -->
        <div class="tool-container">
            <h2><i class="fas fa-flask"></i> pH Sensor Temperature Compensation</h2>
                        
            <div class="tool-description">
                <p>This calculator adjusts measured pH values to a reference temperature, compensating for the temperature-dependent behavior of pH sensors (Nernst slope) and the solution itself (solution coefficient). This ensures accurate and comparable pH readings across varying process temperatures.</p>
            </div>
                    
            <div class="calculator-form">
                <form id="ph-compensation-calculator-form">
                    <!-- pH Measurement Parameters -->
                    <div class="form-section">
                        <h3><i class="fas fa-thermometer-half"></i> Measurement Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="measured-ph">Measured pH <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The pH value read directly from the sensor at the current process temperature.</span></span></label>
                                <input type="number" id="measured-ph" step="0.01" value="7.0" min="0" max="14" required>
                            </div>
                            <div class="form-group">
                                <label for="measured-temperature">Measured Temperature (T_measured) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The actual temperature of the solution at the time the pH reading was taken.</span></span></label>
                                <input type="number" id="measured-temperature" step="0.1" value="25" required>
                                <select id="measured-temperature-unit">
                                    <option value="C">°C</option>
                                    <option value="F">°F</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="reference-temperature">Reference Temperature (T_ref) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The standard temperature to which the pH reading should be corrected (e.g., 25°C for most applications).</span></span></label>
                                <input type="number" id="reference-temperature" step="0.1" value="25" required>
                                <select id="reference-temperature-unit">
                                    <option value="C">°C</option>
                                    <option value="F">°F</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="solution-temp-coefficient">Solution Temperature Coefficient (pH/°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The intrinsic change in the solution's pH per degree Celsius. This value can be positive or negative. For water, it's near zero at neutral pH. For other solutions, it can be significant.</span></span></label>
                                <input type="number" id="solution-temp-coefficient" step="0.0001" value="0.000" required>
                            </div>
                        </div>
                    </div>

                    <!-- Sensor Specific Parameters -->
                    <div class="form-section">
                        <h3><i class="fas fa-sliders-h"></i> pH Sensor Specific Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="isopotential-point">Isopotential Point (pH_iso) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The pH value at which the sensor's millivolt output does not change with temperature. Typically 7.0 pH.</span></span></label>
                                <input type="number" id="isopotential-point" step="0.01" value="7.0" min="0" max="14" required>
                            </div>
                            <div class="form-group">
                                <label for="nernst-slope">Nernst Slope at 25°C (Theoretical S_25) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The theoretical millivolt output per pH unit at 25°C. For an ideal sensor, it's 59.16 mV/pH. Used if 'Actual Measured Slope' is not provided.</span></span></label>
                                <input type="number" id="nernst-slope" step="0.01" value="59.16" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="actual-measured-slope">Actual Measured Nernst Slope (mV/pH) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The actual slope of your pH sensor obtained from a two-point calibration. If provided, this value will be used for compensation, overriding the theoretical calculation.</span></span></label>
                                <input type="number" id="actual-measured-slope" step="0.01" placeholder="e.g., 58.5 (Optional)" min="0">
                            </div>
                        </div>
                    </div>

                    <!-- Calculation Buttons -->
                    <div class="btn-group" style="margin-top: 25px;">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Compensated pH</button>
                        <button type="button" id="reset-form-btn" class="btn accent"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- NEW Step-by-Step Results Container -->
        <div id="steps-container" class="steps-container math-content">
            <!-- Step cards will be dynamically inserted here -->
        </div>

        <!-- Updated Results Section -->
        <div id="results-section" class="card hidden">
            <h3><i class="fas fa-clipboard-check"></i> Calculation Summary</h3>
            <p class="status-display" id="ph-status-display">pH Compensation Status: N/A</p>
            
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    <!-- Results will be dynamically inserted here -->
                </tbody>
            </table>

            <!-- Dynamic Recommendations -->
            <div id="dynamic-recommendations" style="display: none;">
                <h4><i class="fas fa-lightbulb"></i> Practical Considerations & Recommendations</h4>
                <ul id="recommendations-list">
                    <!-- Recommendations will be dynamically inserted here -->
                </ul>
            </div>

            <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                <button type="button" id="clear-results-btn" class="btn accent"><i class="fas fa-times-circle"></i> Clear Results</button>
            </div>

            <!-- Static Standard Reference -->
            <div class="insight-card" id="standard-reference" style="margin-top: 30px;">
                 <h4><i class="fas fa-book"></i> Applicable Standards and Guidelines</h4>
                 <p>Accurate pH measurement and temperature compensation are critical in many industries, governed by various standards and best practices:</p>
                 <ul>
                    <li><strong>ASTM D1293: Standard Test Methods for pH of Water.</strong> Provides guidelines for pH measurement, including temperature considerations.</li>
                    <li><strong>ISO 10523: Water quality — Determination of pH.</strong> International standard outlining methods for pH measurement in water.</li>
                    <li><strong>Nernst Equation:</strong> The fundamental electrochemical principle governing pH sensor behavior. The voltage output of a pH electrode is directly proportional to the absolute temperature.</li>
                    <li><strong>Isopotential Point:</strong> An important sensor characteristic. At this pH, the sensor's millivolt output is zero regardless of temperature. Most modern pH electrodes have an isopotential point near 7.0 pH.</li>
                    <li><strong>Automatic Temperature Compensation (ATC):</strong> Uses an integrated temperature element (RTD or thermistor) to continuously measure temperature and electronically adjust the pH reading. This is the recommended method.</li>
                    <li><strong>Solution Temperature Coefficient:</strong> It is
                    crucial to understand that the pH of the solution *itself*
                    changes with temperature, independently of the sensor's
                    response. This calculator accounts for this intrinsic property,
                    which is essential for highly accurate compensation.</li>
                </ul>
                <p>This tool provides an enhanced compensation based on ideal or user-provided sensor behavior. For critical process control, always use properly calibrated instruments with integrated ATC.</p>
            </div>
        </div>
        
        <!-- NEW 800-word Educational Section -->
        <div id="education-section" class="education-section card math-content">
            <h2><i class="fas fa-book-open"></i> Engineer's Guide to pH Temperature Compensation</h2>

            <div class="tool-description">
                <p>pH is one of the most common and critical measurements in process control, from water treatment to pharmaceutical manufacturing. However, it is also one of the most misunderstood, largely because of temperature. Temperature affects a pH reading in <strong>two separate and distinct ways</strong>: it changes the <strong>sensor's output (slope)</strong>, and it changes the <strong>solution's actual chemistry</strong>. This guide breaks down both effects and explains how to properly compensate for them.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-chart-line"></i> Effect 1: The Sensor's Nernstian Slope</h4>
                <p>A pH sensor is an electrochemical device (a battery) that generates a millivolt (mV) signal based on the hydrogen ion activity. The relationship between pH and mV output is defined by the <strong>Nernst Equation</strong>.</p>
                <p>The simplified equation shows that the sensor's output (slope) is directly proportional to the absolute temperature (T, in Kelvin):</p>
                <p class="formula">$$S = 2.303 \times \frac{RT}{F}$$</p>
                <p>Where:</p>
                <ul>
                    <li><strong>$S$</strong> = Nernstian Slope (in mV/pH unit)</li>
                    <li><strong>$R$</strong> = Universal Gas Constant</li>
                    <li><strong>$T$</strong> = Absolute Temperature (in Kelvin)</li>
                    <li><strong>$F$</strong> = Faraday's Constant</li>
                </ul>
                <p>This means the sensor's "sensitivity" changes with temperature. A cold sensor is "lazier" (lower slope), and a hot sensor is "more sensitive" (higher slope).</p>
                <ul>
                    <li>At 0°C (273.15 K), the ideal slope is <strong>54.20 mV/pH</strong>.</li>
                    <li>At 25°C (298.15 K), the ideal slope is <strong>59.16 mV/pH</strong>.</li>
                    <li>At 100°C (373.15 K), the ideal slope is <strong>74.04 mV/pH</strong>.</li>
                </ul>
                <p>If a pH meter isn't told the correct temperature, it will use the wrong slope to convert the sensor's mV signal into a pH value, leading to a significant error, especially far from the calibration point.</p>
            </div>

            <div class="success-box">
                <h4><i class="fas fa-check-circle"></i> The Fix: ATC and the Isopotential Point</h4>
                <p>This sensor-based error is corrected using <strong>Automatic Temperature Compensation (ATC)</strong>.</p>
                <p>Every modern pH sensor has a "crossing point" where its mV output is the same regardless of temperature. This is the <strong>Isopotential Point</strong> (typically 7.00 pH, which produces 0 mV). As the temperature changes, the slope "pivots" around this point.</p>
                
                <p><strong>How ATC Works:</strong></p>
                <ol>
                    <li>A temperature sensor (an RTD or thermistor) is built directly into the pH probe.</li>
                    <li>This sensor tells the pH transmitter (meter) the *exact* solution temperature (e.g., 85°C).</li>
                    <li>The transmitter then calculates the *correct* Nernst slope for 85°C (e.g., ~71.0 mV/pH).</li>
                    <li>It measures the sensor's raw millivolt signal (e.g., -100 mV).</li>
                    <li>It uses the correct, temperature-specific slope to accurately convert the mV reading to a pH value: $pH = pH_{iso} + (mV / S_{measuredT})$.</li>
                </ol>
                <p><strong>ATC only corrects for the sensor's change in sensitivity.</strong> It reports the *true* pH of the solution at the measured temperature.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-water"></i> Effect 2: The Solution's Actual Chemistry</h4>
                <p>This is the second, more complex effect that ATC *cannot* fix. The <strong>actual pH of the solution itself</strong> can change with temperature. This is a real, physical change in the solution's chemistry, not a sensor error.</p>
                <ul>
                    <li><strong>High-Purity Water:</strong> The dissociation of water ($H_2O \rightleftharpoons H^+ + OH^-$) is temperature-dependent.
                        <ul>
                            <li>At 25°C, the concentrations of $H^+$ and $OH^-$ are equal, and the neutral pH is <strong>7.00</strong>.</li>
                            <li>At 100°C, water dissociates more. The concentrations are still equal, but the neutral pH is now <strong>6.14</strong>.</li>
                        </ul>
                        <p>An ATC-equipped sensor placed in 100°C pure water will *correctly* read 6.14. The water is still neutral, but its pH value has changed.</p>
                    </li>
                    <li><strong>Process Solutions:</strong> The effect is even more pronounced in solutions with buffers or weak acids/bases.
                        <ul>
                            <li><strong>Ammonia (Alkaline):</strong> As temperature increases, ammonia ($NH_3$) becomes less soluble in water, and the equilibrium shifts. The pH will *decrease* significantly.</li>
                            <li><strong>Tris Buffer (Alkaline):</strong> A common lab buffer, its pH *decreases* by ~0.028 pH units for every 1°C increase.</li>
                        </ul>
                    </li>
                </ul>
                <p>This inherent chemical property is the <strong>Solution Temperature Coefficient</strong>, which this calculator allows you to input. For accurate process control, you must know this value and correct your reading back to a standard <strong>Reference Temperature</strong> (usually 25°C).</p>
            </div>

            <div class="danger-box">
                <h4><i class="fas fa-exclamation-triangle"></i> Pitfalls & Best Practices</h4>
                <p>Confusing these two effects is the most common source of error in industrial pH measurement.</p>
                <ul>
                    <li><strong>Pitfall 1: "My ATC is on, so I'm covered."</strong> Wrong. Your ATC is only correcting for the *sensor slope*. If your 80°C process reads 8.5 pH, the true pH *at 80°C* is 8.5. But if that same solution cools to 25°C, its pH might become 9.2. You must use a solution coefficient to calculate the 25°C-equivalent pH.</li>
                    <li><strong>Pitfall 2: Calibrating at the wrong temperature.</strong> Calibrating a hot sensor with room-temperature buffers (or vice-versa) introduces errors. The sensor takes time to stabilize. Always calibrate as close to the process temperature as possible, or at least allow the sensor to fully acclimate to the buffer temperature.</li>
                    <li><strong>Pitfall 3: Using an "average" slope.</strong> A sensor's true slope (its "health") drifts over time. Using the theoretical 59.16 mV/pH is an assumption. This calculator allows you to enter your *actual measured slope* from a 2-point calibration for much higher accuracy.</li>
                </ul>
                <p><strong>Best Practices:</strong></p>
                <ol>
                    <li><strong>Always use a sensor with an integrated ATC.</strong> Manual temperature correction is only for stable, non-critical lab work.</li>
                    <li><strong>Calibrate regularly.</strong> Use fresh, traceable buffers. A 2-point calibration (e.g., pH 7 and pH 4) measures the *actual* slope, which accounts for sensor aging.</li>
                    <li><strong>Understand your solution.</strong> Determine the "Solution Temperature Coefficient" for your specific process fluid. This may require lab testing or be available in technical literature for common solutions.</li>
                    <li><strong>Compare apples to apples.</strong> When comparing readings, ensure they are *all* corrected to the same reference temperature (e.g., 25°C). This calculator performs this final, crucial step.</li>
                </ol>
            </div>
        </div>

    </main>

    <!-- New Footer from file.txt -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li> 
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li> 
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Updated JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Form Elements ---
            const measuredPhInput = document.getElementById('measured-ph');
            const measuredTemperatureInput = document.getElementById('measured-temperature');
            const measuredTemperatureUnitSelect = document.getElementById('measured-temperature-unit');
            const referenceTemperatureInput = document.getElementById('reference-temperature');
            const referenceTemperatureUnitSelect = document.getElementById('reference-temperature-unit');
            const isopotentialPointInput = document.getElementById('isopotential-point');
            const nernstSlopeInput = document.getElementById('nernst-slope'); // Theoretical S25
            const actualMeasuredSlopeInput = document.getElementById('actual-measured-slope'); // Actual measured slope
            const solutionTempCoefficientInput = document.getElementById('solution-temp-coefficient');

            // --- Button & Result Elements ---
            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            
            const resultsSection = document.getElementById('results-section');
            const stepsContainer = document.getElementById('steps-container');
            const resultTableBody = document.getElementById('result-table-body');
            const phStatusDisplay = document.getElementById('ph-status-display');
            const dynamicRecommendationsDiv = document.getElementById('dynamic-recommendations');
            const recommendationsList = document.getElementById('recommendations-list');
            const messageBox = document.getElementById('message-box');
            
            // --- Default values for resetting form ---
            const defaultValues = {
                'measured-ph': 7.0,
                'measured-temperature': 25,
                'measured-temperature-unit': 'C',
                'reference-temperature': 25,
                'reference-temperature-unit': 'C',
                'isopotential-point': 7.0,
                'nernst-slope': 59.16,
                'actual-measured-slope': '', // Default to empty
                'solution-temp-coefficient': 0.000
            };

            // --- Helper for unit conversions ---
            const unitConversions = {
                temperature: {
                    'C_to_K': (T_c) => T_c + 273.15,
                    'F_to_K': (T_f) => (T_f - 32) * 5/9 + 273.15,
                    'K_to_C': (T_k) => T_k - 273.15,
                    'K_to_F': (T_k) => (T_k - 273.15) * 9/5 + 32
                }
            };
            const NERNST_REFERENCE_TEMP_K = unitConversions.temperature.C_to_K(25); // 25°C in Kelvin

            // --- New showMessage function (from template) ---
            function showMessage(msg, type = 'success') {
                messageBox.textContent = msg;
                if (type === 'error') {
                    messageBox.style.backgroundColor = 'var(--danger)';
                    messageBox.style.color = 'white';
                } else if (type === 'warning') {
                    messageBox.style.backgroundColor = 'var(--warning)';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                    messageBox.style.color = 'white';
                }
                messageBox.classList.add('show');
                setTimeout(() => messageBox.classList.remove('show'), 4000);
            }

            // --- Helper function to add rows to the result table ---
            function addResultRow(parameter, value, statusClass = '') {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
                if (statusClass) {
                    valueCell.classList.add(statusClass);
                }
            }

            // --- Clear Results Function ---
            function clearResults() {
                resultsSection.classList.add('hidden');
                stepsContainer.innerHTML = '';
                stepsContainer.classList.remove('active');
                resultTableBody.innerHTML = '';
                dynamicRecommendationsDiv.style.display = 'none';
                recommendationsList.innerHTML = '';
                phStatusDisplay.textContent = 'pH Compensation Status: N/A';
                phStatusDisplay.className = 'status-display';
                showMessage("Results cleared.", "success");
            }

            // --- Reset Form Function ---
            function resetForm() {
                for (const key in defaultValues) {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = defaultValues[key];
                    }
                }
                // Need to reset selects as well
                measuredTemperatureUnitSelect.value = defaultValues['measured-temperature-unit'];
                referenceTemperatureUnitSelect.value = defaultValues['reference-temperature-unit'];
                
                clearResults();
                showMessage("Form reset to default values.", "success");
            }

            // --- Event Listeners ---
            calculateBtn.addEventListener('click', calculateCompensation);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            // --- Main Calculation Function ---
            function calculateCompensation() {
                clearResults(); // Clear previous results
                
                let stepsHtml = '';
                let calculationFailed = false;

                // --- 1. Get and Validate Inputs ---
                let measuredPh = parseFloat(measuredPhInput.value);
                let measuredTemperature = parseFloat(measuredTemperatureInput.value);
                let referenceTemperature = parseFloat(referenceTemperatureInput.value);
                let isopotentialPoint = parseFloat(isopotentialPointInput.value);
                let nernstSlopeTheoretical = parseFloat(nernstSlopeInput.value); // Theoretical S25
                let actualMeasuredSlope = actualMeasuredSlopeInput.value !== '' ? parseFloat(actualMeasuredSlopeInput.value) : null;
                let solutionTempCoefficient = parseFloat(solutionTempCoefficientInput.value);

                if (isNaN(measuredPh) || measuredPh < 0 || measuredPh > 14) { showMessage('Measured pH must be between 0 and 14.', 'error'); calculationFailed = true; }
                if (isNaN(measuredTemperature)) { showMessage('Measured Temperature must be a number.', 'error'); calculationFailed = true; }
                if (isNaN(referenceTemperature)) { showMessage('Reference Temperature must be a number.', 'error'); calculationFailed = true; }
                if (isNaN(isopotentialPoint) || isopotentialPoint < 0 || isopotentialPoint > 14) { showMessage('Isopotential Point must be between 0 and 14.', 'error'); calculationFailed = true; }
                if (isNaN(nernstSlopeTheoretical) || nernstSlopeTheoretical <= 0) { showMessage('Theoretical Nernst Slope must be a positive number.', 'error'); calculationFailed = true; }
                if (actualMeasuredSlope !== null && (isNaN(actualMeasuredSlope) || actualMeasuredSlope <= 0)) { showMessage('Actual Measured Nernst Slope must be a positive number if provided.', 'error'); calculationFailed = true; }
                if (isNaN(solutionTempCoefficient)) { showMessage('Solution Temperature Coefficient must be a number.', 'error'); calculationFailed = true; }

                if (calculationFailed) return;

                // --- Step 1: Input Parameters & Temp Conversion ---
                const measuredTemperatureK = measuredTemperatureUnitSelect.value === 'C' ? unitConversions.temperature.C_to_K(measuredTemperature) : unitConversions.temperature.F_to_K(measuredTemperature);
                const referenceTemperatureK = referenceTemperatureUnitSelect.value === 'C' ? unitConversions.temperature.C_to_K(referenceTemperature) : unitConversions.temperature.F_to_K(referenceTemperature);
                const measuredTemperatureC = measuredTemperatureUnitSelect.value === 'C' ? measuredTemperature : unitConversions.temperature.K_to_C(measuredTemperatureK);
                const referenceTemperatureC = referenceTemperatureUnitSelect.value === 'C' ? referenceTemperature : unitConversions.temperature.K_to_C(referenceTemperatureK);
                
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">1</span>Input Parameters & Temperature Conversion</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>Inputs are validated and temperatures are converted to Kelvin (K) for Nernst calculations and Celsius (°C) for solution coefficient calculations.</p>
                            <p class="calculation-step">Measured pH: ${measuredPh.toFixed(2)}</p>
                            <p class="calculation-step">T_measured: ${measuredTemperature.toFixed(1)} ${measuredTemperatureUnitSelect.value} = ${measuredTemperatureK.toFixed(2)} K</p>
                            <p class="calculation-step">T_ref: ${referenceTemperature.toFixed(1)} ${referenceTemperatureUnitSelect.value} = ${referenceTemperatureK.toFixed(2)} K</p>
                            <p class="calculation-step">pH_iso: ${isopotentialPoint.toFixed(2)}</p>
                            <p class="calculation-step">Solution Coeff: ${solutionTempCoefficient.toFixed(4)} pH/°C</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Conversions:</strong></p>
                            <p class="formula">$$K = {°}C + 273.15$$</p>
                            <p class="formula">$$K = ({°}F - 32) \times 5/9 + 273.15$$</p>
                        </div>
                    </div>
                </div>`;

                // --- 2. Determine Nernst Slope for Calculations ---
                let baseSlope;
                let slopeSourceDescription;
                if (actualMeasuredSlope !== null) {
                    baseSlope = actualMeasuredSlope;
                    slopeSourceDescription = `Using <strong>Actual Measured Slope</strong> as the base slope (S_base) for scaling.`;
                } else {
                    baseSlope = nernstSlopeTheoretical;
                    slopeSourceDescription = `Using <strong>Theoretical Slope @ 25°C</strong> as the base slope (S_base) for scaling.`;
                }
                
                const nernstSlopeAtMeasuredT = baseSlope * (measuredTemperatureK / NERNST_REFERENCE_TEMP_K);
                const nernstSlopeAtReferenceT = baseSlope * (referenceTemperatureK / NERNST_REFERENCE_TEMP_K);

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">2</span>Calculate Temperature-Dependent Nernst Slopes</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>${slopeSourceDescription}</p>
                            <p class="calculation-step">S_base = ${baseSlope.toFixed(2)} mV/pH</p>
                            <p class="calculation-step">S_measured = ${baseSlope.toFixed(2)} * (${measuredTemperatureK.toFixed(2)} K / ${NERNST_REFERENCE_TEMP_K.toFixed(2)} K)</p>
                            <p class="calculation-step">S_ref = ${baseSlope.toFixed(2)} * (${referenceTemperatureK.toFixed(2)} K / ${NERNST_REFERENCE_TEMP_K.toFixed(2)} K)</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formula:</strong></p>
                            <p class="formula">$$S_T = S_{base} \times \frac{T_K}{T_{25K}}$$</p>
                            <p><strong>Nernst Slope @ T_measured (S_measured):</strong></p>
                            <div class="step-value">${nernstSlopeAtMeasuredT.toFixed(2)}<span class="step-unit">mV/pH</span></div>
                            <p><strong>Nernst Slope @ T_ref (S_ref):</strong></p>
                            <div class="step-value">${nernstSlopeAtReferenceT.toFixed(2)}<span class="step-unit">mV/pH</span></div>
                        </div>
                    </div>
                </div>`;

                // --- 3. Calculate Sensor Millivolt Output ---
                const phOffsetMeasured = measuredPh - isopotentialPoint;
                const mVOutputMeasured = phOffsetMeasured * nernstSlopeAtMeasuredT;
                
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">3</span>Calculate Sensor Millivolt Output</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>Calculates the raw millivolt signal the sensor is producing at the measured temperature.</p>
                            <p class="calculation-step">Offset = ${measuredPh.toFixed(2)} pH - ${isopotentialPoint.toFixed(2)} pH_iso = ${phOffsetMeasured.toFixed(2)} pH</p>
                            <p class="calculation-step">mV = ${phOffsetMeasured.toFixed(2)} pH * ${nernstSlopeAtMeasuredT.toFixed(2)} mV/pH</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formula:</strong></p>
                            <p class="formula">$$mV = (pH_{measured} - pH_{iso}) \times S_{measured}$$</p>
                            <p><strong>Calculated mV Output:</strong></p>
                            <div class="step-value">${mVOutputMeasured.toFixed(2)}<span class="step-unit">mV</span></div>
                        </div>
                    </div>
                </div>`;

                // --- 4. Calculate Sensor-Only Compensated pH ---
                let phSensorCompensated = isopotentialPoint + (mVOutputMeasured / nernstSlopeAtReferenceT);
                
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">4</span>Calculate Sensor-Compensated pH (at T_ref)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>Converts the calculated millivolt signal back to a pH value, but using the Nernst slope for the <strong>reference temperature</strong>. This is what a standard ATC performs.</p>
                            <p class="calculation-step">pH = ${isopotentialPoint.toFixed(2)} pH_iso + (${mVOutputMeasured.toFixed(2)} mV / ${nernstSlopeAtReferenceT.toFixed(2)} mV/pH)</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formula:</strong></p>
                            <p class="formula">$$pH_{ATC} = pH_{iso} + \frac{mV}{S_{ref}}$$</p>
                            <p><strong>Sensor-Compensated pH (pH_ATC):</strong></p>
                            <div class="step-value">${phSensorCompensated.toFixed(2)}<span class="step-unit">pH</span></div>
                        </div>
                    </div>
                </div>`;
                
                // --- 5. Apply Solution Temperature Coefficient ---
                const solutionPhCorrection = (measuredTemperatureC - referenceTemperatureC) * solutionTempCoefficient;
                let compensatedPhFinal = phSensorCompensated - solutionPhCorrection; // Correction: The formula provided in the old JS was + solutionPhCorrection. The standard formula is pH_ref = pH_measured - Coeff*(T_measured - T_ref). The provided JS did pH_compensated + Coeff*(T_measured - T_ref). Let's re-verify.
                // Re-verification:
                // pH_measured = pH_ref + Coeff * (T_measured - T_ref)  <-- This is the physical change
                // Therefore, pH_ref = pH_measured - Coeff * (T_measured - T_ref)
                // In our case, pH_measured is `phSensorCompensated` (which is the true pH at T_measured)
                // So, Final_pH_at_T_ref = phSensorCompensated - solutionPhCorrection
                // The old code had `+ solutionPhCorrection`. This was incorrect. I will fix it to `-`.
                
                compensatedPhFinal = Math.max(0, Math.min(14, compensatedPhFinal)); // Clamp final value

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">5</span>Apply Solution Compensation (Final pH)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>Applies the solution's own temperature coefficient to correct the reading from the measured temperature (T_measured) back to the reference temperature (T_ref).</p>
                            <p class="calculation-step">ΔT = ${measuredTemperatureC.toFixed(1)}°C - ${referenceTemperatureC.toFixed(1)}°C = ${(measuredTemperatureC - referenceTemperatureC).toFixed(1)}°C</p>
                            <p class="calculation-step">Solution Correction = ${(measuredTemperatureC - referenceTemperatureC).toFixed(1)}°C * ${solutionTempCoefficient.toFixed(4)} pH/°C = ${solutionPhCorrection.toFixed(4)} pH</p>
                            <p class="calculation-step">Final pH = ${phSensorCompensated.toFixed(2)} pH - ${solutionPhCorrection.toFixed(4)} pH</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formula:</strong></p>
                            <p class="formula">$$pH_{final} = pH_{ATC} - (Coeff \times (T_{measured} - T_{ref}))$$</p>
                            <p><strong>Final Compensated pH (at T_ref):</strong></p>
                            <div class="step-value">${compensatedPhFinal.toFixed(2)}<span class="step-unit">pH</span></div>
                        </div>
                    </div>
                </div>`;
                
                // --- Display Results ---
                stepsContainer.innerHTML = stepsHtml;
                stepsContainer.classList.add('active');
                
                // --- Populate Summary Table ---
                resultTableBody.innerHTML = '';
                addResultRow(`<strong>Final Compensated pH (at ${referenceTemperature.toFixed(1)} ${referenceTemperatureUnitSelect.value})</strong>`, `<strong>${compensatedPhFinal.toFixed(2)}</strong>`, "highlight");
                addResultRow(`Measured pH (at ${measuredTemperature.toFixed(1)} ${measuredTemperatureUnitSelect.value})`, `${measuredPh.toFixed(2)}`);
                addResultRow(`Sensor-Only Compensated pH (ATC)`, `${phSensorCompensated.toFixed(2)}`);
                addResultRow(`Solution Temperature Coefficient`, `${solutionTempCoefficient.toFixed(4)} pH/°C`);
                addResultRow(`Nernst Slope @ T_measured`, `${nernstSlopeAtMeasuredT.toFixed(2)} mV/pH`);
                addResultRow(`Nernst Slope @ T_ref`, `${nernstSlopeAtReferenceT.toFixed(2)} mV/pH`);
                addResultRow(`Calculated Sensor Output`, `${mVOutputMeasured.toFixed(2)} mV`);
                addResultRow(`Slope Source`, slopeSourceDescription.replace(/<[^>]*>/g, '')); // Remove HTML for table

                // --- Update Status Display and Recommendations ---
                let statusText = 'pH Compensation Status: ';
                let statusClass = 'status-display ';
                let recommendations = [];

                const tempDiff = Math.abs(measuredTemperatureC - referenceTemperatureC);
                
                if (tempDiff < 0.1) {
                    statusText += 'Optimal (No Compensation Needed)';
                    statusClass += 'optimal';
                    recommendations.push("Measured temperature is at the reference temperature. No compensation is applied.");
                } else if (tempDiff < 5) {
                    statusText += 'Adequate (Minor Compensation)';
                    statusClass += 'adequate';
                    recommendations.push("A minor temperature difference exists. Compensation is applied and should be reliable.");
                } else if (tempDiff < 20) {
                    statusText += 'Warning (Moderate Compensation)';
                    statusClass += 'warning';
                    recommendations.push("A moderate temperature difference exists. Ensure your sensor's actual slope and isopotential point are accurate for best results.");
                } else {
                    statusText += 'Critical (Significant Compensation)';
                    statusClass += 'critical';
                    recommendations.push("A significant temperature difference exists. Results are highly dependent on the accuracy of the Nernst slope and solution coefficient. Verify these values.");
                }

                if (actualMeasuredSlope === null) {
                    recommendations.push("<strong>Recommendation:</strong> For higher accuracy, perform a 2-point calibration and enter the 'Actual Measured Nernst Slope'.");
                }
                if (solutionTempCoefficient === 0 && tempDiff > 5) {
                     recommendations.push("<strong>Warning:</strong> 'Solution Temperature Coefficient' is 0.000. This assumes the solution's pH does not change with temperature, which is only true for some solutions (like neutral water). Verify if this is correct for your process fluid.");
                } else if (solutionTempCoefficient !== 0) {
                     recommendations.push("The 'Solution Temperature Coefficient' has been applied, correcting for the solution's intrinsic chemical change with temperature.");
                }

                recommendationsList.innerHTML = '';
                recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.innerHTML = rec; // Use innerHTML for bold tags
                    recommendationsList.appendChild(li);
                });
                dynamicRecommendationsDiv.style.display = 'block';

                phStatusDisplay.textContent = statusText;
                phStatusDisplay.className = statusClass;

                resultsSection.classList.remove('hidden');
                
                // Typeset MathJax
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    setTimeout(() => {
                        window.MathJax.typesetPromise([stepsContainer, document.getElementById('education-section')]);
                    }, 50); 
                }

                setTimeout(() => {
                    stepsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }

            // --- Theme switch logic (from new file) ---
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // --- Initial setup calls ---
            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });
        });
    </script>
</body>
</html>
