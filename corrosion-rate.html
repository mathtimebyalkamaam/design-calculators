<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrosion Rate Calculator - Design Calculators - Mechanical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Variables for theming (light and dark mode) */
        :root {
            --primary-color: #2196F3;
            --secondary-color: #1976D2;
            --accent-color: #FFC107;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --header-bg: #2C3E50;
            --footer-bg: #34495E;
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            --hover-color: #e2e6ea;
            --primary-color-rgb: 33, 150, 243;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #FFC107; /* Added for warning messages */
        }
        /* Dark mode overrides */
        body.dark-mode {
            --primary-color: #5DADE2;
            --secondary-color: #2874A6;
            --bg-color: #252D3A;
            --card-bg: #2F3C4C;
            --text-color: #E0E6EB;
            --header-bg: #252D3A;
            --footer-bg: #252D3A;
            --border-color: #4C5C70;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #3A475C;
            --primary-color-rgb: 93, 173, 226;
            --success-color: #4CAF50;
            --error-color: #F44336;
            --warning-color: #FFEB3B; /* Dark mode warning color */
        }
        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, var(--bg-color) 0%, rgba(244, 247, 246, 0.8) 100%);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s, background-image 0.3s;
        }
        /* Container for content width limitation and centering */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }
        /* Header styling */
        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        header h1 {
            margin: 0;
            font-size: 2.8em;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        header .subtitle {
            margin: 8px 0 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }
        /* Main content area styling */
        main {
            padding: 30px 0;
        }
        /* Tool container styling */
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            transition: transform 0.3s ease-in-out;
        }
        .tool-container:hover {
            transform: translateY(-5px);
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 2em;
        }
        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1.05em;
        }
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }
        .tool-description strong {
            color: var(--primary-color);
        }
        /* Back button styling */
        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 25px;
            margin-left: 20px; /* Adjusted to align with container padding */
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            font-weight: bold;
        }
        .back-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.03);
        }
        /* Theme toggle switch styling */
        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
        }
        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px;
            font-size: 1.3em;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 65px;
            height: 38px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(27px);
        }
        .slider.round {
            border-radius: 38px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        /* Footer styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }
        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.3em;
        }
        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }
        .social-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        /* Specific social button colors */
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #7f8c8d; }

        /* Calculator Specific Styling */
        .calculator-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 25px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 1.1em;
        }
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            color: var(--text-color);
            background-color: var(--bg-color);
            box-sizing: border-box; /* Include padding in width */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.2);
            outline: none;
        }
        .form-group input[type="text"]:hover,
        .form-group input[type="number"]:hover,
        .form-group select:hover {
            border-color: var(--secondary-color);
        }

        .input-with-unit {
            display: flex;
            align-items: center;
        }
        .input-with-unit input {
            flex-grow: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
        }
        .input-with-unit .unit-label {
            padding: 12px 15px;
            background-color: var(--hover-color);
            border: 1px solid var(--border-color);
            border-left: none;
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
            color: var(--text-color);
            font-weight: bold;
        }
        .calculate-button {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .calculate-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(var(--primary-color-rgb), 0.4);
        }
        .calculate-button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .result-container {
            background-color: var(--bg-color);
            border: 1px dashed var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }
        .result-container h3 {
            color: var(--secondary-color);
            margin-top: 0;
            font-size: 1.6em;
            margin-bottom: 15px;
        }
        .result-value {
            font-size: 2.2em;
            font-weight: bold;
            color: var(--primary-color);
            animation: pulse 1.5s infinite alternate; /* Result animation */
        }
        .result-details {
            margin-top: 20px;
            text-align: left;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }
        .result-details p {
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .result-details strong {
            color: var(--secondary-color);
        }
        .result-details .math-step {
            font-size: 1.1em;
            font-weight: bold;
            margin: 10px 0;
            background-color: var(--hover-color);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: left;
        }
        .result-details .final-formula {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            margin: 15px 0;
        }


        .result-description {
            font-size: 1em;
            color: var(--text-color);
            margin-top: 10px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.02); }
        }

        /* Loading spinner animation */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }
        .calculate-button.loading .spinner {
            display: block; /* Show when loading */
        }
        .calculate-button.loading span {
            visibility: hidden; /* Hide text when loading */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom message box for alerts */
        #custom-message-box {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, background-color 0.3s;
            font-size: 1.1em;
            white-space: nowrap; /* Prevent text wrapping */
        }
        #custom-message-box.info {
            background-color: var(--success-color);
        }
        #custom-message-box.error {
            background-color: var(--error-color);
        }
        #custom-message-box.warning {
            background-color: var(--warning-color);
            color: #333;
        }

        /* Responsive adjustments */
        @media (min-width: 768px) {
            .calculator-form {
                grid-template-columns: 1fr 1fr; /* Two columns on larger screens */
            }
            .full-width {
                grid-column: span 2; /* Make elements span full width */
            }
        }
        @media (max-width: 600px) {
            header h1 {
                font-size: 2.2em;
            }
            header .subtitle {
                font-size: 0.9em;
            }
            .theme-toggle {
                top: 15px;
                right: 15px;
            }
            .tool-container {
                padding: 20px;
            }
            .form-group input[type="text"],
            .form-group input[type="number"],
            .form-group select {
                padding: 10px;
                font-size: 0.9em;
            }
            .calculate-button {
                padding: 12px 20px;
                font-size: 1em;
            }
            .result-value {
                font-size: 1.8em;
            }
        }
    </style>
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script"
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        // MathJax configuration to support inline and display LaTeX
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };
    </script>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Mechanical</h1>
            <p class="subtitle">World-Class Corrosion Rate Calculator for Mechanical Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>
    <!-- Back to Tools Button -->
    <a href="indexMech.html" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to Tools
    </a>

    <main class="container">
        <div class="tool-container">
            <h2>Corrosion Rate Calculation</h2>
            <div class="tool-description">
                <p>This calculator determines the corrosion rate of a material based on weight loss measurements. Understanding corrosion rate is crucial for predicting material degradation, estimating equipment lifespan, and ensuring process safety in various industrial environments.</p>
                <p>The corrosion rate (CR) is typically calculated using the following formula:</p>
                <p style="text-align: center; font-size: 1.2em; font-weight: bold;">
                    \[ CR = \frac{K \times W}{D \times A \times T} \]
                </p>
                <ul>
                    <li>\( CR \): Corrosion Rate (mils per year or mm per year)</li>
                    <li>\( K \): Constant (534 for mpy; 87.6 for mm/yr)</li>
                    <li>\( W \): Weight Loss (mg)</li>
                    <li>\( D \): Material Density (\( g/cm^3 \))</li>
                    <li>\( A \): Exposed Surface Area (\( in^2 \) for mpy; \( cm^2 \) for mm/yr)</li>
                    <li>\( T \): Exposure Time (hours)</li>
                </ul>
                <p class="warning-note" style="color: var(--error-color); font-weight: bold;">
                    <strong>Important Note:</strong> This calculator provides an estimated corrosion rate. Actual corrosion behavior can be influenced by many factors including temperature, pressure, fluid velocity, aeration, impurities, and material microstructure. Always validate results with experimental data and consult NACE standards (e.g., NACE RP0775) and material specialists for critical applications.
                </p>
            </div>

            <div class="calculator-form">
                <div class="form-group">
                    <label for="materialName">Material Name (Custom):</label>
                    <input type="text" id="materialName" value="Custom Material" placeholder="e.g., Stainless Steel 316">
                </div>
                 <div class="form-group">
                    <label for="materialSelect">Or Select a Common Material:</label>
                    <select id="materialSelect">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="weightLoss">Weight Loss (W):</label>
                    <div class="input-with-unit">
                        <input type="number" id="weightLoss" value="10" min="0" step="0.01" placeholder="Enter weight loss">
                        <span class="unit-label">mg</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="density">Material Density (D):</label>
                    <div class="input-with-unit">
                        <input type="number" id="density" value="7.85" min="0.01" step="0.01" placeholder="Enter material density">
                        <span class="unit-label">g/cm³</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="surfaceArea">Exposed Surface Area (A):</label>
                    <div class="input-with-unit">
                        <input type="number" id="surfaceArea" value="10" min="0.01" step="0.01" placeholder="Enter surface area">
                        <span class="unit-label" id="surfaceAreaUnit">cm²</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="exposureTime">Exposure Time (T):</label>
                    <div class="input-with-unit">
                        <input type="number" id="exposureTime" value="1000" min="1" step="1" placeholder="Enter exposure time">
                        <span class="unit-label">hours</span>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="outputUnit">Output Corrosion Rate Unit:</label>
                    <select id="outputUnit">
                        <option value="mpy">mils per year (mpy)</option>
                        <option value="mmpy" selected>millimeters per year (mm/yr)</option>
                    </select>
                </div>

                <button type="button" id="calculateBtn" class="calculate-button full-width">
                    <span class="button-text">Calculate Corrosion Rate</span>
                    <div class="spinner"></div>
                </button>
            </div>

            <div id="resultContainer" class="result-container">
                <h3>Calculated Corrosion Rate</h3>
                <div class="result-details">
                    <p><strong>Material:</strong> <span id="displayMaterialName">--</span></p>
                    <p><strong>Input Values:</strong></p>
                    <p>Weight Loss (W): <span id="displayWeightLoss">--</span> mg</p>
                    <p>Material Density (D): <span id="displayDensity">--</span> g/cm³</p>
                    <p>Exposed Surface Area (A): <span id="displaySurfaceArea">--</span> <span id="displaySurfaceAreaUnit">cm²</span></p>
                    <p>Exposure Time (T): <span id="displayExposureTime">--</span> hours</p>
                    <p>Constant (K): <span id="displayConstantK">--</p>

                    <p style="text-align: left; margin-top: 15px;"><strong>Calculation Steps:</strong></p>

                    <p class="math-step">
                        Step 1: Calculate Numerator
                        <br> \( \text{Numerator} = K \times W \)
                        <br> \( \text{Numerator} = \text{<span id="formulaK_step"></span>} \times \text{<span id="formulaW_step"></span>} = \text{<span id="numeratorResult"></span>} \)
                    </p>
                    <p class="math-step">
                        Step 2: Calculate Denominator
                        <br> \( \text{Denominator} = D \times A \times T \)
                        <br> \( \text{Denominator} = \text{<span id="formulaD_step"></span>} \times \text{<span id="formulaA_step"></span>} \times \text{<span id="formulaT_step"></span>} = \text{<span id="denominatorResult"></span>} \)
                    </p>
                    <p class="final-formula">
                        Step 3: Calculate Corrosion Rate (CR)
                        <br> \[ CR = \frac{\text{<span id="finalNumeratorValue"></span>}}{\text{<span id="finalDenominatorValue"></span>}} = \text{<span id="finalCRFormula"></span>} \]
                    </p>
                </div>
                <p style="text-align: left; margin-top: 20px;"><strong>Final Corrosion Rate:</strong></p>
                <p class="result-value" id="corrosionRateValue">--</p>
                <p class="result-description" id="corrosionRateDescription"></p>
                <p class="result-recommendation" id="corrosionRateRecommendation" style="margin-top: 15px; font-weight: bold;"></p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>This Corrosion Rate Calculator is a general estimation tool. It is crucial to understand that corrosion is a complex phenomenon influenced by numerous variables. Therefore, this tool should not be used as the sole basis for critical engineering decisions or material selection.</p>
                <ul>
                    <li><strong>Professional Expertise:</strong> Always consult with qualified corrosion engineers or material scientists for complex and safety-critical applications.</li>
                    <li><strong>Real-World Conditions:</strong> Laboratory corrosion rates may differ significantly from those in actual operating environments. Factors like fluid dynamics, surface finish, and galvanic coupling play a major role.</li>
                    <li><strong>Standards Compliance:</strong> Ensure all material selections and design decisions comply with relevant industry standards (e.g., ASME, API, NACE) and local regulations.</li>
                </ul>
                <p>Design Calculators - Mechanical is not liable for any damages or losses arising from the use of this calculator. Use this tool for preliminary assessment and educational purposes only.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Mechanical - Corrosion Rate Calculator" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Corrosion Rate Calculator for Mechanical Engineers!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Corrosion Rate Calculator for Mechanical Engineers! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Mechanical - Corrosion Rate Calculator" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="mailto:?subject=Check out Design Calculators - Mechanical - Corrosion Rate Calculator!&body=I found this amazing Corrosion Rate Calculator for Mechanical Engineers: https://designcalculators.co.in" class="social-btn email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to display custom messages (info, error, warning)
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add(type); // Add type class for styling
                messageBox.style.opacity = 1;

                // Hide message after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            // Theme switch functionality
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                // Check local storage for theme preference on load
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                } else {
                    document.body.classList.remove('dark-mode');
                    themeSwitch.checked = false;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                        displayMessage("Dark mode enabled!", "info");
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                        displayMessage("Light mode enabled!", "info");
                    }
                });
            }

            // Material Densities for dropdown
            const materialDensities = {
                "Select Material": "", // Empty string to indicate no density selected
                "Carbon Steel (Typical)": 7.85,
                "Stainless Steel 304": 8.00,
                "Stainless Steel 316": 8.00,
                "Duplex Stainless Steel 2205": 7.80,
                "Super Duplex 2507": 7.83,
                "Hastelloy C-276": 8.90,
                "Inconel 625": 8.44,
                "Monel 400": 8.80,
                "Alloy 20": 8.05,
                "Titanium (Grade 2)": 4.51,
                "Zirconium (Grade 702)": 6.51,
                "Copper": 8.96,
                "Brass": 8.47,
                "Bronze": 8.70,
                "Aluminum (6061)": 2.70,
                "Lead": 11.34,
                "Nickel 200": 8.89,
                "Tantalum": 16.69,
                "PTFE (Teflon)": 2.20,
                "Kynar (PVDF)": 1.78,
                "HDPE (High-Density Polyethylene)": 0.95,
                "LDPE (Low-Density Polyethylene)": 0.92,
                "PP (Polypropylene)": 0.91,
                "PVCC (Chlorinated PVC)": 1.50,
                "Polycarbonate": 1.20,
                "Nylon 6/6": 1.14,
                "Polyurethane": 1.20,
                "Viton (FKM)": 1.85,
                "EPDM": 0.86,
                "Nitrile (Buna-N)": 1.00,
                "Natural Rubber": 0.92,
                "Silicone": 1.10,
                "Neoprene (Chloroprene)": 1.23,
                "Butyl Rubber": 0.92,
                "PTFE Lined Steel": 7.85, // Density of steel base
                "Borosilicate Glass": 2.23,
                "Graphite": 1.80,
                "Ceramic (Alumina)": 3.95,
                "Silicon Carbide": 3.10,
                "Zirconia": 5.68,
                "Glass Lined Steel": 7.85, // Density of steel base
            };

            // Calculator logic
            const calculateBtn = document.getElementById('calculateBtn');
            const materialNameInput = document.getElementById('materialName');
            const materialSelect = document.getElementById('materialSelect');
            const weightLossInput = document.getElementById('weightLoss');
            const densityInput = document.getElementById('density');
            const surfaceAreaInput = document.getElementById('surfaceArea');
            const exposureTimeInput = document.getElementById('exposureTime');
            const outputUnitSelect = document.getElementById('outputUnit');
            const surfaceAreaUnitLabel = document.getElementById('surfaceAreaUnit');
            const resultContainer = document.getElementById('resultContainer');
            const corrosionRateValue = document.getElementById('corrosionRateValue');
            const corrosionRateDescription = document.getElementById('corrosionRateDescription');
            const corrosionRateRecommendation = document.getElementById('corrosionRateRecommendation');

            // Elements for displaying calculation details
            const displayMaterialName = document.getElementById('displayMaterialName');
            const displayWeightLoss = document.getElementById('displayWeightLoss');
            const displayDensity = document.getElementById('displayDensity');
            const displaySurfaceArea = document.getElementById('displaySurfaceArea');
            const displaySurfaceAreaUnit = document.getElementById('displaySurfaceAreaUnit');
            const displayExposureTime = document.getElementById('displayExposureTime');
            const displayConstantK = document.getElementById('displayConstantK');

            const formulaK_step = document.getElementById('formulaK_step');
            const formulaW_step = document.getElementById('formulaW_step');
            const numeratorResult = document.getElementById('numeratorResult');
            const formulaD_step = document.getElementById('formulaD_step');
            const formulaA_step = document.getElementById('formulaA_step');
            const formulaT_step = document.getElementById('formulaT_step');
            const denominatorResult = document.getElementById('denominatorResult');
            const finalNumeratorValue = document.getElementById('finalNumeratorValue');
            const finalDenominatorValue = document.getElementById('finalDenominatorValue');
            const finalCRFormula = document.getElementById('finalCRFormula');


            // Populate material dropdown
            for (const material in materialDensities) {
                const option = document.createElement('option');
                option.value = material;
                option.textContent = material;
                materialSelect.appendChild(option);
            }

            // Event listener for material selection
            materialSelect.addEventListener('change', function() {
                const selectedMaterial = this.value;
                if (selectedMaterial === "Select Material") {
                    materialNameInput.value = "Custom Material";
                    densityInput.value = ""; // Clear density if "Select Material"
                } else {
                    materialNameInput.value = selectedMaterial; // Update custom material name
                    densityInput.value = materialDensities[selectedMaterial];
                }
            });

            // Update surface area unit based on output unit selection
            outputUnitSelect.addEventListener('change', function() {
                if (this.value === 'mpy') {
                    surfaceAreaUnitLabel.textContent = 'in²';
                } else {
                    surfaceAreaUnitLabel.textContent = 'cm²';
                }
            });

            calculateBtn.addEventListener('click', function() {
                this.classList.add('loading'); // Show spinner
                resultContainer.classList.remove('show'); // Hide previous result

                setTimeout(() => { // Simulate calculation delay for animation
                    const material = materialNameInput.value.trim(); // Get material name
                    const W = parseFloat(weightLossInput.value);
                    const D = parseFloat(densityInput.value);
                    const A = parseFloat(surfaceAreaInput.value);
                    const T = parseFloat(exposureTimeInput.value);
                    const unit = outputUnitSelect.value;

                    // Input validation
                    if (!material) {
                        displayMessage("Please enter a Material Name or select one.", "error");
                        this.classList.remove('loading');
                        return;
                    }
                    if (isNaN(W) || W < 0 || isNaN(D) || D <= 0 || isNaN(A) || A <= 0 || isNaN(T) || T <= 0) {
                        displayMessage("Please enter valid positive numbers for all quantitative fields.", "error");
                        this.classList.remove('loading');
                        return;
                    }

                    let K;
                    if (unit === 'mpy') {
                        K = 534; // For mils per year
                    } else {
                        K = 87.6; // For millimeters per year
                    }

                    // Calculate corrosion rate
                    const numerator = K * W;
                    const denominator = D * A * T;
                    const CR = numerator / denominator;


                    // Display input values in results
                    displayMaterialName.textContent = material;
                    displayWeightLoss.textContent = W.toFixed(2);
                    displayDensity.textContent = D.toFixed(2);
                    displaySurfaceArea.textContent = A.toFixed(2);
                    displaySurfaceAreaUnit.textContent = surfaceAreaUnitLabel.textContent; // Use the current unit label
                    displayExposureTime.textContent = T.toFixed(0); // Time can be integer
                    displayConstantK.textContent = K;

                    // Display formula with values for step-by-step
                    formulaK_step.textContent = K;
                    formulaW_step.textContent = W.toFixed(2);
                    numeratorResult.textContent = numerator.toFixed(4);

                    formulaD_step.textContent = D.toFixed(2);
                    formulaA_step.textContent = A.toFixed(2);
                    formulaT_step.textContent = T.toFixed(0);
                    denominatorResult.textContent = denominator.toFixed(4);

                    finalNumeratorValue.textContent = numerator.toFixed(4);
                    finalDenominatorValue.textContent = denominator.toFixed(4);
                    finalCRFormula.textContent = CR.toFixed(4) + ' ' + unit; // Correctly set the final value inside MathJax


                    // Re-render MathJax after updating content
                    if (window.MathJax) {
                        // Give MathJax a very small moment to ensure its functions are fully loaded
                        // before attempting to typeset dynamically added content.
                        // This is a common workaround if startup.promise is not behaving as expected
                        // in certain environments (like iframes).
                        setTimeout(() => {
                            if (typeof window.MathJax.typesetPromise === 'function') {
                                window.MathJax.typesetPromise().catch(err => {
                                    console.error("MathJax typesetting error after timeout:", err);
                                });
                            } else {
                                console.error("MathJax.typesetPromise is still not a function even after a short delay.");
                            }
                        }, 50); // A very short delay to allow MathJax internal setup to complete
                    } else {
                        console.warn("MathJax object not found. Cannot typeset content.");
                    }


                    corrosionRateValue.textContent = CR.toFixed(4) + ' ' + unit; // Final result at the bottom

                    // Get CSS custom properties for dynamic color assignment
                    const style = getComputedStyle(document.documentElement);
                    const successColor = style.getPropertyValue('--success-color');
                    const goodColor = '#5cb85c'; // Directly defined in CSS, no var
                    const warningColor = style.getPropertyValue('--warning-color');
                    const errorColor = style.getPropertyValue('--error-color');

                    // Provide a description and recommendation based on typical rates (general guidance)
                    let description = "";
                    let recommendation = "";
                    let recommendationColor = "";

                    if (CR < 0.02) {
                        description = "This rate is considered excellent for most applications.";
                        recommendation = "Material exhibits outstanding corrosion resistance.";
                        recommendationColor = successColor;
                    } else if (CR >= 0.02 && CR < 0.2) {
                        description = "This rate is considered good; acceptable for many applications.";
                        recommendation = "Material is generally suitable, but regular inspection is advised.";
                        recommendationColor = goodColor;
                    } else if (CR >= 0.2 && CR < 1.0) {
                        description = "This rate is considered fair; corrosion is noticeable.";
                        recommendation = "Consider alternative materials or protective measures for long-term service.";
                        recommendationColor = warningColor;
                    } else {
                        description = "This rate is considered poor; significant material degradation expected.";
                        recommendation = "This material is generally unsuitable for this environment. Immediate action and material change are recommended.";
                        recommendationColor = errorColor;
                    }

                    corrosionRateDescription.textContent = description;
                    corrosionRateRecommendation.textContent = recommendation;
                    corrosionRateRecommendation.style.color = recommendationColor;

                    resultContainer.classList.add('show'); // Show results with animation

                    this.classList.remove('loading'); // Hide spinner
                    displayMessage("Corrosion rate calculated successfully!", "info");
                }, 500); // Small delay to show spinner
            });
        });
    </script>
</body>
</html>
