<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrosion Rate Calculator - Industrial Grade</title>
    <meta name="description" content="Professional Corrosion Rate Calculator (MPY & mm/yr). Calculate metal loss, remaining service life, and pitting severity. Features NACE standard analysis and PDF reporting.">
    <meta name="keywords" content="corrosion rate calculator, mpy calculator, weight loss method, NACE standard, mm/yr, remaining life, pitting factor, engineering calculator">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial - Matches Symmetrical Components) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Quick Load Buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .highlight { color: var(--success); font-weight: 700; }
        .danger-text { color: var(--danger); font-weight: 700; }
        .warning-text { color: var(--warning); font-weight: 700; }

        /* Calculation Steps Styling */
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(37, 99, 235, 0.05); /* Light Blue Tint */
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(37, 99, 235, 0.1); }
        
        .calculation-step h4 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 5px;
        }

        /* Chart Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 350px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Educational Section Styling */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .insight-card p, .insight-card ul {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text);
        }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }

        /* Vector Input Group Styling (Reused) */
        .vector-input-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-group-append {
            display: flex;
            align-items: center;
        }
        .input-group-append input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: 0;
        }
        .unit-label {
            background: var(--border);
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 0 6px 6px 0;
            font-weight: 600;
            color: var(--text);
            font-size: 0.9rem;
        }

        /* Print Styling */
        @media print {
            header, footer, .education-section, .theme-toggle, .button-wrapper, .preset-container { display: none !important; }
            .card { border: none; shadow: none; padding: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 300px; page-break-inside: avoid; }
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href='/articles.html'>Articles</a></li>
                    <li><a href='/indexmech.html'>Mechanical</a></li>
                    <li><a href='/indexele.html'>Electrical</a></li>
                    <li><a href='/indexinst.html'>Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-flask"></i> Corrosion Rate Calculator - Weight Loss Method</h2>
            
            <div class="tool-description">
                <p>This industrial-grade calculator determines the <strong>Corrosion Rate</strong> of a material based on the standard weight loss method (ASTM G1). It analyzes the severity of material degradation, estimates <strong>Service Life</strong>, evaluates <strong>Pitting Risk</strong>, and generates NACE-compliant severity reports.</p>
            </div>

            <div class="calculator-form">
                <form id="corrosion-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('marine')"><i class="fas fa-water"></i> Marine Environment (High Salt)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('acid')"><i class="fas fa-vial"></i> Acidic Tank (Rapid Loss)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('potable')"><i class="fas fa-glass-whiskey"></i> Potable Water (Low)</button>
                            </div>
                        </div>
                    </div>

                    <!-- 1. Material Selection -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. Material Properties</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-layer-group"></i> Material Selection</div>
                            <div class="form-group">
                                <label for="materialSelect">Common Materials</label>
                                <select id="materialSelect">
                                    <option value="Carbon Steel (Typical)" selected>Carbon Steel (Typical)</option>
                                    <option value="Stainless Steel 304">SS 304 (8.00 g/cm³)</option>
                                    <option value="Stainless Steel 316">SS 316 (8.00 g/cm³)</option>
                                    <option value="Aluminum 6061">Aluminum 6061 (2.70 g/cm³)</option>
                                    <option value="Copper">Copper (8.96 g/cm³)</option>
                                    <option value="Brass">Brass (8.47 g/cm³)</option>
                                    <option value="Titanium Grade 2">Titanium Gr.2 (4.51 g/cm³)</option>
                                    <option value="Hastelloy C-276">Hastelloy C-276 (8.90 g/cm³)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="materialName">Custom Material Name</label>
                                <input type="text" id="materialName" value="Carbon Steel (Typical)" placeholder="e.g. Duplex 2205">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-weight-hanging"></i> Physical Properties</div>
                            <div class="form-group">
                                <label for="density">Density (D) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Mass per unit volume (g/cm³)</span></span></label>
                                <div class="input-group-append">
                                    <input type="number" id="density" step="0.01" value="7.85" placeholder="7.85">
                                    <div class="unit-label">g/cm³</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Test Parameters -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Test Parameters</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-balance-scale"></i> Coupon Data</div>
                            <div class="form-group">
                                <label for="weightLoss">Weight Loss (W)</label>
                                <div class="input-group-append">
                                    <input type="number" id="weightLoss" step="0.1" value="1250" placeholder="Weight loss in mg">
                                    <div class="unit-label">mg</div>
                                </div>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="exposureTime">Exposure Time (T)</label>
                                <div class="input-group-append">
                                    <input type="number" id="exposureTime" step="1" value="720" placeholder="Duration">
                                    <div class="unit-label">hours</div>
                                </div>
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-ruler-combined"></i> Geometry & Units</div>
                            <div class="form-group">
                                <label for="outputUnit">Target Unit</label>
                                <select id="outputUnit" onchange="updateAreaUnit()">
                                    <option value="mpy" selected>Mils Per Year (mpy)</option>
                                    <option value="mmpy">Millimeters Per Year (mm/yr)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="surfaceArea">Surface Area (A)</label>
                                <div class="input-group-append">
                                    <input type="number" id="surfaceArea" step="0.01" value="15.0" placeholder="Exposed Area">
                                    <div class="unit-label" id="areaUnitLabel">in²</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3. Life Estimation (New) -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">3. Service Life & Pitting (Optional)</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-hourglass-half"></i> Life Estimation</div>
                            <div class="form-group">
                                <label for="corrAllowance">Corrosion Allowance <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Sacrificial thickness available before failure.</span></span></label>
                                <div class="input-group-append">
                                    <input type="number" id="corrAllowance" step="0.1" value="125" placeholder="Allowable Loss">
                                    <div class="unit-label" id="allowanceUnitLabel">mils</div>
                                </div>
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-bullseye"></i> Pitting Factor</div>
                            <div class="form-group">
                                <label for="pittingFactor">Pitting Factor <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ratio of deepest pit to average penetration (1.0 = Uniform). Standard: 3-5 for untreated water.</span></span></label>
                                <input type="number" id="pittingFactor" step="0.1" value="1.0" min="1.0" placeholder="1.0">
                            </div>
                        </div>
                    </div>


                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Corrosion Rate</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download PDF Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Corrosion Analysis Results</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Calculated Metrics</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Unit</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-clipboard-check"></i> Recommendation:</strong>
                            <div id="interpretation-text" style="margin-top: 5px; font-size: 0.95rem;"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Severity Visualizer</h4>
                        <div class="chart-container">
                            <canvas id="corrosionGauge"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                            <span style="color: #10B981;">● Excellent</span> &nbsp;
                            <span style="color: #F59E0B;">● Fair</span> &nbsp;
                            <span style="color: #DC2626;">● Poor</span>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Calculations based on standard weight loss formula $CR = (K \times W) / (D \times A \times T)$. Life estimated via Corrosion Allowance / Rate.
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: Corrosion Mechanics</h2>
            
            <!-- Insight 1: Fundamental Formula -->
            <div class="insight-card">
                <h4><i class="fas fa-function"></i> 1. The Governing Formula</h4>
                <p>The corrosion rate represents the depth of material penetration over time. It is derived assuming uniform corrosion across the entire surface area. The standard formula is:</p>
                <div class="formula">$$ CR = \frac{K \cdot W}{D \cdot A \cdot T} $$</div>
                <p>Where:
                <ul>
                    <li><strong>W:</strong> Weight loss (mg).</li>
                    <li><strong>D:</strong> Density of the material (g/cm³).</li>
                    <li><strong>A:</strong> Exposed surface area.</li>
                    <li><strong>T:</strong> Exposure time (hours).</li>
                    <li><strong>K:</strong> Constant to correct units (534 for MPY, 87.6 for mm/yr).</li>
                </ul>
                </p>
            </div>

            <!-- Insight 2: MPY vs mm/yr -->
            <div class="insight-card">
                <h4><i class="fas fa-ruler"></i> 2. Units of Measurement: MPY vs. mm/yr</h4>
                <p><strong>MPY (Mils Per Year)</strong> is the dominant unit in the US oil & gas industry. One mil is one-thousandth of an inch (0.001").
                <br><strong>mm/yr (Millimeters Per Year)</strong> is the standard SI metric unit.
                <br><strong>Conversion:</strong> 1 MPY = 0.0254 mm/yr. Conversely, 1 mm/yr ≈ 39.4 MPY.</p>
            </div>

            <!-- Insight 3: Severity Levels -->
            <div class="insight-card">
                <h4><i class="fas fa-traffic-light"></i> 3. Interpreting Severity (Typical Carbon Steel)</h4>
                <p>Acceptable rates depend heavily on the application (e.g., a pharmaceutical tank needs lower rates than a sewage pipe). However, general guidelines for Carbon Steel are:</p>
                <ul>
                    <li><strong>< 1 MPY:</strong> Outstanding. Suitable for critical parts.</li>
                    <li><strong>1 - 5 MPY:</strong> Good. Typical allowance for piping.</li>
                    <li><strong>5 - 10 MPY:</strong> Fair. Inspect frequently. High corrosion allowance required.</li>
                    <li><strong>> 10 MPY:</strong> Poor. Rapid failure likely. Consider upgrading material.</li>
                </ul>
            </div>

            <!-- Insight 4: Limitations -->
            <div class="insight-card">
                <h4><i class="fas fa-exclamation-triangle"></i> 4. Uniform vs. Pitting Corrosion</h4>
                <p>This calculator assumes <strong>Uniform Corrosion</strong> (even wastage). It does <strong>not</strong> account for:
                <br><strong>Pitting:</strong> Localized holes that can penetrate much faster than the calculated rate.
                <br><strong>Galvanic Corrosion:</strong> Accelerated attack due to dissimilar metal contact.
                <br><strong>Stress Corrosion Cracking (SCC):</strong> Sudden failure under tensile stress in corrosive environments.</p>
                <p>For critical applications, a "Pitting Factor" is often applied to the calculated rate.</p>
            </div>
            
             <!-- Insight 5: Environmental Factors -->
            <div class="insight-card">
                <h4><i class="fas fa-temperature-high"></i> 5. Environmental Factors</h4>
                <p>Corrosion rates generally double for every 10°C (18°F) increase in temperature. Other critical factors include:
                <br><strong>Velocity:</strong> High flow removes protective oxide films (Erosion-Corrosion).
                <br><strong>Aeration:</strong> Oxygen presence typically accelerates corrosion in water.
                <br><strong>pH:</strong> Acidic (low pH) environments are generally more corrosive to steels.</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Empowering engineers with precision tools for complex analysis. If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin"><i class="fab fa-linkedin-in"></i></a>
<a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube"><i class="fab fa-youtube"></i></a>
<a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter"><i class="fab fa-twitter"></i></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook"><i class="fab fa-facebook-f"></i></a>
<a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"><i class="fab fa-whatsapp"></i></a>
</div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href='/indexele.html'>Electrical</a></li>
                        <li><a href='/indexmech.html'>Mechanical</a></li>
                        <li><a href='/indexinst.html'>Instrumentation</a></li>
                        <li><a href='/articles.html'>Articles</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles.html'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2.html'>Sitemap</a></li>
                
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to NACE MR0175, ASTM G1, API 570). Always verify calculations and consult with a licensed professional engineer/metallurgist before implementation.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let lastResult = null;
        let gaugeChart = null;
        
        // Material Data (Density g/cm3)
        const materials = {
            "Carbon Steel (Typical)": 7.85,
            "Stainless Steel 304": 8.00,
            "Stainless Steel 316": 8.00,
            "Aluminum 6061": 2.70,
            "Copper": 8.96,
            "Brass": 8.47,
            "Titanium Grade 2": 4.51,
            "Hastelloy C-276": 8.90
        };

        function updateAreaUnit() {
            const unit = document.getElementById('outputUnit').value;
            const label = document.getElementById('areaUnitLabel');
            const allowLabel = document.getElementById('allowanceUnitLabel');
            const allowanceInput = document.getElementById('corrAllowance');
            
            if (unit === 'mpy') {
                label.innerText = 'in²';
                allowLabel.innerText = 'mils';
                // Adjust allowance value default if logically needed, but usually manual
            } else {
                label.innerText = 'cm²';
                allowLabel.innerText = 'mm';
            }
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        function loadPreset(type) {
            const matName = document.getElementById('materialName');
            const density = document.getElementById('density');
            const w = document.getElementById('weightLoss');
            const t = document.getElementById('exposureTime');
            const a = document.getElementById('surfaceArea');
            const unit = document.getElementById('outputUnit');
            const matSel = document.getElementById('materialSelect');
            const allow = document.getElementById('corrAllowance');
            const pf = document.getElementById('pittingFactor');

            if (type === 'marine') {
                matSel.value = "Carbon Steel (Typical)";
                density.value = materials["Carbon Steel (Typical)"];
                matName.value = "Carbon Steel (Typical)";
                w.value = "1500";
                t.value = "720"; // 30 days
                unit.value = "mpy";
                updateAreaUnit();
                a.value = "15"; // in2
                allow.value = "125"; // 1/8 inch
                pf.value = "1.5";
            } else if (type === 'acid') {
                matSel.value = "Carbon Steel (Typical)";
                density.value = materials["Carbon Steel (Typical)"];
                matName.value = "Carbon Steel (Acid Exposure)";
                w.value = "5000";
                t.value = "24"; // 1 day
                unit.value = "mmpy";
                updateAreaUnit();
                a.value = "100"; // cm2
                allow.value = "3.0"; // 3mm
                pf.value = "3.0"; // High pitting
            } else if (type === 'potable') {
                matSel.value = "Stainless Steel 304";
                density.value = materials["Stainless Steel 304"];
                matName.value = "SS 304";
                w.value = "10";
                t.value = "1000";
                unit.value = "mpy";
                updateAreaUnit();
                a.value = "20"; // in2
                allow.value = "60"; 
                pf.value = "1.0";
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Theme handling
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            // Material Select Logic
            const matSel = document.getElementById('materialSelect');
            matSel.addEventListener('change', function() {
                if(this.value && materials[this.value]) {
                    document.getElementById('density').value = materials[this.value];
                    document.getElementById('materialName').value = this.value;
                }
            });

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
            updateAreaUnit();
        });

        function performCalculation() {
            // 1. Get Inputs
            const name = document.getElementById('materialName').value || "Unknown Material";
            const D = parseFloat(document.getElementById('density').value);
            const W = parseFloat(document.getElementById('weightLoss').value);
            const T = parseFloat(document.getElementById('exposureTime').value);
            const A = parseFloat(document.getElementById('surfaceArea').value);
            const unit = document.getElementById('outputUnit').value;
            const allowance = parseFloat(document.getElementById('corrAllowance').value);
            const PF = parseFloat(document.getElementById('pittingFactor').value) || 1.0;

            // Validation
            if (!D || !W || !T || !A) {
                displayMessage("Please fill in all numerical fields.", "error");
                return;
            }

            // 2. Logic Engine
            // K Factor
            // If MPY: K = 534 (W in mg, D in g/cm3, A in in2, T in hours)
            // If mm/yr: K = 87.6 (W in mg, D in g/cm3, A in cm2, T in hours)
            let K = unit === 'mpy' ? 534 : 87.6;
            let areaUnit = unit === 'mpy' ? 'in²' : 'cm²';
            let crUnit = unit === 'mpy' ? 'MPY' : 'mm/yr';
            let allowUnit = unit === 'mpy' ? 'mils' : 'mm';

            const CR = (K * W) / (D * A * T);
            
            // Pitting & Life
            const pittingRate = CR * PF;
            let life = 0;
            if (CR > 0 && allowance > 0) {
                // Conservative life calculation usually based on uniform rate for general thinning,
                // but if pitting is severe, failure happens faster (leaks). 
                // We will calculate life based on uniform rate, but warn about pitting.
                life = allowance / CR;
            }

            lastResult = { name, D, W, T, A, K, CR, unit, crUnit, areaUnit, allowance, PF, pittingRate, life, allowUnit };

            // 3. Render Step-by-Step
            let html = `<h4>Engineering Analysis</h4>`;
            html += `<div class="calculation-step">`;
            html += `Formula: $CR = \\frac{K \\cdot W}{D \\cdot A \\cdot T}$<br>`;
            html += `Constant K: ${K} (for ${crUnit})<br>`;
            html += `$$ CR = \\frac{${K} \\cdot ${W}}{${D} \\cdot ${A} \\cdot ${T}} $$<br>`;
            html += `$$ CR = \\frac{${(K*W).toFixed(2)}}{${(D*A*T).toFixed(2)}} = \\mathbf{${CR.toFixed(4)} \\text{ ${crUnit}}} $$`;
            html += `</div>`;
            
            if (PF > 1.0 || allowance > 0) {
                html += `<h4>Service Life & Pitting</h4>`;
                html += `<div class="calculation-step">`;
                html += `Max Pitting Rate = $CR \\times PF = ${CR.toFixed(4)} \\times ${PF} = \\mathbf{${pittingRate.toFixed(4)} \\text{ ${crUnit}}}$<br>`;
                if (life > 0) {
                    html += `Estimated Service Life = $Allowance / CR = ${allowance} / ${CR.toFixed(4)} = \\mathbf{${life.toFixed(1)} \\text{ Years}}$`;
                }
                html += `</div>`;
            }

            document.getElementById('calculation-details').innerHTML = html;

            // 4. Update Table
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, u, c="") => {
                tbody.innerHTML += `<tr style="${c ? 'color:'+c : ''}"><td><strong>${n}</strong></td><td>${v}</td><td>${u}</td></tr>`;
            };
            
            addRow("Material", name, "-");
            addRow("Density", D.toFixed(2), "g/cm³");
            addRow("Weight Loss", W.toFixed(1), "mg");
            addRow("Exposure Time", T.toFixed(0), "hours");
            addRow("Corrosion Rate", CR.toFixed(4), crUnit, "var(--primary)");
            
            if(PF > 1.0) addRow("Max Pitting Rate", pittingRate.toFixed(4), crUnit, "var(--danger)");
            if(life > 0) addRow("Est. Remaining Life", life.toFixed(1), "Years", life < 5 ? "var(--warning)" : "var(--success)");


            // Interpretation
            const interpEl = document.getElementById('interpretation-text');
            // Thresholds (MPY based, convert for mm/yr)
            let valMPY = unit === 'mpy' ? CR : CR * 39.37;
            
            let status = "";
            let color = "";
            let desc = "";

            if (valMPY < 1) {
                status = "Outstanding"; color = "var(--success)";
                desc = "Material is highly resistant. Suitable for critical applications.";
            } else if (valMPY < 5) {
                status = "Good"; color = "#10B981"; // Slightly darker green
                desc = "Acceptable for most industrial piping and vessels.";
            } else if (valMPY < 10) {
                status = "Fair"; color = "var(--warning)";
                desc = "Significant corrosion. Regular inspection and corrosion allowance required.";
            } else {
                status = "Poor"; color = "var(--danger)";
                desc = "Rapid degradation. Consider material upgrade or inhibitors.";
            }

            interpEl.innerHTML = `<span style="color:${color}; font-weight:bold;">${status} (${CR.toFixed(3)} ${crUnit})</span>. ${desc}`;

            // 5. Update Gauge Chart
            updateGauge(valMPY);

            // 6. Show Results
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        function updateGauge(valMPY) {
            const ctx = document.getElementById('corrosionGauge').getContext('2d');
            
            // Normalize value for gauge (Max 20 MPY for visual, cap it)
            let displayVal = valMPY > 20 ? 20 : valMPY;
            
            if (gaugeChart) gaugeChart.destroy();

            gaugeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Outstanding', 'Good', 'Fair', 'Poor'],
                    datasets: [{
                        data: [1, 4, 5, 10], // Segments: 0-1, 1-5, 5-10, 10-20
                        backgroundColor: [
                            '#10B981', // Green
                            '#34D399', // Light Green
                            '#F59E0B', // Yellow
                            '#EF4444'  // Red
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    rotation: -90,
                    circumference: 180,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            // Header
            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(30, 58, 138); 
            pdf.text('Corrosion Rate Analysis Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. Test Parameters', 14, y);
            y += 5;

            const inputData = [
                ['Material', lastResult.name],
                ['Density', `${lastResult.D} g/cm³`],
                ['Weight Loss', `${lastResult.W} mg`],
                ['Exposure Time', `${lastResult.T} hours`],
                ['Corrosion Allowance', `${lastResult.allowance} ${lastResult.allowUnit}`],
                ['Pitting Factor', `${lastResult.PF}`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. Analysis Results', 14, y);
            y += 5;

            const resData = [
                ['Corrosion Rate', `${lastResult.CR.toFixed(4)} ${lastResult.crUnit}`],
                ['Max Pitting Rate', `${lastResult.pittingRate.toFixed(4)} ${lastResult.crUnit}`],
                ['Est. Remaining Life', `${lastResult.life.toFixed(1)} Years`],
                ['Severity Status', document.getElementById('interpretation-text').innerText.split('.')[0]]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] },
                didParseCell: function(data) {
                    if(data.row.index === 0) {
                        data.cell.styles.fontStyle = 'bold';
                        data.cell.styles.textColor = [30, 58, 138];
                    }
                }
            });
            
            y = pdf.lastAutoTable.finalY + 15;
            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text("Note: Life estimation is theoretical based on uniform corrosion. Localized pitting may cause earlier failure.", 14, y);

            pdf.save('Corrosion_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }
    </script>
</body>
</html>
