<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Retained original title -->
    <title>Storage Tank Volume Calculator - Design Calculators</title>

    <!-- New meta tags, scripts, and links -->
    <meta name="description" content="Professional industrial storage tank volume calculator for vertical, horizontal, rectangular, and spherical tanks. Calculates partial volume, total volume, and generates strapping charts.">
    <meta name="keywords" content="storage tank calculator, tank volume, strapping chart, tank calibration, horizontal tank, vertical tank, 2:1 ellipsoidal head, API 650">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/storage-tank-volume.html" />

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-23Y1V450SR');
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- MathJax script -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Retained original MathJax configuration -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- New unified CSS -->
    <style>
        @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
        }

        @keyframes shimmer {
        0% { background-position: -1000px 0; }
        100% { background-position: 1000px 0; }
        }

        :root {
        --primary-color: #1E3A8A;
        --secondary-color: #2563EB;
        --accent-color: #F59E0B;
        --success-color: #10B981;
        --error-color: #EF4444; /* Added for consistency */
        --bg-color: #F8FAFC;
        --card-bg: #FFFFFF;
        --text-color: #4B5563;
        --heading-color: #111827;
        --footer-bg: #0F172A;
        --border-color: #E2E8F0;
        --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
        --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        --primary-color-rgb: 30, 58, 138; /* Added for consistency */
        }

        body.dark-mode {
        --primary-color: #10B981;
        --secondary-color: #34D399;
        --bg-color: #0F172A;
        --card-bg: #1E293B;
        --text-color: #CBD5E1;
        --heading-color: #F1F5F9;
        --footer-bg: #020617;
        --border-color: #334155;
        --success-color: #10B981;
        --error-color: #F44336;
        --primary-color-rgb: 16, 185, 129;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        line-height: 1.8;
        transition: background-color 0.3s, color 0.3s;
        margin: 0;
        padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* HEADER */
        .header {
        background: var(--gradient-primary);
        color: white;
        padding: 24px 0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        animation: slideIn 0.5s ease;
        }

        .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        }

        .logo-container {
        display: flex;
        align-items: center;
        gap: 16px;
        text-decoration: none;
        color: white;
        }

        .logo-text {
        font-size: 1.75rem;
        font-weight: 800;
        font-family: 'Montserrat', sans-serif;
        }

        .nav-links {
        display: flex;
        gap: 24px;
        list-style: none;
        margin: 0;
        padding: 0;
        }

        .nav-links a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s;
        }

        .nav-links a:hover {
        color: var(--accent-color);
        transform: translateY(-2px);
        }

        .theme-toggle {
        display: flex;
        align-items: center;
        gap: 12px;
        }

        .theme-toggle .icon {
        color: white;
        font-size: 1.2rem;
        }

        .switch {
        position: relative;
        width: 56px;
        height: 30px;
        }

        .switch input {
        opacity: 0;
        width: 0;
        height: 0;
        }

        .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0,0,0,0.2);
        transition: .4s;
        border-radius: 30px;
        }

        .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
        }

        input:checked + .slider {
        background-color: var(--accent-color);
        }

        input:checked + .slider:before {
        transform: translateX(26px);
        }

        main {
        padding: 40px 0;
        max-width: 1000px;
        margin: 0 auto;
        }

        .tool-container {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 30px;
        box-shadow: var(--card-shadow);
        margin-bottom: 30px;
        animation: fadeInUp 0.6s ease;
        }

        .tool-container h2 {
        color: var(--primary-color);
        border-bottom: 3px solid var(--primary-color);
        padding-bottom: 15px;
        margin-top: 0;
        margin-bottom: 25px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.8rem;
        }
        
        .tool-container h3 {
            color: var(--primary-color);
            margin-top: 25px;
        }

        .tool-description {
        margin-bottom: 25px;
        font-size: 1rem;
        line-height: 1.8;
        }
        
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }

        .calculator-form {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 25px;
        margin-top: 25px;
        box-shadow: var(--card-shadow);
        }

        .form-group {
        margin-bottom: 20px;
        animation: slideIn 0.5s ease;
        }

        .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--heading-color);
        }

        .form-group input, .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-size: 1rem;
        transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 12px rgba(var(--primary-color-rgb), 0.25);
        outline: none;
        transform: scale(1.02);
        }

        .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        }

        .button-group {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
        }

        .calculate-btn, .reset-btn, .download-btn {
        padding: 14px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 700;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        }

        .calculate-btn {
        background: var(--gradient-primary);
        color: white;
        flex: 1;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(var(--primary-color-rgb), 0.3);
        }

        .calculate-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(var(--primary-color-rgb), 0.4);
        animation: pulse 0.6s ease;
        }

        .reset-btn {
        background: linear-gradient(135deg, #EF4444, #DC2626);
        color: white;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .reset-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        .download-btn {
        background: linear-gradient(135deg, #10B981, #059669);
        color: white;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .download-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .result-container {
        margin-top: 40px;
        padding: 30px;
        border-radius: 12px;
        background-color: var(--card-bg);
        box-shadow: var(--card-shadow);
        display: none;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.6s ease;
        }

        .result-container.show {
        display: block;
        opacity: 1;
        transform: translateY(0);
        }

        .result-container h3 {
        color: var(--primary-color);
        margin-bottom: 25px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.6rem;
        }

        #calculation-details {
        background-color: var(--bg-color);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 25px;
        animation: fadeInUp 0.7s ease;
        overflow-x: auto; /* Allow horizontal scrolling for formulas */
        }

        #calculation-details h4 {
        color: var(--secondary-color);
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 1.2rem;
        }

        #calculation-details p.formula {
        font-family: 'Times New Roman', serif;
        font-size: 1.1rem;
        text-align: center;
        padding: 15px;
        background: linear-gradient(90deg, transparent, rgba(var(--border-color), 0.5), transparent);
        border-radius: 6px;
        margin: 15px 0;
        overflow-x: auto;
        white-space: nowrap;
        }
        
        body.dark-mode #calculation-details p.formula {
             background: linear-gradient(90deg, transparent, rgba(var(--border-color), 0.1), transparent);
        }

        #calculation-details p.calculation-step {
        font-family: 'Courier New', monospace;
        background-color: var(--card-bg);
        padding: 10px 12px;
        border-radius: 4px;
        border-left: 4px solid var(--secondary-color);
        margin-bottom: 10px;
        word-wrap: break-word;
        white-space: nowrap; /* Prevent wrapping */
        }

        #calculation-details ul {
        list-style-type: disc;
        margin-left: 25px;
        padding-left: 0;
        }
        
        #calculation-details ul li {
            margin-bottom: 5px;
        }

        .result-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 8px;
        overflow: hidden;
        animation: fadeInUp 0.8s ease;
        }

        .result-table th, .result-table td {
        padding: 14px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
        }

        .result-table th {
        background: var(--gradient-primary);
        color: white;
        font-weight: 700;
        }

        .result-table tr:nth-child(even) {
        background-color: rgba(0,0,0,0.02);
        }
        
        body.dark-mode .result-table tr:nth-child(even) {
            background-color: rgba(255,255,255,0.02);
        }

        .result-table tr:hover {
        background-color: rgba(37, 99, 235, 0.1);
        transform: scale(1.01);
        transition: all 0.3s;
        }
        
        body.dark-mode .result-table tr:hover {
            background-color: rgba(16, 185, 129, 0.1);
        }

        .standard-reference {
        margin-top: 25px;
        font-style: italic;
        font-size: 0.95rem;
        padding: 15px;
        background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.05));
        border-left: 4px solid var(--accent-color);
        border-radius: 6px;
        line-height: 1.7;
        animation: fadeInUp 0.9s ease;
        }

        .info-icon {
        color: var(--primary-color);
        margin-left: 6px;
        cursor: help;
        transition: transform 0.3s;
        }

        .info-icon:hover {
        transform: scale(1.2) rotate(10deg);
        }

        .tooltip {
        position: relative;
        display: inline-block;
        }

        .tooltip .tooltiptext {
        visibility: hidden;
        width: 260px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1000;
        bottom: 130%;
        left: 50%;
        margin-left: -130px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.85rem;
        white-space: normal;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
        }

        #custom-message-box {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(-100px);
        padding: 16px 28px;
        border-radius: 8px;
        box-shadow: 0 6px 16px rgba(0,0,0,0.25);
        z-index: 10000;
        font-weight: 600;
        color: white;
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        #custom-message-box.info { background-color: var(--success-color); }
        #custom-message-box.error { background-color: var(--error-color); }
        #custom-message-box.warning { background-color: var(--accent-color); color: #333; }

        #custom-message-box.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
        }
        
        /* Styles from original, adapted for new theme */
        .tank-type-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        .tank-type-option {
            flex: 1 1 calc(33% - 10px); /* 3 columns by default */
            min-width: 150px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--bg-color);
        }
        .tank-type-option.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--secondary-color);
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.4);
            transform: translateY(-3px);
        }
        .tank-type-option:hover:not(.selected) {
            border-color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .tank-type-option input[type="radio"] {
            display: none;
        }
        .tank-type-option label {
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 0; /* Override default label margin */
            color: inherit; /* Inherit color from parent (.tank-type-option) */
        }
        .form-section {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            background-color: var(--bg-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        
        body.dark-mode .form-section {
             box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .form-section h3 {
            margin-top: 0;
            color: var(--secondary-color);
            border-bottom: 1px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        /* End of specific styles */

        /* FOOTER */
        footer {
        background: var(--gradient-dark);
        color: #CBD5E1;
        padding: 50px 0 20px 0;
        margin-top: 40px;
        }

        .footer-content {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 40px;
        margin-bottom: 30px;
        }

        .footer-col {
        flex: 1;
        min-width: 200px;
        }

        .footer-col h4 {
        color: white;
        margin-bottom: 15px;
        font-weight: 700;
        }

        .footer-col ul {
        list-style: none;
        padding: 0;
        margin: 0;
        }

        .footer-col ul li {
        margin-bottom: 10px;
        }

        .footer-col a {
        color: #CBD5E1;
        text-decoration: none;
        transition: all 0.3s;
        }

        .footer-col a:hover {
        color: var(--accent-color);
        transform: translateX(3px);
        }

        .footer-disclaimer {
        text-align: center;
        margin: 30px auto;
        padding-top: 25px;
        border-top: 1px solid #334155;
        max-width: 800px;
        font-size: 0.9rem;
        line-height: 1.6;
        }

        .footer-bottom {
        text-align: center;
        padding-top: 20px;
        font-size: 0.9rem;
        color: #94A3B8;
        }

        .creator-name {
        color: var(--secondary-color);
        font-weight: bold;
        }

        .social-buttons {
        display: flex;
        gap: 12px;
        margin-top: 15px;
        }

        .social-btn {
        width: 40px;
        height: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        border-radius: 50%;
        text-decoration: none;
        transition: all 0.3s;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .social-btn:hover {
        transform: translateY(-4px) scale(1.1);
        box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.email { background-color: #7f8c8d; }


        @media (max-width: 768px) {
        .navbar { flex-direction: column; gap: 20px; }
        .nav-links { flex-direction: column; gap: 12px; text-align: center; }
        .form-row { grid-template-columns: 1fr; }
        .button-group { flex-direction: column; }
        .calculate-btn, .reset-btn, .download-btn { width: 100%; }
        .footer-content { flex-direction: column; }
        .tank-type-option { flex-basis: 100%; } /* Single column for options on mobile */
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- NEW HEADER -->
    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <!-- Back button removed -->
            
        <div class="tool-container">
            <h2><i class="fas fa-database"></i> Storage Tank Volume Calculator</h2>
            <div class="tool-description">
                <p>This calculator determines the total and liquid volume for various types of industrial storage tanks, aiding engineers in design, operation, and inventory management. The calculations are based on precise geometric formulas referenced against standards like <strong>API 650 (Welded Tanks for Oil Storage)</strong>.</p>
                <p><strong>Supported Tank Shapes (Industrial):</strong></p>
                <ul>
                    <li><strong>Vertical Cylindrical (Flat, Conical, or 2:1 Ellipsoidal Ends)</strong>: Common for large atmospheric storage.</li>
                    <li><strong>Horizontal Cylindrical (Flat or 2:1 Ellipsoidal Ends)</strong>: Used for process vessels and bulk liquid storage.</li>
                    <li><strong>Rectangular/Box Tanks</strong>: Simple and versatile.</li>
                    <li><strong>Spherical Tanks</strong>: For high-pressure gas and liquid storage.</li>
                </ul>
                <p>This tool provides both single-point volume calculations and can generate a full **Tank Strapping Chart** (gauging table) for precise inventory control.</p>
            </div>
            <div class="calculator-form">
                <form id="tank-volume-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (m, Liters) or Imperial (feet, US Gallons) units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (m, Liters)</option>
                                <option value="imperial">Imperial (feet, US Gallons)</option>
                            </select>
                        </div>
                    </div>
                    <h3>Select Tank Type:</h3>
                    <div class="tank-type-options">
                        <div class="tank-type-option" data-tank-type="vertical-cylinder-flat">
                            <input type="radio" id="type-vertical-flat" name="tankType" value="vertical-cylinder-flat" checked>
                            <label for="type-vertical-flat">Vertical Cylindrical (Flat Ends)</label>
                        </div>
                        <div class="tank-type-option" data-tank-type="vertical-cylinder-cone">
                            <input type="radio" id="type-vertical-cone" name="tankType" value="vertical-cylinder-cone">
                            <label for="type-vertical-cone">Vertical Cylindrical (Conical Ends)</label>
                        </div>
                         <!-- Renamed for clarity and precision -->
                        <div class="tank-type-option" data-tank-type="vertical-cylinder-ellip">
                            <input type="radio" id="type-vertical-ellip" name="tankType" value="vertical-cylinder-ellip">
                            <label for="type-vertical-ellip">Vertical Cylindrical (2:1 Ellipsoidal Ends)</label>
                        </div>
                        <div class="tank-type-option" data-tank-type="horizontal-cylinder-flat">
                            <input type="radio" id="type-horizontal-flat" name="tankType" value="horizontal-cylinder-flat">
                            <label for="type-horizontal-flat">Horizontal Cylindrical (Flat Ends)</label>
                        </div>
                         <!-- Renamed for clarity and precision -->
                        <div class="tank-type-option" data-tank-type="horizontal-cylinder-ellip">
                            <input type="radio" id="type-horizontal-ellip" name="tankType" value="horizontal-cylinder-ellip">
                            <label for="type-horizontal-ellip">Horizontal Cylindrical (2:1 Ellipsoidal Ends)</label>
                        </div>
                        <div class="tank-type-option" data-tank-type="rectangular">
                            <input type="radio" id="type-rectangular" name="tankType" value="rectangular">
                            <label for="type-rectangular">Rectangular Tank</label>
                        </div>
                        <div class="tank-type-option" data-tank-type="spherical">
                            <input type="radio" id="type-spherical" name="tankType" value="spherical">
                            <label for="type-spherical">Spherical Tank</label>
                        </div>
                    </div>
                    <div id="tank-parameters-section" class="form-section">
                        <h3>Tank Dimensions</h3>
                        <!-- Dynamic input fields will be loaded here based on tank type -->
                    </div>
                    <div class="form-section">
                        <h3>Liquid Level</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="liquid-level">Liquid Level (h) <span class="length-unit-label">(m)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the liquid from the bottom of the tank. For horizontal cylindrical tanks, this is the depth of liquid.</span></span></label>
                                <input type="number" id="liquid-level" step="0.01" value="1.0" min="0" required>
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" id="calculate-volume-btn" class="calculate-btn">
                            <i class="fas fa-calculator"></i> Calculate Volume
                        </button>
                        <button type="button" id="generate-strapping-chart-btn" class="download-btn">
                            <i class="fas fa-table"></i> Generate Strapping Chart
                        </button>
                    </div>
                </form>
            </div>
            <div id="result-container" class="result-container">
                <h3><i class="fas fa-chart-line"></i> Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
        
        <!-- NEW 800+ WORD INFORMATIVE SECTION -->
        <div class="tool-container" style="margin-top: 40px;">
            <h2><i class="fas fa-book-open"></i> Professional Guide to Industrial Tank Volume Calculation</h2>

            <h3 style="color: var(--primary-color); margin-top: 25px;">The Critical Role of Tank Gauging</h3>
            <p>In industrial settings, accurately knowing the volume of liquid in a storage tank is not a trivial matter. It is a critical function for operations, safety, and finance. This process, often called "tank gauging" or "calibration," is essential for:</p>
            <ul>
                <li><strong>Custody Transfer:</strong> When buying or selling bulk liquids (like crude oil, chemicals, or LNG), the volume transferred must be known with extremely high precision. A tiny percentage error on a 1,000,000-liter transfer can mean thousands of dollars.</li>
                <li><strong>Inventory Management:</strong> Plants need to know exactly how much raw material they have on-site and how much product is ready to ship. This is fundamental for logistics, planning, and financial reporting.</li>
                <li><strong>Process Safety:</strong> Many processes require precise batching of ingredients. Furthermore, overfilling a tank (exceeding its safe fill level) can lead to spills, environmental disasters, and catastrophic equipment failure.</li>
            </ul>
            <p>This is why industrial calculations must be precise, accounting for the exact geometry of the tank, including its head (end cap) type. Standards like the <strong>American Petroleum Institute (API) Manual of Petroleum Measurement Standards (MPMS)</strong> dedicate entire chapters to the rigorous methods for calibrating tanks.</p>

            <h3 style="color: var(--primary-color); margin-top: 25px;">Understanding Tank Heads: Flat vs. Ellipsoidal</h3>
            <p>While simple tanks may have flat ends, most industrial tanks designed to hold pressure (even low pressure) use "dished" or "domed" ends. This shape is far stronger and more efficient at distributing stress. The two most common types are:</p>
            
            <h4>1. Torispherical (F&D) Heads</h4>
            <p>A "Flanged and Dished" (F&D) head is composed of three parts: a large "crown radius" (\(R\)), a small "knuckle radius" (\(r\)), and a straight flange. A standard ASME F&D head has \(R = D\) (Crown Radius = Tank Diameter) and \(r = 0.1 \cdot D\). While common, their geometry is complex to calculate.</p>

            <h4>2. 2:1 Ellipsoidal Heads (Industrial Standard)</h4>
            <p>This is one of the most common head types in the process industry. It is an ellipse of revolution where the major axis is equal to the tank's diameter (\(D\)) and the minor axis is one-half of that (\(D/2\)). This creates a head height (\(h_{\text{head}}\)) that is exactly one-quarter of the diameter (\(h_{\text{head}} = D / 4\)).</p>
            <p>This "2:1" ratio provides an excellent balance of strength and internal volume. The formulas are also more straightforward than a torispherical head, making it a preferred standard. This calculator uses the precise formulas for 2:1 ellipsoidal heads.</p>
            <ul>
                <li><strong>Total Volume of one 2:1 Head:</strong>
                <p class="formula">\[ V_{\text{head}} = \frac{\pi D^3}{24} \]</p>
                </li>
                <li><strong>Head Height (from tangent line):</strong>
                <p class="formula">\[ h_{\text{head}} = \frac{D}{4} \]</p>
                </li>
            </ul>

            <h3 style="color: var(--primary-color); margin-top: 25px;">The Challenge: Partial Volume Calculation</h3>
            <p>Knowing the *total* volume is easy. The hard part is knowing the *partial* volume at any given liquid level (\(h\)). The relationship between height and volume is linear for a vertical cylinder or rectangular tank, but it is highly **non-linear** for all other types.</p>
            
            <h4>Vertical Tanks (Ellipsoidal/Conical)</h4>
            <p>For a vertical tank with a 2:1 ellipsoidal bottom, the volume changes slowly at first (at the very bottom) and then faster and faster as the liquid level approaches the "equator" (the tangent line). The formula for the partial volume within the bottom head is:</p>
            <p class="formula">\[ V_{\text{partial head}} = V_{\text{total head}} \cdot \left[ \left( \frac{h}{h_{\text{head}}} \right)^2 \cdot \left( 3 - 2 \cdot \frac{h}{h_{\text{head}}} \right) \right] \]</p>
            <p>Where \(h\) is the liquid level measured from the bottom of the head. This calculator correctly switches between this formula, the linear cylindrical formula, and the top head formula as the liquid level rises.</p>
            
            <h4>Horizontal Tanks (The Hardest Case)</h4>
            <p>Calculating the partial volume of a horizontal cylindrical tank is a classic engineering problem. The volume of the cylindrical section is a function of the circular segment area. The partial volume of the two end caps is even more complex. While the exact integral is very difficult, a common and robust industrial approximation is to assume the end caps fill "pro-rata" with the cylindrical section. This means if the cylindrical section is 30% full (by volume), the end caps are also assumed to be 30% full (by volume). This calculator uses this method for horizontal tanks with ellipsoidal ends.</p>

            <h3 style="color: var(--primary-color); margin-top: 25px;">The Industrial Solution: The Strapping Chart</h3>
            <p>Because the volume-to-height relationship is so complex, operators on a plant site do not perform these calculations. Instead, they use a **"Strapping Chart"** or **"Tank Calibration Table"**. This is a pre-calculated table that lists the tank's volume at fine increments of height (e.g., every centimeter or 1/8th of an inch).</p>
            <p>An operator simply "dips" the tank (measures the liquid level, \(h\)) and looks up that height on the chart to find the precise volume. This calculator's **"Generate Strapping Chart"** feature performs this exact function, creating a 1,000-point table for any tank geometry you define, which can then be used for accurate, real-world inventory control.</p>
        </div>
    </main>

    <!-- NEW FOOTER -->
        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Message box for notifications -->
    <div id="custom-message-box"></div>

    <!-- Updated JavaScript with "Heavy Duty" features -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to DOM elements
            const calculateBtn = document.getElementById('calculate-volume-btn');
            const strappingChartBtn = document.getElementById('generate-strapping-chart-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const tankTypeOptions = document.querySelectorAll('.tank-type-option');
            const tankParametersSection = document.getElementById('tank-parameters-section');
            const unitSystemSelect = document.getElementById('unit-system');
            const liquidLevelInput = document.getElementById('liquid-level');

            /**
             * Displays a custom message box at the top of the screen.
             */
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add(type); // Add type class for styling
                messageBox.style.opacity = 1;
                // Hide message after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            /**
             * Updates the unit labels in the UI based on the selected unit system.
             */
            function updateUnitLabels() {
                const unitSystem = unitSystemSelect.value;
                const lengthUnit = unitSystem === 'imperial' ? '(ft)' : '(m)';
                // Update all labels with the class 'length-unit-label'
                document.querySelectorAll('.length-unit-label').forEach(label => {
                    label.textContent = lengthUnit;
                });
            }

            unitSystemSelect.addEventListener('change', () => {
                const selectedTankType = document.querySelector('input[name="tankType"]:checked').value;
                loadTankInputs(selectedTankType); // Reload inputs to update labels and defaults
            });

            /**
             * Loads input fields specific to the selected tank type.
             * @param {string} tankType - The selected tank type.
             */
            function loadTankInputs(tankType) {
                let inputsHtml = '<h3>Tank Dimensions</h3>';
                const unitSystem = unitSystemSelect.value;
                const lengthUnit = unitSystem === 'imperial' ? '(ft)' : '(m)';
                
                // --- Default Values (Metric) ---
                let d_val = "2.0", h_val = "3.0", h_cyl_val = "2.0", h_cone_val = "0.5", l_val = "5.0", l_cyl_val = "4.0", w_val = "2.0", sph_d_val = "3.0";

                if (unitSystem === 'imperial') {
                    // --- Convert Default Values to Imperial ---
                    d_val = (2.0 * 3.28084).toFixed(2); // 6.56
                    h_val = (3.0 * 3.28084).toFixed(2); // 9.84
                    h_cyl_val = (2.0 * 3.28084).toFixed(2); // 6.56
                    h_cone_val = (0.5 * 3.28084).toFixed(2); // 1.64
                    l_val = (5.0 * 3.28084).toFixed(2); // 16.40
                    l_cyl_val = (4.0 * 3.28084).toFixed(2); // 13.12
                    w_val = (2.0 * 3.28084).toFixed(2); // 6.56
                    sph_d_val = (3.0 * 3.28084).toFixed(2); // 9.84
                }


                switch (tankType) {
                    case 'vertical-cylinder-flat':
                        inputsHtml += `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Diameter (D) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical tank.</span></span></label>
                                    <input type="number" id="diameter" step="0.01" value="${d_val}" min="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="height">Cylindrical Height (H) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the cylindrical section of the tank.</span></span></label>
                                    <input type="number" id="height" step="0.01" value="${h_val}" min="0.01" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'vertical-cylinder-cone':
                        inputsHtml += `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Cylinder Diameter (D) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical section.</span></span></label>
                                    <input type="number" id="diameter" step="0.01" value="${d_val}" min="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="height">Cylindrical Height (H) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the cylindrical section.</span></span></label>
                                    <input type="number" id="height" step="0.01" value="${h_cyl_val}" min="0.01" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cone-height-bottom">Bottom Cone Height (h_cb) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Vertical height of the conical bottom.</span></span></label>
                                    <input type="number" id="cone-height-bottom" step="0.01" value="${h_cone_val}" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="cone-height-top">Top Cone Height (h_ct) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Vertical height of the conical top (set to 0 if flat top).</span></span></label>
                                    <input type="number" id="cone-height-top" step="0.01" value="0.0" min="0" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'vertical-cylinder-ellip':
                        inputsHtml += `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Cylinder Diameter (D) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical section. The 2:1 ellipsoidal head height will be D/4.</span></span></label>
                                    <input type="number" id="diameter" step="0.01" value="${d_val}" min="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="height">Cylindrical Height (H) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the cylindrical (straight shell) section.</span></span></label>
                                    <input type="number" id="height" step="0.01" value="${h_cyl_val}" min="0.01" required>
                                </div>
                            </div>
                            <p>Note: This assumes standard 2:1 ellipsoidal heads on both top and bottom. The height of each head is D/4.</p>
                        `;
                        break;
                    case 'horizontal-cylinder-flat':
                        inputsHtml += `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Diameter (D) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical tank.</span></span></label>
                                    <input type="number" id="diameter" step="0.01" value="${d_val}" min="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="length">Cylindrical Length (L) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Length of the cylindrical section (straight part).</span></span></label>
                                    <input type="number" id="length" step="0.01" value="${l_val}" min="0.01" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'horizontal-cylinder-ellip':
                        inputsHtml += `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Cylinder Diameter (D) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical section.</span></span></label>
                                    <input type="number" id="diameter" step="0.01" value="${d_val}" min="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="length">Cylindrical Length (L) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Length of the cylindrical section (straight shell).</span></span></label>
                                    <input type="number" id="length" step="0.01" value="${l_cyl_val}" min="0.01" required>
                                </div>
                            </div>
                            <p>Note: This assumes standard 2:1 ellipsoidal heads on both ends. The length of each head is D/4.</p>
                        `;
                        break;
                    case 'rectangular':
                        inputsHtml += `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="length">Length (L) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Length of the rectangular tank.</span></span></label>
                                    <input type="number" id="length" step="0.01" value="${l_val}" min="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="width">Width (W) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Width of the rectangular tank.</span></span></label>
                                    <input type="number" id="width" step="0.01" value="${w_val}" min="0.01" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="height">Height (H) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the rectangular tank.</span></span></label>
                                    <input type="number" id="height" step="0.01" value="${h_cyl_val}" min="0.01" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'spherical':
                        inputsHtml += `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Diameter (D) <span class="length-unit-label">${lengthUnit}</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the spherical tank.</span></span></label>
                                    <input type="number" id="diameter" step="0.01" value="${sph_d_val}" min="0.01" required>
                                </div>
                            </div>
                        `;
                        break;
                    default:
                        inputsHtml = `<p>Select a tank type to enter dimensions.</p>`;
                }
                tankParametersSection.innerHTML = inputsHtml;
                updateUnitLabels(); // Ensure liquid level label is also updated
            }

            // Event listeners for tank type selection
            tankTypeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    tankTypeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input[type="radio"]').checked = true;
                    loadTankInputs(this.dataset.tankType);
                });
            });

            // Initial load of inputs
            const initialTankType = document.querySelector('input[name="tankType"]:checked').value;
            document.querySelector(`.tank-type-option[data-tank-type="${initialTankType}"]`).classList.add('selected');
            loadTankInputs(initialTankType);

            /**
             * Adds a row to the result table.
             */
            function addResultRow(parameterHtml, valueHtml) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameterHtml;
                valueCell.innerHTML = valueHtml;
            }

            // --- Core Calculation Functions (all in SI units - meters) ---

            /**
             * Calculates volume of a spherical segment (cap).
             * @param {number} R - Radius of the sphere.
             * @param {number} h - Height of the liquid segment.
             * @returns {number} Volume in cubic meters.
             */
            function V_SphericalSegment(R, h) {
                if (h <= 0) return 0;
                if (h >= 2 * R) return (4/3) * Math.PI * Math.pow(R, 3); // Full sphere
                return (1/3) * Math.PI * Math.pow(h, 2) * (3 * R - h);
            }
            
            /**
             * Calculates partial volume of a vertical 2:1 ellipsoidal head.
             * @param {number} D - Diameter of the cylinder.
             * @param {number} h - Height of the liquid in the head.
             * @returns {number} Volume in cubic meters.
             */
            function V_VerticalEllipsoidalHead(D, h) {
                const h_head = D / 4; // Total height of the 2:1 head
                if (h <= 0) return 0;
                if (h >= h_head) return (Math.PI / 24) * Math.pow(D, 3); // Full head
                // V_partial = V_total * [ (h/h_head)^2 * (3 - 2 * (h/h_head)) ]
                const V_total_head = (Math.PI / 24) * Math.pow(D, 3);
                const h_ratio = h / h_head;
                return V_total_head * (h_ratio * h_ratio) * (3 - 2 * h_ratio);
            }

            /**
             * Calculates partial volume of a horizontal cylinder (no ends).
             * @param {number} D - Diameter of the cylinder.
             * @param {number} L - Length of the cylinder.
             * @param {number} h - Height of the liquid.
             * @returns {number} Volume in cubic meters.
             */
            function V_HorizontalCylinder(D, L, h) {
                const R = D / 2;
                if (h <= 0) return 0;
                if (h >= D) return Math.PI * Math.pow(R, 2) * L; // Full cylinder
                const theta = 2 * Math.acos((R - h) / R); // Angle in radians
                const area = Math.pow(R, 2) / 2 * (theta - Math.sin(theta));
                return area * L;
            }

            /**
             * Gathers all inputs and converts them to SI units (meters).
             * @returns {object|null} An object with parameters or null on failure.
             */
            function getInputsInSI() {
                const form = document.getElementById('tank-volume-form');
                if (!form.checkValidity()) {
                    displayMessage("Please fill in all required fields correctly.", "error");
                    form.reportValidity();
                    return null;
                }
                
                const unitSystem = unitSystemSelect.value;
                const conversionFactor = (unitSystem === 'imperial') ? 0.3048 : 1; // ft to m
                const tankType = document.querySelector('input[name="tankType"]:checked').value;
                
                const params = {
                    tankType: tankType,
                    unitSystem: unitSystem
                };

                // Helper to get input value, convert to base unit (m)
                const getVal = (id) => {
                    const el = document.getElementById(id);
                    if (!el) return 0; // Element might not exist for this tank type
                    const val = parseFloat(el.value);
                    if (isNaN(val)) throw new Error(`Invalid input for ${id}`);
                    return val * conversionFactor;
                };

                try {
                    params.h_liquid = getVal('liquid-level');
                    
                    switch (tankType) {
                        case 'vertical-cylinder-flat':
                            params.D = getVal('diameter');
                            params.H = getVal('height');
                            if (params.D <= 0 || params.H <= 0) throw new Error("Dimensions must be positive.");
                            break;
                        case 'vertical-cylinder-cone':
                            params.D = getVal('diameter');
                            params.H = getVal('height');
                            params.h_cb = getVal('cone-height-bottom');
                            params.h_ct = getVal('cone-height-top');
                            if (params.D <= 0 || params.H <= 0 || params.h_cb < 0 || params.h_ct < 0) throw new Error("Dimensions must be positive (cone height can be 0).");
                            break;
                        case 'vertical-cylinder-ellip':
                            params.D = getVal('diameter');
                            params.H = getVal('height');
                            if (params.D <= 0 || params.H <= 0) throw new Error("Dimensions must be positive.");
                            break;
                        case 'horizontal-cylinder-flat':
                            params.D = getVal('diameter');
                            params.L = getVal('length');
                            if (params.D <= 0 || params.L <= 0) throw new Error("Dimensions must be positive.");
                            break;
                        case 'horizontal-cylinder-ellip':
                            params.D = getVal('diameter');
                            params.L = getVal('length');
                            if (params.D <= 0 || params.L <= 0) throw new Error("Dimensions must be positive.");
                            break;
                        case 'rectangular':
                            params.L = getVal('length');
                            params.W = getVal('width');
                            params.H = getVal('height');
                            if (params.L <= 0 || params.W <= 0 || params.H <= 0) throw new Error("Dimensions must be positive.");
                            break;
                        case 'spherical':
                            params.D = getVal('diameter');
                            if (params.D <= 0) throw new Error("Dimensions must be positive.");
                            break;
                        default:
                            throw new Error("Invalid tank type selected.");
                    }
                    return params;
                } catch (e) {
                    displayMessage(e.message, "error");
                    return null;
                }
            }

            /**
             * Calculates total and liquid volumes based on SI parameters.
             * @param {object} params - The object of SI parameters from getInputsInSI().
             * @param {number} h_liquid_override - Optional liquid level override for strapping chart.
             * @returns {object} An object with volumes and calculation HTML.
             */
            function calculateVolumes(params, h_liquid_override = null) {
                const h_liquid = (h_liquid_override !== null) ? h_liquid_override : params.h_liquid;
                let totalVolumeCubic = 0, liquidVolumeCubic = 0;
                let calculationHtml = '<h4>Detailed Calculation Steps (SI Units):</h4>';
                let totalTankHeight = 0;

                switch (params.tankType) {
                    case 'vertical-cylinder-flat':
                        const R_vcf = params.D / 2;
                        totalTankHeight = params.H;
                        totalVolumeCubic = Math.PI * R_vcf**2 * params.H;
                        liquidVolumeCubic = Math.PI * R_vcf**2 * Math.min(h_liquid, params.H);
                        
                        calculationHtml += `<p class="formula">\\[ V_{total} = \\pi R^2 H \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{total}\\) = \\( \\pi \\times ${R_vcf.toFixed(3)}^2 \\times ${params.H.toFixed(3)} \\) = ${totalVolumeCubic.toFixed(4)} m³</p>`;
                        calculationHtml += `<p class="formula">\\[ V_{liquid} = \\pi R^2 \\cdot h_{liquid} \\text{ (up to H)} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{liquid}\\) = \\( \\pi \\times ${R_vcf.toFixed(3)}^2 \\times ${Math.min(h_liquid, params.H).toFixed(3)} \\) = ${liquidVolumeCubic.toFixed(4)} m³</p>`;
                        break;
                    
                    case 'vertical-cylinder-cone':
                        const R_vcc = params.D / 2;
                        const V_cyl_vcc = Math.PI * R_vcc**2 * params.H;
                        const V_cone_b = (1/3) * Math.PI * R_vcc**2 * params.h_cb;
                        const V_cone_t = (1/3) * Math.PI * R_vcc**2 * params.h_ct;
                        totalTankHeight = params.h_cb + params.H + params.h_ct;
                        totalVolumeCubic = V_cyl_vcc + V_cone_b + V_cone_t;

                        calculationHtml += `<p class="formula">\\[ V_{total} = V_{cyl} + V_{cone,bottom} + V_{cone,top} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{cyl}\\) = \\( \\pi \\times ${R_vcc.toFixed(3)}^2 \\times ${params.H.toFixed(3)} \\) = ${V_cyl_vcc.toFixed(4)} m³</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{cone,b}\\) = \\( \\frac{1}{3} \\pi \\times ${R_vcc.toFixed(3)}^2 \\times ${params.h_cb.toFixed(3)} \\) = ${V_cone_b.toFixed(4)} m³</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{cone,t}\\) = \\( \\frac{1}{3} \\pi \\times ${R_vcc.toFixed(3)}^2 \\times ${params.h_ct.toFixed(3)} \\) = ${V_cone_t.toFixed(4)} m³</p>`;
                        
                        if (h_liquid <= params.h_cb) {
                            if (params.h_cb > 0) {
                                let R_liq = R_vcc * (h_liquid / params.h_cb);
                                liquidVolumeCubic = (1/3) * Math.PI * R_liq**2 * h_liquid;
                                calculationHtml += `<p class="calculation-step">Liquid in Bottom Cone: \\(V_{liq} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                            } else {
                                liquidVolumeCubic = 0;
                            }
                        } else if (h_liquid <= params.h_cb + params.H) {
                            liquidVolumeCubic = V_cone_b + Math.PI * R_vcc**2 * (h_liquid - params.h_cb);
                            calculationHtml += `<p class="calculation-step">Liquid in Bottom Cone + Cylinder: \\(V_{liq} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                        } else if (h_liquid < totalTankHeight) {
                            if (params.h_ct > 0) {
                                const h_unfilled = totalTankHeight - h_liquid;
                                const R_unfilled = R_vcc * (h_unfilled / params.h_ct);
                                const V_unfilled = (1/3) * Math.PI * R_unfilled**2 * h_unfilled;
                                liquidVolumeCubic = totalVolumeCubic - V_unfilled;
                                calculationHtml += `<p class="calculation-step">Liquid in Full Bottom + Cyl + Partial Top: \\(V_{liq} = V_{total} - V_{unfilled,top} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                            } else {
                                liquidVolumeCubic = V_cone_b + V_cyl_vcc; // Full cone + full cyl
                            }
                        } else {
                            liquidVolumeCubic = totalVolumeCubic;
                            calculationHtml += `<p class="calculation-step">Tank is Full: \\(V_{liq} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                        }
                        break;
                        
                    case 'vertical-cylinder-ellip':
                        const R_vce = params.D / 2;
                        const h_head_vce = params.D / 4; // 2:1 Ellipsoidal head height
                        const V_cyl_vce = Math.PI * R_vce**2 * params.H;
                        const V_head_vce = (Math.PI / 24) * params.D**3; // Volume of ONE 2:1 head
                        totalTankHeight = params.H + 2 * h_head_vce;
                        totalVolumeCubic = V_cyl_vce + 2 * V_head_vce;
                        
                        calculationHtml += `<p class="formula">\\[ h_{head} = D / 4 = ${h_head_vce.toFixed(3)} \\text{ m} \\]</p>`;
                        calculationHtml += `<p class="formula">\\[ V_{head} = \\frac{\\pi D^3}{24} = ${V_head_vce.toFixed(4)} \\text{ m³} \\]</p>`;
                        calculationHtml += `<p class="formula">\\[ V_{cyl} = \\pi R^2 H = ${V_cyl_vce.toFixed(4)} \\text{ m³} \\]</p>`;
                        calculationHtml += `<p class="formula">\\[ V_{total} = V_{cyl} + 2 \\cdot V_{head} = ${totalVolumeCubic.toFixed(4)} \\text{ m³} \\]</p>`;

                        if (h_liquid <= h_head_vce) {
                            liquidVolumeCubic = V_VerticalEllipsoidalHead(params.D, h_liquid);
                            calculationHtml += `<p class="calculation-step">Liquid in Bottom Head: \\(V_{liq} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                        } else if (h_liquid <= h_head_vce + params.H) {
                            liquidVolumeCubic = V_head_vce + Math.PI * R_vce**2 * (h_liquid - h_head_vce);
                            calculationHtml += `<p class="calculation-step">Liquid in Bottom Head + Cylinder: \\(V_{liq} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                        } else if (h_liquid < totalTankHeight) {
                            const h_in_top_head = h_liquid - h_head_vce - params.H;
                            liquidVolumeCubic = V_head_vce + V_cyl_vce + V_VerticalEllipsoidalHead(params.D, h_in_top_head);
                            calculationHtml += `<p class="calculation-step">Liquid in Full Bottom + Cyl + Partial Top: \\(V_{liq} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                        } else {
                            liquidVolumeCubic = totalVolumeCubic;
                            calculationHtml += `<p class="calculation-step">Tank is Full: \\(V_{liq} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                        }
                        break;
                        
                    case 'horizontal-cylinder-flat':
                        const R_hcf = params.D / 2;
                        totalTankHeight = params.D;
                        totalVolumeCubic = Math.PI * R_hcf**2 * params.L;
                        liquidVolumeCubic = V_HorizontalCylinder(params.D, params.L, h_liquid);
                        
                        calculationHtml += `<p class="formula">\\[ V_{total} = \\pi R^2 L \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{total}\\) = \\( \\pi \\times ${R_hcf.toFixed(3)}^2 \\times ${params.L.toFixed(3)} \\) = ${totalVolumeCubic.toFixed(4)} m³</p>`;
                        calculationHtml += `<p class="formula">\\[ V_{liquid} = L \\cdot (R^2 \\cos^{-1}(\\frac{R-h}{R}) - (R-h)\\sqrt{2Rh-h^2}) \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{liquid}\\) = ${liquidVolumeCubic.toFixed(4)} m³</p>`;
                        break;
                        
                    case 'horizontal-cylinder-ellip':
                        const R_hce = params.D / 2;
                        const h_head_hce = params.D / 4;
                        const V_cyl_hce = Math.PI * R_hce**2 * params.L;
                        const V_head_hce = (Math.PI / 24) * params.D**3; // Volume of ONE head
                        const V_heads_total = 2 * V_head_hce;
                        totalTankHeight = params.D;
                        totalVolumeCubic = V_cyl_hce + V_heads_total;

                        calculationHtml += `<p class="formula">\\[ V_{cyl} = \\pi R^2 L = ${V_cyl_hce.toFixed(4)} \\text{ m³} \\]</p>`;
                        calculationHtml += `<p class="formula">\\[ V_{heads,total} = 2 \\cdot \\frac{\\pi D^3}{24} = ${V_heads_total.toFixed(4)} \\text{ m³} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{total}\\) = ${totalVolumeCubic.toFixed(4)} m³</p>`;
                        
                        const V_cyl_liq = V_HorizontalCylinder(params.D, params.L, h_liquid);
                        let fill_ratio = (V_cyl_hce > 0) ? (V_cyl_liq / V_cyl_hce) : 0;
                        if (h_liquid >= params.D) fill_ratio = 1;
                        if (h_liquid <= 0) fill_ratio = 0;
                        const V_heads_liq = V_heads_total * fill_ratio; // Pro-rata approximation
                        liquidVolumeCubic = V_cyl_liq + V_heads_liq;
                        
                        calculationHtml += `<p class="calculation-step">Cylinder Liquid Volume \\(V_{cyl,liq}\\) = ${V_cyl_liq.toFixed(4)} m³</p>`;
                        calculationHtml += `<p class="calculation-step">Fill Ratio \\(f\\) = \\(V_{cyl,liq} / V_{cyl,total}\\) = ${fill_ratio.toFixed(4)}</p>`;
                        calculationHtml += `<p class="calculation-step">Heads Liquid Volume (Approx.) \\(V_{heads,liq} \\approx f \\cdot V_{heads,total}\\) = ${V_heads_liq.toFixed(4)} m³</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{liquid} = V_{cyl,liq} + V_{heads,liq} = ${liquidVolumeCubic.toFixed(4)} m³\\)</p>`;
                        break;
                        
                    case 'rectangular':
                        totalTankHeight = params.H;
                        totalVolumeCubic = params.L * params.W * params.H;
                        liquidVolumeCubic = params.L * params.W * Math.min(h_liquid, params.H);
                        
                        calculationHtml += `<p class="formula">\\[ V_{total} = L \\cdot W \\cdot H \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{total}\\) = ${params.L.toFixed(3)} \\times ${params.W.toFixed(3)} \\times ${params.H.toFixed(3)} = ${totalVolumeCubic.toFixed(4)} m³</p>`;
                        calculationHtml += `<p class="formula">\\[ V_{liquid} = L \\cdot W \\cdot h_{liquid} \\text{ (up to H)} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{liquid}\\) = ${params.L.toFixed(3)} \\times ${params.W.toFixed(3)} \\times ${Math.min(h_liquid, params.H).toFixed(3)} = ${liquidVolumeCubic.toFixed(4)} m³</p>`;
                        break;
                        
                    case 'spherical':
                        const R_sph = params.D / 2;
                        totalTankHeight = params.D;
                        totalVolumeCubic = (4/3) * Math.PI * R_sph**3;
                        liquidVolumeCubic = V_SphericalSegment(R_sph, h_liquid);
                        
                        calculationHtml += `<p class="formula">\\[ V_{total} = \\frac{4}{3} \\pi R^3 \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{total}\\) = \\( \\frac{4}{3} \\pi \\times ${R_sph.toFixed(3)}^3 \\) = ${totalVolumeCubic.toFixed(4)} m³</p>`;
                        calculationHtml += `<p class="formula">\\[ V_{liquid} = \\frac{1}{3} \\pi h^2 (3R - h) \\]</p>`;
                        calculationHtml += `<p class="calculation-step">\\(V_{liquid}\\) = ${liquidVolumeCubic.toFixed(4)} m³</p>`;
                        break;
                }

                return {
                    totalVolumeCubic: totalVolumeCubic,
                    liquidVolumeCubic: liquidVolumeCubic,
                    calculationHtml: calculationHtml,
                    totalTankHeight: totalTankHeight
                };
            }

            /**
             * Main function to run calculation and update UI.
             */
            function runCalculation() {
                const params = getInputsInSI();
                if (!params) return; // Error occurred

                const results = calculateVolumes(params);
                if (!results) return; // Calculation failed

                // --- Convert for Display ---
                const unitSystem = params.unitSystem;
                const ft3_to_gallons = 7.48052; // US Gallons
                const m_to_ft = 3.28084;
                const m3_to_ft3 = m_to_ft**3;

                let totalVolumeDisplay, liquidVolumeDisplay;
                let totalVolUnit, liquidVolUnit;

                if (unitSystem === 'imperial') {
                    totalVolumeDisplay = results.totalVolumeCubic * m3_to_ft3 * ft3_to_gallons;
                    liquidVolumeDisplay = results.liquidVolumeCubic * m3_to_ft3 * ft3_to_gallons;
                    totalVolUnit = `Gallons (${(results.totalVolumeCubic * m3_to_ft3).toFixed(3)} ft³)`;
                    liquidVolUnit = `Gallons (${(results.liquidVolumeCubic * m3_to_ft3).toFixed(3)} ft³)`;
                } else { // Metric
                    totalVolumeDisplay = results.totalVolumeCubic * 1000;
                    liquidVolumeDisplay = results.liquidVolumeCubic * 1000;
                    totalVolUnit = `Liters (${results.totalVolumeCubic.toFixed(4)} m³)`;
                    liquidVolUnit = `Liters (${results.liquidVolumeCubic.toFixed(4)} m³)`;
                }

                // --- Populate UI ---
                resultTableBody.innerHTML = ''; // Clear previous results
                const selectedOption = document.querySelector(`.tank-type-option[data-tank-type="${params.tankType}"]`);
                const tankTypeName = selectedOption ? selectedOption.querySelector('label').textContent : 'N/A';

                addResultRow("Tank Type", tankTypeName);
                addResultRow("Total Volume", `<strong>${totalVolumeDisplay.toFixed(2)} ${totalVolUnit}</strong>`);
                addResultRow("Liquid Volume", `<strong>${liquidVolumeDisplay.toFixed(2)} ${liquidVolUnit}</strong>`);

                calculationDetailsDiv.innerHTML = results.calculationHtml;
                if (window.MathJax) {
                    window.MathJax.typeset([calculationDetailsDiv, resultTableBody]);
                }

                standardReference.innerHTML = "This calculator is based on precise geometric formulas for standard tank shapes. For official calibration and custody transfer, always refer to industry standards such as <strong>API Manual of Petroleum Measurement Standards (MPMS) Chapter 2</strong> for tank calibration, and <strong>ASME BPVC Section VIII</strong> for pressure vessel head geometry.";

                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth' });

                displayMessage("Calculation completed successfully!", "info");
            }
            
            /**
             * Generates a strapping chart and initiates download.
             */
            function generateStrappingChart() {
                const params = getInputsInSI();
                if (!params) return;

                const resultsForTotalHeight = calculateVolumes(params);
                const totalHeight_m = resultsForTotalHeight.totalTankHeight;
                if (totalHeight_m <= 0) {
                    displayMessage("Cannot generate chart: Total tank height is zero or invalid.", "error");
                    return;
                }

                const steps = 1000;
                let csvContent = "";
                
                // Units for CSV header
                const unitSystem = params.unitSystem;
                const lengthLabel = unitSystem === 'imperial' ? 'Height (ft)' : 'Height (m)';
                const volumeLabel = unitSystem === 'imperial' ? 'Volume (US Gallons)' : 'Volume (Liters)';
                const m_to_ft = 3.28084;
                const m3_to_L = 1000;
                const m3_to_gal = (3.28084**3) * 7.48052;

                csvContent += `${lengthLabel},${volumeLabel}\n`;

                for (let i = 0; i <= steps; i++) {
                    const h_m = (i / steps) * totalHeight_m;
                    const h_display = (unitSystem === 'imperial') ? (h_m * m_to_ft) : h_m;
                    
                    const vol_results = calculateVolumes(params, h_m);
                    const vol_m3 = vol_results.liquidVolumeCubic;
                    const vol_display = (unitSystem === 'imperial') ? (vol_m3 * m3_to_gal) : (vol_m3 * m3_to_L);

                    csvContent += `${h_display.toFixed(5)},${vol_display.toFixed(5)}\n`;
                }

                // Create and trigger download
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "tank_strapping_chart.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                displayMessage("Strapping chart generated!", "info");
            }

            // --- Attach Event Listeners ---
            calculateBtn.addEventListener('click', runCalculation);
            strappingChartBtn.addEventListener('click', generateStrappingChart);

            // Theme switch functionality
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }
        });
    </script>
</body>
</html>

