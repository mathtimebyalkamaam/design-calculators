<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storage Tank Volume Calculator - Design Calculators</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        // MathJax configuration to support inline and display LaTeX
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <style>
        /* CSS Variables for theming (light and dark mode) */
        :root {
            --primary-color: #2196F3;
            --secondary-color: #1976D2;
            --accent-color: #FFC107;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --header-bg: #2C3E50;
            --footer-bg: #34495E;
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            --hover-color: #e2e6ea;
            --primary-color-rgb: 33, 150, 243;
            --success-color: #28a745;
            --error-color: #dc3545;
        }
        /* Dark mode overrides */
        body.dark-mode {
            --primary-color: #5DADE2;
            --secondary-color: #2874A6;
            --bg-color: #252D3A;
            --card-bg: #2F3C4C;
            --text-color: #E0E6EB;
            --header-bg: #252D3A;
            --footer-bg: #252D3A;
            --border-color: #4C5C70;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #3A475C;
            --primary-color-rgb: 93, 173, 226;
            --success-color: #4CAF50;
            --error-color: #F44336;
        }
        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, var(--bg-color) 0%, rgba(244, 247, 246, 0.8) 100%);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s, background-image 0.3s;
        }
        /* Container for content width limitation and centering */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }
        /* Header styling */
        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        header h1 {
            margin: 0;
            font-size: 2.8em;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        header .subtitle {
            margin: 8px 0 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }
        /* Main content area styling */
        main {
            padding: 30px 0;
        }
        /* Tool container styling */
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            transition: transform 0.3s ease-in-out;
        }
        .tool-container:hover {
            transform: translateY(-5px);
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 2em;
        }
        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1.05em;
        }
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }
        .tool-description strong {
            color: var(--primary-color);
        }
        /* Back button styling */
        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 25px;
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            font-weight: bold;
        }
        .back-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.03);
        }
        /* Theme toggle switch styling */
        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
        }
        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px;
            font-size: 1.3em;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 65px;
            height: 38px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(27px);
        }
        .slider.round {
            border-radius: 38px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        /* Footer styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }
        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.3em;
        }
        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }
        .social-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        /* Specific social button colors */
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #7f8c8d; }
        /* Calculator form styling */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.05em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.3);
            outline: none;
        }
        /* Responsive form row layout */
        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap; /* Allows items to wrap on smaller screens */
        }
        .form-row .form-group {
            flex: 1 1 calc(50% - 10px); /* Two columns, with gap */
            min-width: 280px; /* Minimum width before wrapping */
        }
        /* Media query for single column on small screens */
        @media (max-width: 600px) {
            .form-row .form-group {
                flex: 1 1 100%; /* Single column */
            }
        }
        /* Calculate button styling */
        .calculate-btn {
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-image 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%; /* Full width button */
        }
        .calculate-btn:hover {
            background-image: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        /* Result container styling */
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: block; /* Always block, but opacity controls visibility */
            opacity: 0;
            transition: opacity 0.6s ease-out;
            pointer-events: none; /* Prevents interaction when hidden */
        }
        .result-container.show {
            opacity: 1;
            pointer-events: auto; /* Allows interaction when shown */
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        /* Result table styling */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            font-size: 1.1em;
        }
        .result-table tr:last-child td {
            border-bottom: none;
        }
        /* Standard reference text styling */
        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            line-height: 1.5;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        /* Tooltip styling */
        .info-icon {
            color: var(--primary-color);
            margin-left: 8px;
            cursor: help;
            font-size: 1em;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the element */
            left: 50%;
            margin-left: -110px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%; /* Arrow at the bottom */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        /* Custom message box for alerts */
        #custom-message-box {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, background-color 0.3s;
            font-size: 1.1em;
        }
        #custom-message-box.info {
            background-color: var(--success-color);
        }
        #custom-message-box.error {
            background-color: var(--error-color);
        }
        #custom-message-box.warning {
            background-color: var(--accent-color);
            color: #333;
        }

        /* Calculation details section styling */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.98em;
            overflow-x: auto; /* Allow horizontal scrolling for formulas if needed */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            border: 1px dashed var(--border-color);
            white-space: nowrap; /* Prevent formula from wrapping */
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 0.95em;
            white-space: nowrap; /* Prevent calculation steps from wrapping */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #calculation-details ul li {
            margin-bottom: 5px;
        }
        /* Specific styling for required inputs to highlight visually */
        input:required:invalid {
            border-color: var(--error-color);
        }
        input:required:valid {
            border-color: var(--success-color);
        }

        /* Styling specific to Tank Volume Calculator */
        .tank-type-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .tank-type-option {
            flex: 1 1 calc(33% - 10px); /* 3 columns by default */
            min-width: 150px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--bg-color);
        }

        .tank-type-option.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--secondary-color);
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.4);
            transform: translateY(-3px);
        }

        .tank-type-option:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tank-type-option input[type="radio"] {
            display: none;
        }

        .tank-type-option label {
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 0; /* Override default label margin */
            color: inherit; /* Inherit color from parent (.tank-type-option) */
        }
        /* Removed .tank-type-option img styling as images are removed */

        .form-section {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            background-color: var(--bg-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        .form-section h3 {
            margin-top: 0;
            color: var(--secondary-color);
            border-bottom: 1px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators</h1>
            <p class="subtitle">Smart Tools for Modern Mechanical Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <a href="indexMech.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Tools
        </a>

        <div class="tool-container">
            <h2>Storage Tank Volume Calculator</h2>
            <div class="tool-description">
                <p>This calculator determines the total and liquid volume for various types of storage tanks, aiding mechanical engineers in design, operation, and inventory management. The calculations are based on fundamental geometric principles commonly applied in engineering practice, referenced against standards like <strong>API 650 (Welded Tanks for Oil Storage)</strong> and <strong>ASME BPVC (Pressure Vessels)</strong> where applicable for dimensions and general vessel types.</p>
                <p><strong>Supported Tank Shapes:</strong></p>
                <ul>
                    <li><strong>Vertical Cylindrical (Flat Bottom/Top, Conical Top/Bottom, Spherical Top/Bottom)</strong>: Common for large storage.</li>
                    <li><strong>Horizontal Cylindrical (Flat Ends, Torispherical/Ellipsoidal Ends)</strong>: Used for various liquids.</li>
                    <li><strong>Rectangular/Box Tanks</strong>: Simple and versatile.</li>
                    <li><strong>Spherical Tanks</strong>: For high-pressure storage.</li>
                </ul>
                <p><strong>Units:</strong> Ensure consistency. If you use meters for length, the volume will be in cubic meters ($m^3$) and then converted to Liters (L).</p>
            </div>

            <div class="calculator-form">
                <form id="tank-volume-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (m, L) or Imperial (feet, gallons) units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (m, Liters)</option>
                                <option value="imperial">Imperial (feet, Gallons)</option>
                            </select>
                        </div>
                    </div>

                    <h3>Select Tank Type:</h3>
                    <div class="tank-type-options">
                        <div class="tank-type-option" data-tank-type="vertical-cylinder-flat">
                            <input type="radio" id="type-vertical-flat" name="tankType" value="vertical-cylinder-flat" checked>
                            <label for="type-vertical-flat">Vertical Cylindrical (Flat)</label>
                            <!-- Removed img tag -->
                        </div>
                        <div class="tank-type-option" data-tank-type="vertical-cylinder-cone">
                            <input type="radio" id="type-vertical-cone" name="tankType" value="vertical-cylinder-cone">
                            <label for="type-vertical-cone">Vertical Cylindrical (Conical Ends)</label>
                            <!-- Removed img tag -->
                        </div>
                         <div class="tank-type-option" data-tank-type="vertical-cylinder-dome">
                            <input type="radio" id="type-vertical-dome" name="tankType" value="vertical-cylinder-dome">
                            <label for="type-vertical-dome">Vertical Cylindrical (Domed Ends)</label>
                            <!-- Removed img tag -->
                        </div>
                        <div class="tank-type-option" data-tank-type="horizontal-cylinder-flat">
                            <input type="radio" id="type-horizontal-flat" name="tankType" value="horizontal-cylinder-flat">
                            <label for="type-horizontal-flat">Horizontal Cylindrical (Flat Ends)</label>
                            <!-- Removed img tag -->
                        </div>
                         <div class="tank-type-option" data-tank-type="horizontal-cylinder-dishe">
                            <input type="radio" id="type-horizontal-dishe" name="tankType" value="horizontal-cylinder-dishe">
                            <label for="type-horizontal-dishe">Horizontal Cylindrical (Dished Ends)</label>
                            <!-- Removed img tag -->
                        </div>
                        <div class="tank-type-option" data-tank-type="rectangular">
                            <input type="radio" id="type-rectangular" name="tankType" value="rectangular">
                            <label for="type-rectangular">Rectangular Tank</label>
                            <!-- Removed img tag -->
                        </div>
                        <div class="tank-type-option" data-tank-type="spherical">
                            <input type="radio" id="type-spherical" name="tankType" value="spherical">
                            <label for="type-spherical">Spherical Tank</label>
                            <!-- Removed img tag -->
                        </div>
                    </div>

                    <div id="tank-parameters-section" class="form-section">
                        <h3>Tank Dimensions</h3>
                        <!-- Dynamic input fields will be loaded here based on tank type -->
                    </div>

                    <div class="form-section">
                        <h3>Liquid Level</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="liquid-level">Liquid Level (h) <span class="length-unit-label">(m)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the liquid from the bottom of the tank. For horizontal cylindrical tanks, this is the depth of liquid.</span></span></label>
                                <input type="number" id="liquid-level" step="0.01" value="1.0" required>
                            </div>
                        </div>
                    </div>

                    <button type="button" id="calculate-volume-btn" class="calculate-btn">Calculate Volume</button>
                </form>
            </div>

            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="mailto:?subject=Check out Design Calculators!&body=I found this amazing Nozzle Reinforcement Calculator and other mechanical tools: https://designcalculators.co.in" class="social-btn email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to DOM elements
            const calculateBtn = document.getElementById('calculate-volume-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const tankTypeOptions = document.querySelectorAll('.tank-type-option');
            const tankParametersSection = document.getElementById('tank-parameters-section');
            const unitSystemSelect = document.getElementById('unit-system');
            const liquidLevelInput = document.getElementById('liquid-level');

            // Unit labels
            const lengthUnitLabels = document.querySelectorAll('.length-unit-label');
            const volumeUnitLabels = document.querySelectorAll('.volume-unit-label');

            /**
             * Displays a custom message box at the top of the screen.
             * @param {string} message - The message to display.
             * @param {string} type - The type of message ('info', 'error', 'warning').
             */
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add(type); // Add type class for styling
                messageBox.style.opacity = 1;

                // Hide message after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            /**
             * Updates the unit labels in the UI based on the selected unit system.
             */
            function updateUnitLabels() {
                const unitSystem = unitSystemSelect.value;
                const lengthUnit = unitSystem === 'imperial' ? '(ft)' : '(m)';
                const volumeUnit = unitSystem === 'imperial' ? '(Gallons)' : '(L)';

                lengthUnitLabels.forEach(label => label.textContent = lengthUnit);
                volumeUnitLabels.forEach(label => label.textContent = volumeUnit);

                // Update input step values
                const stepValue = unitSystem === 'imperial' ? '0.01' : '0.01';
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    if (input.id !== 'liquid-level' && !input.id.includes('level')) { // Don't change steps for specific inputs
                        input.step = stepValue;
                    }
                });
            }

            unitSystemSelect.addEventListener('change', updateUnitLabels);

            /**
             * Loads input fields specific to the selected tank type.
             * @param {string} tankType - The selected tank type.
             */
            function loadTankInputs(tankType) {
                let inputsHtml = '';
                const lengthUnit = unitSystemSelect.value === 'imperial' ? '(ft)' : '(m)';

                switch (tankType) {
                    case 'vertical-cylinder-flat':
                        inputsHtml = `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Diameter (D) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical tank.</span></span></label>
                                    <input type="number" id="diameter" step="0.1" value="2.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="height">Cylindrical Height (H) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the cylindrical section of the tank.</span></span></label>
                                    <input type="number" id="height" step="0.1" value="3.0" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'vertical-cylinder-cone':
                         inputsHtml = `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Cylinder Diameter (D) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical section.</span></span></label>
                                    <input type="number" id="diameter" step="0.1" value="2.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="height">Cylindrical Height (H) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the cylindrical section.</span></span></label>
                                    <input type="number" id="height" step="0.1" value="2.0" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cone-height-bottom">Bottom Cone Height (h_cb) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Vertical height of the conical bottom.</span></span></label>
                                    <input type="number" id="cone-height-bottom" step="0.01" value="0.5" required>
                                </div>
                                <div class="form-group">
                                    <label for="cone-height-top">Top Cone Height (h_ct) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Vertical height of the conical top.</span></span></label>
                                    <input type="number" id="cone-height-top" step="0.01" value="0.5" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'vertical-cylinder-dome':
                        inputsHtml = `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Cylinder Diameter (D) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical section.</span></span></label>
                                    <input type="number" id="diameter" step="0.1" value="2.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="height">Cylindrical Height (H) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the cylindrical section.</span></span></label>
                                    <input type="number" id="height" step="0.1" value="2.0" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="dish-radius-bottom">Bottom Dish Radius (R_db) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Crown radius of the dished bottom. Typically 0.9*D to D.</span></span></label>
                                    <input type="number" id="dish-radius-bottom" step="0.01" value="2.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="dish-radius-top">Top Dish Radius (R_dt) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Crown radius of the dished top. Typically 0.9*D to D.</span></span></label>
                                    <input type="number" id="dish-radius-top" step="0.01" value="2.0" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="knuckle-radius-bottom">Bottom Knuckle Radius (r_kb) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Knuckle radius of the dished bottom. Typically 0.06*D to 0.1*D.</span></span></label>
                                    <input type="number" id="knuckle-radius-bottom" step="0.01" value="0.12" required>
                                </div>
                                <div class="form-group">
                                    <label for="knuckle-radius-top">Top Knuckle Radius (r_kt) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Knuckle radius of the dished top. Typically 0.06*D to 0.1*D.</span></span></label>
                                    <input type="number" id="knuckle-radius-top" step="0.01" value="0.12" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'horizontal-cylinder-flat':
                        inputsHtml = `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Diameter (D) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical tank.</span></span></label>
                                    <input type="number" id="diameter" step="0.1" value="2.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="length">Cylindrical Length (L) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Length of the cylindrical section (straight part).</span></span></label>
                                    <input type="number" id="length" step="0.1" value="5.0" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'horizontal-cylinder-dishe':
                         inputsHtml = `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="diameter">Cylinder Diameter (D) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the cylindrical section.</span></span></label>
                                    <input type="number" id="diameter" step="0.1" value="2.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="length">Cylindrical Length (L) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Length of the cylindrical section (straight part).</span></span></label>
                                    <input type="number" id="length" step="0.1" value="4.0" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="dish-radius">Dish Radius (R_d) ${lengthUnit}: <span class="tooltip"><i class="fas fa="info-circle info-icon"></i><span class="tooltiptext">Crown radius of the dished ends. Typically 0.9*D to D.</span></span></label>
                                    <input type="number" id="dish-radius" step="0.01" value="2.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="knuckle-radius">Knuckle Radius (r_k) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Knuckle radius of the dished ends. Typically 0.06*D to 0.1*D.</span></span></label>
                                    <input type="number" id="knuckle-radius" step="0.01" value="0.12" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'rectangular':
                        inputsHtml = `
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="length">Length (L) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Length of the rectangular tank.</span></span></label>
                                    <input type="number" id="length" step="0.1" value="3.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="width">Width (W) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Width of the rectangular tank.</span></span></label>
                                    <input type="number" id="width" step="0.1" value="2.0" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="height">Height (H) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Height of the rectangular tank.</span></span></label>
                                    <input type="number" id="height" step="0.1" value="2.0" required>
                                </div>
                            </div>
                        `;
                        break;
                    case 'spherical':
                        inputsHtml = `
                            <div class="form-group">
                                <label for="diameter">Diameter (D) ${lengthUnit}: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Internal diameter of the spherical tank.</span></span></label>
                                <input type="number" id="diameter" step="0.1" value="3.0" required>
                            </div>
                        `;
                        break;
                    default:
                        inputsHtml = `<p>Select a tank type to enter dimensions.</p>`;
                }
                tankParametersSection.innerHTML = inputsHtml;
                updateUnitLabels(); // Re-apply unit labels after loading new inputs
            }

            // Event listeners for tank type selection
            tankTypeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    tankTypeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input[type="radio"]').checked = true;
                    loadTankInputs(this.dataset.tankType);
                });
            });

            // Initial load of inputs based on default selected tank type
            const initialTankType = document.querySelector('input[name="tankType"]:checked').value;
            document.querySelector(`.tank-type-option[data-tank-type="${initialTankType}"]`).classList.add('selected');
            loadTankInputs(initialTankType);


            /**
             * Adds a row to the result table.
             * @param {string} parameterHtml - The HTML content for the parameter column.
             * @param {string} valueHtml - The HTML content for the value column.
             */
            function addResultRow(parameterHtml, valueHtml) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameterHtml;
                valueCell.innerHTML = valueHtml;
            }

            // Function to calculate volume of a spherical segment (for partially filled spherical tanks)
            function calculateSphericalSegmentVolume(R, h_liquid) {
                if (h_liquid <= 0) return 0;
                if (h_liquid >= 2 * R) return (4/3) * Math.PI * Math.pow(R, 3); // Full sphere

                // Volume of spherical cap = (1/3) * pi * h^2 * (3R - h)
                return (1/3) * Math.PI * Math.pow(h_liquid, 2) * (3 * R - h_liquid);
            }

             // Function to calculate volume of a horizontal cylinder with flat ends, partially filled
            function calculateHorizontalCylinderPartialVolume(D, L, h_liquid) {
                const R = D / 2;
                if (h_liquid <= 0) return 0;
                if (h_liquid >= D) return Math.PI * Math.pow(R, 2) * L; // Full cylinder

                // Area of circular segment
                const theta = 2 * Math.acos((R - h_liquid) / R); // Angle in radians
                const area = Math.pow(R, 2) / 2 * (theta - Math.sin(theta));
                return area * L;
            }

            // Event listener for the calculate button
            calculateBtn.addEventListener('click', function() {
                const form = document.getElementById('tank-volume-form');
                if (!form.checkValidity()) {
                    displayMessage("Please fill in all required fields correctly.", "error");
                    form.reportValidity();
                    return;
                }

                const unitSystem = unitSystemSelect.value;
                const lengthConversionFactor = unitSystem === 'imperial' ? 0.3048 : 1; // 1 ft = 0.3048 m
                const volumeConversionFactor = unitSystem === 'imperial' ? 3.78541 : 1; // 1 Gallon = 3.78541 Liters (for output from m^3 to L)

                let totalVolumeCubic = 0; // in m^3
                let liquidVolumeCubic = 0; // in m^3
                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                let tankType = document.querySelector('input[name="tankType"]:checked').value;

                // Helper to get input value, convert to base unit (m)
                const getInputValue = (id) => {
                    const value = parseFloat(document.getElementById(id).value);
                    return unitSystem === 'imperial' ? value * lengthConversionFactor : value;
                };

                const h_liquid_base = getInputValue('liquid-level'); // Liquid level in meters

                switch (tankType) {
                    case 'vertical-cylinder-flat':
                        const D_vc_flat = getInputValue('diameter');
                        const H_vc_flat = getInputValue('height');
                        const R_vc_flat = D_vc_flat / 2;

                        totalVolumeCubic = Math.PI * Math.pow(R_vc_flat, 2) * H_vc_flat;
                        liquidVolumeCubic = Math.PI * Math.pow(R_vc_flat, 2) * Math.min(h_liquid_base, H_vc_flat);

                        calculationHtml += `<p><strong>Vertical Cylindrical Tank (Flat Bottom/Top) Calculations:</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ V_{total} = \\pi R^2 H \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{total}\\) = \\( \\pi \\times ${R_vc_flat.toFixed(3)}^2 \\times ${H_vc_flat.toFixed(3)} \\) = ${totalVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="formula">\\[ V_{liquid} = \\pi R^2 \\cdot h_{liquid} \\text{ (up to H)} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{liquid}\\) = \\( \\pi \\times ${R_vc_flat.toFixed(3)}^2 \\times ${Math.min(h_liquid_base, H_vc_flat).toFixed(3)} \\) = ${liquidVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        break;

                    case 'vertical-cylinder-cone':
                        const D_vc_cone = getInputValue('diameter');
                        const H_vc_cone = getInputValue('height');
                        const h_cb_cone = getInputValue('cone-height-bottom');
                        const h_ct_cone = getInputValue('cone-height-top');
                        const R_vc_cone = D_vc_cone / 2;

                        // Total Volume
                        const V_cyl_cone_total = Math.PI * Math.pow(R_vc_cone, 2) * H_vc_cone;
                        const V_cone_bottom_total = (1/3) * Math.PI * Math.pow(R_vc_cone, 2) * h_cb_cone;
                        const V_cone_top_total = (1/3) * Math.PI * Math.pow(R_vc_cone, 2) * h_ct_cone;
                        totalVolumeCubic = V_cyl_cone_total + V_cone_bottom_total + V_cone_top_total;

                        calculationHtml += `<p><strong>Vertical Cylindrical Tank (Conical Ends) Calculations:</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ V_{total} = \\pi R^2 H_{cyl} + \\frac{1}{3} \\pi R^2 h_{cb} + \\frac{1}{3} \\pi R^2 h_{ct} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{cyl,total}\\) = \\( \\pi \\times ${R_vc_cone.toFixed(3)}^2 \\times ${H_vc_cone.toFixed(3)} \\) = ${V_cyl_cone_total.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{cone,bottom,total}\\) = \\( \\frac{1}{3} \\pi \\times ${R_vc_cone.toFixed(3)}^2 \\times ${h_cb_cone.toFixed(3)} \\) = ${V_cone_bottom_total.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{cone,top,total}\\) = \\( \\frac{1}{3} \\pi \\times ${R_vc_cone.toFixed(3)}^2 \\times ${h_ct_cone.toFixed(3)} \\) = ${V_cone_top_total.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{total}\\) = ${totalVolumeCubic.toFixed(3)} m^3
                        </p>`;

                        // Liquid Volume
                        const totalHeight = h_cb_cone + H_vc_cone + h_ct_cone;
                        if (h_liquid_base <= h_cb_cone) { // Liquid in bottom cone
                            liquidVolumeCubic = (1/3) * Math.PI * Math.pow(R_vc_cone * (h_liquid_base / h_cb_cone), 2) * h_liquid_base;
                            calculationHtml += `<p><strong>Liquid in Bottom Cone:</strong></p>`;
                            calculationHtml += `<p class="formula">\\[ V_{liquid} = \\frac{1}{3} \\pi (R \\cdot \\frac{h_{liquid}}{h_{cb}})^2 \\cdot h_{liquid} \\]</p>`;
                        } else if (h_liquid_base <= h_cb_cone + H_vc_cone) { // Liquid in bottom cone + cylinder
                            liquidVolumeCubic = V_cone_bottom_total + Math.PI * Math.pow(R_vc_cone, 2) * (h_liquid_base - h_cb_cone);
                            calculationHtml += `<p><strong>Liquid in Bottom Cone + Cylinder:</strong></p>`;
                            calculationHtml += `<p class="formula">\\[ V_{liquid} = V_{cone,bottom} + \\pi R^2 (h_{liquid} - h_{cb}) \\]</p>`;
                        } else { // Liquid in bottom cone + cylinder + partial top cone
                            liquidVolumeCubic = totalVolumeCubic - (1/3) * Math.PI * Math.pow(R_vc_cone * ((totalHeight - h_liquid_base) / h_ct_cone), 2) * (totalHeight - h_liquid_base);
                            calculationHtml += `<p><strong>Liquid in Bottom Cone + Cylinder + Partial Top Cone:</strong></p>`;
                            calculationHtml += `<p class="formula">\\[ V_{liquid} = V_{total} - \\frac{1}{3} \\pi (R \\cdot \\frac{H_{remaining}}{h_{ct}})^2 \\cdot H_{remaining} \\]</p>`;
                        }
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{liquid}\\) = ${liquidVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        break;

                    case 'vertical-cylinder-dome':
                        const D_vc_dome = getInputValue('diameter');
                        const H_vc_dome = getInputValue('height');
                        const R_db_dome = getInputValue('dish-radius-bottom');
                        const r_kb_dome = getInputValue('knuckle-radius-bottom');
                        const R_dt_dome = getInputValue('dish-radius-top');
                        const r_kt_dome = getInputValue('knuckle-radius-top');
                        const R_cyl_dome = D_vc_dome / 2;

                        // Calculate dish heights
                        const h_dish_bottom = R_db_dome - Math.sqrt(Math.pow(R_db_dome, 2) - Math.pow(R_cyl_dome - r_kb_dome, 2)) + r_kb_dome;
                        const h_dish_top = R_dt_dome - Math.sqrt(Math.pow(R_dt_dome, 2) - Math.pow(R_cyl_dome - r_kt_dome, 2)) + r_kt_dome;

                        // Total Volume
                        const V_cyl_dome_total = Math.PI * Math.pow(R_cyl_dome, 2) * H_vc_dome;
                        const V_dish_bottom_total = (Math.PI / 3) * (2 * Math.pow(R_db_dome, 3) + Math.pow(r_kb_dome, 3)); // Approximation for torispherical
                        const V_dish_top_total = (Math.PI / 3) * (2 * Math.pow(R_dt_dome, 3) + Math.pow(r_kt_dome, 3)); // Approximation
                        totalVolumeCubic = V_cyl_dome_total + V_dish_bottom_total + V_dish_top_total;

                        calculationHtml += `<p><strong>Vertical Cylindrical Tank (Domed Ends) Calculations (Simplified for Torispherical/Ellipsoidal Heads):</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ V_{total} \\approx V_{cyl} + V_{bottom\_head} + V_{top\_head} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{cyl,total}\\) = \\( \\pi \\times ${R_cyl_dome.toFixed(3)}^2 \\times ${H_vc_dome.toFixed(3)} \\) = ${V_cyl_dome_total.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{bottom\_head,total}\\) \\( \\approx \\) (\\( \\frac{\\pi}{3} \\)) \\( \\times \\) (\\( 2 \\times ${R_db_dome.toFixed(3)}^3 + ${r_kb_dome.toFixed(3)}^3 \\)) = ${V_dish_bottom_total.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{top\_head,total}\\) \\( \\approx \\) (\\( \\frac{\\pi}{3} \\)) \\( \\times \\) (\\( 2 \\times ${R_dt_dome.toFixed(3)}^3 + ${r_kt_dome.toFixed(3)}^3 \\)) = ${V_dish_top_total.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{total}\\) = ${totalVolumeCubic.toFixed(3)} m^3
                        </p>`;

                        // Liquid Volume - simplified approach for domed ends
                        if (h_liquid_base <= h_dish_bottom) { // Liquid in bottom dish
                            liquidVolumeCubic = calculateSphericalSegmentVolume(R_db_dome, h_liquid_base); // Approximation
                            calculationHtml += `<p><strong>Liquid in Bottom Dish (Approximation by Spherical Segment):</strong></p>`;
                        } else if (h_liquid_base <= h_dish_bottom + H_vc_dome) { // Liquid in bottom dish + cylinder
                            liquidVolumeCubic = V_dish_bottom_total + Math.PI * Math.pow(R_cyl_dome, 2) * (h_liquid_base - h_dish_bottom);
                            calculationHtml += `<p><strong>Liquid in Bottom Dish + Cylinder:</strong></p>`;
                        } else { // Liquid in bottom dish + cylinder + partial top dish
                            const remainingHeight = h_liquid_base - (h_dish_bottom + H_vc_dome);
                            const heightFromTop = h_dish_top - remainingHeight; // Height of unfilled part of top dish
                            const V_top_unfilled = calculateSphericalSegmentVolume(R_dt_dome, heightFromTop); // Approximation
                            liquidVolumeCubic = totalVolumeCubic - V_top_unfilled;
                             calculationHtml += `<p><strong>Liquid in Bottom Dish + Cylinder + Partial Top Dish (Approximation):</strong></p>`;
                        }
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{liquid}\\) = ${liquidVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        break;

                    case 'horizontal-cylinder-flat':
                        const D_hc_flat = getInputValue('diameter');
                        const L_hc_flat = getInputValue('length');
                        totalVolumeCubic = Math.PI * Math.pow(D_hc_flat / 2, 2) * L_hc_flat;
                        liquidVolumeCubic = calculateHorizontalCylinderPartialVolume(D_hc_flat, L_hc_flat, h_liquid_base);

                        calculationHtml += `<p><strong>Horizontal Cylindrical Tank (Flat Ends) Calculations:</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ V_{total} = \\pi R^2 L \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{total}\\) = \\( \\pi \\times ${(D_hc_flat / 2).toFixed(3)}^2 \\times ${L_hc_flat.toFixed(3)} \\) = ${totalVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="formula">\\[ V_{liquid} \\text{ (partial fill) = Area of Segment} \\times L \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{liquid}\\) = ${liquidVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        break;

                    case 'horizontal-cylinder-dishe':
                        const D_hc_dishe = getInputValue('diameter');
                        const L_hc_dishe = getInputValue('length');
                        const R_d_dishe = getInputValue('dish-radius');
                        const r_k_dishe = getInputValue('knuckle-radius');
                        const R_cyl_hc_dishe = D_hc_dishe / 2;

                        // Calculate dish height (per end)
                        const h_dish_end = R_d_dishe - Math.sqrt(Math.pow(R_d_dishe, 2) - Math.pow(R_cyl_hc_dishe - r_k_dishe, 2)) + r_k_dishe;

                        // Total Volume
                        const V_cyl_hc_dishe_total = Math.PI * Math.pow(R_cyl_hc_dishe, 2) * L_hc_dishe;
                        const V_dish_ends_total = 2 * (Math.PI / 3) * (2 * Math.pow(R_d_dishe, 3) + Math.pow(r_k_dishe, 3)); // Approximation for two torispherical ends
                        totalVolumeCubic = V_cyl_hc_dishe_total + V_dish_ends_total;

                        calculationHtml += `<p><strong>Horizontal Cylindrical Tank (Dished Ends) Calculations (Simplified):</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ V_{total} = V_{cyl} + 2 \\cdot V_{dish\_end} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{cyl,total}\\) = \\( \\pi \\times ${R_cyl_hc_dishe.toFixed(3)}^2 \\times ${L_hc_dishe.toFixed(3)} \\) = ${V_cyl_hc_dishe_total.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{dish\_end,total}\\) \\( \\approx \\) (\\( 2 \\times \\frac{\\pi}{3} \\)) \\( \\times \\) (\\( 2 \\times ${R_d_dishe.toFixed(3)}^3 + ${r_k_dishe.toFixed(3)}^3 \\)) = ${V_dish_ends_total.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{total}\\) = ${totalVolumeCubic.toFixed(3)} m^3
                        </p>`;

                        // Liquid Volume - complex for dished ends, simplified.
                        // Assuming the liquid level is measured from the bottom of the cylindrical portion.
                        // For a precise calculation, liquid level in dished ends would need separate formulas.
                        // Here, we approximate full liquid volume if h_liquid is near D_hc_dishe.
                        // If h_liquid is less than D_hc_dishe, we treat it as partially filled cylinder.
                        const maxLiquidHeight = D_hc_dishe + 2 * h_dish_end;
                        if (h_liquid_base <= h_dish_end) { // Liquid in bottom dish
                            liquidVolumeCubic = calculateSphericalSegmentVolume(R_d_dishe, h_liquid_base) * 2; // Two ends
                            calculationHtml += `<p><strong>Liquid in Both Dished Ends (Approximation by Spherical Segment):</strong></p>`;
                        } else if (h_liquid_base <= h_dish_end + D_hc_dishe) { // Liquid in ends + cylinder
                            liquidVolumeCubic = (calculateSphericalSegmentVolume(R_d_dishe, h_dish_end) * 2) + calculateHorizontalCylinderPartialVolume(D_hc_dishe, L_hc_dishe, h_liquid_base - h_dish_end);
                            calculationHtml += `<p><strong>Liquid in Both Dished Ends + Partial Cylinder:</strong></p>`;
                        } else { // Fully filled or near full
                            liquidVolumeCubic = totalVolumeCubic;
                            calculationHtml += `<p><strong>Tank is Fully Filled or Liquid Level Exceeds Tank Height:</strong></p>`;
                        }
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{liquid}\\) = ${liquidVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        break;

                    case 'rectangular':
                        const L_rect = getInputValue('length');
                        const W_rect = getInputValue('width');
                        const H_rect = getInputValue('height');
                        totalVolumeCubic = L_rect * W_rect * H_rect;
                        liquidVolumeCubic = L_rect * W_rect * Math.min(h_liquid_base, H_rect);

                        calculationHtml += `<p><strong>Rectangular Tank Calculations:</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ V_{total} = L \\cdot W \\cdot H \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{total}\\) = ${L_rect.toFixed(3)} \\times ${W_rect.toFixed(3)} \\times ${H_rect.toFixed(3)} = ${totalVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p class="formula">\\[ V_{liquid} = L \\cdot W \\cdot h_{liquid} \\text{ (up to H)} \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{liquid}\\) = ${L_rect.toFixed(3)} \\times ${W_rect.toFixed(3)} \\times ${Math.min(h_liquid_base, H_rect).toFixed(3)} = ${liquidVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        break;

                    case 'spherical':
                        const D_sphere = getInputValue('diameter');
                        const R_sphere = D_sphere / 2;
                        totalVolumeCubic = (4/3) * Math.PI * Math.pow(R_sphere, 3);
                        liquidVolumeCubic = calculateSphericalSegmentVolume(R_sphere, h_liquid_base);

                        calculationHtml += `<p><strong>Spherical Tank Calculations:</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ V_{total} = \\frac{4}{3} \\pi R^3 \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{total}\\) = \\( \\frac{4}{3} \\pi \\times ${R_sphere.toFixed(3)}^3 \\) = ${totalVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        calculationHtml += `<p><strong>Liquid Volume (Partially Filled):</strong></p>`;
                        calculationHtml += `<p class="formula">\\[ V_{liquid} = \\frac{1}{3} \\pi h_{liquid}^2 (3R - h_{liquid}) \\]</p>`;
                        calculationHtml += `<p class="calculation-step">
                            \\(V_{liquid}\\) = ${liquidVolumeCubic.toFixed(3)} m^3
                        </p>`;
                        break;
                }

                // Convert cubic meters to Liters or Gallons for display
                const totalVolumeDisplay = unitSystem === 'imperial' ? (totalVolumeCubic / Math.pow(lengthConversionFactor, 3)) * volumeConversionFactor : totalVolumeCubic * 1000;
                const liquidVolumeDisplay = unitSystem === 'imperial' ? (liquidVolumeCubic / Math.pow(lengthConversionFactor, 3)) * volumeConversionFactor : liquidVolumeCubic * 1000;

                // Prepare results for display
                resultTableBody.innerHTML = ''; // Clear previous results
                addResultRow("Tank Type", document.querySelector(`label[for="type-${tankType.replace(/-/g, '_')}"]`).textContent);
                addResultRow("Total Volume", `<strong>${totalVolumeDisplay.toFixed(2)} ${unitSystem === 'imperial' ? 'Gallons' : 'Liters'}</strong> (${totalVolumeCubic.toFixed(3)} ${unitSystem === 'imperial' ? 'ft' : 'm'}^3)`);
                addResultRow("Liquid Volume", `<strong>${liquidVolumeDisplay.toFixed(2)} ${unitSystem === 'imperial' ? 'Gallons' : 'Liters'}</strong> (${liquidVolumeCubic.toFixed(3)} ${unitSystem === 'imperial' ? 'ft' : 'm'}^3)`);


                calculationDetailsDiv.innerHTML = calculationHtml;

                // Re-render MathJax equations
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv, resultTableBody]);
                }

                standardReference.innerHTML = "This calculator is based on fundamental geometric principles for volume calculation. For specific tank design and construction, refer to relevant industry standards such as <strong>API 650 (Welded Tanks for Oil Storage)</strong>, <strong>ASME BPVC (Pressure Vessels)</strong> for pressure vessel heads, and other applicable codes (e.g., NFPA for safety, local building codes).";

                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth' });

                displayMessage("Calculation completed successfully!", "info");
            });

            // Theme switch functionality
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Initial unit label update and tank input load
            updateUnitLabels();
        });
    </script>
</body>
</html>