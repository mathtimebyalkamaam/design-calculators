<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibration Transmitter & ISO 10816 Severity Calculator - Industrial Grade Analysis</title>
    <meta name="description" content="Professional Vibration Severity Calculator. Convert g/velocity/displacement, determine ISO 10816 zones (A/B/C/D), and calculate 4-20mA transmitter output for industrial machinery monitoring.">
    <meta name="keywords" content="vibration calculator, iso 10816, vibration severity, 4-20ma transmitter, acceleration to velocity, machine condition monitoring, predictive maintenance, rms vs peak">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (MATCHING SYMMETRICAL COMPONENTS) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber/Orange */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Quick Load Buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        
        /* ISO Severity Colors */
        .iso-zone-A { color: #10B981; font-weight: 800; } /* Green */
        .iso-zone-B { color: #84CC16; font-weight: 800; } /* Light Green/Yellow */
        .iso-zone-C { color: #F59E0B; font-weight: 800; } /* Orange */
        .iso-zone-D { color: #EF4444; font-weight: 800; } /* Red */

        /* Canvas Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Educational Section Styling */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .insight-card p, .insight-card ul {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text);
        }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(0,0,0,0.03);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid var(--success);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(255,255,255,0.05); }

        /* Vector Input Group Styling (Reusing class name for visual consistency) */
        .vector-input-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Print Styling */
        @media print {
            header, footer, .education-section, .theme-toggle, .button-wrapper, .preset-container { display: none !important; }
            .card { border: none; shadow: none; padding: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 300px; page-break-inside: avoid; }
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-wave-square"></i> Vibration Transmitter & ISO 10816 Severity Calculator</h2>
            
            <div class="tool-description">
                <p>This industrial-grade tool converts raw vibration signals (Acceleration, Velocity, Displacement) into the <strong>ISO 10816</strong> standard unit (Velocity RMS, mm/s). It determines the <strong>Machine Severity Zone (A-D)</strong> based on class and foundation type, and calculates the corresponding <strong>4-20mA Output</strong> for DCS/PLC scaling.</p>
            </div>

            <div class="calculator-form">
                <form id="vib-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('pump')"><i class="fas fa-cogs"></i> Centrifugal Pump (Class II)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('fan')"><i class="fas fa-fan"></i> Large Fan (Class III)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('accel')"><i class="fas fa-tachometer-alt"></i> Accel Input (g)</button>
                            </div>
                        </div>
                    </div>

                    <!-- Input Section -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. Measured Vibration Data</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-ruler-horizontal"></i> Magnitude</div>
                            <div class="form-group">
                                <label for="vib-value">Value <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The raw reading from the sensor or handheld device.</span></span></label>
                                <input type="number" id="vib-value" value="4.5" step="0.01">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-balance-scale"></i> Units</div>
                            <div class="form-group">
                                <label for="vib-unit">Measurement Unit</label>
                                <select id="vib-unit">
                                    <option value="vel_rms_mm" selected>Velocity RMS (mm/s) [ISO Std]</option>
                                    <option value="vel_pk_mm">Velocity Peak (mm/s)</option>
                                    <option value="vel_rms_ips">Velocity RMS (in/s)</option>
                                    <option value="acc_rms_g">Acceleration RMS (g)</option>
                                    <option value="acc_pk_g">Acceleration Peak (g)</option>
                                    <option value="disp_pp_um">Displacement pk-pk (µm)</option>
                                    <option value="disp_pp_mil">Displacement pk-pk (mils)</option>
                                </select>
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-wave-square"></i> Frequency</div>
                            <div class="form-group">
                                <label for="freq">Frequency [Hz] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Required for converting Acceleration or Displacement to Velocity. Typical Machine speed (1X). e.g., 1500 RPM = 25 Hz.</span></span></label>
                                <input type="number" id="freq" value="50" step="1">
                            </div>
                        </div>
                    </div>

                    <!-- Machine & Transmitter -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Machine & Transmitter Config</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="machine-class">ISO 10816 Machine Class</label>
                            <select id="machine-class">
                                <option value="1">Class I: Small Machines (&lt;15kW)</option>
                                <option value="2" selected>Class II: Medium Machines (15-300kW)</option>
                                <option value="3">Class III: Large Rigid (&gt;300kW)</option>
                                <option value="4">Class IV: Large Flexible (&gt;300kW/Turbines)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="foundation">Foundation Type</label>
                            <select id="foundation">
                                <option value="rigid" selected>Rigid (Concrete/Heavy)</option>
                                <option value="flexible">Flexible (Steel Frame/Skid)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="trans-range">Transmitter Range (mm/s RMS) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The full scale range of the 4-20mA loop. Typically 0-25 mm/s or 0-1 inch/s.</span></span></label>
                            <input type="number" id="trans-range" value="25" step="1">
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Severity</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download PDF Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Analysis Results</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Data & Zone -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Severity Assessment</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Unit</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-clipboard-check"></i> ISO 10816 Zone:</strong>
                            <div id="zone-display" style="margin-top: 10px; font-size: 1.4rem; font-weight: 800;"></div>
                            <div id="zone-desc" style="margin-top: 5px; font-size: 0.95rem; color: var(--text);"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">ISO 10816 Chart Visualization</h4>
                        <div class="chart-container">
                            <canvas id="isoChart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                            <span style="color: #10B981;">■ Zone A</span> &nbsp;
                            <span style="color: #84CC16;">■ Zone B</span> &nbsp;
                            <span style="color: #F59E0B;">■ Zone C</span> &nbsp;
                            <span style="color: #EF4444;">■ Zone D</span> &nbsp;
                            <span style="color: #000; font-weight:bold;">● Your Point</span>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Evaluations based on ISO 10816-3 standards for industrial machines. $V_{rms} = \frac{1}{\sqrt{2}} V_{pk}$ assumed for sinusoidal conversions.
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (MASSIVE) -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: The Bible of Vibration Analysis</h2>
            
            <!-- Insight 1: Acceleration vs Velocity vs Displacement -->
            <div class="insight-card">
                <h4><i class="fas fa-random"></i> 1. The Trinity: Acceleration, Velocity, Displacement</h4>
                <p>Vibration can be measured in three different physical parameters. Choosing the right one depends on the frequency of interest and the type of defect. Understanding the mathematical relationship between these units ($D \rightarrow V \rightarrow A$) via integration and differentiation is fundamental to vibration analysis.</p>
                <ul>
                    <li><strong>Displacement ($\mu m$, mils):</strong> Measures the total distance the shaft moves. It is heavily weighted toward <strong>Low Frequencies</strong> ($< 10$ Hz). It is the standard for monitoring <strong>Sleeve Bearings</strong> (Journal Bearings) using Eddy Current Probes (Proximity Probes), where the critical concern is the shaft physical movement relative to the babbitt lining (oil film clearance). It typically ignores high-frequency bearing noise because a very high frequency vibration often has a microscopic displacement amplitude.</li>
                    <li><strong>Velocity (mm/s, ips):</strong> Measures the speed of the vibration. It is the ISO standard because it represents the <strong>Energy</strong> (Destructive Power) of the vibration. Energy is proportional to velocity squared ($E \propto v^2$). It is relatively flat across the frequency spectrum (10 Hz - 1000 Hz), making it the ideal "General Health" indicator for detecting unbalance, misalignment, and looseness in general rotating machinery.</li>
                    <li><strong>Acceleration ($g$, m/s²):</strong> Measures the force ($F=ma$). It is heavily weighted toward <strong>High Frequencies</strong> ($> 1 kHz$). It is the primary tool for detecting <strong>Rolling Element Bearing</strong> faults and Gear Mesh issues. A tiny pit in a bearing race generates a sharp impact (high force/acceleration) but negligible movement (displacement). Therefore, acceleration is the earliest warning indicator for bearing failure.</li>
                </ul>
                <p><strong>The Mathematical Link:</strong> Physics dictates that these are related by integration/differentiation. If you know the frequency ($\omega = 2\pi f$), you can convert them. Note that as frequency ($f$) increases, Displacement drops rapidly, while Acceleration rises.</p>
                <div class="formula">
                    $$ D = \int V dt \quad , \quad V = \int A dt $$
                    $$ V_{rms} \approx \frac{A_{rms} \cdot 9807}{2\pi f} \text{ (Metric: g to mm/s)} $$
                </div>
            </div>

            <!-- Insight 2: ISO 10816 Explained -->
            <div class="insight-card">
                <h4><i class="fas fa-book"></i> 2. Decoding ISO 10816-3 Standards</h4>
                <p>ISO 10816 is the global standard for evaluating vibration severity on non-rotating parts (bearing housings). It replaces the older ISO 2372. It categorizes severity not just by the vibration number, but by the machine size and foundation stiffness. A vibration of 5 mm/s might be acceptable for a giant fan on flexible springs but catastrophic for a rigid pump.</p>
                
                <p><strong>The 4 Zones:</strong></p>
                <ul>
                    <li><strong style="color:#10B981">Zone A (Green):</strong> Vibration of newly commissioned machines. Ideal state.</li>
                    <li><strong style="color:#84CC16">Zone B (Yellow-Green):</strong> Acceptable for unrestricted long-term operation. Normal aging.</li>
                    <li><strong style="color:#F59E0B">Zone C (Orange):</strong> Unsatisfactory. The machine can operate for a limited time to reach the next maintenance window, but remedial action is required. This is typically the "Alarm" or "Alert" level in a DCS.</li>
                    <li><strong style="color:#EF4444">Zone D (Red):</strong> Unacceptable. Vibration is sufficient to cause structural damage. Immediate trip/shutdown recommended. This is the "Trip" or "Danger" level.</li>
                </ul>

                <p><strong>Rigid vs. Flexible Foundations:</strong> This is a critical distinction often missed. A machine on a massive concrete block (Rigid) has lower vibration tolerance limits because the foundation doesn't move with the machine; high vibration measurements indicate high internal stress on the bearings and housing. A machine on a flexible steel skid (Flexible) is allowed higher vibration numbers because the whole skid moves with the machine, absorbing some of the energy and reducing the internal stress on the bearings. **Always classify your foundation correctly to avoid false alarms.**</p>
            </div>

            <!-- Insight 3: The 4-20mA Loop -->
            <div class="insight-card">
                <h4><i class="fas fa-charging-station"></i> 3. The 4-20mA Transmitter Logic</h4>
                <p>Vibration transmitters (like the IFM VTV122, PCB 603C01, or Hansford HS-420) convert the complex dynamic vibration waveform into a simple DC current proportional to the RMS velocity. This allows a PLC or DCS to monitor health without needing expensive spectrum analyzers or high-speed DAQ cards.</p>
                <p><strong>Scaling Calculation:</strong> The transmitter has a "Full Scale" range (e.g., 25 mm/s). The 4-20mA output maps linearly to this range.</p>
                <div class="formula">$$ I_{out} = 4 \text{ mA} + \left( \frac{\text{Measured Value}}{\text{Full Scale Range}} \right) \times 16 \text{ mA} $$</div>
                <p><strong>Example:</strong> A transmitter range is 0-25 mm/s. The machine is vibrating at 4.5 mm/s.
                <br>Ratio = 4.5 / 25 = 0.18 (18% of scale).
                <br>Current = 4 + (0.18 * 16) = 4 + 2.88 = 6.88 mA.</p>
                <p><strong>Troubleshooting:</strong> 
                <ul>
                    <li>If the DCS reads 4.0 mA but the machine is running, the vibration is very low (Good).</li>
                    <li>If it reads < 3.6 mA, the wire is cut (Open Circuit) or the sensor has failed.</li>
                    <li>If it reads > 21 mA, the sensor is overloaded, the cable is shorted, or the machine is destroying itself.</li>
                </ul>
                </p>
            </div>

            <!-- Insight 4: RMS vs Peak -->
            <div class="insight-card">
                <h4><i class="fas fa-wave-square"></i> 4. RMS vs. Peak vs. Peak-to-Peak</h4>
                <p>Confusion between these units is the #1 cause of alarm errors in vibration monitoring.</p>
                <ul>
                    <li><strong>RMS (Root Mean Square):</strong> Represents the "Area under the curve" or power content. ISO 10816 uses RMS velocity. Most 4-20mA transmitters output RMS. It is a statistical average that correlates well with destructive energy.</li>
                    <li><strong>Peak (0-pk):</strong> The maximum distance from zero to the top of the wave. Often used for Acceleration to catch impulsive impacts (like a hammer blow inside a bearing). For a pure sine wave, $Peak = RMS \times 1.414$. However, for a spiky waveform (like a bad bearing), Peak can be 5x or 10x the RMS value (High Crest Factor).</li>
                    <li><strong>Peak-to-Peak (pk-pk):</strong> The total distance from the bottom trough to the top crest. Standard for Displacement (Orbit analysis) on sleeve bearings. $Pk-Pk = Peak \times 2$.</li>
                </ul>
                <p><strong>Warning:</strong> If your DCS expects RMS but you program the alarm limits using Peak values from a chart, you will alarm too late (under-sensitive). If you use Peak values for RMS limits, you will false alarm constantly (over-sensitive). This calculator handles the conversions automatically for sinusoidal inputs.</p>
            </div>
            
            <!-- Insight 5: Mounting -->
            <div class="insight-card">
                <h4><i class="fas fa-wrench"></i> 5. Sensor Mounting Best Practices</h4>
                <p>The method used to mount the sensor dictates the frequency response range.</p>
                <ul>
                    <li><strong>Stud Mount (Drilled & Tapped):</strong> The gold standard. Direct mechanical transfer allows reading frequencies up to 10-15 kHz. Essential for high-speed gearboxes.</li>
                    <li><strong>Adhesive/Glue Mount:</strong> Good for up to 5-8 kHz if done correctly with a stiff epoxy.</li>
                    <li><strong>Magnet Mount:</strong> Convenient for walk-around routes but acts like a low-pass filter. Typically loses accuracy above 2 kHz. Fine for unbalance (1X), bad for early bearing faults.</li>
                    <li><strong>Hand-Held Probe (Stinger):</strong> The worst method. Severely dampens signal. Only useful for very low frequency (< 500 Hz) measurements.</li>
                </ul>
            </div>
        </div>
    </main>    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li>                        
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li>                        
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State & Charts
        let isoChartInstance = null;
        let lastResult = null;

        // Constants
        const G_TO_MM_S2 = 9806.65; // 1g in mm/s^2
        const PI = Math.PI;
        const SQRT2 = Math.sqrt(2);

        // ISO 10816-3 Limits (Velocity RMS mm/s)
        // [Zone A limit, Zone B limit, Zone C limit] (Zone D is > C limit)
        // Groups: Class 1, 2, 3, 4
        const isoLimits = {
            '1': { 'rigid': [0.71, 1.8, 4.5], 'flexible': [0.71, 1.8, 4.5] }, // Class I simplified
            '2': { 'rigid': [1.4, 2.8, 4.5], 'flexible': [2.3, 4.5, 7.1] },
            '3': { 'rigid': [2.3, 4.5, 7.1], 'flexible': [3.5, 7.1, 11.0] },
            '4': { 'rigid': [2.8, 4.5, 7.1], 'flexible': [4.5, 7.1, 11.0] } // Approx for turbines
        };

        function loadPreset(type) {
            if (type === 'pump') {
                document.getElementById('vib-value').value = '4.2';
                document.getElementById('vib-unit').value = 'vel_rms_mm';
                document.getElementById('machine-class').value = '2';
                document.getElementById('foundation').value = 'rigid';
                document.getElementById('freq').value = '50';
            } else if (type === 'fan') {
                document.getElementById('vib-value').value = '6.5';
                document.getElementById('vib-unit').value = 'vel_rms_mm';
                document.getElementById('machine-class').value = '3';
                document.getElementById('foundation').value = 'flexible';
                document.getElementById('freq').value = '25';
            } else if (type === 'accel') {
                document.getElementById('vib-value').value = '2.5';
                document.getElementById('vib-unit').value = 'acc_pk_g';
                document.getElementById('freq').value = '1000'; // High freq bearing noise
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Theme handling
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function performCalculation() {
            // 1. Inputs
            const val = parseFloat(document.getElementById('vib-value').value);
            const unit = document.getElementById('vib-unit').value;
            const freq = parseFloat(document.getElementById('freq').value);
            const mClass = document.getElementById('machine-class').value;
            const foundation = document.getElementById('foundation').value;
            const range = parseFloat(document.getElementById('trans-range').value);

            if (isNaN(val) || isNaN(freq) || isNaN(range) || freq <= 0 || range <= 0) {
                displayMessage("Please enter valid positive numbers.", "error");
                return;
            }

            // 2. Conversion Logic (Target: Velocity RMS mm/s)
            let vel_rms = 0;
            let steps = [];
            const w = 2 * PI * freq;

            steps.push(`<strong>1. Frequency Angular Velocity:</strong>`);
            steps.push(`$$ \\omega = 2\\pi f = 2\\pi (${freq}) = ${w.toFixed(2)} \\text{ rad/s} $$`);

            if (unit === 'vel_rms_mm') {
                vel_rms = val;
                steps.push(`Input is already Velocity RMS (mm/s). No conversion needed.`);
            } 
            else if (unit === 'vel_pk_mm') {
                vel_rms = val / SQRT2;
                steps.push(`<strong>2. Peak to RMS Conversion (Sine):</strong>`);
                steps.push(`$$ V_{rms} = \\frac{V_{pk}}{\\sqrt{2}} = \\frac{${val}}{\\sqrt{2}} = ${vel_rms.toFixed(3)} \\text{ mm/s} $$`);
            }
            else if (unit === 'vel_rms_ips') {
                vel_rms = val * 25.4;
                steps.push(`<strong>2. Imperial to Metric:</strong>`);
                steps.push(`$$ V_{mm/s} = V_{ips} \\times 25.4 = ${val} \\times 25.4 = ${vel_rms.toFixed(3)} \\text{ mm/s} $$`);
            }
            else if (unit === 'acc_rms_g') {
                // A_rms (g) to V_rms (mm/s)
                // V = A / w.  Need A in mm/s^2.
                // A_mm_s2 = A_g * 9806.65
                const a_metric = val * G_TO_MM_S2;
                vel_rms = a_metric / w;
                steps.push(`<strong>2. Acceleration to Velocity (Integration):</strong>`);
                steps.push(`$$ A_{mm/s^2} = ${val} \\text{ g} \\times 9806.65 = ${a_metric.toFixed(1)} \\text{ mm/s}^2 $$`);
                steps.push(`$$ V_{rms} = \\frac{A_{rms}}{\\omega} = \\frac{${a_metric.toFixed(1)}}{${w.toFixed(2)}} = ${vel_rms.toFixed(3)} \\text{ mm/s} $$`);
            }
            else if (unit === 'acc_pk_g') {
                const acc_rms = val / SQRT2;
                const a_metric = acc_rms * G_TO_MM_S2;
                vel_rms = a_metric / w;
                steps.push(`<strong>2. Acceleration Peak to Velocity RMS:</strong>`);
                steps.push(`$$ A_{rms} = A_{pk} / \\sqrt{2} = ${val} / 1.414 = ${acc_rms.toFixed(3)} \\text{ g} $$`);
                steps.push(`$$ V_{rms} = \\frac{A_{rms} \\times 9806.65}{\\omega} = ${vel_rms.toFixed(3)} \\text{ mm/s} $$`);
            }
            else if (unit === 'disp_pp_um') {
                // D_pp (um) to V_rms (mm/s)
                // D_peak = D_pp / 2
                // D_rms = D_peak / sqrt(2)
                // V_rms = D_rms * w  (Note units: um to mm divide by 1000)
                const d_peak_um = val / 2;
                const d_rms_um = d_peak_um / SQRT2;
                vel_rms = (d_rms_um * w) / 1000;
                steps.push(`<strong>2. Displacement to Velocity (Differentiation):</strong>`);
                steps.push(`$$ D_{rms} = \\frac{D_{p-p}}{2\\sqrt{2}} = \\frac{${val}}{2.828} = ${d_rms_um.toFixed(2)} \\mu m $$`);
                steps.push(`$$ V_{rms} = D_{rms} \\times \\omega \\times 10^{-3} = ${d_rms_um.toFixed(2)} \\times ${w.toFixed(2)} / 1000 = ${vel_rms.toFixed(3)} \\text{ mm/s} $$`);
            }
            else if (unit === 'disp_pp_mil') {
                // Mils to microns then process
                const d_um = val * 25.4;
                const d_rms_um = (d_um / 2) / SQRT2;
                vel_rms = (d_rms_um * w) / 1000;
                steps.push(`<strong>2. Displacement (Imperial) to Velocity:</strong>`);
                steps.push(`$$ D_{\\mu m} = ${val} \\text{ mils} \\times 25.4 = ${d_um.toFixed(1)} \\mu m $$`);
                steps.push(`$$ V_{rms} = \\text{Derived} = ${vel_rms.toFixed(3)} \\text{ mm/s} $$`);
            }

            // 3. Zone Determination
            const limits = isoLimits[mClass][foundation]; // [A_limit, B_limit, C_limit]
            let zone = '';
            let zoneColor = '';
            let zoneDesc = '';

            if (vel_rms < limits[0]) {
                zone = 'A'; zoneColor = 'iso-zone-A'; zoneDesc = 'Good - Newly Commissioned';
            } else if (vel_rms < limits[1]) {
                zone = 'B'; zoneColor = 'iso-zone-B'; zoneDesc = 'Satisfactory - Unrestricted Operation';
            } else if (vel_rms < limits[2]) {
                zone = 'C'; zoneColor = 'iso-zone-C'; zoneDesc = 'Unsatisfactory - Alert / Maintenance Required';
            } else {
                zone = 'D'; zoneColor = 'iso-zone-D'; zoneDesc = 'Unacceptable - Danger / Shutdown';
            }

            steps.push(`<strong>3. ISO 10816 Evaluation (Class ${mClass}, ${foundation}):</strong>`);
            steps.push(`Limits: A < ${limits[0]}, B < ${limits[1]}, C < ${limits[2]}, D > ${limits[2]}`);
            steps.push(`Calculated $V_{rms} = ${vel_rms.toFixed(2)} \\text{ mm/s}$ falls into <strong>Zone ${zone}</strong>.`);

            // 4. 4-20mA Output
            // I = 4 + (Val / Range) * 16
            let ma = 4 + (vel_rms / range) * 16;
            if (ma > 20) ma = 20; // Clamp visually but note over range
            if (ma < 4) ma = 4; // Shouldn't happen with pos values

            steps.push(`<strong>4. Transmitter Output (4-20mA):</strong>`);
            steps.push(`$$ I_{out} = 4 + \\left( \\frac{\\text{Value}}{\\text{Range}} \\right) \\times 16 $$`);
            steps.push(`$$ I_{out} = 4 + \\left( \\frac{${vel_rms.toFixed(2)}}{${range}} \\right) \\times 16 = \\mathbf{${ma.toFixed(2)} \\text{ mA}} $$`);

            // Update UI
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, u, c="") => {
                tbody.innerHTML += `<tr style="${c ? 'color:'+c : ''}"><td><strong>${n}</strong></td><td>${v}</td><td>${u}</td></tr>`;
            };
            addRow('Standard Velocity', vel_rms.toFixed(3), 'mm/s RMS');
            addRow('Transmitter Output', ma.toFixed(2), 'mA', 'var(--primary)');
            addRow('Selected Class', `Class ${mClass}`, foundation);
            
            document.getElementById('zone-display').className = zoneColor;
            document.getElementById('zone-display').innerText = `ZONE ${zone}`;
            document.getElementById('zone-desc').innerText = zoneDesc;

            document.getElementById('calculation-details').innerHTML = steps.map(s => `<div class="calculation-step">${s}</div>`).join('');

            drawChart(vel_rms, limits, zoneColor);

            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });

            lastResult = { vel_rms, ma, zone, mClass, foundation, limits, val, unit, freq };
        }

        function drawChart(val, limits, colorClass) {
            const ctx = document.getElementById('isoChart').getContext('2d');
            if(isoChartInstance) isoChartInstance.destroy();

            // Determine max scale
            const maxVal = Math.max(val * 1.2, limits[2] * 1.5);

            // Map color class to hex
            let pointColor = '#000';
            if(colorClass.includes('A')) pointColor = '#10B981';
            if(colorClass.includes('B')) pointColor = '#84CC16';
            if(colorClass.includes('C')) pointColor = '#F59E0B';
            if(colorClass.includes('D')) pointColor = '#EF4444';

            isoChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Zone A', 'Zone B', 'Zone C', 'Zone D', 'Your Reading'],
                    datasets: [{
                        label: 'Velocity RMS (mm/s)',
                        data: [limits[0], limits[1], limits[2], maxVal, val],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.5)', // A
                            'rgba(132, 204, 22, 0.5)',  // B
                            'rgba(245, 158, 11, 0.5)',  // C
                            'rgba(239, 68, 68, 0.5)',   // D
                            pointColor                  // User
                        ],
                        borderColor: [
                            '#10B981', '#84CC16', '#F59E0B', '#EF4444', pointColor
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Velocity RMS (mm/s)' }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            // Header
            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(217, 119, 6);
            pdf.text('Vibration Severity Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. Measurement Data', 14, y);
            y += 5;

            const inputData = [
                ['Input Value', lastResult.val],
                ['Input Unit', lastResult.unit],
                ['Frequency', `${lastResult.freq} Hz`],
                ['Machine Class', `Class ${lastResult.mClass}`],
                ['Foundation', lastResult.foundation.toUpperCase()]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [217, 119, 6] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. ISO 10816 Evaluation', 14, y);
            y += 5;

            const resData = [
                ['Calculated Velocity', `${lastResult.vel_rms.toFixed(3)} mm/s RMS`],
                ['ISO Zone', `ZONE ${lastResult.zone}`],
                ['Limit Zone A/B', `${lastResult.limits[0]} mm/s`],
                ['Limit Zone C/D', `${lastResult.limits[2]} mm/s`],
                ['4-20mA Output', `${lastResult.ma.toFixed(2)} mA`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [217, 119, 6] },
                didParseCell: function(data) {
                    if(data.row.index === 1) {
                        data.cell.styles.fontStyle = 'bold';
                    }
                }
            });

            // Footer
            y = pdf.lastAutoTable.finalY + 20;
            pdf.setFontSize(8);
            pdf.setTextColor(150);
            pdf.text('Based on ISO 10816-3 standards for industrial machinery.', 105, y, { align: 'center' });

            pdf.save('Vibration_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }
    </script>
</body>
</html>
