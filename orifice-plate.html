<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orifice Plate - Design Calculators - Instrumentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']], // Use \(...\) for inline math
                displayMath: [['\\[', '\\]']], // Use \[...\] for display math
                processEscapes: true // Allow \$ to render as $
            }
        };
    </script>
    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #2196F3;
            --secondary-color: #1976D2;
            --accent-color: #FFC107;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --header-bg: #2C3E50;
            --footer-bg: #34495E;
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            --hover-color: #e2e6ea;
            --primary-color-rgb: 33, 150, 243;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --primary-color: #5DADE2;
            --secondary-color: #2874A6;
            --bg-color: #252D3A;
            --card-bg: #2F3C4C;
            --text-color: #E0E6EB;
            --header-bg: #252D3A;
            --footer-bg: #252D3A;
            --border-color: #4C5C70;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #3A475C;
            --primary-color-rgb: 93, 173, 226;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, var(--bg-color) 0%, rgba(244, 247, 246, 0.8) 100%);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s, background-image 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }

        header h1 {
            margin: 0;
            font-size: 2.8em;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        header .subtitle {
            margin: 8px 0 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }

        main {
            padding: 30px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 2em;
        }

        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1.05em;
        }

        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }

        .tool-description ul li {
            margin-bottom: 8px;
        }

        .tool-description strong {
            color: var(--primary-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 25px;
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            font-weight: bold;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.03);
        }

        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px;
            font-size: 1.3em;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 65px;
            height: 38px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(27px);
        }

        .slider.round {
            border-radius: 38px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.3em;
        }

        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #7f8c8d; }

        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.05em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding:  twelfthpx 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.3);
            outline: none;
        }

        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .form-row .form-group {
            flex: 1 1 calc(50% - 10px);
            min-width: 280px;
        }

        @media (max-width: 600px) {
            .form-row .form-group {
                flex: 1 1 100%;
            }
        }

        .calculate-btn {
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-image 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .calculate-btn:hover {
            background-image: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: block;
            opacity: 0;
            transition: opacity 0.6s ease-out;
            pointer-events: none;
        }

        .result-container.show {
            opacity: 1;
            pointer-events: auto;
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            font-size: 1.1em;
        }

        .result-table tr:last-child td {
            border-bottom: none;
        }

        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            line-height: 1.5;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .info-icon {
            color: var(--primary-color);
            margin-left: 8px;
            cursor: help;
            font-size: 1em;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        #custom-message-box {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            font-size: 1.1em;
        }

        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.98em;
        }

        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px dashed var(--border-color);
        }

        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }

        #calculation-details ul li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Instrumentation</h1>
            <p class="subtitle">Smart Tools for Modern Instrumentation Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>
    <main class="container">
        <a href="indexInst.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Tools
        </a>
        <div class="tool-container">
            <h2>Orifice Plate Calculator</h2>
            <div class="tool-description">
                <p>This calculator determines either the <strong>Differential Pressure (\(\Delta P\))</strong> across an orifice plate or the <strong>Flow Rate (Q)</strong> through a pipeline using an orifice plate. Orifice plates are common flow measurement devices, and understanding their behavior is critical for process control and system design.</p>
                <p>The calculations are based on fundamental fluid dynamics principles, considering the contraction of the fluid stream (vena contracta) and the discharge coefficient of the orifice.</p>
                <ul>
                    <li><strong>Differential Pressure (\(\Delta P\)):</strong> The pressure difference measured across the upstream and downstream taps of the orifice plate.</li>
                    <li><strong>Flow Rate (Q):</strong> The volumetric flow rate of the fluid passing through the orifice.</li>
                    <li><strong>Discharge Coefficient (\(C_d\)):</strong> An empirical value that accounts for the real-world flow complexities compared to ideal theoretical flow.</li>
                    <li><strong>Beta Ratio (\(\beta\)):</strong> The ratio of the orifice bore diameter to the pipe internal diameter.</li>
                </ul>
                <p><strong>Note:</strong> Gas flow calculations are significantly more complex due to compressibility and are highly simplified in this calculator. For precise gas flow measurement, refer to specific standards like ISO 5167-2.</p>
            </div>
            <div class="calculator-form">
                <form id="orifice-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="calculation-type">Calculate: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Choose whether to calculate Differential Pressure or Flow Rate.</span></span></label>
                            <select id="calculation-type" required>
                                <option value="differential_pressure">Differential Pressure (\(\Delta P\))</option>
                                <option value="flow_rate">Flow Rate (Q)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Imperial (e.g., ft³/s, psf) or Metric (e.g., m³/s, Pa) units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (\(\text{m}^3/\text{s}\), \(\text{Pa}\))</option>
                                <option value="imperial">Imperial (\(\text{ft}^3/\text{s}\), \(\text{psf}\))</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fluid-type">Fluid Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the type of fluid. Its density and viscosity will be used. Gas calculations are simplified.</span></span></label>
                            <select id="fluid-type" required>
                                <option value="water">Water</option>
                                <option value="oil">Engine Oil (SAE 30)</option>
                                <option value="gas">Air (Ideal Gas)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fluid-temperature">Fluid Temperature (℃) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the fluid's operating temperature. Affects density and viscosity.</span></span></label>
                            <input type="number" id="fluid-temperature" step="0.1" value="20" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pipe-diameter">Pipe Internal Diameter (D) <span class="pipe-unit-label">(mm)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The internal diameter of the pipe.</span></span></label>
                            <input type="number" id="pipe-diameter" min="1" step="0.1" value="100" required>
                        </div>
                        <div class="form-group">
                            <label for="orifice-diameter">Orifice Bore Diameter (d) <span class="orifice-unit-label">(mm)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The diameter of the opening in the orifice plate. Must be less than pipe diameter.</span></span></label>
                            <input type="number" id="orifice-diameter" min="1" step="0.1" value="50" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" id="flow-rate-group">
                            <label for="flow-rate">Flow Rate (Q) <span class="flow-unit-label-input">(\(\text{m}^3/\text{s}\))</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The volumetric flow rate of the fluid.</span></span></label>
                            <input type="number" id="flow-rate" min="0.000001" step="0.000001" value="0.01" required>
                        </div>
                        <div class="form-group" id="differential-pressure-group" style="display: none;">
                            <label for="differential-pressure">Differential Pressure (\(\Delta P\)) <span class="dp-unit-label">(\(\text{Pa}\))</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The measured pressure drop across the orifice plate.</span></span></label>
                            <input type="number" id="differential-pressure" min="0.1" step="0.1" value="1000" required>
                        </div>
                    </div>
                    <button type="button" id="calculate-orifice-btn" class="calculate-btn">Calculate</button>
                </form>
            </div>
            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
    </main>
    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Instrumentation!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Instrumentation! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="mailto:?subject=Check out Design Calculators - Instrumentation!&body=I found this amazing Orifice Plate Calculator and other design tools: https://designcalculators.co.in" class="social-btn email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-orifice-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const calculationTypeSelect = document.getElementById('calculation-type');
            const unitSystemSelect = document.getElementById('unit-system');
            const fluidTypeSelect = document.getElementById('fluid-type');
            const fluidTemperatureInput = document.getElementById('fluid-temperature');
            const pipeDiameterInput = document.getElementById('pipe-diameter');
            const orificeDiameterInput = document.getElementById('orifice-diameter');
            const flowRateGroup = document.getElementById('flow-rate-group');
            const flowRateInput = document.getElementById('flow-rate');
            const flowUnitLabelInput = document.querySelector('.flow-unit-label-input');
            const differentialPressureGroup = document.getElementById('differential-pressure-group');
            const differentialPressureInput = document.getElementById('differential-pressure');
            const dpUnitLabel = document.querySelector('.dp-unit-label');
            const pipeUnitLabel = document.querySelector('.pipe-unit-label');
            const orificeUnitLabel = document.querySelector('.orifice-unit-label');
            const fluidPropertiesData = {
                'water': {
                    density: { value: 998, unit: 'kg/m^3' },
                    viscosity: [
                        [0, 0.00179], [10, 0.001307], [20, 0.001002], [30, 0.000797],
                        [40, 0.000653], [50, 0.000547], [60, 0.000467], [70, 0.000404],
                        [80, 0.000355], [90, 0.000316], [100, 0.000282]
                    ]
                },
                'oil': {
                    density: { value: 880, unit: 'kg/m^3' },
                    viscosity: [ [20, 0.29] ]
                },
                'gas': {
                    density: { value: 1.204, unit: 'kg/m^3' },
                    viscosity: [
                        [0, 0.0000171], [10, 0.0000176], [20, 0.00001825], [30, 0.0000187],
                        [40, 0.0000193], [50, 0.0000198], [60, 0.0000203], [70, 0.0000208],
                        [80, 0.0000213], [90, 0.0000218], [100, 0.0000223]
                    ]
                }
            };
            function interpolateViscosity(fluidType, temperature) {
                const data = fluidPropertiesData[fluidType].viscosity;
                if (!data) return null;
                if (data.length === 1) {
                    return data[0][1];
                }
                if (temperature <= data[0][0]) {
                    return data[0][1];
                }
                if (temperature >= data[data.length - 1][0]) {
                    return data[data.length - 1][1];
                }
                for (let i = 0; i < data.length - 1; i++) {
                    const temp1 = data[i][0];
                    const visc1 = data[i][1];
                    const temp2 = data[i + 1][0];
                    const visc2 = data[i + 1][1];
                    if (temperature >= temp1 && temperature <= temp2) {
                        return visc1 + (visc2 - visc1) * (temperature - temp1) / (temp2 - temp1);
                    }
                }
                return data[0][1];
            }
            function getFluidDensity(fluidType) {
                return fluidPropertiesData[fluidType].density.value;
            }
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545';
                    messageBox.style.color = 'white';
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745';
                    messageBox.style.color = 'white';
                }
                messageBox.style.opacity = 1;
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }
            function updateUI() {
                const calcType = calculationTypeSelect.value;
                const unitSystem = unitSystemSelect.value;
                if (unitSystem === 'imperial') {
                    pipeUnitLabel.textContent = '(in)';
                    orificeUnitLabel.textContent = '(in)';
                    flowUnitLabelInput.innerHTML = '(\\(\\text{ft}^3/\\text{s}\\))';
                    dpUnitLabel.innerHTML = '(\\(\\text{psf}\\))';
                } else {
                    pipeUnitLabel.textContent = '(mm)';
                    orificeUnitLabel.textContent = '(mm)';
                    flowUnitLabelInput.innerHTML = '(\\(\\text{m}^3/\\text{s}\\))';
                    dpUnitLabel.innerHTML = '(\\(\\text{Pa}\\))';
                }
                if (calcType === 'differential_pressure') {
                    flowRateGroup.style.display = 'block';
                    differentialPressureGroup.style.display = 'none';
                    flowRateInput.setAttribute('required', 'true');
                    differentialPressureInput.removeAttribute('required');
                } else {
                    flowRateGroup.style.display = 'none';
                    differentialPressureGroup.style.display = 'block';
                    flowRateInput.removeAttribute('required');
                    differentialPressureInput.setAttribute('required', 'true');
                }
            }
            calculationTypeSelect.addEventListener('change', updateUI);
            unitSystemSelect.addEventListener('change', updateUI);
            updateUI();
            calculateBtn.addEventListener('click', function() {
                const calcType = calculationTypeSelect.value;
                const unitSystem = unitSystemSelect.value;
                const fluidType = fluidTypeSelect.value;
                const fluidTemperature = parseFloat(fluidTemperatureInput.value);
                let D_raw = parseFloat(pipeDiameterInput.value);
                let d_raw = parseFloat(orificeDiameterInput.value);
                let Q_input;
                let deltaP_input;
                if (calcType === 'differential_pressure') {
                    Q_input = parseFloat(flowRateInput.value);
                } else {
                    deltaP_input = parseFloat(differentialPressureInput.value);
                }
                if (isNaN(fluidTemperature) || isNaN(D_raw) || D_raw <= 0 || isNaN(d_raw) || d_raw <= 0) {
                    displayMessage("Please enter valid positive numbers for Fluid Temperature, Pipe Diameter, and Orifice Diameter.", "error");
                    return;
                }
                if (d_raw >= D_raw) {
                    displayMessage("Orifice Bore Diameter must be less than Pipe Internal Diameter.", "error");
                    return;
                }
                if (calcType === 'differential_pressure' && (isNaN(Q_input) || Q_input <= 0)) {
                    displayMessage("Please enter a valid positive number for Flow Rate.", "error");
                    return;
                }
                if (calcType === 'flow_rate' && (isNaN(deltaP_input) || deltaP_input <= 0)) {
                    displayMessage("Please enter a valid positive number for Differential Pressure.", "error");
                    return;
                }
                let D_m, d_m;
                let Q_mps3;
                let deltaP_Pa;
                let fluidDensity_kgm3 = getFluidDensity(fluidType);
                let fluidViscosity_Pas = interpolateViscosity(fluidType, fluidTemperature);
                if (unitSystem === 'imperial') {
                    D_m = D_raw * 0.0254;
                    d_m = d_raw * 0.0254;
                    if (calcType === 'differential_pressure') {
                        Q_mps3 = Q_input * 0.0283168;
                    } else {
                        deltaP_Pa = deltaP_input * 47.88026;
                    }
                    displayMessage("Imperial units are converted to metric for internal calculations. Results will be converted back.", "info");
                } else {
                    D_m = D_raw / 1000;
                    d_m = d_raw / 1000;
                    if (calcType === 'differential_pressure') {
                        Q_mps3 = Q_input;
                    } else {
                        deltaP_Pa = deltaP_input;
                    }
                }
                const betaRatio = d_m / D_m;
                const orificeArea_m2 = Math.PI * Math.pow(d_m / 2, 2);
                const pipeArea_m2 = Math.PI * Math.pow(D_m / 2, 2);
                const dischargeCoefficient = 0.61;
                let calculatedFlowRate_mps3;
                let calculatedDeltaP_Pa;
                let ReynoldsNumber;
                let pipeVelocity_mps;
                if (calcType === 'differential_pressure') {
                    pipeVelocity_mps = Q_mps3 / pipeArea_m2;
                    ReynoldsNumber = (fluidDensity_kgm3 * pipeVelocity_mps * D_m) / fluidViscosity_Pas;
                } else {
                    ReynoldsNumber = 'Calculated after Flow Rate';
                }
                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>1. Input Parameters and Fluid Properties:</strong></p>`;
                calculationHtml += `<ul>
                    <li>Calculation Type: ${calcType === 'differential_pressure' ? 'Calculate Differential Pressure (\\(\\Delta P\\))' : 'Calculate Flow Rate (Q)'}</li>
                    <li>Unit System: ${unitSystem === 'imperial' ? 'Imperial' : 'Metric'}</li>
                    <li>Fluid Type: ${fluidType.charAt(0).toUpperCase() + fluidType.slice(1)}</li>
                    <li>Fluid Temperature: ${fluidTemperature}℃</li>
                    <li>Pipe Internal Diameter (D): ${D_raw} ${unitSystem === 'imperial' ? 'in' : 'mm'} = ${D_m.toFixed(4)} m</li>
                    <li>Orifice Bore Diameter (d): ${d_raw} ${unitSystem === 'imperial' ? 'in' : 'mm'} = ${d_m.toFixed(4)} m</li>
                    <li>Fluid Density (\\(\\rho\\)): ${fluidDensity_kgm3.toFixed(2)} kg/m\\(^3\\)</li>
                    <li>Fluid Viscosity (\\(\\mu\\)): ${fluidViscosity_Pas.toExponential(3)} Pa\\cdot s</li>
                    <li>Beta Ratio (\\(\\beta = d/D\\)): ${betaRatio.toFixed(3)}</li>
                    <li>Orifice Area (A\\(_o\\)): ${orificeArea_m2.toExponential(4)} m\\(^2\\)</li>
                    <li>Pipe Area (A\\(_p\\)): ${pipeArea_m2.toExponential(4)} m\\(^2\\)</li>
                    <li>Assumed Discharge Coefficient (C\\(_d\\)): ${dischargeCoefficient.toFixed(3)} <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Note: For precise C\\(_d\\), complex empirical correlations based on ISO 5167 are required. This is a common approximation.</span></span></li>
                </ul>`;
                const epsilon = 1 - Math.pow(betaRatio, 4);
                if (calcType === 'differential_pressure') {
                    calculatedDeltaP_Pa = (fluidDensity_kgm3 * Math.pow(Q_mps3, 2) * epsilon) / (2 * Math.pow(dischargeCoefficient, 2) * Math.pow(orificeArea_m2, 2));
                    calculationHtml += `<p><strong>2. Calculate Differential Pressure (\\(\\Delta P\\)):</strong></p>`;
                    calculationHtml += `<p>The differential pressure is calculated using the orifice plate flow equation rearranged to solve for \\(\\Delta P\\).</p>`;
                    calculationHtml += `<p class="formula">\\[\\Delta P = \\frac{\\rho Q^2 (1 - \\beta^4)}{2 C_d^2 A_o^2}\\]</p>`;
                    calculationHtml += `<p class="calculation-step">
                        \\(\\Delta P\\) = (${fluidDensity_kgm3.toFixed(2)} \\times ${Q_mps3.toExponential(4)}^2 \\times ${epsilon.toFixed(3)}) \\div (2 \\times ${dischargeCoefficient.toFixed(3)}^2 \\times ${orificeArea_m2.toExponential(4)}^2) = ${calculatedDeltaP_Pa.toFixed(2)} \\text{ Pa}
                    </p>`;
                    calculationHtml += `<p><strong>3. Calculate Reynolds Number:</strong></p>`;
                    calculationHtml += `<p>The Reynolds number is calculated based on the fluid properties and flow conditions in the pipe.</p>`;
                    calculationHtml += `<p class="formula">\\[Re = \\frac{\\rho V D}{\\mu} = \\frac{4 \\rho Q}{\\pi D \\mu}\\]</p>`;
                    calculationHtml += `<p class="calculation-step">
                        Re = (4 \\times ${fluidDensity_kgm3.toFixed(2)} \\times ${Q_mps3.toExponential(4)}) \\div (\\pi \\times ${D_m.toFixed(4)} \\times ${fluidViscosity_Pas.toExponential(3)}) = ${ReynoldsNumber.toExponential(4)}
                    </p>`;
                } else {
                    calculatedFlowRate_mps3 = dischargeCoefficient * orificeArea_m2 * Math.sqrt((2 * deltaP_Pa) / (fluidDensity_kgm3 * epsilon));
                    calculationHtml += `<p><strong>2. Calculate Flow Rate (Q):</strong></p>`;
                    calculationHtml += `<p>The volumetric flow rate is calculated using the standard orifice plate flow equation.</p>`;
                    calculationHtml += `<p class="formula">\\[Q = C_d A_o \\sqrt{\\frac{2 \\Delta P}{\\rho (1 - \\beta^4)}}\\]</p>`;
                    calculationHtml += `<p class="calculation-step">
                        Q = ${dischargeCoefficient.toFixed(3)} \\times ${orificeArea_m2.toExponential(4)} \\times \\sqrt{\\frac{2 \\cdot ${deltaP_Pa.toFixed(2)} \\text{ Pa}}{${fluidDensity_kgm3.toFixed(2)} \\text{ kg/m}^3 \\cdot ${epsilon.toFixed(3)}}} = ${calculatedFlowRate_mps3.toExponential(4)} \\text{ m}^3/\\text{s}
                    </p>`;
                    pipeVelocity_mps = calculatedFlowRate_mps3 / pipeArea_m2;
                    ReynoldsNumber = (fluidDensity_kgm3 * pipeVelocity_mps * D_m) / fluidViscosity_Pas;
                    calculationHtml += `<p><strong>3. Calculate Reynolds Number:</strong></p>`;
                    calculationHtml += `<p>The Reynolds number is calculated based on the fluid properties and calculated flow conditions in the pipe.</p>`;
                    calculationHtml += `<p class="formula">\\[Re = \\frac{\\rho V D}{\\mu} = \\frac{4 \\rho Q}{\\pi D \\mu}\\]</p>`;
                    calculationHtml += `<p class="calculation-step">
                        Re = (4 \\times ${fluidDensity_kgm3.toFixed(2)} \\times ${calculatedFlowRate_mps3.toExponential(4)}) \\div (\\pi \\times ${D_m.toFixed(4)} \\times ${fluidViscosity_Pas.toExponential(3)}) = ${ReynoldsNumber.toExponential(4)}
                    </p>`;
                }
                calculationDetailsDiv.innerHTML = calculationHtml;
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv]);
                }
                resultTableBody.innerHTML = '';
                function addResultRow(parameterHtml, valueHtml) {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.innerHTML = parameterHtml;
                    valueCell.innerHTML = valueHtml;
                }
                addResultRow("Calculation Type", calcType === 'differential_pressure' ? 'Calculate Differential Pressure (\\(\\Delta P\\))' : 'Calculate Flow Rate (Q)');
                addResultRow("Unit System", unitSystem === 'imperial' ? 'Imperial' : 'Metric');
                addResultRow("Fluid Type", fluidType.charAt(0).toUpperCase() + fluidType.slice(1));
                addResultRow("Fluid Temperature", `${fluidTemperature}°C`);
                addResultRow("Fluid Density (\\(\\rho\\))", `${fluidDensity_kgm3.toFixed(3)} kg/m\\(^3\\)`);
                addResultRow("Fluid Viscosity (\\(\\mu\\))", `${fluidViscosity_Pas.toExponential(3)} Pa\\cdot s`);
                addResultRow("Pipe Internal Diameter (D)", `${D_raw} ${unitSystem === 'imperial' ? 'in' : 'mm'}`);
                addResultRow("Orifice Bore Diameter (d)", `${d_raw} ${unitSystem === 'imperial' ? 'in' : 'mm'}`);
                addResultRow("Beta Ratio (\\(\\beta\\))", `${betaRatio.toFixed(3)}`);
                addResultRow("Discharge Coefficient (C\\(_d\\))", `${dischargeCoefficient.toFixed(3)}`);
                addResultRow("Reynolds Number (Re)", `${ReynoldsNumber.toExponential(2)}`);
                if (calcType === 'differential_pressure') {
                    let Q_display = Q_input;
                    let deltaP_display = calculatedDeltaP_Pa;
                    let dp_unit = '\\(\\text{Pa}\\)';
                    if (unitSystem === 'imperial') {
                        Q_display = Q_input.toFixed(4);
                        deltaP_display = (calculatedDeltaP_Pa / 47.88026).toFixed(2);
                        dp_unit = '\\(\\text{psf}\\)';
                    } else {
                        Q_display = Q_input.toExponential(4);
                        deltaP_display = calculatedDeltaP_Pa.toFixed(2);
                    }
                    addResultRow(`Input Flow Rate (Q)`, `${Q_display} ${flowUnitLabelInput.textContent.replace(/\\\(.*?\\\)/g, '').replace(/[()]/g, '')}`);
                    addResultRow(`Calculated Differential Pressure (\\(\\Delta P\\))`, `<strong>${deltaP_display} ${dp_unit}</strong>`);
                } else {
                    let Q_display = calculatedFlowRate_mps3;
                    let deltaP_display = deltaP_input;
                    let flow_unit = '\\(\\text{m}^3/\\text{s}\\)';
                    if (unitSystem === 'imperial') {
                        Q_display = (calculatedFlowRate_mps3 / 0.0283168).toFixed(4);
                        deltaP_display = deltaP_input.toFixed(2);
                        flow_unit = '\\(\\text{ft}^3/\\text{s}\\)';
                    } else {
                        Q_display = calculatedFlowRate_mps3.toExponential(4);
                        deltaP_display = deltaP_input.toFixed(2);
                    }
                    addResultRow(`Input Differential Pressure (\\(\\Delta P\\))`, `${deltaP_display} ${dpUnitLabel.textContent.replace(/\\\(.*?\\\)/g, '').replace(/[()]/g, '')}`);
                    addResultRow(`Calculated Flow Rate (Q)`, `<strong>${Q_display} ${flow_unit}</strong>`);
                }
                if (window.MathJax) {
                    window.MathJax.typesetPromise([resultTableBody, flowUnitLabelInput, dpUnitLabel]);
                }
                standardReference.innerHTML = "Orifice plate flow calculations often refer to international standards such as <strong>ISO 5167-1 'Measurement of fluid flow by means of pressure differential devices inserted in circular cross-section conduits running full - Part 1: General principles and requirements'</strong> and specifically <strong>ISO 5167-2 'Orifice plates'</strong> for detailed discharge coefficient correlations and installation requirements. This calculator provides a simplified approach; for critical applications, full adherence to these standards is essential for accuracy.";
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth' });
                displayMessage("Calculation completed successfully!", "info");
            });
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>