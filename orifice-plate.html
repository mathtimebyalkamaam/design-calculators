<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orifice Plate Flow Calculator - Design Calculators - Instrumentation</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional calculator for orifice plate flow rate (volumetric and mass) for liquids and gases. Supports Metric/Imperial units and follows ISO 5167 principles.">
    <meta name="keywords" content="orifice plate calculator, flow rate calculator, differential pressure, ISO 5167, mass flow, volumetric flow, instrumentation, process control">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    
    <!-- AdSense & Analytics (from new header) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts & Icons (from new header) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for Formulas (from new header) -->
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['\\(', '\\)'], ['$', '$']],
            displayMath: [['\\[', '\\]'], ['$$', '$$']]
        },
        svg: { fontCache: 'global' },
        options: {
            processHtmlClass: 'math-content', // Process elements with this class
            ignoreHtmlClass: 'no-mathjax' // Ignore elements with this class
        }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- PDF Generation (Not used by this tool but included in header) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Favicon (from new header) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- New Styles from file.txt -->
    <style>
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        /* Applied to the tool container */
        .tool-container {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .tool-description {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.05rem;
        }
        h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .calculator-form {
            background-color: var(--card); /* Re-using card style */
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .form-section {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        .form-section h3 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn-group .btn {
            flex: 1;
            min-width: 150px;
        }
        .btn.secondary {
            background: var(--secondary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .btn.accent {
            background: var(--accent);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        .btn.accent:hover {
             box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }


        /* CALCULATION STEPS DISPLAY */
        .steps-container {
            display: none;
            margin-top: 30px;
        }
        .steps-container.active {
            display: block;
        }
        .step-card {
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px; /* Spacing between cards */
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
        }
        .step-card .number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        .step-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: start;
        }
        @media (max-width: 768px) {
            .step-content {
                grid-template-columns: 1fr;
            }
        }
        .step-content .formula-block {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid var(--border);
        }
        .step-content .formula-block p {
            margin-top: 0;
        }
        .step-content .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .step-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
            line-height: 1.2;
        }
        .step-unit {
            font-size: 1rem;
            color: var(--text);
            opacity: 0.8;
            font-weight: 500;
            margin-left: 5px;
        }
        .step-explanation {
            font-size: 1.05rem;
            line-height: 1.8;
        }
        /* Specific class for calculation steps */
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--bg);
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 8px;
            color: var(--text);
            white-space: pre-wrap;
            word-break: break-word;
            border: 1px solid var(--border);
        }


        /* Results */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th,
        .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) {
            background-color: var(--bg);
        }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .results-table .highlight {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--success);
        }
        .results-table .warning {
            font-weight: 700;
            color: var(--warning);
        }
        .results-table .error {
            font-weight: 700;
            color: var(--danger);
        }

        /* Educational Section */
        .education-section {
            margin-top: 60px;
        }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i {
            font-size: 1.5rem;
        }
        .insight-card p {
            margin: 10px 0;
            line-height: 1.8;
        }
        .insight-card ol,
        .insight-card ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .insight-card li {
            margin-bottom: 10px;
        }
        .stat-highlight {
            display: inline-block;
            background: var(--accent);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin: 0 4px;
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 {
            color: var(--danger);
            margin-top: 0;
        }
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h4 {
            color: var(--success);
            margin-top: 0;
        }


        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .btn-group { flex-direction: column; }
        }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 5px;
            cursor: help;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px; /* Adjusted width */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px; /* Half of width */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-family: 'Inter', sans-serif; /* Professional font */
            font-size: 0.85rem; /* Slightly smaller font size */
            line-height: 1.4; /* Better readability */
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Specific styles for Orifice Flow */
        .unit-system-selector, .fluid-type-selector {
            margin-bottom: 20px;
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
        }
        .unit-system-selector label, .fluid-type-selector label {
            font-weight: bold;
            color: var(--heading);
            display: flex;
            align-items: center;
            cursor: pointer;
        }
         .fluid-type-selector input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        /* Conditional display for fluid properties */
        #liquid-properties, #gas-properties {
            display: none; /* Hidden by default */
            margin-top: 15px;
            border-top: 1px dashed var(--border);
            padding-top: 15px;
        }
        #liquid-properties.active, #gas-properties.active {
            display: block;
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Message box for notifications -->
    <div id="message-box" class="message-box"></div>

    <!-- New Header from file.txt -->
    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">      
        <div class="tool-container">
            <h2><i class="fas fa-tachometer-alt"></i> Orifice Plate Flow Calculator</h2>
                        
            <div class="tool-description">
                <p>This professional tool calculates the flow rate of a fluid through an orifice plate based on differential pressure and fluid properties. It is designed for engineers worldwide, supporting both Metric and Imperial units, and is essential for accurate flow measurement and system design in various industrial applications. Calculations are based on the principles of ISO 5167.</p>
            </div>
                    
            <div class="calculator-form">
                <form id="orifice-flow-form">
                    <!-- Unit System Selection -->
                    <div class="form-section unit-system-selector">
                        <label for="unit-system">Unit System:</label>
                        <select id="unit-system" required>
                            <option value="metric">Metric (mm, Pa, kg/m³)</option>
                            <option value="imperial">Imperial (in, psi, lb/ft³)</option>
                        </select>
                        <label for="output-flow-type">Output Flow Type:</label>
                        <select id="output-flow-type" required>
                            <option value="volumetric">Volumetric Flow Rate</option>
                            <option value="mass">Mass Flow Rate</option>
                        </select>
                        <label for="output-flow-unit">Output Flow Unit:</label>
                        <select id="output-flow-unit" required>
                            <!-- Options will be dynamically populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Fluid Type Selection -->
                    <div class="form-section">
                        <h3><i class="fas fa-water"></i> Fluid Type and Properties</h3>
                        <div class="fluid-type-selector">
                            <label>
                                <input type="radio" name="fluid-type" value="liquid" checked> Liquid
                            </label>
                            <label>
                                <input type="radio" name="fluid-type" value="gas"> Gas
                            </label>
                        </div>
                    </div>

                    <!-- Input Parameters -->
                    <div class="form-section">
                        <h3><i class="fas fa-drafting-compass"></i> Primary Flow Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="orifice-diameter" id="label-orifice-diameter">Orifice Bore Diameter (d) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-orifice-diameter">The diameter of the hole in the orifice plate.</span></span></label>
                                <input type="number" id="orifice-diameter" step="0.001" value="50.0" required>
                            </div>
                            <div class="form-group">
                                <label for="pipe-diameter" id="label-pipe-diameter">Pipe Inside Diameter (D) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-pipe-diameter">The inside diameter of the pipe where the orifice plate is installed.</span></span></label>
                                <input type="number" id="pipe-diameter" step="0.001" value="100.0" required>
                            </div>
                            <div class="form-group">
                                <label for="differential-pressure" id="label-differential-pressure">Differential Pressure (ΔP) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-differential-pressure">The pressure difference measured across the orifice plate.</span></span></label>
                                <input type="number" id="differential-pressure" step="0.01" value="1000.0" required>
                            </div>
                            <div class="form-group">
                                <label for="discharge-coefficient" id="label-discharge-coefficient">Discharge Coefficient (C<sub>d</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-discharge-coefficient">A dimensionless coefficient accounting for energy losses. Typically 0.60-0.62. For precise values, use the Reader-Harris/Gallagher equation (ISO 5167) or manufacturer data.</span></span></label>
                                <input type="number" id="discharge-coefficient" step="0.001" value="0.61" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Liquid Specific Properties -->
                    <div id="liquid-properties" class="form-section active">
                         <h3><i class="fas fa-tint"></i> Liquid Properties</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="liquid-density" id="label-liquid-density">Liquid Density (ρ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-liquid-density">The density of the liquid at operating conditions.</span></span></label>
                                <input type="number" id="liquid-density" step="0.01" value="1000.0" required>
                            </div>
                            <div class="form-group">
                                <label for="liquid-viscosity" id="label-liquid-viscosity">Liquid Viscosity (μ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-liquid-viscosity">Dynamic viscosity of the liquid at operating conditions. Used for Reynolds number calculation.</span></span></label>
                                <input type="number" id="liquid-viscosity" step="0.000001" value="0.001" required>
                            </div>
                        </div>
                    </div>

                    <!-- Gas Specific Properties -->
                    <div id="gas-properties" class="form-section">
                        <h3><i class="fas fa-wind"></i> Gas Properties</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="molecular-weight" id="label-molecular-weight">Molecular Weight (MW) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-molecular-weight">The molecular weight of the gas. E.g., Air ≈ 28.97 g/mol. Used to calculate gas density.</span></span></label>
                                <input type="number" id="molecular-weight" step="0.01" value="28.97" required>
                            </div>
                            <div class="form-group">
                                <label for="operating-temperature" id="label-operating-temperature">Operating Temperature (T) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-operating-temperature">The absolute temperature of the gas at operating conditions. Used to calculate gas density.</span></span></label>
                                <input type="number" id="operating-temperature" step="0.1" value="25.0" required>
                            </div>
                            <div class="form-group">
                                <label for="absolute-pressure" id="label-absolute-pressure">Absolute Upstream Pressure (P<sub>1</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-absolute-pressure">The absolute pressure of the gas upstream of the orifice. Used to calculate gas density and expansion factor.</span></span></label>
                                <input type="number" id="absolute-pressure" step="0.1" value="101325.0" required>
                            </div>
                            <div class="form-group">
                                <label for="specific-heat-ratio" id="label-specific-heat-ratio">Specific Heat Ratio (k) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-specific-heat-ratio">Ratio of specific heats (Cp/Cv) for the gas. E.g., Air ≈ 1.4. Used for expansion factor calculation.</span></span></label>
                                <input type="number" id="specific-heat-ratio" step="0.01" value="1.4" required>
                            </div>
                            <div class="form-group">
                                <label for="gas-viscosity" id="label-gas-viscosity">Gas Viscosity (μ) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-gas-viscosity">Dynamic viscosity of the gas at operating conditions. Used for Reynolds number calculation.</span></span></label>
                                <input type="number" id="gas-viscosity" step="1e-7" value="0.000018" required>
                            </div>
                        </div>
                    </div>

                    <div class="btn-group" style="margin-top: 25px;">
                        <button type="button" id="calculate-flow-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Flow</button>
                        <button type="button" id="reset-form-btn" class="btn accent"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- NEW Step-by-Step Results Container -->
        <div id="steps-container" class="steps-container math-content">
            <!-- Step cards will be dynamically inserted here -->
        </div>

        <!-- Updated Results Section -->
        <div id="results-section" class="card hidden">
            <h3><i class="fas fa-clipboard-check"></i> Calculation Summary</h3>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    <!-- Results will be dynamically inserted here -->
                </tbody>
            </table>

            <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                <button type="button" id="clear-results-btn" class="btn accent"><i class="fas fa-times-circle"></i> Clear Results</button>
            </div>

            <div class="insight-card" id="standard-reference-info" style="margin-top: 30px;">
                 <h4><i class="fas fa-book"></i> International Standards Compliance</h4>
                 <p>This calculator is based on the fundamental principles of flow measurement using orifice plates, which are standardized globally to ensure accuracy and interchangeability. It incorporates key parameters and calculations as defined by leading international standards, primarily <strong>ISO 5167: Measurement of fluid flow by means of pressure differential devices inserted in circular cross-section conduits running full.</strong></p>
                 <p>While this tool provides a robust calculation, precise flow measurement in industrial applications requires careful adherence to the installation requirements, fluid property characterization, and calibration procedures detailed in these standards. Always consult the full standard documents for critical engineering design and verification.</p>
            </div>
        </div>

        <!-- NEW 800-word Educational Section -->
        <div id="education-section" class="education-section card math-content">
            <h2><i class="fas fa-book-open"></i> Engineer's Guide to Orifice Plate Flow Measurement</h2>

            <div class="tool-description">
                <p>The orifice plate is one of the most common and well-understood devices for measuring fluid flow in a pipe. Despite the advent of more modern technologies, its simplicity, low cost, and robust nature make it a staple in industrial process control. This guide delves into the principles, components, standards, and practical considerations of orifice plate flow measurement.</p>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-wind"></i> Fundamental Principle: The Bernoulli Effect</h4>
                <p>The operation of an orifice plate is a direct application of <strong>Bernoulli's Principle</strong>, which states that for a flowing fluid, an increase in velocity occurs simultaneously with a decrease in pressure.</p>
                <ol>
                    <li><strong>Restriction:</strong> An orifice plate is essentially a thin metal plate with a precisely machined hole (the "orifice") inserted between two flanges in a pipe. This plate creates a partial obstruction to the flow.</li>
                    <li><strong>Acceleration:</strong> To pass through the smaller opening, the fluid must accelerate. This point of maximum constriction and highest velocity is known as the "vena contracta," which occurs slightly downstream of the plate itself.</li>
                    <li><strong>Pressure Drop:</strong> According to Bernoulli's principle, this increase in velocity results in a significant drop in pressure. The fluid's potential energy (pressure) is converted into kinetic energy (velocity).</li>
                    <li><strong>Measurement:</strong> By measuring the difference between the high pressure upstream (P₁) and the low pressure at the vena contracta (P₂), we get the "differential pressure" ($\Delta P$). This $\Delta P$ is directly proportional to the square of the flow rate.</li>
                </ol>
                <p class="formula">$$Q \propto \sqrt{\Delta P}$$</p>
                <p>This relationship is the foundation of all orifice plate calculations. After passing the vena contracta, the fluid begins to slow down and expand, recovering some (but not all) of its pressure. The unrecovered portion is known as the "permanent pressure loss," which represents an energy cost in the system.</p>
            </div>

            <div class="success-box">
                <h4><i class="fas fa-check-circle"></i> The Orifice Flow Equation (Based on ISO 5167)</h4>
                <p>The practical equation for calculating mass flow rate ($Q_m$) is more complex, accounting for fluid properties and the physical geometry of the installation:</p>
                <p class="formula">$$Q_m = \frac{C_d}{\sqrt{1 - \beta^4}} \cdot Y \cdot \frac{\pi}{4} d^2 \cdot \sqrt{2 \cdot \rho_1 \cdot \Delta P}$$</p>
                <p>Let's break down each critical term:</p>
                <ul>
                    <li><strong>$C_d$ (Discharge Coefficient):</strong> This is a dimensionless factor that corrects the "ideal" theoretical flow to the "actual" flow. It accounts for all the real-world energy losses (friction, turbulence) that the simple theory ignores. $C_d$ is *not* a constant; it depends on the Reynolds number, the beta ratio, and the tap locations. The international standard ISO 5167 provides the complex <strong>Reader-Harris/Gallagher equation</strong> for its precise calculation. For general purposes, it's often in the 0.60 to 0.62 range.</li>
                    <li><strong>$\beta$ (Beta Ratio):</strong> The ratio of the orifice bore diameter (d) to the internal pipe diameter (D), $\beta = d/D$. This is a critical design parameter. A small beta (e.g., 0.2) gives high accuracy but also a very high $\Delta P$ and permanent pressure loss. A large beta (e.g., 0.7) has low pressure loss but is more sensitive to installation effects and has lower accuracy. Most designs fall between $\beta = 0.2$ and $\beta = 0.75$.</li>
                    <li><strong>$\frac{1}{\sqrt{1 - \beta^4}}$ (Velocity of Approach Factor):</strong> This term corrects for the fact that the upstream fluid is already moving (it has an "approach velocity"), unlike fluid in a large tank. As $\beta$ gets larger, this factor becomes more significant.</li>
                    <li><strong>$Y$ (Expansion Factor):</strong> This is <strong>ONLY for compressible fluids (gases)</strong>. When a gas passes through the orifice, its pressure drops, causing it to expand and its density to change. The Expansion Factor (or "Expansibility Factor") $Y$ corrects for this change in density between the upstream tap and the vena contracta. For liquids (which are incompressible), $Y = 1.0$.</li>
                    <li><strong>$d$ (Orifice Bore Diameter):</strong> The diameter of the hole, measured at operating temperature.</li>
                    <li><strong>$\rho_1$ (Upstream Density):</strong> The density of the fluid at the upstream pressure and temperature.</li>
                    <li><strong>$\Delta P$ (Differential Pressure):</strong> The measured pressure drop ($P_1 - P_2$).</li>
                </ul>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-ruler-combined"></i> Key Components & Types</h4>
                <p>While the concept is simple, the hardware is standardized for accuracy.</p>
                <ul>
                    <li><strong>Orifice Plate Types:</strong>
                        <ul>
                            <li><strong>Concentric:</strong> The most common type. The bore is concentric with the pipe. Used for clean liquids and gases.</li>
                            <li><strong>Eccentric:</strong> The bore is offset to the bottom of the pipe. This allows solids or entrained liquids (in gas flow) to pass through, preventing buildup.</li>
                            <li><strong>Segmental:</strong> The bore is a D-shaped segment at the bottom (for liquids with solids) or top (for gases with liquids) of the pipe. Used for slurries or dirty fluids.</li>
                        </ul>
                    </li>
                    <li><strong>Pressure Tappings:</strong> The location where the $\Delta P$ is measured is critical.
                        <ul>
                            <li><strong>Flange Taps:</strong> The most common in North America. The tappings are drilled 25.4 mm (1 inch) upstream and downstream from the plate faces.</li>
                            <li><strong>Corner Taps:</strong> Tappings are drilled directly into the corner where the plate meets the pipe wall. Common in Europe and for smaller pipe sizes.</li>
                            <li><strong>D and D/2 Taps:</strong> The "classic" tapping points. Upstream tap is at 1 pipe diameter (D) and the downstream tap is at 0.5 pipe diameters (D/2), placing it near the vena contracta.</li>
                        </ul>
                    </li>
                    <li><strong>The Sharp Edge:</strong> The single most critical part of the plate is the upstream edge of the bore. It must be perfectly sharp, square, and free of nicks or rounding. Any damage or wear to this edge will change the $C_d$ and destroy the measurement accuracy.</li>
                </ul>
            </div>

            <div class="danger-box">
                <h4><i class="fas fa-exclamation-triangle"></i> Critical Installation Requirements</h4>
                <p>An orifice plate is a "dumb" device; its accuracy is entirely dependent on a "well-behaved" and fully developed flow profile. Any swirls, vortices, or asymmetry in the flow will ruin the measurement. This is why installation is <strong>the most important factor</strong> for orifice plate accuracy.</p>
                <ul>
                    <li><strong>Long Straight Pipe Runs:</strong> This is the golden rule. The standards (ISO 5167, API 14.3) demand long sections of straight, clear pipe upstream and downstream of the plate.
                        <ul>
                            <li><strong>Upstream:</strong> Needs to be very long to allow flow to recover from disturbances like bends, valves, or reducers. A single 90° bend can require <strong>10 to 20 pipe diameters (D)</strong> of straight run. Two bends in different planes (a "swirl" generator) might require <strong>over 40D</strong>.</li>
                            <li><strong>Downstream:</strong> Needs to be long enough to not interfere with the pressure recovery. Typically <strong>5 to 7 pipe diameters (D)</strong> is sufficient.</li>
                        </ul>
                    </li>
                    <li><strong>Flow Conditioners:</strong> When the required straight runs are impossible to achieve, a flow conditioner (a bundle of tubes or a special perforated plate) can be installed upstream (e.g., 2D before the orifice plate) to "fix" the flow profile. This significantly reduces the straight-run requirement but adds cost and pressure loss.</li>
                    <li><strong>Plate Orientation:</strong> The plate must be installed with the sharp edge facing *upstream* (against the flow). The beveled edge, if present, faces downstream. Installing it backward will result in massive errors.</li>
                </ul>
            </div>

            <div class="insight-card">
                <h4><i class="fas fa-balance-scale"></i> Advantages vs. Disadvantages</h4>
                <p><strong>Advantages:</strong></p>
                <ul>
                    <li><strong>Low Cost:</strong> Simple to manufacture, making it very economical.</li>
                    <li><strong>Robust & Simple:</strong> No moving parts, making it reliable and resistant to harsh process conditions (high temp/pressure).</li>
                    <li><strong>Well-Understood:</strong> The principles and standards are mature and universally accepted.</li>
                    <li><strong>Versatile:</strong> Can be used for liquids, gases, and steam.</li>
                </ul>
                <p><strong>Disadvantages:</strong></s>
                <ul>
                    <li><strong>High Permanent Pressure Loss:</strong> The turbulence created causes significant, non-recoverable pressure loss (up to 50-80% of $\Delta P$), which wastes energy (pump/compressor power). This is its biggest drawback.</li>
                    <li><strong>Limited Rangeability (Turndown):</strong> Because $Q \propto \sqrt{\Delta P}$, the usable range is limited. A 10:1 change in flow (100% to 10%) results in a 100:1 change in $\Delta P$ (100% to 1%). Most $\Delta P$ transmitters struggle to be accurate over such a wide range. A typical "safe" turndown for an orifice plate is often cited as <strong>3:1 or 4:1</strong>.</li>
                    <li><strong>Wear and Tear:</strong> The critical sharp edge can be eroded by abrasive fluids or damaged by debris, leading to a drift in accuracy over time.</li>
                    <li><strong>Installation Sensitive:</strong> As noted, its accuracy is highly dependent on long, straight upstream pipe runs, which can be difficult to accommodate in real-world plants.</li>
                </ul>
            </div>
        </div>

    </main>

    <!-- New Footer from file.txt -->
        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Updated JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Form Elements ---
            const unitSystemSelect = document.getElementById('unit-system');
            const outputFlowTypeSelect = document.getElementById('output-flow-type');
            const outputFlowUnitSelect = document.getElementById('output-flow-unit');
            const orificeDiameterInput = document.getElementById('orifice-diameter');
            const pipeDiameterInput = document.getElementById('pipe-diameter');
            const differentialPressureInput = document.getElementById('differential-pressure');
            const dischargeCoefficientInput = document.getElementById('discharge-coefficient');

            const fluidTypeRadios = document.querySelectorAll('input[name="fluid-type"]');
            const liquidPropertiesDiv = document.getElementById('liquid-properties');
            const gasPropertiesDiv = document.getElementById('gas-properties');

            const liquidDensityInput = document.getElementById('liquid-density');
            const liquidViscosityInput = document.getElementById('liquid-viscosity');
            const molecularWeightInput = document.getElementById('molecular-weight');
            const operatingTemperatureInput = document.getElementById('operating-temperature');
            const absolutePressureInput = document.getElementById('absolute-pressure');
            const specificHeatRatioInput = document.getElementById('specific-heat-ratio');
            const gasViscosityInput = document.getElementById('gas-viscosity');

            // --- Label Elements (for tooltips) ---
            const labelOrificeDiameter = document.getElementById('label-orifice-diameter');
            const labelPipeDiameter = document.getElementById('label-pipe-diameter');
            const labelDifferentialPressure = document.getElementById('label-differential-pressure');
            const labelLiquidDensity = document.getElementById('label-liquid-density');
            const labelLiquidViscosity = document.getElementById('label-liquid-viscosity');
            const labelMolecularWeight = document.getElementById('label-molecular-weight');
            const labelOperatingTemperature = document.getElementById('label-operating-temperature');
            const labelAbsolutePressure = document.getElementById('label-absolute-pressure');
            const labelSpecificHeatRatio = document.getElementById('label-specific-heat-ratio');
            const labelGasViscosity = document.getElementById('label-gas-viscosity');
            
            const tooltipOrificeDiameter = document.getElementById('tooltip-orifice-diameter');
            const tooltipPipeDiameter = document.getElementById('tooltip-pipe-diameter');
            const tooltipDifferentialPressure = document.getElementById('tooltip-differential-pressure');
            const tooltipLiquidDensity = document.getElementById('tooltip-liquid-density');
            const tooltipLiquidViscosity = document.getElementById('tooltip-liquid-viscosity');
            const tooltipMolecularWeight = document.getElementById('tooltip-molecular-weight');
            const tooltipOperatingTemperature = document.getElementById('tooltip-operating-temperature');
            const tooltipAbsolutePressure = document.getElementById('tooltip-absolute-pressure');
            const tooltipSpecificHeatRatio = document.getElementById('tooltip-specific-heat-ratio');
            const tooltipGasViscosity = document.getElementById('tooltip-gas-viscosity');


            // --- Button & Result Elements ---
            const calculateFlowBtn = document.getElementById('calculate-flow-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            
            const resultsSection = document.getElementById('results-section'); // Replaced resultContainer
            const stepsContainer = document.getElementById('steps-container'); // New steps container
            const resultTableBody = document.getElementById('result-table-body');
            const standardReferenceInfo = document.getElementById('standard-reference-info');
            const messageBox = document.getElementById('message-box'); // New message box

            // --- Constants ---
            const UNIVERSAL_GAS_CONSTANT_SI = 8.314462618; // J/(mol·K) or Pa·m³/(mol·K)
            const ABSOLUTE_ZERO_CELSIUS = 273.15; // K
            
            // Default values for resetting form (Metric)
            const defaultValues = {
                'unit-system': 'metric',
                'output-flow-type': 'volumetric',
                'orifice-diameter': 50.0, // mm
                'pipe-diameter': 100.0, // mm
                'differential-pressure': 1000.0, // Pa
                'discharge-coefficient': 0.61,
                'fluid-type': 'liquid',
                'liquid-density': 1000.0, // kg/m³
                'liquid-viscosity': 0.001, // Pa·s (water at 20°C)
                'molecular-weight': 28.97, // g/mol (air)
                'operating-temperature': 25.0, // °C
                'absolute-pressure': 101325.0, // Pa (1 atm)
                'specific-heat-ratio': 1.4, // for air
                'gas-viscosity': 0.000018 // Pa·s (air at 20°C)
            };
            
            // Unit configurations
            const unitsConfig = {
                'metric': {
                    diameter: { label: 'mm', tooltip: 'millimeters' },
                    pressure: { label: 'Pa', tooltip: 'Pascals', toSI: 1 },
                    temperature: { label: '°C', tooltip: 'Celsius', toKelvin: (T) => T + ABSOLUTE_ZERO_CELSIUS },
                    density: { label: 'kg/m³', tooltip: 'kilograms per cubic meter', toSI: 1 },
                    viscosity: { label: 'Pa·s', tooltip: 'Pascal-seconds', toSI: 1 },
                    molecularWeight: { label: 'g/mol', tooltip: 'grams per mole', toSI: 1 / 1000 }, // g/mol to kg/mol
                    flowOutputs: {
                        volumetric: [
                            { value: 'm3s', label: 'm³/s' },
                            { value: 'Ls', label: 'L/s' },
                            { value: 'm3hr', label: 'm³/hr' }
                        ],
                        mass: [
                            { value: 'kgs', label: 'kg/s' },
                            { value: 'kgmin', label: 'kg/min' },
                            { value: 'kghr', label: 'kg/hr' }
                        ]
                    },
                    conversions: {
                        orificeDiameter: 1 / 1000, // mm to m
                        pipeDiameter: 1 / 1000, // mm to m
                    }
                },
                'imperial': {
                    diameter: { label: 'in', tooltip: 'inches' },
                    pressure: { label: 'psi', tooltip: 'pounds per square inch', toSI: 6894.76 },
                    temperature: { label: '°F', tooltip: 'Fahrenheit', toKelvin: (T) => (T - 32) * 5/9 + ABSOLUTE_ZERO_CELSIUS },
                    density: { label: 'lb/ft³', tooltip: 'pounds per cubic foot', toSI: 16.0185 },
                    viscosity: { label: 'lb/(ft·s)', tooltip: 'pounds per foot-second', toSI: 1.48816 }, // lb/(ft·s) to Pa·s
                    molecularWeight: { label: 'lb/lbmol', tooltip: 'pounds per pound-mole', toSI: 1 / 1000 }, // lb/lbmol to kg/mol (approx, as 1 lbmol = 1 g/mol numerically)
                    flowOutputs: {
                        volumetric: [
                            { value: 'ft3s', label: 'ft³/s' },
                            { value: 'gpm', label: 'GPM (US)' },
                            { value: 'bpd', label: 'BPD (US)' }
                        ],
                        mass: [
                            { value: 'lbs', label: 'lb/s' },
                            { value: 'lbmin', label: 'lb/min' },
                            { value: 'lbhr', label: 'lb/hr' }
                        ]
                    },
                    conversions: {
                        orificeDiameter: 0.0254, // inches to meters
                        pipeDiameter: 0.0254, // inches to meters
                    }
                }
            };

            // Conversion factors for output units from m³/s (SI base volumetric flow) or kg/s (SI base mass flow)
            const outputConversions = {
                'm3s': { factor: 1, type: 'volumetric' },
                'Ls': { factor: 1000, type: 'volumetric' }, // m³/s to L/s
                'm3hr': { factor: 3600, type: 'volumetric' }, // m³/s to m³/hr
                'ft3s': { factor: 35.3147, type: 'volumetric' }, // m³/s to ft³/s
                'gpm': { factor: 15850.3, type: 'volumetric' }, // m³/s to US GPM
                'bpd': { factor: 5434.36, type: 'volumetric' }, // m³/s to US BPD (1 barrel = 42 US gallons)
                'kgs': { factor: 1, type: 'mass' },
                'kgmin': { factor: 60, type: 'mass' }, // kg/s to kg/min
                'kghr': { factor: 3600, type: 'mass' }, // kg/s to kg/hr
                'lbs': { factor: 2.20462, type: 'mass' }, // kg/s to lb/s
                'lbmin': { factor: 132.277, type: 'mass' }, // kg/s to lb/min
                'lbhr': { factor: 7936.64, type: 'mass' } // kg/s to lb/hr
            };

            // Helper function to add rows to the result table
            function addResultRow(parameter, value, statusClass = '') {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
                if (statusClass) {
                    valueCell.classList.add(statusClass);
                }
            }
            
            // --- New showMessage function ---
            function showMessage(msg, type = 'success') {
                messageBox.textContent = msg;
                if (type === 'error') {
                    messageBox.style.backgroundColor = 'var(--danger)';
                    messageBox.style.color = 'white';
                } else if (type === 'warning') {
                    messageBox.style.backgroundColor = 'var(--warning)';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                    messageBox.style.color = 'white';
                }
                messageBox.classList.add('show');
                setTimeout(() => messageBox.classList.remove('show'), 4000);
            }

            // --- Event Listeners ---
            unitSystemSelect.addEventListener('change', updateUnitLabelsAndTooltips);
            unitSystemSelect.addEventListener('change', populateOutputFlowUnits);
            outputFlowTypeSelect.addEventListener('change', populateOutputFlowUnits);
            fluidTypeRadios.forEach(radio => radio.addEventListener('change', updateFluidPropertiesVisibility));
            calculateFlowBtn.addEventListener('click', calculateFlow);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            // --- Initial setup ---
            populateOutputFlowUnits(); // Populate units based on initial system and flow type
            updateUnitLabelsAndTooltips(); // Update labels based on initial system
            updateFluidPropertiesVisibility(); // Show/hide fluid properties based on initial fluid type
                        
            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            function populateOutputFlowUnits() {
                const selectedSystem = unitSystemSelect.value;
                const selectedFlowType = outputFlowTypeSelect.value;
                const flowOutputs = unitsConfig[selectedSystem].flowOutputs[selectedFlowType];
                outputFlowUnitSelect.innerHTML = ''; // Clear existing options

                flowOutputs.forEach(unit => {
                    const option = document.createElement('option');
                    option.value = unit.value;
                    option.textContent = unit.label;
                    outputFlowUnitSelect.appendChild(option);
                });
            }

            function updateUnitLabelsAndTooltips() {
                const selectedSystem = unitSystemSelect.value;
                const config = unitsConfig[selectedSystem];
                const fluidType = document.querySelector('input[name="fluid-type"]:checked').value;

                tooltipOrificeDiameter.textContent = `The diameter of the hole in the orifice plate. Unit: ${config.diameter.tooltip}.`;
                tooltipPipeDiameter.textContent = `The inside diameter of the pipe where the orifice plate is installed. Unit: ${config.diameter.tooltip}.`;
                tooltipDifferentialPressure.textContent = `The pressure difference measured across the orifice plate. Unit: ${config.pressure.tooltip}.`;
                
                if (fluidType === 'liquid') {
                    tooltipLiquidDensity.textContent = `The density of the liquid at operating conditions. Unit: ${config.density.tooltip}.`;
                    tooltipLiquidViscosity.textContent = `Dynamic viscosity of the liquid at operating conditions. Used for Reynolds number calculation. Unit: ${config.viscosity.tooltip}.`;
                } else { // gas
                    tooltipMolecularWeight.textContent = `The molecular weight of the gas. E.g., Air ≈ 28.97. Used to calculate gas density. Unit: ${config.molecularWeight.tooltip}.`;
                    tooltipOperatingTemperature.textContent = `The absolute temperature of the gas at operating conditions. Used to calculate gas density. Unit: ${config.temperature.tooltip}.`;
                    tooltipAbsolutePressure.textContent = `The absolute pressure of the gas upstream of the orifice. Used to calculate gas density and expansion factor. Unit: ${config.pressure.tooltip}.`;
                    tooltipSpecificHeatRatio.textContent = `Ratio of specific heats (Cp/Cv) for the gas. E.g., Air ≈ 1.4. Used for expansion factor calculation. (Dimensionless)`;
                    tooltipGasViscosity.textContent = `Dynamic viscosity of the gas at operating conditions. Used for Reynolds number calculation. Unit: ${config.viscosity.tooltip}.`;
                }

                // Update input placeholders (optional, but good for UX)
                orificeDiameterInput.placeholder = `e.g., 50 ${config.diameter.label}`;
                pipeDiameterInput.placeholder = `e.g., 100 ${config.diameter.label}`;
                differentialPressureInput.placeholder = `e.g., 1000 ${config.pressure.label}`;
                liquidDensityInput.placeholder = `e.g., 1000 ${config.density.label}`;
                liquidViscosityInput.placeholder = `e.g., 0.001 ${config.viscosity.label}`;
                molecularWeightInput.placeholder = `e.g., 28.97 ${config.molecularWeight.label}`;
                operatingTemperatureInput.placeholder = `e.g., 25 ${config.temperature.label}`;
                absolutePressureInput.placeholder = `e.g., 101325 ${config.pressure.label}`;
                specificHeatRatioInput.placeholder = `e.g., 1.4`;
                gasViscosityInput.placeholder = `e.g., 0.000018 ${config.viscosity.label}`;
            }

            function updateFluidPropertiesVisibility() {
                const selectedFluidType = document.querySelector('input[name="fluid-type"]:checked').value;
                if (selectedFluidType === 'liquid') {
                    liquidPropertiesDiv.classList.add('active');
                    gasPropertiesDiv.classList.remove('active');
                    // Set required attributes for liquid inputs
                    liquidDensityInput.setAttribute('required', 'required');
                    liquidViscosityInput.setAttribute('required', 'required');
                    molecularWeightInput.removeAttribute('required');
                    operatingTemperatureInput.removeAttribute('required');
                    absolutePressureInput.removeAttribute('required');
                    specificHeatRatioInput.removeAttribute('required');
                    gasViscosityInput.removeAttribute('required');
                } else { // gas
                    liquidPropertiesDiv.classList.remove('active');
                    gasPropertiesDiv.classList.add('active');
                    // Set required attributes for gas inputs
                    liquidDensityInput.removeAttribute('required');
                    liquidViscosityInput.removeAttribute('required');
                    molecularWeightInput.setAttribute('required', 'required');
                    operatingTemperatureInput.setAttribute('required', 'required');
                    absolutePressureInput.setAttribute('required', 'required');
                    specificHeatRatioInput.setAttribute('required', 'required');
                    gasViscosityInput.setAttribute('required', 'required');
                }
                updateUnitLabelsAndTooltips(); // Update labels after visibility change
                clearResults(); // Clear results when fluid type changes
            }

            function clearResults() {
                resultsSection.classList.add('hidden');
                stepsContainer.innerHTML = ''; // Clear steps
                stepsContainer.classList.remove('active'); // Hide steps
                resultTableBody.innerHTML = '';
                showMessage("Results cleared.", "success");
            }

            function resetForm() {
                unitSystemSelect.value = defaultValues['unit-system'];
                outputFlowTypeSelect.value = defaultValues['output-flow-type'];
                                
                // Reset fluid type radio and trigger its change event
                document.querySelector(`input[name="fluid-type"][value="${defaultValues['fluid-type']}"]`).checked = true;
                
                orificeDiameterInput.value = defaultValues['orifice-diameter'];
                pipeDiameterInput.value = defaultValues['pipe-diameter'];
                differentialPressureInput.value = defaultValues['differential-pressure'];
                dischargeCoefficientInput.value = defaultValues['discharge-coefficient'];
                liquidDensityInput.value = defaultValues['liquid-density'];
                liquidViscosityInput.value = defaultValues['liquid-viscosity'];
                molecularWeightInput.value = defaultValues['molecular-weight'];
                operatingTemperatureInput.value = defaultValues['operating-temperature'];
                absolutePressureInput.value = defaultValues['absolute-pressure'];
                specificHeatRatioInput.value = defaultValues['specific-heat-ratio'];
                gasViscosityInput.value = defaultValues['gas-viscosity'];
                
                // Manually trigger updates that depend on the reset values
                updateFluidPropertiesVisibility(); 
                populateOutputFlowUnits(); // This needs to be called after resetting the dropdowns
                
                clearResults(); // Clear results again after inputs are reset
                showMessage("Form reset to default values (Metric, Liquid).", "success");
            }

            function calculateFlow() {
                clearResults(); // Clear previous results
                const selectedSystem = unitSystemSelect.value;
                const selectedFlowType = outputFlowTypeSelect.value;
                const outputFlowUnit = outputFlowUnitSelect.value;
                const config = unitsConfig[selectedSystem];

                let d_input = parseFloat(orificeDiameterInput.value);
                let D_input = parseFloat(pipeDiameterInput.value);
                let dP_input = parseFloat(differentialPressureInput.value);
                let Cd = parseFloat(dischargeCoefficientInput.value);
                                
                let rho_si; // Density in kg/m³
                let mu_si;  // Viscosity in Pa·s
                let Y = 1;  // Expansion Factor (default 1 for liquids)
                let T_kelvin, P1_si, MW_si; // Gas-specific SI values

                const fluidType = document.querySelector('input[name="fluid-type"]:checked').value;

                // Input Validation
                if (isNaN(d_input) || isNaN(D_input) || isNaN(dP_input) || isNaN(Cd)) {
                    showMessage("Please enter valid numerical values for all primary flow parameters.", "error");
                    return;
                }
                if (d_input <= 0 || D_input <= 0) {
                    showMessage("Diameters must be positive values.", "error");
                    return;
                }
                if (d_input >= D_input) {
                    showMessage("Orifice bore diameter (d) must be less than pipe inside diameter (D).", "error");
                    return;
                }
                if (dP_input < 0) {
                    showMessage("Differential pressure (ΔP) cannot be negative.", "error");
                    return;
                }
                if (Cd <= 0 || Cd > 1) {
                    showMessage("Discharge Coefficient (C_d) should be a positive value, typically between 0.6 and 0.8.", "warning");
                    // Continue calculation with warning
                }

                // --- Start Building Step-by-Step HTML ---
                let stepsHtml = '';

                // --- Step 1: Convert Inputs to SI Units ---
                const d_si = d_input * config.conversions.orificeDiameter; // to meters
                const D_si = D_input * config.conversions.pipeDiameter;     // to meters
                const dP_si = dP_input * config.pressure.toSI;        // to Pascals

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">1</span>Input Parameter SI Conversion</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>All calculations are performed in SI units (meters, Pascals, kilograms, etc.) for consistency. Your inputs are converted first.</p>
                            <p class="calculation-step">Orifice Diameter (d) = ${d_input} ${config.diameter.label} = ${d_si.toFixed(4)} m</p>
                            <p class="calculation-step">Pipe Diameter (D) = ${D_input} ${config.diameter.label} = ${D_si.toFixed(4)} m</p>
                            <p class="calculation-step">Differential Pressure (ΔP) = ${dP_input} ${config.pressure.label} = ${dP_si.toFixed(2)} Pa</p>
                            <p class="calculation-step">Discharge Coefficient (C<sub>d</sub>) = ${Cd.toFixed(3)}</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Conversions Used:</strong></p>
                            <p>1 ${config.diameter.label} = ${config.conversions.pipeDiameter} m</p>
                            <p>1 ${config.pressure.label} = ${config.pressure.toSI} Pa</p>
                        </div>
                    </div>
                </div>`;

                // --- Step 2: Fluid Properties ---
                if (fluidType === 'liquid') {
                    let liquidDensity = parseFloat(liquidDensityInput.value);
                    let liquidViscosity = parseFloat(liquidViscosityInput.value);

                    if (isNaN(liquidDensity) || liquidDensity <= 0) {
                        showMessage("Please enter a valid positive Liquid Density.", "error");
                        return;
                    }
                    if (isNaN(liquidViscosity) || liquidViscosity <= 0) {
                        showMessage("Please enter a valid positive Liquid Viscosity.", "error");
                        return;
                    }

                    rho_si = liquidDensity * config.density.toSI;
                    mu_si = liquidViscosity * config.viscosity.toSI;

                    stepsHtml += `<div class="step-card">
                        <h4><span class="number">2</span>Liquid Properties (SI)</h4>
                        <div class="step-content">
                            <div class="step-explanation">
                                <p>Liquid properties are converted to SI units. The Expansion Factor (Y) is 1.0 for incompressible liquids.</p>
                                <p class="calculation-step">Liquid Density (ρ) = ${liquidDensity} ${config.density.label} = ${rho_si.toFixed(3)} kg/m³</p>
                                <p class="calculation-step">Liquid Viscosity (μ) = ${liquidViscosity} ${config.viscosity.label} = ${mu_si.toExponential(3)} Pa·s</p>
                                <p class="calculation-step">Expansion Factor (Y) = 1.0 (for liquid)</p>
                            </div>
                            <div class="formula-block">
                                <p><strong>Conversions Used:</strong></p>
                                <p>1 ${config.density.label} = ${config.density.toSI.toFixed(4)} kg/m³</p>
                                <p>1 ${config.viscosity.label} = ${config.viscosity.toSI.toFixed(4)} Pa·s</p>
                            </div>
                        </div>
                    </div>`;

                } else { // gas
                    let molecularWeight = parseFloat(molecularWeightInput.value);
                    let operatingTemperature = parseFloat(operatingTemperatureInput.value);
                    let absolutePressure = parseFloat(absolutePressureInput.value);
                    let specificHeatRatio = parseFloat(specificHeatRatioInput.value);
                    let gasViscosity = parseFloat(gasViscosityInput.value);

                    if (isNaN(molecularWeight) || molecularWeight <= 0) { showMessage("Please enter a valid positive Molecular Weight.", "error"); return; }
                    if (isNaN(operatingTemperature)) { showMessage("Please enter a valid Operating Temperature.", "error"); return; }
                    if (isNaN(absolutePressure) || absolutePressure <= 0) { showMessage("Please enter a valid positive Absolute Upstream Pressure.", "error"); return; }
                    if (isNaN(specificHeatRatio) || specificHeatRatio <= 0) { showMessage("Please enter a valid positive Specific Heat Ratio.", "error"); return; }
                    if (isNaN(gasViscosity) || gasViscosity <= 0) { showMessage("Please enter a valid positive Gas Viscosity.", "error"); return; }

                    // Convert gas inputs to SI
                    T_kelvin = config.temperature.toKelvin(operatingTemperature); // to Kelvin
                    P1_si = absolutePressure * config.pressure.toSI; // to Pascals
                    MW_si = molecularWeight * config.molecularWeight.toSI; // to kg/mol
                    mu_si = gasViscosity * config.viscosity.toSI;

                    // Calculate gas density using Ideal Gas Law (PV=nRT -> P*MW = rho*R*T)
                    rho_si = (P1_si * MW_si) / (UNIVERSAL_GAS_CONSTANT_SI * T_kelvin);
                    
                    stepsHtml += `<div class="step-card">
                        <h4><span class="number">2</span>Gas Properties (SI)</h4>
                        <div class="step-content">
                            <div class="step-explanation">
                                <p>Gas density is calculated at upstream conditions (P₁, T) using the Ideal Gas Law.</p>
                                <p class="calculation-step">Temperature (T) = ${operatingTemperature} ${config.temperature.label} = ${T_kelvin.toFixed(2)} K</p>
                                <p class="calculation-step">Upstream Pressure (P₁) = ${absolutePressure} ${config.pressure.label} = ${P1_si.toFixed(2)} Pa</p>
                                <p class="calculation-step">Molecular Weight (MW) = ${molecularWeight} ${config.molecularWeight.label} = ${MW_si.toFixed(4)} kg/mol</p>
                                <p class="calculation-step">Gas Viscosity (μ) = ${gasViscosity} ${config.viscosity.label} = ${mu_si.toExponential(3)} Pa·s</p>
                                <p class="calculation-step">Specific Heat Ratio (k) = ${specificHeatRatio.toFixed(2)}</p>
                            </div>
                            <div class="formula-block">
                                <p><strong>Gas Density Formula:</strong></p>
                                <p class="formula">$$ \rho_1 = \frac{P_1 \cdot MW}{R \cdot T} $$</p>
                                <p class="formula">$$ \rho_1 = \frac{${P1_si.toFixed(2)} \cdot ${MW_si.toFixed(4)}}{${UNIVERSAL_GAS_CONSTANT_SI.toFixed(2)} \cdot ${T_kelvin.toFixed(2)}} $$</p>
                                <p><strong>Calculated Density (ρ₁):</strong></p>
                                <div class="step-value" style="font-size: 1.5rem;">${rho_si.toFixed(3)}<span class="step-unit">kg/m³</span></div>
                            </div>
                        </div>
                    </div>`;
                }

                // --- Step 3: Geometric Ratios & Area ---
                const Ao = Math.PI / 4 * d_si * d_si; // Orifice Area (m²)
                const beta = d_si / D_si;             // Beta ratio (dimensionless)
                const beta4 = Math.pow(beta, 4); // Beta ratio to the power of 4
                const velocityApproachFactor = 1 / Math.sqrt(1 - beta4);

                if (1 - beta4 <= 0) { // Safeguard
                    showMessage("Invalid pipe and orifice diameter ratio (Beta ratio >= 1). Check your inputs.", "error");
                    return;
                }
                
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">3</span>Geometric Ratios & Area</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>Key geometric values are calculated from the pipe and orifice diameters.</p>
                            <p class="calculation-step">Orifice Area (A<sub>o</sub>) = ${Ao.toExponential(4)} m²</p>
                            <p class="calculation-step">Beta Ratio (β) = ${beta.toFixed(4)}</p>
                            <p class="calculation-step">Velocity of Approach Factor = ${velocityApproachFactor.toFixed(4)}</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formulas:</strong></p>
                            <p class="formula">$$ A_o = \frac{\pi}{4} \cdot d^2 $$</p>
                            <p class="formula">$$ \beta = \frac{d}{D} $$</p>
                            <p class="formula">$$ Factor = \frac{1}{\sqrt{1 - \beta^4}} $$</p>
                        </div>
                    </div>
                </div>`;

                // --- Step 4: Expansion Factor (Gas Only) ---
                if (fluidType === 'gas') {
                    const pressure_ratio_x = dP_si / P1_si; // x = ΔP / P₁
                    if (pressure_ratio_x >= 0.75) {
                         showMessage("Flow may be choked. Pressure ratio (ΔP / P₁) is very high. Results may be inaccurate.", "warning");
                    }
                    // ISO 5167-2:2003 formula
                    Y = 1 - (0.351 + 0.256 * Math.pow(beta, 4) + 0.93 * Math.pow(beta, 8)) * (1 - Math.pow(pressure_ratio_x / specificHeatRatio, 0.35));
                    
                    if (Y < 0.667) {
                         showMessage("Calculated Expansion Factor (Y) is very low, indicating high compressibility effects or potential choked flow. Check inputs.", "warning");
                         Y = Math.max(Y, 0.667); // Clamp at a reasonable minimum
                    }

                    stepsHtml += `<div class="step-card">
                        <h4><span class="number">4</span>Gas Expansion Factor (Y)</h4>
                        <div class="step-content">
                            <div class="step-explanation">
                                <p>For gases, the Expansion Factor $Y$ corrects for the density change as the gas expands through the orifice. This calculation is based on ISO 5167.</p>
                                <p class="calculation-step">Pressure Ratio (x = ΔP/P₁) = ${dP_si.toFixed(2)} / ${P1_si.toFixed(2)} = ${pressure_ratio_x.toFixed(4)}</p>
                                <p class="calculation-step">Specific Heat Ratio (k) = ${specificHeatRatio.toFixed(2)}</p>
                                <p class="calculation-step">Beta Ratio (β) = ${beta.toFixed(4)}</p>
                            </div>
                            <div class="formula-block">
                                <p><strong>Formula (ISO 5167-2):</strong></p>
                                <p class="formula" style="font-size: 0.8rem">$$ Y = 1 - (0.351 + 0.256\beta^4 + 0.93\beta^8) \cdot (1 - (\frac{x}{k})^{0.35}) $$</p>
                                <p><strong>Calculated Expansion Factor (Y):</strong></p>
                                <div class="step-value" style="font-size: 1.5rem;">${Y.toFixed(4)}</div>
                            </div>
                        </div>
                    </div>`;
                }

                // --- Step 5: Core Flow Calculation ---
                const volumetricFlowRate_m3s = Cd * Y * Ao * velocityApproachFactor * Math.sqrt((2 * dP_si) / (rho_si));
                const massFlowRate_kgs = volumetricFlowRate_m3s * rho_si;

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">5</span>Core Flow Rate Calculation (SI)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>The core flow equation combines all the calculated factors to find the flow rate in base SI units (m³/s and kg/s).</p>
                            <p class="calculation-step">Volumetric Flow (Q<sub>v</sub>) = ${Cd.toFixed(3)} * ${velocityApproachFactor.toFixed(4)} * ${Y.toFixed(4)} * ${Ao.toExponential(4)} * sqrt( (2 * ${dP_si.toFixed(2)}) / ${rho_si.toFixed(3)} )</p>
                            <p class="calculation-step">Mass Flow (Q<sub>m</sub>) = ${volumetricFlowRate_m3s.toExponential(4)} m³/s * ${rho_si.toFixed(3)} kg/m³</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formulas:</strong></p>
                            <p class="formula">$$ Q_v = C_d \cdot Y \cdot A_o \cdot \frac{1}{\sqrt{1 - \beta^4}} \cdot \sqrt{\frac{2 \cdot \Delta P}{\rho_1}} $$</p>
                            <p class="formula">$$ Q_m = Q_v \cdot \rho_1 $$</p>
                            <p><strong>SI Volumetric Flow (Q<sub>v</sub>):</strong></p>
                            <div class="step-value" style="font-size: 1.5rem;">${volumetricFlowRate_m3s.toExponential(4)}<span class="step-unit">m³/s</span></div>
                            <p><strong>SI Mass Flow (Q<sub>m</sub>):</strong></p>
                            <div class="step-value" style="font-size: 1.5rem;">${massFlowRate_kgs.toExponential(4)}<span class="step-unit">kg/s</span></div>
                        </div>
                    </div>
                </div>`;
                
                // --- Step 6: Reynolds Number ---
                let Re;
                if (mu_si > 0) {
                    Re = (4 * massFlowRate_kgs) / (Math.PI * D_si * mu_si);
                } else {
                    Re = 0;
                    showMessage("Viscosity is zero, Reynolds number cannot be calculated.", "warning");
                }
                
                stepsHtml += `<div class="step-card">
                    <h4><span class="number">6</span>Reynolds Number (Re)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>The Reynolds Number (Re) characterizes the flow regime (laminar or turbulent). It is calculated based on the pipe diameter. This value is critical, as the Discharge Coefficient ($C_d$) is highly dependent on it.</p>
                            <p><strong>Note:</strong> This calculation uses a *fixed* $C_d$. In a more complex calculation (per ISO 5167), $C_d$ and $Re$ would be solved iteratively.</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Formula:</strong></p>
                            <p class="formula">$$ Re = \frac{4 \cdot Q_m}{\pi \cdot D \cdot \mu} $$</p>
                            <p class="formula">$$ Re = \frac{4 \cdot ${massFlowRate_kgs.toExponential(4)}}{3.14159 \cdot ${D_si.toFixed(4)} \cdot ${mu_si.toExponential(3)}} $$</p>
                            <p><strong>Calculated Reynolds Number:</strong></p>
                            <div class="step-value" style="font-size: 1.5rem;">${Re.toExponential(3)}</div>
                        </div>
                    </div>
                </div>`;


                // --- Step 7: Final Output Conversion ---
                let finalFlowRate;
                let finalFlowUnitLabel;
                let finalFlowTypeLabel;

                if (selectedFlowType === 'volumetric') {
                    finalFlowRate = volumetricFlowRate_m3s * outputConversions[outputFlowUnit].factor;
                    finalFlowUnitLabel = outputFlowUnitSelect.options[outputFlowUnitSelect.selectedIndex].text;
                    finalFlowTypeLabel = "Volumetric";
                } else { // mass
                    finalFlowRate = massFlowRate_kgs * outputConversions[outputFlowUnit].factor;
                    finalFlowUnitLabel = outputFlowUnitSelect.options[outputFlowUnitSelect.selectedIndex].text;
                    finalFlowTypeLabel = "Mass";
                }

                stepsHtml += `<div class="step-card">
                    <h4><span class="number">7</span>Final ${finalFlowTypeLabel} Flow Rate</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>The calculated SI flow rate is converted to your selected output unit (${finalFlowUnitLabel}).</p>
                            <p class="calculation-step">Flow (${finalFlowUnitLabel}) = ${selectedFlowType === 'volumetric' ? volumetricFlowRate_m3s.toExponential(4) : massFlowRate_kgs.toExponential(4)} ${selectedFlowType === 'volumetric' ? 'm³/s' : 'kg/s'} * ${outputConversions[outputFlowUnit].factor.toExponential(2)}</p>
                        </div>
                        <div class="formula-block">
                            <p><strong>Final ${finalFlowTypeLabel} Flow Rate:</strong></p>
                            <div class="step-value">${finalFlowRate.toFixed(3)}<span class="step-unit">${finalFlowUnitLabel}</span></div>
                        </div>
                    </div>
                </div>`;

                // --- Display Results ---
                stepsContainer.innerHTML = stepsHtml;
                stepsContainer.classList.add('active');
                
                // --- Populate Summary Table ---
                resultTableBody.innerHTML = '';
                addResultRow(`<strong>Final ${finalFlowTypeLabel} Flow Rate</strong>`, `<strong>${finalFlowRate.toFixed(3)} ${finalFlowUnitLabel}</strong>`, "highlight");
                addResultRow("Reynolds Number (Re)", `${Re.toExponential(3)}`);
                addResultRow("Beta Ratio (β)", `${beta.toFixed(4)}`);
                if (fluidType === 'gas') {
                    addResultRow("Expansion Factor (Y)", `${Y.toFixed(4)}`);
                    addResultRow("Calculated Gas Density (ρ₁)", `${rho_si.toFixed(3)} kg/m³`);
                } else {
                    addResultRow("Liquid Density (ρ)", `${rho_si.toFixed(3)} kg/m³`);
                }
                addResultRow("SI Volumetric Flow (Q<sub>v</sub>)", `${volumetricFlowRate_m3s.toExponential(4)} m³/s`);
                addResultRow("SI Mass Flow (Q<sub>m</sub>)", `${massFlowRate_kgs.toExponential(4)} kg/s`);
                
                resultsSection.classList.remove('hidden');
                
                // Typeset MathJax
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    setTimeout(() => {
                        window.MathJax.typesetPromise([stepsContainer, document.getElementById('education-section')]);
                    }, 50); 
                }

                setTimeout(() => {
                    stepsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }

            // --- Theme switch logic (from new file) ---
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                // Check local storage on load
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                // Add listener for changes
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>
