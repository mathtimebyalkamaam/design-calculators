<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Valve Noise Prediction (IEC 60534-8) - Design Calculators - Instrumentation</title>
    <link rel="canonical" href="https://designcalculators.co.in/controlvalvenoise.html" />
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional IEC 60534-8 Control Valve Aerodynamic and Hydrodynamic Noise Prediction Calculator. Features Fluid Library, Insulation attenuation, distance correction, and detailed calculation steps.">
    <meta name="keywords" content="control valve noise, iec 60534-8, aerodynamic noise, hydrodynamic noise, cavitation, valve sizing, instrumentation calculator, spl prediction, dba calculation, insulation attenuation">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    <style>
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute; content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }
        
        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4); }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn-group .btn { flex: 1; min-width: 150px; }
        .btn.secondary { background: var(--secondary); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }
        .btn.accent { background: var(--accent); box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3); }

        /* CALCULATION STEPS DISPLAY */
        .steps-container { display: none; margin-top: 30px; }
        .steps-container.active { display: block; }
        .step-card {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box; /* v6 */
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: block; /* Changed from flex */
        }
        .step-card h4::after {
            content: "";
            display: table;
            clear: both;
        }
        .step-card .number {
            float: left; /* Changed to float */
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            /* Removed flex-shrink */
        }
        .step-content {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box; /* v6 */
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            align-items: start;
        }
        .step-content .formula-block {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid var(--border);
        }
        .step-content .formula-block p { margin-top: 0; }
        .step-content .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        /* Results */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th { background: var(--grad); color: white; font-weight: 700; }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child { font-weight: 600; color: var(--heading); }
        .results-table .highlight { font-weight: 700; font-size: 1.1rem; color: var(--success); }
        .results-table .warning-text { color: var(--warning); font-weight: 600; }
        .results-table .danger-text { color: var(--danger); font-weight: 700; }

        /* Educational Section */
        .education-section { margin-top: 60px; }
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover { transform: translateX(5px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .insight-card h4 i { font-size: 1.5rem; }
        .insight-card p { margin: 10px 0; line-height: 1.8; }
        .insight-card ul { padding-left: 20px; margin: 10px 0; }
        .insight-card li { margin-bottom: 10px; }
        .stat-highlight {
            display: inline-block;
            background: var(--accent);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin: 0 4px;
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h4 { color: var(--danger); margin-top: 0; }
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
            border-left: 5px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h4 { color: var(--success); margin-top: 0; }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px; left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        
        /* Responsive & Utility */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .btn-group { flex-direction: column; }
        }
        .hidden { display: none; }
        
        /* Tooltip */
        .info-icon { color: var(--primary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden; width: 260px;
            background-color: #333; color: #fff;
            text-align: center; border-radius: 6px;
            padding: 8px; position: absolute;
            z-index: 10; bottom: 125%; left: 50%;
            margin-left: -130px; opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem; line-height: 1.4;
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; transform: translateY(0); }
    </style>
    <link rel="stylesheet" href="styles.css">
    <meta property="og:title" content="Control Valve Noise Prediction (IEC 60534-8) - Design Calculators - Instrumentation">
    <meta property="og:description" content="Professional IEC 60534-8 Control Valve Aerodynamic and Hydrodynamic Noise Prediction Calculator. Features Fluid Library, Insulation attenuation, distance correction, and detailed calculation steps.">
</head>
<body>
    <div id="message-box" class="message-box"></div>

    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-volume-high"></i> Control Valve Noise Prediction (IEC 60534-8)</h2>
            
            <p>This industrial-grade calculator predicts noise levels ($L_{pA}$) for control valves in both <strong>Gas/Vapor (Aerodynamic)</strong> and <strong>Liquid (Hydrodynamic)</strong> service. It utilizes the rigorous 5-Regime method from IEC 60534-8-3 and cavitation models from IEC 60534-8-4, accounting for pipe geometry, insulation, and observer distance.</p>
            
            <div class="calculator-form">
                <form id="noise-calculator-form">
                    <h3>1. Service & Valve Data</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fluid-type">Service Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Aerodynamic noise (Gas/Steam) is generated by turbulence and shock waves. Hydrodynamic noise (Liquid) is generated by cavitation and turbulence.</span></span></label>
                            <select id="fluid-type">
                                <option value="gas">Gas / Steam (Aerodynamic)</option>
                                <option value="liquid">Liquid (Hydrodynamic)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="valve-style">Valve Style <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select to auto-fill generic Fd and FL values.</span></span></label>
                            <select id="valve-style">
                                <option value="cage">Globe - Cage Guided (Low Noise)</option>
                                <option value="contour">Globe - Parabolic Plug</option>
                                <option value="ball">Rotary - Ball Valve (Full Bore)</option>
                                <option value="butterfly">Rotary - Butterfly (60°)</option>
                                <option value="eccentric">Rotary - Eccentric Plug</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="valve-cv">Valve Cv (at Condition) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The flow coefficient at the specific opening required for this flow rate.</span></span></label>
                            <input type="number" id="valve-cv" step="any" value="50" required>
                        </div>
                    </div>
                    
                    <!-- Advanced Valve Factors -->
                    <div class="form-row" style="background-color: var(--bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 20px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="fd-factor">Valve Style Modifier ($F_d$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Critical for Noise. 0.1-0.3 for Low Noise Trim, 0.4-0.5 for Globe, ~1.0 for Ball.</span></span></label>
                            <input type="number" id="fd-factor" step="0.01" value="0.40">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="fl-factor">Pressure Recovery Factor ($F_L$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Determines choked flow point. 0.85-0.9 for Globe, 0.6-0.7 for Rotary.</span></span></label>
                            <input type="number" id="fl-factor" step="0.01" value="0.85">
                        </div>
                        <div class="form-group" id="xt-group" style="margin-bottom: 0;">
                            <label for="xt-factor">Critical Pressure Ratio ($x_T$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">For gas choke point. Typically ~0.72 for Globe, ~0.3 for Rotary.</span></span></label>
                            <input type="number" id="xt-factor" step="0.01" value="0.72">
                        </div>
                    </div>

                    <h3>2. Process Conditions</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="p1">Inlet Pressure ($P_1$) [psia] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Absolute pressure at valve inlet.</span></span></label>
                            <input type="number" id="p1" step="any" value="115" required>
                        </div>
                        <div class="form-group">
                            <label for="p2">Outlet Pressure ($P_2$) [psia] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Absolute pressure at valve outlet. High pressure drop increases stream power and noise.</span></span></label>
                            <input type="number" id="p2" step="any" value="65" required>
                        </div>
                         <div class="form-group">
                            <label for="flow-rate">Flow Rate <span id="flow-unit-label">[lb/hr]</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Mass flow for gas/steam, Volumetric (GPM) for liquid.</span></span></label>
                            <input type="number" id="flow-rate" step="any" value="10000" required>
                        </div>
                    </div>

                    <div class="form-row hidden" id="liquid-props-row">
                        <div class="form-group">
                            <label for="liquid-lib">Liquid Library <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Auto-populate properties.</span></span></label>
                            <select id="liquid-lib">
                                <option value="water" selected>Water</option>
                                <option value="crude">Crude Oil (35 API)</option>
                                <option value="benzene">Benzene</option>
                                <option value="methanol">Methanol</option>
                                <option value="custom">-- Custom --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pv">Vapor Pressure ($P_v$) [psia] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Required for liquid cavitation check.</span></span></label>
                            <input type="number" id="pv" step="any" value="0.95">
                        </div>
                        <div class="form-group">
                            <label for="sg">Specific Gravity ($G_f$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Water = 1.0.</span></span></label>
                            <input type="number" id="sg" step="any" value="1.0">
                        </div>
                    </div>

                    <div class="form-row" id="gas-props-row">
                        <div class="form-group">
                            <label for="gas-lib">Gas Library <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Auto-populate properties.</span></span></label>
                            <select id="gas-lib">
                                <option value="air" selected>Air</option>
                                <option value="steam">Steam (H2O)</option>
                                <option value="natgas">Natural Gas (MW~17)</option>
                                <option value="methane">Methane (CH4)</option>
                                <option value="nitrogen">Nitrogen (N2)</option>
                                <option value="co2">Carbon Dioxide</option>
                                <option value="custom">-- Custom --</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label for="mw">Molecular Weight ($M$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Air = 29. Steam = 18.</span></span></label>
                            <input type="number" id="mw" step="any" value="29">
                        </div>
                        <div class="form-group">
                            <label for="temp">Temperature ($T_1$) [°F] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inlet Temperature.</span></span></label>
                            <input type="number" id="temp" step="any" value="100">
                        </div>
                        <div class="form-group">
                            <label for="k-gas">Specific Heat Ratio ($k$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ratio Cp/Cv. Air=1.4. Steam=1.3.</span></span></label>
                            <input type="number" id="k-gas" step="0.01" value="1.4">
                        </div>
                    </div>

                    <h3>3. Piping & Installation Geometry</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pipe-size">Outlet Pipe Size (NPS)</label>
                            <select id="pipe-size">
                                <option value="2">2"</option>
                                <option value="3">3"</option>
                                <option value="4" selected>4"</option>
                                <option value="6">6"</option>
                                <option value="8">8"</option>
                                <option value="10">10"</option>
                                <option value="12">12"</option>
                                <option value="16">16"</option>
                                <option value="20">20"</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pipe-schedule">Pipe Schedule</label>
                            <select id="pipe-schedule">
                                <option value="40">Schedule 40 (Standard)</option>
                                <option value="80">Schedule 80 (Extra Strong)</option>
                                <option value="160">Schedule 160</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="insulation">Thermal/Acoustic Insulation <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">External insulation acts as a sound barrier.</span></span></label>
                            <select id="insulation">
                                <option value="0">None (Bare Pipe)</option>
                                <option value="5">Light (1" Thermal)</option>
                                <option value="10">Standard (2" Acoustic)</option>
                                <option value="15">Heavy (4" Acoustic/Lead)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="distance">Observer Distance [meters] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Distance from pipe wall to measurement point. Standard is 1m.</span></span></label>
                            <input type="number" id="distance" step="0.1" value="1.0">
                        </div>
                    </div>

                    <div class="btn-group" style="margin-top: 25px;">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Predict Noise</button>
                        <button type="button" id="reset-btn" class="btn accent"><i class="fas fa-sync-alt"></i> Reset</button>
                        <button type="button" id="pdf-btn" class="btn secondary" style="display: none;"><i class="fas fa-file-pdf"></i> Download Report</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Steps Container -->
        <div id="steps-container" class="steps-container math-content"></div>

        <!-- Results Table -->
        <div id="results-section" class="card hidden" style="margin-top: 40px;">
            <h3><i class="fas fa-clipboard-check"></i> Noise Prediction Summary</h3>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="results-tbody"></tbody>
            </table>
        </div>
        
        <!-- Educational Section -->
        <div id="education-section" class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Professional Insights: Noise & Cavitation</h2>

            <div class="insight-card">
                <h4><i class="fas fa-wind"></i> IEC 60534-8-3 Regimes (Aerodynamic)</h4>
                <p>Noise prediction is divided into regimes based on the Mach number at the vena contracta ($M_{vc}$):</p>
                <ul>
                    <li><strong>Regime I (Subsonic):</strong> $M_{vc} < 1$. Noise is generated by turbulent mixing shear forces. Efficiency $\propto M^3$.</li>
                    <li><strong>Regime II (Sonic):</strong> $M_{vc} = 1$. The flow is choked. Shock cells begin to form. Efficiency increases rapidly.</li>
                    <li><strong>Regime III-IV (Supersonic):</strong> Intense shock-turbulence interaction. This is the loudest regime.</li>
                </ul>
            </div>

            <div class="danger-box">
                <h4><i class="fas fa-water"></i> Hydrodynamic Noise & Cavitation</h4>
                <p>In liquids, noise is usually low unless <strong>Cavitation</strong> occurs. Cavitation happens when the pressure falls below the vapor pressure ($P_v$) and then recovers.</p>
                <ul>
                    <li><strong>Incipient Cavitation:</strong> "Gravel" sound. Minor damage potential.</li>
                    <li><strong>Constant Cavitation:</strong> Loud crackling noise. Severe damage to valve trim and body.</li>
                    <li><strong>Choked Flow / Flashing:</strong> Pressure never recovers above $P_v$. Max flow is limited.</li>
                </ul>
            </div>

            <div class="success-box">
                <h4><i class="fas fa-layer-group"></i> Path Treatment: Insulation & Pipe Schedule</h4>
                <p>The pipe wall acts as a transmission barrier ($TL$). Increasing schedule (wall thickness) typically adds 4-6 dB of attenuation.</p>
                <p><strong>Acoustic Insulation</strong> is one of the most cost-effective noise reduction methods. A 2-inch layer of high-density mineral wool can provide 10 dB of attenuation for high-frequency aerodynamic noise.</p>
            </div>
        </div>
    </main>

        <!-- FOOTER -->
        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DATA LIBRARIES ---
            const valveFactors = {
                'cage': { fd: 0.40, fl: 0.90, xt: 0.72 },
                'contour': { fd: 0.45, fl: 0.85, xt: 0.70 },
                'ball': { fd: 0.98, fl: 0.60, xt: 0.30 },
                'butterfly': { fd: 0.70, fl: 0.60, xt: 0.35 },
                'eccentric': { fd: 0.50, fl: 0.85, xt: 0.60 }
            };

            const gasLib = {
                'air': { mw: 28.97, k: 1.40 },
                'steam': { mw: 18.02, k: 1.33 },
                'natgas': { mw: 17.5, k: 1.30 },
                'methane': { mw: 16.04, k: 1.31 },
                'nitrogen': { mw: 28.01, k: 1.40 },
                'co2': { mw: 44.01, k: 1.30 }
            };

            const liquidLib = {
                'water': { sg: 1.0, pv: 0.95 }, // @ 100F
                'crude': { sg: 0.85, pv: 8.0 }, // RVP 8
                'benzene': { sg: 0.88, pv: 3.2 },
                'methanol': { sg: 0.79, pv: 4.6 }
            };

            // --- Elements ---
            const form = document.getElementById('noise-calculator-form');
            const calculateBtn = document.getElementById('calculate-btn');
            const resetBtn = document.getElementById('reset-btn');
            const pdfBtn = document.getElementById('pdf-btn');
            const fluidTypeSelect = document.getElementById('fluid-type');
            const valveStyleSelect = document.getElementById('valve-style');
            
            // Inputs
            const fdInput = document.getElementById('fd-factor');
            const flInput = document.getElementById('fl-factor');
            const xtInput = document.getElementById('xt-factor');
            
            // Groups to toggle
            const gasPropsRow = document.getElementById('gas-props-row');
            const liquidPropsRow = document.getElementById('liquid-props-row');
            const xtGroup = document.getElementById('xt-group');
            const flowUnitLabel = document.getElementById('flow-unit-label');
            const flowInput = document.getElementById('flow-rate');
            
            const gasLibSelect = document.getElementById('gas-lib');
            const liqLibSelect = document.getElementById('liquid-lib');
            
            const stepsContainer = document.getElementById('steps-container');
            const resultsSection = document.getElementById('results-section');
            const resultsTbody = document.getElementById('results-tbody');
            const messageBox = document.getElementById('message-box');
            const themeSwitch = document.getElementById('theme-switch');

            let lastCalculation = null;

            // --- UI Logic ---
            fluidTypeSelect.addEventListener('change', function() {
                const type = this.value;
                if (type === 'liquid') {
                    gasPropsRow.classList.add('hidden');
                    xtGroup.classList.add('hidden');
                    liquidPropsRow.classList.remove('hidden');
                    flowUnitLabel.textContent = "[GPM]";
                    flowInput.value = "500";
                    // Default liquid params
                    document.getElementById('p1').value = "100";
                    document.getElementById('p2').value = "50";
                } else {
                    gasPropsRow.classList.remove('hidden');
                    xtGroup.classList.remove('hidden');
                    liquidPropsRow.classList.add('hidden');
                    flowUnitLabel.textContent = "[lb/hr]";
                    flowInput.value = "10000";
                    // Default gas params
                    document.getElementById('p1').value = "115";
                    document.getElementById('p2').value = "65";
                }
            });

            valveStyleSelect.addEventListener('change', function() {
                const factors = valveFactors[this.value];
                if (factors) {
                    fdInput.value = factors.fd.toFixed(2);
                    flInput.value = factors.fl.toFixed(2);
                    xtInput.value = factors.xt.toFixed(2);
                }
            });

            gasLibSelect.addEventListener('change', function() {
                if(this.value !== 'custom') {
                    const data = gasLib[this.value];
                    document.getElementById('mw').value = data.mw;
                    document.getElementById('k-gas').value = data.k;
                }
            });

            liqLibSelect.addEventListener('change', function() {
                if(this.value !== 'custom') {
                    const data = liquidLib[this.value];
                    document.getElementById('sg').value = data.sg;
                    document.getElementById('pv').value = data.pv;
                }
            });

            // Theme Toggle
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                }
            });

            calculateBtn.addEventListener('click', calculateNoise);
            resetBtn.addEventListener('click', resetForm);
            pdfBtn.addEventListener('click', generatePDF);

            // --- Utility Functions ---
            function showMessage(msg, type = 'success') {
                messageBox.textContent = msg;
                if (type === 'error') {
                    messageBox.style.backgroundColor = 'var(--danger)';
                } else if (type === 'warning') {
                     messageBox.style.backgroundColor = 'var(--warning)';
                     messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                    messageBox.style.color = 'white';
                }
                messageBox.classList.add('show');
                setTimeout(() => messageBox.classList.remove('show'), 4000);
            }

            function format(num, decimals = 2) {
                return parseFloat(num.toFixed(decimals)).toString();
            }

            function resetForm() {
                form.reset();
                fluidTypeSelect.dispatchEvent(new Event('change'));
                valveStyleSelect.dispatchEvent(new Event('change'));
                gasLibSelect.dispatchEvent(new Event('change'));
                liqLibSelect.dispatchEvent(new Event('change'));
                stepsContainer.classList.remove('active');
                stepsContainer.innerHTML = '';
                resultsSection.classList.add('hidden');
                pdfBtn.style.display = 'none';
                lastCalculation = null;
                showMessage("Form reset to default values.");
            }

            // --- Core Calculation Logic ---
            function calculateNoise() {
                stepsContainer.innerHTML = '';
                
                try {
                    // Common Inputs
                    const type = fluidTypeSelect.value;
                    const Cv = parseFloat(document.getElementById('valve-cv').value);
                    const P1 = parseFloat(document.getElementById('p1').value);
                    const P2 = parseFloat(document.getElementById('p2').value);
                    const flowRate = parseFloat(document.getElementById('flow-rate').value);
                    
                    const Fd = parseFloat(fdInput.value);
                    const FL = parseFloat(flInput.value);
                    
                    const pipeNPS = parseFloat(document.getElementById('pipe-size').value);
                    const pipeSch = document.getElementById('pipe-schedule').value;
                    
                    const insulationLoss = parseFloat(document.getElementById('insulation').value);
                    const distance = parseFloat(document.getElementById('distance').value);

                    // Validation
                    if (P1 <= P2) throw new Error("Inlet Pressure P1 must be greater than Outlet P2.");
                    if (P1 <= 0 || P2 <= 0) throw new Error("Pressures must be positive.");
                    if (distance <= 0) throw new Error("Distance must be > 0.");

                    // ------------------------------------------------------------
                    // STEP 1: GEOMETRIC CALCULATIONS
                    // ------------------------------------------------------------
                    // Pipe Geometry (Inches)
                    const pipeThicknessMap = {
                        '40': { '2': 0.154, '3': 0.216, '4': 0.237, '6': 0.280, '8': 0.322, '10': 0.365, '12': 0.406, '16': 0.500, '20': 0.594 },
                        '80': { '2': 0.218, '3': 0.300, '4': 0.337, '6': 0.432, '8': 0.500, '10': 0.593, '12': 0.687, '16': 0.844, '20': 1.031 },
                        '160':{ '2': 0.343, '3': 0.438, '4': 0.531, '6': 0.718, '8': 0.906, '10': 1.125, '12': 1.312, '16': 1.594, '20': 1.969 }
                    };
                    const t_pipe = (pipeThicknessMap[pipeSch] && pipeThicknessMap[pipeSch][pipeNPS]) || 0.237;
                    const Di = pipeNPS - (2 * t_pipe); // Inner Diameter estimate

                    let stepsHtml = '';
                    let spl_dBA = 0;
                    let regimeText = "";
                    let warningMsg = "";

                    // Add Step 1 HTML
                    stepsHtml += createStepCard(1, "Geometry & Pipe Data", 
                        `Determination of pipe wall characteristics for Transmission Loss calculation.`,
                        `<p>Selected Pipe: <strong>${pipeNPS}" Sch ${pipeSch}</strong></p>
                         <p>Wall Thickness ($t$): <strong>${t_pipe} inches</strong></p>
                         <p>Inner Diameter ($D_i$): <strong>${format(Di, 3)} inches</strong></p>
                         <p>Observer Distance ($r$): <strong>${distance} m</strong></p>`
                    );

                    // ------------------------------------------------------------
                    // STEP 2 & 3: FLUID SPECIFIC
                    // ------------------------------------------------------------
                    
                    // Transmission Loss (TL) Approximation Baseline
                    const logTerm = 20 * Math.log10(t_pipe / pipeNPS);
                    let baseTL = 45 + logTerm; // Empirical fit
                    if (pipeNPS > 8) baseTL -= 4; // Large pipe correction
                    if (baseTL < 20) baseTL = 20; 
                    const FinalTL = baseTL;

                    if (type === 'gas') {
                        // --- AERODYNAMIC NOISE ---
                        const xT = parseFloat(xtInput.value);
                        const MW = parseFloat(document.getElementById('mw').value);
                        const T1_F = parseFloat(document.getElementById('temp').value);
                        const k = parseFloat(document.getElementById('k-gas').value);
                        
                        // Conversions
                        const T1_K = (T1_F - 32) * 5/9 + 273.15;
                        const R_univ = 8314; // J/(kmol K)
                        const R_gas = R_univ / MW; // J/(kg K)
                        
                        // 1. Gas Density (Ideal Gas Law approx)
                        const P1_Pa = P1 * 6894.76;
                        const rho_1 = P1_Pa / (R_gas * T1_K); // kg/m3

                        // 2. Sonic Velocity
                        const c_vc = Math.sqrt(k * R_gas * T1_K); // m/s

                        // 3. Mass Flow Conversion
                        const W_lb_hr = flowRate;
                        const W_kg_s = W_lb_hr * 0.000125998; 

                        // Step 2 HTML
                        stepsHtml += createStepCard(2, "Fluid Properties (Gas)", 
                            `Calculation of density and sonic velocity at inlet conditions.`,
                            `$$ \\text{Formula: } \\rho_1 = \\frac{P_1}{R_{gas} T_1} $$
                             $$ \\text{Substitution: } \\rho_1 = \\frac{${format(P1_Pa, 0)}}{${format(R_gas, 1)} \\times ${format(T1_K, 1)}} $$
                             $$ \\text{Result: } \\mathbf{\\rho_1 = ${format(rho_1, 3)} \\text{ kg/m}^3} $$
                             <hr style="border-top: 1px dashed #ccc; margin: 10px 0;">
                             $$ c_{vc} = \\sqrt{${k} \\times ${format(R_gas, 1)} \\times ${format(T1_K, 1)}} = \\mathbf{${format(c_vc, 1)} \\text{ m/s}} $$`
                        );

                        // 4. Pressure Ratios
                        const dP = P1 - P2;
                        const x = dP / P1; // Differential Pressure Ratio
                        const Fk = k / 1.40;
                        const x_cr = xT * Fk; // Critical Pressure Ratio

                        let regime = "I";
                        if (x < x_cr) regime = "I (Subsonic)";
                        else regime = "II (Choked/Sonic)";

                        // Step 3 HTML
                        stepsHtml += createStepCard(3, "Pressure Ratios & Regime", 
                            `Comparison of actual pressure drop ratio ($x$) vs. critical ratio ($x_{cr}$) to determine flow regime.`,
                            `$$ x = \\frac{\\Delta P}{P_1} = \\frac{${format(dP)}}{${P1}} = \\mathbf{${format(x, 3)}} $$
                             $$ x_{cr} = x_T \\cdot F_k = ${xT} \\cdot ${format(Fk, 2)} = \\mathbf{${format(x_cr, 3)}} $$
                             <p style="margin-top:10px">Regime: <strong>${regime}</strong></p>`
                        );

                        // 5. Stream Power (Wm) & Efficiency
                        let M_vc = 0;
                        if (x < x_cr) {
                            M_vc = Math.sqrt( (2/(k-1)) * ( Math.pow(1/(1-x/Fk), (k-1)/k) - 1 ) );
                        } else {
                            M_vc = 1.0; 
                        }

                        const V_vc = (x < x_cr) ? M_vc * c_vc : c_vc;
                        const Wm = (W_kg_s * Math.pow(V_vc, 2)) / 2;

                        let eta = 0;
                        if (x < x_cr) {
                             eta = 1e-4 * Math.pow(M_vc, 3) * Fd;
                        } else {
                             const pr_ratio = P1/P2;
                             eta = 1e-4 * Fd * Math.pow(pr_ratio, 0.5); 
                        }

                        // Step 4 HTML
                        stepsHtml += createStepCard(4, "Stream Power & Efficiency", 
                            `Calculation of total Mechanical Power ($W_m$) available in the stream and the Acoustical Efficiency factor ($\\eta$).`,
                            `$$ V_{vc} = \\mathbf{${format(V_vc, 1)} \\text{ m/s}} \\quad (M = ${format(M_vc, 2)}) $$
                             $$ \\text{Formula: } W_m = \\frac{\\dot{m} V^2}{2} $$
                             $$ \\text{Substitution: } W_m = \\frac{${format(W_kg_s, 4)} \\times ${format(V_vc, 1)}^2}{2} $$
                             $$ \\text{Result: } \\mathbf{W_m = ${format(Wm, 0)} \\text{ Watts}} $$
                             $$ \\eta \\approx ${format(eta*10000, 2)} \\times 10^{-4} $$`
                        );

                        // 6. Source & SPL
                        const Wa = eta * Wm; // Acoustic Power [Watts]
                        const Lw_internal = 10 * Math.log10(Wa / 1e-12); // dB re 1pW

                        // SPL with Distance Correction
                        // Standard IEC assumes 1m from pipe surface.
                        // Point source decay: 20*log10(r). Since 1m is reference, Delta = 20*log10(distance)
                        const distCorrection = 20 * Math.log10(distance);
                        
                        spl_dBA = Lw_internal - FinalTL - 20 - insulationLoss - distCorrection;

                        // Step 5 HTML
                        stepsHtml += createStepCard(5, "Acoustic Power & SPL", 
                            `Conversion of Mechanical Power to Sound Power ($L_w$) and applying Attenuation (TL + Insulation + Distance).`,
                            `$$ W_a = \\eta \\cdot W_m = ${format(Wa, 4)} \\text{ Watts} $$
                             $$ L_{wi} = 10 \\log(\\frac{W_a}{10^{-12}}) = \\mathbf{${format(Lw_internal, 1)} \\text{ dB}} $$
                             $$ \\text{Attenuations:} $$
                             <ul>
                                <li>Pipe Wall (TL): -${format(FinalTL, 1)} dB</li>
                                <li>Insulation: -${format(insulationLoss, 1)} dB</li>
                                <li>Distance (${distance}m): -${format(distCorrection, 1)} dB</li>
                             </ul>
                             $$ \\mathbf{L_{pA} = ${format(spl_dBA, 1)} \\text{ dBA}} $$`
                        );

                        regimeText = regime;

                    } else {
                        // --- HYDRODYNAMIC NOISE ---
                        const Pv = parseFloat(document.getElementById('pv').value);
                        const Q_gpm = parseFloat(document.getElementById('flow-rate').value);
                        const Gf = parseFloat(document.getElementById('sg').value);

                        const dP = P1 - P2;
                        const P1_Pv = P1 - Pv;
                        
                        // 1. Cavitation Index
                        const sigma = P1_Pv / dP;
                        
                        // 2. Choked Limit
                        const dP_choked = Math.pow(FL, 2) * (P1 - Pv);
                        const isChoked = dP >= dP_choked;
                        
                        // Step 2 HTML
                        stepsHtml += createStepCard(2, "Cavitation Analysis", 
                            `Calculating Sigma ($\\sigma$) and comparing Actual $\\Delta P$ vs Choked Limit.`,
                            `$$ \\sigma = \\frac{P_1 - P_v}{\\Delta P} = \\frac{${format(P1_Pv, 1)}}{${format(dP, 1)}} = \\mathbf{${format(sigma, 2)}} $$
                             $$ \\Delta P_{choked} = F_L^2 (P_1 - P_v) = \\mathbf{${format(dP_choked, 1)} \\text{ psi}} $$
                             $$ \\text{Actual } \\Delta P = ${format(dP, 1)} \\text{ psi} $$`
                        );
                        
                        // 3. Noise Source Calc
                        let noiseMode = "";
                        let baseSpl = 0;
                        const termQ = 10 * Math.log10(Q_gpm);
                        const termDp = 20 * Math.log10(dP);
                        // Base Turbulent Noise equation approximation
                        const baseTurbulent = termQ + termDp + 5; 
                        
                        if (sigma > 3.0) {
                            noiseMode = "Turbulent (Non-Cavitating)";
                            baseSpl = baseTurbulent;
                        } else if (!isChoked) {
                            noiseMode = "Cavitation";
                            const cavFactor = (3.0 - sigma) * 20; 
                            baseSpl = baseTurbulent + cavFactor;
                        } else {
                            noiseMode = "Flashing / Choked";
                            baseSpl = baseTurbulent + 35; // Cap at peak cavitation
                        }
                        
                        // Valve Style Correction
                        const styleCorrection = 20 * Math.log10(Fd);
                        const internal_Lw = baseSpl + styleCorrection + 60; // Scaling constant for liquids

                        // Step 3 HTML
                        stepsHtml += createStepCard(3, "Internal Source Generation", 
                            `Estimating internal noise based on flow energy and cavitation penalty.`,
                            `<p>Mode: <strong>${noiseMode}</strong></p>
                             $$ L_{base} \\approx 10\\log(Q) + 20\\log(\\Delta P) = ${format(baseTurbulent, 1)} $$
                             $$ \\text{Style Factor} = 20\\log(F_d) = ${format(styleCorrection, 1)} $$
                             $$ L_{wi} \\approx \\mathbf{${format(internal_Lw, 1)} \\text{ dB}} $$`
                        );
                        
                        // 4. Final SPL
                        const distCorrection = 20 * Math.log10(distance);
                        spl_dBA = internal_Lw - FinalTL - 20 - insulationLoss - distCorrection;
                        regimeText = noiseMode;

                        // Step 4 HTML
                        stepsHtml += createStepCard(4, "Final SPL Calculation", 
                            `Applying Attenuation factors (TL, Insulation, Distance) to Internal Source.`,
                            `$$ L_{pA} = L_{wi} - TL - 20 - \\text{Insul} - \\text{Dist} $$
                             $$ L_{pA} = ${format(internal_Lw, 1)} - ${format(FinalTL, 1)} - 20 - ${format(insulationLoss, 1)} - ${format(distCorrection, 1)} $$
                             $$ \\mathbf{L_{pA} = ${format(spl_dBA, 1)} \\text{ dBA}} $$`
                        );
                    }

                    // --- Final Checks ---
                    if (spl_dBA < 0) spl_dBA = 0; 

                    let statusClass = "highlight";
                    let statusText = "Acceptable (< 85 dBA)";
                    
                    if (spl_dBA >= 85) {
                        statusClass = "warning-text";
                        statusText = "High Noise - PPE Required (> 85 dBA)";
                        warningMsg = "Warning: Noise level exceeds 85 dBA.";
                    }
                    if (spl_dBA >= 100) {
                        statusClass = "danger-text";
                        statusText = "SEVERE NOISE - Vibration Risk (> 100 dBA)";
                        warningMsg = "CRITICAL: Noise exceeds 100 dBA. Structural damage likely.";
                    }

                    if (warningMsg) showMessage(warningMsg, spl_dBA >= 100 ? "error" : "warning");
                    else showMessage("Calculation successful!", "success");

                    // --- Output HTML ---
                    stepsContainer.innerHTML = stepsHtml;
                    
                    resultsTbody.innerHTML = `
                        <tr><td>Service Type</td><td>${type.toUpperCase()}</td></tr>
                        <tr><td>Flow Regime / Mode</td><td>${regimeText}</td></tr>
                        <tr><td>Valve Factors</td><td>Fd: ${Fd.toFixed(2)}, FL: ${FL.toFixed(2)}</td></tr>
                        <tr><td>Pipe & Insulation</td><td>${pipeNPS}" Sch ${pipeSch}, Insul: ${insulationLoss}dB</td></tr>
                        <tr><td>Distance</td><td>${distance} m</td></tr>
                        <tr><td><strong>Predicted SPL</strong></td><td class="${statusClass}" style="font-size:1.3rem;">${format(spl_dBA, 1)} dBA</td></tr>
                        <tr><td>Compliance Status</td><td class="${statusClass}">${statusText}</td></tr>
                    `;

                    lastCalculation = { type, spl_dBA, regimeText, pipeNPS, pipeSch, Fd, FL, distance };

                    stepsContainer.classList.add('active');
                    resultsSection.classList.remove('hidden');
                    pdfBtn.style.display = 'inline-flex';
                    
                    // SCROLL LOGIC
                    setTimeout(() => { 
                        stepsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }); 
                    }, 100);
                    
                    if (window.MathJax) { window.MathJax.typeset(); }

                } catch (e) {
                    showMessage(e.message, "error");
                    console.error(e);
                }
            }

            function createStepCard(num, title, description, formula) {
                return `
                <div class="step-card">
                    <h4><span class="number">${num}</span>${title}</h4>
                    <div class="step-content">
                        <div class="formula-block" style="width:100%">
                            <p><strong>Description:</strong> ${description}</p>
                            <div class="formula" style="margin-top:15px;">
                                ${formula}
                            </div>
                        </div>
                    </div>
                </div>`;
            }

            // --- PDF Generation ---
            function generatePDF() {
                if (!lastCalculation) return;

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                let y = 15;

                // Title
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(16);
                pdf.text('Control Valve Noise Prediction Report', 105, y, { align: 'center' });
                y += 8;

                pdf.setFont('helvetica', 'normal');
                pdf.setFontSize(9);
                pdf.text(`Generated by Design Calculators | ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
                y += 10;

                // Inputs
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(12);
                pdf.text('Valve & Process Data', 14, y);
                y += 2;

                const inputData = [
                    ['Service', fluidTypeSelect.value.toUpperCase()],
                    ['Valve Style', document.getElementById('valve-style').options[document.getElementById('valve-style').selectedIndex].text],
                    ['Valve Cv', document.getElementById('valve-cv').value],
                    ['Inlet Pressure', document.getElementById('p1').value + ' psia'],
                    ['Outlet Pressure', document.getElementById('p2').value + ' psia'],
                    ['Pipe Size', `${document.getElementById('pipe-size').value}" Sch ${document.getElementById('pipe-schedule').value}`],
                    ['Insulation', document.getElementById('insulation').options[document.getElementById('insulation').selectedIndex].text],
                    ['Distance', lastCalculation.distance + ' m']
                ];

                pdf.autoTable({
                    startY: y,
                    head: [['Parameter', 'Value']],
                    body: inputData,
                    margin: { left: 14, right: 14 },
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 138] },
                });
                y = pdf.autoTable.previous.finalY + 10;

                // Results
                pdf.setFont('helvetica', 'bold');
                pdf.text('Prediction Results', 14, y);
                y += 2;

                const resData = [
                    ['Flow Regime', lastCalculation.regimeText],
                    ['Predicted SPL', `${format(lastCalculation.spl_dBA, 1)} dBA`],
                    ['Status', lastCalculation.spl_dBA > 85 ? "HIGH NOISE - ACTION REQUIRED" : "Acceptable"]
                ];

                pdf.autoTable({
                    startY: y,
                    head: [['Result', 'Value']],
                    body: resData,
                    margin: { left: 14, right: 14 },
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 138] },
                    didParseCell: function (data) {
                        if (data.row.index === 1) { 
                            if (lastCalculation.spl_dBA > 85) data.cell.styles.textColor = [220, 38, 38];
                            else data.cell.styles.textColor = [16, 185, 129];
                            data.cell.styles.fontStyle = 'bold';
                        }
                    }
                });
                
                // Footer
                y = pdf.autoTable.previous.finalY + 15;
                pdf.setFont('helvetica', 'normal');
                pdf.setFontSize(8);
                pdf.setTextColor(100, 100, 100);
                pdf.text('Calculation per IEC 60534-8-3 (Aerodynamic) and 60534-8-4 (Hydrodynamic).', 105, y, { align: 'center' });
                pdf.text('Values are estimations. Always verify with manufacturer software (Fisher/Masoneilan).', 105, y + 4, { align: 'center' });

                pdf.save('Valve-Noise-Report.pdf');
                showMessage('PDF Report downloaded.');
            }
        });
    </script>
</body>
</html>
