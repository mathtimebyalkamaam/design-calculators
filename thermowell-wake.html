<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermowell Wake Frequency - Design Calculators - Instrumentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #3b8e3e);
            --reset-button-bg: #FFC107; /* Yellow for reset */
            --reset-button-hover-bg: #E0A800; /* Darker yellow */
            --clear-button-bg: #007bff; /* Blue for clear */
            --clear-button-hover-bg: #0056b3; /* Darker blue */
            --ok-color: #28a745; /* Green for OK status */
            --error-color: #dc3545; /* Red for error status */
            --warning-color: #ffc107; /* Amber for warnings */
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #446688;
            --button-gradient: linear-gradient(45deg, #3b8e3e, #4CAF50);
            --button-hover-gradient: linear-gradient(45deg, #4CAF50, #5cb85c);
            --reset-button-bg: #FFD700; /* Gold/Yellow for dark mode reset */
            --reset-button-hover-bg: #DAA520; /* Darker gold/yellow */
            --clear-button-bg: #17a2b8; /* Cyan for dark mode clear */
            --clear-button-hover-bg: #138496;
            --ok-color: #5cb85c;
            --error-color: #e74c3c;
            --warning-color: #DAA520;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-color), #e0e0e0);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            padding: 20px 0;
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.3s;
            width: fit-content; 
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 5px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        footer .disclaimer p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-section {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px; /* Space between sections */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0; /* Initial state for fade-in animation */
            transform: translateY(10px); /* Initial state for slide-up animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px; /* Default margin for form groups */
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg); /* Use card-bg for input background */
            color: var(--text-color);
            box-sizing: border-box; /* Ensure padding doesn't increase width */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
            gap: 20px; /* Gap between grid items */
            margin-bottom: 0; /* Handled by form-group margin */
        }
        
        .calculate-btn {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 12px 30px; /* Increased padding for better appearance */
            border-radius: 25px; /* More rounded */
            cursor: pointer;
            font-size: 1.1em; /* Slightly larger font */
            font-weight: bold;
            margin-top: 25px; /* More space above button */
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto; /* Allow button to size based on content and padding */
            min-width: 220px; /* Ensure a minimum width for consistency */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .calculate-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02); /* Lift and slightly scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }

        .reset-btn {
            background-color: var(--reset-button-bg);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 25px;
            margin-left: 15px; /* Space from calculate button */
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .reset-btn:hover {
            background-color: var(--reset-button-hover-bg);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .clear-results-btn {
            background-color: var(--clear-button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .clear-results-btn:hover {
            background-color: var(--clear-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* For animation */
            transform: translateY(20px); /* Initial state for animation */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners apply to table content */
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--secondary-color);
        }

        .result-table tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color); /* Highlight row on hover */
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--hover-color);
            border-radius: 4px;
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: color 0.3s;
        }

        .info-icon:hover {
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px; /* Increased padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px); /* Initial state for tooltip animation */
            font-size: 0.85em;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            display: flex; /* Use flex for centering text */
            align-items: center;
            justify-content: center;
            min-width: 250px; /* Ensure it's wide enough */
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* More space */
            font-size: 0.95em;
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); /* Subtle inner shadow */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px; /* More space */
            text-align: center;
            font-size: 1.2em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif; /* A font suitable for mathematical formulas */
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 12px 10px; /* Increased padding */
            background-color: var(--hover-color);
            border-radius: 6px; /* More rounded */
            margin: 15px 0; /* More space */
            overflow-x: auto; /* Allow horizontal scrolling for long formulas */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace; /* Monospace for steps */
            background-color: var(--hover-color);
            padding: 8px 15px; /* Increased padding */
            border-radius: 4px; /* More rounded */
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-break: break-word; /* Break long words */
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px; /* Increased margin */
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px; /* More space */
            color: var(--text-color);
        }

        /* Style for centering the button */
        .button-wrapper {
            display: flex;
            justify-content: center; /* Center the button horizontally */
            width: 100%; /* Ensure it takes full width to center effectively */
            padding-top: 20px; /* Add more spacing above the button */
        }

        /* Animation for input fields on focus */
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4); /* Green glow, slightly more pronounced */
            outline: none;
            animation: pulse 0.8s infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.4);
            }
            to {
                box-shadow: 0 0 0 8px rgba(76, 175, 80, 0.2); /* Softer pulse */
            }
        }

        /* Specific styles for Thermowell Wake Frequency Calculator */
        .thermowell-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--bg-color);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            flex-direction: column;
            position: relative;
        }

        .thermowell-diagram svg {
            width: 100%;
            max-width: 400px;
            height: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--card-bg);
        }

        .diagram-label {
            position: absolute;
            font-size: 0.8em;
            font-weight: bold;
            color: var(--text-color);
            background-color: rgba(255, 255, 255, 0.8);
            padding: 2px 5px;
            border-radius: 3px;
            pointer-events: none; /* Allow clicks to pass through */
        }

        .status-display {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.5s, color 0.5s;
            text-align: center;
            width: 100%;
        }
        .status-display.ok {
            background-color: var(--ok-color);
            color: white;
        }
        .status-display.error {
            background-color: var(--error-color);
            color: white;
        }
        .status-display.warning {
            background-color: var(--warning-color);
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Instrumentation</h1>
            <p class="subtitle">Smart Tools for Modern Instrumentation Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <a href="indexInst.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </div>
        
        <div class="tool-container">
            <h2>Thermowell Wake Frequency Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator validates the mechanical stability of thermowells against flow-induced vibrations, specifically addressing vortex-induced resonance. It adheres to the guidelines of ASME PTC 19.3 TW-2016 (formerly PTC 19.3-1974) and is essential for ensuring the integrity and safety of thermowells in industrial processes worldwide.</p>
            </div>
        
            <div class="calculator-form">
                <form id="thermowell-calculator-form">
                    <!-- Thermowell Dimensions -->
                    <div class="form-section">
                        <h3>Thermowell Dimensions</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="insertion-length">Insertion Length (L) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Length from the outside of the nozzle to the tip of the thermowell (mm).</span></span></label>
                                <input type="number" id="insertion-length" step="0.1" value="150" required>
                            </div>
                            <div class="form-group">
                                <label for="tip-diameter">Tip Diameter (D<sub>t</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Outside diameter of the thermowell tip (mm).</span></span></label>
                                <input type="number" id="tip-diameter" step="0.1" value="12.7" required>
                            </div>
                            <div class="form-group">
                                <label for="root-diameter">Root Diameter (D<sub>r</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Outside diameter of the thermowell at the root (mm).</span></span></label>
                                <input type="number" id="root-diameter" step="0.1" value="19.05" required>
                            </div>
                            <div class="form-group">
                                <label for="bore-diameter">Bore Diameter (D<sub>b</sub>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inside diameter of the thermowell bore (mm).</span></span></label>
                                <input type="number" id="bore-diameter" step="0.1" value="6.35" required>
                            </div>
                            <div class="form-group">
                                <label for="thermowell-material">Thermowell Material <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Material of construction for the thermowell.</span></span></label>
                                <select id="thermowell-material" required>
                                    <option value="stainless_steel_316">Stainless Steel 316</option>
                                    <option value="stainless_steel_304">Stainless Steel 304</option>
                                    <option value="hastelloy_c276">Hastelloy C-276</option>
                                    <option value="inconel_600">Inconel 600</option>
                                    <option value="titanium">Titanium</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Process Fluid Conditions -->
                    <div class="form-section">
                        <h3>Process Fluid Conditions</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fluid-density">Fluid Density (rho_f) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Density of the process fluid (kg/m³).</span></span></label>
                                <input type="number" id="fluid-density" step="0.1" value="1000" required>
                            </div>
                            <div class="form-group">
                                <label for="fluid-viscosity">Fluid Dynamic Viscosity (mu_f) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Dynamic viscosity of the process fluid (Pa·s or N·s/m²).</span></span></label>
                                <input type="number" id="fluid-viscosity" step="0.000001" value="0.001" required>
                            </div>
                            <div class="form-group">
                                <label for="fluid-velocity">Fluid Velocity (U) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Velocity of the process fluid perpendicular to the thermowell (m/s).</span></span></label>
                                <input type="number" id="fluid-velocity" step="0.1" value="5" required>
                            </div>
                            <div class="form-group">
                                <label for="process-temperature">Process Temperature (T) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Operating temperature of the process fluid (Celsius).</span></span></label>
                                <input type="number" id="process-temperature" step="1" value="25" required>
                            </div>
                        </div>
                    </div>

                    <!-- Mounting & Geometry Factors -->
                    <div class="form-section">
                        <h3>Mounting & Geometry Factors</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="thermowell-type">Thermowell Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Straight or Tapered thermowell.</span></span></label>
                                <select id="thermowell-type" required>
                                    <option value="tapered">Tapered</option>
                                    <option value="straight">Straight</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="mounting-type">Mounting Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">How the thermowell is mounted (e.g., Cantilevered, Fixed-Fixed).</span></span></label>
                                <select id="mounting-type" required>
                                    <option value="cantilevered">Cantilevered</option>
                                    <option value="fixed_fixed">Fixed-Fixed</option>
                                    <option value="fixed_pinned">Fixed-Pinned</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="calculate-btn">Calculate Wake Frequency</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div class="thermowell-diagram">
                    <p style="margin-bottom: 25px; font-weight: bold; color: var(--secondary-color);">Thermowell Diagram (Simplified)</p>
                    <svg viewBox="0 0 100 200" preserveAspectRatio="xMidYMid meet">
                        <!-- Pipe Wall -->
                        <rect x="0" y="0" width="100" height="20" fill="#a0a0a0" stroke="#555" stroke-width="1"/>
                        <rect x="0" y="180" width="100" height="20" fill="#a0a0a0" stroke="#555" stroke-width="1"/>
                        <line x1="0" y1="20" x2="0" y2="180" stroke="#555" stroke-width="1"/>
                        <line x1="100" y1="20" x2="100" y2="180" stroke="#555" stroke-width="1"/>

                        <!-- Thermowell Body (Tapered/Straight representation) -->
                        <polygon id="thermowell-body" points="40,20 60,20 60,180 40,180" fill="#cccccc" stroke="#333333" stroke-width="1"/>
                        
                        <!-- Bore -->
                        <line x1="50" y1="20" x2="50" y2="180" stroke="#666666" stroke-width="0.5" stroke-dasharray="2,2"/>
                        
                        <!-- Labels -->
                        <text x="70" y="100" font-size="8" fill="#333" text-anchor="middle">L</text>
                        <text x="50" y="175" font-size="8" fill="#333" text-anchor="middle">D_t</text>
                        <text x="50" y="25" font-size="8" fill="#333" text-anchor="middle">D_r</text>
                        <text x="45" y="100" font-size="8" fill="#333" text-anchor="end">D_b</text>
                    </svg>
                    <p class="status-display" id="stability-status-display">Stability Status: N/A</p>
                </div>
                <div id="calculation-details">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
                </div>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Instrumentation" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Instrumentation!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Instrumentation! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators Instrumentation" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Input elements
            const insertionLengthInput = document.getElementById('insertion-length');
            const tipDiameterInput = document.getElementById('tip-diameter');
            const rootDiameterInput = document.getElementById('root-diameter');
            const boreDiameterInput = document.getElementById('bore-diameter');
            const thermowellMaterialInput = document.getElementById('thermowell-material');
            const fluidDensityInput = document.getElementById('fluid-density');
            const fluidViscosityInput = document.getElementById('fluid-viscosity');
            const fluidVelocityInput = document.getElementById('fluid-velocity');
            const processTemperatureInput = document.getElementById('process-temperature');
            const thermowellTypeInput = document.getElementById('thermowell-type');
            const mountingTypeInput = document.getElementById('mounting-type');

            // Buttons and result containers
            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const stabilityStatusDisplay = document.getElementById('stability-status-display');
            const thermowellBodySVG = document.getElementById('thermowell-body');

            // Material properties (Young's Modulus E in Pa, Density rho_s in kg/m³)
            // Values are approximate and for general calculation, actual values vary with specific alloy and temperature.
            // For professional use, these should ideally come from a more comprehensive database.
            const materialProperties = {
                'stainless_steel_316': { E_25C: 193e9, rho_s: 8000, alpha: 16.5e-6 }, // E at 25C, alpha for thermal expansion
                'stainless_steel_304': { E_25C: 193e9, rho_s: 8000, alpha: 17.3e-6 },
                'hastelloy_c276': { E_25C: 205e9, rho_s: 8890, alpha: 11.2e-6 },
                'inconel_600': { E_25C: 207e9, rho_s: 8470, alpha: 14.0e-6 },
                'titanium': { E_25C: 116e9, rho_s: 4500, alpha: 8.6e-6 }
            };

            // Temperature correction for Young's Modulus (simplified linear approximation)
            // E(T) = E_ref * (1 - C * (T - T_ref))
            // C is a temperature coefficient, T_ref is reference temperature (e.g., 25C)
            // This is a very simplified model. A more accurate calculation would involve material-specific curves.
            const getYoungsModulus = (material, temperatureC) => {
                const { E_25C, alpha } = materialProperties[material];
                // Example: Assume a general reduction of 0.05% per degree Celsius above 25C
                const tempCorrectionFactor = 1 - (0.0005 * (temperatureC - 25));
                return E_25C * Math.max(0.5, tempCorrectionFactor); // Ensure it doesn't go too low
            };

            // Default values for resetting form
            const defaultValues = {
                'insertion-length': 150, // mm
                'tip-diameter': 12.7, // mm
                'root-diameter': 19.05, // mm
                'bore-diameter': 6.35, // mm
                'thermowell-material': 'stainless_steel_316',
                'fluid-density': 1000, // kg/m³ (water)
                'fluid-viscosity': 0.001, // Pa·s (water at 20C)
                'fluid-velocity': 5, // m/s
                'process-temperature': 25, // Celsius
                'thermowell-type': 'tapered',
                'mounting-type': 'cantilevered'
            };

            // Helper function to add rows to the result table
            function addResultRow(parameter, value) {
                const row = resultTableBody.insertRow();
                const paramCell = row.insertCell();
                const valueCell = row.insertCell();
                paramCell.innerHTML = parameter;
                valueCell.innerHTML = value;
            }

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    messageBox.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        padding: 15px 25px;
                        border-radius: 8px;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                        z-index: 1000;
                        font-weight: bold;
                        color: white;
                        opacity: 0;
                        transition: opacity 0.5s ease-in-out, transform 0.3s ease-out;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        min-width: 250px;
                    `;
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; /* Red */
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; /* Amber */
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745'; /* Green */
                }
                messageBox.style.opacity = 1;
                messageBox.style.transform = 'translateX(-50%) translateY(0)';

                setTimeout(() => {
                    messageBox.style.opacity = 0;
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)';
                }, 5000);
            }

            function clearResults() {
                resultContainer.classList.remove('show');
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                standardReference.innerHTML = '';
                stabilityStatusDisplay.textContent = 'Stability Status: N/A';
                stabilityStatusDisplay.classList.remove('ok', 'error', 'warning');
                updateThermowellDiagram('tapered'); // Reset diagram to default tapered
                displayMessage("Results cleared.", "info");
            }

            function resetForm() {
                for (const key in defaultValues) {
                    document.getElementById(key).value = defaultValues[key];
                }
                clearResults();
                displayMessage("Form reset to default values.", "info");
            }

            // Function to update the SVG thermowell diagram based on type
            function updateThermowellDiagram(type) {
                if (type === 'tapered') {
                    thermowellBodySVG.setAttribute('points', '40,20 60,20 55,180 45,180');
                } else { // straight
                    thermowellBodySVG.setAttribute('points', '40,20 60,20 60,180 40,180');
                }
            }

            // Event listener for thermowell type change to update diagram
            thermowellTypeInput.addEventListener('change', function() {
                updateThermowellDiagram(this.value);
            });

            function calculateWakeFrequency() {
                clearResults(); // Clear previous results

                // Input values (converted to meters and Pascals for calculations)
                const L_mm = parseFloat(insertionLengthInput.value); // mm
                const Dt_mm = parseFloat(tipDiameterInput.value); // mm
                const Dr_mm = parseFloat(rootDiameterInput.value); // mm
                const Db_mm = parseFloat(boreDiameterInput.value); // mm
                const materialKey = thermowellMaterialInput.value;
                const rho_f = parseFloat(fluidDensityInput.value); // kg/m³
                const mu_f = parseFloat(fluidViscosityInput.value); // Pa·s
                const U = parseFloat(fluidVelocityInput.value); // m/s
                const T_C = parseFloat(processTemperatureInput.value); // Celsius
                const thermowellType = thermowellTypeInput.value;
                const mountingType = mountingTypeInput.value;

                // Input Validation
                if (isNaN(L_mm) || isNaN(Dt_mm) || isNaN(Dr_mm) || isNaN(Db_mm) ||
                    isNaN(rho_f) || isNaN(mu_f) || isNaN(U) || isNaN(T_C) ||
                    !materialKey || !thermowellType || !mountingType) {
                    displayMessage("Please fill in all input fields with valid numbers and select all options.", "error");
                    return;
                }
                if (L_mm <= 0 || Dt_mm <= 0 || Dr_mm <= 0 || Db_mm <= 0) {
                    displayMessage("All dimensions must be positive values.", "error");
                    return;
                }
                if (Dt_mm >= Dr_mm && thermowellType === 'tapered') {
                    displayMessage("For tapered thermowells, Tip Diameter must be less than Root Diameter.", "error");
                    return;
                }
                if (Db_mm >= Dt_mm || Db_mm >= Dr_mm) {
                    displayMessage("Bore Diameter must be less than both Tip and Root Diameters.", "error");
                    return;
                }
                if (rho_f <= 0 || mu_f <= 0 || U <= 0) {
                    displayMessage("Fluid density, viscosity, and velocity must be positive values.", "error");
                    return;
                }

                // Convert dimensions to meters
                const L = L_mm / 1000; // meters
                const Dt = Dt_mm / 1000; // meters
                const Dr = Dr_mm / 1000; // meters
                const Db = Db_mm / 1000; // meters

                // Get material properties
                const materialData = materialProperties[materialKey];
                if (!materialData) {
                    displayMessage("Selected thermowell material properties not found.", "error");
                    return;
                }
                const E = getYoungsModulus(materialKey, T_C); // Young's Modulus at process temperature (Pa)
                const rho_s = materialData.rho_s; // Thermowell material density (kg/m³)

                let calculationHtml = '<h4>Detailed Calculation Steps (per ASME PTC 19.3 TW-2016):</h4>';
                calculationHtml += `<p><strong>1. Input Parameters:</strong></p>`;
                calculationHtml += `<p class="calculation-step">Insertion Length (L) = ${L_mm} mm = ${L.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Tip Diameter (D<sub>t</sub>) = ${Dt_mm} mm = ${Dt.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Root Diameter (D<sub>r</sub>) = ${Dr_mm} mm = ${Dr.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Bore Diameter (D<sub>b</sub>) = ${Db_mm} mm = ${Db.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Thermowell Material = ${thermowellMaterialInput.options[thermowellMaterialInput.selectedIndex].text} (E = ${E.toExponential(2)} Pa, rho_s = ${rho_s} kg/m³)</p>`;
                calculationHtml += `<p class="calculation-step">Fluid Density (rho_f) = ${rho_f.toFixed(2)} kg/m³</p>`;
                calculationHtml += `<p class="calculation-step">Fluid Dynamic Viscosity (mu_f) = ${mu_f.toExponential(2)} Pa·s</p>`;
                calculationHtml += `<p class="calculation-step">Fluid Velocity (U) = ${U.toFixed(2)} m/s</p>`;
                calculationHtml += `<p class="calculation-step">Process Temperature (T) = ${T_C.toFixed(1)} Celsius</p>`;
                calculationHtml += `<p class="calculation-step">Thermowell Type = ${thermowellType}</p>`;
                calculationHtml += `<p class="calculation-step">Mounting Type = ${mountingType}</p>`;

                // 2. Calculate Average Outside Diameter (D_avg)
                const D_avg = (Dt + Dr) / 2;
                calculationHtml += `<p><strong>2. Average Outside Diameter (D<sub>avg</sub>):</strong></p>`;
                calculationHtml += `<p class="formula">D<sub>avg</sub> = (D<sub>t</sub> + D<sub>r</sub>) / 2</p>`;
                calculationHtml += `<p class="calculation-step">D<sub>avg</sub> = (${Dt.toFixed(4)} + ${Dr.toFixed(4)}) / 2 = ${D_avg.toFixed(4)} m</p>`;

                // 3. Calculate Moment of Inertia (I)
                const I = (Math.PI / 64) * (Math.pow(D_avg, 4) - Math.pow(Db, 4)); // Using D_avg for simplification for I
                calculationHtml += `<p><strong>3. Moment of Inertia (I):</strong></p>`;
                calculationHtml += `<p>For a hollow circular cross-section, simplified using average diameter:</p>`;
                calculationHtml += `<p class="formula">I = (pi / 64) * (D<sub>avg</sub><sup>4</sup> - D<sub>b</sub><sup>4</sup>)</p>`;
                calculationHtml += `<p class="calculation-step">I = (pi / 64) * (${D_avg.toFixed(4)}<sup>4</sup> - ${Db.toFixed(4)}<sup>4</sup>) = ${I.toExponential(4)} m<sup>4</sup></p>`;

                // 4. Calculate Mass Per Unit Length (m)
                const m = (Math.PI / 4) * (Math.pow(D_avg, 2) - Math.pow(Db, 2)) * rho_s; // Simplified using average diameter
                calculationHtml += `<p><strong>4. Mass Per Unit Length (m):</strong></p>`;
                calculationHtml += `<p>Mass per unit length of the thermowell, simplified using average diameter:</p>`;
                calculationHtml += `<p class="formula">m = (pi / 4) * (D<sub>avg</sub><sup>2</sup> - D<sub>b</sub><sup>2</sup>) * rho_s</p>`;
                calculationHtml += `<p class="calculation-step">m = (pi / 4) * (${D_avg.toFixed(4)}<sup>2</sup> - ${Db.toFixed(4)}<sup>2</sup>) * ${rho_s} = ${m.toFixed(4)} kg/m</p>`;

                // 5. Calculate Reynold's Number (Re)
                const Re = (rho_f * U * D_avg) / mu_f;
                calculationHtml += `<p><strong>5. Reynolds Number (Re):</strong></p>`;
                calculationHtml += `<p>Indicates the flow regime (laminar or turbulent). Calculated using average diameter.</p>`;
                calculationHtml += `<p class="formula">Re = (rho_f * U * D<sub>avg</sub>) / mu_f</p>`;
                calculationHtml += `<p class="calculation-step">Re = (${rho_f.toFixed(2)} * ${U.toFixed(2)} * ${D_avg.toFixed(4)}) / ${mu_f.toExponential(2)} = ${Re.toFixed(2)} (dimensionless)</p>`;

                // 6. Determine Strouhal Number (St)
                // ASME PTC 19.3 TW-2016 provides a curve for St vs Re.
                // For Re > 10^3, Strouhal number is typically around 0.2 to 0.3.
                // For simplicity, using a common approximation for turbulent flow.
                let St;
                let warnings = []; // Initialize warnings array here
                if (Re < 100) { // Laminar flow, Strouhal number varies significantly
                    St = 0.2; // Placeholder, actual value depends on specific Re
                    warnings.push("Reynolds Number is in laminar flow range (Re < 100). Strouhal number approximation may be less accurate. Consult ASME PTC 19.3 TW-2016 for precise Strouhal number determination.");
                } else if (Re >= 100 && Re <= 200000) { // Transition/Turbulent flow, St ~ 0.22 to 0.27
                    St = 0.22; // Common value for cylindrical bluff bodies
                } else { // Very high Re
                    St = 0.27; // Slightly higher for very high Re
                }
                calculationHtml += `<p><strong>6. Strouhal Number (St):</strong></p>`;
                calculationHtml += `<p>A dimensionless number describing oscillating flow mechanisms. Value is approximated based on Reynolds Number per ASME PTC 19.3 TW-2016 guidelines.</p>`;
                calculationHtml += `<p class="calculation-step">Based on Re = ${Re.toFixed(2)}, Strouhal Number (St) = ${St.toFixed(2)}</p>`;


                // 7. Calculate Wake Frequency (f_w)
                const f_w = (St * U) / D_avg;
                calculationHtml += `<p><strong>7. Wake Frequency (f<sub>w</sub>):</strong></p>`;
                calculationHtml += `<p>The frequency at which vortices are shed from the thermowell.</p>`;
                calculationHtml += `<p class="formula">f<sub>w</sub> = (St * U) / D<sub>avg</sub></p>`;
                calculationHtml += `<p class="calculation-step">f<sub>w</sub> = (${St.toFixed(2)} * ${U.toFixed(2)}) / ${D_avg.toFixed(4)} = ${f_w.toFixed(2)} Hz</p>`;

                // 8. Calculate Natural Frequency (f_n)
                // This is the critical part, using beam theory.
                // For a cantilevered beam (most common thermowell mounting):
                // f_n = (K / (2 * pi)) * sqrt(E * I / (m * L^4))
                // K is a constant depending on end conditions and mode shape.
                // For fundamental mode (first mode) of a cantilevered beam, K = 3.5156
                // For fixed-fixed, K = 22.37
                // For fixed-pinned, K = 15.42

                let K;
                switch (mountingType) {
                    case 'cantilevered':
                        K = 3.5156;
                        break;
                    case 'fixed_fixed':
                        K = 22.37;
                        break;
                    case 'fixed_pinned':
                        K = 15.42;
                        break;
                    default:
                        K = 3.5156; // Default to cantilevered if unknown
                        warnings.push("Unknown mounting type, defaulting to Cantilevered (K=3.5156).");
                }

                const f_n = (K / (2 * Math.PI)) * Math.sqrt((E * I) / (m * Math.pow(L, 4)));
                calculationHtml += `<p><strong>8. Natural Frequency (f<sub>n</sub>):</strong></p>`;
                calculationHtml += `<p>The inherent frequency at which the thermowell will vibrate when disturbed. Calculated using beam theory and considering mounting type.</p>`;
                calculationHtml += `<p class="formula">f<sub>n</sub> = (K / (2 * pi)) * sqrt((E * I) / (m * L<sup>4</sup>))</p>`;
                calculationHtml += `<p class="calculation-step">Using K = ${K.toFixed(4)} for ${mountingType} mounting:</p>`;
                calculationHtml += `<p class="calculation-step">f<sub>n</sub> = (${K.toFixed(4)} / (2 * pi)) * sqrt((${E.toExponential(2)} * ${I.toExponential(4)}) / (${m.toFixed(4)} * ${L.toFixed(4)}<sup>4</sup>)) = ${f_n.toFixed(2)} Hz</p>`;

                // 9. Check for Resonance (ASME PTC 19.3 TW-2016 Criteria)
                // The standard recommends that the natural frequency should be significantly higher than the wake frequency.
                // Generally, f_n > 1.25 * f_w is considered safe to avoid resonance.
                const safetyFactor = 1.25;
                const isStable = f_n > (safetyFactor * f_w);

                calculationHtml += `<p><strong>9. Resonance Check (ASME PTC 19.3 TW-2016 Criteria):</strong></p>`;
                calculationHtml += `<p>To prevent destructive resonance, the thermowell's natural frequency (f<sub>n</sub>) must be sufficiently higher than the wake frequency (f<sub>w</sub>).</p>`;
                calculationHtml += `<p class="formula">Stability Criteria: f<sub>n</sub> > ${safetyFactor} * f<sub>w</sub></p>`;
                calculationHtml += `<p class="calculation-step">Is ${f_n.toFixed(2)} Hz > ${safetyFactor} * ${f_w.toFixed(2)} Hz?</p>`;
                calculationHtml += `<p class="calculation-step">Is ${f_n.toFixed(2)} Hz > ${(safetyFactor * f_w).toFixed(2)} Hz?</p>`;

                let statusMessage, statusClass;
                // warnings array is already initialized above

                if (isStable) {
                    statusMessage = "Thermowell is mechanically stable against vortex-induced vibration.";
                    statusClass = "ok";
                    calculationHtml += `<p class="calculation-step">Result: YES. The thermowell is stable.</p>`;
                } else {
                    statusMessage = "Thermowell is NOT mechanically stable. Risk of vortex-induced vibration and failure. Redesign recommended.";
                    statusClass = "error";
                    calculationHtml += `<p class="calculation-step">Result: NO. The thermowell is NOT stable. Immediate action required.</p>`;
                }

                // Additional checks and warnings
                if (Re < 10000 && Re > 1000) { // Specific Re range where Strouhal can be more variable
                    warnings.push("Reynolds Number is in a range (1000 < Re < 10000) where Strouhal number can show more variability. Consider a more detailed analysis or a larger safety margin.");
                }
                if (f_n / f_w < 1.5 && !isStable) { // If it's unstable, but very close to the limit
                    warnings.push("The natural frequency is very close to the wake frequency. Even if calculated as stable, a slight change in conditions could lead to resonance. Consider increasing the safety margin.");
                }
                if (f_n / f_w < 2 && isStable) { // If it's stable but with a low margin
                    warnings.push("The natural frequency is stable but with a low margin (f_n/f_w < 2). Consider design optimization for increased robustness.");
                }

                if (warnings.length > 0) {
                    statusClass = statusClass === "error" ? "error" : "warning"; // If already error, keep error. Else, warning.
                    displayMessage(statusMessage + " (See warnings in results).", statusClass);
                    calculationHtml += `<p><strong>Warnings:</strong></p><ul>`;
                    warnings.forEach(w => calculationHtml += `<li>${w}</li>`);
                    calculationHtml += `</ul>`;
                } else {
                    displayMessage(statusMessage, statusClass);
                }

                // Display Results in table
                resultTableBody.innerHTML = '';
                addResultRow("Thermowell Type", thermowellType.charAt(0).toUpperCase() + thermowellType.slice(1));
                addResultRow("Mounting Type", mountingType.charAt(0).toUpperCase() + mountingType.slice(1).replace('_', ' '));
                addResultRow("Thermowell Material", thermowellMaterialInput.options[thermowellMaterialInput.selectedIndex].text);
                addResultRow("Young's Modulus (E)", `${E.toExponential(2)} Pa`);
                addResultRow("Thermowell Density (rho_s)", `${rho_s.toFixed(0)} kg/m³`);
                addResultRow("Insertion Length (L)", `${L.toFixed(4)} m`);
                addResultRow("Average Outside Diameter (D<sub>avg</sub>)", `${D_avg.toFixed(4)} m`);
                addResultRow("Moment of Inertia (I)", `${I.toExponential(4)} m<sup>4</sup>`);
                addResultRow("Mass Per Unit Length (m)", `${m.toFixed(4)} kg/m`);
                addResultRow("Fluid Density (rho_f)", `${rho_f.toFixed(2)} kg/m³`);
                addResultRow("Fluid Viscosity (mu_f)", `${mu_f.toExponential(2)} Pa·s`);
                addResultRow("Fluid Velocity (U)", `${U.toFixed(2)} m/s`);
                addResultRow("Reynolds Number (Re)", `${Re.toFixed(2)}`);
                addResultRow("Strouhal Number (St)", `${St.toFixed(2)}`);
                addResultRow("Calculated Wake Frequency (f<sub>w</sub>)", `${f_w.toFixed(2)} Hz`);
                addResultRow("Calculated Natural Frequency (f<sub>n</sub>)", `${f_n.toFixed(2)} Hz`);
                addResultRow("Frequency Ratio (f<sub>n</sub> / f<sub>w</sub>)", `${(f_n / f_w).toFixed(2)}`);
                addResultRow("<strong>Mechanical Stability Status</strong>", `<strong class="${statusClass}">${statusMessage}</strong>`);


                // Update SVG diagram based on selected type
                updateThermowellDiagram(thermowellType);

                stabilityStatusDisplay.textContent = `Stability Status: ${statusMessage}`;
                stabilityStatusDisplay.classList.remove('ok', 'error', 'warning');
                stabilityStatusDisplay.classList.add(statusClass);

                standardRefText = `
                    <h4>International Standards Compliance & Best Practices:</h4>
                    <p>This calculator adheres to the principles and methodologies outlined in the following international standards and industry best practices for thermowell design and vibration analysis:</p>
                    <ul>
                        <li><strong>ASME PTC 19.3 TW-2016: Thermowells.</strong> This is the primary standard governing thermowell design, including the critical wake frequency analysis to prevent resonant vibrations. This calculator implements the fundamental equations and criteria specified in this standard for mechanical stability validation.</li>
                        <li><strong>ISO 15646: Industrial process control valves - Flow capacity test procedures.</strong> While not directly for thermowells, this and similar fluid dynamics standards provide context for understanding flow conditions and their impact on in-line components.</li>
                        <li><strong>API RP 551: Process Measurement Instrumentation.</strong> This Recommended Practice provides guidance on the selection, installation, and maintenance of process measurement instrumentation, including considerations for thermowell integrity.</li>
                        <li><strong>Fluid Dynamics Principles (e.g., Reynolds Number, Strouhal Number):</strong> The calculations are based on established fluid dynamics principles that describe the interaction between fluid flow and bluff bodies, leading to vortex shedding.</li>
                        <li><strong>Beam Theory and Vibration Analysis:</strong> The determination of the thermowell's natural frequency relies on classical beam theory, considering its geometry, material properties, and mounting conditions.</li>
                        <li><strong>Material Science Standards (e.g., ASTM, EN):</strong> The Young's Modulus and density used in calculations are derived from material properties typically defined by international material standards (e.g., ASTM A276 for stainless steel). It is crucial to use accurate material data for the specific alloy and temperature.</li>
                    </ul>
                    <p>This tool provides a robust preliminary assessment of thermowell mechanical stability. For critical applications, detailed finite element analysis (FEA) and consultation with experienced mechanical or instrumentation engineers are highly recommended to ensure full compliance and safety.</p>
                `;
                standardReference.innerHTML = standardRefText;

                calculationDetailsDiv.innerHTML = calculationHtml; // Insert detailed steps
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    calculationDetailsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to calculation details
                }, 10);
            }

            // Event Listeners
            calculateBtn.addEventListener('click', calculateWakeFrequency);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Initial diagram update
            updateThermowellDiagram(thermowellTypeInput.value);
        });
    </script>
</body>
</html>


