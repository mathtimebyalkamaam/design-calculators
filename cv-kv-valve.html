<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-23Y1V450SR');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cv/Kv Valve Flow Coefficient Calculator - Design Calculators - Mechanical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        /* Basic CSS Variables for a consistent theme (adapted from provided file) */
        :root {
            --primary-color: #2196F3; /* Blue */
            --secondary-color: #1976D2; /* Darker Blue */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); /* More pronounced shadow */
            --hover-color: #e2e6ea;
        }

        /* Dark Mode Variables (adapted from provided file) */
        body.dark-mode {
            --primary-color: #5DADE2; /* New primary blue for dark mode */
            --secondary-color: #2874A6; /* New darker blue for dark mode */
            --bg-color: #252D3A; /* Very dark blue-grey */
            --card-bg: #2F3C4C; /* Slightly lighter dark blue-grey */
            --text-color: #E0E6EB; /* Soft off-white */
            --header-bg: #252D3A; /* Darker header */
            --footer-bg: #252D3A; /* Darker footer */
            --border-color: #4C5C70; /* Medium dark grey-blue */
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #3A475C; /* Darker hover for dark mode */
        }

        /* General Body Styling (adapted from provided file) */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, var(--bg-color) 0%, rgba(244, 247, 246, 0.8) 100%); /* Subtle gradient */
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s, background-image 0.3s;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0; /* Increased padding */
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
        }

        header h1 {
            margin: 0;
            font-size: 2.8em; /* Slightly larger */
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2); /* Subtle text shadow */
        }

        header .subtitle {
            margin: 8px 0 0; /* Adjusted margin */
            font-size: 1.1em; /* Slightly larger */
            color: #bdc3c7;
        }

        main {
            padding: 30px 0; /* Increased padding */
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px; /* More rounded corners */
            padding: 30px; /* Increased padding */
            box-shadow: var(--card-shadow);
            margin-bottom: 25px; /* Adjusted margin */
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px); /* Lift effect on hover */
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px; /* Adjusted padding */
            margin-top: 0;
            margin-bottom: 25px; /* Adjusted margin */
            font-size: 2em; /* Slightly larger */
        }

        .tool-description {
            margin-bottom: 25px; /* Adjusted margin */
            color: var(--text-color);
            font-size: 1.05em; /* Slightly larger font */
        }

        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px; /* Adjusted margin */
            padding-left: 0;
            margin-top: 15px; /* Adjusted margin */
        }

        .tool-description ul li {
            margin-bottom: 8px; /* Adjusted margin */
        }

        .tool-description strong {
            color: var(--primary-color);
        }

        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px; /* Adjusted padding */
            border-radius: 8px; /* More rounded corners */
            text-decoration: none;
            margin-bottom: 25px; /* Adjusted margin */
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            font-weight: bold;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.03); /* Slightly increased scale transform */
        }

        /* Theme Toggle (adapted from provided file) */
        .theme-toggle {
            position: absolute;
            top: 25px; /* Adjusted position */
            right: 25px; /* Adjusted position */
            display: flex;
            align-items: center;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px; /* Increased margin */
            font-size: 1.3em; /* Slightly larger icons */
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 65px; /* Slightly wider */
            height: 38px; /* Slightly taller */
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 30px; /* Slightly larger */
            width: 30px; /* Slightly larger */
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(27px); /* Adjusted for wider slider */
            transform: translateX(27px); /* Adjusted for wider slider */
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 38px; /* Adjusted for taller slider */
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Footer Styling (adapted from provided file) */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0; /* Increased padding */
            text-align: center;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            margin-top: 40px; /* Increased margin */
        }

        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px; /* Adjusted margin */
            font-size: 1.3em; /* Slightly larger */
        }

        footer .disclaimer p {
            font-size: 0.95em; /* Slightly larger font */
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 20px; /* Adjusted margin */
            display: flex;
            justify-content: center;
            gap: 15px; /* Increased gap */
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px; /* Slightly larger */
            height: 45px; /* Slightly larger */
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em; /* Slightly larger icon */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Added box-shadow transition */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .social-btn:hover {
            transform: translateY(-5px) scale(1.1); /* More pronounced hover effect */
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #7f8c8d; } /* Grey for email */

        /* Styles for Calculator Forms and Results (adapted from provided file) */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px; /* More rounded corners */
            padding: 30px; /* Increased padding */
            margin-top: 25px; /* Adjusted margin */
            box-shadow: var(--card-shadow);
        }
        
        .form-group {
            margin-bottom: 20px; /* Increased margin */
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px; /* Adjusted margin */
            font-weight: bold;
            font-size: 1.05em; /* Slightly larger font */
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px; /* Increased padding */
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded corners */
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08); /* Subtle inset shadow */
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb, 33, 150, 243), 0.3); /* Ring focus effect */
            outline: none;
        }
        /* Define primary color RGB for focus effect */
        :root {
            --primary-color-rgb: 33, 150, 243; /* For #2196F3 */
        }
        body.dark-mode {
            --primary-color-rgb: 93, 173, 226; /* For #5DADE2 */
        }

        .form-row {
            display: flex;
            gap: 20px; /* Increased gap */
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1 1 calc(50% - 10px); /* Adjusted for flex-wrap and gap */
            min-width: 280px; /* Ensure inputs don't get too small */
        }
        @media (max-width: 600px) {
            .form-row .form-group {
                flex: 1 1 100%; /* Stack on small screens */
            }
        }

        .calculate-btn {
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color)); /* Gradient button */
            color: white;
            border: none;
            padding: 14px 25px; /* Increased padding */
            border-radius: 8px; /* More rounded corners */
            cursor: pointer;
            font-size: 17px; /* Slightly larger font */
            font-weight: bold;
            margin-top: 20px; /* Adjusted margin */
            transition: background-image 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Shadow for button */
        }
        
        .calculate-btn:hover {
            background-image: linear-gradient(to right, var(--secondary-color), var(--primary-color)); /* Reverse gradient on hover */
            transform: translateY(-3px) scale(1.02); /* Lift and scale effect */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .result-container {
            margin-top: 40px; /* Adjusted margin */
            padding: 30px; /* Increased padding */
            border-radius: 12px; /* More rounded corners */
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: block; /* Changed to block for initial display */
            opacity: 0;
            transition: opacity 0.6s ease-out;
            pointer-events: none; /* Disable interaction until shown */
        }
        
        .result-container.show {
            opacity: 1;
            pointer-events: auto; /* Enable interaction when shown */
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px; /* Adjusted margin */
            font-size: 1.8em; /* Slightly larger */
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px; /* Adjusted margin */
        }
        
        .result-table th, .result-table td {
            padding: 15px; /* Increased padding */
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            font-size: 1.1em;
        }
        .result-table tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }

        .standard-reference {
            margin-top: 25px; /* Adjusted margin */
            font-style: italic;
            font-size: 0.95rem; /* Slightly larger font */
            line-height: 1.5;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 8px; /* Adjusted margin */
            cursor: help;
            font-size: 1em;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px; /* Slightly wider */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px; /* More rounded */
            padding: 8px; /* Adjusted padding */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px; /* Adjusted for wider tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em; /* Smaller font for tooltip */
        }
        .tooltip .tooltiptext::after { /* Tooltip arrow */
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Custom message box style (adapted from provided file) */
        #custom-message-box {
            position: fixed;
            top: 30px; /* Adjusted position */
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px; /* Increased padding */
            border-radius: 10px; /* More rounded */
            box-shadow: 0 6px 15px rgba(0,0,0,0.3); /* More pronounced shadow */
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            font-size: 1.1em;
        }

        /* Styles for calculation details (adapted from provided file) */
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; /* More rounded */
            padding: 20px; /* Increased padding */
            margin-bottom: 25px; /* Adjusted margin */
            font-size: 0.98em; /* Slightly larger font */
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px; /* Adjusted margin */
            font-size: 1.3em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em; /* Slightly larger formula font */
            text-align: center;
            padding: 12px 0; /* Adjusted padding */
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0; /* Adjusted margin */
            overflow-x: auto;
            border: 1px dashed var(--border-color); /* Dashed border for formulas */
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px; /* Adjusted padding */
            border-radius: 5px;
            margin-bottom: 8px; /* Adjusted margin */
            font-size: 0.95em;
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px; /* Adjusted margin */
            padding-left: 0;
        }
        #calculation-details ul li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Mechanical</h1>
            <p class="subtitle">Smart Tools for Modern Mechanical Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <a href="indexMech.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Tools
        </a>
        
        <div class="tool-container">
            <h2>Cv/Kv Valve Flow Coefficient Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator determines either the **Flow Coefficient (Cv or Kv)** for a control valve or the **Flow Rate (Q)** through a valve, based on given parameters. Valve flow coefficients are essential for proper valve sizing and selection in various industrial applications, ensuring efficient and controlled fluid flow.</p>
                <p>It supports calculations for both **Imperial (Cv)** and **Metric (Kv)** units for liquid flow.</p>
                <ul>
                    <li>**Cv (Flow Coefficient - Imperial):** Defined as the flow rate of water in US gallons per minute (GPM) at 60°F that will cause a pressure drop of 1 psi across the valve.</li>
                    <li>**Kv (Flow Coefficient - Metric):** Defined as the flow rate of water in cubic meters per hour (m³/h) at 20°C that will cause a pressure drop of 1 bar across the valve.</li>
                </ul>
            </div>
        
            <div class="calculator-form">
                <form id="cv-kv-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="calculation-type">Calculate: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Choose whether to calculate the valve coefficient (Cv/Kv) or the flow rate.</span></span></label>
                            <select id="calculation-type" required>
                                <option value="cv_kv">Cv/Kv (Valve Sizing)</option>
                                <option value="flow_rate">Flow Rate (Q)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Imperial (for Cv) or Metric (for Kv) units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="imperial">Imperial (Cv, GPM, psi)</option>
                                <option value="metric">Metric (Kv, m³/h, bar)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fluid-type">Fluid Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the type of fluid. Its density and viscosity will be used in calculations (mainly for specific gravity).</span></span></label>
                            <select id="fluid-type" required>
                                <option value="water">Water</option>
                                <option value="oil">Engine Oil (SAE 30)</option>
                                <option value="gas">Ideal Gas (Air @ 20°C)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fluid-temperature">Fluid Temperature (&#8451;) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the fluid's operating temperature. This affects its density and specific gravity.</span></span></label>
                            <input type="number" id="fluid-temperature" step="0.1" value="20" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="inlet-pressure">Inlet Pressure (P<sub>1</sub>) <span class="unit-label">(psi)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Absolute pressure upstream of the valve.</span></span></label>
                            <input type="number" id="inlet-pressure" min="0" step="0.1" value="50" required>
                        </div>
                        <div class="form-group">
                            <label for="outlet-pressure">Outlet Pressure (P<sub>2</sub>) <span class="unit-label">(psi)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Absolute pressure downstream of the valve. Must be less than Inlet Pressure.</span></span></label>
                            <input type="number" id="outlet-pressure" min="0" step="0.1" value="40" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" id="flow-rate-group">
                            <label for="flow-rate">Flow Rate (Q) <span class="flow-unit-label">(GPM)</span> <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The volumetric flow rate through the valve.</span></span></label>
                            <input type="number" id="flow-rate" min="0.001" step="0.001" value="100" required>
                        </div>
                        <div class="form-group" id="valve-coefficient-group" style="display: none;">
                            <label for="valve-coefficient">Valve Coefficient (<span class="cv-kv-label">Cv</span>) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The flow coefficient of the valve (Cv or Kv).</span></span></label>
                            <input type="number" id="valve-coefficient" min="0.001" step="0.001" value="5" required>
                        </div>
                    </div>

                    <button type="button" id="calculate-cv-kv-btn" class="calculate-btn">Calculate</button>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div id="calculation-details">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Mechanical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Mechanical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="mailto:?subject=Check out Design Calculators - Mechanical!&body=I found this amazing Cv/Kv Valve Flow Coefficient Calculator and other mechanical tools: https://designcalculators.co.in" class="social-btn email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-cv-kv-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            const calculationTypeSelect = document.getElementById('calculation-type');
            const unitSystemSelect = document.getElementById('unit-system');
            const fluidTypeSelect = document.getElementById('fluid-type');
            const fluidTemperatureInput = document.getElementById('fluid-temperature');
            const inletPressureInput = document.getElementById('inlet-pressure');
            const outletPressureInput = document.getElementById('outlet-pressure');

            const flowRateGroup = document.getElementById('flow-rate-group');
            const flowRateInput = document.getElementById('flow-rate');
            const flowUnitLabel = document.querySelector('.flow-unit-label');

            const valveCoefficientGroup = document.getElementById('valve-coefficient-group');
            const valveCoefficientInput = document.getElementById('valve-coefficient');
            const cvKvLabel = document.querySelector('.cv-kv-label');
            const pressureUnitLabels = document.querySelectorAll('.unit-label');


            // Data for fluid properties (density in kg/m3, viscosity in Pa·s)
            // Water density is 1000 kg/m3 at 4°C, used as reference for Specific Gravity.
            const fluidPropertiesData = {
                'water': {
                    density: { value: 998, unit: 'kg/m3' }, // Approx at 20°C
                    viscosity: [ // [temperature, viscosity] pairs
                        [0, 0.00179], [10, 0.001307], [20, 0.001002], [30, 0.000797],
                        [40, 0.000653], [50, 0.000547], [60, 0.000467], [70, 0.000404],
                        [80, 0.000355], [90, 0.000316], [100, 0.000282]
                    ]
                },
                'oil': { // Engine Oil (SAE 30). Highly temperature dependent, simplified.
                    density: { value: 880, unit: 'kg/m3' },
                    viscosity: [ 
                        [20, 0.29] // At 20°C
                    ]
                },
                'gas': { // Ideal Gas (approximated as Air at 20°C, 1 atm)
                    density: { value: 1.204, unit: 'kg/m3' }, // at 20°C, 1 atm
                    viscosity: [
                        [0, 0.0000171], [10, 0.0000176], [20, 0.00001825], [30, 0.0000187],
                        [40, 0.0000193], [50, 0.0000198], [60, 0.0000203], [70, 0.0000208],
                        [80, 0.0000213], [90, 0.0000218], [100, 0.0000223]
                    ]
                }
            };

            const WATER_DENSITY_REF = 1000; // kg/m3 at 4°C for specific gravity reference

            // Function to linearly interpolate viscosity based on temperature
            function interpolateViscosity(fluidType, temperature) {
                const data = fluidPropertiesData[fluidType].viscosity;
                if (!data) return null; // No viscosity data for this fluid type

                if (data.length === 1) { // Only one data point, return it directly
                    return data[0][1];
                }

                // Ensure temperature is within the range of the data points
                if (temperature <= data[0][0]) {
                    return data[0][1];
                }
                if (temperature >= data[data.length - 1][0]) {
                    return data[data.length - 1][1];
                }

                for (let i = 0; i < data.length - 1; i++) {
                    const temp1 = data[i][0];
                    const visc1 = data[i][1];
                    const temp2 = data[i + 1][0];
                    const visc2 = data[i + 1][1];

                    if (temperature >= temp1 && temperature <= temp2) {
                        return visc1 + (visc2 - visc1) * (temperature - temp1) / (temp2 - temp1);
                    }
                }
                return data[0][1]; // Fallback, should ideally not be reached
            }

            // Function to get fluid density (simplified, assuming temperature effect is secondary for density vs. viscosity)
            function getFluidDensity(fluidType) {
                return fluidPropertiesData[fluidType].density.value;
            }

            // Function to display custom messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545'; /* Red */
                    messageBox.style.color = 'white';
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107'; /* Amber */
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745'; /* Green */
                    messageBox.style.color = 'white';
                }
                messageBox.style.opacity = 1;

                // Hide after 5 seconds
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            // Function to update input visibility and labels based on calculation type and unit system
            function updateUI() {
                const calcType = calculationTypeSelect.value;
                const unitSystem = unitSystemSelect.value;

                // Update labels for pressure and flow rate
                if (unitSystem === 'imperial') {
                    pressureUnitLabels.forEach(label => label.textContent = '(psi)');
                    flowUnitLabel.textContent = '(GPM)';
                    cvKvLabel.textContent = 'Cv';
                } else { // metric
                    pressureUnitLabels.forEach(label => label.textContent = '(bar)');
                    flowUnitLabel.textContent = '(m³/h)';
                    cvKvLabel.textContent = 'Kv';
                }

                // Toggle visibility of flow rate or valve coefficient input
                if (calcType === 'cv_kv') {
                    flowRateGroup.style.display = 'block';
                    valveCoefficientGroup.style.display = 'none';
                    flowRateInput.setAttribute('required', 'true');
                    valveCoefficientInput.removeAttribute('required');
                } else { // flow_rate
                    flowRateGroup.style.display = 'none';
                    valveCoefficientGroup.style.display = 'block';
                    flowRateInput.removeAttribute('required');
                    valveCoefficientInput.setAttribute('required', 'true');
                }
            }

            // Event listeners for UI updates
            calculationTypeSelect.addEventListener('change', updateUI);
            unitSystemSelect.addEventListener('change', updateUI);

            // Initial UI setup
            updateUI();


            calculateBtn.addEventListener('click', function() {
                const calcType = calculationTypeSelect.value;
                const unitSystem = unitSystemSelect.value;
                const fluidType = fluidTypeSelect.value;
                const fluidTemperature = parseFloat(fluidTemperatureInput.value);
                let P1 = parseFloat(inletPressureInput.value);
                let P2 = parseFloat(outletPressureInput.value);
                let Q_input; // Flow rate input (GPM or m³/h)
                let CvKv_input; // Cv or Kv input

                if (calcType === 'cv_kv') {
                    Q_input = parseFloat(flowRateInput.value);
                } else {
                    CvKv_input = parseFloat(valveCoefficientInput.value);
                }

                // Input validation
                if (isNaN(fluidTemperature) || isNaN(P1) || isNaN(P2) || P1 <= 0 || P2 <= 0) {
                    displayMessage("Please enter valid positive numbers for Fluid Temperature, Inlet Pressure, and Outlet Pressure.", "error");
                    return;
                }
                if (calcType === 'cv_kv' && (isNaN(Q_input) || Q_input <= 0)) {
                    displayMessage("Please enter a valid positive number for Flow Rate.", "error");
                    return;
                }
                if (calcType === 'flow_rate' && (isNaN(CvKv_input) || CvKv_input <= 0)) {
                    displayMessage("Please enter a valid positive number for Valve Coefficient (Cv/Kv).", "error");
                    return;
                }
                if (P2 >= P1) {
                    displayMessage("Outlet Pressure (P<sub>2</sub>) must be less than Inlet Pressure (P<sub>1</sub>).", "error");
                    return;
                }

                const deltaP = P1 - P2; // Pressure drop

                // Get fluid properties
                const fluidDensity = getFluidDensity(fluidType);
                const fluidViscosity = interpolateViscosity(fluidType, fluidTemperature); // Not directly used for Cv/Kv but good for info

                // Calculate Specific Gravity (SG)
                // SG of water is 1.0. For other fluids, density relative to water at 4°C
                let specificGravity;
                if (fluidType === 'water') {
                    specificGravity = 1.0;
                } else if (fluidType === 'oil') {
                    specificGravity = fluidDensity / WATER_DENSITY_REF; // Assuming WATER_DENSITY_REF is 1000 kg/m3
                } else if (fluidType === 'gas') {
                    displayMessage("Gas calculations for Cv/Kv are more complex due to compressibility and require additional factors (e.g., critical flow, absolute temperature). This calculator is simplified for liquids. Results for gas may be approximate.", "warning");
                    // For simplified gas calculation, typically use reference conditions.
                    // For an ideal gas: SG_gas = (Molecular Weight_gas / Molecular Weight_air) or based on relative density.
                    // For now, will use 1.0 for simplified placeholder to allow calculation.
                    specificGravity = 1.0; // Placeholder for simplified gas, actual calculation would be different.
                }

                let calculatedCvKv;
                let calculatedFlowRate;
                let unitSymbol; // 'Cv' or 'Kv'
                let flowUnitSymbol; // 'GPM' or 'm³/h'
                let pressureUnitSymbol; // 'psi' or 'bar'

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>1. Input Parameters and Fluid Properties:</strong></p>`;
                calculationHtml += `<ul>
                    <li>Calculation Type: ${calcType === 'cv_kv' ? 'Calculate Cv/Kv' : 'Calculate Flow Rate'}</li>
                    <li>Unit System: ${unitSystem === 'imperial' ? 'Imperial' : 'Metric'}</li>
                    <li>Fluid Type: ${fluidType.charAt(0).toUpperCase() + fluidType.slice(1)}</li>
                    <li>Fluid Temperature: ${fluidTemperature}&#8451;</li>
                    <li>Inlet Pressure ($P_1$): ${P1} ${unitSystem === 'imperial' ? 'psi' : 'bar'}</li>
                    <li>Outlet Pressure ($P_2$): ${P2} ${unitSystem === 'imperial' ? 'psi' : 'bar'}</li>
                    <li>Pressure Drop ($\Delta P = P_1 - P_2$): ${deltaP.toFixed(2)} ${unitSystem === 'imperial' ? 'psi' : 'bar'}</li>
                    <li>Fluid Density ($\\rho$): ${fluidDensity.toFixed(2)} kg/m<sup>3</sup></li>
                    <li>Specific Gravity (SG): ${specificGravity.toFixed(3)} (Relative to water at 4°C)</li>
                </ul>`;

                if (unitSystem === 'imperial') {
                    unitSymbol = 'Cv';
                    flowUnitSymbol = 'GPM';
                    pressureUnitSymbol = 'psi';

                    if (calcType === 'cv_kv') {
                        // Calculate Cv: Q * sqrt(SG / dP)
                        calculatedCvKv = Q_input * Math.sqrt(specificGravity / deltaP);
                        calculationHtml += `<p><strong>2. Calculate Cv (Imperial Units):</strong></p>`;
                        calculationHtml += `<p>The formula for Cv is:</p>`;
                        calculationHtml += `<p class="formula">$$Cv = Q \\sqrt{\\frac{SG}{\\Delta P}}$$</p>`;
                        calculationHtml += `<p class="calculation-step">
                            Cv = ${Q_input} ${flowUnitSymbol} &#x00D7; $$ \\sqrt{\\frac{${specificGravity.toFixed(3)}}{${deltaP.toFixed(2)} \\text{ ${pressureUnitSymbol}}}} $$ = ${calculatedCvKv.toFixed(3)} ${unitSymbol}
                        </p>`;
                    } else { // Calculate Flow Rate (Q_GPM)
                        // Q = Cv * sqrt(dP / SG)
                        calculatedFlowRate = CvKv_input * Math.sqrt(deltaP / specificGravity);
                        calculationHtml += `<p><strong>2. Calculate Flow Rate (Q) in Imperial Units:</strong></p>`;
                        calculationHtml += `<p>The formula for Flow Rate (Q) is:</p>`;
                        calculationHtml += `<p class="formula">$$Q = Cv \\sqrt{\\frac{\\Delta P}{SG}}$$</p>`;
                        calculationHtml += `<p class="calculation-step">
                            Q = ${CvKv_input} ${unitSymbol} &#x00D7; $$ \\sqrt{\\frac{${deltaP.toFixed(2)} \\text{ ${pressureUnitSymbol}}}{${specificGravity.toFixed(3)}}} $$ = ${calculatedFlowRate.toFixed(3)} ${flowUnitSymbol}
                        </p>`;
                    }
                } else { // metric
                    unitSymbol = 'Kv';
                    flowUnitSymbol = 'm³/h';
                    pressureUnitSymbol = 'bar';
                    
                    // Convert pressure from bar to psi for consistency with SG if needed, though formula directly uses bar
                    // Kv formula uses bar directly, so no conversion needed for pressure in formula calculation.
                    
                    if (calcType === 'cv_kv') {
                        // Calculate Kv: Q * sqrt(SG / dP)
                        calculatedCvKv = Q_input * Math.sqrt(specificGravity / deltaP);
                        calculationHtml += `<p><strong>2. Calculate Kv (Metric Units):</strong></p>`;
                        calculationHtml += `<p>The formula for Kv is:</p>`;
                        calculationHtml += `<p class="formula">$$Kv = Q \\sqrt{\\frac{SG}{\\Delta P}}$$</p>`;
                        calculationHtml += `<p class="calculation-step">
                            Kv = ${Q_input} ${flowUnitSymbol} &#x00D7; $$ \\sqrt{\\frac{${specificGravity.toFixed(3)}}{${deltaP.toFixed(2)} \\text{ ${pressureUnitSymbol}}}} $$ = ${calculatedCvKv.toFixed(3)} ${unitSymbol}
                        </p>`;
                    } else { // Calculate Flow Rate (Q_m3h)
                        // Q = Kv * sqrt(dP / SG)
                        calculatedFlowRate = CvKv_input * Math.sqrt(deltaP / specificGravity);
                        calculationHtml += `<p><strong>2. Calculate Flow Rate (Q) in Metric Units:</strong></p>`;
                        calculationHtml += `<p class="formula">$$Q = Kv \\sqrt{\\frac{\\Delta P}{SG}}$$</p>`;
                        calculationHtml += `<p class="calculation-step">
                            Q = ${CvKv_input} ${unitSymbol} &#x00D7; $$ \\sqrt{\\frac{${deltaP.toFixed(2)} \\text{ ${pressureUnitSymbol}}}{${specificGravity.toFixed(3)}}} $$ = ${calculatedFlowRate.toFixed(3)} ${flowUnitSymbol}
                        </p>`;
                    }
                }
                
                calculationDetailsDiv.innerHTML = calculationHtml;
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv]);
                }

                // Display summarized results in the table
                resultTableBody.innerHTML = '';
                
                function addResultRow(parameterHtml, valueHtml) { // Changed parameter to parameterHtml
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.innerHTML = parameterHtml; // Use innerHTML for parameter
                    valueCell.innerHTML = valueHtml;
                }

                addResultRow("Calculation Type", calcType === 'cv_kv' ? 'Calculate Cv/Kv' : 'Calculate Flow Rate');
                addResultRow("Unit System", unitSystem === 'imperial' ? 'Imperial (Cv)' : 'Metric (Kv)');
                addResultRow("Fluid Type", fluidType.charAt(0).toUpperCase() + fluidType.slice(1));
                addResultRow("Fluid Temperature", `${fluidTemperature}°C`);
                addResultRow("Fluid Density ($\rho$)", `${fluidDensity.toFixed(3)} kg/m³`); // Changed to include $
                addResultRow("Fluid Specific Gravity (SG)", `${specificGravity.toFixed(3)}`);
                addResultRow("Inlet Pressure ($P_1$)", `${P1} ${pressureUnitSymbol}`); // Changed to include $
                addResultRow("Outlet Pressure ($P_2$)", `${P2} ${pressureUnitSymbol}`); // Changed to include $
                addResultRow("Pressure Drop ($\\Delta P$)", `${deltaP.toFixed(2)} ${pressureUnitSymbol}`); // Changed to include $

                if (calcType === 'cv_kv') {
                    addResultRow(`Flow Rate (Q)`, `${Q_input} ${flowUnitSymbol}`);
                    addResultRow(`Calculated Valve Coefficient (${unitSymbol})`, `<strong>${calculatedCvKv.toFixed(3)} ${unitSymbol}</strong>`);
                    addResultRow(`Equivalent ${unitSystem === 'imperial' ? 'Kv' : 'Cv'}`, `<em>${unitSystem === 'imperial' ? (calculatedCvKv * 0.865).toFixed(3) + ' Kv' : (calculatedCvKv * 1.156).toFixed(3) + ' Cv'}</em>`);

                } else {
                    addResultRow(`Valve Coefficient (${unitSymbol})`, `${CvKv_input} ${unitSymbol}`);
                    addResultRow(`Calculated Flow Rate (Q)`, `<strong>${calculatedFlowRate.toFixed(3)} ${flowUnitSymbol}</strong>`);
                }


                // After populating the table, typeset it with MathJax
                if (window.MathJax) {
                    window.MathJax.typesetPromise([resultTableBody]);
                }

                standardReference.innerHTML = "Valve flow coefficient calculations are based on fundamental fluid mechanics principles and empirical relations. For accurate industrial valve sizing, refer to international standards such as **ISA (International Society of Automation) S75.01-1985 (R1995) 'Flow Equations for Sizing Control Valves'** or **IEC 60534-2-1 'Industrial-process control valves - Part 2-1: Flow capacity - Sizing equations for fluid flow under installed conditions'**. This calculator provides simplified results for liquids; gas flow calculations are more complex due to compressibility and require advanced equations and factors.";
                
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10); 
                
                resultContainer.scrollIntoView({ behavior: 'smooth' });
                displayMessage("Calculation completed successfully!", "info");
            });

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>