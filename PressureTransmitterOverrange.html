<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pressure Transmitter Overrange & Surge Calculator - Industrial Grade</title>
    <meta name="description" content="Professional Pressure Transmitter Protection Calculator. Calculate Water Hammer surge, verify Proof/Burst pressure limits, and assess overrange suitability for safety. Features Critical Time analysis.">
    <meta name="keywords" content="pressure transmitter, overrange protection, water hammer calculator, joukowsky equation, proof pressure, burst pressure, pressure surge, instrumentation safety, valve closure time">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial - Matches Symmetrical Components) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus { 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
        }
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Quick Load Buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }
        .results-table tr:nth-child(even) { background-color: var(--bg); }
        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }
        .highlight { color: var(--success); font-weight: 700; }
        .danger-text { color: var(--danger); font-weight: 700; }

        /* Canvas Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Educational Section Styling */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .insight-card h4 {
            color: var(--secondary);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        .insight-card p, .insight-card ul {
            margin: 10px 0;
            line-height: 1.8;
            color: var(--text);
        }
        .insight-card ul { padding-left: 20px; }
        .insight-card li { margin-bottom: 8px; }

        /* Formulas & Steps */
        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }
        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(0,0,0,0.03);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid var(--success);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        body.dark-mode .calculation-step { background-color: rgba(255,255,255,0.05); }

        /* Vector Input Group Styling (Reused) */
        .vector-input-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Print Styling */
        @media print {
            header, footer, .education-section, .theme-toggle, .button-wrapper, .preset-container { display: none !important; }
            .card { border: none; shadow: none; padding: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .chart-container { height: 300px; page-break-inside: avoid; }
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 5px; cursor: help; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-tachometer-alt"></i> Pressure Transmitter Overrange Protection Check</h2>
            
            <div class="tool-description">
                <p>This industrial-grade tool verifies the suitability of a pressure transmitter against potentially destructive process conditions. It calculates the theoretical <strong>Maximum Surge Pressure (Water Hammer)</strong> using the Joukowsky equation, considering valve closure time, and checks it against the instrument's <strong>Proof Pressure</strong> (Calibration Limit) and <strong>Burst Pressure</strong> (Containment Limit) to prevent diaphragm rupture.</p>
            </div>

            <div class="calculator-form">
                <form id="pressure-form">
                    <!-- Controls Row -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group">
                            <label>Quick Load Scenarios:</label>
                            <div class="preset-container" style="margin-bottom: 0;">
                                <button type="button" class="preset-btn" onclick="loadPreset('standard_water')"><i class="fas fa-water"></i> Water Line (Safe)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('fast_close')"><i class="fas fa-bolt"></i> Fast Valve (Surge)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('slow_close')"><i class="fas fa-hourglass-half"></i> Slow Valve (Safe)</button>
                            </div>
                        </div>
                    </div>

                    <!-- Transmitter Specs -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px;">1. Transmitter Specifications</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-microchip"></i> Instrument Limits</div>
                            <div class="form-group">
                                <label for="url">Upper Range Limit (URL) [bar] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum range the sensor is designed to measure. e.g. 100 bar.</span></span></label>
                                <input type="number" id="url" value="100" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="proof">Proof Pressure [bar] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Max pressure before calibration shift occurs. Usually 1.5x to 2x URL.</span></span></label>
                                <input type="number" id="proof" value="150" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="burst">Burst Pressure [bar] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Pressure where process containment is lost (rupture). Typically > 5x URL.</span></span></label>
                                <input type="number" id="burst" value="400" step="1">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-sliders-h"></i> Configuration</div>
                            <div class="form-group">
                                <label for="calibrated-span">Calibrated Span [bar] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The actual 20mA point configured. e.g. 0-60 bar.</span></span></label>
                                <input type="number" id="calibrated-span" value="60" step="1">
                            </div>
                        </div>
                    </div>

                    <!-- Process Conditions -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 20px;">2. Process & Surge Dynamics</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-tachometer-alt"></i> Operating Point</div>
                            <div class="form-group">
                                <label for="op-pressure">Operating Pressure ($P_{op}$) [bar]</label>
                                <input type="number" id="op-pressure" value="40" step="1">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-water"></i> Fluid Properties</div>
                            <div class="form-group">
                                <label for="density">Fluid Density ($\rho$) [kg/m³]</label>
                                <input type="number" id="density" value="1000" step="10">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="sound-speed">Speed of Sound ($c$) [m/s] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Speed of pressure wave. Water ~1480 m/s. Oil ~1300 m/s.</span></span></label>
                                <input type="number" id="sound-speed" value="1480" step="10">
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-wind"></i> Flow Dynamics</div>
                            <div class="form-group">
                                <label for="velocity">Flow Velocity Change ($\Delta v$) [m/s] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Sudden change in velocity due to valve closure.</span></span></label>
                                <input type="number" id="velocity" value="2.0" step="0.1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="pipe-length">Pipe Length ($L$) [m] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Distance from valve to reservoir/source. Used to calculate Critical Period.</span></span></label>
                                <input type="number" id="pipe-length" value="100" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="close-time">Valve Closure Time ($t_c$) [s] <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Time to fully close. 0 = Instantaneous.</span></span></label>
                                <input type="number" id="close-time" value="0.1" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Surge Risk</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Safety Analysis</h3>
                
                <div class="results-grid">
                    <!-- Left Col: Table -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Pressure Assessment</h4>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Limit Check</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; background: var(--bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                            <strong><i class="fas fa-shield-alt"></i> Safety Status:</strong>
                            <div id="interpretation-text" style="margin-top: 5px; font-size: 0.95rem;"></div>
                        </div>
                    </div>

                    <!-- Right Col: Visual Chart -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Safety Margin Visualization</h4>
                        <div class="chart-container">
                            <canvas id="pressureChart"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text);">
                            <span style="color: #10B981;">■ Operating</span> &nbsp;
                            <span style="color: #EF4444;">■ Surge Spike</span> &nbsp;
                            <span style="color: #3B82F6; border-bottom: 2px dashed #3B82F6;">-- Proof Limit</span>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Step-by-Step Engineering Calculation</h4>
                <div id="calculation-details">
                    <!-- Dynamic math steps -->
                </div>

                <div class="standard-reference" style="margin-top: 20px; font-style: italic; color: var(--text);">
                     Surge calculation based on Joukowsky Equation (Water Hammer). Limits per ANSI/ISA-S82.03.
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION (MASSIVE) -->
        <div class="education-section card">
            <h2><i class="fas fa-lightbulb"></i> Engineering Insights: Protecting Pressure Transmitters</h2>
            
            <!-- Insight 1: Definitions -->
            <div class="insight-card">
                <h4><i class="fas fa-book"></i> 1. The Hierarchy of Pressure Limits</h4>
                <p>Understanding the datasheet terms is critical for safety.</p>
                <ul>
                    <li><strong>URL (Upper Range Limit):</strong> The maximum pressure the sensor can measure accurately. Going above this saturates the output (20.5 mA) but usually causes no damage.</li>
                    <li><strong>Proof Pressure (Overpressure Limit):</strong> The maximum pressure the sensor can withstand without permanent deformation of the sensing diaphragm. If you exceed this, the sensor may still work, but the <strong>Zero Point will shift</strong> significantly, requiring recalibration or replacement. Typically 1.5x to 2.0x URL.</li>
                    <li><strong>Burst Pressure:</strong> The absolute limit before the process fluid breaches containment (sensor body rupture). Exceeding this is a catastrophic safety incident. Typically 5x to 10x URL.</li>
                </ul>
            </div>

            <!-- Insight 2: Water Hammer -->
            <div class="insight-card">
                <h4><i class="fas fa-water"></i> 2. The Physics of Water Hammer (Surge)</h4>
                <p>Water hammer occurs when a moving fluid is suddenly stopped (e.g., fast-closing valve). The kinetic energy of the fluid is instantly converted into pressure energy, creating a shockwave that travels at the speed of sound ($c$) through the fluid.</p>
                <p>The magnitude of this pressure spike is calculated using the <strong>Joukowsky Equation</strong>:</p>
                <div class="formula">
                    $$ \Delta P_{surge} = \rho \cdot c \cdot \Delta v $$
                </div>
                <p>Where $\rho$ is density, $c$ is the speed of sound in the fluid, and $\Delta v$ is the change in velocity. Note that this pressure spike <strong>adds</strong> to the existing static pressure.</p>
            </div>

            <!-- Insight 3: Critical Period & Valve Closure -->
            <div class="insight-card">
                <h4><i class="fas fa-clock"></i> 3. Rapid vs. Gradual Closure</h4>
                <p>The full Joukowsky surge only develops if the valve closes faster than the time it takes for the pressure wave to travel to the end of the pipe and back. This is called the <strong>Critical Period ($T_{crit}$)</strong>.</p>
                <div class="formula">$$ T_{crit} = \frac{2L}{c} $$</div>
                <ul>
                    <li><strong>Rapid Closure ($t_c < T_{crit}$):</strong> Full surge pressure develops ($\Delta P_{max}$). This is the worst-case scenario.</li>
                    <li><strong>Gradual Closure ($t_c > T_{crit}$):</strong> The pressure wave reflects back before the valve is fully closed, cancelling out some of the pressure rise. The surge is attenuated proportionally: $\Delta P \approx \Delta P_{max} \times (T_{crit} / t_c)$.</li>
                </ul>
            </div>

            <!-- Insight 4: Protection Strategies -->
            <div class="insight-card">
                <h4><i class="fas fa-shield-virus"></i> 4. Mitigation Strategies</h4>
                <p>If your calculation shows a risk, use these protection methods:</p>
                <ul>
                    <li><strong>Snubbers (Pulsation Dampeners):</strong> A porous metal disc or restrictive orifice installed at the transmitter inlet. It restricts the flow rate of fluid into the sensor, damping out high-frequency spikes and smoothing the reading. Essential for pump discharge lines.</li>
                    <li><strong>Diaphragm Seals (Chemical Seals):</strong> A remote diaphragm with a capillary filled with oil. The oil volume acts as a buffer and the large diaphragm area distributes the shock load.</li>
                    <li><strong>Overpressure Protectors:</strong> A mechanical piston valve that instantly shuts off the port to the transmitter when pressure exceeds a set limit, reopening when pressure drops.</li>
                </ul>
            </div>
        </div>
    </main>    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li>                        
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li>                        
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let pressureChart = null;
        let lastResult = null;

        function loadPreset(type) {
            if (type === 'standard_water') {
                document.getElementById('url').value = '100';
                document.getElementById('proof').value = '150';
                document.getElementById('burst').value = '400';
                document.getElementById('calibrated-span').value = '60';
                document.getElementById('op-pressure').value = '40';
                document.getElementById('density').value = '1000';
                document.getElementById('sound-speed').value = '1480';
                document.getElementById('velocity').value = '1.0';
                document.getElementById('pipe-length').value = '100';
                document.getElementById('close-time').value = '0.5';
            } else if (type === 'fast_close') {
                document.getElementById('url').value = '20';
                document.getElementById('proof').value = '30';
                document.getElementById('burst').value = '100';
                document.getElementById('calibrated-span').value = '16';
                document.getElementById('op-pressure').value = '10';
                document.getElementById('density').value = '1000';
                document.getElementById('sound-speed').value = '1480';
                document.getElementById('velocity').value = '3.0';
                document.getElementById('pipe-length').value = '200';
                document.getElementById('close-time').value = '0.1'; // Very fast
            } else if (type === 'slow_close') {
                document.getElementById('url').value = '20';
                document.getElementById('proof').value = '30';
                document.getElementById('burst').value = '100';
                document.getElementById('calibrated-span').value = '16';
                document.getElementById('op-pressure').value = '10';
                document.getElementById('density').value = '1000';
                document.getElementById('sound-speed').value = '1480';
                document.getElementById('velocity').value = '3.0';
                document.getElementById('pipe-length').value = '200';
                document.getElementById('close-time').value = '5.0'; // Slow close
            }
            displayMessage(`${type.toUpperCase()} scenario loaded.`, "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Theme handling
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if(themeSwitch) {
                themeSwitch.addEventListener('change', function() {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }

            document.getElementById('calculate-btn').addEventListener('click', performCalculation);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
        });

        function performCalculation() {
            // 1. Get Inputs
            const url = parseFloat(document.getElementById('url').value);
            const proof = parseFloat(document.getElementById('proof').value);
            const burst = parseFloat(document.getElementById('burst').value);
            const span = parseFloat(document.getElementById('calibrated-span').value);
            const op_press = parseFloat(document.getElementById('op-pressure').value);
            const rho = parseFloat(document.getElementById('density').value);
            const c = parseFloat(document.getElementById('sound-speed').value);
            const dv = parseFloat(document.getElementById('velocity').value);
            const L = parseFloat(document.getElementById('pipe-length').value);
            const tc = parseFloat(document.getElementById('close-time').value);

            if (isNaN(url) || isNaN(proof) || isNaN(dv) || isNaN(L) || isNaN(tc)) {
                displayMessage("Please enter valid numbers.", "error");
                return;
            }

            // 2. Physics Engine Calculation
            
            // A. Acoustic Impedance
            const acoustic_Z = rho * c;

            // B. Critical Time (T_crit)
            const t_crit = (2 * L) / c;

            // C. Surge Pressure Calculation (Joukowsky vs Gradual)
            let dp_surge_pa = 0;
            let surge_type = "";
            let attenuation_factor = 1.0;

            if (tc <= t_crit) {
                // Rapid Closure: Max Joukowsky
                surge_type = "Rapid Closure (Max Joukowsky)";
                dp_surge_pa = rho * c * dv;
            } else {
                // Gradual Closure: Attenuated
                surge_type = "Gradual Closure";
                // Approx formula: dP = (2 * L * rho * dv) / tc
                // Which is equivalent to Joukowsky * (T_crit / tc)
                attenuation_factor = t_crit / tc;
                dp_surge_pa = (rho * c * dv) * attenuation_factor;
            }

            const dp_surge_bar = dp_surge_pa / 100000;

            // D. Total Pressure
            const p_total = op_press + dp_surge_bar;

            // E. Ratios & Checks
            const pct_url = (p_total / url) * 100;
            const pct_proof = (p_total / proof) * 100;
            const pct_burst = (p_total / burst) * 100;

            lastResult = { url, proof, burst, op_press, dp_surge_bar, p_total, pct_url, pct_proof, pct_burst, rho, c, dv, L, tc, t_crit, surge_type, attenuation_factor };

            // 4. Render Step-by-Step
            let html = `<h4>Step 1: Acoustic Impedance ($Z$)</h4>`;
            html += `<div class="calculation-step">`;
            html += `$$ Z = \\rho \\cdot c = ${rho} \\cdot ${c} = ${acoustic_Z.toLocaleString()} \\frac{\\text{kg}}{\\text{m}^2\\text{s}} $$`;
            html += `</div>`;

            html += `<h4>Step 2: Critical Time Analysis ($T_{crit}$)</h4>`;
            html += `<div class="calculation-step">`;
            html += `Time for pressure wave round-trip: <br>`;
            html += `$$ T_{crit} = \\frac{2L}{c} = \\frac{2 \\cdot ${L}}{${c}} = \\mathbf{${t_crit.toFixed(3)} \\text{ s}} $$<br>`;
            html += `Valve Closure Time ($t_c$): ${tc} s.<br>`;
            html += `Condition: ${tc <= t_crit ? '$t_c \\le T_{crit}$ (Rapid)' : '$t_c > T_{crit}$ (Gradual)'}.<br>`;
            html += `<strong>Mode: ${surge_type}</strong>`;
            html += `</div>`;

            html += `<h4>Step 3: Surge Magnitude Calculation</h4>`;
            html += `<div class="calculation-step">`;
            if (tc <= t_crit) {
                html += `$$ \\Delta P = \\rho \\cdot c \\cdot \\Delta v = ${rho} \\cdot ${c} \\cdot ${dv} $$`;
            } else {
                html += `$$ \\Delta P \\approx \\frac{2 L \\rho \\Delta v}{t_c} = (\\rho c \\Delta v) \\times \\frac{T_{crit}}{t_c} $$`;
                html += `$$ \\text{Attenuation Factor} = \\frac{${t_crit.toFixed(3)}}{${tc}} = ${attenuation_factor.toFixed(3)} $$`;
            }
            html += `$$ \\Delta P = ${dp_surge_pa.toLocaleString()} \\text{ Pa} = \\mathbf{${dp_surge_bar.toFixed(2)} \\text{ bar}} $$`;
            html += `</div>`;

            html += `<h4>Step 4: Total System Load</h4>`;
            html += `<div class="calculation-step">`;
            html += `$$ P_{max} = P_{operating} + \\Delta P_{surge} = ${op_press} + ${dp_surge_bar.toFixed(2)} = \\mathbf{${p_total.toFixed(2)} \\text{ bar}} $$`;
            html += `</div>`;

            html += `<h4>Step 5: Limit Verification</h4>`;
            html += `<div class="calculation-step">`;
            html += `1. <strong>URL Check (${url} bar):</strong> ${p_total.toFixed(1)} bar is ${pct_url.toFixed(1)}% of URL.<br>`;
            html += `2. <strong>Proof Check (${proof} bar):</strong> ${p_total.toFixed(1)} bar is ${pct_proof.toFixed(1)}% of Proof Limit.<br>`;
            html += `3. <strong>Burst Check (${burst} bar):</strong> ${p_total.toFixed(1)} bar is ${pct_burst.toFixed(1)}% of Burst Limit.`;
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;

            // 5. Update Table
            const tbody = document.getElementById('result-table-body');
            tbody.innerHTML = '';
            const addRow = (n, v, s, c="") => {
                tbody.innerHTML += `<tr style="${c ? 'color:'+c : ''}"><td><strong>${n}</strong></td><td>${v}</td><td>${s}</td></tr>`;
            };
            addRow("Analysis Mode", surge_type, "-", "var(--primary)");
            addRow("Calculated Surge", "+" + dp_surge_bar.toFixed(2), "bar", "var(--warning)");
            addRow("Total Peak Pressure", p_total.toFixed(2), "bar");
            
            // Logic for Status
            let statusText = "";
            
            if (p_total > burst) {
                addRow("Result", "CATASTROPHIC FAILURE", "Breach", "var(--danger)");
                statusText = `<span style="color:var(--danger); font-weight:bold;">DANGER: BURST PRESSURE EXCEEDED.</span> Process containment lost. Major safety hazard.`;
            } else if (p_total > proof) {
                addRow("Result", "SENSOR DAMAGE", "Perm. Deformation", "var(--danger)");
                statusText = `<span style="color:var(--danger); font-weight:bold;">FAILURE: PROOF PRESSURE EXCEEDED.</span> Diaphragm permanently deformed. Zero shift guaranteed. Replace sensor.`;
            } else if (p_total > url) {
                addRow("Result", "Overrange", "Saturation", "var(--warning)");
                statusText = `<span style="color:var(--warning); font-weight:bold;">WARNING: URL EXCEEDED.</span> Output will saturate (20.5mA). Check calibration zero after event.`;
            } else {
                addRow("Result", "Safe", "Within Limits", "var(--success)");
                statusText = `<span style="color:var(--success); font-weight:bold;">SAFE OPERATION.</span> Peak pressure is within transmitter URL.`;
            }

            document.getElementById('interpretation-text').innerHTML = statusText;

            // 6. Draw Chart
            drawChart(op_press, dp_surge_bar, url, proof, burst);

            // 7. Show
            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typesetPromise([document.getElementById('calculation-details')]);
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }

        function drawChart(op, surge, url, proof, burst) {
            const ctx = document.getElementById('pressureChart').getContext('2d');
            if (pressureChart) pressureChart.destroy();

            pressureChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Pressure Profile'],
                    datasets: [
                        {
                            label: 'Operating Pressure',
                            data: [op],
                            backgroundColor: '#10B981',
                            stack: 'Stack 0'
                        },
                        {
                            label: 'Surge Spike',
                            data: [surge],
                            backgroundColor: '#EF4444',
                            stack: 'Stack 0'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            title: { display: true, text: 'Pressure (bar)' },
                            max: Math.max(op+surge, burst) * 1.1 
                        }
                    },
                    plugins: {
                        annotation: {
                            annotations: {
                                lineURL: {
                                    type: 'line',
                                    yMin: url,
                                    yMax: url,
                                    borderColor: '#F59E0B',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: { content: 'URL', enabled: true, position: 'start', backgroundColor: 'rgba(245, 158, 11, 0.8)' }
                                },
                                lineProof: {
                                    type: 'line',
                                    yMin: proof,
                                    yMax: proof,
                                    borderColor: '#3B82F6',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: { content: 'Proof Limit', enabled: true, position: 'end', backgroundColor: 'rgba(59, 130, 246, 0.8)' }
                                },
                                lineBurst: {
                                    type: 'line',
                                    yMin: burst,
                                    yMax: burst,
                                    borderColor: '#EF4444',
                                    borderWidth: 3,
                                    label: { content: 'BURST LIMIT', enabled: true, position: 'center', backgroundColor: 'rgba(239, 68, 68, 0.8)' }
                                }
                            }
                        }
                    }
                }
            });
        }

        function generatePDF() {
            if (!lastResult) {
                displayMessage("Calculate first.", "error");
                return;
            }
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 15;

            // Header
            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(16);
            pdf.setTextColor(30, 58, 138); 
            pdf.text('Pressure Overrange Analysis Report', 105, y, { align: 'center' });
            y += 10;

            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text(`Date: ${new Date().toLocaleString()}`, 105, y, { align: 'center' });
            y += 15;

            // Inputs
            pdf.setFontSize(12);
            pdf.setTextColor(0);
            pdf.text('1. Input Parameters', 14, y);
            y += 5;

            const inputData = [
                ['Transmitter URL', `${lastResult.url} bar`],
                ['Proof Pressure', `${lastResult.proof} bar`],
                ['Operating Pressure', `${lastResult.op_press} bar`],
                ['Velocity Change', `${lastResult.dv} m/s`],
                ['Pipe Length', `${lastResult.L} m`],
                ['Valve Closure Time', `${lastResult.tc} s`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Parameter', 'Value']],
                body: inputData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            y = pdf.lastAutoTable.finalY + 15;

            // Results
            pdf.text('2. Analysis Results', 14, y);
            y += 5;

            const resData = [
                ['Analysis Mode', lastResult.surge_type],
                ['Calculated Surge', `${lastResult.dp_surge_bar.toFixed(2)} bar`],
                ['Total Peak Pressure', `${lastResult.p_total.toFixed(2)} bar`],
                ['% of URL', `${lastResult.pct_url.toFixed(1)} %`],
                ['% of Proof Limit', `${lastResult.pct_proof.toFixed(1)} %`]
            ];

            pdf.autoTable({
                startY: y,
                head: [['Metric', 'Result']],
                body: resData,
                margin: { left: 14, right: 14 },
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] },
                didParseCell: function(data) {
                    if(data.row.index === 1) {
                        data.cell.styles.fontStyle = 'bold';
                    }
                }
            });

            // Footer
            y = pdf.lastAutoTable.finalY + 20;
            pdf.setFontSize(8);
            pdf.setTextColor(150);
            pdf.text('Surge estimation based on Joukowsky Equation (Water Hammer).', 105, y, { align: 'center' });

            pdf.save('Pressure_Surge_Report.pdf');
            displayMessage("PDF Downloaded", "success");
        }

        function displayMessage(message, type = "info") {
            let messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            if (type === "error") messageBox.style.backgroundColor = 'var(--danger)';
            else if (type === "success") messageBox.style.backgroundColor = 'var(--success)';
            else messageBox.style.backgroundColor = 'var(--primary)';
            messageBox.classList.add('show');
            setTimeout(() => messageBox.classList.remove('show'), 4000);
        }
    </script>
</body>
</html>
