<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-Main">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Industrial Boiler Performance Analyzer (ASME PTC 4)</title>
<meta name="description" content="A professional-grade calculator for industrial boilers, performing both Direct (Input-Output) and Indirect (Heat Loss) efficiency analysis per ASME PTC 4 principles.">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-23Y1V450SR');
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- MathJax for LaTeX rendering -->
<script type="text/javascript" id="MathJax-script" async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<script>
// MathJax configuration to support inline and display LaTeX
MathJax = {
tex: {
inlineMath: [['$', '$'], ['\\(', '\\)']],
displayMath: [['$$', '$$'], ['\\[', '\\]']],
processEscapes: true
},
svg: {fontCache: 'global'}
};
</script>
<style>
/* Base Styles */
:root {
--primary-color: #1E3A8A; /* Professional Dark Blue */
--secondary-color: #2563EB; /* Bright Blue */
--accent-color: #F59E0B; /* Warm Amber */
--bg-color: #F8FAFC;
--card-bg: #FFFFFF;
--text-color: #4B5563;
--heading-color: #111827;
--footer-bg: #0F172A;
--border-color: #E2E8F0;
--gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
--gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
--card-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 5px 10px rgba(0, 0, 0, 0.04);
--hover-color: #eef2ff;
--button-hover-shadow: 0 7px 20px rgba(37, 99, 235, 0.4);
--highlight-bg: rgba(245, 158, 11, 0.15);
--success-color: #10B981;
--fail-color: #EF4444;
--warning-color: #F59E0B;
--primary-color-rgb: 30, 58, 138;
}

body.dark-mode {
--primary-color: #10B981;
--secondary-color: #34D399;
--bg-color: #0F172A;
--card-bg: #1E293B;
--text-color: #CBD5E1;
--heading-color: #F1F5F9;
--footer-bg: #020617;
--border-color: #334155;
--highlight-bg: rgba(16, 185, 129, 0.2);
--hover-color: #334155;
--button-hover-shadow: 0 7px 20px rgba(16, 185, 129, 0.3);
--primary-color-rgb: 16, 185, 129;
}

html { scroll-behavior: smooth; }

body {
font-family: 'Inter', sans-serif;
margin: 0;
padding: 0;
background-color: var(--bg-color);
color: var(--text-color);
line-height: 1.6;
transition: background-color 0.3s, color 0.3s;
}

.container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }
.content-container { max-width: 1100px; margin: 0 auto; padding: 20px; }

/* --- NEW HEADER STYLES --- */
.header {
background: var(--gradient-primary);
color: white;
padding: 24px 0;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.navbar {
display: flex;
justify-content: space-between;
align-items: center;
}

.logo-container {
display: flex;
align-items: center;
gap: 16px;
text-decoration: none;
color: white;
}

.logo-text {
font-size: 1.75rem;
font-weight: 800;
font-family: 'Montserrat', sans-serif;
}

.nav-links {
display: flex;
gap: 24px;
list-style: none;
margin: 0;
padding: 0;
}

.nav-links a {
color: white;
text-decoration: none;
font-weight: 500;
transition: all 0.3s;
}

.nav-links a:hover {
color: var(--accent-color);
transform: translateY(-2px);
}

.theme-toggle {
display: flex;
align-items: center;
gap: 12px;
}

.theme-toggle .icon {
color: white;
font-size: 1.2rem;
}

.switch {
position: relative;
display: inline-block;
width: 56px;
height: 30px;
}

.switch input { opacity: 0; width: 0; height: 0; }

.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: rgba(0,0,0,0.2);
transition: .4s;
border-radius: 30px;
}

.slider:before {
position: absolute;
content: "";
height: 22px;
width: 22px;
left: 4px;
bottom: 4px;
background-color: white;
transition: .4s;
border-radius: 50%;
}

input:checked + .slider { background-color: var(--accent-color); }
input:checked + .slider:before { transform: translateX(26px); }
/* --- END OF NEW HEADER STYLES --- */


main { padding: 40px 0; }

.tool-container {
background-color: var(--card-bg);
border-radius: 12px;
padding: 30px;
box-shadow: var(--card-shadow);
margin-bottom: 30px;
}

.tool-container h2 {
color: var(--primary-color);
border-bottom: 3px solid var(--primary-color);
padding-bottom: 15px;
margin-top: 0;
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
font-size: 1.8rem;
}

/* Added styles for new content */
.tool-container h3 {
color: var(--primary-color);
margin-top: 25px;
font-family: 'Montserrat', sans-serif;
}
.tool-container p {
margin-bottom: 15px;
}
.tool-container ul, .tool-container ol {
padding-left: 20px;
margin-bottom: 15px;
}
.tool-container li {
margin-bottom: 10px;
}
.tool-container h4 {
color: var(--secondary-color);
margin-top: 20px;
font-family: 'Montserrat', sans-serif;
}
/* End of added styles */


.tool-description {
margin-bottom: 25px;
color: var(--text-color);
font-size: 1.05em;
background-color: var(--hover-color);
border-radius: 8px;
padding: 20px;
border-left: 5px solid var(--primary-color);
}
.tool-description ul {
list-style-type: disc;
margin-left: 20px;
padding-left: 0;
margin-top: 15px;
}
.tool-description ul li {
margin-bottom: 8px;
}
.tool-description strong {
color: var(--primary-color);
}

.calculator-form {
background-color: var(--card-bg);
border-radius: 8px;
padding: 25px;
margin-top: 25px;
box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

.form-section-header {
font-size: 1.2rem;
font-weight: 700;
color: var(--primary-color);
margin-top: 25px;
margin-bottom: 15px;
padding-bottom: 8px;
border-bottom: 2px solid var(--border-color);
}

.form-group {
margin-bottom: 20px;
}

.form-group label {
display: flex;
align-items: center;
margin-bottom: 8px;
font-weight: 600;
color: var(--heading-color);
}

.form-group input, .form-group select {
width: 100%;
padding: 12px 15px;
border: 1px solid var(--border-color);
border-radius: 8px;
background-color: var(--bg-color);
color: var(--text-color);
box-sizing: border-box;
font-size: 1em;
transition: border-color 0.3s, box-shadow 0.3s;
box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
}

.form-group input:focus, .form-group select:focus {
border-color: var(--primary-color);
box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.3);
outline: none;
}

.form-row {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
gap: 20px;
}

.calculate-btn {
background-image: var(--gradient-primary);
color: white;
border: none;
padding: 18px 25px;
border-radius: 8px;
cursor: pointer;
font-size: 1.2rem;
font-weight: bold;
font-family: 'Montserrat', sans-serif;
margin-top: 20px;
transition: transform 0.2s ease-in-out, box-shadow 0.3s ease-in-out;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
width: 100%;
}

.calculate-btn:hover {
transform: translateY(-3px) scale(1.02);
box-shadow: var(--button-hover-shadow);
}

.result-container {
margin-top: 40px;
padding: 30px;
border-radius: 12px;
background-color: var(--card-bg);
box-shadow: var(--card-shadow);
opacity: 0;
transform: translateY(30px);
transition: opacity 0.6s ease-out, transform 0.6s ease-out;
display: none; /* Initially hidden */
}

.result-container.show {
display: block;
opacity: 1;
transform: translateY(0);
}

.result-container h3 {
color: var(--primary-color);
margin-bottom: 25px;
font-family: 'Montserrat', sans-serif;
font-size: 1.8rem;
text-align: center;
}

.result-table {
width: 100%;
border-collapse: collapse;
margin-top: 20px;
}

.result-table th, .result-table td {
padding: 15px;
text-align: left;
border-bottom: 1px solid var(--border-color);
}

.result-table th {
background-color: var(--hover-color);
font-weight: 600;
color: var(--heading-color);
font-size: 1.1em;
}

.result-table tr:last-child td {
border-bottom: none;
}

/* Special styling for key results */
.result-table .highlight-row td {
font-weight: bold;
color: var(--primary-color);
background-color: var(--highlight-bg);
font-size: 1.1rem;
}

.result-table .discrepancy-row td {
font-weight: bold;
color: var(--warning-color);
background-color: rgba(245, 158, 11, 0.1);
font-size: 1.1rem;
}


.standard-reference {
margin-top: 25px;
font-style: italic;
font-size: 0.95rem;
line-height: 1.5;
padding: 20px;
background-color: var(--bg-color);
border-radius: 8px;
border: 1px solid var(--border-color);
}
.standard-reference ul {
list-style-type: disc;
margin-left: 20px;
padding-left: 0;
margin-top: 10px;
}
.standard-reference li {
margin-bottom: 8px;
}


.info-icon {
color: var(--secondary-color);
margin-left: 8px;
cursor: help;
font-size: 0.9em;
}

.tooltip {
position: relative;
display: inline-block;
}

.tooltip .tooltiptext {
visibility: hidden;
width: 280px;
background-color: #333;
color: #fff;
text-align: left;
line-height: 1.4;
border-radius: 8px;
padding: 10px;
position: absolute;
z-index: 10;
bottom: 135%;
left: 50%;
margin-left: -140px;
opacity: 0;
transition: opacity 0.3s;
font-weight: normal;
font-size: 0.9rem;
}

.tooltip .tooltiptext::after {
content: "";
position: absolute;
top: 100%;
left: 50%;
margin-left: -5px;
border-width: 5px;
border-style: solid;
border-color: #333 transparent transparent transparent;
}

.tooltip:hover .tooltiptext {
visibility: visible;
opacity: 1;
}

#custom-message-box {
position: fixed;
top: 20px;
left: 50%;
transform: translateX(-50%);
padding: 18px 30px;
border-radius: 10px;
box-shadow: 0 6px 15px rgba(0,0,0,0.3);
z-index: 1000;
font-weight: bold;
color: white;
opacity: 0;
visibility: hidden;
transition: opacity 0.5s ease-in-out, visibility 0.5s, background-color 0.3s;
font-size: 1.1em;
}
#custom-message-box.show {
opacity: 1;
visibility: visible;
}
#custom-message-box.info {
background-color: var(--success-color);
}
#custom-message-box.error {
background-color: var(--fail-color);
}
#custom-message-box.warning {
background-color: var(--warning-color);
color: #333;
}

#calculation-details {
background-color: var(--bg-color);
border: 1px solid var(--border-color);
border-radius: 8px;
padding: 20px;
margin-bottom: 25px;
font-size: 0.98em;
overflow-x: auto;
}

#calculation-details h4 {
color: var(--secondary-color);
margin-top: 0;
margin-bottom: 15px;
font-size: 1.3em;
}

#calculation-details p.formula {
font-family: 'Times New Roman', serif;
font-style: italic;
font-size: 1.2em;
text-align: center;
padding: 12px;
background-color: var(--hover-color);
border-radius: 6px;
margin: 15px 0;
border: 1px dashed var(--border-color);
overflow-x: auto;
white-space: nowrap;
}

#calculation-details p.calculation-step {
font-family: 'Courier New', monospace;
background-color: var(--hover-color);
padding: 8px 12px;
border-radius: 5px;
margin-bottom: 8px;
font-size: 0.95em;
overflow-x: auto;
white-space: normal;
word-wrap: break-word;
}
#calculation-details ul {
list-style-type: disc;
margin-left: 25px;
padding-left: 0;
}
#calculation-details ul li {
margin-bottom: 5px;
}

input:required:invalid {
border-color: var(--fail-color);
}
input:required:valid {
border-color: var(--success-color);
}

@media (max-width: 768px) {
.navbar { flex-direction: column; gap: 24px; }
.nav-links { flex-direction: column; gap: 12px; text-align: center; }
.form-row { grid-template-columns: 1fr; }
.container, .content-container { padding: 0 15px; }
.tool-container { padding: 20px; }
.tooltip .tooltiptext { width: 200px; margin-left: -100px; }
.footer-content { flex-direction: column; }
}
</style>
</head>
<body>

<!-- HEADER (Replaced) -->
<header class="header">
<div class="container">
<nav class="navbar">
<a href="/" class="logo-container">
<span class="logo-text">Design Calculators</span>
</a>
<ul class="nav-links">
<li><a href="/">Home</a></li>
<li><a href='/articles.html'>Articles</a></li>
<li><a href='/indexmech.html'>Mechanical</a></li>
<li><a href='/indexele.html'>Electrical</a></li>
<li><a href='/indexinst.html'>Instrumentation</a></li>
</ul>
<div class="theme-toggle">
<i class="fas fa-sun icon"></i>
<label class="switch">
<input type="checkbox" id="theme-switch">
<span class="slider"></span>
</label>
<i class="fas fa-moon icon"></i>
</div>
</nav>
</div>
</header>

<main class="content-container">
<!-- Back button removed as requested -->
<div class="tool-container">
<h2>Industrial Boiler Performance Analyzer (ASME PTC 4)</h2>
<div class="tool-description">
<p>This comprehensive tool determines the <strong>Boiler Thermal Efficiency</strong> using two independent, industry-standard methods. This hybrid approach is essential for accurate performance monitoring, optimization, and troubleshooting per <strong>ASME PTC 4</strong> principles.</p>
<p><strong>1. Direct Method (Input-Output):</strong></p>
<ul>
<li>Calculates efficiency ($\small \eta_{direct}$) based on the measured heat *absorbed* by the water/steam versus the heat *supplied* by the fuel.</li>
<li>$\small \eta_{direct} = \frac{Q_{output}}{Q_{input}} = \frac{M_{steam} \times (h_{steam} - h_{feedwater})}{M_{fuel} \times HHV}$</li>
<li>Provides a direct measure of the "black box" performance.</li>
</ul>
<p><strong>2. Indirect Method (Heat Loss):</strong></p>
<ul>
<li>Calculates efficiency by identifying and quantifying all major heat *losses*, then subtracting them from 100%.</li>
<li>$\small \eta_{indirect} = 100\% - (L_1 + L_2 + L_3 + L_4 + ...)$</li>
<li>This tool calculates the "Big Four" losses: Dry Flue Gas (L1), Water Vapor (L2), Casing/Radiation (L3), and **Blowdown (L4)**.</li>
<li>This is the preferred method for performance testing as it's often more accurate and shows *why* efficiency is high or low.</li>
</ul>
<p><strong>Industrial Reconciliation:</strong></p>
<p>The tool compares the two results. The <strong>Discrepancy (Unaccounted Loss)</strong> is a critical diagnostic metric. A large discrepancy often indicates instrumentation errors (flow, temp) or significant unmeasured losses (e.g., air leaks, unburnt fuel).</p>
</div>

<div class="calculator-form">
<form id="boiler-calculator-form">
<div class="form-section-header">1. General Parameters</div>
<div class="form-row">
<div class="form-group">
<label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (kg, kJ, °C) or Imperial (lb, BTU, °F).</span></span></label>
<select id="unit-system" required>
<option value="metric">Metric (kg/hr, kJ/kg, °C)</option>
<option value="imperial">Imperial (lb/hr, BTU/lb, °F)</option>
</select>
</div>
</div>

<div class="form-section-header">2. Direct Method Parameters (Input-Output)</div>
<div class="form-row">
<div class="form-group">
<label for="fuel-input-rate">Fuel Mass Flow Rate ($\small M_{fuel}$) <span class="fuel-rate-unit">(kg/hr)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Total mass flow rate of fuel supplied to the boiler.</span></span></label>
<input type="number" id="fuel-input-rate" step="any" value="1000" required min="0.01">
</div>
<div class="form-group">
<label for="fuel-hhv">Fuel HHV <span class="hhv-unit">(kJ/kg)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Higher Heating Value (Gross Calorific Value) of the fuel. Must use HHV, not LHV.</span></span></label>
<input type="number" id="fuel-hhv" step="any" value="40000" required min="0.01">
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="steam-output-rate">Steam Output Rate ($\small M_{steam}$) <span class="steam-rate-unit">(kg/hr)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Mass flow rate of steam produced by the boiler.</span></span></label>
<input type="number" id="steam-output-rate" step="any" value="5000" required min="0.01">
</div>
<div class="form-group">
<label for="enthalpy-feedwater">Feedwater Enthalpy ($\small h_{fw}$) <span class="enthalpy-unit">(kJ/kg)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Specific enthalpy of feedwater at boiler inlet. Get from steam tables based on feedwater temperature.</span></span></label>
<input type="number" id="enthalpy-feedwater" step="any" value="200" required min="0">
</div>
<div class="form-group">
<label for="enthalpy-steam">Steam Enthalpy ($\small h_{s}$) <span class="enthalpy-unit">(kJ/kg)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Specific enthalpy of steam at boiler outlet. Get from steam tables using measured pressure and temperature.</span></span></label>
<input type="number" id="enthalpy-steam" step="any" value="3200" required min="0.01">
</div>
</div>

<div class="form-section-header">3. Indirect Method Parameters (Heat Loss)</div>
<div class="form-row">
<div class="form-group">
<label for="flue-gas-o2">Flue Gas O<sub>2</sub> (%): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Percent of Oxygen (O2) in the dry flue gas, measured at the stack. Typically 2-4%.</span></span></label>
<input type="number" id="flue-gas-o2" step="0.1" value="3.5" required min="0" max="21">
</div>
<div class="form-group">
<label for="stack-temp">Stack Temperature ($\small T_{stack}$) <span class="temp-unit">(°C)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Flue gas temperature at the stack exit (after any preheaters/economizers).</span></span></label>
<input type="number" id="stack-temp" step="any" value="160" required>
</div>
<div class="form-group">
<label for="ambient-temp">Ambient Air Temp ($\small T_{amb}$) <span class="temp-unit">(°C)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Inlet temperature of the combustion air.</span></span></label>
<input type="number" id="ambient-temp" step="any" value="25" required>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label for="casing-loss-pct">Casing Loss (% of Heat Input): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Estimated percentage of total heat input lost from boiler casing to ambient. (ASME default is ~0.5-2%).</span></span></label>
<input type="number" id="casing-loss-pct" step="0.1" value="1.5" required min="0" max="100">
</div>
<div class="form-group">
<label for="blowdown-rate-pct">Blowdown Rate (% of Feedwater): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Continuous blowdown rate as a percentage of total feedwater flow. Typically 1-5% to control TDS.</span></span></label>
<input type="number" id="blowdown-rate-pct" step="0.1" value="3.0" required min="0" max="100">
</div>
<div class="form-group">
<label for="enthalpy-blowdown">Boiler Water Enthalpy ($\small h_{bd}$) <span class="enthalpy-unit">(kJ/kg)</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enthalpy of saturated liquid water at boiler drum pressure. Get from steam tables.</span></span></label>
<input type="number" id="enthalpy-blowdown" step="any" value="850" required min="0">
</div>
</div>

<div class="form-section-header">4. Fuel Composition (Simplified Elemental, % by mass)</div>
<div class="form-row" style="grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));">
<div class="form-group">
<label for="fuel-c">Carbon (%C):</label>
<input type="number" id="fuel-c" class="fuel-comp" step="0.1" value="85.0" required min="0" max="100">
</div>
<div class="form-group">
<label for="fuel-h">Hydrogen (%H):</label>
<input type="number" id="fuel-h" class="fuel-comp" step="0.1" value="12.0" required min="0" max="100">
</div>
<div class="form-group">
<label for="fuel-s">Sulfur (%S):</label>
<input type="number" id="fuel-s" class="fuel-comp" step="0.1" value="0.5" required min="0" max="100">
</div>
<div class="form-group">
<label for="fuel-o">Oxygen (%O):</label>
<input type="number" id="fuel-o" class="fuel-comp" step="0.1" value="1.0" required min="0" max="100">
</div>
<div class="form-group">
<label for="fuel-n">Nitrogen (%N):</label>
<input type="number" id="fuel-n" class="fuel-comp" step="0.1" value="1.0" required min="0" max="100">
</div>
<div class="form-group">
<label for="fuel-water">Water/Inerts (%):</label>
<input type="number" id="fuel-water" class="fuel-comp" step="0.1" value="0.5" required min="0" max="100">
</div>
</div>
<div id="fuel-comp-total" style="text-align: right; font-weight: bold; margin-top: -10px; margin-bottom: 20px;">Total: 100.0%</div>

<button type="button" id="calculate-boiler-btn" class="calculate-btn"><i class="fas fa-fire"></i> Run Performance Analysis</button>
</form>
</div>
<div id="result-container" class="result-container">
<h3>Boiler Performance Analysis</h3>
<div id="calculation-details"></div>
<table class="result-table">
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody id="result-table-body"></tbody>
</table>
<div class="standard-reference" id="standard-reference">
<!-- Content will be populated by JS -->
</div>
</div>
</div>

<!-- START: NEW 800+ WORD EDUCATIONAL CONTENT -->
<div class="tool-container" style="margin-top: 40px;">
<h2>The Powerhouse: An Industrial Guide to Boiler Performance</h2>

<h3 style="color: var(--primary-color); margin-top: 25px;">Why the Boiler is the Engine of Industry</h3>
<p>From generating the electricity that powers cities to producing the high-pressure steam required for chemical reactions, the industrial boiler is a cornerstone of modern civilization. It is a massive, complex piece of equipment designed for one purpose: to convert the chemical energy in fuel into thermal energy in water, creating steam. This steam is the "lifeblood" of countless processes, used for everything from driving turbines and heating reactors to sterilizing equipment and processing food. </p>
<p>Like a furnace, a boiler is a massive energy consumer. Its efficiency is a direct multiplier on a facility's operating budget and environmental footprint. An inefficient boiler doesn't just waste money; it wastes fuel, releases excess CO2, and puts unnecessary thermal stress on its components. This calculator is designed to execute the same two-pronged analysis an industrial plant engineer uses to monitor this critical asset.</p>

<h3 style="color: var(--primary-color); margin-top: 25px;">The "Rulebooks": Applicable International Standards</h3>
<p>Boiler design and testing are among the most regulated fields in engineering due to the immense pressures and energies involved. Safety and performance are paramount. This tool's logic is based on the principles from these key documents:</p>
<ul>
<li><strong>ASME PTC 4 (Fired Steam Generators):</strong> This is the <strong>Performance Test Code (PTC)</strong> from the American Society of Mechanical Engineers. It is the global "gold standard" for how to conduct a boiler efficiency test. It *strongly* recommends the **Indirect Method (Heat Loss Method)** as the most accurate and reliable way to determine true boiler efficiency.</li>
<li><strong>ASME BPVC (Boiler & Pressure Vessel Code):</strong> This is the "bible" for *safety and construction*. It dictates the required materials, weld quality, wall thickness, and safety valve requirements to ensure the boiler can safely contain its high-pressure contents. A boiler *cannot* be legally operated without adhering to this code.</li>
<li><strong>BS 845 / EN 12952/12953:</strong> These are the British and European standards for boiler testing and construction, which share the same fundamental principles as the ASME codes.</li>
</ul>

<h3 style="color: var(--primary-color); margin-top: 25px;">The Two Methods: Why One Isn't Enough (Direct vs. Indirect)</h3>
<p>A plant engineer *never* trusts a single calculation. They always use two independent methods and check if they "close the loop." This tool allows you to do the same.</p>

<h4>1. The Direct Method (Input-Output)</h4>
<p>This is the intuitive method, answering: "How much energy did I get *out* in the steam versus what I put *in* as fuel?"
<br><strong>Efficiency ($\small \eta_{direct}$) = Heat Absorbed by Steam ($\small Q_{out}$) / Heat from Fuel ($\small Q_{in}$)</strong>
<ul>
<li><strong>Why it's used:</strong> It's a quick, simple calculation that gives a "black box" performance number.</li>
<li><strong>Its Weakness:</strong> It is *extremely* sensitive to instrument error. Measuring the mass flow of high-pressure steam and high-flow-rate feedwater is notoriously difficult. A 2% error in *both* the steam flow meter and the fuel flow meter (in opposite directions) can create a 4% error in the efficiency calculation, rendering it useless.</li>
</ul>
</p>

<h4>2. The Indirect Method (Heat Loss)</h4>
<p>This is the method required by ASME PTC 4. It answers: "I know 100% of the energy I put in. Where did it all go?"
<br><strong>Efficiency ($\small \eta_{indirect}$) = 100% - (Sum of All Losses)</strong>
<ul>
<li><strong>Why it's the "Gold Standard":</strong> It is often *far more accurate* to measure the losses. The two most important measurements are the **Flue Gas O2%** and the **Stack Temperature**, which can be measured precisely. By calculating each loss (L1, L2, L3, L4...), we can sum them up and confidently determine the *remainder*, which is the efficiency.</li>
<li><strong>Its Power:</strong> This method is a *diagnostic tool*. The Direct Method just says "88%". The Indirect Method says "88%, and that's because you are losing 7% up the stack (L1), 1% from blowdown (L4), and 4% from water vapor (L2)." It tells you *exactly* where to focus your maintenance and optimization efforts.</li>
</ul>
</p>

<h3 style="color: var(--primary-color); margin-top: 25px;">The "Big Four" Boiler Losses: Where Your Money Is Going</h3>
<p>This calculator now quantifies the four most important heat losses for a boiler:</p>
<ol>
<li><strong>L1: Dry Flue Gas Loss (The #1 Controllable Loss):</strong> This is the sensible heat of the *non-water* components (CO2, N2, and especially your excess O2) going up the stack. This is the single largest, and most *controllable*, loss. It is directly proportional to two things:
    <ul>
        <li><strong>Excess O2 (or Excess Air):</strong> You must add extra air for complete combustion, but every extra molecule of O2 (and its accompanying N2) that *doesn't* burn just gets heated from ambient to stack temperature for no reason. (Typical target: 2-3.5% O2).</li>
        <li><strong>Stack Temperature:</strong> The final exit temperature. The higher it is, the more heat you're wasting. (Target: As low as possible without causing acid dew point corrosion).</li>
    </ul>
</li>
<li><strong>L2: Water Vapor Loss (Latent + Sensible):</strong> This is the "cost" of burning hydrogen. When hydrogen (H) in the fuel burns, it creates H2O (water). This water gets heated into steam, and it carries its massive latent heat of vaporization up the stack. This also includes any water that was *already in* the fuel or combustion air. This loss is largely unavoidable but *must* be calculated.</li>
<li><strong>L3: Casing Losses (Radiation/Convection):</strong> This is the heat you feel when you stand next to the boiler. It's the heat escaping from the boiler's "box" (casing, drums, headers) to the atmosphere. This is a direct measure of your insulation's quality.</li>
<li><strong>L4: Blowdown Loss (The Critical Difference):</strong> This loss is unique to boilers. As water turns to steam, it leaves behind dissolved solids (minerals, salts). Over time, these solids concentrate in the boiler water, forming scale and causing tube-damaging hot spots. To prevent this, a small, continuous stream of this hot, pressurized boiler water is "blown down" (drained) and replaced with fresh, clean feedwater. This is a *necessary* operational loss, but it's a loss nonetheless, as you are dumping high-energy (e.g., 850 kJ/kg) water and replacing it with low-energy (e.g., 200 kJ/kg) feedwater.</li>
</ol>

<h3 style="color: var(--primary-color); margin-top: 25px;">Important Checks, Quality, & The Future</h3>
<p>When an engineer "walks down" a boiler, they are checking these critical items:</p>
<ul>
<li><strong>Water Chemistry (The Big One):</strong> The #1 cause of boiler failure is poor water treatment. Engineers constantly check:
    <ul>
        <li><strong>TDS (Total Dissolved Solids):</strong> This dictates the required blowdown rate. Too high, and you get scaling. Too low, and you're blowing down too much (wasting energy).</li>
        <li><strong>pH / Alkalinity:</strong> Must be kept in a precise range (e.g., 9.5-10.5) to prevent both acidic and caustic corrosion.</li>
        <li><strong>Oxygen Scavenging:</strong> Any dissolved oxygen in the feedwater will cause severe, rapid pitting corrosion. Chemicals (oxygen scavengers) are continuously added to remove it.</li>
    </ul>
</li>
<li><strong>Safety Valve Testing:</strong> By law (ASME BPVC), all boiler safety valves must be periodically tested to ensure they will lift at their set pressure and prevent a catastrophic explosion.</li>
<li><strong>Stack Appearance & Emissions:</strong> Is the stack clear? Or is it black (incomplete combustion, unburnt fuel) or white (excessive water/excess air)? This is a key visual check.</li>
</ul>

<h4>Innovations: Squeezing Every Last BTU</h4>
<p>The entire goal of modern boiler design is to recover waste heat from the flue gas.
<ul>
<li><strong>Economizers:</strong> The most common upgrade. An economizer is a set of tubes placed in the *exit* of the boiler that uses the hot flue gas (e.g., at 300°C) to pre-heat the incoming *feedwater* (e.g., from 80°C to 120°C). This recycled energy is pure efficiency gain.</li>
<li><strong>Air Preheaters (APH):</strong> Common on very large boilers, this device uses the hot flue gas to pre-heat the incoming *combustion air*, achieving the same recycling effect.</li>
<li><strong>Waste Heat Boilers (HRSG):</strong> The ultimate in efficiency. These boilers have *no burners*. Instead, they are placed at the exhaust of another high-temperature process (like a gas turbine) and use that "waste" heat to generate steam for "free." This is the principle behind all Combined Cycle power plants.</li>
</ul>
</p>
</div>
<!-- END: NEW 800+ WORD EDUCATIONAL CONTENT -->

</main>

<!-- FOOTER (Replaced) -->
<footer>
<div class="container">
<div class="footer-content">
<div class="footer-col">
<h4>Design Calculators</h4>
<p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
<div class="social-buttons">
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin"><i class="fab fa-linkedin-in"></i></a>
<a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube"><i class="fab fa-youtube"></i></a>
<a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter"><i class="fab fa-twitter"></i></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook"><i class="fab fa-facebook-f"></i></a>
<a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"><i class="fab fa-whatsapp"></i></a>
</div>
</div>
<div class="footer-col">
<h4>Quick Links</h4>
<ul>
<li><a href="/">Home</a></li>
<li><a href='/indexele.html'>Electrical</a></li>
<li><a href='/indexmech.html'>Mechanical</a></li>
<li><a href='/indexinst.html'>Instrumentation</a></li>
</ul>
</div>
<div class="footer-col">
<h4>Resources</h4>
<ul>
<li><a href='/about.html'>About Us</a></li>
<li><a href='/contact.html'>Contact</a></li>
<li><a href='/faq.html'>FAQ</a></li>
<li><a href='/privacy-policy.html'>Privacy Policy</a></li>
<li><a href='/terms-of-service.html'>Terms of Service</a></li>
</ul>
</div>
<div class="footer-col">
<h4>More</h4>
<ul>
<li><a href='/articles.html'>Articles & Blog</a></li>
<li><a href='/sitemap2.html'>Sitemap</a></li>
<li><a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer">YouTube Channel</a></li>
</ul>
</div>
</div>

<div class="footer-disclaimer">
<!-- Updated Disclaimer -->
<p> This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards (e.g., ASME PTC 4) and regulations before use. All calculations are critically dependent on accurate input data. </p>
</div>

<div class="footer-bottom">
<p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
</div>
</div>
</footer>

<div id="custom-message-box"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
// --- Get references to DOM elements ---
const calculateBtn = document.getElementById('calculate-boiler-btn');
const resultContainer = document.getElementById('result-container');
const resultTableBody = document.getElementById('result-table-body');
const standardReference = document.getElementById('standard-reference');
const calculationDetailsDiv = document.getElementById('calculation-details');

// Input fields
const unitSystemSelect = document.getElementById('unit-system');
const fuelInputRateInput = document.getElementById('fuel-input-rate');
const fuelHHVInput = document.getElementById('fuel-hhv');
const steamOutputRateInput = document.getElementById('steam-output-rate');
const enthalpySteamInput = document.getElementById('enthalpy-steam');
const enthalpyFeedwaterInput = document.getElementById('enthalpy-feedwater');

// NEW Industrial Analysis Inputs
const flueGasO2Input = document.getElementById('flue-gas-o2');
const stackTempInput = document.getElementById('stack-temp');
const ambientTempInput = document.getElementById('ambient-temp');
const casingLossPctInput = document.getElementById('casing-loss-pct');
const blowdownRatePctInput = document.getElementById('blowdown-rate-pct');
const enthalpyBlowdownInput = document.getElementById('enthalpy-blowdown');

const fuelCInput = document.getElementById('fuel-c');
const fuelHInput = document.getElementById('fuel-h');
const fuelSInput = document.getElementById('fuel-s');
const fuelOInput = document.getElementById('fuel-o');
const fuelNInput = document.getElementById('fuel-n');
const fuelWaterInput = document.getElementById('fuel-water');
const fuelCompTotalDiv = document.getElementById('fuel-comp-total');
const fuelCompInputs = document.querySelectorAll('.fuel-comp');

// Labels that change text
const fuelRateUnitLabel = document.querySelector('.fuel-rate-unit');
const hhvUnitLabel = document.querySelector('.hhv-unit');
const steamRateUnitLabel = document.querySelector('.steam-rate-unit');
const enthalpyUnitLabels = document.querySelectorAll('.enthalpy-unit');
const tempUnitLabels = document.querySelectorAll('.temp-unit');

/**
* Displays a custom message box at the top of the screen.
*/
function displayMessage(message, type = "info") {
let messageBox = document.getElementById('custom-message-box');
if (!messageBox) {
messageBox = document.createElement('div');
messageBox.id = 'custom-message-box';
document.body.appendChild(messageBox);
}
messageBox.textContent = message;
messageBox.className = 'show'; // Clear previous classes
messageBox.classList.add(type); // Add type class for styling

setTimeout(() => {
messageBox.style.opacity = 0;
messageBox.classList.remove('show');
}, 5000);
}

/**
* Converts an energy rate value from kJ/hr or BTU/hr to MW.
*/
function convertToMW(value, unitSystem) {
if (unitSystem === 'metric') {
return value / 3600000; // kJ/hr to MW
} else {
return value / 3412142; // BTU/hr to MW
}
}

/**
* Updates unit labels and input defaults based on selected unit system.
*/
function updateUnitLabelsAndDefaults() {
const unitSystem = unitSystemSelect.value;
const isMetric = unitSystem === 'metric';

// Update common units
fuelRateUnitLabel.textContent = isMetric ? '(kg/hr)' : '(lb/hr)';
hhvUnitLabel.textContent = isMetric ? '(kJ/kg)' : '(BTU/lb)';
steamRateUnitLabel.textContent = isMetric ? '(kg/hr)' : '(lb/hr)';
enthalpyUnitLabels.forEach(label => label.textContent = isMetric ? '(kJ/kg)' : '(BTU/lb)');
tempUnitLabels.forEach(label => label.textContent = isMetric ? '(°C)' : '(°F)');

// Set default values based on unit system
if (isMetric) {
fuelInputRateInput.value = "1000";
fuelHHVInput.value = "40000";
steamOutputRateInput.value = "5000";
enthalpySteamInput.value = "3200";
enthalpyFeedwaterInput.value = "200";
stackTempInput.value = "160";
ambientTempInput.value = "25";
enthalpyBlowdownInput.value = "850"; // Saturated liquid at ~20 bar
} else { // imperial
fuelInputRateInput.value = "2200";
fuelHHVInput.value = "17200";
steamOutputRateInput.value = "11000";
enthalpySteamInput.value = "1376";
enthalpyFeedwaterInput.value = "86"; // approx 200 kJ/kg -> 118F
stackTempInput.value = "320"; // ~160C
ambientTempInput.value = "77"; // 25C
enthalpyBlowdownInput.value = "365"; // Saturated liquid at ~290 psi
}
casingLossPctInput.value = "1.5";
blowdownRatePctInput.value = "3.0";
flueGasO2Input.value = "3.5";
// Fuel composition is mass-based, no change needed
fuelCInput.value = "85.0";
fuelHInput.value = "12.0";
fuelSInput.value = "0.5";
fuelOInput.value = "1.0";
fuelNInput.value = "1.0";
fuelWaterInput.value = "0.5";
updateFuelCompTotal();
}

/**
* Updates the total percentage for fuel composition inputs.
*/
function updateFuelCompTotal() {
let total = 0;
fuelCompInputs.forEach(input => {
total += parseFloat(input.value) || 0;
});
fuelCompTotalDiv.textContent = `Total: ${total.toFixed(1)}%`;
if (Math.abs(total - 100.0) > 0.1) {
fuelCompTotalDiv.style.color = 'var(--fail-color)';
} else {
fuelCompTotalDiv.style.color = 'var(--success-color)';
}
}

// Event listeners
unitSystemSelect.addEventListener('change', updateUnitLabelsAndDefaults);
fuelCompInputs.forEach(input => {
input.addEventListener('input', updateFuelCompTotal);
});

// Initial UI setup on load
updateUnitLabelsAndDefaults();

/**
* Adds a row to the result table.
*/
function addResultRow(parameterHtml, valueHtml, rowClass = "") {
const row = resultTableBody.insertRow();
if (rowClass) {
row.className = rowClass;
}
const paramCell = row.insertCell();
const valueCell = row.insertCell();
paramCell.innerHTML = parameterHtml;
valueCell.innerHTML = valueHtml;
}

// --- Main Calculation Logic ---
calculateBtn.addEventListener('click', function() {
const form = document.getElementById('boiler-calculator-form');
if (!form.checkValidity()) {
displayMessage("Please fill in all required fields correctly.", "error");
form.reportValidity();
return;
}

// --- 1. Get All Inputs ---
const unitSystem = unitSystemSelect.value;
const M_fuel = parseFloat(fuelInputRateInput.value);
const HHV = parseFloat(fuelHHVInput.value);
const M_steam = parseFloat(steamOutputRateInput.value);
const h_steam = parseFloat(enthalpySteamInput.value);
const h_feedwater = parseFloat(enthalpyFeedwaterInput.value);

const flueGasO2 = parseFloat(flueGasO2Input.value);
const tStack = parseFloat(stackTempInput.value);
const tAmbient = parseFloat(ambientTempInput.value);
const casingLossPct = parseFloat(casingLossPctInput.value);
const blowdownRatePct = parseFloat(blowdownRatePctInput.value);
const h_blowdown = parseFloat(enthalpyBlowdownInput.value);

const fuelC = parseFloat(fuelCInput.value) / 100;
const fuelH = parseFloat(fuelHInput.value) / 100;
const fuelS = parseFloat(fuelSInput.value) / 100;
const fuelO = parseFloat(fuelOInput.value) / 100;
const fuelN = parseFloat(fuelNInput.value) / 100;
const fuelWater = parseFloat(fuelWaterInput.value) / 100;

// --- 2. Validation ---
let validationError = false;
const fuelCompSum = (fuelC + fuelH + fuelS + fuelO + fuelN + fuelWater) * 100;
if (Math.abs(fuelCompSum - 100.0) > 0.1) {
displayMessage("Fuel composition must sum to 100%.", "error");
validationError = true;
}
if (tStack <= tAmbient) {
displayMessage("Stack Temperature must be greater than Ambient Temperature.", "error");
validationError = true;
}
if (h_steam <= h_feedwater) {
displayMessage("Steam Enthalpy must be greater than Feedwater Enthalpy.", "error");
validationError = true;
}
if (h_blowdown <= h_feedwater) {
displayMessage("Boiler Water Enthalpy must be greater than Feedwater Enthalpy for blowdown to be a loss.", "error");
validationError = true;
}
if (validationError) return;

let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';

// --- 3. Define Constants based on Unit System ---
const isMetric = unitSystem === 'metric';
const massRateUnit = isMetric ? 'kg/hr' : 'lb/hr';
const energyPerMassUnit = isMetric ? 'kJ/kg' : 'BTU/lb';
const tempUnit = isMetric ? '°C' : '°F';
const totalEnergyUnit = isMetric ? 'kJ/hr' : 'BTU/hr';
const h_fg_water = isMetric ? 2442 : 1050; // Latent heat of vaporization for water (kJ/kg or BTU/lb)
const cp_flue_gas = isMetric ? 1.05 : 0.25; // Approx. specific heat of flue gas (kJ/kg·K or BTU/lb·R)
const cp_water_vapor = isMetric ? 1.93 : 0.46; // Approx. specific heat of water vapor
const latentHeatStdCond = isMetric ? 2257.06 : 970.3; // For Equivalent Evaporation

// --- 4. Shared Calculation: Heat Input (Q_input) ---
const Q_input_fuel = M_fuel * HHV;
const Q_input_fuel_MW = convertToMW(Q_input_fuel, unitSystem);
calculationHtml += `<p><strong>1. Calculate Total Heat Input from Fuel (Q<sub>input, fuel</sub>):</strong></p>
<p class="formula">$$ Q_{input, fuel} = M_{fuel} \\times HHV $$</p>
<p class="calculation-step">
\\( Q_{input, fuel} \\) = ${M_fuel.toFixed(2)} ${massRateUnit} \\( \\times \\) ${HHV.toFixed(2)} ${energyPerMassUnit} = ${Q_input_fuel.toFixed(2)} ${totalEnergyUnit}
</p>`;

// --- 5. Direct Method Calculations ---
calculationHtml += `<hr style="border: 1px solid var(--border-color); margin: 20px 0;"><h4>Direct Method (Input-Output) Analysis:</h4>`;

// 5.1. Heat Absorbed by Process Fluid (Q_output, direct)
const Q_output_direct = M_steam * (h_steam - h_feedwater);
const Q_output_direct_MW = convertToMW(Q_output_direct, unitSystem);
calculationHtml += `<p><strong>2. Calculate Direct Heat Duty (Q<sub>output, direct</sub>) (from Steam):</strong></p>
<p class="formula">$$ Q_{output, direct} = M_{steam} \\times (h_{steam} - h_{feedwater}) $$</p>
<p class="calculation-step">
\\( Q_{output, direct} \\) = ${M_steam.toFixed(2)} ${massRateUnit} \\( \\times \\) (${h_steam.toFixed(2)} - ${h_feedwater.toFixed(2)}) ${energyPerMassUnit} = ${Q_output_direct.toFixed(2)} ${totalEnergyUnit}
</p>`;

// 5.2. Direct Efficiency
const Efficiency_direct = (Q_output_direct / Q_input_fuel) * 100;
calculationHtml += `<p><strong>3. Calculate Direct Thermal Efficiency (\\(\\eta_{direct}\\)):</strong></p>
<p class="formula">$$ \\eta_{direct} = \\frac{Q_{output, direct}}{Q_{input, fuel}} \\times 100 \\% $$</p>
<p class="calculation-step">
\\( \\eta_{direct} \\) = (${Q_output_direct.toFixed(2)} / ${Q_input_fuel.toFixed(2)}) \\( \\times \\) 100 % = ${Efficiency_direct.toFixed(2)} %
</p>`;

// 5.3. Equivalent Evaporation
const equivalentEvaporation = (Q_output_direct / latentHeatStdCond);
const equivEvapUnit = isMetric ? 'kg/hr' : 'lb/hr';
calculationHtml += `<p><strong>4. Calculate Equivalent Evaporation (From and At 100°C / 212°F):</strong></p>
<p class="formula">\\[ M_{equiv} = \\frac{Q_{output, direct}}{h_{fg,std}} \\]</p>
<p class="calculation-step">
\\( M_{equiv} \\) = ${Q_output_direct.toFixed(2)} ${totalEnergyUnit} / ${latentHeatStdCond.toFixed(2)} ${energyPerMassUnit} = ${equivalentEvaporation.toFixed(2)} ${equivEvapUnit}
</p>`;


// --- 6. Indirect Method Calculations ---
calculationHtml += `<hr style="border: 1px solid var(--border-color); margin: 20px 0;"><h4>Indirect (Heat Loss) Method Analysis:</h4>`;

// 6.1. Combustion Calculation
const TA = 11.53 * fuelC + 34.3 * fuelH + 4.3 * fuelS - 4.3 * fuelO;
const EA_pct = (flueGasO2 / (21 - flueGasO2)) * 100;
const AA = TA * (1 + EA_pct / 100);
const M_dry_flue = AA * (1 - 0.21) + (fuelC * 3.67) + (fuelS * 2.0) + fuelN; // N2 from air + CO2 + SO2 + N2 from fuel
const M_H2O_from_H = fuelH * 8.94; // Water from H combustion
const M_H2O_total = M_H2O_from_H + fuelWater; // Water from H + water in fuel
const M_flue_total = M_dry_flue + M_H2O_total; // Total mass of flue gas per kg/lb fuel

calculationHtml += `<p><strong>5. Combustion Calculation (per ${isMetric ? 'kg' : 'lb'} of fuel):</strong></p>
<p class="formula">$$ TA = 11.53C + 34.3H + 4.3S - 4.3O $$
$$ EA\\% = \\frac{O_2\\%}{21 - O_2\\%} \\times 100 $$
$$ AA = TA \\times (1 + EA\\%/100) $$
$$ M_{dry\\_flue} \\approx AA(0.79) + CO_2 + SO_2 + N_2 $$
$$ M_{H2O} = (H \\times 8.94) + W $$</p>
<p class="calculation-step">
Theoretical Air (TA) = ${TA.toFixed(3)} ${isMetric ? 'kg' : 'lb'} air / ${isMetric ? 'kg' : 'lb'} fuel<br>
Excess Air (EA) = ${EA_pct.toFixed(2)} %<br>
Actual Air (AA) = ${AA.toFixed(3)} ${isMetric ? 'kg' : 'lb'} air / ${isMetric ? 'kg' : 'lb'} fuel<br>
Mass of Dry Flue Gas (M<sub>dry_flue</sub>) = ${M_dry_flue.toFixed(3)} ${isMetric ? 'kg' : 'lb'} / ${isMetric ? 'kg' : 'lb'} fuel<br>
Mass of Water Vapor (M<sub>H2O</sub>) = ${M_H2O_total.toFixed(3)} ${isMetric ? 'kg' : 'lb'} / ${isMetric ? 'kg' : 'lb'} fuel
</p>`;

// 6.2. Stack Loss Calculation (L1 + L2)
const delta_T_stack = tStack - tAmbient;
// L1: Dry Gas Loss (Sensible Heat)
const q_loss_dry_gas = M_dry_flue * cp_flue_gas * delta_T_stack; // (kJ / kg fuel)
const Q_loss_dry_gas = q_loss_dry_gas * M_fuel; // (kJ/hr)
// L2: Water Vapor Loss (Latent + Sensible)
const q_loss_water = M_H2O_total * (h_fg_water + cp_water_vapor * delta_T_stack); // (kJ / kg fuel)
const Q_loss_water = q_loss_water * M_fuel; // (kJ/hr)

const Q_loss_stack_total = Q_loss_dry_gas + Q_loss_water;
const Q_loss_stack_total_MW = convertToMW(Q_loss_stack_total, unitSystem);
const Q_loss_stack_pct = (Q_loss_stack_total / Q_input_fuel) * 100;

calculationHtml += `<p><strong>6. Calculate Stack Losses (L1 + L2):</strong></p>
<p class="formula">$$ Q_{L1, dry} = (M_{dry\\_flue} \\times C_{p,gas} \\times \\Delta T) \\times M_{fuel} $$
$$ Q_{L2, water} = (M_{H2O} \\times (h_{fg} + C_{p,vapor} \\times \\Delta T)) \\times M_{fuel} $$</p>
<p class="calculation-step">
Stack $\\Delta T$ = ${tStack.toFixed(1)} - ${tAmbient.toFixed(1)} = ${delta_T_stack.toFixed(1)} ${isMetric ? '°C' : '°F'}<br>
Loss L1 (Dry Gas) = ${q_loss_dry_gas.toFixed(2)} ${energyPerMassUnit} * ${M_fuel.toFixed(2)} = ${Q_loss_dry_gas.toFixed(2)} ${totalEnergyUnit}<br>
Loss L2 (Water Vapor) = ${q_loss_water.toFixed(2)} ${energyPerMassUnit} * ${M_fuel.toFixed(2)} = ${Q_loss_water.toFixed(2)} ${totalEnergyUnit}<br>
Total Stack Loss (L1+L2) = ${Q_loss_stack_total.toFixed(2)} ${totalEnergyUnit} (${Q_loss_stack_pct.toFixed(2)}% of Input)
</p>`;

// 6.3. Casing Loss (L3)
const Q_loss_casing = Q_input_fuel * (casingLossPct / 100);
const Q_loss_casing_MW = convertToMW(Q_loss_casing, unitSystem);
const Q_loss_casing_pct = casingLossPct;
calculationHtml += `<p><strong>7. Calculate Casing (Radiation) Loss (L3):</strong></p>
<p class="formula">$$ Q_{L3, casing} = Q_{input, fuel} \\times \\frac{\\text{Casing Loss %}}{100} $$</p>
<p class="calculation-step">
\\( Q_{L3, casing} \\) = ${Q_input_fuel.toFixed(2)} ${totalEnergyUnit} \\( \\times \\) ${casingLossPct.toFixed(1)}% = ${Q_loss_casing.toFixed(2)} ${totalEnergyUnit} (${Q_loss_casing_pct.toFixed(2)}% of Input)
</p>`;

// 6.4. Blowdown Loss (L4)
const M_feedwater = M_steam / (1 - (blowdownRatePct / 100));
const M_blowdown = M_feedwater - M_steam;
const Q_loss_blowdown = M_blowdown * (h_blowdown - h_feedwater);
const Q_loss_blowdown_MW = convertToMW(Q_loss_blowdown, unitSystem);
const Q_loss_blowdown_pct = (Q_loss_blowdown / Q_input_fuel) * 100;

calculationHtml += `<p><strong>8. Calculate Blowdown Loss (L4):</strong></p>
<p class="formula">$$ M_{feedwater} = \\frac{M_{steam}}{1 - (BD\\% / 100)} $$
$$ M_{blowdown} = M_{feedwater} - M_{steam} $$
$$ Q_{L4, blowdown} = M_{blowdown} \\times (h_{blowdown} - h_{feedwater}) $$</p>
<p class="calculation-step">
Feedwater Flow (M<sub>fw</sub>) = ${M_steam.toFixed(2)} / (1 - ${blowdownRatePct}/100) = ${M_feedwater.toFixed(2)} ${massRateUnit}<br>
Blowdown Flow (M<sub>bd</sub>) = ${M_feedwater.toFixed(2)} - ${M_steam.toFixed(2)} = ${M_blowdown.toFixed(2)} ${massRateUnit}<br>
Loss L4 (Blowdown) = ${M_blowdown.toFixed(2)} * (${h_blowdown.toFixed(2)} - ${h_feedwater.toFixed(2)}) = ${Q_loss_blowdown.toFixed(2)} ${totalEnergyUnit} (${Q_loss_blowdown_pct.toFixed(2)}% of Input)
</p>`;

// 6.5. Total Losses & Indirect Efficiency
const Q_loss_total = Q_loss_stack_total + Q_loss_casing + Q_loss_blowdown;
const Q_loss_total_MW = convertToMW(Q_loss_total, unitSystem);
const Q_output_indirect = Q_input_fuel - Q_loss_total;
const Q_output_indirect_MW = convertToMW(Q_output_indirect, unitSystem);
const Efficiency_indirect = (Q_output_indirect / Q_input_fuel) * 100;
const Total_loss_pct = (Q_loss_total / Q_input_fuel) * 100;

calculationHtml += `<p><strong>9. Calculate Indirect Efficiency (\\(\\eta_{indirect}\\)):</strong></p>
<p class="formula">$$ Q_{loss, total} = Q_{L1+L2} + Q_{L3} + Q_{L4} $$
$$ \\eta_{indirect} = 100\\% - \\%_{Loss, total} $$</p>
<p class="calculation-step">
Total Loss % = ${Q_loss_stack_pct.toFixed(2)}% + ${Q_loss_casing_pct.toFixed(2)}% + ${Q_loss_blowdown_pct.toFixed(2)}% = ${Total_loss_pct.toFixed(2)} %<br>
Indirect Efficiency (\\(\\eta_{indirect}\\)) = 100% - ${Total_loss_pct.toFixed(2)}% = ${Efficiency_indirect.toFixed(2)} %
</p>`;

// 6.6. Reconciliation
const Q_unaccounted = Q_output_indirect - Q_output_direct;
const Q_unaccounted_MW = convertToMW(Q_unaccounted, unitSystem);
const Q_unaccounted_pct = (Q_unaccounted / Q_input_fuel) * 100;

calculationHtml += `<hr style="border: 1px solid var(--border-color); margin: 20px 0;"><h4>Reconciliation & Discrepancy Analysis:</h4>`;
calculationHtml += `<p><strong>10. Calculate Discrepancy:</strong></p>
<p class="formula">$$ Q_{unaccounted} = Q_{output, indirect} - Q_{output, direct} $$</p>
<p class="calculation-step">
Discrepancy (Q<sub>unaccounted</sub>) = ${Q_output_indirect.toFixed(2)} - ${Q_output_direct.toFixed(2)} = ${Q_unaccounted.toFixed(2)} ${totalEnergyUnit}<br>
Discrepancy as % of Input = ${Q_unaccounted_pct.toFixed(2)} %
</p>
<p style="font-size: 0.9em; margin-top: 10px;"><em>A large discrepancy (e.g., > 2%) suggests instrumentation errors (flow, temp), or other unmeasured losses (e.g., unburnt fuel, air ingress).</em></p>`;

// --- 7. Populate Results Table ---
calculationDetailsDiv.innerHTML = calculationHtml;
resultTableBody.innerHTML = '';
addResultRow("Unit System", unitSystem === 'imperial' ? 'Imperial' : 'Metric');
addResultRow("<strong>1. Fuel Heat Input (Q<sub>input</sub>)</strong>", `<strong>${Q_input_fuel.toFixed(2)} ${totalEnergyUnit} (${Q_input_fuel_MW.toFixed(3)} MW)</strong>`);
addResultRow("<strong>2. Direct Heat Duty (Q<sub>out, direct</sub>)</strong> <br> (from Steam)", `<strong>${Q_output_direct.toFixed(2)} ${totalEnergyUnit} (${Q_output_direct_MW.toFixed(3)} MW)</strong>`);
addResultRow("<strong>3. Indirect Heat Duty (Q<sub>out, indirect</sub>)</strong> <br> (from Heat Loss Method)", `<strong>${Q_output_indirect.toFixed(2)} ${totalEnergyUnit} (${Q_output_indirect_MW.toFixed(3)} MW)</strong>`);
addResultRow("<strong>Total Calculated Losses (L1-L4)</strong>", `<strong>${Q_loss_total.toFixed(2)} ${totalEnergyUnit} (${Total_loss_pct.toFixed(2)}%)</strong>`);
addResultRow("... L1: Dry Flue Gas Loss", `... ${Q_loss_dry_gas.toFixed(2)} ${totalEnergyUnit} (${(Q_loss_dry_gas/Q_input_fuel*100).toFixed(2)}%)`);
addResultRow("... L2: Water Vapor Loss", `... ${Q_loss_water.toFixed(2)} ${totalEnergyUnit} (${(Q_loss_water/Q_input_fuel*100).toFixed(2)}%)`);
addResultRow("... L3: Casing Loss", `... ${Q_loss_casing.toFixed(2)} ${totalEnergyUnit} (${Q_loss_casing_pct.toFixed(2)}%)`);
addResultRow("... L4: Blowdown Loss", `... ${Q_loss_blowdown.toFixed(2)} ${totalEnergyUnit} (${Q_loss_blowdown_pct.toFixed(2)}%)`);
addResultRow("<strong>Direct Efficiency (\\(\\eta_{direct}\\))</strong>", `<strong>${Efficiency_direct.toFixed(2)} %</strong>`, "highlight-row");
addResultRow("<strong>Indirect Efficiency (\\(\\eta_{indirect}\\))</strong>", `<strong>${Efficiency_indirect.toFixed(2)} %</strong>`, "highlight-row");
addResultRow("<strong>Discrepancy (Unaccounted Loss)</strong> <br> (Indirect Duty - Direct Duty)", `<strong>${Q_unaccounted.toFixed(2)} ${totalEnergyUnit} (${Q_unaccounted_MW.toFixed(3)} MW)</strong>`, "discrepancy-row");
addResultRow("Discrepancy as % of Heat Input", `<strong>${Q_unaccounted_pct.toFixed(2)} %</strong>`, "discrepancy-row");
addResultRow("<strong>Equivalent Evaporation</strong>", `<strong>${equivalentEvaporation.toFixed(2)} ${equivEvapUnit}</strong>`);


// --- 8. Finalize and Show ---
if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
window.MathJax.typesetPromise([calculationDetailsDiv, resultTableBody]).catch(err => console.error("MathJax error: ", err));
}

// Populate the standard reference box
standardReference.innerHTML = `<h4>Key Considerations & Standards (ASME PTC 4)</h4>
<ul>
<li><strong>Direct Method (\\(\\eta_{direct}\\)):</strong> This value is highly dependent on the accuracy of steam, feedwater, and fuel flow data. It represents the heat *absorbed*.</li>
<li><strong>Indirect Method (\\(\\eta_{indirect}\\)):</strong> This value is dependent on flue gas analysis (O2, Temp) and fuel composition. It represents the heat *available* after major losses. It is often considered the more accurate measure of true thermal efficiency.</li>
<li><strong>Discrepancy:</strong> The difference between the two methods (ideally < 2%) is the most critical diagnostic tool.
<ul>
<li><strong>Large Positive (Indirect > Direct):</strong> May indicate steam flow is *over-reported*, or fuel flow is *under-reported*.</li>
<li><strong>Large Negative (Direct > Indirect):</strong> May indicate steam flow is *under-reported*, fuel flow is *over-reported*, or major unmeasured losses (e.g., high unburnt fuel, significant air ingress).</li>
</ul>
</li>
<li><strong>Controllable Losses:</strong> The primary targets for efficiency improvements are <strong>L1 (Dry Flue Gas)</strong>, by reducing excess O2 and stack temp (via economizers/APH), and <strong>L4 (Blowdown)</strong>, by optimizing water chemistry to reduce the blowdown rate.</li>
</ul>
<p><strong>Disclaimer:</strong> This tool is for educational and estimation purposes. All results must be verified by a qualified engineer using certified plant data and rigorous adherence to standards like ASME PTC 4 for any contractual or regulatory reporting.</p>`;

resultContainer.classList.add('show');
resultContainer.scrollIntoView({ behavior: 'smooth' });
displayMessage("Boiler performance analysis completed!", "info");

});

// --- Theme switch functionality ---
const themeSwitch = document.getElementById('theme-switch');
if (themeSwitch) {
// Set initial theme based on local storage
const currentTheme = localStorage.getItem('theme');
if (currentTheme === 'dark-mode') {
document.body.classList.add('dark-mode');
themeSwitch.checked = true;
} else {
document.body.classList.remove('dark-mode');
themeSwitch.checked = false;
}
// Add listener for theme change
themeSwitch.addEventListener('change', function() {
if (this.checked) {
document.body.classList.add('dark-mode');
localStorage.setItem('theme', 'dark-mode');
} else {
document.body.classList.remove('dark-mode');
localStorage.setItem('theme', 'light-mode');
}
});
}
});
</script>
</body>
</html>
