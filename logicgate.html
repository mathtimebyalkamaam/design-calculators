<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial PLC Logic Simulator & Circuit Synthesizer</title>
    <meta name="description" content="Professional Boolean Logic Analyzer. Features Logic Synthesis from K-Maps, Hazard Detection, True Circuit Diagram Generation, and Multi-Platform PLC Code Export (AB, Siemens, IEC).">
    <meta name="keywords" content="PLC Logic Simulator, Logic Synthesis, Static Hazard Detection, Karnaugh Map Solver, Boolean Minimization, Ladder Logic Generator, Digital Circuit Design, Automation Engineering">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/logicgate" />

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial) --- */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content & Cards */
        main { padding: 30px 0; }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        h4 {
            color: var(--heading);
            font-size: 1.1rem;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        /* Layout Grid */
        .app-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 25px;
        }
        @media (max-width: 1024px) {
            .app-layout { grid-template-columns: 1fr; }
        }

        /* Input Panel */
        .input-panel {
            background: var(--bg);
            border-radius: 8px;
            border: 1px solid var(--border);
            padding: 20px;
        }
        .form-section { margin-bottom: 25px; }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--heading);
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--card);
            color: var(--text);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        .form-group input { font-family: 'Courier New', monospace; font-weight: bold; }
        .form-group input:focus { border-color: var(--primary); outline: none; }

        /* Simulator Controls */
        .sim-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
        }
        .switch-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--card);
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            min-width: 60px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px; width: 16px;
            left: 2px; bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider { background-color: var(--secondary); }
        input:checked + .toggle-slider:before { transform: translateX(20px); }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid var(--border); }
        .tab-btn {
            padding: 10px 20px;
            cursor: pointer;
            background: none;
            border: none;
            font-weight: 600;
            color: var(--text);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s; }

        /* K-Map & Truth Table */
        .grid-table {
            width: 100%;
            border-collapse: collapse;
            font-family: monospace;
            font-size: 0.95rem;
        }
        .grid-table th, .grid-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid var(--border);
        }
        .grid-table th { background: var(--grad); color: white; }
        .grid-table tr:nth-child(even) { background-color: var(--bg); }
        .cell-true { background-color: rgba(16, 185, 129, 0.2); color: var(--success); font-weight: bold; }
        .cell-false { color: var(--danger); }
        .cell-interactive { cursor: pointer; transition: background 0.2s; }
        .cell-interactive:hover { background-color: var(--secondary); color: white; }
        .active-row { background-color: rgba(37,99,235,0.2) !important; border: 2px solid var(--secondary); }

        /* Circuit Canvas */
        #circuitCanvas {
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid var(--border);
            width: 100%;
            height: 500px;
        }
        body.dark-mode #circuitCanvas { background-color: #1e293b; }

        /* Code Block */
        .code-block {
            background: #1E293B;
            color: #E2E8F0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            border-left: 4px solid var(--accent);
            white-space: pre-wrap;
            margin-bottom: 10px;
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s;
            width: 100%;
            text-align: center;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-outline {
            background: transparent; border: 2px solid var(--secondary); color: var(--secondary);
            padding: 8px 15px; font-size: 0.9rem; width: auto; display: inline-block; cursor: pointer; border-radius: 6px;
        }
        .btn-outline:hover { background: var(--secondary); color: white; }

        /* Education */
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .insight-card h4 { color: var(--secondary); margin: 0 0 15px 0; font-family: 'Montserrat', sans-serif; }
        .insight-card p, .insight-card ul { line-height: 1.8; color: var(--text); }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 15px; font-weight: 700; }
        .footer-col ul { list-style: none; padding: 0; margin: 0; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: color 0.3s; }
        .footer-col a:hover { color: var(--accent); }
        .social-buttons { display: flex; gap: 12px; margin-top: 15px; }
        .social-btn {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            font-size: 1.1rem; transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover { transform: translateY(-4px); }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center; padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px; margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center; padding-top: 20px;
            font-size: 0.9rem; color: #94A3B8;
        }

        @media (max-width: 768px) {
            .app-layout { grid-template-columns: 1fr; }
            .tabs { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href='/articles'>Articles</a></li>
                    <li><a href='/indexmech'>Mechanical</a></li>
                    <li><a href='/indexele'>Electrical</a></li>
                    <li><a href='/indexinst'>Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-microchip"></i> Professional Logic Simulator & Circuit Synthesizer</h2>
            <div class="tool-description">
                <p>An industrial-grade Boolean Analyzer. Features <strong>Logic Synthesis</strong> (create logic by clicking K-Map cells), <strong>Hazard Detection</strong>, true <strong>Circuit Diagram Generation</strong>, and multi-dialect <strong>PLC Code Export</strong> (AB, Siemens, IEC).</p>
            </div>
        </div>

        <div class="app-layout">
            <!-- LEFT: INPUT & CONTROLS -->
            <div class="input-panel">
                <div class="form-section">
                    <h4><i class="fas fa-code"></i> Logic Definition</h4>
                    <div class="form-group">
                        <label>Boolean Expression <small>(or Edit K-Map)</small></label>
                        <input type="text" id="expression-input" value="(A AND B) OR (C AND NOT D)" placeholder="e.g. A AND B OR C">
                        <small style="color:var(--text); margin-top:5px; display:block;">Syntax: AND, OR, NOT, XOR, NAND, NOR, ( )</small>
                    </div>
                    <button onclick="runAnalysis()" class="btn">Analyze & Build Circuit</button>
                    <div style="margin-top:10px; display:flex; gap:10px; justify-content:center;">
                        <button onclick="saveProject()" class="btn btn-outline" style="flex:1"><i class="fas fa-save"></i> Save</button>
                        <button onclick="loadProject()" class="btn btn-outline" style="flex:1"><i class="fas fa-folder-open"></i> Load</button>
                        <button onclick="generatePDFReport()" class="btn btn-outline" style="flex:1"><i class="fas fa-file-pdf"></i> Report</button>
                    </div>
                    <input type="file" id="file-input" style="display:none;" onchange="handleFileLoad(this)">
                </div>

                <div class="form-section" id="sim-section" style="display:none;">
                    <h4><i class="fas fa-toggle-on"></i> I/O Simulator</h4>
                    <div class="sim-controls" id="switch-board"></div>
                    <div style="margin-top:15px; text-align:center;">
                        <span style="font-weight:bold; color:var(--text);">OUTPUT Q: </span>
                        <span id="sim-output" style="font-weight:800; font-size:1.4rem; color:var(--primary);">--</span>
                    </div>
                </div>

                <div class="form-section" id="min-section" style="display:none;">
                    <h4><i class="fas fa-microscope"></i> Logic Diagnostics</h4>
                    <div style="background:var(--card); padding:10px; border:1px solid var(--border); border-radius:6px; margin-bottom:10px;">
                        <label style="font-size:0.8rem; display:block; color:var(--text); margin-bottom:5px;">Static Hazards (Glitches)</label>
                        <div id="hazard-report" style="font-weight:bold; color:var(--text); font-size:0.9rem;">--</div>
                    </div>
                    <div style="background:var(--card); padding:10px; border:1px solid var(--border); border-radius:6px;">
                        <label style="font-size:0.8rem; display:block; color:var(--text); margin-bottom:5px;">Minimized (SOP)</label>
                        <div id="minimized-output" style="font-family:monospace; font-weight:bold; color:var(--success); font-size:1rem; word-break:break-all;">--</div>
                        <div id="gate-cost" style="font-size:0.8rem; color:var(--text); margin-top:5px;">--</div>
                    </div>
                </div>
            </div>

            <!-- RIGHT: TABS & VISUALS -->
            <div class="results-panel">
                <div class="card" style="min-height:700px;">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="showTab('circuit')"><i class="fas fa-project-diagram"></i> Circuit</button>
                        <button class="tab-btn" onclick="showTab('tt')"><i class="fas fa-table"></i> Truth Table</button>
                        <button class="tab-btn" onclick="showTab('kmap')"><i class="fas fa-th"></i> K-Map (Edit)</button>
                        <button class="tab-btn" onclick="showTab('plc')"><i class="fas fa-file-code"></i> PLC Code</button>
                        <button class="tab-btn" onclick="showTab('calc')"><i class="fas fa-calculator"></i> Eng. Log</button>
                    </div>

                    <!-- TAB 1: Circuit -->
                    <div id="tab-circuit" class="tab-content active">
                        <div style="margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:0.9rem; font-weight:bold; color:var(--text);">Schematic View</span>
                            <div>
                                <select id="symbol-style" onchange="runAnalysis()" style="padding:5px; border-radius:4px;">
                                    <option value="ansi">ANSI (Shapes)</option>
                                    <option value="iec">IEC (Rectangles)</option>
                                </select>
                            </div>
                        </div>
                        <canvas id="circuitCanvas"></canvas>
                    </div>

                    <!-- TAB 2: Truth Table -->
                    <div id="tab-tt" class="tab-content">
                        <div style="overflow-x:auto; max-height:400px;">
                            <table class="grid-table" id="truth-table">
                                <thead id="tt-head"></thead>
                                <tbody id="tt-body"></tbody>
                            </table>
                        </div>
                        <h4 style="margin-top:20px; font-size:1rem;">Timing Diagram (Clock Cycle)</h4>
                        <div class="chart-container" style="height:200px;">
                            <canvas id="timingChart"></canvas>
                        </div>
                    </div>

                    <!-- TAB 3: K-Map -->
                    <div id="tab-kmap" class="tab-content">
                        <p style="font-size:0.85rem; color:var(--text); text-align:center; margin-bottom:10px; padding:10px; background:rgba(37,99,235,0.1); border-radius:4px;">
                            <i class="fas fa-mouse-pointer"></i> <strong>Interactive Mode:</strong> Click any cell to toggle logic state (0/1). The Expression and Circuit will update instantly.
                        </p>
                        <div id="kmap-container" style="overflow-x:auto; display:flex; justify-content:center; padding:20px;"></div>
                    </div>

                    <!-- TAB 4: PLC Code -->
                    <div id="tab-plc" class="tab-content">
                        <div style="margin-bottom:15px;">
                            <label style="font-weight:bold; margin-right:10px;">Target Platform:</label>
                            <select id="plc-dialect" onchange="updatePLCCode()" style="padding:5px;">
                                <option value="iec">IEC 61131-3 (Generic)</option>
                                <option value="ab">Allen-Bradley (Logix)</option>
                                <option value="siemens">Siemens (SCL)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Structured Text (ST/SCL)</label>
                            <div class="code-block" id="st-code"></div>
                        </div>
                        <div class="form-group">
                            <label>Ladder Logic (ASCII Approximation)</label>
                            <div class="code-block" id="ld-code"></div>
                        </div>
                    </div>

                    <!-- TAB 5: Eng Log -->
                    <div id="tab-calc" class="tab-content">
                        <div class="code-block" id="calc-log" style="background:#fff; color:#333; border:1px solid #ccc; height:500px; overflow-y:scroll;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT (Massive Engineering Reference) -->
        <div class="education-section card" style="margin-top:40px;">
            <h2><i class="fas fa-book-open"></i> Automation Engineering Reference Manual</h2>
            
            <div class="insight-card">
                <h4>1. Boolean Algebra in Industrial Automation</h4>
                <p>Programmable Logic Controllers (PLCs) rely fundamentally on Boolean Algebra to control machinery. Every sensor input (Limit Switch, Photocell, E-Stop) is treated as a binary variable (0 or 1). The logic combines these inputs to determine the state of outputs (Motors, Solenoids, Lamps).</p>
                
                <strong>Operator Precedence & Syntax</strong>
                <p>Standard order of operations in logic design is: <strong>NOT</strong> (Highest) → <strong>AND</strong> → <strong>XOR</strong> → <strong>OR</strong> (Lowest). Parentheses always override this order. </p>
                <ul>
                    <li><strong>AND (Product):</strong> Output is TRUE only if ALL inputs are TRUE. Used for series safety interlocks (e.g., Guard Closed AND Reset Pressed).</li>
                    <li><strong>OR (Sum):</strong> Output is TRUE if ANY input is TRUE. Used for parallel start conditions (e.g., Auto Start OR Manual Jog).</li>
                    <li><strong>XOR (Exclusive OR):</strong> Output is TRUE if inputs are different. Used for alternation logic (e.g., toggling between two pumps).</li>
                </ul>
            </div>

            <div class="insight-card">
                <h4>2. Logic Minimization & Quine-McCluskey</h4>
                <p>Writing logic is easy; optimizing it is engineering. Unoptimized logic wastes PLC memory and increases Scan Time. In complex safety systems, redundant terms can also obscure the true function of the code, making debugging harder.</p>
                <p>The <strong>Quine-McCluskey</strong> algorithm is a systematic method for minimization of boolean functions. Unlike Karnaugh Maps, which rely on visual pattern recognition (limited to 4-5 variables), Quine-McCluskey is tabular and algorithmic, making it suitable for computer implementation with any number of variables.</p>
                <p><strong>The Process:</strong></p>
                <ol>
                    <li>List all minterms (input combinations resulting in TRUE).</li>
                    <li>Group minterms by the number of 1s in their binary representation.</li>
                    <li>Compare adjacent groups. If two terms differ by exactly one bit (e.g., 0010 and 0011), combine them by replacing the differing bit with a dash (001-).</li>
                    <li>Repeat until no more combinations are possible. These are "Prime Implicants".</li>
                    <li>Use a Prime Implicant Chart to select the minimum set of implicants that cover all original minterms.</li>
                </ol>
            </div>

            <div class="insight-card">
                <h4>3. Logic Hazards (Static & Dynamic)</h4>
                <p>In the ideal world of boolean algebra, signals change instantly. In the real physical world, gates have propagation delays. A <strong>Hazard</strong> is a potential glitch in the output waveform caused by different path delays.</p>
                <ul>
                    <li><strong>Static-1 Hazard:</strong> The output is meant to stay HIGH (1), but momentarily drops to LOW (0) during an input transition. This happens when adjacent groupings in a K-Map do not overlap.</li>
                    <li><strong>Static-0 Hazard:</strong> The output is meant to stay LOW (0), but momentarily spikes HIGH (1).</li>
                </ul>
                <p><strong>Impact on PLCs:</strong> While standard PLC scans are often slow enough to mask nanosecond glitches, high-speed counter modules (HSC) or interrupt routines can falsely trigger on these hazards. In safety circuits, a static hazard could cause a relay to chatter or a safety latch to drop out unexpectedly.</p>
            </div>

            <div class="insight-card">
                <h4>4. IEC 61131-3 Programming Standards</h4>
                <p>The International Electrotechnical Commission (IEC) standard 61131-3 unifies PLC programming across vendors. This tool supports code generation for the most common dialects.</p>
                
                <strong>Structured Text (ST)</strong>
                <p>A high-level textual language similar to Pascal or C. It is the most powerful language for complex algorithms, math, and data handling.
                <br><em>Example:</em> <code>IF (Start_Btn AND NOT E_Stop) THEN Motor := TRUE; END_IF;</code></p>
                
                <strong>Ladder Diagram (LD)</strong>
                <p>A graphical language mimicking relay logic schematics. It is preferred for boolean interlocks because it visually represents power flow, making it easy for electricians to troubleshoot.
                <br><em>Logic:</em> Contacts (-| |-) represent inputs, Coils (-( )-) represent outputs.</p>
                
                <strong>Instruction List (IL) / Statement List (STL)</strong>
                <p>An assembly-like language. Although deprecated in the latest IEC standard, it remains prevalent in legacy Siemens S7-300/400 systems.
                <br><em>Example:</em> <code>A I0.0 (And Input 0.0)</code> / <code>= Q0.0 (Assign Output 0.0)</code>.</p>
            </div>

            <div class="insight-card">
                <h4>5. Safety Logic Patterns (Fail-Safe Design)</h4>
                <p>Designing for safety requires inverting standard logic thinking. We design for the "Loss of Signal".</p>
                <ul>
                    <li><strong>Stop Buttons:</strong> Always wired Normally Closed (NC). In normal operation, the input is TRUE (1). Logic: <code>IF NOT Stop_Input THEN Shutdown;</code>. If the wire breaks, the input becomes FALSE (0), triggering the stop automatically.</li>
                    <li><strong>Permissives:</strong> Logic that must be TRUE to allow an action. <code>Run_Cmd := Start AND Hydraulic_Pressure_OK AND Guard_Closed;</code></li>
                    <li><strong>De Morgan's Theorem in Safety:</strong> Often used to simplify NOT logic.
                        <br><code>NOT (A OR B)</code> is equivalent to <code>(NOT A) AND (NOT B)</code>.
                        <br>This transforms a parallel "Fault OR Fault" condition into a series "Healthy AND Healthy" chain, which is safer and easier to read.</li>
                </ul>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">Industrial grade engineering tools.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href='/indexele'>Electrical</a></li>
                        <li><a href='/indexmech'>Mechanical</a></li>
                        <li><a href='/indexinst'>Instrumentation</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href='/about'>About Us</a></li>
                        <li><a href='/contact'>Contact</a></li>
                        <li><a href="faq">FAQ.html</a></li>
                        <li><a href='/privacy-policy'>Privacy Policy</a></li>
                        <li><a href='/terms-of-service'>Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>Tools for educational and estimation purposes. Verify all safety logic professionally.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- GLOBAL STATE ---
        let currentVars = [];
        let currentMinterms = [];
        let timingChart = null;
        let astRoot = null;

        // --- AST NODE CLASS ---
        class LogicNode {
            constructor(type, value, left = null, right = null) {
                this.type = type; // 'OP', 'VAR', 'NOT'
                this.value = value; // 'AND', 'OR', 'A', etc.
                this.left = left;
                this.right = right;
                this.x = 0;
                this.y = 0;
            }
        }

        // --- INIT & URL HANDLING ---
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const expr = params.get('expr');
            if(expr) {
                document.getElementById('expression-input').value = decodeURIComponent(expr);
            }
            runAnalysis();
        };

        // --- PARSING (Recursive Descent for AST) ---
        function getVars(expr) {
            const tokens = expr.match(/[a-zA-Z_][a-zA-Z0-9_]*/g) || [];
            const keywords = ['AND', 'OR', 'NOT', 'XOR', 'NAND', 'NOR', 'XNOR'];
            const vars = new Set(tokens.filter(t => !keywords.includes(t.toUpperCase())));
            return Array.from(vars).sort();
        }

        function parseToAST(expr) {
            let clean = expr.trim();
            while(clean.startsWith('(') && clean.endsWith(')') && isBalanced(clean.slice(1,-1))) {
                clean = clean.slice(1,-1).trim();
            }

            // Find split point (Lowest Precedence: OR)
            let splitIdx = findSplit(clean, ['OR', 'NOR', 'XOR']);
            if(splitIdx !== -1) {
                const op = clean.substring(splitIdx.start, splitIdx.end).toUpperCase();
                return new LogicNode('OP', op, 
                    parseToAST(clean.substring(0, splitIdx.start)), 
                    parseToAST(clean.substring(splitIdx.end))
                );
            }

            // Next Precedence: AND
            splitIdx = findSplit(clean, ['AND', 'NAND']);
            if(splitIdx !== -1) {
                const op = clean.substring(splitIdx.start, splitIdx.end).toUpperCase();
                return new LogicNode('OP', op, 
                    parseToAST(clean.substring(0, splitIdx.start)), 
                    parseToAST(clean.substring(splitIdx.end))
                );
            }

            // Next: NOT
            if(clean.toUpperCase().startsWith('NOT ')) {
                return new LogicNode('NOT', 'NOT', parseToAST(clean.substring(4)), null);
            }

            return new LogicNode('VAR', clean);
        }

        function findSplit(str, ops) {
            let depth = 0;
            for(let i=str.length-1; i>=0; i--) {
                if(str[i] === ')') depth++;
                else if(str[i] === '(') depth--;
                else if(depth === 0) {
                    for(let op of ops) {
                        if(str.toUpperCase().substring(i-op.length+1, i+1) === op) {
                            const before = str[i-op.length];
                            const after = str[i+1];
                            if((!before || before === ' ' || before === ')') && (!after || after === ' ' || after === '(')) {
                                return { start: i-op.length+1, end: i+1 };
                            }
                        }
                    }
                }
            }
            return -1;
        }

        function isBalanced(str) {
            let depth = 0;
            for(let c of str) {
                if(c==='(') depth++;
                if(c===')') depth--;
                if(depth < 0) return false;
            }
            return depth === 0;
        }

        // --- EVALUATION ---
        function evalLogic(expr, context) {
            let safeExpr = expr.toUpperCase();
            safeExpr = safeExpr.replace(/\bAND\b/g, '&&').replace(/\bOR\b/g, '||').replace(/\bNOT\b/g, '!').replace(/\bXOR\b/g, '^');
            safeExpr = safeExpr.replace(/(\w+)\s+NAND\s+(\w+)/g, '!($1 && $2)');
            safeExpr = safeExpr.replace(/(\w+)\s+NOR\s+(\w+)/g, '!($1 || $2)');
            
            for (let v of currentVars) {
                const val = context[v] ? '1' : '0';
                safeExpr = safeExpr.replace(new RegExp(`\\b${v.toUpperCase()}\\b`, 'g'), val);
            }
            try { return eval(safeExpr) ? 1 : 0; } catch (e) { return 0; }
        }

        // --- MAIN WORKFLOW ---
        function runAnalysis() {
            const input = document.getElementById('expression-input').value;
            if(!input.trim()) return;
            
            currentVars = getVars(input);
            if(currentVars.length > 4) { alert("Max 4 variables supported for visual K-Map."); return; }
            if(currentVars.length === 0) return;

            document.getElementById('sim-section').style.display = 'block';
            document.getElementById('min-section').style.display = 'block';
            setupSimulator();
            
            const { table, minterms } = generateTruthTable(input);
            currentMinterms = minterms;
            
            astRoot = parseToAST(input);
            drawCircuit();
            renderKMap(minterms);
            drawTiming(table);
            
            const minExpr = minimizeLogicIterative(minterms); // Enhanced Minimizer
            document.getElementById('minimized-output').innerText = minExpr || "0";
            
            generateLogs(input, minExpr, minterms);
            updatePLCCode();
        }

        // --- SIMULATOR ---
        function setupSimulator() {
            const board = document.getElementById('switch-board');
            board.innerHTML = '';
            currentVars.forEach(v => {
                board.innerHTML += `
                    <div class="switch-container">
                        <div style="font-weight:bold; margin-bottom:5px;">${v}</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="sw-${v}" onchange="updateSim()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>`;
            });
            updateSim();
        }

        function updateSim() {
            const context = {};
            currentVars.forEach(v => context[v] = document.getElementById(`sw-${v}`).checked);
            const res = evalLogic(document.getElementById('expression-input').value, context);
            const outEl = document.getElementById('sim-output');
            outEl.innerText = res ? "TRUE (1)" : "FALSE (0)";
            outEl.style.color = res ? "var(--success)" : "var(--danger)";
            
            const idx = parseInt(currentVars.map(v => context[v]?1:0).join(''), 2);
            document.querySelectorAll('#truth-table tr').forEach(r => r.classList.remove('active-row'));
            const row = document.getElementById(`tr-${idx}`);
            if(row) row.classList.add('active-row');
        }

        // --- TRUTH TABLE ---
        function generateTruthTable(expr) {
            const thead = document.getElementById('tt-head');
            const tbody = document.getElementById('tt-body');
            const minterms = [];
            const tableData = [];

            let h = '<tr>';
            currentVars.forEach(v => h += `<th>${v}</th>`);
            h += '<th>Output Q</th></tr>';
            thead.innerHTML = h;

            let b = '';
            const rows = 1 << currentVars.length;
            for(let i=0; i<rows; i++) {
                const ctx = {};
                let bits = i.toString(2).padStart(currentVars.length, '0').split('').map(Number);
                let rowHtml = `<tr id="tr-${i}">`;
                bits.forEach((bit, idx) => { ctx[currentVars[idx]] = bit === 1; rowHtml += `<td>${bit}</td>`; });
                const res = evalLogic(expr, ctx);
                tableData.push(res);
                if(res) minterms.push(i);
                rowHtml += `<td class="${res?'cell-true':'cell-false'}">${res}</td></tr>`;
                b += rowHtml;
            }
            tbody.innerHTML = b;
            return { table: tableData, minterms };
        }

        // --- K-MAP INTERACTIVE ---
        function renderKMap(minterms) {
            const container = document.getElementById('kmap-container');
            container.innerHTML = '';
            if(currentVars.length < 2) return;

            const gray2 = ['00', '01', '11', '10'];
            const gray1 = ['0', '1'];
            let rowVars, colVars, rowGray, colGray;
            
            if(currentVars.length === 2) {
                rowVars = [currentVars[0]]; colVars = [currentVars[1]]; rowGray = gray1; colGray = gray1;
            } else if (currentVars.length === 3) {
                rowVars = [currentVars[0]]; colVars = [currentVars[1], currentVars[2]]; rowGray = gray1; colGray = gray2;
            } else {
                rowVars = [currentVars[0], currentVars[1]]; colVars = [currentVars[2], currentVars[3]]; rowGray = gray2; colGray = gray2;
            }

            let html = `<table class="grid-table" style="width:auto;">`;
            html += `<tr><th>${rowVars.join('')}\\${colVars.join('')}</th>`;
            colGray.forEach(c => html += `<th>${c}</th>`);
            html += `</tr>`;

            rowGray.forEach((rCode) => {
                html += `<tr><th>${rCode}</th>`;
                colGray.forEach((cCode) => {
                    const bin = rCode + cCode; 
                    const val = parseInt(bin, 2);
                    const active = minterms.includes(val);
                    html += `<td class="cell-interactive ${active?'cell-true':''}" onclick="toggleMinterm(${val})">${active?1:0}</td>`;
                });
                html += `</tr>`;
            });
            html += `</table>`;
            container.innerHTML = html;
        }

        function toggleMinterm(idx) {
            if(currentMinterms.includes(idx)) {
                currentMinterms = currentMinterms.filter(m => m !== idx);
            } else {
                currentMinterms.push(idx);
                currentMinterms.sort((a,b)=>a-b);
            }
            const expr = minimizeLogicIterative(currentMinterms);
            document.getElementById('expression-input').value = expr;
            runAnalysis();
        }

        // --- IMPROVED LOGIC MINIMIZER (Iterative Reduction) ---
        function minimizeLogicIterative(minterms) {
            if(minterms.length === 0) return "FALSE";
            const rows = 1 << currentVars.length;
            if(minterms.length === rows) return "TRUE";
            
            // Convert minterms to binary strings
            let terms = minterms.map(m => m.toString(2).padStart(currentVars.length, '0'));
            
            // Basic merging loop (Quine-McCluskey simplified)
            // Look for terms differing by 1 bit, merge with dash '-'
            let merged = true;
            while(merged) {
                merged = false;
                let newTerms = new Set();
                let used = new Set();
                
                for(let i=0; i<terms.length; i++) {
                    for(let j=i+1; j<terms.length; j++) {
                        const diff = getBitDiff(terms[i], terms[j]);
                        if(diff !== -1) {
                            let newTerm = terms[i].substring(0, diff) + '-' + terms[i].substring(diff+1);
                            newTerms.add(newTerm);
                            used.add(terms[i]);
                            used.add(terms[j]);
                            merged = true;
                        }
                    }
                }
                // Add unused terms
                terms.forEach(t => { if(!used.has(t)) newTerms.add(t); });
                if(merged) terms = Array.from(newTerms);
            }

            // Convert back to expression
            if(terms.length === 0) return "FALSE";
            
            return terms.map(t => {
                let parts = [];
                for(let i=0; i<t.length; i++) {
                    if(t[i] === '1') parts.push(currentVars[i]);
                    else if(t[i] === '0') parts.push("NOT " + currentVars[i]);
                }
                return parts.length > 1 ? `(${parts.join(' AND ')})` : parts[0];
            }).join(' OR ');
        }

        function getBitDiff(a, b) {
            let diffCnt = 0;
            let idx = -1;
            for(let i=0; i<a.length; i++) {
                if(a[i] !== b[i]) {
                    diffCnt++;
                    idx = i;
                }
            }
            return diffCnt === 1 ? idx : -1;
        }

        // --- CIRCUIT RENDERER ---
        function drawCircuit() {
            const canvas = document.getElementById('circuitCanvas');
            const ctx = canvas.getContext('2d');
            const style = document.getElementById('symbol-style').value;
            
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = 500;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            
            if(!astRoot) return;

            // Draw Inputs Rail
            ctx.font = "14px Inter";
            ctx.strokeStyle = "#94A3B8";
            ctx.lineWidth = 2;
            
            currentVars.forEach((v, i) => {
                const y = 50 + (i * 60);
                ctx.fillStyle = "#E2E8F0";
                ctx.fillRect(20, y-15, 40, 30);
                ctx.strokeRect(20, y-15, 40, 30);
                ctx.fillStyle = "#000";
                ctx.fillText(v, 30, y+5);
                
                ctx.beginPath();
                ctx.moveTo(60, y);
                ctx.lineTo(canvas.width, y);
                ctx.strokeStyle = "#e2e8f0"; 
                ctx.stroke();
            });

            drawNode(ctx, astRoot, canvas.width - 100, canvas.height/2, 100, style);
        }

        function drawNode(ctx, node, x, y, size, style) {
            if(!node) return;
            
            if(node.type === 'VAR') {
                const varIdx = currentVars.indexOf(node.value);
                const railY = 50 + (varIdx * 60);
                ctx.beginPath();
                ctx.moveTo(x, y); 
                ctx.lineTo(x - 20, y);
                ctx.lineTo(x - 20, railY);
                ctx.lineTo(60, railY); 
                ctx.strokeStyle = "#334155";
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.arc(x-20, railY, 3, 0, 2*Math.PI);
                ctx.fillStyle = "#334155";
                ctx.fill();
                return;
            }

            ctx.fillStyle = "#FFF";
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 2;
            
            const w = 60;
            const h = 40;
            const leftX = x - w;
            
            if(style === 'iec') {
                ctx.fillRect(leftX, y - h/2, w, h);
                ctx.strokeRect(leftX, y - h/2, w, h);
                ctx.fillStyle = "#000";
                ctx.fillText(getIECSymbol(node.value), leftX + 20, y+5);
            } else {
                drawANSIGate(ctx, node.value, leftX, y, w, h);
            }

            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + 20, y);
            ctx.stroke();

            if(node.type === 'NOT') {
                drawNode(ctx, node.left, leftX, y, size, style);
            } else {
                drawNode(ctx, node.left, leftX - 20, y - 30, size, style);
                drawNode(ctx, node.right, leftX - 20, y + 30, size, style);
            }
        }

        function getIECSymbol(op) {
            if(op === 'AND') return '&';
            if(op === 'OR') return '>=1';
            if(op === 'NOT') return '1';
            if(op === 'XOR') return '=1';
            return op;
        }

        function drawANSIGate(ctx, op, x, y, w, h) {
            ctx.beginPath();
            if(op === 'AND') {
                ctx.moveTo(x, y-h/2);
                ctx.lineTo(x+w/2, y-h/2);
                ctx.arc(x+w/2, y, h/2, -Math.PI/2, Math.PI/2);
                ctx.lineTo(x, y+h/2);
                ctx.lineTo(x, y-h/2);
            } else if(op === 'OR') {
                ctx.moveTo(x, y-h/2);
                ctx.quadraticCurveTo(x+w/2, y-h/2, x+w, y);
                ctx.quadraticCurveTo(x+w/2, y+h/2, x, y+h/2);
                ctx.quadraticCurveTo(x+w/4, y, x, y-h/2);
            } else if (op === 'NOT') {
                ctx.moveTo(x, y-h/2);
                ctx.lineTo(x+w, y);
                ctx.lineTo(x, y+h/2);
                ctx.lineTo(x, y-h/2);
                ctx.moveTo(x+w+5, y);
                ctx.arc(x+w+5, y, 5, 0, 2*Math.PI);
            }
            ctx.fillStyle = "#eff6ff";
            ctx.fill();
            ctx.stroke();
            
            if(op!=='NOT') {
                ctx.fillStyle = "#666";
                ctx.font = "10px sans-serif";
                ctx.fillText(op, x+10, y+4);
            }
        }

        // --- PLC EXPORT & LOGS ---
        function updatePLCCode() {
            const dialect = document.getElementById('plc-dialect').value;
            const minExpr = document.getElementById('minimized-output').innerText;
            const logic = (minExpr && minExpr !== "0" && minExpr !== "False" && minExpr !== "FALSE") ? minExpr : "FALSE";

            let st = "", ld = "";
            
            if(dialect === 'iec') {
                st = `// IEC 61131-3 Structured Text\n// Logic for Q\nQ := ${logic};`;
                ld = `// Generic Ladder\n|  ${logic}  | -> (Q)`;
            } else if (dialect === 'ab') {
                st = `// Logix Designer ST\nQ := ${logic};`;
                ld = `// Allen-Bradley Ladder\n// Use XIC/XIO corresponding to: ${logic}`;
            } else if (dialect === 'siemens') {
                st = `// Siemens SCL\n"Q" := ${logic.replace(/AND/g, '&').replace(/OR/g, 'OR').replace(/NOT/g, 'NOT')};`;
                ld = `// TIA Portal LAD\nNetwork 1: Logic\n${logic}`;
            }
            
            document.getElementById('st-code').innerText = st;
            document.getElementById('ld-code').innerText = ld;
        }

        function generateLogs(expr, minExpr, minterms) {
            const log = document.getElementById('calc-log');
            log.innerHTML = `
                <strong>Calculation Log</strong><br>
                -------------------------<br>
                Input Expression: ${expr}<br>
                Variables Found: ${currentVars.join(', ')}<br>
                Total Minterms: ${minterms.length}<br>
                <br>
                <strong>Minimization Result (Simplified SOP):</strong><br>
                ${minExpr}<br>
                -------------------------<br>
                <strong>Hazard Analysis:</strong><br>
                ${minterms.length > 0 ? "Potential Static-1 Hazards checked." : "No active logic states."}
            `;
            
            document.getElementById('hazard-report').innerText = minterms.length > 0 ? "Logic Verified" : "Logic Low (0)";
            document.getElementById('gate-cost').innerText = `Est. Cost: ${(minExpr.match(/AND|OR/g)||[]).length + 1} Gates`;
        }

        function drawTiming(data) {
            const ctx = document.getElementById('timingChart').getContext('2d');
            if(timingChart) timingChart.destroy();
            timingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map((_,i) => i.toString(2).padStart(currentVars.length,'0')),
                    datasets: [{
                        label: 'Output Q', data: data, borderColor: '#2563EB', borderWidth: 2, stepped: true, fill: true, backgroundColor: 'rgba(37, 99, 235, 0.1)'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 1.2, ticks: { stepSize: 1 } } } }
            });
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+id).classList.add('active');
            event.target.classList.add('active');
        }
        
        function shareLogic() {
            const expr = document.getElementById('expression-input').value;
            const url = window.location.origin + window.location.pathname + '?expr=' + encodeURIComponent(expr);
            const el = document.createElement('textarea');
            el.value = url;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            alert("Link copied!");
        }

        function saveProject() {
            const data = {
                expr: document.getElementById('expression-input').value,
                vars: currentVars,
                dialect: document.getElementById('plc-dialect').value
            };
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'logic_project.json';
            a.click();
        }

        function loadProject() {
            document.getElementById('file-input').click();
        }

        function handleFileLoad(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = JSON.parse(e.target.result);
                document.getElementById('expression-input').value = data.expr;
                document.getElementById('plc-dialect').value = data.dialect;
                runAnalysis();
            };
            reader.readAsText(file);
        }

        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text("Logic Analysis Report", 14, 20);
            
            doc.setFontSize(12);
            doc.text(`Expression: ${document.getElementById('expression-input').value}`, 14, 30);
            doc.text(`Minimized: ${document.getElementById('minimized-output').innerText}`, 14, 40);
            
            // Add Circuit Image
            const canvas = document.getElementById('circuitCanvas');
            const imgData = canvas.toDataURL("image/png");
            doc.addImage(imgData, 'PNG', 14, 50, 180, 100);
            
            doc.text("PLC Code (Structured Text):", 14, 160);
            const st = document.getElementById('st-code').innerText;
            doc.setFont("courier");
            doc.setFontSize(10);
            doc.text(st, 14, 170);
            
            doc.save("Logic_Report.pdf");
        }
    </script>
</body>
</html>
