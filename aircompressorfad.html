<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Compressor FAD to Standard Converter (ISO 1217) - Design Calculators</title>
    <meta name="description" content="Advanced Air Compressor FAD to SCFM/Nm3/hr converter. Features ISO 1217 Annex C compliance, humidity correction, and altitude derating. Essential for instrument air sizing.">
    <meta name="keywords" content="FAD to SCFM, ISO 1217, compressor calculator, free air delivery, Nm3/hr, instrument air sizing, compressor derating, altitude correction, psychrometrics">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            },
            svg: { fontCache: 'global' },
            options: {
                processHtmlClass: 'math-content',
                ignoreHtmlClass: 'no-mathjax'
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* Exact Theme Variables from Reference */
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
            
            --reset-button-bg: var(--accent);
            --reset-button-hover-bg: #DAA520;
            --clear-button-bg: var(--secondary);
            --clear-button-hover-bg: var(--primary);
            
            --ok-color: var(--success);
            --error-color: var(--danger);
            --warning-color: var(--warning);
        }

        /* Dark mode variables */
        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            
            --reset-button-bg: var(--accent);
            --reset-button-hover-bg: #DAA520;
            --clear-button-bg: var(--secondary);
            --clear-button-hover-bg: var(--primary);
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header styles */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        main {
            padding: 40px 0;
        }

        /* Main Card Styling */
        .tool-container {
            background-color: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            transition: transform 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .tool-container h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.05rem;
        }

        /* NEW: Footer styles (Exact copy from provided file) */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        /* Forms and Results */
        .calculator-form {
            background-color: var(--card);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: none;
        }
        
        .form-section {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .form-section.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .form-section h3 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
            font-size: 1rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        /* Buttons */
        .calculate-btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 25px;
            transition: all 0.3s;
            width: auto;
            min-width: 220px;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }

        .reset-btn {
            background-color: var(--reset-button-bg);
            color: #333;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 700;
            margin-top: 25px;
            margin-left: 15px;
            transition: all 0.3s;
            width: auto;
            min-width: 150px;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .reset-btn:hover {
            background-color: var(--reset-button-hover-bg);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }

        .clear-results-btn {
            background-color: var(--clear-button-bg);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 700;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .clear-results-btn:hover {
            background-color: var(--clear-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .result-container {
            margin-top: 30px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .result-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-container h3 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .result-table th, .result-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            transition: background-color 0.3s;
        }
        
        .result-table th {
            background: var(--grad);
            font-weight: 700;
            color: white;
        }

        .result-table tr:last-child td {
            border-bottom: none;
        }
        
        .result-table tr:nth-child(even) {
            background-color: var(--bg);
        }

        .result-table tbody tr:hover {
            background-color: var(--border);
        }
        
        .result-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-size: 0.85em;
            font-family: 'Inter', sans-serif;
            line-height: 1.4;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }
        
        .info-icon {
            color: var(--primary);
            margin-left: 5px;
            cursor: help;
        }

        /* Message Box */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
            align-items: center;
            justify-content: center;
            min-width: 250px;
        }
        #custom-message-box.show {
            display: flex;
            opacity: 1;
            top: 30px;
        }

        /* Calculation Steps */
        .steps-container {
            display: none;
            margin-top: 30px;
        }
        .steps-container.active {
            display: block;
        }
        .step-card {
            background: var(--card);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideIn 0.6s ease-out;
            transition: all 0.3s;
            margin-bottom: 25px;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-card h4 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
        }
        .step-card .number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin-right: 15px;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        .step-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: start;
        }
        @media (max-width: 768px) {
            .step-content { grid-template-columns: 1fr; }
        }
        .step-content .formula-block {
            background: var(--bg);
            border-radius: 8px;
            padding: 20px;
            font-size: 1rem;
            border: 1px solid var(--border);
        }
        .step-content .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .step-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
            line-height: 1.2;
        }
        .step-unit {
            font-size: 1rem;
            color: var(--text);
            opacity: 0.8;
            font-weight: 500;
            margin-left: 5px;
        }
        .step-explanation {
            font-size: 1.05rem;
            line-height: 1.8;
        }
        
        .button-wrapper {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            width: 100%;
            padding-top: 20px;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
            outline: none;
        }
        body.dark-mode .form-group input:focus, 
        body.dark-mode .form-group select:focus { 
             box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Compressor Diagram */
        .compressor-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            flex-direction: column;
            position: relative;
        }
        .compressor-diagram svg {
            width: 100%;
            max-width: 500px;
            height: auto;
            border: 1px solid var(--border);
            border-radius: 5px;
            background-color: var(--card);
        }
        .status-display {
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
            width: 80%;
            background-color: var(--secondary);
            color: white;
        }

        /* LONG FORM THEORY STYLES */
        .education-section {
            margin-top: 60px; /* More separation */
            margin-bottom: 60px;
            background: var(--card);
            border-radius: 12px;
            padding: 40px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        
        .education-section h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .education-section h3 {
            color: var(--heading);
            margin-top: 40px;
            margin-bottom: 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            border-left: 5px solid var(--accent);
            padding-left: 15px;
        }

        .long-text p {
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 20px;
            color: var(--text);
            text-align: justify;
        }

        .insight-card, .danger-box, .success-box, .standard-box {
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        
        .insight-card {
            background: linear-gradient(135deg, var(--card), rgba(37,99,235,0.03));
            border-left: 5px solid var(--secondary);
        }
        .insight-card:hover { transform: translateX(5px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.02));
            border-left: 5px solid var(--danger);
        }
        
        .success-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.02));
            border-left: 5px solid var(--success);
        }
        
        .standard-box {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-left: 5px solid var(--primary);
        }

        .insight-card h4, .danger-box h4, .success-box h4, .standard-box h4 {
            margin-top: 0;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-card h4 { color: var(--secondary); }
        .danger-box h4 { color: var(--danger); }
        .success-box h4 { color: var(--success); }
        .standard-box h4 { color: var(--primary); }
        
        /* Table Styles for Theory */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            font-size: 0.95rem;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid var(--border);
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background-color: var(--primary);
            color: white;
        }
        .comparison-table tr:nth-child(even) {
            background-color: var(--bg);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .tool-container, .education-section, .result-container { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
            .long-text p { text-align: left; }
        }
    </style>
</head>
<body>
    <div id="custom-message-box" class="message-box"></div>

    <header>
        <div class="container">
            <nav class="navbar">
                <a class='logo-container' href='/'>
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="tool-container">
            <h2><i class="fas fa-compress"></i> Air Compressor FAD to Standard Converter</h2>
            
            <div class="tool-description">
                <p>This world-class engineering tool converts <strong>FAD (Free Air Delivery)</strong> to Standard flow rates like <strong>SCFM</strong>, <strong>Nm³/hr</strong>, and <strong>Sm³/min</strong>. It applies rigorous thermodynamic corrections for inlet pressure, temperature, and relative humidity, adhering to <strong>ISO 1217 Annex C</strong> and <strong>ASME PTC 9</strong> standards.</p>
            </div>

            <div class="calculator-form">
                <form id="fad-calculator-form">
                    <div class="form-section">
                        <h3><i class="fas fa-wind"></i> Free Air Delivery (FAD) Conditions</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="flow-value">Flow Rate Value <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The rated capacity of the compressor at intake conditions.</span></span></label>
                                <input type="number" id="flow-value" step="0.1" value="500" required>
                            </div>
                            <div class="form-group">
                                <label for="flow-unit">Flow Unit <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Unit of the input FAD flow.</span></span></label>
                                <select id="flow-unit" required>
                                    <option value="cfm">CFM (ft³/min)</option>
                                    <option value="m3hr">m³/hr</option>
                                    <option value="m3min">m³/min</option>
                                    <option value="lmin">L/min</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="inlet-pressure">Inlet Pressure (Abs) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ambient pressure at compressor intake (1 atm = 1.01325 bar).</span></span></label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="number" id="inlet-pressure" step="0.0001" value="1.01325" required>
                                    <select id="pressure-unit" style="width: 100px;">
                                        <option value="bar">bar(a)</option>
                                        <option value="psi">psi(a)</option>
                                        <option value="kpa">kPa(a)</option>
                                        <option value="atm">atm</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inlet-temp">Inlet Temperature <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ambient temperature at intake.</span></span></label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="number" id="inlet-temp" step="0.1" value="35" required>
                                    <select id="temp-unit" style="width: 100px;">
                                        <option value="c">°C</option>
                                        <option value="f">°F</option>
                                    </select>
                                </div>
                            </div>
                             <div class="form-group">
                                <label for="relative-humidity">Relative Humidity (RH) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ambient relative humidity (%). Use 0 if unknown.</span></span></label>
                                <input type="number" id="relative-humidity" step="1" value="60" min="0" max="100" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-ruler-vertical"></i> Target Reference Standard</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="standard-def">Reference Condition <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the standard you wish to convert TO.</span></span></label>
                                <select id="standard-def" required>
                                    <option value="normal">Normal (Nm³/hr): 1 atm, 0°C, 0% RH (DIN 1343)</option>
                                    <option value="scfm_asme">ASME/CAGI (SCFM): 14.7 psi, 68°F, 0% RH</option>
                                    <option value="iso1217">ISO 1217 (FAD): 1 bar, 20°C, 0% RH</option>
                                    <option value="scfm_gas">Standard Gas (US): 14.696 psi, 60°F, 0% RH</option>
                                    <option value="api618">API 618: 14.7 psi, 60°F, 0% RH</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-wrapper">
                        <button type="button" id="calculate-btn" class="calculate-btn"><i class="fas fa-calculator"></i> Convert</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="result-container" class="result-container">
            <h3><i class="fas fa-clipboard-check"></i> Conversion Results</h3>
            
            <div class="compressor-diagram">
                <p style="margin-bottom: 25px; font-weight: bold; color: var(--secondary);">Psychrometric Volume Change</p>
                <svg viewBox="0 0 500 200" preserveAspectRatio="xMidYMid meet">
                    <defs>
                        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#f0f0f0" stroke-width="1"/>
                        </pattern>
                        <linearGradient id="airGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.2" />
                            <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0.6" />
                        </linearGradient>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#grid)" />

                    <rect x="50" y="50" width="120" height="100" fill="none" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5,5" />
                    <text x="110" y="40" font-size="12" fill="#3b82f6" text-anchor="middle" font-weight="bold">Inlet (FAD)</text>
                    <text x="110" y="80" font-size="10" fill="#555" text-anchor="middle" id="svg-p1">P1, T1</text>
                    <text x="110" y="100" font-size="14" fill="#1e3a8a" text-anchor="middle" font-weight="bold" id="svg-v1">V1</text>
                    <text x="110" y="120" font-size="10" fill="#dc2626" text-anchor="middle" id="svg-rh">Wet Air</text>

                    <path d="M 180 100 L 290 100" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
                    <polygon points="290,100 280,95 280,105" fill="#333" />
                    <text x="235" y="90" font-size="10" fill="#666" text-anchor="middle">Thermodynamic Correction</text>

                    <rect x="300" y="60" width="100" height="80" fill="url(#airGradient)" stroke="#10b981" stroke-width="2" />
                    <text x="350" y="40" font-size="12" fill="#10b981" text-anchor="middle" font-weight="bold">Standard</text>
                    <text x="350" y="80" font-size="10" fill="#555" text-anchor="middle" id="svg-p2">P_std, T_std</text>
                    <text x="350" y="110" font-size="14" fill="#fff" text-anchor="middle" font-weight="bold" id="svg-v2">V2</text>
                </svg>
                <p class="status-display" id="conversion-summary">Calculating...</p>
            </div>

            <div id="steps-container" class="steps-container math-content">
                </div>

            <table class="result-table">
                <thead>
                    <tr>
                        <th>Flow Parameter</th>
                        <th>Calculated Value</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    </tbody>
            </table>
            
            <div style="display: flex; justify-content: center; margin-top: 20px;">
                <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
            </div>
        </div>

        <div id="education-section" class="education-section long-text">
            <h2><i class="fas fa-book-open"></i> The Ultimate Guide to Compressor Flow Physics</h2>
            
            <div class="insight-card">
                <h4><i class="fas fa-info-circle"></i> Introduction: Why Flow Conversion is Critical</h4>
                <p>In the world of pneumatics and industrial gases, confusion over flow rate definitions is the number one cause of system under-performance. An engineer might specify a compressor for <strong>1000 CFM</strong>, but if they mean <strong>Standard CFM (SCFM)</strong> and the vendor delivers <strong>1000 CFM (FAD)</strong> at a hot, humid site like Mumbai or Houston, the actual mass of air delivered could be 15% less than required.</p>
                <p>This guide explains the physics behind Free Air Delivery (FAD), Standard Flow, and the rigorous math used in this calculator (based on ISO 1217 and ASME standards).</p>
            </div>

            <h3>1. Understanding FAD (Free Air Delivery)</h3>
            <p><strong>Free Air Delivery (FAD)</strong> is the volume of air drawn into the compressor from the atmosphere, measured at the <em>intake conditions</em>. It is not the volume of compressed air coming out of the pipe; it is the volume of "loose" air the machine swallows.</p>
            <p>Because air is compressible, 1 cubic meter of air at 5°C is much denser (contains more oxygen and nitrogen molecules) than 1 cubic meter of air at 45°C. Therefore, a compressor rated for 500 CFM FAD will deliver a different <em>mass</em> of air in winter than in summer.</p>
            <div class="danger-box">
                <h4><i class="fas fa-exclamation-triangle"></i> The Common Mistake</h4>
                <p>Never assume "CFM" means "SCFM". If a catalog says "500 CFM," it almost always means FAD. If you need 500 SCFM for your tools, and you buy a 500 CFM (FAD) compressor for a hot summer operation (40°C), you might only get 430 SCFM of usable air. <strong>Always convert FAD to Standard Flow to compare apples to apples.</strong></p>
            </div>

            <h3>2. The "Standard" Confusion: Definitions of Normal vs. Standard</h3>
            <p>There is no single global definition of "Standard Air." This is where most errors occur. This calculator allows you to select your specific reference, but you must know what your downstream equipment requires.</p>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Term</th>
                        <th>Unit</th>
                        <th>Pressure</th>
                        <th>Temperature</th>
                        <th>Humidity (RH)</th>
                        <th>Typical Use</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Normal</strong></td>
                        <td>Nm³/hr</td>
                        <td>1.01325 bar (1 atm)</td>
                        <td>0°C (273.15 K)</td>
                        <td>0% (Dry)</td>
                        <td>Europe, Science, ISO standards (DIN 1343)</td>
                    </tr>
                    <tr>
                        <td><strong>Standard (ASME)</strong></td>
                        <td>SCFM</td>
                        <td>14.7 psi</td>
                        <td>68°F (20°C)</td>
                        <td>0% (Dry)</td>
                        <td>USA, CAGI, Pneumatic Tools</td>
                    </tr>
                    <tr>
                        <td><strong>Standard (Gas)</strong></td>
                        <td>SCFM</td>
                        <td>14.696 psi</td>
                        <td>60°F (15.6°C)</td>
                        <td>0% (Dry)</td>
                        <td>Oil & Gas, API 618</td>
                    </tr>
                    <tr>
                        <td><strong>ISO 1217 (FAD)</strong></td>
                        <td>m³/min</td>
                        <td>1 bar</td>
                        <td>20°C</td>
                        <td>0% (Dry)</td>
                        <td>Compressor Rating Plate</td>
                    </tr>
                </tbody>
            </table>

            <h3>3. The Physics: General Gas Law & Humidity</h3>
            <p>To convert between these states, we use the <strong>General Gas Law</strong>, but with a critical modification for humidity. Air is a mixture of dry gases (Nitrogen, Oxygen, Argon) and Water Vapor. The "Standard" flow is almost always defined as <strong>Dry Air</strong>. Therefore, we must subtract the volume occupied by water vapor from the FAD volume.</p>
            
            <div class="standard-box math-content">
                <h4><i class="fas fa-square-root-alt"></i> The Governing Equation</h4>
                <p>The relationship used in this tool is derived from the Ideal Gas Law ($PV=nRT$) combined with Dalton's Law of Partial Pressures:</p>
                <p class="formula">$$Q_{std} = Q_{FAD} \times \left( \frac{P_{inlet} - P_{vapor}}{P_{std}} \right) \times \left( \frac{T_{std}}{T_{inlet}} \right)$$</p>
                <p>Where:</p>
                <ul>
                    <li>$Q_{std}$ = Standard Flow Rate (Dry)</li>
                    <li>$Q_{FAD}$ = Free Air Delivery (Wet intake)</li>
                    <li>$P_{inlet}$ = Absolute Inlet Pressure</li>
                    <li>$P_{vapor}$ = Partial Pressure of Water Vapor ($RH \times P_{sat}$)</li>
                    <li>$T_{std}, T_{inlet}$ = Absolute Temperatures (Kelvin)</li>
                </ul>
            </div>

            <h3>4. Deep Dive: The Impact of Humidity ($P_{vapor}$)</h3>
            <p>Water vapor takes up space. In a hot, humid environment (e.g., 35°C, 90% RH), water vapor exerts a partial pressure of nearly 5.6 kPa (0.056 bar). If your atmospheric pressure is 1.0 bar, only 0.944 bar is actual air. The rest is water.</p>
            <p>When this air is compressed and cooled in the aftercooler, most of that water condenses into liquid and is drained away. That volume is <strong>lost</strong>. The compressor did the work to suck it in and compress it, but it doesn't contribute to the flow downstream. This is why humidity correction is vital for accurate sizing.</p>
            <p><strong>This calculator uses the Tetens Equation</strong> to calculate saturation vapor pressure ($P_{sat}$) with high precision:</p>
            <div class="math-content">
                <p class="formula">$$P_{sat} = 610.78 \times \exp\left(\frac{17.27 \times T}{T + 237.3}\right) \text{ (Pascals)}$$</p>
            </div>

            <h3>5. Altitude Derating (The Pressure Effect)</h3>
            <p>Altitude kills compressor performance. As you go higher, atmospheric pressure ($P_{inlet}$) drops. At 2000 meters, atmospheric pressure is only about 0.8 bar.</p>
            <p>Looking at the governing equation above, if $P_{inlet}$ drops from 1.0 to 0.8, your mass flow drops by 20% directly. A compressor that delivers 500 SCFM at sea level will only deliver ~400 SCFM at 2000 meters. This tool captures that effect automatically when you input the correct absolute inlet pressure.</p>

            <h3>6. ISO 1217 Annex C: The Testing Standard</h3>
            <div class="success-box">
                <h4><i class="fas fa-check-circle"></i> Best Practice: Ask for Annex C Data</h4>
                <p>When buying a compressor, always ask for the datasheet according to <strong>ISO 1217 Annex C</strong>. This standard strictly defines how flow is measured (at the discharge terminal) and corrected back to intake conditions. It accounts for losses inside the package (intake filters, internal piping, cooling fans). The tolerance for flow is typically +/- 4% or +/- 5% depending on the machine size.</p>
            </div>

            <h3>7. Practical Sizing Strategy</h3>
            <p>When designing an instrument air system, follow this workflow:</p>
            <ol>
                <li><strong>Sum the Consumers:</strong> Add up the SCFM/Nm³/hr requirements of all pneumatic tools and instruments.</li>
                <li><strong>Determine Worst-Case Ambient:</strong> Identify the maximum summer temperature and humidity (e.g., 45°C, 80% RH) and the minimum pressure (if at altitude).</li>
                <li><strong>Back-Calculate to FAD:</strong> Use this tool to convert your required SCFM into the FAD required at those worst-case conditions.</li>
                <li><strong>Add Margin:</strong> Add 10-15% for leaks, wear, and future expansion.</li>
                <li><strong>Select Compressor:</strong> Pick a machine with a rated FAD higher than your calculated value.</li>
            </ol>

            <div class="insight-card">
                <h4><i class="fas fa-bolt"></i> Energy Implications</h4>
                <p>While high inlet temperature reduces mass flow, it also reduces the power required to compress the air (less mass = less work). However, the specific energy (kW/100 cfm) usually worsens slightly. Conversely, cold intake air increases mass flow and increases motor power draw. In extremely cold climates, motors must be sized to handle this "dense air" overload.</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                        <li><a href="terms-of-service">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href='/sitemap2'>Sitemap</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>This tool offers general guidance. Results should be reviewed for accuracy and compliance with relevant project standards and regulations before use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Element Selection ---
            const flowValueInput = document.getElementById('flow-value');
            const flowUnitInput = document.getElementById('flow-unit');
            const inletPressureInput = document.getElementById('inlet-pressure');
            const pressureUnitInput = document.getElementById('pressure-unit');
            const inletTempInput = document.getElementById('inlet-temp');
            const tempUnitInput = document.getElementById('temp-unit');
            const rhInput = document.getElementById('relative-humidity');
            const standardDefInput = document.getElementById('standard-def');

            const calculateBtn = document.getElementById('calculate-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const calculationDetailsDiv = document.getElementById('steps-container');
            const conversionSummary = document.getElementById('conversion-summary');
            
            // Diagram Elements
            const svgP1 = document.getElementById('svg-p1');
            const svgV1 = document.getElementById('svg-v1');
            const svgP2 = document.getElementById('svg-p2');
            const svgV2 = document.getElementById('svg-v2');

            // --- Default Values ---
            const defaultValues = {
                'flow-value': 500, 'flow-unit': 'cfm',
                'inlet-pressure': 1.01325, 'pressure-unit': 'bar',
                'inlet-temp': 35, 'temp-unit': 'c',
                'relative-humidity': 60, 'standard-def': 'scfm_asme'
            };

            // --- Standard Definitions (P in Pa, T in K) ---
            const standards = {
                'normal': { P: 101325, T: 273.15, name: "Normal (DIN 1343)", unit: "Nm³/hr" },
                'scfm_asme': { P: 101353, T: 293.15, name: "SCFM (ASME PTC 9/CAGI)", unit: "SCFM" }, // 14.7 psi, 68F
                'iso1217': { P: 100000, T: 293.15, name: "ISO 1217 FAD (Ref)", unit: "m³/min" }, // 1 bar, 20C
                'scfm_gas': { P: 101325, T: 288.71, name: "Standard (Oil & Gas)", unit: "SCFM" }, // 14.696 psi, 60F
                'api618': { P: 101325, T: 288.71, name: "API 618", unit: "SCFM" }
            };

            // --- Helper Functions ---
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = 'var(--danger)';
                    messageBox.style.color = 'white';
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = 'var(--warning)';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = 'var(--success)';
                    messageBox.style.color = 'white';
                }
                messageBox.classList.add('show');
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 5000);
            }

            function addResultRow(parameter, value) {
                const row = resultTableBody.insertRow();
                row.insertCell().innerHTML = parameter;
                row.insertCell().innerHTML = value;
            }

            function clearResults() {
                resultContainer.classList.remove('show');
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                calculationDetailsDiv.classList.remove('active');
                displayMessage("Results cleared.", "info");
            }

            function resetForm() {
                for (const key in defaultValues) {
                    const el = document.getElementById(key);
                    if(el) el.value = defaultValues[key];
                }
                // Reset secondary selects
                document.getElementById('pressure-unit').value = 'bar';
                document.getElementById('temp-unit').value = 'c';
                clearResults();
                displayMessage("Form reset to default values.", "info");
            }

            // --- Physics Helpers (Tetens Equation for Water Vapor) ---
            function getSaturationPressure(tempC) {
                // Tetens Equation: P_sat in kPa
                // T must be in Celsius
                if (tempC >= 0) {
                    return 0.61078 * Math.exp((17.27 * tempC) / (tempC + 237.3)) * 1000; // Returns Pa
                } else {
                    // Over ice (though unlikely for compressor intake usually)
                    return 0.61078 * Math.exp((21.875 * tempC) / (tempC + 265.5)) * 1000; // Returns Pa
                }
            }

            function toKelvin(val, unit) {
                return unit === 'c' ? val + 273.15 : (val - 32) * (5/9) + 273.15;
            }
            
            function toCelsius(val, unit) {
                return unit === 'c' ? val : (val - 32) * (5/9);
            }

            function toPascals(val, unit) {
                if (unit === 'bar') return val * 100000;
                if (unit === 'psi') return val * 6894.76;
                if (unit === 'kpa') return val * 1000;
                if (unit === 'atm') return val * 101325;
                return val;
            }

            // --- MAIN CALCULATION ENGINE ---
            function calculateConversion() {
                clearResults();

                // 1. Get Inputs
                const flowVal = parseFloat(flowValueInput.value);
                const flowUnit = flowUnitInput.value;
                const pInVal = parseFloat(inletPressureInput.value);
                const pUnit = pressureUnitInput.value;
                const tInVal = parseFloat(inletTempInput.value);
                const tUnit = tempUnitInput.value;
                const rhVal = parseFloat(rhInput.value);
                const stdKey = standardDefInput.value;

                // Validation
                if (isNaN(flowVal) || isNaN(pInVal) || isNaN(tInVal) || isNaN(rhVal)) {
                    displayMessage("Please enter valid numbers in all fields.", "error"); return;
                }
                if (flowVal <= 0 || pInVal <= 0) {
                    displayMessage("Flow and Pressure must be positive.", "error"); return;
                }
                if (rhVal < 0 || rhVal > 100) {
                    displayMessage("Humidity must be between 0% and 100%.", "error"); return;
                }

                // 2. Convert Inputs to SI Base (Pa, K, m³/min for internal calc)
                const T1_K = toKelvin(tInVal, tUnit);
                const T1_C = toCelsius(tInVal, tUnit);
                const P1_Pa = toPascals(pInVal, pUnit);
                
                // 3. Normalize Flow to m³/min (FAD)
                let flow_m3min_fad;
                if (flowUnit === 'cfm') flow_m3min_fad = flowVal * 0.0283168;
                else if (flowUnit === 'm3hr') flow_m3min_fad = flowVal / 60;
                else if (flowUnit === 'lmin') flow_m3min_fad = flowVal / 1000;
                else flow_m3min_fad = flowVal; 

                // 4. Psychrometrics
                const Psat_Pa = getSaturationPressure(T1_C);
                const Pv_Pa = (rhVal / 100) * Psat_Pa; // Partial pressure of vapor
                const P1_Dry_Pa = P1_Pa - Pv_Pa; // Partial pressure of dry air
                
                if (P1_Dry_Pa <= 0) {
                    displayMessage("Error: Vapor pressure exceeds total pressure. Check inputs (High Temp/Low Pressure combination).", "error"); return;
                }

                // 5. Get Target Standard Definition
                const std = standards[stdKey];
                const P2_Pa = std.P;
                const T2_K = std.T;

                // 6. Calculate Correction Factors
                // Factor due to Pressure (including humidity loss)
                const K_p = P1_Dry_Pa / P2_Pa;
                // Factor due to Temperature
                const K_t = T2_K / T1_K;
                // Total Factor
                const K_total = K_p * K_t;
                
                const flow_m3min_std = flow_m3min_fad * K_total;

                // 7. Calculate Outputs (Dual units for user convenience)
                const out_scfm = flow_m3min_std / 0.0283168;
                const out_nm3hr = flow_m3min_std * 60; 
                const out_m3min = flow_m3min_std;

                // 8. Generate Steps HTML
                let stepHtml = '';

                // Step 1: Conditions
                stepHtml += `<div class="step-card">
                    <h4><span class="number">1</span>Analyze Inlet Conditions</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <strong>Absolute Pressure ($P_1$):</strong> ${P1_Pa.toFixed(0)} Pa<br>
                            <strong>Abs. Temperature ($T_1$):</strong> ${T1_K.toFixed(2)} K<br>
                            <strong>Relative Humidity:</strong> ${rhVal}%
                        </div>
                        <div class="step-explanation">
                            <p><strong>Step 1b: Calculate Saturation Vapor Pressure ($P_{sat}$)</strong></p>
                            <div class="formula-block" style="padding:10px;">
                                <p>Using Tetens Equation at ${T1_C.toFixed(1)}°C:</p>
                                $$P_{sat} = 610.78 \times e^{\\frac{17.27 \\times ${T1_C.toFixed(1)}}{${T1_C.toFixed(1)} + 237.3}} = \\mathbf{${Psat_Pa.toFixed(0)} \\text{ Pa}}$$
                            </div>
                        </div>
                    </div>
                </div>`;

                // Step 2: Partial Pressure
                stepHtml += `<div class="step-card math-content">
                    <h4><span class="number">2</span>Correct for Humidity (Partial Pressure)</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>To convert to Dry Standard air, we must subtract the volume occupied by water vapor at the inlet.</p>
                            <p><strong>Partial Pressure of Vapor ($P_v$):</strong></p>
                            $$P_v = RH \\times P_{sat} = ${rhVal/100} \\times ${Psat_Pa.toFixed(0)} = ${Pv_Pa.toFixed(0)} \\text{ Pa}$$
                        </div>
                        <div class="step-explanation">
                            <p><strong>Partial Pressure of Dry Air ($P_{1,dry}$):</strong></p>
                            <div class="formula-block">
                                $$P_{1,dry} = P_{total} - P_v$$
                                $$P_{1,dry} = ${P1_Pa.toFixed(0)} - ${Pv_Pa.toFixed(0)} = \\mathbf{${P1_Dry_Pa.toFixed(0)} \\text{ Pa}}$$
                            </div>
                        </div>
                    </div>
                </div>`;

                // Step 3: Factor
                stepHtml += `<div class="step-card math-content">
                    <h4><span class="number">3</span>Apply General Gas Law</h4>
                    <div class="step-content">
                        <div class="step-explanation">
                            <p>Target Standard: <strong>${std.name}</strong></p>
                            <ul>
                                <li>Ref Pressure ($P_{std}$): ${P2_Pa} Pa</li>
                                <li>Ref Temp ($T_{std}$): ${T2_K} K</li>
                            </ul>
                            <p>This ratio defines the compressibility and density change.</p>
                        </div>
                        <div class="step-explanation">
                            <div class="formula-block">
                                <p class="formula">$$K = \\frac{P_{1,dry}}{P_{std}} \\times \\frac{T_{std}}{T_1}$$</p>
                                <p class="formula">$$K = \\frac{${P1_Dry_Pa.toFixed(0)}}{${P2_Pa}} \\times \\frac{${T2_K}}{${T1_K.toFixed(2)}} = \\mathbf{${K_total.toFixed(4)}}$$</p>
                            </div>
                        </div>
                    </div>
                </div>`;

                // Step 4: Final Flow
                stepHtml += `<div class="step-card math-content">
                    <h4><span class="number">4</span>Final Volumetric Flow</h4>
                    <div class="step-explanation">
                        <p>$$Q_{std} = Q_{FAD} \\times K$$</p>
                        <p>$$Q_{std} = ${flowVal} \\times ${K_total.toFixed(4)} = \\mathbf{${(flowVal * K_total).toFixed(2)}}$$ (in input units)</p>
                    </div>
                    <div class="step-value">${K_total.toFixed(4)} <span class="step-unit">Total Derating Factor</span></div>
                </div>`;

                // 9. Update Result Table
                addResultRow("Input FAD Flow", `<strong>${flowVal} ${flowUnit}</strong>`);
                addResultRow("Total Correction Factor", `${K_total.toFixed(4)}`);
                
                // Highlight the selected standard result
                const selectedResult = std.unit === "SCFM" ? `${out_scfm.toFixed(2)} SCFM` : `${out_nm3hr.toFixed(2)} Nm³/hr`;
                
                addResultRow(`<span style="color:var(--primary)">Target: ${std.name}</span>`, `<strong class="ok" style="font-size:1.3em">${selectedResult}</strong>`);
                
                // Show other equivalents useful for engineers
                addResultRow("Equivalent Normal Flow (DIN 1343)", `${((flow_m3min_fad * 60) * (P1_Dry_Pa/101325) * (273.15/T1_K)).toFixed(2)} Nm³/hr`);
                addResultRow("Equivalent ASME Flow (SCFM)", `${((flow_m3min_fad / 0.0283168) * (P1_Dry_Pa/101353) * (293.15/T1_K)).toFixed(2)} SCFM`);

                // Update Diagram
                svgP1.textContent = `${(P1_Pa/1000).toFixed(1)} kPa, ${T1_C.toFixed(1)}°C`;
                svgV1.textContent = `${flowVal} ${flowUnit}`;
                svgP2.textContent = `${(P2_Pa/1000).toFixed(1)} kPa, ${(T2_K-273.15).toFixed(1)}°C`;
                svgV2.textContent = std.unit === "SCFM" ? `${out_scfm.toFixed(1)} SCFM` : `${out_nm3hr.toFixed(1)} Nm³/hr`;
                
                conversionSummary.textContent = `1.0 ${flowUnit} (FAD) = ${K_total.toFixed(3)} ${flowUnit} (Std)`;
                if(K_total < 1) {
                    conversionSummary.style.backgroundColor = 'var(--warning)';
                    conversionSummary.textContent += " (Flow Reduction)";
                } else {
                     conversionSummary.style.backgroundColor = 'var(--success)';
                }

                calculationDetailsDiv.innerHTML = stepHtml;
                calculationDetailsDiv.classList.add('active');
                
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    // resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Optional: auto-scroll
                }, 10);

                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    setTimeout(() => {
                        window.MathJax.typesetPromise([calculationDetailsDiv, document.getElementById('education-section')]);
                    }, 50);
                }
            }

            // --- Event Listeners ---
            calculateBtn.addEventListener('click', calculateConversion);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults);

            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index);
            });
            
            // Initial MathJax Typeset for Theory Section
            if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                 setTimeout(() => {
                    window.MathJax.typesetPromise([document.getElementById('education-section')]);
                 }, 500);
            }

            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>
