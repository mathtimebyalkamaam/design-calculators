<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finned Tube Heat Transfer Calculator - Design Calculators - Mechanical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #1976D2;
            --accent-color: #FFC107;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --header-bg: #2C3E50;
            --footer-bg: #34495E;
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            --hover-color: #e2e6ea;
            --primary-color-rgb: 33, 150, 243;
        }
        body.dark-mode {
            --primary-color: #5DADE2;
            --secondary-color: #2874A6;
            --bg-color: #252D3A;
            --card-bg: #2F3C4C;
            --text-color: #E0E6EB;
            --header-bg: #252D3A;
            --footer-bg: #252D3A;
            --border-color: #4C5C70;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #3A475C;
            --primary-color-rgb: 93, 173, 226;
        }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, var(--bg-color) 0%, rgba(244, 247, 246, 0.8) 100%);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s, background-image 0.3s;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        header h1 {
            margin: 0;
            font-size: 2.8em;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        header .subtitle {
            margin: 8px 0 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }
        main {
            padding: 30px 0;
        }
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            transition: transform 0.3s ease-in-out;
        }
        .tool-container:hover {
            transform: translateY(-5px);
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 2em;
        }
        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1.05em;
        }
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }
        .tool-description strong {
            color: var(--primary-color);
        }
        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 25px;
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            font-weight: bold;
        }
        .back-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.03);
        }
        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
        }
        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px;
            font-size: 1.3em;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 65px;
            height: 38px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(27px);
        }
        .slider.round {
            border-radius: 38px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }
        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.3em;
        }
        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }
        .social-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #7f8c8d; }
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.05em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.3);
            outline: none;
        }
        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .form-row .form-group {
            flex: 1 1 calc(50% - 10px);
            min-width: 280px;
        }
        @media (max-width: 600px) {
            .form-row .form-group {
                flex: 1 1 100%;
            }
        }
        .calculate-btn {
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 18px 25px; /* Increased padding for taller button */
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-image 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .calculate-btn:hover {
            background-image: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: block;
            opacity: 0;
            transition: opacity 0.6s ease-out;
            pointer-events: none;
        }
        .result-container.show {
            opacity: 1;
            pointer-events: auto;
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            font-size: 1.1em;
        }
        .result-table tr:last-child td {
            border-bottom: none;
        }
        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            line-height: 1.5;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .info-icon {
            color: var(--primary-color);
            margin-left: 8px;
            cursor: help;
            font-size: 1em;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        #custom-message-box {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            font-size: 1.1em;
        }
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.98em;
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px dashed var(--border-color);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #calculation-details ul li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Mechanical</h1>
            <p class="subtitle">Smart Tools for Modern Mechanical Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>
    <main class="container">
        <a href="indexMech.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Tools
        </a>
        <div class="tool-container">
            <h2>Finned Tube Heat Transfer Calculator</h2>
            <div class="tool-description">
                <p>This calculator estimates the heat transfer rate from finned tubes to the ambient environment. Finned tubes are widely used to enhance heat transfer, especially where the external convection coefficient is low (e.g., gas flow).</p>
                <p>The calculation considers the geometry of the fins, their thermal conductivity, and the external convection and radiation from both the fin surfaces and the exposed base tube surface.</p>
                <ul>
                    <li><strong>Fin Efficiency (\(\eta_f\)):</strong> Measures how effectively a fin transfers heat relative to a fin at its base temperature.</li>
                    <li><strong>Overall Surface Efficiency (\(\eta_o\)):</strong> Accounts for the heat transfer from both the finned and unfinned (exposed tube) sections.</li>
                </ul>
                <p><strong>Note:</strong> The external heat transfer coefficient and fin efficiency correlations used are simplified for this calculator. For accurate design and compliance with international standards, refer to specialized heat transfer literature and industry standards like <strong>TEMA (Tubular Exchanger Manufacturers Association)</strong>, <strong>ASHRAE</strong>, or comprehensive textbooks on heat exchangers and heat transfer.</p>
            </div>
            <div class="calculator-form">
                <form id="finned-tube-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (e.g., mm, m, °C, W/mK, W/m²°C) or Imperial (e.g., inch, ft, °F, BTU/h ft°F, BTU/h ft²°F) units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (\(\text{mm}\), \(\text{m}\), \(\text{°C}\), \(\text{W/mK}\), \(\text{W/m}^2\text{°C}\))</option>
                                <option value="imperial">Imperial (\(\text{inch}\), \(\text{ft}\), \(\text{°F}\), \(\text{BTU/h ft°F}\), \(\text{BTU/h ft}^2\text{°F}\))</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tube-outer-diameter">Tube Outer Diameter (Root) <span class="diameter-unit-label">(\(\text{mm}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The outer diameter of the bare tube before fins are attached.</span></span></label>
                            <input type="number" id="tube-outer-diameter" step="0.1" value="25" min="0.1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fin-height">Fin Height <span class="length-unit-label">(\(\text{mm}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The height of the fin from the tube surface to its tip.</span></span></label>
                            <input type="number" id="fin-height" step="0.1" value="12.5" min="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="fin-thickness">Fin Thickness <span class="length-unit-label">(\(\text{mm}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The thickness of the fin material.</span></span></label>
                            <input type="number" id="fin-thickness" step="0.01" value="0.5" min="0.01" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fins-per-unit-length">Number of Fins per Unit Length <span class="fins-unit-label">(\(\text{fins/m}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">How many fins are present per meter or foot of tube length.</span></span></label>
                            <input type="number" id="fins-per-unit-length" step="1" value="394" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="fin-conductivity">Fin Material Conductivity <span class="conductivity-unit-label">(\(\text{W/mK}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Thermal conductivity of the fin material (e.g., Aluminum: ~205, Copper: ~385).</span></span></label>
                            <input type="number" id="fin-conductivity" step="0.1" value="205" min="0.1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="base-temperature">Tube Base Temperature <span class="temp-unit-label">(\(\text{°C}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Temperature of the tube surface at the base of the fins.</span></span></label>
                            <input type="number" id="base-temperature" step="0.1" value="100" required>
                        </div>
                        <div class="form-group">
                            <label for="ambient-temperature">Ambient Fluid Temperature <span class="temp-unit-label">(\(\text{°C}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Temperature of the fluid surrounding the finned tube.</span></span></label>
                            <input type="number" id="ambient-temperature" step="0.1" value="20" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="external-convection-coefficient">External Convection Coefficient <span class="convection-unit-label">(\(\text{W/m}^2\text{°C}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Average convection coefficient over the finned surface. This value is typically determined through complex correlations based on fluid properties, flow velocity, and fin geometry. Common values range from 10-100 W/m²°C for gases, 500-10,000 W/m²°C for liquids.</span></span></label>
                            <input type="number" id="external-convection-coefficient" step="0.1" value="50" min="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="surface-emissivity">Surface Emissivity (\(\epsilon\)): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Typically 0.95 for painted surfaces, 0.05 for polished metals.</span></span></label>
                            <input type="number" id="surface-emissivity" step="0.01" value="0.95" min="0" max="1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tube-length">Tube Length <span class="length-unit-label">(\(\text{m}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The total length of the finned tube.</span></span></label>
                            <input type="number" id="tube-length" step="0.1" value="1" min="0.1" required>
                        </div>
                    </div>

                    <button type="button" id="calculate-finned-heat-transfer-btn" class="calculate-btn">Calculate Heat Transfer</button>
                </form>
            </div>
            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
    </main>
    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Mechanical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Mechanical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="mailto:?subject=Check out Design Calculators - Mechanical!&body=I found this amazing Finned Tube Heat Transfer Calculator and other mechanical tools: https://designcalculators.co.in" class="social-btn email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-finned-heat-transfer-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            const unitSystemSelect = document.getElementById('unit-system');
            const tubeOuterDiameterInput = document.getElementById('tube-outer-diameter');
            const finHeightInput = document.getElementById('fin-height');
            const finThicknessInput = document.getElementById('fin-thickness');
            const finsPerUnitLengthInput = document.getElementById('fins-per-unit-length');
            const finConductivityInput = document.getElementById('fin-conductivity');
            const baseTemperatureInput = document.getElementById('base-temperature');
            const ambientTemperatureInput = document.getElementById('ambient-temperature');
            const externalConvectionCoefficientInput = document.getElementById('external-convection-coefficient');
            const surfaceEmissivityInput = document.getElementById('surface-emissivity');
            const tubeLengthInput = document.getElementById('tube-length');

            const diameterUnitLabels = document.querySelectorAll('.diameter-unit-label');
            const lengthUnitLabels = document.querySelectorAll('.length-unit-label');
            const tempUnitLabels = document.querySelectorAll('.temp-unit-label');
            const finsUnitLabels = document.querySelectorAll('.fins-unit-label');
            const conductivityUnitLabels = document.querySelectorAll('.conductivity-unit-label');
            const convectionUnitLabels = document.querySelectorAll('.convection-unit-label');

            const STEFAN_BOLTZMANN = 5.67e-8; // Stefan-Boltzmann constant W/(m^2 K^4)

            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545';
                    messageBox.style.color = 'white';
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745';
                    messageBox.style.color = 'white';
                }
                messageBox.style.opacity = 1;
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            function updateUI() {
                const unitSystem = unitSystemSelect.value;

                // Update unit labels
                if (unitSystem === 'imperial') {
                    diameterUnitLabels.forEach(label => label.innerHTML = '(\\(\text{inch}\\))');
                    lengthUnitLabels.forEach(label => label.innerHTML = '(\\(\text{inch}\\))'); // For fin height, fin thickness
                    document.querySelector('label[for="tube-length"]').innerHTML = `Tube Length <span class="length-unit-label">(\(\text{ft}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The total length of the finned tube.</span></span>`;
                    tempUnitLabels.forEach(label => label.innerHTML = '(\\(\text{°F}\\))');
                    finsUnitLabels.forEach(label => label.innerHTML = '(\\(\text{fins/ft}\\))');
                    conductivityUnitLabels.forEach(label => label.innerHTML = '(\\(\text{BTU/h ft°F}\\))');
                    convectionUnitLabels.forEach(label => label.innerHTML = '(\\(\text{BTU/h ft}^2\text{°F}\\))');

                } else { // Metric
                    diameterUnitLabels.forEach(label => label.innerHTML = '(\\(\text{mm}\\))');
                    lengthUnitLabels.forEach(label => label.innerHTML = '(\\(\text{mm}\\))'); // For fin height, fin thickness
                    document.querySelector('label[for="tube-length"]').innerHTML = `Tube Length <span class="length-unit-label">(\(\text{m}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The total length of the finned tube.</span></span>`;
                    tempUnitLabels.forEach(label => label.innerHTML = '(\\(\text{°C}\\))');
                    finsUnitLabels.forEach(label => label.innerHTML = '(\\(\text{fins/m}\\))');
                    conductivityUnitLabels.forEach(label => label.innerHTML = '(\\(\text{W/mK}\\))');
                    convectionUnitLabels.forEach(label => label.innerHTML = '(\\(\text{W/m}^2\text{°C}\\))');
                }
            }

            unitSystemSelect.addEventListener('change', updateUI);
            updateUI(); // Initial UI update

            calculateBtn.addEventListener('click', function() {
                const unitSystem = unitSystemSelect.value;

                let D_tube_outer = parseFloat(tubeOuterDiameterInput.value); // mm or inch
                let H_fin = parseFloat(finHeightInput.value); // mm or inch
                let t_fin = parseFloat(finThicknessInput.value); // mm or inch
                let N_fins_per_unit_length = parseFloat(finsPerUnitLengthInput.value); // fins/m or fins/ft
                let k_fin = parseFloat(finConductivityInput.value); // W/mK or BTU/h ft°F
                let T_base = parseFloat(baseTemperatureInput.value); // °C or °F
                let T_ambient = parseFloat(ambientTemperatureInput.value); // °C or °F
                let h_external = parseFloat(externalConvectionCoefficientInput.value); // W/m²°C or BTU/h ft²°F
                let epsilon = parseFloat(surfaceEmissivityInput.value);
                L_tube_m = parseFloat(tubeLengthInput.value); // m or ft

                // Input validation
                const inputs = [D_tube_outer, H_fin, t_fin, N_fins_per_unit_length, k_fin, T_base, T_ambient, h_external, epsilon, L_tube_m];
                for (let i = 0; i < inputs.length; i++) {
                    if (isNaN(inputs[i]) || inputs[i] < (i === 8 ? 0 : 0.001)) { // Emissivity can be 0. Others > 0.001 (very small positive).
                        displayMessage("Please enter valid positive numbers for all required fields.", "error");
                        return;
                    }
                    if (i === 8 && inputs[i] > 1) { // Emissivity max 1
                        displayMessage("Surface Emissivity must be between 0 and 1.", "error");
                        return;
                    }
                }
                if (T_base <= T_ambient) {
                    displayMessage("Tube Base Temperature must be greater than Ambient Fluid Temperature for heat transfer.", "error");
                    return;
                }

                let D_tube_outer_m, H_fin_m, t_fin_m, N_fins_per_m, k_fin_si, T_base_K, T_ambient_K, h_external_si, L_tube_m;
                let Q_unit_display;

                // Convert all inputs to SI units for calculations
                if (unitSystem === 'imperial') {
                    D_tube_outer_m = D_tube_outer * 0.0254; // inch to meter
                    H_fin_m = H_fin * 0.0254; // inch to meter
                    t_fin_m = t_fin * 0.0254; // inch to meter
                    N_fins_per_m = N_fins_per_unit_length * 3.28084; // fins/ft to fins/m
                    k_fin_si = k_fin * 1.730735; // BTU/h ft°F to W/mK
                    T_base_K = (T_base - 32) * 5/9 + 273.15; // °F to Kelvin
                    T_ambient_K = (T_ambient - 32) * 5/9 + 273.15; // °F to Kelvin
                    h_external_si = h_external * 5.67826; // BTU/h ft²°F to W/m²°C
                    L_tube_m = L_tube * 0.3048; // ft to meter
                    Q_unit_display = '\\(\\text{BTU/h}\\)';
                    displayMessage("Imperial units are converted to Metric for calculations. Results will be converted back.", "info");
                } else { // Metric
                    D_tube_outer_m = D_tube_outer / 1000; // mm to meter
                    H_fin_m = H_fin / 1000; // mm to meter
                    t_fin_m = t_fin / 1000; // mm to meter
                    N_fins_per_m = N_fins_per_unit_length; // fins/m
                    k_fin_si = k_fin; // W/mK
                    T_base_K = T_base + 273.15; // °C to Kelvin
                    T_ambient_K = T_ambient + 273.15; // °C to Kelvin
                    h_external_si = h_external; // W/m²°C
                    L_tube_m = L_tube; // m
                    Q_unit_display = '\\(\\text{W}\\)';
                }

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>1. Input Parameters (Converted to SI Units):</strong></p>`;
                calculationHtml += `<ul>
                    <li>Tube Outer Diameter (\\(D_{tube,outer}\\)): ${D_tube_outer_m.toFixed(4)} m</li>
                    <li>Fin Height (\\(H_{fin}\\)): ${H_fin_m.toFixed(4)} m</li>
                    <li>Fin Thickness (\\(t_{fin}\\)): ${t_fin_m.toExponential(2)} m</li>
                    <li>Fins per meter (\\(N_{fins}\\)): ${N_fins_per_m.toFixed(2)} fins/m</li>
                    <li>Fin Material Conductivity (\\(k_{fin}\\)): ${k_fin_si.toFixed(2)} W/mK</li>
                    <li>Tube Base Temperature (\\(T_{base}\\)): ${T_base_K.toFixed(2)} K</li>
                    <li>Ambient Fluid Temperature (\\(T_{ambient}\\)): ${T_ambient_K.toFixed(2)} K</li>
                    <li>External Convection Coefficient (\\(h_{external}\\)): ${h_external_si.toFixed(2)} W/m²°C</li>
                    <li>Surface Emissivity (\\(\\epsilon\\)): ${epsilon.toFixed(2)}</li>
                    <li>Tube Length (\\(L_{tube}\\)): ${L_tube_m.toFixed(2)} m</li>
                </ul>`;

                // Calculate geometry
                const r_tube = D_tube_outer_m / 2;
                const r_fin_tip = r_tube + H_fin_m;
                
                // For annular fins, the corrected length Lc is H_fin + t_fin/2
                // A common parameter m is sqrt(h_c * P / k * A_c)
                // For a straight fin, m = sqrt(2h/kt)
                // For an annular fin, it's more complex. We'll approximate for simplicity using a corrected fin length.
                // For circular fins, a parameter 'm' is defined with the external convection coefficient.
                const m_param = Math.sqrt((2 * h_external_si) / (k_fin_si * t_fin_m));
                
                // Corrected fin length for annular fin based on standard heat transfer texts (e.g., Incropera)
                // Lc = H_fin + t_fin/2
                // This is a common approximation for circular fins.
                const L_corrected = H_fin_m + (t_fin_m / 2);
                const r_2c = r_fin_tip + (t_fin_m / 2); // Corrected outer radius
                const r_1 = r_tube; // Inner radius (tube outer radius)
                
                // A simplified approach for fin efficiency for circular fin from a tube (using Incropera's Fig. 3.23 approximations)
                // This formula is typically used with a chart for circular fins, but we can derive an approximate form
                // Let's use the equivalent straight fin approximation first, and mention its limitation.
                // A better approximation for circular fins involves modified Bessel functions, which are not standard Math. functions in JS.
                // For a more practical approach, we will use a common simplified form for fin efficiency, noting its approximation.
                
                // Simplified fin efficiency for a circular fin (often approximated as a rectangular fin with corrected length)
                // This approximation is common when Bessel functions are avoided.
                const Xi = m_param * L_corrected; // xi parameter for circular fin
                let fin_efficiency_eta_f;
                // Check if Xi is too small, which can cause division by zero or NaN if tanh(Xi) is very small.
                if (Xi < 1e-6) { // Very small Xi means fin is very efficient, approach 1
                    fin_efficiency_eta_f = 1;
                } else {
                    // This approximation is for straight fins, often applied as a simplified case for circular fins
                    // For more accuracy, a specific chart or Bessel function solution for annular fins is required.
                    fin_efficiency_eta_f = Math.tanh(Xi) / Xi;
                }

                calculationHtml += `<p><strong>2. Intermediate Calculations:</strong></p>`;
                calculationHtml += `<p class="calculation-step">Tube Radius (\\(r_{tube}\\)) = \\(D_{tube,outer} / 2\\) = ${r_tube.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Fin Tip Radius (\\(r_{fin,tip}\\)) = \\(r_{tube} + H_{fin}\\) = ${r_fin_tip.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Parameter \\(m\\) = \\(\\sqrt{2 \\times h_{external} / (k_{fin} \\times t_{fin})}\\) = \\(\\sqrt{2 \\times ${h_external_si.toFixed(2)} / (${k_fin_si.toFixed(2)} \\times ${t_fin_m.toExponential(2)})}\\) = ${m_param.toFixed(2)} m\text{\(^{-1}\)}</p>`;
                calculationHtml += `<p class="calculation-step">Corrected Fin Length (\\(L_c\\)) = \\(H_{fin} + t_{fin}/2\\) = ${L_corrected.toFixed(4)} m</p>`;
                calculationHtml += `<p class="calculation-step">Fin Efficiency (\\(\\eta_f\\)) approx = \\(\\tanh(m L_c) / (m L_c)\\) = ${fin_efficiency_eta_f.toFixed(4)}</p>`;
                
                // Calculate surface areas per unit length
                const fin_outer_radius_area_per_fin = Math.PI * (Math.pow(r_fin_tip, 2) - Math.pow(r_tube, 2)); // Area of one side of annular fin
                const fin_edge_area_per_fin = Math.PI * r_fin_tip * t_fin_m; // Area of the fin edge (very small)

                // Total surface area of one fin (two sides + edge)
                // Simplification: typically, fin surface area is considered as 2 * (Area of one side)
                const A_fin_per_fin_total = 2 * (fin_outer_radius_area_per_fin) + fin_edge_area_per_fin; // m^2 per fin
                
                // Area of fins per unit length
                const A_fins_per_m = N_fins_per_m * A_fin_per_fin_total; // m^2/m

                // Area of exposed tube per unit length
                // The pitch of fins is 1/N_fins_per_m
                const fin_spacing = (1 / N_fins_per_m) - t_fin_m;
                if (fin_spacing < 0) {
                     displayMessage("Fin thickness is too large for the given number of fins per unit length. Fins are overlapping.", "error");
                     return;
                }
                const A_tube_exposed_per_m = Math.PI * D_tube_outer_m * fin_spacing * N_fins_per_m; // Exposed area of tube between fins, m^2/m
                
                // Total outer surface area per unit length
                const A_total_outer_per_m = A_fins_per_m + A_tube_exposed_per_m; // m^2/m

                // Overall surface efficiency
                const overall_efficiency_eta_o = 1 - (A_fins_per_m / A_total_outer_per_m) * (1 - fin_efficiency_eta_f);

                calculationHtml += `<p class="calculation-step">Total Surface Area of one fin = ${A_fin_per_fin_total.toExponential(2)} m²</p>`;
                calculationHtml += `<p class="calculation-step">Area of all fins per meter (\\(A_{fins}'\\)) = \\(N_{fins} \\times A_{fin,total}\\) = ${A_fins_per_m.toFixed(2)} m²/m</p>`;
                calculationHtml += `<p class="calculation-step">Fin Spacing = \\((1 / N_{fins}) - t_{fin}\\) = ${fin_spacing.toExponential(2)} m</p>`;
                calculationHtml += `<p class="calculation-step">Area of exposed tube per meter (\\(A_{tube,exposed}'\\)) = \\(\\pi \\times D_{tube,outer} \\times \\text{Fin Spacing} \\times N_{fins}\\) = ${A_tube_exposed_per_m.toFixed(2)} m²/m</p>`;
                calculationHtml += `<p class="calculation-step">Total Outer Surface Area per meter (\\(A_{total,outer}'\\)) = \\(A_{fins}' + A_{tube,exposed}'\\) = ${A_total_outer_per_m.toFixed(2)} m²/m</p>`;
                calculationHtml += `<p class="calculation-step">Overall Surface Efficiency (\\(\\eta_o\\)) = \\(1 - (A_{fins}' / A_{total,outer}') \\times (1 - \\eta_f)\\) = ${overall_efficiency_eta_o.toFixed(4)}</p>`;
                
                // Heat transfer calculation
                // Convective heat transfer from total outer surface
                const Q_convection_per_m = h_external_si * A_total_outer_per_m * overall_efficiency_eta_o * (T_base_K - T_ambient_K); // W/m

                // Radiative heat transfer from total outer surface (assuming entire total outer area radiates at base temperature effectively for simplification)
                // This is a simplification; ideally, radiation from fins should account for fin efficiency and temperature gradient.
                // For practical calculators, it's often approximated from the overall effective surface temperature or base temp.
                const Q_radiation_per_m = epsilon * STEFAN_BOLTZMANN * A_total_outer_per_m * (Math.pow(T_base_K, 4) - Math.pow(T_ambient_K, 4)); // W/m

                const Q_total_per_m = Q_convection_per_m + Q_radiation_per_m; // W/m

                const Q_total = Q_total_per_m * L_tube_m; // Total heat transfer for the entire tube length, Watts

                calculationHtml += `<p><strong>3. Heat Transfer Calculation:</strong></p>`;
                calculationHtml += `<p class="formula">
                    \\( Q_{convection}' = h_{external} \\times A_{total,outer}' \\times \\eta_o \\times (T_{base} - T_{ambient}) \\)
                </p>`;
                calculationHtml += `<p class="calculation-step">
                    \\( Q_{convection}' \\) = ${h_external_si.toFixed(2)} \\times ${A_total_outer_per_m.toFixed(2)} \\times ${overall_efficiency_eta_o.toFixed(4)} \\times (${T_base_K.toFixed(2)} - ${T_ambient_K.toFixed(2)}) = ${Q_convection_per_m.toFixed(2)} W/m
                </p>`;
                 calculationHtml += `<p class="formula">
                    \\( Q_{radiation}' = \\epsilon \\sigma A_{total,outer}' (T_{base}^4 - T_{ambient}^4) \\)
                </p>`;
                calculationHtml += `<p class="calculation-step">
                    \\( Q_{radiation}' \\) = ${epsilon.toFixed(2)} \\times ${STEFAN_BOLTZMANN.toExponential(2)} \\times ${A_total_outer_per_m.toFixed(2)} \\times (${T_base_K.toFixed(2)}^4 - ${T_ambient_K.toFixed(2)}^4) = ${Q_radiation_per_m.toFixed(2)} W/m
                </p>`;
                calculationHtml += `<p class="formula">
                    \\( Q_{total}' = Q_{convection}' + Q_{radiation}' \\)
                </p>`;
                calculationHtml += `<p class="calculation-step">
                    \\( Q_{total}' \\) = ${Q_convection_per_m.toFixed(2)} + ${Q_radiation_per_m.toFixed(2)} = ${Q_total_per_m.toFixed(2)} W/m
                </p>`;
                calculationHtml += `<p class="formula">
                    \\( Q_{total} = Q_{total}' \\times L_{tube} \\)
                </p>`;
                calculationHtml += `<p class="calculation-step">
                    \\( Q_{total} \\) = ${Q_total_per_m.toFixed(2)} \\times ${L_tube_m.toFixed(2)} = ${Q_total.toFixed(2)} W
                </p>`;


                // Convert total Q back to original unit system for display
                let displayQ;
                if (unitSystem === 'imperial') {
                    displayQ = Q_total * 3.41214; // Watts to BTU/h
                } else {
                    displayQ = Q_total;
                }

                calculationDetailsDiv.innerHTML = calculationHtml;
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv]);
                }

                // Populate results table
                resultTableBody.innerHTML = '';
                function addResultRow(parameterHtml, valueHtml) {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.innerHTML = parameterHtml;
                    valueCell.innerHTML = valueHtml;
                }

                addResultRow("Unit System", unitSystem === 'imperial' ? 'Imperial' : 'Metric');
                addResultRow("Tube Outer Diameter (Root)", `${D_tube_outer} ${unitSystem === 'imperial' ? '\\(\\text{inch}\\)' : '\\(\\text{mm}\\)'}`);
                addResultRow("Fin Height", `${H_fin} ${unitSystem === 'imperial' ? '\\(\\text{inch}\\)' : '\\(\\text{mm}\\)'}`);
                addResultRow("Fin Thickness", `${t_fin} ${unitSystem === 'imperial' ? '\\(\\text{inch}\\)' : '\\(\\text{mm}\\)'}`);
                addResultRow("Fins per Unit Length", `${N_fins_per_unit_length} ${unitSystem === 'imperial' ? '\\(\\text{fins/ft}\\)' : '\\(\\text{fins/m}\\)'}`);
                addResultRow("Fin Material Conductivity", `${k_fin} ${unitSystem === 'imperial' ? '\\(\\text{BTU/h ft°F}\\)' : '\\(\\text{W/mK}\\)'}`);
                addResultRow("Tube Base Temperature", `${T_base} ${unitSystem === 'imperial' ? '\\(\\text{°F}\\)' : '\\(\\text{°C}\\)'}`);
                addResultRow("Ambient Fluid Temperature", `${T_ambient} ${unitSystem === 'imperial' ? '\\(\\text{°F}\\)' : '\\(\\text{°C}\\)'}`);
                addResultRow("External Convection Coefficient", `${h_external} ${unitSystem === 'imperial' ? '\\(\\text{BTU/h ft}^2\\text{°F}\\)' : '\\(\\text{W/m}^2\\text{°C}\\)'}`);
                addResultRow("Surface Emissivity (\\(\\epsilon\\))", epsilon);
                addResultRow("Tube Length", `${L_tube} ${unitSystem === 'imperial' ? '\\(\\text{ft}\\)' : '\\(\\text{m}\\)'}`);
                
                addResultRow("Fin Efficiency (\\(\\eta_f\\))", `<strong>${fin_efficiency_eta_f.toFixed(4)}</strong>`);
                addResultRow("Overall Surface Efficiency (\\(\\eta_o\\))", `<strong>${overall_efficiency_eta_o.toFixed(4)}</strong>`);
                addResultRow(`Total Heat Transfer Rate (\\(Q\\))`, `<strong>${displayQ.toFixed(2)} ${Q_unit_display}</strong>`);

                if (window.MathJax) {
                    window.MathJax.typesetPromise([resultTableBody, ...diameterUnitLabels, ...lengthUnitLabels, ...tempUnitLabels, ...finsUnitLabels, ...conductivityUnitLabels, ...convectionUnitLabels]);
                }

                standardReference.innerHTML = "Finned tube heat transfer calculations are complex and often rely on empirical correlations and dimensionless numbers (e.g., Reynolds, Prandtl, Nusselt numbers) specific to fin geometry and flow conditions. For detailed design and compliance with international standards, refer to specialized heat transfer engineering handbooks such as <strong>Kern, D. Q., 'Process Heat Transfer'</strong>, <strong>Kays, W. M., & London, A. L., 'Compact Heat Exchangers'</strong>, and standards from organizations like TEMA, ASHRAE, and API.";

                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth' });
                displayMessage("Calculation completed successfully!", "info");
            });

            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>
</html>