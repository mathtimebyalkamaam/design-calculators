<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipe Heat Loss Calculator - Design Calculators - Mechanical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #1976D2;
            --accent-color: #FFC107;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --header-bg: #2C3E50;
            --footer-bg: #34495E;
            --border-color: #cccccc;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            --hover-color: #e2e6ea;
            --primary-color-rgb: 33, 150, 243;
        }
        body.dark-mode {
            --primary-color: #5DADE2;
            --secondary-color: #2874A6;
            --bg-color: #252D3A;
            --card-bg: #2F3C4C;
            --text-color: #E0E6EB;
            --header-bg: #252D3A;
            --footer-bg: #252D3A;
            --border-color: #4C5C70;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            --hover-color: #3A475C;
            --primary-color-rgb: 93, 173, 226;
        }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, var(--bg-color) 0%, rgba(244, 247, 246, 0.8) 100%);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s, background-image 0.3s;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: var(--header-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        header h1 {
            margin: 0;
            font-size: 2.8em;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        header .subtitle {
            margin: 8px 0 0;
            font-size: 1.1em;
            color: #bdc3c7;
        }
        main {
            padding: 30px 0;
        }
        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            transition: transform 0.3s ease-in-out;
        }
        .tool-container:hover {
            transform: translateY(-5px);
        }
        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 2em;
        }
        .tool-description {
            margin-bottom: 25px;
            color: var(--text-color);
            font-size: 1.05em;
        }
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 8px;
        }
        .tool-description strong {
            color: var(--primary-color);
        }
        .back-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 25px;
            transition: background-color 0.3s, transform 0.2s ease-in-out;
            font-weight: bold;
        }
        .back-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.03);
        }
        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
        }
        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            margin: 0 8px;
            font-size: 1.3em;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 65px;
            height: 38px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 30px;
            width: 30px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(27px);
        }
        .slider.round {
            border-radius: 38px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }
        footer .disclaimer h3,
        footer .social-share h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.3em;
        }
        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }
        .social-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #7f8c8d; }
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.05em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.3);
            outline: none;
        }
        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .form-row .form-group {
            flex: 1 1 calc(50% - 10px);
            min-width: 280px;
        }
        @media (max-width: 600px) {
            .form-row .form-group {
                flex: 1 1 100%;
            }
        }
        .calculate-btn {
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 18px 25px; /* Increased padding for taller button */
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-image 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .calculate-btn:hover {
            background-image: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: block;
            opacity: 0;
            transition: opacity 0.6s ease-out;
            pointer-events: none;
        }
        .result-container.show {
            opacity: 1;
            pointer-events: auto;
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            font-size: 1.1em;
        }
        .result-table tr:last-child td {
            border-bottom: none;
        }
        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            line-height: 1.5;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .info-icon {
            color: var(--primary-color);
            margin-left: 8px;
            cursor: help;
            font-size: 1em;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        #custom-message-box {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            font-size: 1.1em;
        }
        #calculation-details {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.98em;
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px dashed var(--border-color);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #calculation-details ul li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Mechanical</h1>
            <p class="subtitle">Smart Tools for Modern Mechanical Engineers</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>
    <main class="container">
        <a href="indexMech.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Tools
        </a>
        <div class="tool-container">
            <h2>Pipe Heat Loss Calculator</h2>
            <div class="tool-description">
                <p>This calculator determines the heat loss from both uninsulated and insulated pipes. It is crucial for energy efficiency and system design in various industrial and domestic applications.</p>
                <p>The calculation considers heat transfer by convection and radiation from the pipe's surface to the ambient environment. For insulated pipes, the thermal resistance of the insulation layer is also accounted for.</p>
                <ul>
                    <li><strong>Uninsulated Pipe:</strong> Heat loss is primarily due to convection and radiation from the outer surface of the pipe.</li>
                    <li><strong>Insulated Pipe:</strong> An insulation layer adds thermal resistance, significantly reducing heat transfer.</li>
                </ul>
                <p><strong>Note:</strong> This calculator provides estimated values. For precise engineering applications, consider specific material properties, environmental conditions, and industry standards (e.g., ASHRAE, ISO 12241).</p>
            </div>
            <div class="calculator-form">
                <form id="heat-loss-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pipe-type">Pipe Type: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select whether the pipe is uninsulated or insulated.</span></span></label>
                            <select id="pipe-type" required>
                                <option value="uninsulated">Uninsulated</option>
                                <option value="insulated">Insulated</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="unit-system">Unit System: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (e.g., mm, m, °C, W/mK) or Imperial (e.g., inch, ft, °F, BTU/h ft°F) units.</span></span></label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (\(\text{mm}\), \(\text{m}\), \(\text{°C}\), \(\text{W/mK}\))</option>
                                <option value="imperial">Imperial (\(\text{inch}\), \(\text{ft}\), \(\text{°F}\), \(\text{BTU/h ft°F}\))</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pipe-outer-diameter">Pipe Outer Diameter <span class="diameter-unit-label">(\(\text{mm}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the outer diameter of the pipe.</span></span></label>
                            <input type="number" id="pipe-outer-diameter" step="0.1" value="100" min="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="pipe-length">Pipe Length <span class="length-unit-label">(\(\text{m}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the total length of the pipe.</span></span></label>
                            <input type="number" id="pipe-length" step="0.1" value="10" min="0.1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fluid-temperature">Fluid Temperature <span class="temp-unit-label">(\(\text{°C}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the temperature of the fluid inside the pipe.</span></span></label>
                            <input type="number" id="fluid-temperature" step="0.1" value="80" required>
                        </div>
                        <div class="form-group">
                            <label for="ambient-temperature">Ambient Temperature <span class="temp-unit-label">(\(\text{°C}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the temperature of the surrounding air.</span></span></label>
                            <input type="number" id="ambient-temperature" step="0.1" value="20" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="surface-emissivity">Surface Emissivity (\(\epsilon\)): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Typically 0.95 for painted surfaces, 0.05 for polished metals.</span></span></label>
                            <input type="number" id="surface-emissivity" step="0.01" value="0.95" min="0" max="1" required>
                        </div>
                         <div class="form-group">
                            <label for="air-velocity">Air Velocity (\(\text{m/s}\)): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Velocity of air around the pipe. 0 for still air.</span></span></label>
                            <input type="number" id="air-velocity" step="0.01" value="0" min="0" required>
                        </div>
                    </div>
                    <div id="insulated-options" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="insulation-thickness">Insulation Thickness <span class="thickness-unit-label">(\(\text{mm}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the thickness of the insulation layer.</span></span></label>
                                <input type="number" id="insulation-thickness" step="0.1" value="50" min="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="insulation-conductivity">Insulation Thermal Conductivity <span class="conductivity-unit-label">(\(\text{W/mK}\))</span>: <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the thermal conductivity of the insulation material.</span></span></label>
                                <input type="number" id="insulation-conductivity" step="0.001" value="0.04" min="0.001" required>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="calculate-heat-loss-btn" class="calculate-btn">Calculate Heat Loss</button>
                </form>
            </div>
            <div id="result-container" class="result-container">
                <h3>Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>
    </main>
    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>To ensure accuracy and reliability, always verify the results obtained from these tools against the relevant engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <p>Created by A Sharma</p>
            </div>
            <div class="social-share">
                <h3>Share This Site</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn linkedin">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?text=Check out this amazing Design Calculators - Mechanical!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://api.whatsapp.com/send?text=Check out this amazing Design Calculators - Mechanical! https://designcalculators.co.in" target="_blank" class="social-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Design Calculators - Mechanical" target="_blank" class="social-btn reddit">
                        <i class="fab fa-reddit"></i>
                    </a>
                    <a href="mailto:?subject=Check out Design Calculators - Mechanical!&body=I found this amazing Pipe Heat Loss Calculator and other mechanical tools: https://designcalculators.co.in" class="social-btn email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-heat-loss-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');

            const pipeTypeSelect = document.getElementById('pipe-type');
            const unitSystemSelect = document.getElementById('unit-system');
            const pipeOuterDiameterInput = document.getElementById('pipe-outer-diameter');
            const pipeLengthInput = document.getElementById('pipe-length');
            const fluidTemperatureInput = document.getElementById('fluid-temperature');
            const ambientTemperatureInput = document.getElementById('ambient-temperature');
            const surfaceEmissivityInput = document.getElementById('surface-emissivity');
            const airVelocityInput = document.getElementById('air-velocity');

            const insulatedOptionsDiv = document.getElementById('insulated-options');
            const insulationThicknessInput = document.getElementById('insulation-thickness');
            const insulationConductivityInput = document.getElementById('insulation-conductivity');

            const diameterUnitLabels = document.querySelectorAll('.diameter-unit-label');
            const lengthUnitLabels = document.querySelectorAll('.length-unit-label');
            const tempUnitLabels = document.querySelectorAll('.temp-unit-label');
            const thicknessUnitLabels = document.querySelectorAll('.thickness-unit-label');
            const conductivityUnitLabels = document.querySelectorAll('.conductivity-unit-label');

            const STEFAN_BOLTZMANN = 5.67e-8; // Stefan-Boltzmann constant W/(m^2 K^4)

            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }
                messageBox.textContent = message;
                if (type === "error") {
                    messageBox.style.backgroundColor = '#dc3545';
                    messageBox.style.color = 'white';
                } else if (type === "warning") {
                    messageBox.style.backgroundColor = '#ffc107';
                    messageBox.style.color = '#333';
                } else {
                    messageBox.style.backgroundColor = '#28a745';
                    messageBox.style.color = 'white';
                }
                messageBox.style.opacity = 1;
                setTimeout(() => {
                    messageBox.style.opacity = 0;
                }, 5000);
            }

            function updateUI() {
                const pipeType = pipeTypeSelect.value;
                const unitSystem = unitSystemSelect.value;

                // Update unit labels
                if (unitSystem === 'imperial') {
                    diameterUnitLabels.forEach(label => label.innerHTML = '(\\(\text{inch}\\))');
                    lengthUnitLabels.forEach(label => label.innerHTML = '(\\(\text{ft}\\))');
                    tempUnitLabels.forEach(label => label.innerHTML = '(\\(\text{°F}\\))');
                    thicknessUnitLabels.forEach(label => label.innerHTML = '(\\(\text{inch}\\))');
                    conductivityUnitLabels.forEach(label => label.innerHTML = '(\\(\text{BTU/h ft°F}\\))');
                    document.querySelector('label[for="air-velocity"]').innerHTML = `Air Velocity (\\(\\text{ft/s}\\)): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Velocity of air around the pipe. 0 for still air.</span></span>`;

                } else { // Metric
                    diameterUnitLabels.forEach(label => label.innerHTML = '(\\(\text{mm}\\))');
                    lengthUnitLabels.forEach(label => label.innerHTML = '(\\(\text{m}\\))');
                    tempUnitLabels.forEach(label => label.innerHTML = '(\\(\text{°C}\\))');
                    thicknessUnitLabels.forEach(label => label.innerHTML = '(\\(\text{mm}\\))');
                    conductivityUnitLabels.forEach(label => label.innerHTML = '(\\(\text{W/mK}\\))');
                    document.querySelector('label[for="air-velocity"]').innerHTML = `Air Velocity (\\(\text{m/s}\\)): <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Velocity of air around the pipe. 0 for still air.</span></span>`;
                }

                // Show/hide insulation options
                if (pipeType === 'insulated') {
                    insulatedOptionsDiv.style.display = 'block';
                    insulationThicknessInput.required = true;
                    insulationConductivityInput.required = true;
                } else {
                    insulatedOptionsDiv.style.display = 'none';
                    insulationThicknessInput.required = false;
                    insulationConductivityInput.required = false;
                }
            }

            pipeTypeSelect.addEventListener('change', updateUI);
            unitSystemSelect.addEventListener('change', updateUI);
            updateUI(); // Initial UI update

            calculateBtn.addEventListener('click', function() {
                // Get input values
                const pipeType = pipeTypeSelect.value;
                const unitSystem = unitSystemSelect.value;

                let D_outer = parseFloat(pipeOuterDiameterInput.value); // mm or inch
                let L = parseFloat(pipeLengthInput.value); // m or ft
                let T_fluid = parseFloat(fluidTemperatureInput.value); // °C or °F
                let T_ambient = parseFloat(ambientTemperatureInput.value); // °C or °F
                let epsilon = parseFloat(surfaceEmissivityInput.value);
                let v_air = parseFloat(airVelocityInput.value); // m/s or ft/s

                let t_ins = 0; // insulation thickness, mm or inch
                let k_ins = 0; // insulation thermal conductivity, W/mK or BTU/h ft°F

                if (pipeType === 'insulated') {
                    t_ins = parseFloat(insulationThicknessInput.value);
                    k_ins = parseFloat(insulationConductivityInput.value);
                }

                // Input validation
                const inputs = [D_outer, L, T_fluid, T_ambient, epsilon, v_air];
                if (pipeType === 'insulated') {
                    inputs.push(t_ins, k_ins);
                }

                for (let i = 0; i < inputs.length; i++) {
                    if (isNaN(inputs[i]) || inputs[i] < (i === 4 ? 0 : (i === 5 ? 0 : 0.001))) { // Emissivity can be 0, air velocity can be 0. Others > 0.
                        displayMessage("Please enter valid positive numbers for all required fields.", "error");
                        return;
                    }
                     if (inputs[i] > (i === 4 ? 1 : Infinity)) { // Emissivity max 1
                        displayMessage("Emissivity must be between 0 and 1.", "error");
                        return;
                    }
                }
                 if (T_fluid <= T_ambient) {
                    displayMessage("Fluid temperature must be greater than ambient temperature for heat loss.", "error");
                    return;
                }


                let D_outer_m, L_m, T_fluid_K, T_ambient_K, v_air_m_s, t_ins_m, k_ins_si;
                let h_c_unit, Q_unit; // Units for display in calculation steps

                // Convert to SI units for calculation
                if (unitSystem === 'imperial') {
                    D_outer_m = D_outer * 0.0254; // inch to meter
                    L_m = L * 0.3048; // ft to meter
                    T_fluid_K = (T_fluid - 32) * 5/9 + 273.15; // °F to Kelvin
                    T_ambient_K = (T_ambient - 32) * 5/9 + 273.15; // °F to Kelvin
                    v_air_m_s = v_air * 0.3048; // ft/s to m/s
                    if (pipeType === 'insulated') {
                        t_ins_m = t_ins * 0.0254; // inch to meter
                        k_ins_si = k_ins * 1.730735; // BTU/h ft°F to W/mK
                    }
                    h_c_unit = '\\(\\text{BTU/(h ft}^2\\text{°F)}\\)';
                    Q_unit = '\\(\\text{BTU/h}\\)';
                    displayMessage("Imperial units are converted to Metric for calculations. Results will be converted back.", "info");
                } else { // Metric
                    D_outer_m = D_outer / 1000; // mm to meter
                    L_m = L; // m
                    T_fluid_K = T_fluid + 273.15; // °C to Kelvin
                    T_ambient_K = T_ambient + 273.15; // °C to Kelvin
                    v_air_m_s = v_air; // m/s
                    if (pipeType === 'insulated') {
                        t_ins_m = t_ins / 1000; // mm to meter
                        k_ins_si = k_ins; // W/mK
                    }
                    h_c_unit = '\\(\\text{W/(m}^2\\text{°C)}\\)';
                    Q_unit = '\\(\\text{W}\\)';
                }

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                calculationHtml += `<p><strong>1. Input Parameters (Converted to SI Units):</strong></p>`;
                calculationHtml += `<ul>
                    <li>Pipe Outer Diameter (\\(D_{outer}\\)): ${D_outer_m.toFixed(4)} m</li>
                    <li>Pipe Length (\\(L\\)): ${L_m.toFixed(2)} m</li>
                    <li>Fluid Temperature (\\(T_{fluid}\\)): ${T_fluid_K.toFixed(2)} K</li>
                    <li>Ambient Temperature (\\(T_{ambient}\\)): ${T_ambient_K.toFixed(2)} K</li>
                    <li>Surface Emissivity (\\(\\epsilon\\)): ${epsilon.toFixed(2)}</li>
                    <li>Air Velocity (\\(v_{air}\\)): ${v_air_m_s.toFixed(2)} m/s</li>`;
                if (pipeType === 'insulated') {
                    calculationHtml += `<li>Insulation Thickness (\\(t_{ins}\\)): ${t_ins_m.toFixed(4)} m</li>
                                        <li>Insulation Thermal Conductivity (\\(k_{ins}\\)): ${k_ins_si.toFixed(3)} W/mK</li>`;
                }
                calculationHtml += `</ul>`;

                let Q_total; // Total heat loss
                let T_surface_K; // Declare T_surface_K at a higher scope
                let T_ins_surface_K; // Declare T_ins_surface_K at a higher scope

                // Determine surface temperature (initial guess: average of fluid and ambient, then iterate)
                let T_surface_K_guess = (T_fluid_K + T_ambient_K) / 2;
                
                let iterations = 0;
                const MAX_ITERATIONS = 100;
                const CONVERGENCE_CRITERIA = 0.01; // Kelvin

                const h_fluid_convection = 100; // Placeholder for internal fluid convection coefficient, assuming good internal transfer. For a real calc, this would be complex.

                let R_total;
                let R_pipe_conduction = 0; // Assuming negligible pipe wall resistance for simplicity as pipe thermal conductivity is usually high.

                calculationHtml += `<p><strong>2. Calculate Thermal Resistance and Heat Transfer Coefficient:</strong></p>`;

                if (pipeType === 'uninsulated') {
                    // For uninsulated, the outer surface is the pipe surface
                    let h_c_outer, h_r_outer, h_total_outer;

                    for (iterations = 0; iterations < MAX_ITERATIONS; iterations++) {
                        // Calculate convection coefficient (h_c) for natural or forced convection
                        // Simplified approach for h_c (for more accuracy, use correlations like Churchill-Bernstein for forced convection over cylinders, or natural convection correlations like Churchill-Chu for vertical plates)
                        // Here, a very simplified approach based on air velocity
                        // This part is a simplification. A more rigorous approach would involve Reynolds number, Prandtl number, Nusselt number correlations.

                        const k_air = 0.026; // Thermal conductivity of air at typical room temp (W/mK)
                        const nu_air = 1.5e-5; // Kinematic viscosity of air at typical room temp (m^2/s)
                        const Pr_air = 0.707; // Prandtl number for air

                        let Re_D = (v_air_m_s * D_outer_m) / nu_air; // Reynolds number
                        let Nu_D; // Nusselt number

                        if (v_air_m_s < 0.1) { // Natural convection (still air) - simplified, usually depends on Grashof and Prandtl
                            Nu_D = 0.53 * Math.pow((9.81 * Math.abs(T_surface_K_guess - T_ambient_K) * Math.pow(D_outer_m, 3)) / (nu_air * nu_air * (T_ambient_K)), 0.25); // RaD correlation
                            calculationHtml += `<p class="calculation-step">Since air velocity is low (${v_air_m_s.toFixed(2)} m/s), assuming natural convection.</p>`;
                            calculationHtml += `<p class="calculation-step">Grashof Number (Gr) approx \\( = \\frac{g \\beta (T_s - T_\\infty) D^3}{\\nu^2}\\) (simplified, using T_surface_K_guess) = ${((9.81 * Math.abs(T_surface_K_guess - T_ambient_K) * Math.pow(D_outer_m, 3)) / (nu_air * nu_air * (T_ambient_K))).toExponential(2)}</p>`;
                            calculationHtml += `<p class="calculation-step">Nusselt Number (Nu) approx \\( = 0.53 \\times (Gr \\times Pr)^{0.25}\\) = ${Nu_D.toFixed(2)}</p>`;

                        } else { // Forced convection over cylinder (simplified for external flow) - using a simple correlation for Re_D > 0.4
                            Nu_D = (0.3 + 0.62 * Math.pow(Re_D, 0.5) * Math.pow(Pr_air, 1/3)) / Math.pow(1 + Math.pow(0.4/Pr_air, 2/3), 0.25) * (1 + Math.pow(Re_D/282000, 0.5)); // Zukauskas correlation is more complex, this is simplified.
                            calculationHtml += `<p class="calculation-step">Assuming forced convection around the pipe with Reynolds Number (Re) = ${Re_D.toExponential(2)}.</p>`;
                            calculationHtml += `<p class="calculation-step">Nusselt Number (Nu) based on simplified forced convection correlation = ${Nu_D.toFixed(2)}</p>`;

                        }
                        h_c_outer = (Nu_D * k_air) / D_outer_m;
                        calculationHtml += `<p class="calculation-step">Convective Heat Transfer Coefficient (\\(h_c\\)) = \\(\\frac{Nu \\times k_{air}}{D_{outer}}\\) = \\(\\frac{${Nu_D.toFixed(2)} \\times ${k_air.toFixed(3)}}{${D_outer_m.toFixed(4)}}\\) = ${h_c_outer.toFixed(2)} W/(m^2 °C)</p>`;

                        // Radiation coefficient
                        h_r_outer = epsilon * STEFAN_BOLTZMANN * (Math.pow(T_surface_K_guess, 2) + Math.pow(T_ambient_K, 2)) * (T_surface_K_guess + T_ambient_K);
                        calculationHtml += `<p class="calculation-step">Radiative Heat Transfer Coefficient (\\(h_r\\)) = \\(\\epsilon \\sigma (T_s^2 + T_\\infty^2)(T_s + T_\\infty)\\) = ${h_r_outer.toFixed(2)} W/(m^2 °C)</p>`;

                        h_total_outer = h_c_outer + h_r_outer;
                        calculationHtml += `<p class="calculation-step">Total Outer Surface Heat Transfer Coefficient (\\(h_{total,outer}\\)) = \\(h_c + h_r\\) = ${h_total_outer.toFixed(2)} W/(m^2 °C)</p>`;

                        // Calculate total resistance
                        // R_total = 1 / (h_fluid_convection * A_inner) + R_pipe_conduction + 1 / (h_total_outer * A_outer)
                        // Assuming A_inner approx A_outer for heat loss calculation for pipe wall and surface convection
                        R_total = (1 / h_fluid_convection) + (1 / h_total_outer); // Simplified as internal resistance and pipe wall resistance are often negligible compared to external.

                        // Calculate new surface temperature
                        T_surface_K = T_ambient_K + (T_fluid_K - T_ambient_K) * ( (1 / h_total_outer) / R_total);

                        if (Math.abs(T_surface_K - T_surface_K_guess) < CONVERGENCE_CRITERIA) {
                            break; // Converged
                        }
                        T_surface_K_guess = T_surface_K;
                    }
                    if (iterations === MAX_ITERATIONS) {
                        displayMessage("Warning: Surface temperature calculation did not converge perfectly. Results may be approximate.", "warning");
                    }
                    calculationHtml += `<p class="calculation-step">Iterated pipe surface temperature (\\(T_{surface}\\)) = ${(T_surface_K - 273.15).toFixed(2)} °C (${T_surface_K.toFixed(2)} K)</p>`;

                    R_total = 1 / (h_total_outer * Math.PI * D_outer_m * L_m); // Total thermal resistance (for the entire pipe length)
                    calculationHtml += `<p class="calculation-step">Total Thermal Resistance (\\(R_{total}\\)) = \\(\\frac{1}{h_{total,outer} \\times \\pi \\times D_{outer} \\times L}\\) = ${R_total.toExponential(2)} K/W</p>`;


                    // Q = (T_fluid_K - T_ambient_K) / R_total; // This would be for overall heat transfer coefficient U.
                    // Instead, calculate Q based on outer surface temperature and h_total_outer
                    Q_total = h_total_outer * Math.PI * D_outer_m * L_m * (T_surface_K - T_ambient_K);
                    calculationHtml += `<p class="calculation-step">Heat Loss (\\(Q\\)) = \\(h_{total,outer} \\times \\pi \\times D_{outer} \\times L \\times (T_{surface} - T_{ambient})\\)</p>`;
                    calculationHtml += `<p class="calculation-step">\\(Q\\) = ${h_total_outer.toFixed(2)} \\times \\pi \\times ${D_outer_m.toFixed(4)} \\times ${L_m.toFixed(2)} \\times (${T_surface_K.toFixed(2)} - ${T_ambient_K.toFixed(2)}) = ${Q_total.toFixed(2)} W</p>`;


                } else { // Insulated pipe
                    let D_ins_outer_m = D_outer_m + 2 * t_ins_m; // Outer diameter of insulation
                    let h_c_ins_outer, h_r_ins_outer, h_total_ins_outer;
                    let T_ins_surface_K_guess = (T_fluid_K + T_ambient_K) / 2;
                   

                    calculationHtml += `<p class="calculation-step">Outer Diameter of Insulation (\\(D_{ins,outer}\\)) = \\(D_{outer} + 2 \\times t_{ins}\\) = ${D_ins_outer_m.toFixed(4)} m</p>`;

                    // Iteration for insulation surface temperature
                    for (iterations = 0; iterations < MAX_ITERATIONS; iterations++) {
                        const k_air = 0.026; // Thermal conductivity of air at typical room temp (W/mK)
                        const nu_air = 1.5e-5; // Kinematic viscosity of air at typical room temp (m^2/s)
                        const Pr_air = 0.707; // Prandtl number for air

                        let Re_D_ins = (v_air_m_s * D_ins_outer_m) / nu_air;
                        let Nu_D_ins;

                        if (v_air_m_s < 0.1) { // Natural convection
                             Nu_D_ins = 0.53 * Math.pow((9.81 * Math.abs(T_ins_surface_K_guess - T_ambient_K) * Math.pow(D_ins_outer_m, 3)) / (nu_air * nu_air * (T_ambient_K)), 0.25);
                             calculationHtml += `<p class="calculation-step">Since air velocity is low (${v_air_m_s.toFixed(2)} m/s), assuming natural convection over insulation surface.</p>`;
                             calculationHtml += `<p class="calculation-step">Nusselt Number (Nu) approx \\( = 0.53 \\times (Gr \\times Pr)^{0.25}\\) = ${Nu_D_ins.toFixed(2)}</p>`;
                        } else { // Forced convection
                            Nu_D_ins = (0.3 + 0.62 * Math.pow(Re_D_ins, 0.5) * Math.pow(Pr_air, 1/3)) / Math.pow(1 + Math.pow(0.4/Pr_air, 2/3), 0.25) * (1 + Math.pow(Re_D_ins/282000, 0.5));
                            calculationHtml += `<p class="calculation-step">Assuming forced convection over insulation surface with Reynolds Number (Re) = ${Re_D_ins.toExponential(2)}.</p>`;
                            calculationHtml += `<p class="calculation-step">Nusselt Number (Nu) based on simplified forced convection correlation = ${Nu_D_ins.toFixed(2)}</p>`;
                        }
                        h_c_ins_outer = (Nu_D_ins * k_air) / D_ins_outer_m;
                        calculationHtml += `<p class="calculation-step">Convective Heat Transfer Coefficient (\\(h_{c,ins,outer}\\)) = \\(\\frac{Nu \\times k_{air}}{D_{ins,outer}}\\) = \\(\\frac{${Nu_D_ins.toFixed(2)} \\times ${k_air.toFixed(3)}}{${D_ins_outer_m.toFixed(4)}}\\) = ${h_c_ins_outer.toFixed(2)} W/(m^2 °C)</p>`;

                        h_r_ins_outer = epsilon * STEFAN_BOLTZMANN * (Math.pow(T_ins_surface_K_guess, 2) + Math.pow(T_ambient_K, 2)) * (T_ins_surface_K_guess + T_ambient_K);
                        calculationHtml += `<p class="calculation-step">Radiative Heat Transfer Coefficient (\\(h_{r,ins,outer}\\)) = \\(\\epsilon \\sigma (T_s^2 + T_\\infty^2)(T_s + T_\\infty)\\) = ${h_r_ins_outer.toFixed(2)} W/(m^2 °C)</p>`;

                        h_total_ins_outer = h_c_ins_outer + h_r_ins_outer;
                        calculationHtml += `<p class="calculation-step">Total Outer Insulation Surface Heat Transfer Coefficient (\\(h_{total,ins,outer}\\)) = \\(h_{c,ins,outer} + h_{r,ins,outer}\\) = ${h_total_ins_outer.toFixed(2)} W/(m^2 °C)</p>`;

                        // Resistances (per unit length)
                        const R_insulation = Math.log(D_ins_outer_m / D_outer_m) / (2 * Math.PI * k_ins_si);
                        const R_outer_surface = 1 / (h_total_ins_outer * Math.PI * D_ins_outer_m);

                        // Heat transfer based on current insulation surface temperature guess
                        const Q_from_fluid_to_ins_surface_per_m = (T_fluid_K - T_ins_surface_K_guess) / ( (1 / (h_fluid_convection * Math.PI * D_outer_m)) + R_insulation);
                        const Q_from_ins_surface_to_ambient_per_m = (T_ins_surface_K_guess - T_ambient_K) / R_outer_surface;

                        // New guess for surface temperature
                        T_ins_surface_K = T_ins_surface_K_guess - (Q_from_ins_surface_to_ambient_per_m - Q_from_fluid_to_ins_surface_per_m) * R_outer_surface; // Adjust guess based on imbalance

                        if (Math.abs(T_ins_surface_K - T_ins_surface_K_guess) < CONVERGENCE_CRITERIA) {
                            break; // Converged
                        }
                        T_ins_surface_K_guess = T_ins_surface_K;
                    }
                     if (iterations === MAX_ITERATIONS) {
                        displayMessage("Warning: Insulation surface temperature calculation did not converge perfectly. Results may be approximate.", "warning");
                    }
                    calculationHtml += `<p class="calculation-step">Iterated insulation surface temperature (\\(T_{ins,surface}\\)) = ${(T_ins_surface_K - 273.15).toFixed(2)} °C (${T_ins_surface_K.toFixed(2)} K)</p>`;


                    // Calculate total thermal resistance (per unit length, then for total length)
                    const R_conv_fluid_inner = 1 / (h_fluid_convection * Math.PI * D_outer_m); // Inner convection
                    const R_cond_insulation = Math.log(D_ins_outer_m / D_outer_m) / (2 * Math.PI * k_ins_si); // Insulation conduction
                    const R_conv_rad_outer = 1 / (h_total_ins_outer * Math.PI * D_ins_outer_m); // Outer convection + radiation

                    R_total = (R_conv_fluid_inner + R_cond_insulation + R_conv_rad_outer) * L_m; // Total resistance for the length L

                    calculationHtml += `<p class="calculation-step">Internal Convection Resistance (per unit length) = \\(\\frac{1}{h_{fluid} \\times \\pi \\times D_{outer}}\\) = ${R_conv_fluid_inner.toExponential(2)} (mK/W)</p>`;
                    calculationHtml += `<p class="calculation-step">Insulation Conduction Resistance (per unit length) = \\(\\frac{ln(D_{ins,outer} / D_{outer})}{2 \\times \\pi \\times k_{ins}}\\) = ${R_cond_insulation.toExponential(2)} (mK/W)</p>`;
                    calculationHtml += `<p class="calculation-step">External Convection & Radiation Resistance (per unit length) = \\(\\frac{1}{h_{total,ins,outer} \\times \\pi \\times D_{ins,outer}}\\) = ${R_conv_rad_outer.toExponential(2)} (mK/W)</p>`;
                    calculationHtml += `<p class="calculation-step">Total Thermal Resistance (\\(R_{total}\\)) = \\((R_{conv,fluid,inner} + R_{cond,insulation} + R_{conv,rad,outer}) \\times L\\) = ${R_total.toExponential(2)} K/W</p>`;


                    // Q = Delta T / R_total
                    Q_total = (T_fluid_K - T_ambient_K) / R_total;
                    calculationHtml += `<p class="calculation-step">Heat Loss (\\(Q\\)) = \\(\\frac{T_{fluid} - T_{ambient}}{R_{total}}\\) = \\(\\frac{${T_fluid_K.toFixed(2)} - ${T_ambient_K.toFixed(2)}}{${R_total.toExponential(2)}}\\) = ${Q_total.toFixed(2)} W</p>`;
                }

                // Convert Q_total back to original unit system for display
                let displayQ;
                let displayQUnit;

                if (unitSystem === 'imperial') {
                    displayQ = Q_total * 3.41214; // Watts to BTU/h
                    displayQUnit = '\\(\\text{BTU/h}\\)';
                } else { // Metric
                    displayQ = Q_total;
                    displayQUnit = '\\(\\text{W}\\)';
                }

                calculationDetailsDiv.innerHTML = calculationHtml;
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv]);
                }

                // Populate results table
                resultTableBody.innerHTML = '';
                function addResultRow(parameterHtml, valueHtml) {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.innerHTML = parameterHtml;
                    valueCell.innerHTML = valueHtml;
                }

                addResultRow("Pipe Type", pipeType === 'insulated' ? 'Insulated' : 'Uninsulated');
                addResultRow("Unit System", unitSystem === 'imperial' ? 'Imperial' : 'Metric');
                addResultRow("Pipe Outer Diameter", `${D_outer} ${unitSystem === 'imperial' ? '\\(\\text{inch}\\)' : '\\(\\text{mm}\\)'}`);
                addResultRow("Pipe Length", `${L} ${unitSystem === 'imperial' ? '\\(\\text{ft}\\)' : '\\(\\text{m}\\)'}`);
                addResultRow("Fluid Temperature", `${T_fluid} ${unitSystem === 'imperial' ? '\\(\\text{°F}\\)' : '\\(\\text{°C}\\)'}`);
                addResultRow("Ambient Temperature", `${T_ambient} ${unitSystem === 'imperial' ? '\\(\\text{°F}\\)' : '\\(\\text{°C}\\)'}`);
                addResultRow("Surface Emissivity (\\(\\epsilon\\))", epsilon);
                addResultRow("Air Velocity", `${v_air} ${unitSystem === 'imperial' ? '\\(\\text{ft/s}\\)' : '\\(\\text{m/s}\\)'}`);

                if (pipeType === 'insulated') {
                    addResultRow("Insulation Thickness", `${t_ins} ${unitSystem === 'imperial' ? '\\(\\text{inch}\\)' : '\\(\\text{mm}\\)'}`);
                    addResultRow("Insulation Thermal Conductivity", `${k_ins} ${unitSystem === 'imperial' ? '\\(\\text{BTU/h ft°F}\\)' : '\\(\\text{W/mK}\\)'}`);
                    addResultRow(`Calculated Insulation Surface Temp`, `<strong>${(T_ins_surface_K - 273.15).toFixed(2)} ${unitSystem === 'imperial' ? '\\(\\text{°F}\\)' : '\\(\\text{°C}\\)'}</strong>`);
                } else {
                    addResultRow(`Calculated Pipe Surface Temp`, `<strong>${(T_surface_K - 273.15).toFixed(2)} ${unitSystem === 'imperial' ? '\\(\\text{°F}\\)' : '\\(\\text{°C}\\)'}</strong>`);
                }
                addResultRow(`Total Heat Loss (\\(Q\\))`, `<strong>${displayQ.toFixed(2)} ${displayQUnit}</strong>`);

                if (window.MathJax) {
                    window.MathJax.typesetPromise([resultTableBody, ...diameterUnitLabels, ...lengthUnitLabels, ...tempUnitLabels, ...thicknessUnitLabels, ...conductivityUnitLabels]);
                }

                standardReference.innerHTML = "Heat loss calculations involve principles of conduction, convection, and radiation. For more in-depth analysis and design, refer to engineering handbooks like <strong>Incropera, F. P., DeWitt, D. P., Bergman, T. L., & Lavine, A. S., 'Fundamentals of Heat and Mass Transfer'</strong> or relevant industry standards such as ASHRAE or ISO 12241.";

                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth' });
                displayMessage("Calculation completed successfully!", "info");
            });

            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }
                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }
        });
    </script>
</body>

</html>
