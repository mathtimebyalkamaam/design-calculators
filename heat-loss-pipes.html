<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Pipe Heat Loss Calculator - Design Calculators - Mechanical</title>
    <meta name="description" content="Professional-grade calculator for determining heat loss from insulated and uninsulated pipes using iterative surface temperature calculations per ASME and ISO standards.">
    <meta name="keywords" content="pipe heat loss calculator, insulation, heat transfer, convection, radiation, thermal resistance, ASME, ISO 12241, energy efficiency, process engineering">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Ad & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V440SR'); // Corrected a typo in your original gtag config ID
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    
    <!-- Icons & Favicon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>

    <!-- Main Stylesheet -->
    <style>
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        :root {
            --primary-color: #1E3A8A; /* Dark Blue */
            --secondary-color: #2563EB; /* Bright Blue */
            --accent-color: #F59E0B; /* Amber/Gold */
            --success-color: #10B981; /* Green */
            --danger-color: #EF4444; /* Red */
            --danger-color-dark: #DC2626; /* Darker Red */
            --bg-color: #F8FAFC; /* Light Gray Background */
            --card-bg: #FFFFFF;
            --text-color: #4B5563; /* Gray text */
            --heading-color: #111827; /* Dark text */
            --footer-bg: #0F172A; /* Very Dark Blue */
            --border-color: #E2E8F0; /* Light border */
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --gradient-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --primary-color-rgb: 30, 58, 138;
        }

        body.dark-mode {
            --primary-color: #10B981; /* Green */
            --secondary-color: #34D399; /* Lighter Green */
            --accent-color: #F59E0B; /* Amber/Gold */
            --bg-color: #0F172A; /* Very Dark Blue */
            --card-bg: #1E293B; /* Dark Blue-Gray */
            --text-color: #CBD5E1; /* Light Gray text */
            --heading-color: #F1F5F9; /* White text */
            --footer-bg: #020617; /* Nearly Black */
            --border-color: #334155; /* Gray-Blue border */
            --primary-color-rgb: 16, 185, 129;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
            transition: background-color 0.3s, color 0.3s;
            margin: 0;
            padding: 0;
        }

        .container { 
            max-width: 1000px; /* Constrained width for better readability */
            margin: 0 auto; 
            padding: 0 24px; 
        }

        /* NEW HEADER */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            animation: slideIn 0.5s ease;
            margin-bottom: 30px; /* Add margin to separate from content */
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1280px; /* Wider container for header */
            margin: 0 auto;
            padding: 0 24px;
        }
        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }
        .nav-links a:hover {
            color: var(--accent-color);
            transform: translateY(-2px);
        }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .theme-toggle .icon {
            color: white;
            font-size: 1.2rem;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent-color);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        /* END NEW HEADER */

        main {
            padding: 0; /* Remove default padding, container handles it */
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease;
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .tool-container h3 {
            color: var(--primary-color);
            margin-top: 25px;
            margin-bottom: 15px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
        }

        .tool-description {
            margin-bottom: 25px;
            font-size: 1.05rem;
            line-height: 1.8;
        }
        .tool-description ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
            margin-top: 15px;
        }
        .tool-description ul li {
            margin-bottom: 10px;
        }
        .tool-description strong {
            color: var(--heading-color);
            font-weight: 600;
        }

        .calculator-form {
            background-color: var(--card-bg); /* Form is part of the container now */
            border-radius: 12px;
            padding: 0; /* No extra padding needed */
            margin-top: 25px;
        }

        .form-group {
            margin-bottom: 20px;
            animation: slideIn 0.5s ease;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading-color);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.25);
            outline: none;
            background-color: var(--card-bg);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .calculate-btn, .reset-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }

        .calculate-btn {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(var(--primary-color-rgb), 0.3);
        }
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(var(--primary-color-rgb), 0.4);
            animation: pulse 0.6s ease;
        }

        .reset-btn {
            background: linear-gradient(135deg, var(--danger-color), var(--danger-color-dark));
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            flex: 0 1 auto; /* Don't grow as much as calculate */
        }
        .reset-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }
        .result-container.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #calculation-details {
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            animation: fadeInUp 0.7s ease;
            font-size: 0.95rem;
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            text-align: center;
            padding: 15px;
            background: linear-gradient(90deg, transparent, rgba(var(--primary-color-rgb), 0.05), transparent);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--card-bg);
            padding: 10px 12px;
            border-radius: 4px;
            border-left: 4px solid var(--secondary-color);
            margin-bottom: 10px;
            overflow-x: auto;
            white-space: pre-wrap; /* Allow wrapping */
            word-wrap: break-word;
        }
        #calculation-details ul {
            list-style-type: disc;
            margin-left: 25px;
            padding-left: 0;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
            animation: fadeInUp 0.8s ease;
        }
        .result-table th, .result-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .result-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 700;
        }
        .result-table tr:nth-child(even) {
            background-color: var(--bg-color);
        }
        .result-table tr:last-child td {
            border-bottom: none;
        }
        .result-table tr:hover {
            background-color: rgba(var(--primary-color-rgb), 0.1);
        }
        .result-table td:first-child {
            font-weight: 600;
            color: var(--heading-color);
        }
        .result-table strong {
            font-size: 1.1em;
            color: var(--primary-color);
        }

        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            padding: 15px;
            background: linear-gradient(135deg, rgba(var(--primary-color-rgb),0.1), rgba(var(--primary-color-rgb),0.05));
            border-left: 4px solid var(--primary-color);
            border-radius: 6px;
            line-height: 1.7;
            animation: fadeInUp 0.9s ease;
        }

        .info-icon {
            color: var(--primary-color);
            margin-left: 6px;
            cursor: help;
            transition: transform 0.3s;
            font-size: 0.9em;
        }
        .info-icon:hover {
            transform: scale(1.2) rotate(10deg);
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 260px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 130%;
            left: 50%;
            margin-left: -130px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            white-space: normal;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-size: 1.05em;
        }
        #custom-message-box.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Educational Content Specifics */
        .educational-content {
            font-size: 1.05rem;
        }
        .educational-content ul, .educational-content ol {
            margin-left: 25px;
            padding-left: 0;
        }
        .educational-content li {
            margin-bottom: 10px;
        }
        .educational-content .formula-box {
            font-family: 'Times New Roman', serif;
            font-size: 1.15rem;
            text-align: center;
            padding: 15px;
            background-color: var(--bg-color);
            border: 1px dashed var(--border-color);
            border-radius: 6px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .educational-content .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.95rem;
        }
        .educational-content .data-table th, 
        .educational-content .data-table td {
            border: 1px solid var(--border-color);
            padding: 10px 12px;
            text-align: left;
        }
        .educational-content .data-table th {
            background-color: var(--bg-color);
            font-weight: 600;
            color: var(--heading-color);
        }
        .educational-content .data-table tr:nth-child(even) {
            background-color: var(--bg-color);
        }


        /* NEW FOOTER */
        footer {
            background: var(--gradient-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 40px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 24px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
        }
        .footer-col p {
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col ul li {
            margin-bottom: 10px;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: all 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent-color);
            transform: translateX(3px);
        }
        .footer-disclaimer {
            text-align: center;
            margin: 30px auto;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        .creator-name {
            color: var(--secondary-color);
            font-weight: bold;
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            text-decoration: none;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        /* END NEW FOOTER */

        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
            .calculate-btn, .reset-btn { width: 100%; }
            .footer-content { flex-direction: column; }
        }
    </style>
</head>
<body>

    <!-- NEW HEADER -->
    <header class="header">
        <nav class="navbar">
            <a href="/" class="logo-container">
                <span class="logo-text">Design Calculators</span>
            </a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href='/articles'>Articles</a></li>
                <li><a href='/indexmech'>Mechanical</a></li>
                <li><a href='/indexele'>Electrical</a></li>
                <li><a href='/indexinst'>Instrumentation</a></li>
            </ul>
            <div class="theme-toggle">
                <i class="fas fa-sun icon"></i>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider"></span>
                </label>
                <i class="fas fa-moon icon"></i>
            </div>
        </nav>
    </header>
    <!-- END NEW HEADER -->

    <main class="container">
        <!-- Main Calculator Tool -->
        <div class="tool-container">
            <h2><i class="fas fa-thermometer-half"></i> Industrial Pipe Heat Loss Calculator</h2>
            <div class="tool-description">
                <p>This calculator determines the steady-state heat loss from both uninsulated and insulated pipes. It is an essential tool for energy efficiency audits, insulation design, process control, and personnel safety analysis in industrial and domestic applications.</p>
                <p>The calculation is based on fundamental heat transfer principles and uses an <strong>iterative approach to accurately solve for the outer surface temperature</strong>, which is critical for correctly determining convective and radiative heat losses.</p>
                <ul>
                    <li><strong>Uninsulated Pipe:</strong> Calculates heat loss directly from the pipe's outer surface to the ambient environment.</li>
                    <li><strong>Insulated Pipe:</strong> Accounts for the thermal resistance of the insulation layer, calculating the heat loss from the insulation's outer surface.</li>
                </ul>
                <p><strong>Note:</strong> This calculator provides estimations based on established correlations. For safety-critical or high-cost applications, always verify with detailed engineering analysis and consult standards like <strong>ISO 12241</strong> or <strong>ASHRAE</strong>.</p>
            </div>
            
            <div class="calculator-form">
                <form id="heat-loss-form" onsubmit="return false;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pipe-type">Pipe Type
                                <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select whether the pipe is uninsulated or has an insulation layer.</span></span>
                            </label>
                            <select id="pipe-type" required>
                                <option value="uninsulated">Uninsulated</option>
                                <option value="insulated" selected>Insulated</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="unit-system">Unit System
                                <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select Metric (e.g., mm, m, °C, W/mK) or Imperial (e.g., inch, ft, °F, BTU/h·ft·°F) units.</span></span>
                            </label>
                            <select id="unit-system" required>
                                <option value="metric">Metric (\(\text{mm}\), \(\text{m}\), \(\text{°C}\), \(\text{W/m·K}\))</option>
                                <option value="imperial">Imperial (\(\text{inch}\), \(\text{ft}\), \(\text{°F}\), \(\text{BTU/h·ft·°F}\))</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="pipe-outer-diameter">Pipe Outer Diameter <span class="diameter-unit-label">(\(\text{mm}\))</span>
                                <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the outer diameter of the bare pipe (before insulation).</span></span>
                            </label>
                            <input type="number" id="pipe-outer-diameter" step="0.1" value="114.3" min="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="pipe-length">Pipe Length <span class="length-unit-label">(\(\text{m}\))</span>
                                <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the total length of the pipe section.</span></span>
                            </label>
                            <input type="number" id="pipe-length" step="0.1" value="10" min="0.1" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fluid-temperature">Fluid Temperature <span class="temp-unit-label">(\(\text{°C}\))</span>
                                <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the bulk temperature of the fluid inside the pipe. This is assumed to be the internal pipe wall temperature for this calculation.</span></span>
                            </label>
                            <input type="number" id="fluid-temperature" step="0.1" value="150" required>
                        </div>
                        <div class="form-group">
                            <label for="ambient-temperature">Ambient Temperature <span class="temp-unit-label">(\(\text{°C}\))</span>
                                <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the temperature of the surrounding still air.</span></span>
                            </label>
                            <input type="number" id="ambient-temperature" step="0.1" value="25" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="surface-emissivity">Surface Emissivity (\(\epsilon\))
                                <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Emissivity of the *outermost* surface (pipe or insulation cladding). 0.95 for painted surfaces, 0.2 for new aluminum, 0.05 for polished metal.</span></span>
                            </label>
                            <input type="number" id="surface-emissivity" step="0.01" value="0.9" min="0" max="1" required>
                        </div>
                         <div class="form-group">
                            <label for="air-velocity">Air Velocity <span class="velocity-unit-label">(\(\text{m/s}\))</span>
                                <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Velocity of air moving *around* the pipe. Use 0 for still (natural convection) or a value for forced convection (wind).</span></span>
                            </label>
                            <input type="number" id="air-velocity" step="0.01" value="0.0" min="0" required>
                        </div>
                    </div>

                    <div id="insulated-options" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="insulation-thickness">Insulation Thickness <span class="thickness-unit-label">(\(\text{mm}\))</span>
                                    <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the thickness of the insulation layer.</span></span>
                                </label>
                                <input type="number" id="insulation-thickness" step="0.1" value="50" min="0.1">
                            </div>
                            <div class="form-group">
                                <label for="insulation-conductivity">Insulation Thermal Conductivity <span class="conductivity-unit-label">(\(\text{W/m·K}\))</span>
                                    <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Thermal conductivity (k-value) of the insulation material at its mean temperature. (e.g., Mineral Wool: 0.04)</span></span>
                                </label>
                                <input type="number" id="insulation-conductivity" step="0.001" value="0.04" min="0.001">
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" id="calculate-heat-loss-btn" class="calculate-btn">
                            <i class="fas fa-calculator"></i> Calculate Heat Loss
                        </button>
                        <button type="button" id="reset-btn" class="reset-btn">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3><i class="fas fa-chart-line"></i> Heat Loss Calculation Results</h3>
                <div id="calculation-details"></div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body"></tbody>
                </table>
                <div class="standard-reference" id="standard-reference"></div>
            </div>
        </div>

        <!-- NEW Educational Content -->
        <div class="tool-container educational-content">
            <h2><i class="fas fa-book-open"></i> Industrial Guide to Pipe Heat Loss Analysis</h2>

            <p>Understanding heat loss from pipes is a cornerstone of industrial energy management, process engineering, and safety. This guide explores the fundamental principles behind the calculations, the parameters involved, and the critical real-world implications.</p>

            <h3>1. The Three Modes of Heat Transfer</h3>
            <p>Heat loss from a hot pipe to its cooler surroundings occurs through three distinct mechanisms, all of which happen simultaneously from the outer surface:</p>
            <ul>
                <li><strong>Conduction:</strong> Heat transfer through a solid material. In a pipe, heat conducts from the hot inner fluid, through the solid pipe wall, and then through the solid insulation layer (if present).</li>
                <li><strong>Convection:</strong> Heat transfer through the movement of a fluid (a liquid or gas). Heat is transferred from the pipe's *outer surface* to the surrounding *air* as the air gets warmed, becomes less dense, and rises (natural convection). If wind is present, this is forced convection, which removes heat much faster.</li>
                <li><strong>Radiation:</strong> Heat transfer via electromagnetic waves (infrared). The hot outer surface of the pipe or insulation radiates heat energy directly to cooler objects in its line of sight (like walls, ceilings, or the sky), even if the air between them is cold.</li>
            </ul>

            <h3>2. The Thermal Resistance Network</h3>
            <p>The most accurate way to model heat loss is to treat each heat transfer step as a "thermal resistance" (R-value), similar to resistors in an electrical circuit. Heat flow (Q) is like current, and the temperature difference ($\Delta T$) is like voltage, following the formula: $\Delta T = Q \times R_{total}$</pre>
            
            <p>For an <strong>insulated pipe</strong>, the total resistance is the sum of all resistances in series:</p>
            <p class="formula-box">$$ R_{total} = R_{internal} + R_{pipe} + R_{insulation} + R_{external} $$</p>
            <ul>
                <li><strong>$R_{internal}$ (Internal Convection):</strong> Resistance from the bulk fluid to the inner pipe wall. This depends on the fluid type, velocity (Reynolds number), and pipe diameter.
                    <div class="formula-box">$$ R_{internal} = \frac{1}{h_i \cdot A_i} = \frac{1}{h_i \cdot \pi D_i L} $$</div>
                </li>
                <li><strong>$R_{pipe}$ (Pipe Conduction):</strong> Resistance as heat conducts through the solid pipe wall. For cylinders, the formula is:
                    <div class="formula-box">$$ R_{pipe} = \frac{\ln(D_o / D_i)}{2 \pi k_{pipe} L} $$</div>
                </li>
                <li><strong>$R_{insulation}$ (Insulation Conduction):</strong> Resistance as heat conducts through the insulation layer.
                    <div class="formula-box">$$ R_{insulation} = \frac{\ln(D_{ins} / D_o)}{2 \pi k_{ins} L} $$</div>
                </li>
                <li><strong>$R_{external}$ (External Convection & Radiation):</strong> This is the most complex resistance. It's the *parallel* combination of resistance from convection ($R_{conv,ext}$) and radiation ($R_{rad,ext}$) from the outer surface.
                    <div class="formula-box">$$ R_{external} = \frac{1}{\frac{1}{R_{conv,ext}} + \frac{1}{R_{rad,ext}}} = \frac{1}{(h_c + h_r) \cdot A_{ins}} $$</div>
                </li>
            </ul>
            <p>This calculator makes a standard engineering assumption to simplify the process: <strong>The internal convection coefficient ($h_i$) is assumed to be very high, and the pipe wall conduction resistance ($k_{pipe}$) is assumed to be very low.</strong> This means $R_{internal}$ and $R_{pipe}$ are negligible, allowing us to assume the <strong>pipe outer surface temperature is equal to the fluid temperature.</strong> This is a very common and valid simplification for many industrial scenarios, especially with liquids or high-velocity gases.</p>

            <h3>3. Key Parameters Explained</h3>
            
            <h4>Thermal Conductivity (k-value)</h4>
            <p><strong>What it is:</strong> A material's innate ability to conduct heat. A low k-value means the material is a good insulator, and a high k-value means it's a good conductor.
            <br><strong>Units:</strong> $\text{W/m·K}$ (Metric) or $\text{BTU·in/h·ft²·°F}$ (Imperial - note the 'inch' in the numerator!).
            <p>This calculator uses $\text{W/m·K}$ or $\text{BTU/h·ft·°F}$. Be careful with unit conversions!</p>
            <table class="data-table">
                <thead><tr><th>Material</th><th>Typical k-value ($\text{W/m·K}$) at 100°C</th></tr></thead>
                <tbody>
                    <tr><td>Mineral Wool</td><td>0.040 - 0.055</td></tr>
                    <tr><td>Calcium Silicate</td><td>0.060 - 0.070</td></tr>
                    <tr><td>Foamglass</td><td>0.050 - 0.060</td></tr>
                    <tr><td>Carbon Steel</td><td>~50 (1000x higher than insulation!)</td></tr>
                    <tr><td>Stainless Steel</td><td>~16 (300x higher than insulation!)</td></tr>
                </tbody>
            </table>

            <h4>Heat Transfer Coefficient (h-value)</h4>
            <p><strong>What it is:</strong> A measure of how effectively heat is transferred *between a surface and a fluid* (like the pipe surface and the ambient air). It combines convection and radiation and is *not* a material property. It depends on surface temperature, ambient temperature, air velocity, surface shape, and more.
            <br><strong>Units:</strong> $\text{W/m²·K}$ (Metric) or $\text{BTU/h·ft²·°F}$ (Imperial).
            </p>
            <ul>
                <li><strong>$h_c$ (Convection Coefficient):</strong> This is calculated using dimensionless numbers like the Reynolds (Re), Prandtl (Pr), and Grashof (Gr) numbers, which are fed into correlations (like Churchill-Chu for natural convection) to find the Nusselt number (Nu). The h-value is then found by: $h_c = (Nu \cdot k_{air}) / D$. This is what the calculator does iteratively.</li>
                <li><strong>$h_r$ (Radiation Coefficient):</strong> This linearizes the complex Stefan-Boltzmann radiation equation ($Q = \epsilon \sigma (T_s^4 - T_{amb}^4)$) into a form that can be added to $h_c$.</li>
            </ul>

            <h4>Surface Emissivity ($\epsilon$)</h4>
            <p><strong>What it is:</strong> A material's effectiveness in emitting energy as thermal radiation. It's a value between 0 (a perfect mirror, no radiation) and 1 (a perfect "black body"). This value is *critical* for radiation loss, which can account for over 50% of the total heat loss in still air.
            <br><strong>Note:</strong> A shiny, new pipe has low emissivity, but as it gets dirty or corrodes, its emissivity approaches 0.9 or higher. Insulation is often covered with a metal or plastic jacket, and the emissivity of *that jacket* is what must be used.</p>
            <table class="data-table">
                <thead><tr><th>Surface Material</th><th>Typical Emissivity ($\epsilon$)</th></tr></thead>
                <tbody>
                    <tr><td>Polished Aluminum</td><td>0.04 - 0.06</td></tr>
                    <tr><td>Rolled/Sheet Aluminum</td><td>0.20 - 0.30</td></tr>
                    <tr><td>Oxidized Steel</td><td>0.70 - 0.90</td></tr>
                    <tr><td>Most Paints (any color) & Plastics</td><td>0.85 - 0.95</td></tr>
                    <tr><td>Brick or Concrete</td><td>0.93</td></tr>
                </tbody>
            </table>

            <h3>4. Critical Industrial Implications</h3>
            
            <h4>A. Energy Costs & Environmental Impact</h4>
            <p>This is the most direct financial driver. Heat loss is wasted energy, which means wasted fuel and money.
            <br><strong>Example Calculation:</strong>
            <ul>
                <li>Calculated Heat Loss: <strong>150 W/m</strong></li>
                <li>Pipe Length: <strong>50 m</strong></li>
                <li>Total Heat Loss (Q): $150 \text{ W/m} \times 50 \text{ m} = 7500 \text{ W} = 7.5 \text{ kW}$</li>
                <li>Boiler Efficiency: <strong>85%</strong> (You must burn *more* fuel to make up for loss)</li>
                <li>Fuel Requirement: $7.5 \text{ kW} / 0.85 = 8.82 \text{ kW}$</li>
                <li>Operating Hours: <strong>8000 hours/year</strong></li>
                <li>Total Energy Wasted: $8.82 \text{ kW} \times 8000 \text{ h} = 70,560 \text{ kWh/year}$</li>
                <li>Energy Cost: <strong>$0.10 / kWh</strong></li>
                <li><strong>Annual Cost of Heat Loss: $70,560 \times \$0.10 = \$7,056 \text{ per year}$</strong></li>
            </ul>
            <p>This single calculation justifies the cost of insulation, which often has a payback period of less than a year.</p>

            <h4>B. Process Control & Stability</h4>
            <p>Many chemical processes are highly sensitive to temperature.
            <ul>
                <li><strong>Viscosity Control:</strong> Fuel oils, tars, or food products (like chocolate) must be kept above a certain temperature to flow. Excessive heat loss can cause a line to clog.</li>
                <li><strong>Reaction Kinetics:</strong> Chemical reactions may slow down or fail if the reactant temperature drops too low.</li>
                <li><strong>Phase Change Prevention:</strong> Preventing steam from condensing back into water before it reaches its destination (e.g., a steam turbine) is critical.</li>
            </ul>
            
            <h4>C. Personnel Safety & Burn Protection</h4>
            <p>Uninsulated hot surfaces pose a significant burn hazard. The *outer surface temperature* is the critical value for safety.
            <br><strong>ASTM C1055 ("Standard Guide for Heated System Surface Conditions that Produce Contact Burn Injuries")</strong> provides industry-standard limits. For a metallic surface, a 1-second contact that causes a first-degree burn can happen at temperatures as low as <strong>60°C (140°F)</strong>.
            <br>Insulation is required not just for energy savings, but to reduce the outer surface temperature to a safe-touch level, typically below 60°C.</p>
            
            <h4>D. Condensation Control</h4>
            <p>For *cold* pipes (e.g., chilled water, refrigeration), the goal is the opposite: prevent heat *gain* and stop condensation. If the pipe's outer surface temperature drops below the **dew point** of the ambient air, water will condense on it. This leads to:
            <ul>
                <li>Corrosion Under Insulation (CUI), a massive and costly industrial problem.</li>
                <li>Water dripping, creating slip hazards or damaging equipment below.</li>
                <li>Degradation of the insulation itself (wet insulation doesn't insulate).</li>
            </ul>
            <p>The calculation is the same, but in reverse (heat flows *in*). The goal is to add enough insulation to keep the *outer surface temperature* of the insulation *above* the ambient air's dew point.</p>
        </div>

    </main>

    <!-- NEW FOOTER -->
    <footer>
        <div class="footer-content">
            <div class="footer-col">
                <h4>Design Calculators</h4>
                <p>The world's first comprehensive engineering calculator hub based on IEC, IEEE, ISA, ASME, and API standards.</p>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin"><i class="fab fa-linkedin-in"></i></a>
                    <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube"><i class="fab fa-youtube"></i></a>
                    <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
            <div class="footer-col">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href='/indexele'>Electrical</a></li>
                    <li><a href='/indexmech'>Mechanical</a></li>
                    <li><a href='/indexinst'>Instrumentation</a></li>
                    <li><a href='/articles'>Articles</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Resources</h4>
                <ul>
                    <li><a href='/about'>About Us</a></li>
                    <li><a href='/contact'>Contact</a></li>
                    <li><a href='/faq'>FAQ</a></li>
                    <li><a href='/privacy-policy'>Privacy Policy</a></li>
                    <li><a href='/terms-of-service'>Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>More</h4>
                <ul>
                    <li><a href="/blog.html">Blog</a></li>
                    <li><a href='/sitemap2'>Sitemap</a></li>
                    <li><a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer">YouTube Channel</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-disclaimer">
            <p>All calculations are based on fundamental heat transfer principles and correlations (e.g., Churchill-Chu for natural convection) as outlined in standards like <strong>ISO 12241</strong> and standard engineering texts (e.g., Incropera, DeWitt). Results are for estimation and engineering design. Always verify calculations and assumptions for safety-critical or financially significant applications.</p>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Design Calculators. Created by <span class="creator-name">A Sharma</span>. All rights reserved.</p>
        </div>
    </footer>
    <!-- END NEW FOOTER -->

    <!-- Message Box -->
    <div id="custom-message-box"></div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Element References ---
        const pipeTypeSelect = document.getElementById('pipe-type');
        const unitSystemSelect = document.getElementById('unit-system');
        const insulatedOptionsDiv = document.getElementById('insulated-options');
        const insulationThicknessInput = document.getElementById('insulation-thickness');
        const insulationConductivityInput = document.getElementById('insulation-conductivity');
        const calculateBtn = document.getElementById('calculate-heat-loss-btn');
        const resetBtn = document.getElementById('reset-btn');
        const resultContainer = document.getElementById('result-container');
        const resultTableBody = document.getElementById('result-table-body');
        const calculationDetailsDiv = document.getElementById('calculation-details');
        const standardReference = document.getElementById('standard-reference');
        const themeSwitch = document.getElementById('theme-switch');

        // Input Fields
        const pipeOuterDiameterInput = document.getElementById('pipe-outer-diameter');
        const pipeLengthInput = document.getElementById('pipe-length');
        const fluidTemperatureInput = document.getElementById('fluid-temperature');
        const ambientTemperatureInput = document.getElementById('ambient-temperature');
        const surfaceEmissivityInput = document.getElementById('surface-emissivity');
        const airVelocityInput = document.getElementById('air-velocity');

        // Unit Labels
        const diameterUnitLabels = document.querySelectorAll('.diameter-unit-label');
        const lengthUnitLabels = document.querySelectorAll('.length-unit-label');
        const tempUnitLabels = document.querySelectorAll('.temp-unit-label');
        const thicknessUnitLabels = document.querySelectorAll('.thickness-unit-label');
        const conductivityUnitLabels = document.querySelectorAll('.conductivity-unit-label');
        const velocityUnitLabels = document.querySelectorAll('.velocity-unit-label');

        // --- Constants ---
        const STEFAN_BOLTZMANN = 5.670374e-8; // W/(m^2·K^4)
        
        // --- Helper Functions ---
        
        /**
         * Displays a custom message box at the top of the screen.
         * @param {string} message - The message to display.
         * @param {string} [type="info"] - "info", "warning", or "error".
         */
        function displayMessage(message, type = "info") {
            const messageBox = document.getElementById('custom-message-box');
            messageBox.textContent = message;
            
            if (type === "error") {
                messageBox.style.backgroundColor = 'var(--danger-color)';
            } else if (type === "warning") {
                messageBox.style.backgroundColor = 'var(--accent-color)';
                messageBox.style.color = '#333'; // Dark text on yellow
            } else { // info
                messageBox.style.backgroundColor = 'var(--success-color)';
                messageBox.style.color = 'white';
            }
            
            messageBox.classList.add('show');
            setTimeout(() => {
                messageBox.classList.remove('show');
                // Reset color after fade out
                setTimeout(() => { messageBox.style.color = 'white'; }, 400);
            }, 5000);
        }

        /**
         * Updates UI labels based on unit system and toggles insulation options.
         */
        function updateUI() {
            const pipeType = pipeTypeSelect.value;
            const unitSystem = unitSystemSelect.value;

            // Update unit labels
            if (unitSystem === 'imperial') {
                diameterUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{inch}\\))');
                lengthUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{ft}\\))');
                tempUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{°F}\\))');
                thicknessUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{inch}\\))');
                conductivityUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{BTU/h·ft·°F}\\))');
                velocityUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{ft/s}\\))');
            } else { // Metric
                diameterUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{mm}\\))');
                lengthUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{m}\\))');
                tempUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{°C}\\))');
                thicknessUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{mm}\\))');
                conductivityUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{W/m·K}\\))');
                velocityUnitLabels.forEach(label => label.innerHTML = '(\\(\\text{m/s}\\))');
            }

            // Show/hide insulation options
            if (pipeType === 'insulated') {
                insulatedOptionsDiv.style.display = 'block';
                insulationThicknessInput.required = true;
                insulationConductivityInput.required = true;
            } else {
                insulatedOptionsDiv.style.display = 'none';
                insulationThicknessInput.required = false;
                insulationConductivityInput.required = false;
            }

            // Re-render MathJax for the labels
            if (window.MathJax) {
                window.MathJax.typesetPromise([
                    ...diameterUnitLabels, ...lengthUnitLabels, ...tempUnitLabels,
                    ...thicknessUnitLabels, ...conductivityUnitLabels, ...velocityUnitLabels
                ]);
            }
        }

        /**
         * Resets the form and hides the result container.
         */
        function resetCalculator() {
            document.getElementById('heat-loss-form').reset();
            resultContainer.classList.remove('show');
            setTimeout(() => { resultContainer.style.display = 'none'; }, 600); // Hide after animation
            updateUI();
            displayMessage('Calculator fields have been reset.', 'info');
        }
        
        // --- Air Properties Functions (at film temperature) ---
        // Properties of air at 1 atm, from Incropera & DeWitt
        // Returns [k (W/m·K), nu (m^2/s), Pr]
        function getAirProperties(T_film_K) {
            // Simple linear interpolation from table data
            const temps = [250, 300, 350, 400]; // K
            const k_vals = [0.0223, 0.0263, 0.0300, 0.0338]; // W/m·K
            const nu_vals = [11.44e-6, 15.89e-6, 20.92e-6, 26.41e-6]; // m^2/s
            const Pr_vals = [0.720, 0.707, 0.700, 0.690];
            
            const interpolate = (x, x_arr, y_arr) => {
                if (x <= x_arr[0]) return y_arr[0];
                if (x >= x_arr[x_arr.length - 1]) return y_arr[x_arr.length - 1];
                for (let i = 0; i < x_arr.length - 1; i++) {
                    if (x >= x_arr[i] && x <= x_arr[i+1]) {
                        return y_arr[i] + (y_arr[i+1] - y_arr[i]) * (x - x_arr[i]) / (x_arr[i+1] - x_arr[i]);
                    }
                }
                return y_arr[x_arr.length - 1]; // Fallback
            };

            return [
                interpolate(T_film_K, temps, k_vals),
                interpolate(T_film_K, temps, nu_vals),
                interpolate(T_film_K, temps, Pr_vals)
            ];
        }

        // --- Heat Transfer Coefficient Calculation (h_c + h_r) ---
        
        /**
         * Calculates the total external heat transfer coefficient (h_c + h_r).
         * @param {number} T_s_K - Outer Surface Temperature (Kelvin)
         * @param {number} T_amb_K - Ambient Temperature (Kelvin)
         * @param {number} D_s_m - Outer Surface Diameter (meters)
         * @param {number} v_air_m_s - Air Velocity (m/s)
         * @param {number} epsilon - Surface Emissivity
         * @returns {object} { h_c, h_r, h_total, Re, Gr, Nu, k_air, Pr }
         */
        function calculateExternalHTCoefficients(T_s_K, T_amb_K, D_s_m, v_air_m_s, epsilon) {
            // 1. Calculate Film Temperature
            const T_film_K = (T_s_K + T_amb_K) / 2.0;
            
            // 2. Get Air Properties at Film Temperature
            const [k_air, nu_air, Pr] = getAirProperties(T_film_K);
            
            let h_c, Re = 0, Gr = 0, Nu;
            
            // 3. Calculate Convection Coefficient (h_c)
            if (v_air_m_s < 0.1) {
                // --- Natural Convection (Still Air) ---
                // Using Churchill and Chu correlation for horizontal cylinder
                const g = 9.81; // m/s^2
                const beta = 1.0 / T_film_K; // Volumetric expansion coeff for ideal gas
                
                Gr = (g * beta * Math.abs(T_s_K - T_amb_K) * Math.pow(D_s_m, 3)) / Math.pow(nu_air, 2);
                const Ra = Gr * Pr; // Rayleigh number
                
                const Nu_term = 0.387 * Math.pow(Ra, 1/6) / Math.pow(1 + Math.pow(0.559 / Pr, 9/16), 8/27);
                Nu = Math.pow(0.60 + Nu_term, 2);
                
                h_c = (Nu * k_air) / D_s_m;
                
            } else {
                // --- Forced Convection ---
                Re = (v_air_m_s * D_s_m) / nu_air;
                
                // Using Churchill and Bernstein correlation for forced convection over a cylinder
                const Nu_term1 = 0.62 * Math.pow(Re, 0.5) * Math.pow(Pr, 1/3);
                const Nu_term2 = Math.pow(1 + Math.pow(0.4 / Pr, 2/3), 1/4);
                const Nu_term3 = Math.pow(1 + Math.pow(Re / 282000, 5/8), 4/5);
                Nu = 0.3 + (Nu_term1 / Nu_term2) * Nu_term3;
                
                h_c = (Nu * k_air) / D_s_m;
            }
            
            // 4. Calculate Radiation Coefficient (h_r)
            // Linearized radiation coefficient
            const h_r = epsilon * STEFAN_BOLTZMANN * (Math.pow(T_s_K, 2) + Math.pow(T_amb_K, 2)) * (T_s_K + T_amb_K);
            
            // 5. Total Coefficient
            const h_total = h_c + h_r;
            
            return { h_c, h_r, h_total, Re, Gr, Nu, k_air, Pr };
        }
        
        // --- Main Calculation Logic ---
        function performCalculation() {
            try {
                // --- 1. Get and Validate Inputs ---
                const pipeType = pipeTypeSelect.value;
                const unitSystem = unitSystemSelect.value;
                
                const D_outer_in = parseFloat(pipeOuterDiameterInput.value);
                const L_in = parseFloat(pipeLengthInput.value);
                const T_fluid_in = parseFloat(fluidTemperatureInput.value);
                const T_ambient_in = parseFloat(ambientTemperatureInput.value);
                const epsilon = parseFloat(surfaceEmissivityInput.value);
                const v_air_in = parseFloat(airVelocityInput.value);
                
                let t_ins_in = 0, k_ins_in = 0;
                if (pipeType === 'insulated') {
                    t_ins_in = parseFloat(insulationThicknessInput.value);
                    k_ins_in = parseFloat(insulationConductivityInput.value);
                }
                
                // Check for valid numbers
                let inputs = [D_outer_in, L_in, T_fluid_in, T_ambient_in, epsilon, v_air_in];
                if (pipeType === 'insulated') {
                    inputs.push(t_ins_in, k_ins_in);
                }
                if (inputs.some(val => isNaN(val))) {
                    displayMessage('Please enter valid numbers in all fields.', 'error');
                    return;
                }
                if (epsilon < 0 || epsilon > 1) {
                    displayMessage('Emissivity must be between 0 and 1.', 'error');
                    return;
                }
                if (T_fluid_in <= T_ambient_in) {
                    displayMessage('Fluid temperature must be greater than ambient temperature for heat loss.', 'error');
                    return;
                }
                
                // --- 2. Convert to SI Units ---
                let D_outer_m, L_m, T_fluid_K, T_ambient_K, v_air_m_s, t_ins_m, k_ins_si;
                let units = {
                    dia: 'mm', len: 'm', temp: '°C', thk: 'mm', k: 'W/m·K', v: 'm/s', h: 'W/m²·K', q: 'W', flux: 'W/m²'
                };

                if (unitSystem === 'imperial') {
                    D_outer_m = D_outer_in * 0.0254; // inch to m
                    L_m = L_in * 0.3048; // ft to m
                    T_fluid_K = (T_fluid_in - 32) * 5/9 + 273.15; // °F to K
                    T_ambient_K = (T_ambient_in - 32) * 5/9 + 273.15; // °F to K
                    v_air_m_s = v_air_in * 0.3048; // ft/s to m/s
                    t_ins_m = t_ins_in * 0.0254; // inch to m
                    k_ins_si = k_ins_in * 1.730735; // BTU/h·ft·°F to W/m·K
                    
                    units = {
                        dia: 'in', len: 'ft', temp: '°F', thk: 'in', k: 'BTU/h·ft·°F', v: 'ft/s', h: 'BTU/h·ft²·°F', q: 'BTU/h', flux: 'BTU/h·ft²'
                    };
                } else { // Metric
                    D_outer_m = D_outer_in / 1000.0; // mm to m
                    L_m = L_in; // m
                    T_fluid_K = T_fluid_in + 273.15; // °C to K
                    T_ambient_K = T_ambient_in + 273.15; // °C to K
                    v_air_m_s = v_air_in; // m/s
                    t_ins_m = t_ins_in / 1000.0; // mm to m
                    k_ins_si = k_ins_in; // W/m·K
                }

                // --- 3. Iterative Calculation for Surface Temperature ---
                
                // Standard Assumption: Internal film coefficient (fluid-to-pipe) is high.
                // We use a common placeholder value. This assumption is critical.
                const h_internal_conv = 100.0; // W/m^2·K (Typical for turbulent water)
                
                let D_s_m; // The final outer diameter (pipe or insulation)
                let R_internal_per_m = 1.0 / (h_internal_conv * Math.PI * D_outer_m); // Resistance from fluid to pipe OD (per meter)
                let R_insulation_per_m = 0;
                
                if (pipeType === 'insulated') {
                    D_s_m = D_outer_m + 2 * t_ins_m;
                    R_insulation_per_m = Math.log(D_s_m / D_outer_m) / (2 * Math.PI * k_ins_si);
                } else {
                    D_s_m = D_outer_m;
                }
                
                const R_conduction_total_per_m = R_internal_per_m + R_insulation_per_m;

                // Bisection method to find T_s_K
                let T_low_K = T_ambient_K;
                let T_high_K = T_fluid_K;
                let T_s_K_guess = (T_low_K + T_high_K) / 2.0;
                let Q_in_per_m, Q_out_per_m, htc_results;
                
                const MAX_ITERATIONS = 100;
                const CONVERGENCE_CRITERIA = 0.01; // Watts
                
                let iter = 0;
                let error = Infinity;
                
                while (Math.abs(error) > CONVERGENCE_CRITERIA && iter < MAX_ITERATIONS) {
                    // Calculate Q_out (Heat from surface to ambient)
                    htc_results = calculateExternalHTCoefficients(T_s_K_guess, T_ambient_K, D_s_m, v_air_m_s, epsilon);
                    Q_out_per_m = htc_results.h_total * (Math.PI * D_s_m) * (T_s_K_guess - T_ambient_K);
                    
                    // Calculate Q_in (Heat from fluid to surface)
                    Q_in_per_m = (T_fluid_K - T_s_K_guess) / (R_conduction_total_per_m + (1.0 / (htc_results.h_total * Math.PI * D_s_m)));
                    // The above is wrong for iteration. We need to balance at the T_s_K node.
                    
                    // Q_in (from fluid to outer surface)
                    Q_in_per_m = (T_fluid_K - T_s_K_guess) / R_conduction_total_per_m;
                    
                    // Error is the difference
                    error = Q_in_per_m - Q_out_per_m;
                    
                    if (error > 0) { // Q_in > Q_out, T_s_K is too low
                        T_low_K = T_s_K_guess;
                    } else { // Q_in < Q_out, T_s_K is too high
                        T_high_K = T_s_K_guess;
                    }
                    T_s_K_guess = (T_low_K + T_high_K) / 2.0;
                    iter++;
                }
                
                if (iter === MAX_ITERATIONS) {
                    displayMessage('Calculation converged with maximum iterations. Results are approximate.', 'warning');
                }
                
                const T_s_K_final = T_s_K_guess;
                
                // --- 4. Final Calculations ---
                htc_results = calculateExternalHTCoefficients(T_s_K_final, T_ambient_K, D_s_m, v_air_m_s, epsilon);
                const Q_per_m_final = htc_results.h_total * (Math.PI * D_s_m) * (T_s_K_final - T_ambient_K);
                const Q_total_W = Q_per_m_final * L_m;
                const Q_flux_W_m2 = Q_total_W / (Math.PI * D_s_m * L_m);
                
                // Calculate intermediate temperature (pipe-insulation interface)
                let T_pipe_ins_K = T_s_K_final; // For uninsulated, it's the same
                if (pipeType === 'insulated') {
                    // T_pipe_ins = T_fluid - Q * R_internal
                    T_pipe_ins_K = T_fluid_K - (Q_per_m_final * R_internal_per_m);
                }
                
                // --- 5. Convert Results for Display ---
                let Q_display, T_s_display, T_pipe_ins_display, Q_flux_display, h_c_display, h_r_display, h_total_display;
                let T_fluid_display = T_fluid_in;
                let T_ambient_display = T_ambient_in;
                
                if (unitSystem === 'imperial') {
                    Q_display = Q_total_W * 3.41214; // W to BTU/h
                    T_s_display = (T_s_K_final - 273.15) * 9/5 + 32; // K to °F
                    T_pipe_ins_display = (T_pipe_ins_K - 273.15) * 9/5 + 32; // K to °F
                    Q_flux_display = Q_flux_W_m2 * 0.316998; // W/m^2 to BTU/h·ft^2
                    h_c_display = htc_results.h_c * 0.17611; // W/m²·K to BTU/h·ft²·°F
                    h_r_display = htc_results.h_r * 0.17611;
                    h_total_display = htc_results.h_total * 0.17611;
                } else {
                    Q_display = Q_total_W; // W
                    T_s_display = T_s_K_final - 273.15; // K to °C
                    T_pipe_ins_display = T_pipe_ins_K - 273.15; // K to °C
                    Q_flux_display = Q_flux_W_m2; // W/m^2
                    h_c_display = htc_results.h_c;
                    h_r_display = htc_results.h_r;
                    h_total_display = htc_results.h_total;
                }
                
                // --- 6. Populate Calculation Details ---
                let detailsHtml = `<h4>Detailed Calculation Steps:</h4>`;
                detailsHtml += `<p><strong>1. Assumptions:</strong></p>
                    <ul>
                        <li>Internal fluid film coefficient ($h_{internal}$) assumed to be <strong>${h_internal_conv} W/m²·K</strong>.</li>
                        <li>Conduction resistance of the pipe wall itself is assumed to be negligible.</li>
                        <li>Heat transfer is in steady-state.</li>
                    </ul>`;
                
                detailsHtml += `<p><strong>2. Iterative Surface Temperature Solution:</strong></p>
                    <p>The calculation iteratively finds the outer surface temperature ($T_s$) where the heat flowing *to* the surface equals the heat flowing *away* from it ($Q_{in} = Q_{out}$).</p>`;
                if (pipeType === 'insulated') {
                    detailsHtml += `<p class="calculation-step">Insulation Outer Diameter ($D_{ins}$) = ${D_s_m.toFixed(4)} m</p>`;
                    detailsHtml += `<p class="formula-box">$$ Q_{in} = \\frac{T_{fluid} - T_s}{R_{internal} + R_{insulation}} \\quad | \\quad Q_{out} = (h_c + h_r) A_s (T_s - T_{amb}) $$</p>`;
                } else {
                    detailsHtml += `<p class="formula-box">$$ Q_{in} = \\frac{T_{fluid} - T_s}{R_{internal}} \\quad | \\quad Q_{out} = (h_c + h_r) A_s (T_s - T_{amb}) $$</p>`;
                }
                detailsHtml += `<p class="calculation-step">Converged Outer Surface Temp ($T_s$) = <strong>${T_s_display.toFixed(2)} ${units.temp}</strong> (${T_s_K_final.toFixed(2)} K)</p>`;
                
                detailsHtml += `<p><strong>3. External Heat Transfer Coefficients (at $T_s$):</strong></p>
                    <p>Based on a film temperature $T_{film}$ = ${( (T_s_K_final + T_ambient_K) / 2.0 ).toFixed(2)} K:</p>
                    <ul>
                        <li>Air Properties: $k_{air}$=${htc_results.k_air.toFixed(4)} W/m·K, $Pr$=${htc_results.Pr.toFixed(3)}</li>
                        ${v_air_m_s < 0.1 ? 
                            `<li>Grashof No. ($Gr$) = ${htc_results.Gr.toExponential(3)} (Natural Convection)</li>` :
                            `<li>Reynolds No. ($Re$) = ${htc_results.Re.toExponential(3)} (Forced Convection)</li>`
                        }
                        <li>Nusselt No. ($Nu$) = ${htc_results.Nu.toFixed(2)}</li>
                    </ul>
                    <p class="calculation-step">Convection Coeff ($h_c$) = <strong>${h_c_display.toFixed(3)} ${units.h}</strong></p>
                    <p class="calculation-step">Radiation Coeff ($h_r$) = <strong>${h_r_display.toFixed(3)} ${units.h}</strong></p>
                    <p class="calculation-step">Total External Coeff ($h_{total}$) = <strong>${h_total_display.toFixed(3)} ${units.h}</strong></p>`;
                    
                detailsHtml += `<p><strong>4. Final Heat Loss Calculation:</strong></p>`;
                if (pipeType === 'insulated') {
                    detailsHtml += `<p class="calculation-step">R_{internal} (per m) = 1 / ($h_i \cdot \pi D_o$) = ${R_internal_per_m.toFixed(4)} m·K/W</p>`;
                    detailsHtml += `<p class="calculation-step">R_{insulation} (per m) = ln($D_{ins} / D_o$) / (2$\pi k_{ins}$) = ${R_insulation_per_m.toFixed(4)} m·K/W</p>`;
                    detailsHtml += `<p class="calculation-step">Pipe-Insulation Interface Temp ($T_{pipe,s}$) = $T_{fluid} - (Q_{per_m} \cdot R_{internal})$ = <strong>${T_pipe_ins_display.toFixed(2)} ${units.temp}</strong></p>`;
                }
                detailsHtml += `<p class="calculation-step">Heat Loss per Meter ($Q/L$) = $h_{total} \cdot \pi D_s \cdot (T_s - T_{amb})$ = ${Q_per_m_final.toFixed(2)} W/m</p>`;
                detailsHtml += `<p class="calculation-step">Total Heat Loss ($Q$) = $Q/L \cdot L$ = <strong>${Q_display.toFixed(2)} ${units.q}</strong></p>`;
                detailsHtml += `<p class="calculation-step">Heat Flux (from surface) = $Q / A_s$ = <strong>${Q_flux_display.toFixed(2)} ${units.flux}</strong></p>`;

                calculationDetailsDiv.innerHTML = detailsHtml;

                // --- 7. Populate Results Table ---
                resultTableBody.innerHTML = ''; // Clear old results
                
                const addResultRow = (param, val) => {
                    const row = resultTableBody.insertRow();
                    row.insertCell().innerHTML = param;
                    row.insertCell().innerHTML = val;
                };

                addResultRow("Pipe Type", pipeType === 'insulated' ? 'Insulated' : 'Uninsulated');
                addResultRow("Fluid Temperature", `${T_fluid_display} ${units.temp}`);
                addResultRow("Ambient Temperature", `${T_ambient_display} ${units.temp}`);
                addResultRow("Pipe Outer Diameter", `${D_outer_in} ${units.dia}`);
                addResultRow("Pipe Length", `${L_in} ${units.len}`);
                
                if (pipeType === 'insulated') {
                    addResultRow("Insulation Thickness", `${t_ins_in} ${units.thk}`);
                    addResultRow("Insulation Conductivity", `${k_ins_in} ${units.k}`);
                    addResultRow("Insulation Outer Diameter", `${(D_s_m * (unitSystem === 'metric' ? 1000 : 39.3701)).toFixed(2)} ${unitSystem === 'metric' ? 'mm' : 'in'}`);
                    addResultRow("Pipe-Insulation Interface Temp", `<strong>${T_pipe_ins_display.toFixed(2)} ${units.temp}</strong>`);
                }
                
                addResultRow("Surface Emissivity", epsilon);
                addResultRow("Air Velocity", `${v_air_in} ${units.v}`);
                addResultRow("Convection Coefficient ($h_c$)", `${h_c_display.toFixed(3)} ${units.h}`);
                addResultRow("Radiation Coefficient ($h_r$)", `${h_r_display.toFixed(3)} ${units.h}`);
                addResultRow("Final Outer Surface Temp ($T_s$)", `<strong>${T_s_display.toFixed(2)} ${units.temp}</strong>`);
                addResultRow("Heat Flux (from surface)", `<strong>${Q_flux_display.toFixed(2)} ${units.flux}</strong>`);
                addResultRow("Total Heat Loss ($Q$)", `<strong>${Q_display.toFixed(2)} ${units.q}</strong>`);

                // --- 8. Show Results ---
                standardReference.innerHTML = "Calculations are based on fundamental heat transfer correlations (e.g., Churchill-Chu, Churchill-Bernstein) as detailed in standards like <strong>ISO 12241</strong> and engineering texts like Incropera & DeWitt. Verify results for safety-critical applications.";
                
                resultContainer.style.display = 'block';
                setTimeout(() => { resultContainer.classList.add('show'); }, 10);
                resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv, resultTableBody]);
                }
                
                displayMessage("Calculation completed successfully!", "info");

            } catch (error) {
                console.error("Calculation Error:", error);
                displayMessage("An unexpected error occurred: " + error.message, "error");
            }
        }

        // --- Event Listeners ---
        pipeTypeSelect.addEventListener('change', updateUI);
        unitSystemSelect.addEventListener('change', updateUI);
        calculateBtn.addEventListener('click', performCalculation);
        resetBtn.addEventListener('click', resetCalculator);

        // Theme Switcher Logic
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeSwitch.checked = true;
        }
        themeSwitch.addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            }
        });

        // --- Initial Run ---
        updateUI(); // Set initial state
    });
    </script>
</body>
</html>
