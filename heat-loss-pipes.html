<!DOCTYPE html>
<html lang="en">
<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
        
    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Pipe Heat Loss & Insulation Calculator - ISO 12241 Standard</title>
    <meta name="description" content="Professional Pipe Heat Loss Calculator per ISO 12241 & ASTM C680. Detailed heat transfer analysis, surface temperature iteration, condensation risk, and economic insulation thickness theory.">
    <meta name="keywords" content="pipe heat loss, insulation calculator, thermal resistance, ISO 12241, ASTM C680, Nusselt number, Churchill-Bernstein, process piping, personnel protection, dew point">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* --- CORE THEME (Blue Industrial) --- */
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #334155;
            --text-light: #64748B;
            --heading: #0F172A;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #E2E8F0;
            --text-light: #94A3B8;
            --heading: #F8FAFC;
            --footer-bg: #020617;
            --border: #334155;
        }

        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: relative;
            z-index: 50;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: -0.5px;
        }
        .logo-subtitle {
            font-size: 0.75rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.95;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 8px 12px;
            border-radius: 6px;
        }
        .nav-links a:hover { 
            background: rgba(255,255,255,0.1);
            color: var(--accent);
        }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); border-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Main Content */
        main { padding: 40px 0; }
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 40px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 40px;
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 35px;
            margin-bottom: 20px;
            font-weight: 700;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
            font-size: 0.95rem;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.25);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.35);
        }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.95rem;
            padding: 12px 24px;
        }
        .btn-outline:hover {
            background: rgba(37, 99, 235, 0.05);
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 20px;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .preset-container {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 0;
        }
        .preset-btn {
            padding: 10px 16px;
            font-size: 0.9rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
            transform: translateY(-1px);
        }

        /* Results Layout */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }
        @media (max-width: 1024px) {
            .results-grid { grid-template-columns: 1fr; }
        }

        .results-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 0;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        .results-table th, .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .results-table th {
            background: var(--bg);
            color: var(--heading);
            font-weight: 700;
            border-bottom: 2px solid var(--border);
        }
        .results-table tr:last-child td { border-bottom: none; }
        .highlight { color: var(--success); font-weight: 700; }
        .danger-text { color: var(--danger); font-weight: 700; }

        /* Calculation Steps Log */
        .step-log-container {
            font-family: 'Courier New', monospace;
            background-color: var(--bg);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            color: var(--text);
        }
        .log-entry { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed var(--border); }
        .log-entry:last-child { border-bottom: none; margin-bottom: 0; }
        .log-title { color: var(--primary); font-weight: 700; margin-bottom: 5px; display: block; font-size: 1rem; }
        .log-eq { background: rgba(0,0,0,0.03); padding: 8px; border-radius: 4px; display: block; margin: 5px 0; }

        /* Canvas & Chart */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            height: 400px;
            width: 100%;
        }

        /* Tooltip */
        .info-icon { color: var(--secondary); margin-left: 6px; cursor: help; opacity: 0.8; transition: opacity 0.2s; }
        .info-icon:hover { opacity: 1; }
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 240px;
            background-color: #1e293b;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 100;
            bottom: 135%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            font-weight: 400;
            line-height: 1.4;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        .vector-input-group {
            background: var(--bg);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid var(--border);
            height: 100%;
        }
        .vector-input-header {
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            border-bottom: 2px solid rgba(37, 99, 235, 0.1);
            padding-bottom: 10px;
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        .message-box.show { display: block; opacity: 1; top: 30px; }
        .hidden { display: none; }

        /* LONG FORM CONTENT STYLES */
        .long-form-content {
            font-family: 'Merriweather', serif; /* Serif for long reading */
            color: var(--text);
            font-size: 1.1rem;
            line-height: 1.9;
        }
        .long-form-content h3 { font-family: 'Montserrat', sans-serif; color: var(--primary); font-size: 1.6rem; margin-top: 50px; }
        .long-form-content h4 { font-family: 'Montserrat', sans-serif; color: var(--heading); font-size: 1.3rem; margin-top: 30px; margin-bottom: 15px; font-weight: 600; }
        .long-form-content p { margin-bottom: 20px; }
        .long-form-content ul, .long-form-content ol { margin-bottom: 25px; padding-left: 25px; }
        .long-form-content li { margin-bottom: 10px; }
        .long-form-content blockquote {
            border-left: 4px solid var(--accent);
            padding-left: 20px;
            margin: 30px 0;
            font-style: italic;
            background: rgba(245, 158, 11, 0.05);
            padding: 20px;
            border-radius: 0 8px 8px 0;
        }
        .equation-box {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 30px 0;
            overflow-x: auto;
        }

        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 60px 0 30px 0;
            margin-top: 80px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 40px;
        }
        .footer-col { flex: 1; min-width: 200px; }
        .footer-col h4 { color: white; margin-bottom: 20px; font-weight: 700; font-family: 'Montserrat', sans-serif; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col li { margin-bottom: 10px; }
        .footer-col a { color: #CBD5E1; text-decoration: none; transition: 0.3s; }
        .footer-col a:hover { color: var(--accent); padding-left: 5px; }
        .social-buttons { display: flex; gap: 15px; margin-top: 20px; }
        .social-btn {
            width: 44px; height: 44px;
            display: flex; justify-content: center; align-items: center;
            color: white; border-radius: 50%;
            background: rgba(255,255,255,0.08);
            transition: all 0.3s;
        }
        .social-btn:hover { background: var(--secondary); transform: translateY(-3px); }
        .footer-bottom {
            text-align: center; padding-top: 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
            color: #94A3B8;
        }

        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 20px; }
            .results-grid { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .long-form-content { font-size: 1rem; }
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="message-box" class="message-box"></div>
    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <!-- TOOL SECTION -->
        <div class="card">
            <h2><i class="fas fa-industry"></i> Industrial Pipe Heat Loss & Insulation Calculator</h2>
            
            <div class="tool-description">
                <p>A professional-grade engineering tool designed for <strong>Process Engineers</strong> and <strong>Energy Auditors</strong>. This calculator solves the steady-state heat transfer equations per <strong>ISO 12241:2008</strong> and <strong>ASTM C680</strong>. It utilizes an iterative numerical solver to determine surface temperature, accounting for temperature-dependent air properties, forced/natural convection transitions, and radiative heat exchange.</p>
            </div>

            <div class="calculator-form">
                <form id="heat-form">
                    <!-- Preset Selection -->
                    <div class="form-row" style="align-items: end;">
                        <div class="form-group" style="width: 100%;">
                            <label>Quick Load Industrial Scenarios:</label>
                            <div class="preset-container">
                                <button type="button" class="preset-btn" onclick="loadPreset('steam')"><i class="fas fa-fire"></i> High-Pressure Steam (18 bar)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('hotwater')"><i class="fas fa-water"></i> Hydronic Heating (85°C)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('chilled')"><i class="fas fa-snowflake"></i> Chilled Water (7°C)</button>
                                <button type="button" class="preset-btn" onclick="loadPreset('oil')"><i class="fas fa-oil-can"></i> Thermal Oil (250°C)</button>
                            </div>
                        </div>
                    </div>

                    <!-- Config Group -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid rgba(30, 58, 138, 0.1); padding-bottom: 10px;">1. System Configuration & Environment</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-cog"></i> Calculation Settings</div>
                            <div class="form-group">
                                <label for="unit-sys">Unit System</label>
                                <select id="unit-sys" onchange="updateLabels()">
                                    <option value="metric" selected>Metric (SI) - mm, m, °C, W/mK</option>
                                    <option value="imperial">Imperial (IP) - in, ft, °F, BTU/hr·ft·°F</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label for="ins-type">Insulation Strategy</label>
                                <select id="ins-type" onchange="toggleInsulation()">
                                    <option value="yes" selected>Insulated Pipe (Single Layer)</option>
                                    <option value="no">Bare (Uninsulated) Pipe</option>
                                </select>
                            </div>
                        </div>
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-thermometer-half"></i> Process Data</div>
                            <div class="form-group">
                                <label id="lbl-t-fluid" for="t-fluid">Process Fluid Temp ($T_{int}$)</label>
                                <input type="number" id="t-fluid" value="150" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label id="lbl-t-amb" for="t-amb">Ambient Air Temp ($T_{amb}$)</label>
                                <input type="number" id="t-amb" value="25" step="1">
                            </div>
                        </div>
                    </div>

                    <!-- Pipe & Insulation Params -->
                    <h4 style="color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid rgba(30, 58, 138, 0.1); padding-bottom: 10px; margin-top: 30px;">2. Geometry & Materials</h4>
                    <div class="form-row">
                        <div class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-ruler-combined"></i> Pipe Geometry</div>
                            <div class="form-group">
                                <label id="lbl-pipe-od" for="pipe-od">Pipe Outer Diameter (OD)</label>
                                <input type="number" id="pipe-od" value="114.3" step="0.1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label id="lbl-length" for="length">Line Length</label>
                                <input type="number" id="length" value="10" step="1">
                            </div>
                        </div>
                        <div id="ins-params" class="vector-input-group">
                            <div class="vector-input-header"><i class="fas fa-layer-group"></i> Insulation Properties</div>
                            <div class="form-group">
                                <label id="lbl-ins-thk" for="ins-thk">Insulation Thickness</label>
                                <input type="number" id="ins-thk" value="50" step="1">
                            </div>
                            <div class="form-group" style="margin-top:10px;">
                                <label id="lbl-ins-k" for="ins-k">Thermal Conductivity ($k$)</label>
                                <input type="number" id="ins-k" value="0.04" step="0.001">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="vector-input-group" style="width: 100%;">
                            <div class="vector-input-header"><i class="fas fa-wind"></i> Surface & Wind Conditions</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="emissivity">Surface Emissivity ($\epsilon$) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Ratio of radiation emitted by surface to a black body. <br>Aluminum Jacketing (New): 0.05 <br>Aluminum (Oxidized): 0.15 <br>Steel (Oxidized): 0.8 <br>Canvas/PVC/Painted: 0.9</span></span></label>
                                    <input type="number" id="emissivity" value="0.9" step="0.05" min="0.01" max="1.0">
                                </div>
                                <div class="form-group">
                                    <label id="lbl-wind" for="wind-speed">Wind Velocity ($v_{air}$)</label>
                                    <input type="number" id="wind-speed" value="0" step="0.1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calc-btn" class="btn"><i class="fas fa-calculator"></i> Run Engineering Calculation</button>
                        <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Generate PDF Report</button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px; border-color: var(--secondary);">
                <h3><i class="fas fa-chart-line"></i> Thermal Analysis Results</h3>
                <div class="results-grid">
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Key Performance Indicators</h4>
                        <table class="results-table">
                            <thead>
                                <tr><th>Parameter</th><th>Value</th><th>Unit</th></tr>
                            </thead>
                            <tbody id="result-table-body"></tbody>
                        </table>
                        
                        <div id="safety-warning" style="margin-top: 20px; padding: 15px; border-radius: 6px; border: 2px solid var(--border); display: flex; align-items: center; gap: 15px;">
                            <!-- Dynamic Content -->
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(30, 58, 138, 0.05); border-radius: 8px;">
                            <strong><i class="fas fa-info-circle"></i> Insight:</strong> 
                            <span id="result-insight-text">Loading insight...</span>
                        </div>
                    </div>

                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Insulation Optimization Curve</h4>
                        <div class="chart-container">
                            <canvas id="lossChart"></canvas>
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <h5 style="margin: 0 0 10px 0; color: var(--text-light);">Cross-Sectional View</h5>
                            <canvas id="crossCanvas" width="300" height="200" style="border: 1px solid var(--border); border-radius: 8px; background: #fff;"></canvas>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 40px; border-top: 2px solid var(--border); padding-top: 20px;">Detailed Calculation Log (Step-by-Step Verification)</h4>
                <div id="calculation-details" class="step-log-container">
                    <!-- Logs go here -->
                </div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT SECTION -->
        <div class="card long-form-content">
            <h2 style="border-bottom: none; font-size: 2.2rem; text-align: center; display: block; margin-bottom: 10px;">The Engineering Guide to Pipe Insulation</h2>
            <p style="text-align: center; color: var(--text-light); margin-bottom: 40px;">Principles, Physics, and Standards for Industrial Heat Transfer</p>
            
            <hr style="border: 0; border-top: 1px solid var(--border); margin-bottom: 40px;">

            <h3>1. Fundamentals of Heat Transfer in Piping</h3>
            <p>In industrial processing, the transport of fluids—whether superheated steam, thermal oil, or cryogenic liquids—requires precise thermal management. Heat loss is not merely an energy inefficiency; it impacts process stability, chemical reaction rates, viscosity control, and personnel safety.</p>
            <p>Heat transfer from a pipe to the environment occurs through a complex interaction of three modes, which this calculator models simultaneously:</p>
            
            <h4>1.1 Conduction (Fourier's Law)</h4>
            <p>This is the transfer of energy through the solid material of the pipe wall and the insulation layer. It is governed by the material's thermal conductivity ($k$).</p>
            <div class="equation-box">
                $$ Q_{cond} = \frac{2 \pi k L (T_{inner} - T_{outer})}{\ln(D_{outer}/D_{inner})} $$
            </div>
            <p>In a radial system like a pipe, the area available for heat transfer increases as you move outward. This is why we use the logarithmic mean area logic in the resistance formula above. The thermal resistance of insulation usually dominates the total resistance of the system.</p>

            <h4>1.2 Convection (Newton's Law of Cooling)</h4>
            <p>Once heat reaches the outer surface (of the pipe or cladding), it warms the adjacent air. As air warms, its density decreases, causing it to rise (Natural Convection). If wind is present, it strips the boundary layer away faster (Forced Convection).</p>
            <div class="equation-box">
                $$ Q_{conv} = h_c A_s (T_s - T_{amb}) $$
            </div>
            <p>The Convection Coefficient ($h_c$) is not a constant. It depends on the Nusselt number ($Nu$), which itself is a function of the Reynolds number ($Re$) for wind or the Grashof/Rayleigh numbers ($Gr, Ra$) for still air. This calculator uses the <strong>Churchill-Bernstein</strong> correlation for forced convection and <strong>Churchill-Chu</strong> for natural convection, ensuring accuracy across laminar and turbulent regimes.</p>

            <h4>1.3 Radiation (Stefan-Boltzmann Law)</h4>
            <p>Often underestimated, thermal radiation can account for <strong>40% to 60%</strong> of total heat loss in still air environments. Every object above absolute zero radiates electromagnetic energy.</p>
            <div class="equation-box">
                $$ Q_{rad} = \epsilon \sigma A_s (T_s^4 - T_{amb}^4) $$
            </div>
            <p>The critical factor here is <strong>Emissivity ($\epsilon$)</strong>. A shiny aluminum jacket ($\epsilon \approx 0.05$) emits very little radiation, acting as a "radiation shield," whereas a painted surface ($\epsilon \approx 0.9$) is a highly efficient radiator. Changing the jacket material can sometimes be as effective as adding more insulation.</p>

            <blockquote>
                "Insulation does not stop heat flow; it merely slows it down. The goal of engineering is to slow it down to an economically or operationally acceptable rate."
            </blockquote>

            <h3>2. Surface Temperature & Iteration</h3>
            <p>A common mistake in simple manual calculations is guessing the convection coefficient. However, $h_c$ depends on the surface temperature ($T_s$), and $T_s$ depends on the heat loss, which depends on $h_c$. This creates a circular dependency.</p>
            <p>To solve this, professional tools like this one use <strong>Iterative Numerical Methods</strong> (specifically the Bisection Method). The algorithm:</p>
            <ol>
                <li>Guesses a surface temperature $T_s$.</li>
                <li>Calculates air properties (density, viscosity, conductivity) at the film temperature.</li>
                <li>Calculates $h_c$ and $h_r$ based on these properties.</li>
                <li>Calculates Heat Flow out to the air ($Q_{out}$).</li>
                <li>Calculates Heat Flow through the insulation ($Q_{in}$).</li>
                <li>Compares $Q_{in}$ and $Q_{out}$. If they don't match, it adjusts the guess $T_s$ and repeats until convergence.</li>
            </ol>

            <h3>3. Personnel Protection Standards (ASTM C1055)</h3>
            <p>Beyond energy conservation, safety is paramount. <strong>ASTM C1055</strong> (Standard Guide for Heated System Surface Conditions that Produce Contact Burn Injuries) defines the relationship between surface temperature, contact time, and burn injury.</p>
            <ul>
                <li><strong>60°C (140°F):</strong> The typically accepted limit for industrial "safe touch" surfaces (metal) for an incidental contact of 5 seconds.</li>
                <li><strong>Thermodynamic Burn:</strong> Human tissue begins to suffer thermal damage when the skin temperature reaches approximately 44°C.</li>
            </ul>
            <p>If this calculator predicts a surface temperature above 60°C, physical barriers or additional insulation are mandatory for personnel safety.</p>

            <h3>4. Economic Thickness of Insulation (ETI)</h3>
            <p>Is thicker always better? Not necessarily. The law of diminishing returns applies strictly to insulation.</p>
            <ul>
                <li><strong>First inch of insulation:</strong> Saves ~85% of bare pipe heat loss.</li>
                <li><strong>Second inch:</strong> Saves an additional ~10%.</li>
                <li><strong>Third inch:</strong> Saves only ~2-3%.</li>
            </ul>
            <p>The <strong>Economic Thickness</strong> is the thickness where the sum of the annualized cost of insulation (material + labor) and the annual cost of lost energy is minimized. This calculator provides a visual curve to help you spot where the "knee" of the curve flattens out, indicating diminishing returns.</p>

            <h3>5. Condensation & Dew Point (Cold Service)</h3>
            <p>For chilled water or cryogenic lines, the direction of heat flow is reversed (heat gains into the pipe). The primary danger here is <strong>Condensation</strong>.</p>
            <p>If the surface temperature of the insulation drops below the ambient <strong>Dew Point</strong>, moisture will condense on the jacket. This leads to:</p>
            <ul>
                <li><strong>CUI (Corrosion Under Insulation):</strong> Water wicks into joints, corroding the pipe unseen.</li>
                <li><strong>Mold Growth:</strong> Biological hazards on the insulation surface.</li>
                <li><strong>Insulation Failure:</strong> Wet insulation has a high thermal conductivity, rendering it useless.</li>
            </ul>
            <p>When designing for cold systems, always select a thickness that maintains $T_s > T_{dew}$.</p>
        </div>
    </main>

        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- GLOBAL CONSTANTS & STATE ---
        let lossChart = null;
        let lastResult = null;
        const SIGMA = 5.670373e-8; // Stefan-Boltzmann constant

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const themeSwitch = document.getElementById('theme-switch');
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            themeSwitch.addEventListener('change', () => {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('theme', themeSwitch.checked ? 'dark' : 'light');
            });

            document.getElementById('calc-btn').addEventListener('click', calculate);
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
            updateLabels();
        });

        // --- UI HELPERS ---
        function updateLabels() {
            const sys = document.getElementById('unit-sys').value;
            const lblTf = document.getElementById('lbl-t-fluid');
            const lblTa = document.getElementById('lbl-t-amb');
            const lblOd = document.getElementById('lbl-pipe-od');
            const lblLen = document.getElementById('lbl-length');
            const lblThk = document.getElementById('lbl-ins-thk');
            const lblK = document.getElementById('lbl-ins-k');
            const lblWind = document.getElementById('lbl-wind');

            if (sys === 'metric') {
                lblTf.innerText = "Process Fluid Temp [°C]"; lblTa.innerText = "Ambient Air Temp [°C]";
                lblOd.innerText = "Pipe Outer Diameter [mm]"; lblLen.innerText = "Line Length [m]";
                lblThk.innerText = "Insulation Thickness [mm]"; lblK.innerText = "Thermal Conductivity [W/m·K]";
                lblWind.innerText = "Wind Velocity [m/s]";
            } else {
                lblTf.innerText = "Process Fluid Temp [°F]"; lblTa.innerText = "Ambient Air Temp [°F]";
                lblOd.innerText = "Pipe Outer Diameter [in]"; lblLen.innerText = "Line Length [ft]";
                lblThk.innerText = "Insulation Thickness [in]"; lblK.innerText = "Thermal Conductivity [BTU/hr·ft·°F]";
                lblWind.innerText = "Wind Velocity [ft/s]";
            }
        }

        function toggleInsulation() {
            const type = document.getElementById('ins-type').value;
            const container = document.getElementById('ins-params');
            if (type === 'no') {
                container.style.opacity = '0.4';
                container.style.pointerEvents = 'none';
            } else {
                container.style.opacity = '1';
                container.style.pointerEvents = 'auto';
            }
        }

        function loadPreset(key) {
            document.getElementById('unit-sys').value = 'metric';
            updateLabels();
            const inputs = {
                steam: { t: 210, od: 168.3, thk: 80, k: 0.055, ins: 'yes' },
                hotwater: { t: 85, od: 60.3, thk: 40, k: 0.040, ins: 'yes' },
                chilled: { t: 7, od: 114.3, thk: 50, k: 0.035, ins: 'yes' },
                oil: { t: 250, od: 219.1, thk: 100, k: 0.065, ins: 'yes' }
            };
            
            const p = inputs[key];
            document.getElementById('t-fluid').value = p.t;
            document.getElementById('pipe-od').value = p.od;
            document.getElementById('ins-thk').value = p.thk;
            document.getElementById('ins-k').value = p.k;
            document.getElementById('ins-type').value = p.ins;
            toggleInsulation();
            
            calculate();
            
            const msgBox = document.getElementById('message-box');
            msgBox.innerText = "Scenario Loaded Successfully";
            msgBox.className = "message-box show";
            msgBox.style.background = "var(--success)";
            setTimeout(() => msgBox.classList.remove('show'), 3000);
        }

        // --- PHYSICS ENGINE ---
        function calculate() {
            // 1. INPUT GATHERING
            const sys = document.getElementById('unit-sys').value;
            const hasIns = document.getElementById('ins-type').value === 'yes';
            
            let Tf = parseFloat(document.getElementById('t-fluid').value);
            let Ta = parseFloat(document.getElementById('t-amb').value);
            let Od_val = parseFloat(document.getElementById('pipe-od').value);
            let L_val = parseFloat(document.getElementById('length').value);
            let thk_val = hasIns ? parseFloat(document.getElementById('ins-thk').value) : 0;
            let k_val = parseFloat(document.getElementById('ins-k').value);
            let eps = parseFloat(document.getElementById('emissivity').value);
            let wind = parseFloat(document.getElementById('wind-speed').value);

            // 2. SI CONVERSION
            let Tf_k, Ta_k, D1_m, D2_m, L_m, k_si, wind_si;
            
            if (sys === 'metric') {
                Tf_k = Tf + 273.15; 
                Ta_k = Ta + 273.15;
                D1_m = Od_val / 1000; 
                D2_m = (Od_val + 2 * thk_val) / 1000;
                L_m = L_val; 
                k_si = k_val; 
                wind_si = wind;
            } else {
                Tf_k = (Tf - 32) * 5/9 + 273.15; 
                Ta_k = (Ta - 32) * 5/9 + 273.15;
                D1_m = Od_val * 0.0254; 
                D2_m = (Od_val + 2 * thk_val) * 0.0254;
                L_m = L_val * 0.3048; 
                k_si = k_val * 1.7307; // BTU/hrftF to W/mK
                wind_si = wind * 0.3048;
            }

            // 3. BISECTION SOLVER SETUP
            let T_low = Math.min(Tf_k, Ta_k);
            let T_high = Math.max(Tf_k, Ta_k);
            let Ts = (T_low + T_high) / 2;
            let finalQ = 0, hc = 0, hr = 0, logSteps = [];
            let converged = false;

            // Bare pipe assumption check
            if (!hasIns) {
                // For bare pipes, Ts is close to Tf, but limited by fluid internal film resistance.
                // Simplified: We assume Ts = Tf for bare pipes in this tool unless user specifically asks for internal film modeling.
                // However, detailed heat loss still needs hc and hr based on Tf.
                Ts = Tf_k;
                const props = getAirProps(Ts, Ta_k);
                const coeffs = getCoeffs(Ts, Ta_k, D2_m, wind_si, props, eps);
                hc = coeffs.hc;
                hr = coeffs.hr;
                finalQ = (hc + hr) * (Math.PI * D2_m) * Math.abs(Ts - Ta_k);
                converged = true;
                logSteps.push(`BARE PIPE MODE: Surface Temp assumed equal to Fluid Temp.`);
                logSteps.push(`Calculated Coefficients at Ts=${Ts.toFixed(1)}K: hc=${hc.toFixed(2)}, hr=${hr.toFixed(2)}`);
            } 
            else {
                // Iteration Loop
                for (let i = 0; i < 100; i++) {
                    // Air Properties at Film Temp
                    const props = getAirProps(Ts, Ta_k);
                    
                    // Coefficients
                    const coeffs = getCoeffs(Ts, Ta_k, D2_m, wind_si, props, eps);
                    hc = coeffs.hc;
                    hr = coeffs.hr;
                    
                    // Heat Flows
                    const R_conv = 1 / (hc * Math.PI * D2_m);
                    const R_rad = 1 / (hr * Math.PI * D2_m);
                    const R_ext = 1 / ((1/R_conv) + (1/R_rad)); // Parallel resistance
                    
                    const Q_out = Math.abs(Ts - Ta_k) / R_ext;
                    
                    const R_ins = Math.log(D2_m / D1_m) / (2 * Math.PI * k_si);
                    const Q_in = Math.abs(Tf_k - Ts) / R_ins;

                    // Check Balance
                    const diff = Q_in - Q_out;
                    if (Math.abs(diff) < 0.1 || Math.abs(T_high - T_low) < 0.01) {
                        finalQ = (Q_in + Q_out) / 2;
                        converged = true;
                        
                        // LOGGING FINAL STATE
                        logSteps.push(`ITERATION CONVERGED at Step ${i+1}`);
                        logSteps.push(`Surface Temp (Ts): ${Ts.toFixed(2)} K (${(Ts-273.15).toFixed(1)}°C)`);
                        logSteps.push(`Film Temp (Tf): ${props.Tm.toFixed(2)} K`);
                        logSteps.push(`Air Kinematic Viscosity (v): ${props.nu.toExponential(3)} m²/s`);
                        logSteps.push(`Air Thermal Conductivity (k): ${props.k.toFixed(4)} W/mK`);
                        logSteps.push(`Prandtl Number (Pr): ${props.Pr.toFixed(3)}`);
                        if(wind_si > 0.1) {
                            logSteps.push(`FORCED CONVECTION: Reynolds No (Re): ${coeffs.Re.toExponential(3)}`);
                            logSteps.push(`Nusselt No (Nu) [Churchill-Bernstein]: ${coeffs.Nu.toFixed(3)}`);
                        } else {
                            logSteps.push(`NATURAL CONVECTION: Rayleigh No (Ra): ${coeffs.Ra.toExponential(3)}`);
                            logSteps.push(`Nusselt No (Nu) [Churchill-Chu]: ${coeffs.Nu.toFixed(3)}`);
                        }
                        logSteps.push(`Convection Coeff (hc): ${hc.toFixed(3)} W/m²K`);
                        logSteps.push(`Radiation Coeff (hr): ${hr.toFixed(3)} W/m²K`);
                        logSteps.push(`Total External Resistance (R_ext): ${R_ext.toFixed(4)} K/W per m`);
                        logSteps.push(`Insulation Resistance (R_ins): ${R_ins.toFixed(4)} K/W per m`);
                        break;
                    }

                    // Bisection Adjustment
                    // If Q_in > Q_out, it means heat is arriving at surface faster than it leaves. Surface gets hotter.
                    if (Tf_k > Ta_k) {
                        if (Q_in > Q_out) T_low = Ts; else T_high = Ts;
                    } else {
                        // Cold fluid: Heat flows IN.
                        // If Q_in (from ambient to surf) > Q_out (surf to fluid), Surf gets hotter.
                        // Wait, Q equations above are unsigned magnitudes. Let's fix direction logic.
                        // Hot Fluid: Tf > Ts > Ta. Q_in = (Tf-Ts)/R. Q_out = (Ts-Ta)/R.
                        // If (Tf-Ts)/R_ins > (Ts-Ta)/R_ext -> Ts must increase to reduce Q_in and increase Q_out.
                        if (Q_in > Q_out) T_low = Ts; else T_high = Ts;
                    }
                    Ts = (T_low + T_high) / 2;
                }
            }

            // 4. DISPLAY RESULTS
            let Q_disp, Ts_disp, unitQ, unitT, unitH, unitL;
            if (sys === 'metric') {
                Q_disp = finalQ; 
                Ts_disp = Ts - 273.15;
                unitQ = "W"; unitT = "°C"; unitH = "W/m²·K"; unitL = "m";
            } else {
                Q_disp = finalQ * 3.41214; 
                Ts_disp = (Ts - 273.15) * 9/5 + 32;
                unitQ = "BTU/hr"; unitT = "°F"; unitH = "BTU/hr·ft²·°F"; unitL = "ft";
            }
            
            const totalQ = Q_disp * L_val; // Total for length
            const q_linear = Q_disp; // Per unit length

            lastResult = { 
                sys, Q_disp: totalQ, q_linear, Ts_disp, unitQ, unitT, unitH, unitL, 
                hc, hr, Tf, Ta, Od_val, thk_val, L_val, logSteps, Ts_K: Ts 
            };

            renderUI(lastResult);
            drawCrossSection(D1_m, D2_m, hasIns, Ts, Ta_k, Tf_k);
            drawTrend(D1_m, Tf_k, Ta_k, k_si, wind_si, eps, sys);
        }

        // --- HELPER PHYSICS FUNCTIONS ---
        function getAirProps(Ts, Ta) {
            const Tm = (Ts + Ta) / 2;
            // Regression for dry air properties (approx valid 200K - 1000K)
            const t_c = Tm - 273.15;
            // Thermal Cond (W/mK)
            const k = 2.44e-2 + 7.67e-5 * t_c; 
            // Kinematic Viscosity (m2/s)
            const nu = 1.35e-5 + 9.3e-8 * t_c + 5e-11 * t_c**2;
            // Prandtl
            const Pr = 0.71; 
            // Beta (1/K)
            const beta = 1 / Tm;
            
            return { k, nu, Pr, beta, Tm };
        }

        function getCoeffs(Ts, Ta, D, v, p, eps) {
            let Nu, hc, Re=0, Ra=0;
            const deltaT = Math.abs(Ts - Ta);

            // 1. Convection
            if (v > 0.1) {
                // Forced Convection: Churchill-Bernstein (Valid for all Re)
                Re = v * D / p.nu;
                const term1 = 0.62 * Math.sqrt(Re) * Math.pow(p.Pr, 1/3);
                const term2 = Math.pow(1 + Math.pow(0.4/p.Pr, 2/3), 1/4);
                const term3 = Math.pow(1 + Math.pow(Re/282000, 5/8), 4/5);
                Nu = 0.3 + (term1/term2) * term3;
                hc = Nu * p.k / D;
            } else {
                // Natural Convection: Churchill-Chu
                const Gr = 9.81 * p.beta * deltaT * Math.pow(D, 3) / (p.nu**2);
                Ra = Gr * p.Pr;
                const term1 = 0.387 * Math.pow(Ra, 1/6);
                const term2 = Math.pow(1 + Math.pow(0.559/p.Pr, 9/16), 8/27);
                Nu = Math.pow(0.6 + term1/term2, 2);
                hc = Nu * p.k / D;
            }

            // 2. Radiation
            // hr = eps * sigma * (Ts^2 + Ta^2)(Ts + Ta)
            const hr = eps * SIGMA * (Math.pow(Ts, 2) + Math.pow(Ta, 2)) * (Ts + Ta);

            return { hc, hr, Nu, Re, Ra };
        }

        // --- RENDERING ---
        function renderUI(res) {
            const body = document.getElementById('result-table-body');
            body.innerHTML = `
                <tr><td><strong>Total Heat Loss</strong></td><td><strong style="font-size:1.1em; color:var(--primary);">${res.Q_disp.toLocaleString(undefined, {maximumFractionDigits:0})}</strong></td><td>${res.unitQ}</td></tr>
                <tr><td>Heat Loss per Length</td><td>${res.q_linear.toFixed(1)}</td><td>${res.unitQ}/${res.unitL}</td></tr>
                <tr><td><strong>Surface Temperature</strong></td><td><strong class="${res.Ts_disp > 60 ? 'danger-text' : 'highlight'}">${res.Ts_disp.toFixed(1)}</strong></td><td>${res.unitT}</td></tr>
                <tr><td>Convection Coefficient ($h_c$)</td><td>${res.hc.toFixed(2)}</td><td>${res.unitH}</td></tr>
                <tr><td>Radiation Coefficient ($h_r$)</td><td>${res.hr.toFixed(2)}</td><td>${res.unitH}</td></tr>
            `;

            // Warnings
            const warningEl = document.getElementById('safety-warning');
            const insightEl = document.getElementById('result-insight-text');
            
            if (res.Ts_disp > 60) {
                warningEl.style.borderColor = "var(--danger)";
                warningEl.style.backgroundColor = "rgba(220, 38, 38, 0.05)";
                warningEl.innerHTML = `<i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: var(--danger);"></i> <div><strong style="color:var(--danger)">BURN HAZARD WARNING</strong><br>Surface temperature exceeds 60°C (140°F). ASTM C1055 mandates personnel protection (barriers or thicker insulation).</div>`;
                insightEl.innerText = "System is unsafe for touch. Radiation losses are likely high due to high surface temp. Consider lowering emissivity (cladding) or increasing thickness.";
            } else if (res.Ts_disp < res.Ta) {
                 // Cold Case
                 warningEl.style.borderColor = "var(--secondary)";
                 warningEl.style.backgroundColor = "rgba(37, 99, 235, 0.05)";
                 warningEl.innerHTML = `<i class="fas fa-snowflake" style="font-size: 1.5rem; color: var(--secondary);"></i> <div><strong>Cold Service</strong><br>Ensure surface temp is above the Dew Point to prevent condensation and CUI.</div>`;
                 insightEl.innerText = "For cold lines, the primary design driver is usually condensation control rather than pure energy loss.";
            } else {
                warningEl.style.borderColor = "var(--success)";
                warningEl.style.backgroundColor = "rgba(16, 185, 129, 0.05)";
                warningEl.innerHTML = `<i class="fas fa-check-circle" style="font-size: 1.5rem; color: var(--success);"></i> <div><strong>Safe Touch</strong><br>Surface temperature is below 60°C. Compliant with standard personnel protection limits.</div>`;
                insightEl.innerText = "System is performing efficiently. Surface temperature is well-managed.";
            }

            // Logs
            const logContainer = document.getElementById('calculation-details');
            logContainer.innerHTML = res.logSteps.map(step => `<span class="log-eq">${step}</span>`).join('');

            document.getElementById('result-container').classList.remove('hidden');
            if(window.MathJax) window.MathJax.typeset();
        }

        // --- CANVAS DRAWING ---
        function drawCrossSection(d1, d2, hasIns, Ts, Ta, Tf) {
            const canvas = document.getElementById('crossCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,300,200);
            
            const cx = 150, cy = 100;
            // Determine scale to fit in 300x200. Max dim is d2.
            const maxDim = d2 * 1.2; 
            const scale = 180 / maxDim; // 180px available height

            // Draw Insulation
            if (hasIns) {
                ctx.beginPath();
                ctx.arc(cx, cy, (d2/2)*scale, 0, Math.PI*2);
                ctx.fillStyle = '#FEF3C7'; // Light amber
                ctx.fill();
                ctx.lineWidth = 1;
                ctx.strokeStyle = '#D97706';
                ctx.stroke();
            }

            // Draw Pipe
            ctx.beginPath();
            ctx.arc(cx, cy, (d1/2)*scale, 0, Math.PI*2);
            ctx.fillStyle = '#94A3B8'; // Slate
            ctx.fill();
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#475569';
            ctx.stroke();

            // Arrows
            ctx.fillStyle = '#0F172A';
            ctx.font = '10px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(hasIns ? "Insulation" : "Pipe Wall", cx, cy - (d2/2)*scale - 10);
            
            // Heat Flow Text
            ctx.fillStyle = (Tf > Ta) ? '#DC2626' : '#2563EB';
            ctx.font = 'bold 12px Inter';
            ctx.fillText((Tf > Ta) ? "Heat Loss ➔" : "Heat Gain ➔", cx, cy + (d2/2)*scale + 20);
        }

        function drawTrend(D1, Tf, Ta, k, wind, eps, sys) {
            const ctx = document.getElementById('lossChart').getContext('2d');
            if (lossChart) lossChart.destroy();

            const thicks = [0, 10, 25, 40, 50, 75, 100, 150]; // mm
            const dataQ = [];
            const dataTs = [];
            
            // Simulate for different thicknesses
            thicks.forEach(t_mm => {
                const t_m = t_mm / 1000;
                const D2 = D1 + 2*t_m;
                
                // Solve Simplified (Non-Iterative Approx for Chart Speed)
                // Use fixed h approx for trend shape
                const h_approx = 10 + (wind * 4); 
                const R_ins = (t_mm === 0) ? 0 : Math.log(D2/D1) / (2 * Math.PI * k);
                const R_surf = 1 / (h_approx * Math.PI * D2);
                const Q_approx = Math.abs(Tf - Ta) / (R_ins + R_surf);
                
                // Convert for display
                const val = (sys === 'metric') ? Q_approx : Q_approx * 3.412;
                dataQ.push(val);
            });

            lossChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: thicks.map(t => sys==='metric' ? `${t}mm` : `${(t/25.4).toFixed(1)}"`) ,
                    datasets: [{
                        label: `Heat Loss (${sys==='metric'?'W/m':'BTU/hr·ft'})`,
                        data: dataQ,
                        borderColor: '#2563EB',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display:true, text: 'Heat Loss' } },
                        x: { title: { display:true, text: 'Insulation Thickness' } }
                    }
                }
            });
        }

        function generatePDF() {
            if (!lastResult) {
                alert("Please calculate first!");
                return;
            }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFillColor(30, 58, 138);
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.text("Thermal Insulation Report", 14, 25);
            doc.setFontSize(10);
            doc.text("Generated by Design Calculators (ISO 12241 Compliant)", 14, 35);

            // Summary Info
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 160, 35);

            let y = 50;
            
            // Input Table
            doc.setFontSize(14);
            doc.text("1. Design Parameters", 14, y);
            y += 8;
            doc.autoTable({
                startY: y,
                head: [['Parameter', 'Value', 'Unit']],
                body: [
                    ['Process Fluid Temp', lastResult.Tf, lastResult.sys==='metric'?'C':'F'],
                    ['Ambient Temp', lastResult.Ta, lastResult.sys==='metric'?'C':'F'],
                    ['Pipe OD', lastResult.Od_val, lastResult.sys==='metric'?'mm':'in'],
                    ['Insulation Thk', lastResult.thk_val, lastResult.sys==='metric'?'mm':'in'],
                    ['Insulation Conductivity', document.getElementById('ins-k').value, lastResult.sys==='metric'?'W/mK':'BTU'],
                    ['Emissivity', document.getElementById('emissivity').value, '-']
                ],
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });

            y = doc.lastAutoTable.finalY + 15;

            // Results Table
            doc.text("2. Thermal Analysis Results", 14, y);
            y += 8;
            doc.autoTable({
                startY: y,
                head: [['Metric', 'Result', 'Unit']],
                body: [
                    ['Surface Temperature', lastResult.Ts_disp.toFixed(2), lastResult.unitT],
                    ['Total Heat Loss', lastResult.Q_disp.toFixed(0), lastResult.unitQ],
                    ['Linear Heat Loss', lastResult.q_linear.toFixed(2), `${lastResult.unitQ}/${lastResult.unitL}`],
                    ['Convection Coeff (hc)', lastResult.hc.toFixed(3), lastResult.unitH],
                    ['Radiation Coeff (hr)', lastResult.hr.toFixed(3), lastResult.unitH]
                ],
                theme: 'striped',
                headStyles: { fillColor: [16, 185, 129] }
            });

            y = doc.lastAutoTable.finalY + 20;
            
            // Warnings
            doc.setFontSize(10);
            doc.setTextColor(100);
            if (lastResult.Ts_disp > 60) {
                doc.setTextColor(220, 38, 38);
                doc.text("WARNING: Surface temperature exceeds 60°C. Personnel protection required.", 14, y);
            } else {
                doc.text("Note: Surface temperature is within safe touch limits (<60°C).", 14, y);
            }

            doc.save("Insulation_Report.pdf");
        }
    </script>
</body>
</html>

