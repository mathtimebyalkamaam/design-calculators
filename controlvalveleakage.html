<!DOCTYPE html>
<html lang="en">

<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
        crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>

    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Control Valve Leakage Calculator (ANSI/FCI 70-2 & IEC 60534-4)</title>
    <meta name="description"
        content="World-class Control Valve Leakage Calculator for Power, Oil & Gas, and Chemical Industries. Detailed 10-step calculation for ANSI/FCI 70-2 Classes II-VI. Features Bubble Counter, Actuator Thrust impact, and API 598 comparison.">
    <meta name="keywords"
        content="ansi fci 70-2 calculator, control valve leakage class, class vi bubble count, valve seat tightness test, iec 60534-4, class v water test, api 598 vs fci 70-2, severe service valve leakage, tso valve calculation, power plant valve testing">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://designcalculators.co.in/valveleakage" />

    <!-- JSON-LD Schema: Software Application -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Industrial Valve Seat Integrity Analyzer",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "A comprehensive engineering platform for verifying control valve seat tightness. Performs rigorous 10-step analysis based on ANSI/FCI 70-2 and IEC standards, suitable for QA/QC in heavy industries.",
      "featureList": "10-Step Calculation Log, Class II-VI Analysis, Bubble Counter, Test Medium Physics, TSO Verification, API/ASME Cross-Reference",
      "author": {
        "@type": "Organization",
        "name": "Design Calculators"
      }
    }
    </script>

    <!-- JSON-LD Schema: FAQ Page -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        { "@type": "Question", "name": "What is ANSI/FCI 70-2?", "acceptedAnswer": { "@type": "Answer", "text": "ANSI/FCI 70-2 (formerly ASME B16.104) is the standard that defines six seat leakage classification categories for control valves, establishing maximum allowable leakage rates for specific test procedures." } },
        { "@type": "Question", "name": "What is the difference between Class IV and Class VI?", "acceptedAnswer": { "@type": "Answer", "text": "Class IV is a 'Metal-to-Metal' seat standard allowing 0.01% of rated capacity leakage. Class VI is a 'Soft Seat' standard (bubble-tight) where leakage is measured in bubbles per minute or milliliters per minute, significantly tighter than Class IV." } },
        { "@type": "Question", "name": "How is Class V leakage calculated?", "acceptedAnswer": { "@type": "Answer", "text": "Class V is usually for critical metal seats. Allowable leakage is 5 x 10^-4 ml of water per minute per inch of port diameter per psi differential pressure. It requires high-pressure water testing." } },
        { "@type": "Question", "name": "Can I use Class VI for metal seats?", "acceptedAnswer": { "@type": "Answer", "text": "It is extremely difficult and expensive to achieve Class VI tightness with metal seats (requires lapping to optical flatness). Class VI is generally reserved for soft seats (Teflon, PEEK, etc.)." } },
        { "@type": "Question", "name": "What test medium is used for Class IV?", "acceptedAnswer": { "@type": "Answer", "text": "Class IV is typically tested with Air or Water at 45-60 psig (3-4 bar) or the maximum operating differential pressure, whichever is lower." } },
        { "@type": "Question", "name": "How many bubbles per ml?", "acceptedAnswer": { "@type": "Answer", "text": "The standard generally assumes approximately 4 to 15 bubbles per ml depending on the tubing size, but ANSI/FCI 70-2 defines Class VI explicitly in both 'Bubbles per Minute' and 'ml per Minute' to avoid ambiguity." } },
        { "@type": "Question", "name": "Does this tool support IEC 60534-4?", "acceptedAnswer": { "@type": "Answer", "text": "Yes, IEC 60534-4 generally aligns with ANSI/FCI 70-2 for leakage classes. The calculations provided here satisfy both standards." } },
        { "@type": "Question", "name": "What is 'Rated Capacity'?", "acceptedAnswer": { "@type": "Answer", "text": "Rated Capacity refers to the valve's Cv (or Kv) at 100% open. For Class II, III, and IV, the leakage limit is a percentage of this total flow capacity." } },
        { "@type": "Question", "name": "Why do bubbles vary in size?", "acceptedAnswer": { "@type": "Answer", "text": "Bubble size depends on the ID of the tubing submerged in water. ANSI/FCI 70-2 specifies a 1/4 inch OD (0.032\" wall) tube submerged 1/8 to 1/2 inch deep to standardize bubble volume." } },
        { "@type": "Question", "name": "What is TSO (Tight Shut Off)?", "acceptedAnswer": { "@type": "Answer", "text": "TSO is an industry term often synonymous with Class VI or Class V, implying the valve provides a reliable stop to flow, unlike standard throttling valves which may leak slightly even when closed." } }
      ]
    }
    </script>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <!-- MathJax for Formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Blue Industrial) --- */
        :root {
            --primary: #1E3A8A;
            /* Dark Blue */
            --secondary: #2563EB;
            /* Bright Blue */
            --accent: #F59E0B;
            /* Amber */
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #334155;
            --heading: #0F172A;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --input-bg: #FFFFFF;
        }

        body.dark-mode {
            --primary: #3B82F6;
            --secondary: #60A5FA;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #E2E8F0;
            --heading: #F8FAFC;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #FBBF24;
            --input-bg: #334155;
        }

        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: -0.5px;
        }

        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #DBEAFE;
            font-weight: 500;
        }

        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            opacity: 0.9;
        }

        .nav-links a:hover {
            opacity: 1;
            transform: translateY(-1px);
        }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .switch {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--success);
            border-color: var(--success);
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        /* Main Content */
        main {
            padding: 40px 0;
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card h2 {
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.75rem;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        h4 {
            color: var(--heading);
            font-size: 1.1rem;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        /* Tool Switcher */
        .tool-switcher {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tool-btn {
            background: var(--card);
            border: 2px solid var(--border);
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-btn:hover {
            border-color: var(--secondary);
            transform: translateY(-2px);
        }

        .tool-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }

        /* Module Containers */
        .tool-module {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .tool-module.active {
            display: block;
        }

        /* Results Big Display */
        .result-box {
            text-align: center;
            padding: 25px;
            background: var(--card);
            border: 2px solid var(--primary);
            border-radius: 12px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .result-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--grad);
        }

        .main-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            font-family: 'Montserrat', sans-serif;
            margin: 10px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .sub-value {
            font-size: 1.1rem;
            color: var(--text);
            opacity: 0.9;
            font-weight: 500;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Calculation Steps Styling */
        .calc-steps {
            text-align: left;
            margin-top: 25px;
            background: var(--bg);
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.03);
        }

        .calc-steps h4 {
            margin-top: 0;
            color: var(--primary);
            font-family: 'Inter', sans-serif;
            border-bottom: 1px dashed var(--border);
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        .calc-steps strong {
            color: var(--heading);
        }

        .step-block {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .step-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .step-title {
            font-weight: 700;
            color: var(--secondary);
            display: block;
            margin-bottom: 5px;
            font-family: 'Inter', sans-serif;
        }

        /* Visualizer */
        .viz-container {
            height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px;
        }

        canvas {
            max-height: 100%;
            max-width: 100%;
        }

        /* Buttons (Shared) */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(37, 99, 235, 0.35);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text);
            box-shadow: none;
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* Message Box */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.3s;
            display: none;
        }

        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        /* Educational Section */
        .education-section {
            padding: 40px;
        }

        .article-content {
            font-family: 'Inter', sans-serif;
            color: var(--text);
        }

        .article-block {
            margin-bottom: 40px;
        }

        .article-block h3 {
            color: var(--primary);
            border-left: 5px solid var(--accent);
            padding-left: 15px;
            margin-bottom: 20px;
            font-size: 1.4rem;
            margin-top: 0;
        }

        .article-block h4 {
            color: var(--heading);
            margin-top: 25px;
            margin-bottom: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            border-bottom: none;
        }

        .article-block p {
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: justify;
        }

        .article-block ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .article-block li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .highlight-box {
            background: rgba(37, 99, 235, 0.05);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .formula {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.1rem;
            border: 1px solid var(--border);
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        /* FAQ Accordion */
        .faq-item {
            border-bottom: 1px solid var(--border);
            padding: 15px 0;
        }

        .faq-question {
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--heading);
            transition: color 0.2s;
        }

        .faq-question:hover {
            color: var(--primary);
        }

        .faq-answer {
            display: none;
            margin-top: 10px;
            color: var(--text);
            line-height: 1.7;
            text-align: justify;
        }

        .faq-item.active .faq-answer {
            display: block;
            animation: fadeIn 0.3s;
        }

        .faq-icon {
            transition: transform 0.3s;
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

        /* Results Grid */
        .res-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media(max-width:768px) {
            .res-grid {
                grid-template-columns: 1fr;
            }
        }

        .res-item {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .res-label {
            font-size: 0.85rem;
            color: var(--text);
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .res-val {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--heading);
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #94A3B8;
            padding: 60px 0 30px 0;
            margin-top: 80px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-col {
            flex: 1;
            min-width: 200px;
        }

        .footer-col h4 {
            color: white;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-col li {
            margin-bottom: 12px;
        }

        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-col a:hover {
            color: var(--accent);
        }

        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        /* Social Buttons Styling */
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .social-btn:hover {
            transform: translateY(-4px);
        }

        .social-btn.linkedin {
            background-color: #0A66C2;
        }

        .social-btn.youtube {
            background-color: #FF0000;
        }

        .social-btn.twitter {
            background-color: #1DA1F2;
        }

        .social-btn.facebook {
            background-color: #1877F2;
        }

        .social-btn.whatsapp {
            background-color: #25D366;
        }

        .footer-disclaimer {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 900px;
            margin: 0 auto;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.85rem;
        }

        .hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 20px;
            }

            .nav-links {
                flex-direction: column;
                width: 100%;
                text-align: center;
            }

            .tool-switcher {
                flex-direction: column;
            }
        }
    </style>
    <style>
        /* Core Header Styles */
        .header {
            background: var(--gradient-primary, linear-gradient(135deg, #1E3A8A, #2563EB));
            color: white;
            padding: 10px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1000;
            overflow: visible !important;
        }

        .header .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            position: relative;
        }

        .header .logo-container {
            display: flex !important;
            align-items: center !important;
            gap: 12px !important;
            text-decoration: none;
            color: white;
        }

        .header .logo {
            height: 48px !important;
            width: auto;
            object-fit: contain;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: #ffffff;
            margin-bottom: 2px;
            white-space: nowrap;
            font-family: 'Montserrat', sans-serif;
        }

        .logo-text-group {
            display: flex;
            flex-direction: column;
            justify-content: center;
            line-height: 1.1;
        }

        .logo-subtitle {
            font-size: 0.7rem !important;
            color: rgba(255, 255, 255, 0.85) !important;
            font-weight: 500;
            margin: 0 !important;
            line-height: 1.2;
            max-width: 250px;
            white-space: normal;
        }

        .header .nav-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header .nav-links {
            display: flex;
            gap: 25px;
            list-style: none;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .header .nav-links li {
            margin: 0;
            position: relative;
            display: inline-block;
        }

        .header .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            opacity: 0.9;
        }

        .header .nav-links a:hover {
            opacity: 1;
            transform: translateY(-1px);
        }

        .header .theme-toggle {
            margin-left: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            z-index: 1000;
        }

        /* Mega Menu Styles */
        .nav-links .dropbtn {
            cursor: pointer;
            padding: 10px 0;
            display: inline-block;
        }

        .nav-links .dropbtn i {
            font-size: 0.8em;
            margin-left: 4px;
            opacity: 0.7;
            transition: transform 0.3s;
        }

        .nav-links .nav-item:hover .dropbtn i {
            transform: rotate(180deg);
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: var(--card-bg, #ffffff);
            width: 600px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 2000;
            border-radius: 12px;
            padding: 20px;
            top: 100%;
            margin-top: 5px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease-in-out;
            border-top: 4px solid var(--secondary-color, #2563EB);
        }

        .nav-links .nav-item:hover .dropdown-content {
            display: block;
            opacity: 1;
            visibility: visible;
        }

        .dropdown-content .row {
            display: flex;
            gap: 20px;
        }

        .dropdown-content .column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dropdown-content a {
            color: var(--text-color, #4B5563) !important;
            padding: 6px 8px;
            text-decoration: none;
            display: block;
            font-size: 0.9rem !important;
            border-radius: 6px;
            transition: background 0.2s, color 0.2s;
            font-weight: 400 !important;
            line-height: 1.4;
        }

        .dropdown-content a:hover {
            background-color: var(--hover-color, #F1F5F9);
            color: var(--primary-color, #1E3A8A) !important;
            transform: translateX(4px);
        }

        .mega-menu-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color, #E2E8F0);
            text-align: center;
        }

        .mega-menu-footer .view-all-btn {
            display: inline-block;
            color: var(--primary-color, #1E3A8A) !important;
            font-weight: 700 !important;
            font-size: 0.95rem !important;
        }

        /* Dark Mode Overrides */
        body.dark-mode .dropdown-content {
            background-color: var(--card-bg, #1E293B);
            border-color: var(--secondary-color, #34D399);
        }

        body.dark-mode .dropdown-content a {
            color: var(--text-color, #CBD5E1) !important;
        }

        body.dark-mode .dropdown-content a:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--primary-color, #10B981) !important;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .mobile-menu-toggle {
                display: block;
            }

            .header .nav-menu {
                display: flex;
            }

            .nav-links {
                position: fixed;
                top: 0;
                left: -100%;
                width: 280px;
                height: 100vh;
                background: var(--gradient-dark, #0F172A);
                flex-direction: column;
                padding: 100px 30px 30px;
                gap: 24px;
                transition: left 0.4s ease-in-out;
                box-shadow: 4px 0 12px rgba(0, 0, 0, 0.3);
                z-index: 999;
                align-items: flex-start;
            }

            .nav-links.active {
                left: 0;
            }

            .nav-links a {
                width: 100%;
                padding: 12px 16px;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.05);
                display: block;
            }

            .dropdown-content {
                position: static;
                width: 100%;
                box-shadow: none;
                transform: none;
                display: none !important;
                padding: 0 0 0 15px;
                background: transparent;
                border: none;
            }

            .nav-links .nav-item:hover .dropdown-content {
                display: block !important;
                opacity: 1;
                visibility: visible;
            }

            .dropdown-content .row {
                flex-direction: column;
                gap: 0;
            }

            .nav-links .nav-item {
                display: block;
                width: 100%;
            }

            .nav-links .dropbtn {
                width: 100%;
                display: flex;
                justify-content: space-between;
            }

            .header .logo-text {
                font-size: 1.1rem;
            }

            .header .logo {
                height: 40px;
            }
        }
    </style>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <div id="message-box" class="message-box"></div>

    <header class="header">
        <div class="header-bg-animation"></div>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <img src="logo.png" alt="Design Calculators Logo" class="logo">
                    <span class="logo-text">Design Calculators</span>
                </a>

                <div class="nav-menu">
                    <button class="mobile-menu-toggle" aria-label="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>

                    <ul class="nav-links">
                        <li><a href="/index.html">Home</a></li>
                        
    <li class="dropdown">
        <a href="/indexele.html" class="dropdown-toggle">Electrical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/arcflash.html">Arc Flash Calculator</a><a href="/breaker-sizing.html">Breaker Sizing</a><a href="/cable-thermal-rating.html">Cable Ampacity</a><a href="/comm-cable-loss.html">Comm Cable Loss</a><a href="/earth-conductor-size.html">Earth Conductor Size</a><a href="/generatorsizing.html">Generator Sizing</a><a href="/harmonicsanalyser.html">Harmonics Analyser</a><a href="/insulationresistance.html">Insulation Resistance</a><a href="/logicgate.html">Logic Gates Simulator</a><a href="/motor-starting.html">Motor Starting Current</a><a href="/pcbtrace.html">PCB Trace Width</a><a href="/protection-device.html">Protection Device</a><a href="/resistor.html">Resistor Color Code</a><a href="/solarcable.html">Solar Cable Sizing</a><a href="/systemxrcalculator.html">System X/R Ratio</a><a href="/transmissionline.html">Transmission Line</a><a href="/vfd-selection.html">VFD Selection Tool</a></div><div><a href="/batterylife.html">Battery Life Estimator</a><a href="/busbarampacity.html">Busbar Ampacity</a><a href="/cablepulling.html">Cable Pulling Tension</a><a href="/conduit-fill.html">Conduit Fill Calculator</a><a href="/earthingfaultsimulator.html">Earthing Fault Simulator</a><a href="/grounding.html">Grounding System Design</a><a href="/hvac-sizing.html">HVAC Sizing Calculator</a><a href="/lcresonancecalculator.html">LC Resonance Calculator</a><a href="/maintenance-guide.html">Maintenance Guide</a><a href="/nemaipconvertor.html">NEMA to IP Converter</a><a href="/power-factor.html">Power Factor Correction</a><a href="/relay-coordination.html">Relay Coordination</a><a href="/short-circuit.html">Short Circuit Current</a><a href="/solarpvarray.html">Solar PV Array</a><a href="/transformer-calculator.html">Transformer Calculator</a><a href="/unit-converter.html">Unit Converter</a><a href="/voltage-drop.html">Voltage Drop Calculator</a></div><div><a href="/battery-sizing.html">Battery Sizing (AH)</a><a href="/busbarshortcircuit.html">Busbar Short Circuit</a><a href="/cable-sizing.html">Cable Sizing Calculator</a><a href="/ctsaturation.html">CT Saturation</a><a href="/equipment-relay.html">Equipment Relay Setting</a><a href="/harmonic-distortion.html">Harmonic Distortion</a><a href="/industriallighting.html">Industrial Lighting</a><a href="/lighting-calulator.html">Lighting Calculator</a><a href="/motor-efficiency.html">Motor Efficiency</a><a href="/neutral-earth-fault-current.html">Neutral Earth Fault</a><a href="/powertriangletool.html">Power Triangle</a><a href="/electricalresidentialload.html">Residential Load Calc</a><a href="/skindepth.html">Skin Depth Calculator</a><a href="/symmetricalcomponents.html">Symmetrical Components</a><a href="/transformerinrush.html">Transformer Inrush</a><a href="/ups-sizing.html">UPS Sizing</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexele.html" class="view-all-link">View All Electrical Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexinst.html" class="dropdown-toggle">Instrumentation <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/adc-resolution.html">ADC Resolution</a><a href="/capillarylengthtemperatureerror.html">Capillary Error</a><a href="/cv-kv-valve.html">Cv/Kv Valve Sizing</a><a href="/dp-level.html">DP Level Measurement</a><a href="/hydrostatic-level.html">Hydrostatic Level</a><a href="/instrument-range.html">Instrument Range</a><a href="/loop-impedance.html">Loop Impedance</a><a href="/orifice-plate.html">Orifice Plate Beta</a><a href="/pid-tuning.html">PID Tuning</a><a href="/profibus.html">Profibus Calculator</a><a href="/tempsensorresponse.html">Response Time (Tau)</a><a href="/rtd-lead-comp.html">RTD Lead Wire Comp.</a><a href="/sealfluidzeroshift.html">Seal Fluid Shift</a><a href="/snr-calculator.html">SNR Calculator</a><a href="/thermocoupleextensioncable.html">TC Extension Cable</a><a href="/thermowellwakefreq.html">Thermowell Frequency</a><a href="/pressuretransmitteroverrange.html">Tx Overrange</a><a href="/valvecavitationcalculator.html">Valve Cavitation</a><a href="/vibrationtransmitter.html">Vibration Tx</a><a href="/zoneclassificationhelper.html">Zone Classification</a></div><div><a href="/baud-rate.html">Baud Rate Calculator</a><a href="/gascompressibility.html">Compressibility (Z)</a><a href="/dbcalculator.html">dB Gain/Loss Calc</a><a href="/flowprofiledistortioncalculator.html">Flow Distortion</a><a href="/impulselinefreezing.html">Impulse Freezing</a><a href="/intrinsic-safety.html">Intrinsic Safety Loop</a><a href="/measurement.html">Measurement Uncertainty</a><a href="/ph-temp-comp.html">pH Temp Compensation</a><a href="/plcscantime.html">PLC Scan Time</a><a href="/pressurereliefvalve.html">PRV Sizing (API 520)</a><a href="/reynoldsnumbercal.html">Reynolds Number</a><a href="/rtdselfheating.html">RTD Self-Heating</a><a href="/signal-scaling.html">Signal Scaling</a><a href="/staticheadcal.html">Static Head</a><a href="/temperaturesensorlag.html">Temp Sensor Lag</a><a href="/thermowell-wake.html">Thermowell Wake</a><a href="/ultrasoniclevel.html">Ultrasonic Level</a><a href="/valve-cv.html">Valve Cv Viewer</a><a href="/wetlegdensitycompensation.html">Wet Leg Compensation</a></div><div><a href="/capacitance-level.html">Capacitance Level</a><a href="/controlvalvenoise.html">Control Valve Noise</a><a href="/dp-flow-conversion.html">DP Flow Conversion</a><a href="/hartdevices.html">HART Devices</a><a href="/impulse-pressure-drop.html">Impulse Pressure Drop</a><a href="/junctionbox.html">Junction Box Sizing</a><a href="/orifice-flow.html">Orifice Flow Calculator</a><a href="/pid-symbol-library.html">PID Symbol Library</a><a href="/power-supply-load.html">Power Supply Load</a><a href="/prvsizing.html">Relief Orifice Area</a><a href="/rtdexcitationcurrentselection.html">RTD Excitation</a><a href="/rtd-tc-conversion.html">RTD/TC Conversion</a><a href="/sil.html">SIL Calculator</a><a href="/steamflow.html">Steam Flow</a><a href="/thermocouplecjccalculator.html">Thermocouple CJC</a><a href="/turndown.html">Turndown Ratio</a><a href="/controlvalveauthority.html">Valve Authority</a><a href="/controlvalveleakage.html">Valve Leakage Class</a><a href="/wirelesshart.html">WirelessHART Range</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexinst.html" class="view-all-link">View All Instrumentation Tools â†’</a>
            </div>
        </div>
    </li>
                        
    <li class="dropdown">
        <a href="/indexmech.html" class="dropdown-toggle">Mechanical <i class="fas fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
        <div class="dropdown-menu">
            <div class="repo-grid"><div><a href="/aircompressorfad.html">Air Compressor FAD</a><a href="/asme-vessel.html">ASME Vessel Design</a><a href="/belt-pulley.html">Belt & Pulley</a><a href="/bolt-torque.html">Bolt Torque</a><a href="/controlvalveactuator.html">Control Valve Actuator</a><a href="/frictionfactortool.html">Darcy Friction Factor</a><a href="/fatigue.html">Fatigue Analysis</a><a href="/fuel-combustion.html">Fuel Combustion</a><a href="/gas.html">Gas Properties</a><a href="/heat-exchanger.html">Heat Exchanger</a><a href="/hydroliccylinder.html">Hydraulic Cylinder</a><a href="/material-compatibility.html">Material Compatibility</a><a href="/nozzle-reinforcement.html">Nozzle Reinforcement</a><a href="/openchannelflow.html">Open Channel Flow</a><a href="/pipescheduletool.html">Pipe Schedule & Stress</a><a href="/pump-head.html">Pump Head</a><a href="/shaft-power-torque.html">Shaft Power & Torque</a><a href="/steam-table.html">Steam Table</a><a href="/vibrationanalysis.html">Vibration Analysis</a></div><div><a href="/air-flow-duct.html">Air Flow Duct Sizing</a><a href="/beam-deflection.html">Beam Deflection</a><a href="/bernoulli-equation.html">Bernoulli Equation</a><a href="/chiller-capacity.html">Chiller Capacity</a><a href="/cooling-tower-sizing.html">Cooling Tower Sizing</a><a href="/darcy-weisbach.html">Darcy-Weisbach</a><a href="/finned-tube-heat-transfer.html">Finned Tube Heat</a><a href="/furnace-heat-duty.html">Furnace Heat Duty</a><a href="/gear-design.html">Gear Design</a><a href="/heat-loss-pipes.html">Heat Loss Pipes</a><a href="/jacketed-vessel-heat-transfer.html">Jacketed Vessel</a><a href="/metalweight.html">Metal Weight Calculator</a><a href="/nptbspthreadcalculator.html">NPT/BSP Threads</a><a href="/overall-heat-transfer.html">Overall Heat Transfer</a><a href="/pipe-stress-flexibility.html">Pipe Stress</a><a href="/pump-power.html">Pump Power</a><a href="/specific-heat-enthalpy.html">Specific Heat</a><a href="/storage-tank-volume.html">Storage Tank Volume</a><a href="/weldingstress.html">Welding Stress</a></div><div><a href="/allowable-stress-safety-factor.html">Allowable Stress</a><a href="/bearinglife.html">Bearing Life Calculator</a><a href="/boiler-efficiency.html">Boiler Efficiency</a><a href="/compressor-power.html">Compressor Power</a><a href="/corrosion-rate.html">Corrosion Rate</a><a href="/fan-laws.html">Fan Laws</a><a href="/foundation.html">Foundation Design</a><a href="/gas-laws.html">Gas Laws</a><a href="/hardness.html">Hardness Converter</a><a href="/conduction-convection-radiation.html">Heat Transfer Modes</a><a href="/machining.html">Machining Calculator</a><a href="/momentofinertia.html">Moment of Inertia</a><a href="/oring.html">O-Ring Sizing</a><a href="/pipe-flow.html">Pipe Flow Calculator</a><a href="/psychrometric.html">Psychrometric Calc</a><a href="/reynolds-number.html">Reynolds Number</a><a href="/spring.html">Spring Design</a><a href="/thermal-expansion.html">Thermal Expansion</a></div>
            </div>
            <div class="view-all-container">
                <a href="/indexmech.html" class="view-all-link">View All Mechanical Tools â†’</a>
            </div>
        </div>
    </li>
                        <li><a href="/index.html#articles">Articles</a></li>
                        <li><a href="/sitemap2.html">Site Map</a></li>
                    </ul>

                    <div class="theme-toggle">
                        <i class="fas fa-sun icon"></i>
                        <label class="switch">
                            <input type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                        <i class="fas fa-moon icon"></i>
                    </div>
                </div>
            </nav>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-filter"></i> Master Control Valve Leakage Calculator</h2>
            <div class="tool-description">
                <p>Heavy-Duty Instrumentation Tool for <strong>Power, Chemical, and Oil & Gas</strong> sectors. Rigorous
                    calculation of Seat Leakage Limits per <strong>ANSI/FCI 70-2</strong> and <strong>IEC
                        60534-4</strong>. Covers all classes (II-VI) with detailed forensic breakdowns.</p>
            </div>

            <!-- Tool Switcher -->
            <div class="tool-switcher">
                <button class="tool-btn active" onclick="switchTool('general')"><i class="fas fa-calculator"></i> Class
                    II/III/IV/V</button>
                <button class="tool-btn" onclick="switchTool('class6')"><i class="fas fa-tint"></i> Class VI (Soft
                    Seat)</button>
            </div>

            <!-- Visualizer -->
            <div class="viz-container">
                <canvas id="leakCanvas"></canvas>
            </div>

            <!-- MODULE 1: GENERAL CLASSES (II, III, IV, V) -->
            <div id="mod-general" class="tool-module active">
                <div class="form-row">
                    <div class="form-group">
                        <label>Leakage Class</label>
                        <select id="lk-class" onchange="updateInputs()">
                            <option value="II">Class II (0.5% - Standard)</option>
                            <option value="III">Class III (0.1% - Improved)</option>
                            <option value="IV">Class IV (0.01% - Metal Tight)</option>
                            <option value="V">Class V (Critical Metal Seat)</option>
                        </select>
                    </div>
                </div>

                <!-- Input for II, III, IV -->
                <div class="form-row" id="grp-cv">
                    <div class="form-group">
                        <label>Valve Rated Capacity ($C_v$)</label>
                        <input type="number" id="inp-cv" value="100">
                    </div>
                    <div class="form-group">
                        <label>Test Medium</label>
                        <select id="inp-medium">
                            <option value="air">Air / Nitrogen (Standard Gas)</option>
                            <option value="water">Water (Hydraulic)</option>
                        </select>
                    </div>
                </div>

                <!-- Input for Class V -->
                <div class="form-row" id="grp-v" style="display:none;">
                    <div class="form-group">
                        <label>Seat/Port Diameter [inch]</label>
                        <input type="number" id="inp-port" value="2.0">
                    </div>
                    <div class="form-group">
                        <label>Differential Pressure ($\Delta P$) [psi]</label>
                        <input type="number" id="inp-dp" value="50">
                        <p style="font-size:0.75rem; color:var(--text); margin-top:2px;">Service or Test dP (Max 100 psi
                            for Air)</p>
                    </div>
                </div>

                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcLeakage()">Calculate Forensic Analysis</button>
                </div>
            </div>

            <!-- MODULE 2: CLASS VI (SOFT SEAT) -->
            <div id="mod-class6" class="tool-module">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nominal Port Diameter</label>
                        <select id="c6-size">
                            <option value="1">≤ 1 inch (DN 25)</option>
                            <option value="1.5">1.5 inch (DN 40)</option>
                            <option value="2">2 inch (DN 50)</option>
                            <option value="2.5">2.5 inch (DN 65)</option>
                            <option value="3">3 inch (DN 80)</option>
                            <option value="4">4 inch (DN 100)</option>
                            <option value="6">6 inch (DN 150)</option>
                            <option value="8">8 inch (DN 200)</option>
                            <option value="10">≥ 10 inch (DN 250)</option>
                        </select>
                    </div>
                </div>

                <div class="button-wrapper">
                    <button type="button" class="btn" onclick="calcClass6()">Verify Class VI Limits</button>
                </div>
            </div>

            <!-- RESULTS -->
            <div class="result-box" id="main-result" style="display:none;">
                <div class="sub-value" id="res-subtitle">Max Allowable Leakage</div>
                <div id="res-main" class="main-value">--</div>

                <div class="res-grid">
                    <div class="res-item">
                        <div class="res-label">Governing Standard</div>
                        <div class="res-val" id="res-std">ANSI/FCI 70-2</div>
                    </div>
                    <div class="res-item">
                        <div class="res-label">Leakage Class</div>
                        <div class="res-val" id="res-cls">--</div>
                    </div>
                    <div class="res-item">
                        <div class="res-label" id="lbl-metric">Volumetric Rate (ml/min)</div>
                        <div class="res-val" id="res-ml">--</div>
                    </div>
                    <div class="res-item">
                        <div class="res-label" id="lbl-imperial">Equivalent Bubbles/min</div>
                        <div class="res-val" id="res-scfh">--</div>
                    </div>
                    <div class="res-item">
                        <div class="res-label">Test Condition</div>
                        <div class="res-val" id="res-test">--</div>
                    </div>
                </div>

                <div class="calc-steps" id="calc-steps-box"></div>
            </div>

            <div class="button-wrapper" style="margin-top:40px;">
                <button type="button" id="pdf-btn" class="btn btn-outline"><i class="fas fa-file-pdf"></i> Download
                    Certification Report</button>
            </div>
        </div>

        <!-- EDUCATIONAL SECTION -->
        <div class="card education-section" style="margin-top: 40px;">
            <h2><i class="fas fa-book-open"></i> Engineering Guide: Valve Seat Integrity</h2>
            <div class="article-content">

                <div class="article-block">
                    <h3>1. The Critical Role of Seat Leakage</h3>
                    <p>In process plants, control valves are the final element of the control loop. While their primary
                        job is to throttle, they are often expected to shut off flow completely. However, "zero leakage"
                        is a myth in metal-seated valves. <strong>Leakage Class</strong> defines the quantifiable,
                        allowable passing rate. Specifying the wrong class (e.g., Class IV for a Fuel Gas Shutoff) can
                        lead to hazardous accumulation, burner trips, or product contamination. Conversely,
                        over-specifying (Class VI for everything) drives up cost and maintenance due to fragile soft
                        seats.</p>
                </div>

                <div class="article-block">
                    <h3>2. Detailed Hierarchy of Leakage Classes (ANSI/FCI 70-2)</h3>
                    <ul>
                        <li><strong>Class II (0.5% of Capacity):</strong> Used for double-port or balanced cage valves
                            where tight shutoff is physically impossible due to thermal expansion differences. Suitable
                            for continuous throttling where the valve never sits closed.</li>
                        <li><strong>Class III (0.1% of Capacity):</strong> An improvement over Class II, often achieved
                            by lapping or spring-loaded seals.</li>
                        <li><strong>Class IV (0.01% of Capacity):</strong> The "Industry Standard" for single-seat metal
                            valves. Achieved by precision machining and moderate actuator thrust. Suitable for most
                            steam, water, and process loops.</li>
                        <li><strong>Class V (5 x 10<sup>-4</sup> ml/min/in/psi):</strong> A critical metal-seat
                            standard. Requires expensive lapping (blue-checking) and high actuator thrust (typically
                            >100 lbs/linear inch of seat). Used for high-pressure steam, feedwater, or severe service
                            where soft seats would melt or erode.</li>
                        <li><strong>Class VI (Bubble Tight):</strong> Reserved for Soft Seats (Teflon, PEEK, Viton). It
                            allows nominal leakage expressed in bubbles per minute. Used for isolation-grade control
                            valves, gas fuel, and oxygen service.</li>
                    </ul>
                </div>

                <div class="article-block">
                    <h3>3. Isolation vs. Control: API 598 vs FCI 70-2</h3>
                    <p>A common industrial error is confusing <strong>Isolation Valve standards (API 598)</strong> with
                        <strong>Control Valve standards (FCI 70-2)</strong>.
                    </p>
                    <div class="highlight-box">
                        <ul>
                            <li><strong>API 598:</strong> Applies to Gate, Globe, Ball, and Butterfly valves used for
                                On/Off isolation. It generally requires "Zero Visible Leakage" for soft seats and very
                                low drops for metal seats.</li>
                            <li><strong>FCI 70-2:</strong> Applies to Control Valves. It is much more lenient because
                                control valves are designed to move constantly, which wears the seat. A Class IV control
                                valve leaks significantly more than an API 598 Gate valve. <strong>Do not use a Control
                                    Valve as a Safety Isolation Valve (ESD) unless specifically designed for TSO (Tight
                                    Shut Off).</strong></li>
                        </ul>
                    </div>
                </div>

                <div class="article-block">
                    <h3>4. Actuator Stiffness & Seat Load</h3>
                    <p>Achieving Class V or VI tightness is not just about the valve; it's about the actuator. The
                        actuator must provide sufficient <strong>Seat Load</strong> (lbs force) to deform the seat
                        asperities. For Class IV, roughly 20-40 lbs per linear inch of seat circumference is needed. For
                        Class V, this jumps to >100 lbs/inch. If the air supply drops or the spring is weak, the valve
                        will leak regardless of how new it is.</p>
                </div>

                <div class="article-block">
                    <h3>5. Troubleshooting & Maintenance</h3>
                    <p>If a valve fails a leakage test:</p>
                    <ul>
                        <li><strong>Check Zero:</strong> Is the positioner holding the valve slightly open?</li>
                        <li><strong>Check Seat Damage:</strong> Wire drawing (erosion) cuts channels in metal seats.
                        </li>
                        <li><strong>Check Debris:</strong> Welding slag or tape caught in the seat.</li>
                        <li><strong>Lapping:</strong> For metal seats, use fine grit compound to mate the plug and seat
                            ring.</li>
                    </ul>
                </div>

                <div class="article-block">
                    <h3>6. Frequently Asked Questions (FAQ)</h3>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">1. What is ANSI/FCI 70-2? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">ANSI/FCI 70-2 (formerly ASME B16.104) is the standard that defines six
                            seat leakage classification categories for control valves, establishing maximum allowable
                            leakage rates for specific test procedures.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">2. What is the difference between Class IV
                            and Class VI? <i class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Class IV is a "Metal-to-Metal" seat standard allowing 0.01% of rated
                            capacity leakage. Class VI is a "Soft Seat" standard (bubble-tight) where leakage is
                            measured in bubbles per minute or milliliters per minute, significantly tighter than Class
                            IV.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">3. How is Class V leakage calculated? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Class V is usually for critical metal seats. Allowable leakage is 5 x
                            10^-4 ml of water per minute per inch of port diameter per psi differential pressure. It
                            requires high-pressure water testing.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">4. Can I use Class VI for metal seats? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">It is extremely difficult and expensive to achieve Class VI tightness
                            with metal seats (requires lapping to optical flatness). Class VI is generally reserved for
                            soft seats (Teflon, PEEK, etc.).</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">5. What test medium is used for Class IV? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Class IV is typically tested with Air or Water at 45-60 psig (3-4 bar)
                            or the maximum operating differential pressure, whichever is lower.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">6. How many bubbles per ml? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">The standard generally assumes approximately 4 to 15 bubbles per ml
                            depending on the tubing size, but ANSI/FCI 70-2 defines Class VI explicitly in both "Bubbles
                            per Minute" and "ml per Minute" to avoid ambiguity.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">7. Does this tool support IEC 60534-4? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Yes, IEC 60534-4 generally aligns with ANSI/FCI 70-2 for leakage
                            classes. The calculations provided here satisfy both standards.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">8. What is "Rated Capacity"? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Rated Capacity refers to the valve's Cv (or Kv) at 100% open. For Class
                            II, III, and IV, the leakage limit is a percentage of this total flow capacity.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">9. Why do bubbles vary in size? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">Bubble size depends on the ID of the tubing submerged in water. ANSI/FCI
                            70-2 specifies a 1/4 inch OD (0.032" wall) tube submerged 1/8 to 1/2 inch deep to
                            standardize bubble volume.</div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">10. What is TSO (Tight Shut Off)? <i
                                class="fas fa-chevron-down faq-icon"></i></div>
                        <div class="faq-answer">TSO is an industry term often synonymous with Class VI or Class V,
                            implying the valve provides a reliable stop to flow, unlike standard throttling valves which
                            may leak slightly even when closed.</div>
                    </div>

                </div>
            </div>
        </div>
    </main>

        <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <a href="/" class="footer-logo">
                        <img src="logo.png" alt="Design Calculators Logo" loading="lazy" decoding="async">
                        <span class="footer-logo-text">Design Calculators</span>
                    </a>
                    <p class="footer-description">A comprehensive engineering calculator hub based on IEC, IEEE, and
                        global standards.</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn linkedin"
                            aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer"
                            class="social-btn youtube" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in&text=Check%20out%20this%20amazing%20engineering%20calculator%20hub!"
                            target="_blank" rel="noopener noreferrer" class="social-btn twitter" aria-label="Twitter"><i
                                class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn facebook"
                            aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource:%20https://designcalculators.co.in"
                            target="_blank" rel="noopener noreferrer" class="social-btn whatsapp"
                            aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-right">
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href='/indexele.html'>Electrical Tools</a></li>
                            <li><a href='/indexmech.html'>Mechanical Tools</a></li>
                            <li><a href='/indexinst.html'>Instrumentation Tools</a></li>
                            <li><a href='/about.html'>About Us</a></li>
                            <li><a href='/faq.html'>FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Learn More</h4>
                        <ul>
                            <li><a href="https://www.youtube.com/@designcalculators" target="_blank"
                                    rel="noopener noreferrer">YouTube Channel</a></li>
                            <li><a href='/contact.html'>Contact Us</a></li>
                            <li><a href='/privacy-policy.html'>Privacy Policy</a></li>
                            <li><a href='/terms-of-service.html'>Terms of Service</a></li>
                            <li><a href='/sitemap2.html'>Sitemap</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Our Network</h4>
                        <ul>
                            <li style="margin-bottom: 12px;">
                                <a href="https://reliabilitytools.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">Reliability Tools</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Reliability
                                    & maintenance engineering calculators.</span>
                            </li>
                            <li style="margin-bottom: 12px;">
                                <a href="https://electrosafe.homes/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">ElectroSafe</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Dedicated
                                    to home electrical safety & protection.</span>
                            </li>
                            <li>
                                <a href="https://knowyourname.co.in/" target="_blank" rel="noopener"
                                   style="font-weight: 600; display: block; margin-bottom: 2px;">KnowYourName</a>
                                <span style="font-size: 0.85rem; color: #94a3b8; line-height: 1.3; display: block;">Scientific
                                    name analysis: Phonetics, Ergonomics & Acoustics.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all applicable local and international standards (including but not limited to ASHRAE 90.1, ARI 550/590). Always verify calculations and consult with a licensed professional engineer before implementation or construction.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">Anil Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global State
        let lastResult = {};
        let canvas = document.getElementById('leakCanvas');
        let ctx = canvas.getContext('2d');

        // Class VI Table (ANSI 70-2)
        // Key: Port Size (in). Values: [bubbles/min, ml/min]
        const CLASS6_DATA = {
            "1": { bubbles: 1, ml: 0.15 },
            "1.5": { bubbles: 2, ml: 0.30 },
            "2": { bubbles: 3, ml: 0.45 },
            "2.5": { bubbles: 4, ml: 0.60 },
            "3": { bubbles: 6, ml: 0.90 },
            "4": { bubbles: 11, ml: 1.70 },
            "6": { bubbles: 27, ml: 4.00 },
            "8": { bubbles: 45, ml: 6.75 },
            "10": { bubbles: 63, ml: 9.45 } // For 8+ generally extrapolate or follow manu
        };

        // UI Logic
        document.addEventListener('DOMContentLoaded', () => {
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if (themeSwitch) {
                themeSwitch.addEventListener('change', function () {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                });
            }
            document.getElementById('pdf-btn').addEventListener('click', generatePDF);
            updateInputs();

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Draw placeholder visual
            drawBubbles(0);
        });

        function switchTool(toolId) {
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.querySelectorAll('.tool-module').forEach(m => m.classList.remove('active'));
            document.getElementById('mod-' + toolId).classList.add('active');
            document.getElementById('main-result').style.display = 'none';
        }

        function toggleFaq(element) {
            const item = element.parentElement;
            item.classList.toggle('active');
        }

        function updateInputs() {
            const cls = document.getElementById('lk-class').value;
            const grpCV = document.getElementById('grp-cv');
            const grpV = document.getElementById('grp-v');

            if (cls === 'V') {
                grpCV.style.display = 'none';
                grpV.style.display = 'grid';
            } else {
                grpCV.style.display = 'grid';
                grpV.style.display = 'none';
            }
        }

        function resizeCanvas() {
            const container = document.querySelector('.viz-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            if (lastResult.bubbles) drawBubbles(lastResult.bubbles);
            else drawBubbles(0); // Reset
        }

        // --- VISUALIZER ---
        function drawBubbles(count) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const w = canvas.width;
            const h = canvas.height;

            // Background Water
            const grad = ctx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, '#E0F2FE');
            grad.addColorStop(1, '#0EA5E9');
            ctx.fillStyle = grad;
            ctx.fillRect(0, h / 2, w, h / 2); // Half water

            // Tube
            ctx.fillStyle = '#64748B';
            ctx.fillRect(w / 2 - 10, 0, 20, h / 2 + 20); // Down tube

            // Bubbles
            if (count > 0) {
                // Determine density visually (max 63 bubbles standard)
                // Draw random bubbles rising
                const visualCount = Math.min(count, 50);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';

                for (let i = 0; i < visualCount; i++) {
                    const x = w / 2 + (Math.random() - 0.5) * 40;
                    const y = h / 2 + 20 + Math.random() * (h / 2 - 40);
                    const r = 3 + Math.random() * 4;

                    ctx.beginPath();
                    ctx.arc(x, y, r, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();
                }

                ctx.fillStyle = '#1E3A8A';
                ctx.font = 'bold 20px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(`${count} Bubbles / min`, w / 2, h - 20);
            } else {
                ctx.fillStyle = '#64748B';
                ctx.font = '16px Inter';
                ctx.textAlign = 'center';
                ctx.fillText("Select Class VI to see bubbles", w / 2, h - 20);
            }
        }

        // --- MATH ENGINE ---

        function calcLeakage() {
            const cls = document.getElementById('lk-class').value;
            let leakage = 0;
            let unit = "";
            let steps = "";
            let testDesc = "";
            let bubbles = 0; // Visual only

            if (cls === 'V') {
                const dia = parseFloat(document.getElementById('inp-port').value);
                const dp = parseFloat(document.getElementById('inp-dp').value);

                // Formula: 0.0005 ml/min * dia * dp
                leakage = 0.0005 * dia * dp;
                unit = "ml/min (Water)";
                testDesc = `Water @ ${dp} psi dP`;

                steps = `<h4>Class V Forensic Breakdown</h4>
                <div class="step-block">
                    <span class="step-title">Step 1: Identify Parameters</span>
                    Class: <strong>V (Critical Metal Seat)</strong><br>
                    Seat Diameter ($D$): ${dia} inches<br>
                    Differential Pressure ($\Delta P$): ${dp} psi
                </div>
                <div class="step-block">
                    <span class="step-title">Step 2: Select Standard Formula</span>
                    Standard: ANSI/FCI 70-2 Section 5.4<br>
                    Formula: $L_{max} = 5 \times 10^{-4} \times D \times \Delta P$
                </div>
                <div class="step-block">
                    <span class="step-title">Step 3: Execute Calculation</span>
                    $L = 0.0005 \times ${dia} \times ${dp}$
                </div>
                <div class="step-block">
                    <span class="step-title">Step 4: Final Result</span>
                    Allowable Leakage = <strong>${leakage.toFixed(4)} ml/min</strong>
                </div>
                <div class="step-block">
                    <span class="step-title">Step 5: Test Requirements</span>
                    Medium: Clean Water at 10-52°C.<br>
                    Procedure: Maintain $\Delta P$ for minimum 1 minute.
                </div>`;

            } else {
                const cv = parseFloat(document.getElementById('inp-cv').value);
                const medium = document.getElementById('inp-medium').value;
                let pct = 0;

                if (cls === 'II') pct = 0.005; // 0.5%
                if (cls === 'III') pct = 0.001; // 0.1%
                if (cls === 'IV') pct = 0.0001; // 0.01%

                const allowableCv = cv * pct;
                const testDP = 50; // Standard shop test dP

                let leakageFlow = 0;
                let flowUnit = "";
                let mediumSteps = "";

                if (medium === 'water') {
                    // Q = Cv * sqrt(dP)
                    leakageFlow = allowableCv * Math.sqrt(testDP); // GPM
                    let mlMin = leakageFlow * 3785.41;
                    unit = "ml/min";
                    leakage = mlMin;
                    testDesc = "Water @ 50 psi";

                    mediumSteps = `<div class="step-block">
                        <span class="step-title">Step 5: Hydraulic Conversion (Water)</span>
                        Standard Test Pressure: 50 psi (approx 3.5 bar)<br>
                        Formula: $Q_{GPM} = C_{v,leak} \times \sqrt{\Delta P}$<br>
                        $Q = ${allowableCv.toFixed(5)} \times \sqrt{50} = ${(allowableCv * 7.071).toFixed(5)} \text{ GPM}$
                    </div>
                    <div class="step-block">
                        <span class="step-title">Step 6: Metric Unit Conversion</span>
                        $1 \text{ GPM} = 3785.41 \text{ ml/min}$<br>
                        $L = ${(allowableCv * 7.071).toFixed(5)} \times 3785.41 = \mathbf{${mlMin.toFixed(2)} \text{ ml/min}}$
                    </div>`;
                } else {
                    // Air @ 50 psi
                    // Simplified estimate for leakage context: Q(scfh) ~ Cv * 22 ? 
                    // Let's use basic compressible flow estimate for small dP/P ratio, but dP=50 is high.
                    // Critical flow P1 = 14.7+50 = 64.7 psia. P2 = 14.7. Ratio < 0.5. CHOKED.
                    // Q(scfm) approx = Cv * P1 / 2 (Rule of thumb for critical air).
                    // Q(scfm) = allowableCv * 64.7 / 2 approx 32 * Cv.
                    // Q(scfh) = 60 * 32 * Cv = 1900 * Cv.
                    // Wait, standard air test usually assumes 45-60 psi.
                    // Let's stick to reporting the ALLOWABLE Cv coefficient which is the legal definition, 
                    // but provide the estimated flow for operator convenience.
                    // Using industry factor ~ 1 SCFM air per 1 Cv at standard drop? No.
                    // Let's use: Q(scfh) = 0.471 * N2 * Cv * P1 * sqrt(1/G*T) ??
                    // To keep it robust, we report Cv and a generic air equivalent.
                    // Equivalent Air Flow (SCFH) ~ 30 * AllowableCv (at 50psi).

                    let scfh = allowableCv * 30; // Approx
                    leakage = scfh;
                    unit = "SCFH (Air approx)";
                    testDesc = "Air @ 50 psi";

                    mediumSteps = `<div class="step-block">
                        <span class="step-title">Step 5: Pneumatic Conversion (Air)</span>
                        Test Medium: Air at 50 psig (Critical Flow Regime likely).<br>
                        Est. Flow Factor: ~30 SCFH per Cv (Approx).<br>
                        $Q \approx ${allowableCv.toFixed(5)} \times 30 = \mathbf{${scfh.toFixed(3)} \text{ SCFH}}$
                    </div>`;
                }

                steps = `<h4>Class ${cls} Forensic Breakdown</h4>
                <div class="step-block">
                    <span class="step-title">Step 1: Input Data Verification</span>
                    Rated Capacity ($C_v$): ${cv}<br>
                    Selected Class: ${cls} (Metal Seat Standard)
                </div>
                <div class="step-block">
                    <span class="step-title">Step 2: Determine Leakage Fraction</span>
                    Class ${cls} Limit: <strong>${pct * 100}%</strong> of Rated Capacity.
                </div>
                <div class="step-block">
                    <span class="step-title">Step 3: Calculate Leakage Coefficient</span>
                    $C_{v,leak} = C_{v,rated} \times \text{Percentage}$<br>
                    $C_{v,leak} = ${cv} \times ${pct} = \mathbf{${allowableCv.toFixed(5)}}$
                </div>
                <div class="step-block">
                    <span class="step-title">Step 4: Physical Interpretation</span>
                    This $C_{v,leak}$ represents the equivalent open orifice area when the valve is fully closed.
                </div>
                ${mediumSteps}
                <div class="step-block">
                    <span class="step-title">Step 7: Acceptance Criteria</span>
                    Any flow rate below the calculated value is <strong>PASS</strong>.
                </div>`;
            }

            // Results
            document.getElementById('main-result').style.display = 'block';
            document.getElementById('res-subtitle').innerText = `Class ${cls} Allowable Limit`;
            document.getElementById('res-main').innerText = `${leakage.toFixed(3)} ${unit}`;

            document.getElementById('res-cls').innerText = `Class ${cls}`;
            document.getElementById('res-ml').innerText = unit.includes('ml') ? leakage.toFixed(2) : "Calculated above";
            document.getElementById('res-scfh').innerText = "N/A (Use Class VI for bubbles)";
            document.getElementById('res-test').innerText = testDesc;

            document.getElementById('calc-steps-box').innerHTML = steps;
            if (window.MathJax) window.MathJax.typesetPromise();

            drawBubbles(0); // Clear bubbles
            lastResult = { cls, val: leakage, unit, steps };
        }

        function calcClass6() {
            const size = document.getElementById('c6-size').value;
            const data = CLASS6_DATA[size];

            if (!data) return alert("Data error");

            const bubbles = data.bubbles;
            const ml = data.ml;

            // Results
            document.getElementById('main-result').style.display = 'block';
            document.getElementById('res-subtitle').innerText = "Class VI Bubble Limit";
            document.getElementById('res-main').innerText = `${bubbles} Bubbles / min`;

            document.getElementById('res-cls').innerText = "Class VI (Soft Seat)";
            document.getElementById('res-ml').innerText = `${ml} ml/min`;
            document.getElementById('res-scfh').innerText = `${bubbles} Bubbles/min`;
            document.getElementById('res-test').innerText = "Air/Nitrogen @ 50 psig";

            let steps = `<h4>Class VI Forensic Breakdown (ANSI 70-2 Table 2)</h4>
            <div class="step-block">
                <span class="step-title">Step 1: Valve Geometry</span>
                Nominal Port Diameter: <strong>${size}"</strong> (DN ${size * 25}).
            </div>
            <div class="step-block">
                <span class="step-title">Step 2: Seat Type Verification</span>
                Standard Requirement: Resilient (Soft) Seat (e.g., PTFE, Buna-N).<br>
                <em>Class VI is rarely applicable to metal seats due to tightness requirements.</em>
            </div>
            <div class="step-block">
                <span class="step-title">Step 3: Test Pressure Definition</span>
                Standard Test Pressure: 50 psig (3.4 bar) or Max Operating $\Delta P$ (if lower).
            </div>
            <div class="step-block">
                <span class="step-title">Step 4: Actuator Force</span>
                Actuator must be adjusted to standard operating thrust settings (not over-torqued for test).
            </div>
            <div class="step-block">
                <span class="step-title">Step 5: Lookup Table Retrieval</span>
                Accessing ANSI/FCI 70-2 Table 2 Row for ${size}"...
            </div>
            <div class="step-block">
                <span class="step-title">Step 6: Bubble Count Limit</span>
                Max Allowable: <strong>${bubbles} Bubbles per minute</strong>.
            </div>
            <div class="step-block">
                <span class="step-title">Step 7: Volumetric Equivalent</span>
                Standard Conversion: <strong>${ml} ml per minute</strong>.
            </div>
            <div class="step-block">
                <span class="step-title">Step 8: Evaluation Logic</span>
                Count bubbles over 1 minute duration. If Count $\le$ ${bubbles}, Result = <strong>PASS</strong>.
            </div>`;

            document.getElementById('calc-steps-box').innerHTML = steps;

            drawBubbles(bubbles);
            lastResult = { cls: 'VI', val: bubbles, unit: 'Bubbles/min', steps, bubbles };
        }

        function generatePDF() {
            if (!lastResult.val) { alert("Calculate first!"); return; }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(18); doc.setTextColor(30, 58, 138);
            doc.text("Valve Leakage Test Certification", 14, 20);

            doc.setFontSize(12); doc.setTextColor(0);
            doc.text(`Leakage Class: ${lastResult.cls}`, 14, 40);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 14, 50);

            doc.setDrawColor(30, 58, 138);
            doc.setLineWidth(0.5);
            doc.line(14, 55, 196, 55);

            doc.setFontSize(14);
            doc.text(`Allowable Leakage: ${lastResult.val} ${lastResult.unit}`, 14, 65);

            if (lastResult.bubbles) {
                // Add canvas image
                const imgData = canvas.toDataURL("image/png");
                doc.addImage(imgData, 'PNG', 15, 80, 100, 50);
            }

            const stepsText = document.getElementById('calc-steps-box').innerText;
            // PDF text strip
            doc.text("Refer to digital record for full forensic steps.", 14, 140);

            doc.save('Leakage_Certification.pdf');
        }
    </script>
    <script src="/main.js"></script>
</body>

</html>
