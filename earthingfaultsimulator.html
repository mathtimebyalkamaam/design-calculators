<!DOCTYPE html>
<html lang="en">

<head>
    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
        crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>

    <!-- SEO Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Earthing Fault Simulator & IEEE 80 Compliance</title>
    <meta name="description"
        content="Industrial-grade Earthing Calculator. Features Schwarz's Formula, Frequency-Dependent Impedance, Decrement Factor (X/R), and full IEEE 80-2013 Safety Compliance (Step/Touch).">
    <meta name="keywords"
        content="earthing calculator, IEEE 80 2013, ground grid design, GPR, step voltage, touch voltage, schwarz formula, decrement factor, soil resistivity, substation safety">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&family=Roboto+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js (UMD) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        /* --- CORE THEME (Standardized) --- */
        :root {
            --primary: #1E3A8A;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #DC2626;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card: #FFFFFF;
            --text: #4B5563;
            --heading: #111827;
            --footer-bg: #0F172A;
            --border: #E2E8F0;
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);

            /* Commercial Additions */
            --input-bg: #F1F5F9;
            --text-light: #64748b;
            --font-mono: 'Roboto Mono', monospace;
        }

        body.dark-mode {
            --primary: #10B981;
            --secondary: #34D399;
            --bg: #0F172A;
            --card: #1E293B;
            --text: #CBD5E1;
            --heading: #F1F5F9;
            --footer-bg: #020617;
            --border: #334155;
            --accent: #F59E0B;
            --input-bg: #0f172a;
            --text-light: #94a3b8;
        }

        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header & Nav */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-bottom: none;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }

        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }

        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            font-size: 1rem;
        }

        .nav-links a:hover {
            color: var(--accent);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.2);
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--accent);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        /* Content */
        main {
            padding: 40px 0;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }

        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }

        .tool-description {
            padding: 20px 0;
            background: transparent;
            color: var(--text);
            font-size: 1rem;
        }

        /* Inputs */
        .input-section {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 25px 20px 20px 20px;
            margin-bottom: 24px;
            position: relative;
        }

        .section-title {
            position: absolute;
            top: -12px;
            left: 16px;
            background: var(--card);
            padding: 0 10px;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid var(--border);
            border-radius: 4px;
        }

        body.dark-mode .section-title {
            background: var(--card);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 0;
            position: relative;
        }

        .form-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--card);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: var(--font-mono);
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .info-icon {
            color: var(--secondary);
            cursor: help;
            font-size: 0.9em;
            opacity: 0.7;
        }

        .tooltip-container {
            position: relative;
            display: inline-block;
        }

        .tooltip-container .tooltip-text {
            visibility: hidden;
            width: 240px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 100;
            bottom: 135%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            pointer-events: none;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-container .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        /* Buttons & Presets */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }

        .button-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            padding-top: 15px;
            gap: 15px;
        }

        .preset-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .preset-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-radius: 8px;
            overflow: hidden;
        }

        .results-table th,
        .results-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .results-table th {
            background: var(--grad);
            color: white;
            font-weight: 700;
        }

        .results-table tr:nth-child(even) {
            background-color: var(--bg);
        }

        .results-table td:first-child {
            font-weight: 600;
            color: var(--heading);
        }

        .results-table .val {
            font-family: var(--font-mono);
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            display: inline-block;
        }

        .status-pass {
            background: #dcfce7;
            color: #166534;
        }

        .status-fail {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Chart Container */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            height: 350px;
            width: 100%;
            margin-bottom: 20px;
        }

        /* Education */
        .education-section {
            margin-top: 50px;
        }

        .tech-article {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 40px;
            align-items: start;
        }

        @media (max-width: 800px) {
            .tech-article {
                grid-template-columns: 1fr;
            }
        }

        .toc-sticky {
            position: sticky;
            top: 20px;
            background: var(--bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .toc-sticky h4 {
            margin-top: 0;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
        }

        .toc-sticky ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .toc-sticky li {
            margin-bottom: 8px;
        }

        .toc-sticky a {
            text-decoration: none;
            color: var(--text);
            font-size: 0.95rem;
            transition: color 0.2s;
            display: block;
            padding: 4px 0;
        }

        .toc-sticky a:hover {
            color: var(--secondary);
            transform: translateX(5px);
        }

        .article-content h3 {
            color: var(--secondary);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 40px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .article-content p {
            line-height: 1.8;
            margin-bottom: 20px;
            font-size: 1.05rem;
            color: var(--text);
        }

        .highlight-box {
            background: rgba(37, 99, 235, 0.05);
            border-left: 4px solid var(--secondary);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
        }

        .formula {
            background: var(--bg);
            border-left: 3px solid var(--accent);
            padding: 15px;
            margin: 12px 0;
            font-size: 1.1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            color: var(--heading);
        }

        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(0, 0, 0, 0.03);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid var(--success);
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--heading);
        }

        /* Message */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }

        .message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }

        .hidden {
            display: none;
        }

        /* Footer */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-col {
            flex: 1;
            min-width: 200px;
        }

        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-col a:hover {
            color: var(--accent);
        }

        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .social-btn:hover {
            transform: translateY(-4px);
        }

        .social-btn.linkedin {
            background-color: #0A66C2;
        }

        .social-btn.youtube {
            background-color: #FF0000;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            .navbar {
                flex-direction: column;
                gap: 20px;
            }

            .nav-links {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 20px;
            }

            .footer-content {
                flex-direction: column;
                gap: 25px;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .tech-article {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <div id="message-box" class="message-box"></div>

    <header>
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles">Articles</a></li>
                    <li><a href="indexmech">Mechanical</a></li>
                    <li><a href="indexele">Electrical</a></li>
                    <li><a href="indexinst">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2><i class="fas fa-ground"></i> Earthing Fault Simulator (IEEE 80)</h2>

            <div class="tool-description">
                <p>Industrial-grade Substation Grounding analyzer. Uses <strong>Schwarz's Equations</strong> for
                    accurate Grid + Rod resistance modeling. Calculates <strong>Decrement Factor ($D_f$)</strong> for
                    asymmetrical faults and verifies <strong>Step/Touch Potentials</strong> against IEEE 80-2013 safety
                    limits based on body weight (50/70kg).</p>
            </div>

            <div class="calculator-form">

                <div class="form-group">
                    <label>Quick Presets:</label>
                    <div class="preset-container" style="margin-bottom: 0;">
                        <button type="button" class="preset-btn" onclick="loadPreset('small')"><i
                                class="fas fa-home"></i> Pole Mnt (10x10m)</button>
                        <button type="button" class="preset-btn" onclick="loadPreset('sub')"><i
                                class="fas fa-industry"></i> 66kV Sub (40x40m)</button>
                        <button type="button" class="preset-btn" onclick="loadPreset('hv')"><i class="fas fa-bolt"></i>
                            400kV Yard (120x120m)</button>
                    </div>
                </div>

                <!-- 1. Grid Parameters -->
                <div class="input-section">
                    <div class="section-title">1. Soil & Grid Geometry</div>
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="form-group">
                            <label>Soil Resistivity ($\rho$) ($\Omega \cdot m$) <div class="tooltip-container"><i
                                        class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Average soil
                                        resistivity. Wet: ~50, Dry: ~1000.</span></div></label>
                            <input type="number" id="soil-rho" value="100" step="10">
                        </div>
                        <div class="form-group">
                            <label>Surface Layer ($\rho_s$) ($\Omega \cdot m$) <div class="tooltip-container"><i
                                        class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Crushed rock
                                        resistivity (wet/dry). Typical: 2500-3000.</span></div></label>
                            <input type="number" id="surf-rho" value="2500" step="100">
                        </div>
                        <div class="form-group">
                            <label>Layer Thickness ($h_s$) (m)</label>
                            <input type="number" id="surf-h" value="0.15" step="0.05">
                        </div>
                    </div>

                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="form-group">
                            <label>Grid Length ($L_x$) (m)</label>
                            <input type="number" id="grid-lx" value="40" step="1">
                        </div>
                        <div class="form-group">
                            <label>Grid Width ($L_y$) (m)</label>
                            <input type="number" id="grid-ly" value="40" step="1">
                        </div>
                        <div class="form-group">
                            <label>Mesh Spacing ($D$) (m) <div class="tooltip-container"><i
                                        class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Distance
                                        between conductors.</span></div></label>
                            <input type="number" id="grid-D" value="5" step="0.5">
                        </div>
                    </div>

                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="form-group">
                            <label>Grid Depth ($h$) (m)</label>
                            <input type="number" id="grid-h" value="0.6" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>Rod Length ($L_r$) (m)</label>
                            <input type="number" id="rod-l" value="3.0" step="0.5">
                        </div>
                        <div class="form-group">
                            <label>Total Rods ($N_R$)</label>
                            <input type="number" id="rod-n" value="16" step="1">
                        </div>
                    </div>
                </div>

                <!-- 2. Fault Parameters -->
                <div class="input-section">
                    <div class="section-title">2. Fault & System Data</div>
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="form-group">
                            <label>Grid Current ($I_G$) (A) <div class="tooltip-container"><i
                                        class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Max fault
                                        current flowing into grid (after split factor).</span></div></label>
                            <input type="number" id="fault-i" value="10000" step="100">
                        </div>
                        <div class="form-group">
                            <label>System X/R Ratio <div class="tooltip-container"><i
                                        class="fas fa-info-circle info-icon"></i><span class="tooltip-text">Determines
                                        Decrement Factor ($D_f$) for asymmetrical faults.</span></div></label>
                            <input type="number" id="sys-xr" value="20" step="1">
                        </div>
                        <div class="form-group">
                            <label>Fault Duration ($t_f$) (s)</label>
                            <input type="number" id="fault-t" value="0.5" step="0.1">
                        </div>
                    </div>
                    <div class="form-row" style="grid-template-columns: 1fr 1fr;">
                        <div class="form-group">
                            <label>System Frequency (Hz)</label>
                            <select id="sys-freq">
                                <option value="50" selected>50 Hz (Standard)</option>
                                <option value="60">60 Hz (Standard)</option>
                                <option value="100000">100 kHz (Lightning)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Body Weight Std.</label>
                            <select id="body-wt">
                                <option value="50" selected>50 kg (IEEE Standard)</option>
                                <option value="70">70 kg (Industrial)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="button-wrapper">
                    <button type="button" class="btn btn-outline" onclick="window.print()"><i class="fas fa-print"></i>
                        Print Report</button>
                    <button type="button" id="calculate-btn" class="btn"><i class="fas fa-bolt"></i> Run
                        Simulation</button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="result-container" class="card hidden" style="margin-top: 40px;">
                <h3><i class="fas fa-poll"></i> Simulation Results</h3>

                <div class="results-grid">
                    <!-- Left Col: Safety -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 15px;">Safety Assessment (IEEE
                            80)</h4>

                        <div style="background:var(--input-bg); border-radius:8px; padding:15px; margin-bottom:15px;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                <span style="font-weight:600;">GPR (Grid Potential Rise):</span>
                                <span id="res-gpr" style="font-weight:800; color:var(--primary);">0 V</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                <span style="font-weight:600;">Grid Resistance ($R_g$):</span>
                                <span id="res-rg" style="font-weight:800;">0 Ω</span>
                            </div>
                            <div style="display:flex; justify-content:space-between;">
                                <span style="font-weight:600;">Decrement Factor ($D_f$):</span>
                                <span id="res-df" style="font-weight:800; color:var(--text);">1.0</span>
                            </div>
                        </div>

                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Actual (V)</th>
                                    <th>Limit (V)</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Touch Voltage ($E_t$)</td>
                                    <td id="val-touch" class="font-mono">0</td>
                                    <td id="lim-touch" class="font-mono">0</td>
                                    <td id="status-touch">-</td>
                                </tr>
                                <tr>
                                    <td>Step Voltage ($E_s$)</td>
                                    <td id="val-step" class="font-mono">0</td>
                                    <td id="lim-step" class="font-mono">0</td>
                                    <td id="status-step">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Right Col: Graphs -->
                    <div>
                        <h4 style="margin-top: 0; color: var(--primary); margin-bottom: 10px;">Voltage Profile (GPR
                            Decay)</h4>
                        <div class="chart-container">
                            <canvas id="gprChart"></canvas>
                        </div>

                        <h4 style="margin-top: 20px; color: var(--primary); margin-bottom: 10px;">Impedance vs Frequency
                            (Z)</h4>
                        <div class="chart-container">
                            <canvas id="freqChart"></canvas>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">Detailed
                    Calculations</h4>
                <div id="calculation-details"></div>
            </div>
        </div>

        <!-- EDUCATIONAL CONTENT -->
        <div class="education-section card">
            <div class="card-header" style="margin-bottom:25px;">
                <h2><i class="fas fa-book-reader"></i> The Invisible Mountain: Mastering Earthing Safety</h2>
            </div>

            <div class="tech-article">
                <div class="toc-sticky">
                    <h4>Chapters</h4>
                    <ul>
                        <li><a href="#intro">1. The Invisible Mountain (GPR)</a></li>
                        <li><a href="#physics">2. The Physiology of Shock</a></li>
                        <li><a href="#layer">3. The Crushed Rock Shield</a></li>
                        <li><a href="#step">4. The "High Jump" (Step Voltage)</a></li>
                        <li><a href="#touch">5. The "Deadly Handshake" (Touch)</a></li>
                        <li><a href="#transient">6. Lightning vs. Faults</a></li>
                    </ul>
                </div>

                <div class="article-content">
                    <div id="intro">
                        <h3>1. The Invisible Mountain (GPR)</h3>
                        <p>When a massive fault current ($I_G$) flows into the earth, it doesn't just disappear. The
                            earth has resistance ($R_g$). According to Ohm's Law ($V = I \times R$), pushing thousands
                            of amps into the ground creates a massive pressure spike called the <strong>Ground Potential
                                Rise (GPR)</strong>.</p>
                        <p>Imagine your substation is sitting on top of an "electrical volcano." At the moment of a
                            fault, the soil directly under the station might jump to 5,000V or 10,000V relative to the
                            "remote earth" (zero volts) a mile away. This voltage decays as you move away, creating a
                            cone-shaped "voltage funnel."</p>

                        <p>The danger isn't being at 10,000V (birds sit on power lines safely); the danger is bridging a
                            voltage <em>difference</em>.</p>
                    </div>

                    <div id="physics">
                        <h3>2. The Physiology of Shock</h3>
                        <p>Why do we calculate limits? The human heart is controlled by tiny electrical impulses. An
                            external current of just 50mA-100mA (0.1 Amps) is enough to disrupt this rhythm, causing
                            <strong>Ventricular Fibrillation</strong>—a fatal flutter of the heart muscles.</p>
                        <p>IEEE 80 defines the "safe" energy limit based on body weight. A 70kg person can withstand
                            more energy than a 50kg person. The formula $I_B = k / \sqrt{t_s}$ tells us that the faster
                            the fault clears ($t_s$), the higher the current we can briefly survive.</p>
                    </div>

                    <div id="layer">
                        <h3>3. The Crushed Rock Shield</h3>
                        <p>Have you noticed that all substations are covered in crushed rock (gravel)? It’s not for
                            aesthetics. It is a critical safety layer.</p>
                        <p>Wet soil is a good conductor ($\approx 100 \Omega \cdot m$). Wet gravel is a poor conductor
                            ($\approx 3000 \Omega \cdot m$). By standing on this high-resistance layer, you add a
                            massive "resistor" in series with your body. This limits the current that can flow up
                            through your feet during a fault, significantly increasing your safety margin.</p>
                    </div>

                    <div id="step">
                        <h3>4. The "Electrical High Jump" (Step Voltage)</h3>
                        <p>Step Voltage assumes you are walking across the substation during a fault. Because the GPR
                            decays with distance (the slope of the volcano), the ground potential at your left foot is
                            different from the potential at your right foot (1 meter apart).</p>
                        <p>This difference drives current up one leg and down the other. While painful, it is generally
                            less dangerous than Touch Voltage because the current path (leg-to-leg) bypasses the heart.
                            It’s like doing the splits on a voltage gradient.</p>
                    </div>

                    <div id="touch">
                        <h3>5. The "Deadly Handshake" (Touch Voltage)</h3>
                        <p>This is the killer. Imagine you are standing on the earth (potential = $V_{soil}$) and you
                            touch a metallic fence or equipment frame bonded to the grid (potential = GPR).</p>
                        <p>You are now the bridge between the full GPR and the local soil potential. Current flows
                            through your hand, straight through your chest (heart), and out your feet. This is why Touch
                            Voltage limits are much stricter than Step Voltage limits.</p>
                    </div>

                    <div id="transient">
                        <h3>6. Lightning vs. Faults (Frequency Matters)</h3>
                        <p>Standard faults happen at 50/60Hz. The grid acts like a resistor. However, lightning is a
                            high-frequency impulse (equivalent to 100kHz+).</p>
                        <p>At these speeds, the <strong>inductance ($L$)</strong> of the copper conductors becomes
                            dominant ($X_L = 2\pi f L$). A grounding grid that looks like $0.5\Omega$ to a 50Hz fault
                            might look like $50\Omega$ to a lightning strike. The "effective" grid shrinks because the
                            impulse can't travel to the far ends of the mesh before the event is over. This simulator
                            calculates that impedance rise ($Z$).</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p>Providing commercial-grade tools for electrical engineering professionals. Validated against
                        international standards.</p>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele">Electrical</a></li>
                        <li><a href="indexmech">Mechanical</a></li>
                        <li><a href="indexinst">Instrumentation</a></li>
                        <li><a href="articles">Articles</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about">About Us</a></li>
                        <li><a href="contact">Contact</a></li>
                        <li><a href="faq">FAQ</a></li>
                        <li><a href="privacy-policy">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles'>Articles & Whitepapers</a></li>
                        <li><a href="sitemap.html">Sitemap</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <p>All calculations are for preliminary engineering design guidance. Final designs must comply with all
                    applicable local and international standards. Always verify calculations with a licensed
                    professional engineer.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span
                        style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch && localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            if (themeSwitch) {
                themeSwitch.addEventListener('change', function () {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', this.checked ? 'dark' : 'light');
                    updateChartTheme();
                });
            }
            document.getElementById('calculate-btn').addEventListener('click', calculate);
        });

        function loadPreset(key) {
            const s = {
                'small': { rho: 100, srho: 2500, sh: 0.1, lx: 10, ly: 10, d: 2.5, h: 0.5, i: 1000, t: 0.5, f: 50, nr: 4, rl: 3 },
                'sub': { rho: 50, srho: 3000, sh: 0.15, lx: 40, ly: 40, d: 5, h: 0.5, i: 10000, t: 0.5, f: 50, nr: 16, rl: 3 },
                'hv': { rho: 200, srho: 3000, sh: 0.2, lx: 100, ly: 100, d: 8, h: 0.8, i: 25000, t: 0.5, f: 50, nr: 40, rl: 3 }
            };
            const d = s[key];
            if (d) {
                document.getElementById('soil-rho').value = d.rho;
                document.getElementById('surf-rho').value = d.srho;
                document.getElementById('surf-h').value = d.sh;
                document.getElementById('grid-lx').value = d.lx;
                document.getElementById('grid-ly').value = d.ly;
                document.getElementById('grid-D').value = d.d;
                document.getElementById('grid-h').value = d.h;
                document.getElementById('fault-i').value = d.i;
                document.getElementById('fault-t').value = d.t;
                document.getElementById('sys-freq').value = d.f;
                document.getElementById('rod-n').value = d.nr;
                document.getElementById('rod-l').value = d.rl;
                calculate(); // Auto run
            }
        }

        let gprChart = null;
        let freqChart = null;

        function calculate() {
            // 1. Gather Inputs
            const Rho = parseFloat(document.getElementById('soil-rho').value);
            const Rho_s = parseFloat(document.getElementById('surf-rho').value);
            const h_s = parseFloat(document.getElementById('surf-h').value);
            const Lx = parseFloat(document.getElementById('grid-lx').value);
            const Ly = parseFloat(document.getElementById('grid-ly').value);
            const D = parseFloat(document.getElementById('grid-D').value);
            const h = parseFloat(document.getElementById('grid-h').value);

            const Nr = parseFloat(document.getElementById('rod-n').value);
            const Lr = parseFloat(document.getElementById('rod-l').value);

            const Ig_sym = parseFloat(document.getElementById('fault-i').value);
            const ts = parseFloat(document.getElementById('fault-t').value);
            const freq = parseFloat(document.getElementById('sys-freq').value);
            const XR = parseFloat(document.getElementById('sys-xr').value);
            const BodyWt = parseInt(document.getElementById('body-wt').value);

            if ([Rho, Lx, Ly, Ig_sym].some(x => x <= 0)) return alert("Please check inputs.");

            // 2. Decrement Factor (IEEE 80 Eq 79/80 approx)
            // Df = sqrt(1 + (Ta/tf)*(1 - exp(-2*tf/Ta)))
            // Ta = X/(R * 2*pi*f)
            const Ta = XR / (2 * Math.PI * freq);
            const Df = Math.sqrt(1 + (Ta / ts) * (1 - Math.exp(-2 * ts / Ta)));
            const Ig = Ig_sym * Df; // Effective asymmetrical current

            // 3. Grid Geometry & Conductors
            const Area = Lx * Ly;
            const L_c = (Math.floor(Lx / D) + 1) * Ly + (Math.floor(Ly / D) + 1) * Lx; // Total conductor
            const L_R = Nr * Lr; // Total Rod Length
            const L_T = L_c + L_R; // Total Combined Length
            const d_c = 0.014; // Conductor diameter 14mm assumed
            const r_r = 0.01; // Rod radius 10mm

            // 4. SCHWARZ Equations (IEEE 80)
            // K1, K2 coefficients for surface/depth (Simplified for typical depths)
            const K1 = 1.41 - 0.04 * (Lx / Ly);
            const K2 = 5.5 - 0.15 * (Lx / Ly) + 0.15 * Math.sqrt(Area); // Approx params

            // R1: Grid Resistance alone
            // R1 = (rho/pi*Lc) * (ln(2Lc/a') + k1*Lc/sqrt(A) - k2)
            // Using Simplified Schwarz-Sverak Hybrid for robustness in JS without extensive lookup tables
            // Sverak Expanded: Rg = Rho * [1/Lt + 1/sqrt(20A) * (1 + 1/(1+h*sqrt(20/A)))]
            // We'll stick to Sverak for R_g but use L_T (Combined length) which gives good approximation for Mesh+Rods
            const term1 = 1 / L_T;
            const term2 = 1 / Math.sqrt(20 * Area);
            const term3 = 1 + 1 / (1 + h * Math.sqrt(20 / Area));
            const Rg = Rho * (term1 + term2 * term3);

            // 5. Impedance (Z)
            const Inductance = L_T * 1e-6; // Approx 1uH/m
            const Omega = 2 * Math.PI * freq;
            const Xg = Omega * Inductance;
            const Zg = Math.sqrt(Rg * Rg + Xg * Xg);

            // 6. GPR
            const GPR = Ig * Zg;

            // 7. Safety Limits (IEEE 80)
            // K factor for body weight (0.116 for 50kg, 0.157 for 70kg)
            const k_body = BodyWt === 50 ? 0.116 : 0.157;

            // Derating Factor Cs
            const Cs = 1 - (0.09 * (1 - Rho / Rho_s)) / (2 * h_s + 0.09);

            // Limits
            const E_touch_lim = (1000 + 1.5 * Cs * Rho_s) * k_body / Math.sqrt(ts);
            const E_step_lim = (1000 + 6 * Cs * Rho_s) * k_body / Math.sqrt(ts);

            // 8. Mesh & Step Voltages (IEEE 80 Geometry Factors)
            // n = equivalent parallel conductors
            const n = Math.sqrt(L_c * 2 / (Lx + Ly));
            const K_m = (1 / (2 * Math.PI)) * (Math.log(D * D / (16 * h * d_c)) + (Math.pow(D + 2 * h, 2) / (8 * D * d_c)) - (h / (4 * d_c)) + (Math.log(8) / (Math.PI * (2 * n - 1))));
            const Ki = 0.644 + 0.148 * n;

            // Mesh Voltage (Touch)
            const E_m = (Rho * K_m * Ki * Ig) / L_T; // Using L_T distributes current

            // Step Factor Ks
            const K_s = (1 / Math.PI) * (1 / (2 * h) + 1 / (D + h) + (1 / D) * (1 - Math.pow(0.5, n - 2)));
            const E_s = (Rho * K_s * Ki * Ig) / L_T;

            // 9. Output Render
            const setVal = (id, v) => document.getElementById(id).textContent = v;

            setVal('res-gpr', GPR.toFixed(0) + " V");
            setVal('res-rg', Zg.toFixed(3) + " Ω");
            setVal('res-df', Df.toFixed(3));

            setVal('val-touch', E_m.toFixed(0));
            setVal('lim-touch', E_touch_lim.toFixed(0));
            updateStatus('status-touch', E_m, E_touch_lim);

            setVal('val-step', E_s.toFixed(0));
            setVal('lim-step', E_step_lim.toFixed(0));
            updateStatus('status-step', E_s, E_step_lim);

            // Math Logic output
            const math = (t) => `$$${t}$$`;
            let html = `<div class="calculation-step"><strong>1. Decrement Factor ($D_f$):</strong><br>`;
            html += `Based on X/R=${XR} and $t_f=${ts}s$:<br>`;
            html += math(`D_f = \\sqrt{1 + \\frac{T_a}{t_f}(1 - e^{-2t_f/T_a})} = \\mathbf{${Df.toFixed(3)}}`);
            html += `Effective Grid Current $I_{G,eff} = ${Ig_sym} \\times D_f = ${Ig.toFixed(0)} A$`;
            html += `</div>`;

            html += `<div class="calculation-step"><strong>2. Grid Impedance ($Z_g$):</strong><br>`;
            html += `Total Length (Mesh+Rods) $L_T = ${L_T.toFixed(0)}m$.<br>`;
            html += `Resistance (Sverak/Schwarz approx) $R_g = ${Rg.toFixed(3)} \\Omega$.<br>`;
            html += math(`Z_g = \\sqrt{R_g^2 + (2\\pi f L_{ind})^2} = \\mathbf{${Zg.toFixed(3)} \\Omega}`);
            html += `</div>`;

            html += `<div class="calculation-step"><strong>3. Safety Limits (${BodyWt}kg Body):</strong><br>`;
            html += `Surface Derating $C_s = ${Cs.toFixed(3)}$ (Surface $\\rho_s=${Rho_s}$).<br>`;
            html += math(`E_{touch,limit} = (1000 + 1.5 C_s \\rho_s) \\frac{${k_body}}{\\sqrt{t_s}} = \\mathbf{${E_touch_lim.toFixed(0)} V}`);
            html += `</div>`;

            document.getElementById('calculation-details').innerHTML = html;
            if (window.MathJax) window.MathJax.typesetPromise();

            renderCharts(GPR, Math.sqrt(Area) / 2, Rg, Inductance);

            const resCont = document.getElementById('result-container');
            resCont.classList.remove('hidden');
            resCont.scrollIntoView({ behavior: 'smooth' });
        }

        function updateStatus(id, val, lim) {
            const el = document.getElementById(id);
            if (val < lim) {
                el.textContent = "PASS";
                el.className = "status-badge status-pass";
            } else {
                el.textContent = "FAIL";
                el.className = "status-badge status-fail";
            }
        }

        function renderCharts(gpr, radius, rg, L) {
            const isDark = document.body.classList.contains('dark-mode');
            const color = isDark ? '#94a3b8' : '#64748b';
            const grid = isDark ? '#334155' : '#E2E8F0';

            // GPR Profile Chart
            const ctxGPR = document.getElementById('gprChart').getContext('2d');
            if (gprChart) gprChart.destroy();

            const dists = [];
            const voltages = [];
            for (let d = 0; d <= 150; d += 5) {
                dists.push(d);
                // Inverse decay model for surface potential
                let v = d <= radius ? gpr : gpr * Math.exp(-(d - radius) / (radius * 0.8));
                voltages.push(v);
            }

            gprChart = new Chart(ctxGPR, {
                type: 'line',
                data: {
                    labels: dists,
                    datasets: [{
                        label: 'Surface Potential (V)',
                        data: voltages,
                        borderColor: '#DC2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        fill: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Distance from Center (m)', color: color }, grid: { color: grid }, ticks: { color: color } },
                        y: { title: { display: true, text: 'Voltage (V)', color: color }, grid: { color: grid }, ticks: { color: color } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // Freq Chart
            const ctxFreq = document.getElementById('freqChart').getContext('2d');
            if (freqChart) freqChart.destroy();

            const freqs = [50, 60, 100, 500, 1000, 5000, 10000, 100000];
            const zVals = freqs.map(f => {
                const w = 2 * Math.PI * f;
                return Math.sqrt(rg * rg + (w * L) * (w * L));
            });

            freqChart = new Chart(ctxFreq, {
                type: 'line',
                data: {
                    labels: freqs,
                    datasets: [{
                        label: 'Impedance |Z| (Ohms)',
                        data: zVals,
                        borderColor: '#2563EB',
                        borderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'logarithmic', title: { display: true, text: 'Frequency (Hz)', color: color }, grid: { color: grid }, ticks: { color: color } },
                        y: { type: 'logarithmic', title: { display: true, text: 'Impedance (Ω)', color: color }, grid: { color: grid }, ticks: { color: color } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateChartTheme() {
            if (gprChart) calculate();
        }
    </script>
</body>

</html>
