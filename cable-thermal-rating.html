<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cable Ampacity Calculator - Design Calculators - Electrical</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional cable ampacity calculator based on IEC 60364 & NEC. Calculates corrected ampacity, voltage drop, and short-circuit withstand.">
    <meta name="keywords" content="cable ampacity, ampacity calculator, iec 60364-5-52, nec ampacity, voltage drop calculator, short circuit withstand, cable sizing">
    <meta name="author" content="Design Calculators">
    <meta name="robots" content="index, follow">

    <!-- AdSense & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-23Y1V450SR');
    </script>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for LaTeX rendering -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
        /* Base Theme Variables from perfect.txt */
        :root {
            --primary: #1E3A8A; /* Dark Blue */
            --secondary: #2563EB; /* Bright Blue */
            --accent: #F59E0B; /* Amber/Yellow */
            --success: #10B981; /* Green */
            --danger: #DC2626; /* Red */
            --warning: #F59E0B; /* Amber/Yellow */
            --bg: #F8FAFC; /* Light Grey BG */
            --card: #FFFFFF; /* White Card */
            --text: #4B5563; /* Medium Grey Text */
            --heading: #111827; /* Dark Grey/Black Heading */
            --footer-bg: #0F172A; /* Very Dark Blue Footer */
            --border: #E2E8F0; /* Light Grey Border */
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
            --grad-dark: linear-gradient(135deg, #0F172A, #1E293B);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
            --form-row-gap: 25px; /* Added for consistency */
        }

        /* Dark Mode Variables from perfect.txt */
        body.dark-mode {
            --primary: #10B981; /* Green */
            --secondary: #34D399; /* Lighter Green */
            --bg: #0F172A; /* Dark Blue BG */
            --card: #1E293B; /* Lighter Dark Blue Card */
            --text: #CBD5E1; /* Light Grey Text */
            --heading: #F1F5F9; /* White Heading */
            --footer-bg: #020617; /* Black Footer */
            --border: #334155; /* Medium Dark Border */
        }

        /* General Body Styling from perfect.txt */
        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.7;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container { 
            max-width: 1280px; 
            margin: 0 auto; 
            padding: 0 24px; 
        }

        /* Header & Nav from perfect.txt */
        header {
            background: var(--grad);
            color: white;
            padding: 24px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
        }
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
        }
        .logo-subtitle {
            font-size: 0.8rem;
            margin: 4px 0 0 0;
            color: #E0E7FF;
            opacity: 0.9;
        }
        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--accent); }
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .theme-toggle i {
            color: white;
        }
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.2);
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Main Content & Cards from perfect.txt */
        main { 
            padding: 40px 0; 
            flex: 1;
        }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        .card h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
            margin-top: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .card h3 {
            color: var(--heading);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-top: 25px;
            margin-bottom: 20px;
        }
        .card p {
            font-size: 1.05rem;
        }
        
        /* ADAPTED CALCULATOR STYLES */
        .tool-description {
            margin-bottom: 30px;
            color: var(--text);
            font-size: 1.1em;
            text-align: justify;
        }
        .calculator-form {
            background-color: var(--card);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--heading);
            font-size: 1.05em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        body.dark-mode .form-group input:focus {
             box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--form-row-gap);
            margin-bottom: 15px;
        }
        .section-title {
            color: var(--primary);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            margin-top: 30px;
            margin-bottom: 10px;
            border-top: 1px solid var(--border);
            padding-top: 20px;
        }
        
        /* Button Styles from perfect.txt, adapted */
        .btn {
            background: var(--grad);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }

        /* Result Container */
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card);
            box-shadow: var(--shadow);
            display: none;
            opacity: 0;
            transition: opacity 0.6s ease-out;
            border: 1px solid var(--border);
        }
        .result-container.show {
            display: block;
            opacity: 1;
        }
        .result-container h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
        }
        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .result-table th {
            background: var(--bg);
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            font-size: 0.95em;
        }
        .result-table tbody tr:nth-child(even) {
            background-color: var(--bg);
        }
        body.dark-mode .result-table tbody tr:nth-child(even) {
            background-color: #2c3e50;
        }
        .result-table tbody tr:hover {
            background-color: #eef2f7;
        }
        body.dark-mode .result-table tbody tr:hover {
            background-color: #334155;
        }
        
        /* Calculation Details */
        #calculation-details {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 1.05em;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
        }
        #calculation-details h4 {
            color: var(--secondary);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.4em;
            text-align: center;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.3em;
            text-align: center;
            padding: 12px 0;
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px dashed var(--primary);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--card);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid var(--accent);
            overflow-x: auto;
            font-size: 0.95em;
        }
        body.dark-mode #calculation-details p.calculation-step {
            background-color: var(--bg);
        }
        #calculation-details ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
            padding-left: 25px;
            position: relative;
        }
        #calculation-details ul li::before {
            content: "\f058";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: var(--success);
            position: absolute;
            left: 0;
            top: 2px;
        }
        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            background-color: var(--bg);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            color: var(--text);
        }

        /* Tooltip */
        .info-icon {
            color: var(--primary);
            margin-left: 8px;
            cursor: help;
            font-size: 0.9em;
            transition: transform 0.2s ease-in-out;
        }
        .info-icon:hover {
            transform: scale(1.2);
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            font-size: 0.85em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Custom message box */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 28px;
            border-radius: 8px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            z-index: 10000;
            font-weight: 600;
            color: white;
            opacity: 0;
            transition: all 0.4s;
            display: none;
        }
        #custom-message-box.show {
            display: block;
            opacity: 1;
            top: 30px;
        }
        
        /* Educational Section (from perfect.txt) */
        .education-section {
            margin-top: 40px;
        }
        .education-section h2 {
            font-size: 1.8rem;
        }
        .education-section h3 {
            font-size: 1.5rem;
            color: var(--primary);
        }
        .education-section p, .education-section li {
            line-height: 1.8;
            font-size: 1.05rem;
            color: var(--text);
        }
        .education-section ul {
            padding-left: 25px;
            margin-top: 10px;
        }
        .education-section strong {
            color: var(--heading);
        }
        .danger-box {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border-left: 5px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .danger-box h3 {
            color: var(--danger);
            margin-top: 0;
            font-size: 1.4rem;
        }
        .summary-box {
            background: linear-gradient(135deg, rgba(30,58,138,0.1), rgba(30,58,138,0.05));
            border-left: 5px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .summary-box h4 {
            color: var(--primary);
            margin-top: 0;
            font-size: 1.3rem;
        }
        body.dark-mode .summary-box h4 {
            color: var(--secondary);
        }


        /* Footer from perfect.txt */
        footer {
            background: var(--grad-dark);
            color: #CBD5E1;
            padding: 50px 0 20px 0;
            margin-top: 60px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 15px;
            font-weight: 700;
        }
        .footer-col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-col li {
            margin-bottom: 8px;
        }
        .footer-col a {
            color: #CBD5E1;
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-col a:hover {
            color: var(--accent);
        }
        .social-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        .social-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .social-btn:hover {
            transform: translateY(-4px);
        }
        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.youtube { background-color: #FF0000; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        /* Added email button style from original */
        .social-btn.email { background-color: #EA4335; }

        .footer-disclaimer {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid #334155;
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.9rem;
            color: #94A3B8;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .navbar { flex-direction: column; gap: 20px; }
            .nav-links { flex-direction: column; gap: 12px; text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .card { padding: 20px; }
            .footer-content { flex-direction: column; gap: 25px; }
        }
    </style>
</head>
<body>
    <div id="custom-message-box"></div>

    <!-- New Header from perfect.txt -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo-container">
                    <span class="logo-text">Design Calculators</span>
                    <p class="logo-subtitle">Inspired by standards such as IEC, IEEE, ISA, ASME, and API.</p>
                </a>
                <ul class="nav-links">
                    <li><a href='/'>Home</a></li>
                    <li><a href="articles.html">Articles</a></li>
                    <li><a href="indexmech.html">Mechanical</a></li>
                    <li><a href="indexele.html">Electrical</a></li>
                    <li><a href="indexinst.html">Instrumentation</a></li>
                </ul>
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Back button removed as requested -->
                
        <div class="card">
            <h2><i class="fas fa-bolt"></i> Cable Ampacity Calculator</h2>
                        
            <div class="tool-description">
                <p>This tool calculates the current-carrying capacity (ampacity) of electrical cables based on recognized international standards. It considers various factors such as conductor material, insulation type, installation method, ambient temperature, and grouping effects to provide a corrected ampacity value. Additionally, it provides estimates for **Voltage Drop** and **Short-Circuit Current Withstand**, crucial for comprehensive cable sizing and protection in industrial systems. The calculation adheres to principles outlined in **IEC 60364-5-52 (Low-voltage electrical installations - Part 5-52: Selection and erection of electrical equipment - Wiring systems)** and **NEC (NFPA 70) (National Electrical Code)**, ensuring compliance with industry best practices.</p>
            </div>
                    
            <div class="calculator-form">
                <form id="ampacity-form">
                    <!-- Standard and General Inputs -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="standard">Standard <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the electrical standard to base the calculation on. IEC and NEC have different reference conditions and tables.</span></span></label>
                            <select id="standard" required>
                                <option value="iec">IEC 60364-5-52</option>
                                <option value="nec">NEC (NFPA 70)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conductor-material">Conductor Material <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Copper has higher conductivity and ampacity than Aluminum for the same size.</span></span></label>
                            <select id="conductor-material" required>
                                <option value="copper">Copper</option>
                                <option value="aluminum">Aluminum</option>
                            </select>
                        </div>
                    </div>
                                        
                    <!-- Cable Specifications -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conductor-size">Conductor Size <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Cross-sectional area of the conductor. Select the appropriate unit based on the chosen standard.</span></span></label>
                            <select id="conductor-size" required></select>
                        </div>
                        <div class="form-group">
                            <label for="insulation-type">Insulation Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum operating temperature of the insulation material is a key factor. XLPE/EPR can withstand higher temperatures than PVC.</span></span></label>
                            <select id="insulation-type" required>
                                <option value="pvc">PVC (70℃)</option>
                                <option value="xlpe">XLPE/EPR (90℃)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Installation Conditions -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="installation-method">Installation Method <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">How the cable is installed. Heat dissipation varies significantly between methods (e.g., in air vs. buried).</span></span></label>
                            <select id="installation-method" required></select>
                        </div>
                        <div class="form-group">
                            <label for="ambient-temp">Ambient Temperature (℃) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The temperature of the surrounding medium (air or ground) where the cable is installed. Higher ambient temperatures reduce ampacity.</span></span></label>
                            <input type="number" id="ambient-temp" value="30" step="1" required>
                        </div>
                    </div>
                                        
                    <div class="form-row">
                        <div class="form-group">
                            <label for="num-circuits">Number of Circuits/Cables Grouped <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">When multiple cables are grouped, their mutual heating reduces individual ampacity. Enter the total number of cables in the group.</span></span></label>
                            <input type="number" id="num-circuits" value="1" min="1" step="1" required>
                        </div>
                        <div class="form-group" id="soil-resistivity-group">
                            <label for="soil-resistivity">Soil Thermal Resistivity (K·m/W) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">A measure of how well soil dissipates heat. Typical value is 2.5. Dry, sandy soil has higher resistivity (poorer heat dissipation).</span></span></label>
                            <input type="number" id="soil-resistivity" value="2.5" step="0.1" required>
                        </div>
                    </div>
                                        
                    <!-- New: Depth of Burial Input -->
                    <div class="form-row">
                        <div class="form-group" id="depth-of-burial-group">
                            <label for="depth-of-burial">Depth of Burial (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The depth at which the cable is buried. Deeper burial can reduce ampacity due to less efficient heat dissipation. Typical values range from 0.5m to 1.5m.</span></span></label>
                            <input type="number" id="depth-of-burial" value="0.7" step="0.1" min="0.1" required>
                        </div>
                        <div class="form-group">
                            <!-- Empty div to maintain grid balance -->
                        </div>
                    </div>

                    <!-- New Section: Voltage Drop Calculation Inputs -->
                    <h4 class="section-title">Voltage Drop Calculation Parameters</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="load-current">Load Current (A) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The actual current drawn by the load connected to the cable. Used for voltage drop calculation.</span></span></label>
                            <input type="number" id="load-current" value="100" min="0.1" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="system-voltage-vd">System Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The nominal line-to-line voltage of the system. Used for voltage drop percentage calculation.</span></span></label>
                            <input type="number" id="system-voltage-vd" value="400" min="1" step="1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cable-length">Cable Length (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The one-way length of the cable run. Longer cables result in higher voltage drop.</span></span></label>
                            <input type="number" id="cable-length" value="50" min="1" step="1" required>
                        </div>
                        <div class="form-group">
                            <label for="phase-type">System Phase Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select if the system is single-phase or three-phase. This affects the voltage drop calculation formula.</span></span></label>
                            <select id="phase-type" required>
                                <option value="single-phase">Single-Phase</option>
                                <option value="three-phase" selected>Three-Phase</option>
                            </select>
                        </div>
                    </div>

                    <!-- New Section: Short-Circuit Current Withstand Calculation Inputs -->
                    <h4 class="section-title">Short-Circuit Current Withstand Parameters</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fault-duration">Fault Duration (seconds) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The duration of the short-circuit fault, typically determined by the upstream protective device's clearing time.</span></span></label>
                            <input type="number" id="fault-duration" value="0.1" min="0.01" step="0.01" required>
                        </div>
                        <div class="form-group">
                             <!-- This empty div helps maintain the 2-column layout -->
                        </div>
                    </div>

                    <button type="button" id="calculate-btn" class="btn"><i class="fas fa-calculator"></i> Calculate Ampacity & More</button>
                </form>
            </div>
        </div>
                        
        <!-- Results Container -->
        <div id="result-container" class="result-container">
            <h3><i class="fas fa-clipboard-check"></i> Cable Ampacity Results</h3>
            <div id="calculation-details">
                <!-- Calculation steps will be inserted here -->
            </div>
            <table class="result-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                    <!-- Results will be dynamically inserted here -->
                </tbody>
            </table>
            <div class="standard-reference" id="standard-reference" style="margin-top: 25px;">
                <!-- Standard reference text will be inserted here -->
            </div>
        </div>

        <!-- NEWLY ADDED STATIC EDUCATIONAL SECTION -->
        <div class="card education-section">
            <h2><i class="fas fa-book-reader"></i> Professional Insights: The 3 Pillars of Cable Sizing</h2>
            <p>Sizing an electrical cable is a critical engineering task that goes far beyond just "picking a wire that fits." A correctly sized cable operates safely and efficiently for decades, while an incorrectly sized one is a catastrophic fire and equipment-failure hazard. This tool analyzes the three fundamental pillars of cable selection: <strong>Ampacity</strong>, <strong>Voltage Drop</strong>, and <strong>Short-Circuit Withstand</strong>.</p>

            <h3>1. Ampacity: Protecting the Cable</h3>
            <p><strong>What is it?</strong> Ampacity (a blend of "ampere" and "capacity") is the maximum current a cable can continuously carry without exceeding its insulation's temperature rating (e.g., 70°C for PVC, 90°C for XLPE). It is not a fixed number; it's a dynamic rating based on a simple principle: <strong>Heat In vs. Heat Out.</strong></p>
            <ul>
                <li><strong>Heat In:</strong> Generated by current flowing through the conductor's resistance (`I²R` losses).</li>
                <li><strong>Heat Out:</strong> Dissipated from the cable surface into the surrounding environment.</li>
            </ul>
            <p>The cable's ampacity is the point where "Heat In" equals "Heat Out." This is why we apply <strong>derating factors</strong>:</p>
            <ul>
                <li><strong>Ambient Temperature ($$k_{temp}$$):</strong> A hotter day (e.g., 45°C) means the environment can absorb less heat. The cable can't dissipate as much, so its ampacity <em>decreases</em>.</li>
                <li><strong>Grouping ($$k_{group}$$):</strong> Laying cables side-by-side means they heat each other. This "mutual heating" drastically reduces the "Heat Out" for every cable in the bundle, <em>significantly</em> lowering their ampacity.</li>
                <li><strong>Burial ($$k_{soil}$$ & $$k_{depth}$$):</strong> Soil is a thermal insulator. "Damp" soil (low resistivity, e.g., 1.5 K·m/W) dissipates heat well. Dry, sandy soil (high resistivity, e.g., 3.0 K·m/W) traps heat, <em>lowering</em> ampacity. Burying a cable deeper also makes it harder for heat to reach the surface, further reducing its rating.</li>
            </ul>

            <div class="danger-box">
                <h3><i class="fas fa-fire"></i> The Danger of Exceeding Ampacity</h3>
                <p>Exceeding a cable's corrected ampacity—even for a short time—causes the conductor temperature to rise above its design limit. This permanently damages the insulation, making it brittle and prone to cracking. This leads to insulation failure, which can cause a <strong>phase-to-phase or phase-to-ground short circuit</strong>, resulting in fire, arc flash, and catastrophic equipment damage.</p>
            </div>

            <h3>2. Voltage Drop: Protecting the Load</h3>
            <p>A cable can be <em>safe</em> (not exceeding its ampacity) but still be <em>incorrect</em>. As current flows through the cable's impedance (resistance R and reactance X), the voltage "drops" along its length. If a 400V motor is fed by a very long, undersized cable, it might only receive 370V.</p>
            <p>This <strong>low voltage</strong> starves the motor, causing it to draw <em>higher</em> current to produce its required power. This leads to overheating, insulation damage, and premature failure of your expensive load (motor, pump, etc.). Standards like NEC/IEC recommend limiting voltage drop to <strong>3-5%</strong> to ensure equipment health.</p>

            <h3>3. Short-Circuit Withstand: Protecting the System</h3>
            <p>This is the "emergency" scenario. Ampacity and voltage drop are for normal operation. Short-circuit withstand is about surviving a fault. When a fault occurs (e.g., a bolted short circuit), the current can instantly spike to <strong>10,000A, 25,000A, or more.</strong></p>
            <p>The cable must be able to withstand this massive thermal and magnetic stress for the short time (e.g., 0.1 seconds) it takes the upstream circuit breaker to trip. This is calculated using the adiabatic formula <strong>$$I^2t = k^2S^2$$</strong>. If the cable is too small, it will be physically destroyed (vaporized) by the fault <em>before</em> the breaker can even act, turning a controllable fault into an unmitigated disaster.</p>
            
            <div class="summary-box">
                <h4><strong>The Three-Legged Stool of Sizing</strong></h4>
                <p>A cable must be sized to meet <strong>all three</strong> criteria. The <em>largest</em> cable size required by any of the three calculations is the one you must use.
                   <br/>1. <strong>Ampacity Check:</strong> Is the cable safe from overheating under normal load?
                   <br/>2. <strong>Voltage Drop Check:</strong> Will the load receive enough voltage to run properly?
                   <br/>3. <strong>Short-Circuit Check:</strong> Can the cable survive a fault long enough for the breaker to trip?
                </p>
            </div>
        </div>
    </main>

    <!-- New Footer from perfect.txt -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>Design Calculators</h4>
                    <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 15px;">If you find this tool helpful, please consider sharing it with your colleagues!</p>
                    <div class="social-buttons">
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="https://twitter.com/intent/tweet?url=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn twitter" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20amazing%20engineering%20resource%20https://designcalculators.co.in" target="_blank" rel="noopener noreferrer" class="social-btn whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                        </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href='/'>Home</a></li>
                        <li><a href="indexele.html">Electrical</a></li>
                        <li><a href="indexmech.html">Mechanical</a></li>
                        <li><a href="indexinst.html">Instrumentation</a></li>
                        <li><a href="articles.html">Articles</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>More</h4>
                    <ul>
                        <li><a href='/articles.html'>Articles & Whitepapers</a></li>
                        <li><a href="sitemap2.html">Sitemap</a></li>
                        <li><a href="https://www.youtube.com/@designcalculators" target="_blank" rel="noopener noreferrer">YouTube Channel</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                <!-- Updated Disclaimer for this Tool -->
                <p>This tool provides an estimate for educational purposes based on simplified data from IEC 60364-5-52 and NEC (NFPA 70). Always refer to the complete official standards, manufacturer-specific data, and local electrical codes for final engineering design, safety verification, and compliance. The creators of this tool are not liable for any damages or injuries resulting from its use.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Design Calculators. Created by <span style="color: var(--secondary); font-weight: bold;">A Sharma</span>. All rights reserved.</p>
            </div>
        </div>
    </footer>
        
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- DATABASE & DATA TABLES ---
        // These tables are simplified representations based on common values from standards.
        // In a real-world, comprehensive tool, these would be much larger and more detailed.

        // IEC Base Ampacity (Table 52-B1 of IEC 60364-5-52) - Amps
        // Reference: 30℃ ambient air, 90℃ conductor temp (XLPE), single circuit, 3-core cable in conduit
        const iecBaseAmpacity = {
            copper: { // Conductor: Copper
                xlpe: { // Insulation: XLPE (90C)
                    '1.5': 21, '2.5': 28, '4': 38, '6': 49, '10': 68, '16': 90,
                    '25': 118, '35': 147, '50': 175, '70': 222, '95': 269, '120': 310,
                    '150': 354, '185': 404, '240': 477, '300': 550, '400': 650, '500': 750, '630': 870
                },
                pvc: { // Insulation: PVC (70C)
                    '1.5': 16, '2.5': 22, '4': 30, '6': 38, '10': 53, '16': 70,
                    '25': 92, '35': 114, '50': 136, '70': 172, '95': 209, '120': 240,
                    '150': 275, '185': 314, '240': 370, '300': 428, '400': 500, '500': 570, '630': 650
                }
            },
            aluminum: { // Conductor: Aluminum
                xlpe: {
                    '2.5': 22, '4': 30, '6': 38, '10': 53, '16': 70, '25': 92,
                    '35': 114, '50': 136, '70': 172, '95': 209, '120': 240,
                    '150': 275, '185': 314, '240': 370, '300': 428, '400': 500, '500': 570, '630': 650
                },
                pvc: {
                    '2.5': 17, '4': 23, '6': 30, '10': 41, '16': 55, '25': 72,
                    '35': 89, '50': 106, '70': 134, '95': 163, '120': 187,
                    '150': 214, '185': 244, '240': 288, '300': 333, '400': 390, '500': 440, '630': 500
                }
            }
        };

        // NEC Base Ampacity (Table 310.16) - Amps
        // Reference: 30℃ ambient air, 3 conductors in raceway
        const necBaseAmpacity = {
            copper: {
                xlpe: { // 90C column (THHN, XHHW-2, etc.)
                    '14': 25, '12': 30, '10': 40, '8': 55, '6': 75, '4': 95, '3': 110,
                    '2': 130, '1': 150, '1/0': 170, '2/0': 195, '3/0': 225, '4/0': 260,
                    '250': 290, '300': 320, '350': 350, '400': 380, '500': 430, '600': 475, '700': 520, '750': 535, '800': 555, '1000': 610
                },
                pvc: { // 75C column (THW, RHW, etc. - most common termination rating)
                    '14': 20, '12': 25, '10': 35, '8': 50, '6': 65, '4': 85, '3': 100,
                    '2': 115, '1': 130, '1/0': 150, '2/0': 175, '3/0': 200, '4/0': 230,
                    '250': 255, '300': 285, '350': 310, '400': 335, '500': 380, '600': 420, '700': 455, '750': 470, '800': 490, '1000': 545
                }
            },
            aluminum: {
                xlpe: { // 90C column
                    '12': 25, '10': 35, '8': 45, '6': 60, '4': 75, '3': 85, '2': 100,
                    '1': 115, '1/0': 135, '2/0': 150, '3/0': 175, '4/0': 205,
                    '250': 230, '300': 255, '350': 280, '400': 305, '500': 350, '600': 385, '700': 420, '750': 435, '800': 450, '1000': 500
                },
                pvc: { // 75C column
                    '12': 20, '10': 30, '8': 40, '6': 50, '4': 65, '3': 75, '2': 90,
                    '1': 100, '1/0': 120, '2/0': 135, '3/0': 155, '4/0': 180,
                    '250': 205, '300': 230, '350': 250, '400': 270, '500': 310, '600': 340, '700': 370, '750': 385, '800': 400, '1000': 445
                }
            }
        };

        // Correction Factors (Ka) for Ambient Air Temp (Based on 30℃ reference)
        const tempCorrectionFactors = {
            pvc: { // 70C/75C insulation (using 70C as a conservative base)
                '20': 1.08, '25': 1.04, '30': 1.00, '35': 0.96, '40': 0.91,
                '45': 0.87, '50': 0.82, '55': 0.76, '60': 0.71, '65': 0.65, '70': 0.58
            },
            xlpe: { // 90C insulation
                '20': 1.08, '25': 1.04, '30': 1.00, '35': 0.96, '40': 0.91,
                '45': 0.87, '50': 0.82, '55': 0.76, '60': 0.71, '65': 0.65, '70': 0.58,
                '75': 0.50, '80': 0.41, '85': 0.32, '90': 0.22
            }
        };

        // Grouping Correction Factors (Kg)
        const groupingCorrectionFactors = {
            '1': 1.00, '2': 0.80, '3': 0.70, '4': 0.65, '5': 0.60,
            '6': 0.57, '7': 0.54, '8': 0.52, '9': 0.50, '10': 0.48,
            '11': 0.47, '12': 0.46, '13': 0.45, '14': 0.44, '15': 0.43,
            '16': 0.42, '17': 0.41, '18': 0.40, '19': 0.39, '20': 0.38,
            '21': 0.37, '22': 0.36, '23': 0.35, '24': 0.34, '25': 0.33,
            '26': 0.32, '27': 0.31, '28': 0.30, '29': 0.29, '30': 0.28,
            '31': 0.27, '32': 0.26, '33': 0.25, '34': 0.24, '35': 0.23,
            '36': 0.22, '37': 0.21, '38': 0.20, '39': 0.19, '40': 0.18,
            '41': 0.17, '42': 0.16
        };

        // Soil Thermal Resistivity Correction Factors (Kp) (Ref: IEC, 20℃ ground temp, 2.5 K·m/W reference)
        const soilResistivityCorrectionFactors = {
            '0.5': 1.25, '1.0': 1.18, '1.5': 1.10, '2.0': 1.05, '2.5': 1.00,
            '3.0': 0.96, '3.5': 0.92, '4.0': 0.88, '4.5': 0.84, '5.0': 0.80
        };

        // Depth of Burial Correction Factors (Kd) (Ref: IEC, for direct buried cables, 0.7m ref)
        const depthCorrectionFactors = {
            '0.3': 1.10, '0.4': 1.07, '0.5': 1.05, '0.6': 1.02, '0.7': 1.00,
            '0.8': 0.98, '0.9': 0.96, '1.0': 0.95, '1.1': 0.93, '1.2': 0.92,
            '1.3': 0.90, '1.4': 0.89, '1.5': 0.88, '1.6': 0.87, '1.7': 0.86,
            '1.8': 0.85, '1.9': 0.84, '2.0': 0.83
        };

        // Conductor Resistance and Reactance (Ohms/km at 90℃ for XLPE, 75C for NEC PVC)
        const conductorImpedance = {
            copper: {
                iec: { // mm2
                    '1.5': { R: 12.1, X: 0.09 }, '2.5': { R: 7.41, X: 0.09 }, '4': { R: 4.61, X: 0.09 },
                    '6': { R: 3.08, X: 0.09 }, '10': { R: 1.83, X: 0.09 }, '16': { R: 1.15, X: 0.09 },
                    '25': { R: 0.734, X: 0.08 }, '35': { R: 0.524, X: 0.08 }, '50': { R: 0.387, X: 0.08 },
                    '70': { R: 0.272, X: 0.08 }, '95': { R: 0.206, X: 0.08 }, '120': { R: 0.161, X: 0.08 },
                    '150': { R: 0.129, X: 0.08 }, '185': { R: 0.106, X: 0.07 }, '240': { R: 0.0801, X: 0.07 },
                    '300': { R: 0.0641, X: 0.07 }, '400': { R: 0.0480, X: 0.07 }, '500': { R: 0.0384, X: 0.06 },
                    '630': { R: 0.0304, X: 0.06 }
                },
                nec: { // AWG/kcmil
                    '14': { R: 8.28, X: 0.08 }, '12': { R: 5.21, X: 0.08 }, '10': { R: 3.28, X: 0.08 },
                    '8': { R: 2.07, X: 0.08 }, '6': { R: 1.30, X: 0.08 }, '4': { R: 0.82, X: 0.08 },
                    '3': { R: 0.65, X: 0.08 }, '2': { R: 0.51, X: 0.08 }, '1': { R: 0.41, X: 0.08 },
                    '1/0': { R: 0.32, X: 0.08 }, '2/0': { R: 0.26, X: 0.08 }, '3/0': { R: 0.20, X: 0.08 },
                    '4/0': { R: 0.16, X: 0.08 }, '250': { R: 0.13, X: 0.08 }, '300': { R: 0.11, X: 0.08 },
                    '350': { R: 0.09, X: 0.08 }, '400': { R: 0.08, X: 0.08 }, '500': { R: 0.06, X: 0.08 },
                    '600': { R: 0.05, X: 0.08 }, '700': { R: 0.04, X: 0.08 }, '750': { R: 0.04, X: 0.08 },
                    '800': { R: 0.03, X: 0.08 }, '1000': { R: 0.03, X: 0.08 }
                }
            },
            aluminum: {
                iec: { // mm2
                    '2.5': { R: 12.1, X: 0.09 }, '4': { R: 7.41, X: 0.09 }, '6': { R: 4.61, X: 0.09 },
                    '10': { R: 3.08, X: 0.09 }, '16': { R: 1.83, X: 0.09 }, '25': { R: 1.15, X: 0.09 },
                    '35': { R: 0.734, X: 0.08 }, '50': { R: 0.524, X: 0.08 }, '70': { R: 0.387, X: 0.08 },
                    '95': { R: 0.272, X: 0.08 }, '120': { R: 0.206, X: 0.08 }, '150': { R: 0.161, X: 0.08 },
                    '185': { R: 0.129, X: 0.08 }, '240': { R: 0.106, X: 0.07 }, '300': { R: 0.0801, X: 0.07 },
                    '400': { R: 0.0641, X: 0.07 }, '500': { R: 0.0480, X: 0.07 }, '630': { R: 0.0384, X: 0.06 }
                },
                nec: { // AWG/kcmil
                    '12': { R: 8.28, X: 0.08 }, '10': { R: 5.21, X: 0.08 }, '8': { R: 3.28, X: 0.08 },
                    '6': { R: 2.07, X: 0.08 }, '4': { R: 1.30, X: 0.08 }, '3': { R: 0.98, X: 0.08 },
                    '2': { R: 0.78, X: 0.08 }, '1': { R: 0.62, X: 0.08 }, '1/0': { R: 0.49, X: 0.08 },
                    '2/0': { R: 0.39, X: 0.08 }, '3/0': { R: 0.31, X: 0.08 }, '4/0': { R: 0.25, X: 0.08 },
                    '250': { R: 0.20, X: 0.08 }, '300': { R: 0.17, X: 0.08 }, '350': { R: 0.14, X: 0.08 },
                    '400': { R: 0.12, X: 0.08 }, '500': { R: 0.10, X: 0.08 }, '600': { R: 0.08, X: 0.08 },
                    '700': { R: 0.07, X: 0.08 }, '750': { R: 0.06, X: 0.08 }, '800': { R: 0.06, X: 0.08 },
                    '1000': { R: 0.05, X: 0.08 }
                }
            }
        };

        // K-factors for Short-Circuit Withstand (Adiabatic Equation)
        // From IEC standards, (k)
        const kFactorsShortCircuit = {
            copper: {
                pvc: 115, // 70C -> 160C
                xlpe: 143 // 90C -> 250C
            },
            aluminum: {
                pvc: 76, // 70C -> 160C
                xlpe: 94 // 90C -> 250C
            }
        };

        // --- UI ELEMENT REFERENCES ---
        const standardSelect = document.getElementById('standard');
        const conductorMaterialSelect = document.getElementById('conductor-material');
        const conductorSizeSelect = document.getElementById('conductor-size');
        const insulationTypeSelect = document.getElementById('insulation-type');
        const installationMethodSelect = document.getElementById('installation-method');
        const ambientTempInput = document.getElementById('ambient-temp');
        const numCircuitsInput = document.getElementById('num-circuits');
        const soilResistivityInput = document.getElementById('soil-resistivity');
        const soilResistivityGroup = document.getElementById('soil-resistivity-group');
        const depthOfBurialInput = document.getElementById('depth-of-burial'); 
        const depthOfBurialGroup = document.getElementById('depth-of-burial-group'); 
        const loadCurrentInput = document.getElementById('load-current');
        const systemVoltageVdInput = document.getElementById('system-voltage-vd');
        const cableLengthInput = document.getElementById('cable-length');
        const phaseTypeSelect = document.getElementById('phase-type');
        const faultDurationInput = document.getElementById('fault-duration');
        const calculateBtn = document.getElementById('calculate-btn');
        const resultContainer = document.getElementById('result-container');
        const resultTableBody = document.getElementById('result-table-body');
        const calculationDetailsDiv = document.getElementById('calculation-details');
        const standardReferenceDiv = document.getElementById('standard-reference');
        const emailShareBtn = document.getElementById('email-share-btn'); 

        // --- DYNAMIC FORM LOGIC ---
        const iecSizes = ['1.5', '2.5', '4', '6', '10', '16', '25', '35', '50', '70', '95', '120', '150', '185', '240', '300', '400', '500', '630'];
        const necSizes = ['14', '12', '10', '8', '6', '4', '3', '2', '1', '1/0', '2/0', '3/0', '4/0', '250', '300', '350', '400', '500', '600', '700', '750', '800', '1000'];
        
        // Simplified IEC/NEC methods.
        // NOTE: This is a key simplification. Real standards have dozens of methods
        // linked to different base ampacity tables. This tool uses ONE base table
        // per standard and assumes other methods are similar or applies a simple factor.
        const iecInstallMethods = {
            'B1': 'Insulated conductors in conduit on a wooden wall',
            'C': 'Single-core or multi-core cable on a wooden wall (Ref)',
            'E': 'Multi-core cable in free air (on perforated tray/ladder)',
            'F': 'Single-core cables, touching, in free air (on tray/ladder)',
            'D1': 'Multi-core cable in conduit in the ground',
            'D2': 'Multi-core cable directly buried'
        };
        const necInstallMethods = {
            'in_raceway': 'In raceway or cable, in free air (Ref)',
            'in_tray_ventilated': 'In ventilated cable tray (metallic or FRP), free air',
            'direct_burial': 'Direct burial'
        };

        function updateFormOptions() {
            const standard = standardSelect.value;
            
            // Update Conductor Sizes
            conductorSizeSelect.innerHTML = '';
            const sizes = standard === 'iec' ? iecSizes : necSizes;
            const unit = standard === 'iec' ? 'mm²' : 'AWG/kcmil';
            document.querySelector('label[for="conductor-size"]').innerHTML = `Conductor Size (${unit}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Cross-sectional area of the conductor. Select the appropriate unit based on the chosen standard.</span></span>`;
            sizes.forEach(size => {
                const option = document.createElement('option');
                option.value = size;
                option.textContent = size;
                conductorSizeSelect.appendChild(option);
            });

            // Update Insulation Type options (NEC 75C for PVC)
            const pvcOption = document.querySelector('option[value="pvc"]');
            if (standard === 'nec') {
                pvcOption.textContent = 'PVC (75℃)';
                // In NEC, 75C (pvc) is more common for terminations, 90C (xlpe) is used for derating.
                // We will use the 75C table for PVC and 90C table for XLPE.
                insulationTypeSelect.value = 'pvc'; // Default to 75C for NEC
            } else {
                pvcOption.textContent = 'PVC (70℃)';
                insulationTypeSelect.value = 'xlpe'; // Default to 90C for IEC
            }

            // Update Installation Methods
            installationMethodSelect.innerHTML = '';
            const methods = standard === 'iec' ? iecInstallMethods : necInstallMethods;
            for (const key in methods) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = methods[key];
                installationMethodSelect.appendChild(option);
            }
            
            // Set default installation method
            if (standard === 'iec') {
                installationMethodSelect.value = 'C'; // IEC Reference in air
            } else {
                installationMethodSelect.value = 'in_raceway'; // NEC Reference
            }

            // Show/hide soil resistivity and depth of burial
            updateBurialVisibility();
        }

        function updateBurialVisibility() {
            const method = installationMethodSelect.value;
            const isBuried = method.includes('D') || method.includes('burial');

            if (isBuried) {
                soilResistivityGroup.style.display = 'block';
                soilResistivityInput.setAttribute('required', 'true');
                depthOfBurialGroup.style.display = 'block';
                depthOfBurialInput.setAttribute('required', 'true');
                // Set default ambient temp for ground
                ambientTempInput.value = '20';
                document.querySelector('label[for="ambient-temp"]').innerHTML = `Ambient Ground Temp (℃) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">IEC default ground temp is 20°C. NEC default is 30°C. Adjust as needed.</span></span>`;
            } else {
                soilResistivityGroup.style.display = 'none';
                soilResistivityInput.removeAttribute('required');
                depthOfBurialGroup.style.display = 'none';
                depthOfBurialInput.removeAttribute('required');
                // Set default ambient temp for air
                ambientTempInput.value = '30';
                document.querySelector('label[for="ambient-temp"]').innerHTML = `Ambient Air Temp (℃) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The temperature of the surrounding air. Default reference is 30°C.</span></span>`;
            }
        }

        // --- EVENT LISTENERS ---
        standardSelect.addEventListener('change', updateFormOptions);
        installationMethodSelect.addEventListener('change', updateBurialVisibility);
        calculateBtn.addEventListener('click', calculateAmpacity);
        emailShareBtn.addEventListener('click', (e) => {
            if (emailShareBtn.href === '#') {
                e.preventDefault();
                displayMessage("Please calculate results first to generate a shareable email.", "warning");
            }
        });

        // --- HELPER FUNCTIONS FOR INTERPOLATION ---
        function interpolateFactor(table, value) {
            const keys = Object.keys(table).map(parseFloat).sort((a, b) => a - b);
            if (value <= keys[0]) return table[keys[0]];
            if (value >= keys[keys.length - 1]) return table[keys[keys.length - 1]];

            let lowerKey = keys[0];
            let upperKey = keys[keys.length - 1];
            for (let i = 0; i < keys.length - 1; i++) {
                if (value >= keys[i] && value <= keys[i+1]) {
                    lowerKey = keys[i];
                    upperKey = keys[i+1];
                    break;
                }
            }
            const lowerValue = table[lowerKey];
            const upperValue = table[upperKey];
            if (upperKey === lowerKey) return lowerValue;
            return lowerValue + (upperValue - lowerValue) * ((value - lowerKey) / (upperKey - lowerKey));
        }

        // --- CALCULATION LOGIC ---
        function calculateAmpacity() {
            try {
                // 1. Get all inputs
                const standard = standardSelect.value;
                const material = conductorMaterialSelect.value;
                const size = conductorSizeSelect.value;
                const insulation = insulationTypeSelect.value;
                const installMethod = installationMethodSelect.value;
                const ambientTemp = parseFloat(ambientTempInput.value);
                const numCircuits = parseInt(numCircuitsInput.value);
                const soilResistivity = parseFloat(soilResistivityInput.value);
                const depthOfBurial = parseFloat(depthOfBurialInput.value);
                const loadCurrent = parseFloat(loadCurrentInput.value);
                const systemVoltageVd = parseFloat(systemVoltageVdInput.value);
                const cableLength = parseFloat(cableLengthInput.value);
                const phaseType = phaseTypeSelect.value;
                const faultDuration = parseFloat(faultDurationInput.value);

                // 2. Input Validation
                if (isNaN(ambientTemp) || isNaN(numCircuits) || isNaN(loadCurrent) || isNaN(systemVoltageVd) || isNaN(cableLength) || isNaN(faultDuration)) {
                    throw new Error("Please fill all required fields with valid numbers.");
                }
                if (numCircuits < 1 || numCircuits > 42) {
                    displayMessage("Number of circuits must be between 1 and 42 for this tool. For more, consult specific tables.", "warning");
                }
                const tempKeys = Object.keys(tempCorrectionFactors[insulation]).map(parseFloat);
                const minTemp = Math.min(...tempKeys);
                const maxTemp = Math.max(...tempKeys);
                if (ambientTemp < minTemp || ambientTemp > maxTemp) {
                    displayMessage(`Ambient temp (${ambientTemp}℃) is outside the tool's range (${minTemp}℃ to ${maxTemp}℃). Results may be inaccurate.`, "warning");
                }

                const isBuried = installMethod.includes('D') || installMethod.includes('burial');
                if (isBuried && (isNaN(soilResistivity) || isNaN(depthOfBurial))) {
                    throw new Error("For buried installations, please provide valid Soil Resistivity and Depth of Burial.");
                }

                // 3. Look up Base Ampacity (Ib)
                const baseAmpacityTable = standard === 'iec' ? iecBaseAmpacity : necBaseAmpacity;
                let Ib_raw = 0;
                try {
                    Ib_raw = baseAmpacityTable[material][insulation][size];
                    if (!Ib_raw) throw new Error();
                } catch (e) {
                    throw new Error(`Base ampacity data not found for: ${material}, ${insulation}, ${size}.`);
                }

                let calculationHtml = '<h4><i class="fas fa-tasks"></i> Detailed Calculation Steps:</h4>';
                
                // --- Ampacity Calculation ---
                calculationHtml += `<h4>1. Corrected Ampacity ($$I_z$$)</h4>`;
                calculationHtml += `<p class="formula">$$ I_{z} = I_{b,raw} \\times k_{temp} \\times k_{group} \\times k_{soil} \\times k_{depth} $$</p>`;
                calculationHtml += `<ul><li>Raw Base Ampacity (I<sub>b,raw</sub>) for size ${size} ${standard === 'iec' ? 'mm²' : 'AWG/kcmil'} ${material} cable with ${insulation.toUpperCase()} insulation (Ref: ${standard.toUpperCase()} tables): <strong>${Ib_raw} A</strong>.</li></ul>`;

                // 4. Determine Correction Factors
                // Temperature Correction (k_temp)
                let tempRef = 30; // Default for NEC and IEC Air
                if (isBuried && standard === 'iec') {
                    tempRef = 20; // IEC default ground temp
                }
                // NEC uses 30C for both air and ground. IEC uses 30C for air, 20C for ground.
                // Our simple table is based on 30C. We must adjust.
                // This is a simplification; real tables are different.
                // Let's stick to the 30C reference table for simplicity as coded.
                let k_temp = interpolateFactor(tempCorrectionFactors[insulation], ambientTemp);
                calculationHtml += `<ul><li>Ambient Temperature Correction (k<sub>temp</sub>) for ${ambientTemp}℃ (Ref 30°C): <strong>${k_temp.toFixed(3)}</strong>.</li></ul>`;

                // Grouping Correction (k_group)
                let k_group = 1.0;
                const effectiveNumCircuits = Math.min(numCircuits, 42);
                k_group = interpolateFactor(groupingCorrectionFactors, effectiveNumCircuits);
                if (numCircuits > 1) {
                    calculationHtml += `<ul><li>Grouping Correction (k<sub>group</sub>) for ${numCircuits} circuits: <strong>${k_group.toFixed(3)}</strong>.</li></ul>`;
                }

                // Soil Resistivity (k_soil) and Depth (k_depth)
                let k_soil = 1.0;
                let k_depth = 1.0;
                if (isBuried) {
                    k_soil = interpolateFactor(soilResistivityCorrectionFactors, soilResistivity);
                    calculationHtml += `<ul><li>Soil Resistivity Correction (k<sub>soil</sub>) for ${soilResistivity} K·m/W (Ref 2.5): <strong>${k_soil.toFixed(3)}</strong>.</li></ul>`;
                    k_depth = interpolateFactor(depthCorrectionFactors, depthOfBurial);
                    calculationHtml += `<ul><li>Depth of Burial Correction (k<sub>depth</sub>) for ${depthOfBurial} m (Ref 0.7m): <strong>${k_depth.toFixed(3)}</strong>.</li></ul>`;
                }

                // 5. Calculate Final Ampacity (Iz)
                const Iz = Ib_raw * k_temp * k_group * k_soil * k_depth;
                calculationHtml += `<p class="calculation-step">$$ I_z = ${Ib_raw} \\times ${k_temp.toFixed(3)} \\times ${k_group.toFixed(3)} \\times ${k_soil.toFixed(3)} \\times ${k_depth.toFixed(3)} = \\mathbf{${Iz.toFixed(2)} \\text{ A}} $$</p>`;

                // --- Voltage Drop Calculation ---
                let voltageDropV = 0;
                let voltageDropPercent = 0;
                let R_per_km, X_per_km;

                try {
                    const impedanceData = conductorImpedance[material][standard][size];
                    if (!impedanceData) throw new Error("Impedance data not found.");
                    R_per_km = impedanceData.R;
                    X_per_km = impedanceData.X;
                } catch (e) {
                    throw new Error(`Impedance data not found for voltage drop calculation.`);
                }
                
                const R_total = R_per_km * (cableLength / 1000);
                const X_total = X_per_km * (cableLength / 1000);
                const powerFactor = 0.8; // Assume 0.8 lagging PF for motor/industrial loads
                const cosPhi = powerFactor;
                const sinPhi = Math.sqrt(1 - (cosPhi * cosPhi)); 

                if (phaseType === 'single-phase') {
                    voltageDropV = 2 * loadCurrent * (R_total * cosPhi + X_total * sinPhi);
                } else { // Three-phase
                    voltageDropV = Math.sqrt(3) * loadCurrent * (R_total * cosPhi + X_total * sinPhi);
                }
                voltageDropPercent = (voltageDropV / systemVoltageVd) * 100;

                calculationHtml += `<h4>2. Voltage Drop ($$\\Delta V$$)</h4>`;
                calculationHtml += `<ul>                                    <li>Conductor Impedance (Ref): ${R_per_km.toFixed(3)} &Omega;/km (R), ${X_per_km.toFixed(3)} &Omega;/km (X)</li>                                    <li>Total Impedance for ${cableLength} m: ${R_total.toFixed(3)} &Omega; (R), ${X_total.toFixed(3)} &Omega; (X)</li>                                    <li>Assumed Power Factor (cos φ): ${powerFactor.toFixed(2)} (lagging)</li>                                </ul>`;
                if (phaseType === 'single-phase') {
                    calculationHtml += `<p class="formula">$$ \\Delta V = 2 \\times I_{load} \\times (R_{total} \\cos\\phi + X_{total} \\sin\\phi) $$</p>`;
                    calculationHtml += `<p class="calculation-step">$$ \\Delta V = 2 \\times ${loadCurrent} \\times (${R_total.toFixed(3)} \\times ${cosPhi.toFixed(2)} + ${X_total.toFixed(3)} \\times ${sinPhi.toFixed(2)}) = \\mathbf{${voltageDropV.toFixed(2)} \\text{ V}} $$</p>`;
                } else {
                    calculationHtml += `<p class="formula">$$ \\Delta V = \\sqrt{3} \\times I_{load} \\times (R_{total} \\cos\\phi + X_{total} \\sin\\phi) $$</p>`;
                    calculationHtml += `<p class="calculation-step">$$ \\Delta V = \\sqrt{3} \\times ${loadCurrent} \\times (${R_total.toFixed(3)} \\times ${cosPhi.toFixed(2)} + ${X_total.toFixed(3)} \\times ${sinPhi.toFixed(2)}) = \\mathbf{${voltageDropV.toFixed(2)} \\text{ V}} $$</p>`;
                }
                calculationHtml += `<p class="calculation-step">$$ \\text{%VD} = (${voltageDropV.toFixed(2)} \\text{ V} / ${systemVoltageVd} \\text{ V}) \\times 100 = \\mathbf{${voltageDropPercent.toFixed(2)} \\%} $$</p>`;

                if (voltageDropPercent > 5) {
                    calculationHtml += `<p style="color:var(--danger); font-weight:bold;">Warning: Voltage drop (${voltageDropPercent.toFixed(2)}%) exceeds the typical recommended maximum (e.g., 3-5%). Consider increasing conductor size.</p>`;
                }

                // --- Short-Circuit Current Withstand Calculation ---
                let shortCircuitWithstandkA = 0;
                let kFactor = 0;

                try {
                    kFactor = kFactorsShortCircuit[material][insulation];
                    if (!kFactor) throw new Error("K-factor data not found.");
                } catch (e) {
                    throw new Error(`K-factor data not found for short-circuit calculation.`);
                }
                
                let conductorSizeSqMm = 0;
                if (standard === 'nec') {
                    const necToIecConversion = {
                        '14': 2.08, '12': 3.31, '10': 5.26, '8': 8.37, '6': 13.3, '4': 21.2, '3': 26.7, '2': 33.6,
                        '1': 42.4, '1/0': 53.5, '2/0': 67.4, '3/0': 85.0, '4/0': 107.2,
                        '250': 126.7, '300': 152.0, '350': 177.3, '400': 202.7, '500': 253.3,
                        '600': 304.0, '700': 354.7, '750': 380.0, '800': 405.3, '1000': 506.7
                    };
                    conductorSizeSqMm = necToIecConversion[size];
                    if (!conductorSizeSqMm) throw new Error(`Conductor size conversion failed for ${size} AWG.`);
                } else {
                    conductorSizeSqMm = parseFloat(size);
                }

                if (faultDuration > 0 && conductorSizeSqMm > 0) {
                    shortCircuitWithstandkA = (conductorSizeSqMm * kFactor) / (Math.sqrt(faultDuration) * 1000); // kA
                } else {
                    throw new Error("Fault duration or conductor size is invalid.");
                }

                calculationHtml += `<h4>3. Short-Circuit Withstand ($$I_{sc,withstand}$$)</h4>`;
                calculationHtml += `<p>This is the adiabatic withstand current of the cable (Ref: IEC 60364-5-54).</p>`;
                calculationHtml += `<ul>                                    <li>Conductor Area (A): ${conductorSizeSqMm.toFixed(2)} mm²</li>                                    <li>K-factor (k) for ${material} ${insulation.toUpperCase()}: ${kFactor}</li>                                    <li>Fault Duration (t): ${faultDuration.toFixed(2)} s</li>                                </ul>`;
                calculationHtml += `<p class="formula">$$ I_{sc,withstand} (kA) = \\frac{A \\times k}{1000 \\times \\sqrt{t}} $$</p>`;
                calculationHtml += `<p class="calculation-step">$$ I_{sc,withstand} = \\frac{${conductorSizeSqMm.toFixed(2)} \\times ${kFactor}}{1000 \\times \\sqrt{${faultDuration.toFixed(2)}}} = \\mathbf{${shortCircuitWithstandkA.toFixed(2)} \\text{ kA}} $$</p>`;

                // 6. Display Results
                calculationDetailsDiv.innerHTML = calculationHtml;
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv]);
                }

                resultTableBody.innerHTML = '';
                addResultRow("<strong>Final Corrected Ampacity (I<sub>z</sub>)</strong>", `<strong>${Iz.toFixed(2)} A</strong>`);
                addResultRow("<strong>Voltage Drop</strong>", `<strong>${voltageDropV.toFixed(2)} V (${voltageDropPercent.toFixed(2)} %)</strong>`);
                addResultRow("<strong>Short-Circuit Withstand (t=${faultDuration}s)</strong>", `<strong>${shortCircuitWithstandkA.toFixed(2)} kA</strong>`);
                
                addResultRow("--- Ampacity Inputs ---", "---");
                addResultRow("Selected Standard", standard.toUpperCase() === 'IEC' ? 'IEC 60364-5-52' : 'NEC (NFPA 70)');
                addResultRow("Base Ampacity (I<sub>b,raw</sub>)", `${Ib_raw} A`);
                addResultRow("Ambient Temperature", `${ambientTemp}℃`);
                addResultRow("Number of Grouped Circuits", numCircuits);
                addResultRow("Temp. Correction (k<sub>temp</sub>)", k_temp.toFixed(3));
                addResultRow("Grouping Correction (k<sub>group</sub>)", k_group.toFixed(3));
                if (isBuried) {
                    addResultRow("Soil Resistivity", `${soilResistivity} K·m/W`);
                    addResultRow("Depth of Burial", `${depthOfBurial} m`);
                    addResultRow("Soil Correction (k<sub>soil</sub>)", k_soil.toFixed(3));
                    addResultRow("Depth Correction (k<sub>depth</sub>)", k_depth.toFixed(3));
                }

                addResultRow("--- Voltage Drop Inputs ---", "---");
                addResultRow("Load Current", `${loadCurrent} A`);
                addResultRow("System Voltage", `${systemVoltageVd} V`);
                addResultRow("Cable Length", `${cableLength} m`);
                addResultRow("Phase Type", phaseType.replace('-', ' ').charAt(0).toUpperCase() + phaseType.replace('-', ' ').slice(1));
                
                addResultRow("--- Short-Circuit Inputs ---", "---");
                addResultRow("Conductor Area (A)", `${conductorSizeSqMm.toFixed(2)} mm²`);
                addResultRow("K-factor (k)", kFactor);

                standardReferenceDiv.innerHTML = `Calculation is based on methodologies and simplified data derived from:
                    <ul>
                        <li><strong>IEC 60364-5-52:2009</strong> (Low-voltage electrical installations - Part 5-52).</li>
                        <li><strong>NEC (NFPA 70)</strong>, specifically referencing Table 310.16.</li>
                        <li><strong>IEC 60909</strong> & <strong>IEEE Std 242 (Buff Book)</strong> principles for short-circuit current withstand.</li>
                    </ul>
                    <p><strong>Disclaimer:</strong> This tool provides an estimate; always refer to the complete official standards, manufacturer data, and local codes for accurate design, safety verification, and compliance.</p>`;

                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 50);

                // Update email share link
                const emailSubject = encodeURIComponent("Cable Ampacity & Sizing Calculation Results");
                const emailBody = encodeURIComponent(
                    `Here are the cable calculation results from Design Calculators (https://designcalculators.co.in):\n\n` +
                    `--- KEY RESULTS ---\n` +
                    `Final Corrected Ampacity (Iz): ${Iz.toFixed(2)} A\n` +
                    `Voltage Drop: ${voltageDropV.toFixed(2)} V (${voltageDropPercent.toFixed(2)} %)\n` +
                    `Short-Circuit Withstand (${faultDuration}s): ${shortCircuitWithstandkA.toFixed(2)} kA\n\n` +
                    `--- INPUTS ---\n` +
                    `Standard: ${standard.toUpperCase()}\n` +
                    `Conductor: ${size} ${standard === 'iec' ? 'mm²' : 'AWG/kcmil'} ${material}\n` +
                    `Insulation: ${insulation.toUpperCase()}\n` +
                    `Installation: ${installationMethodSelect.options[installationMethodSelect.selectedIndex].text}\n` +
                    `Ambient Temp: ${ambientTemp}℃\n` +
                    `Grouping: ${numCircuits} circuits\n` +
                    (isBuried ? `Soil Resistivity: ${soilResistivity} K·m/W\n` : '') +
                    (isBuried ? `Depth of Burial: ${depthOfBurial} m\n` : '') +
                    `Load Current: ${loadCurrent} A\n` +
                    `Cable Length: ${cableLength} m\n`
                );
                emailShareBtn.href = `mailto:?subject=${emailSubject}&body=${emailBody}`;

            } catch (e) {
                displayMessage(e.message, "error");
                // Hide results on error
                resultContainer.classList.remove('show');
                setTimeout(() => { resultContainer.style.display = 'none'; }, 500);
            }
        }

        function addResultRow(parameter, value) {
            const row = resultTableBody.insertRow();
            const paramCell = row.insertCell();
            const valueCell = row.insertCell();
            paramCell.innerHTML = parameter;
            valueCell.innerHTML = value;
        }

        function displayMessage(message, type = "info") {
            const messageBox = document.getElementById('custom-message-box');
            messageBox.textContent = message;
            messageBox.style.display = 'block';

            if (type === "error") {
                messageBox.style.backgroundColor = 'var(--danger)';
            } else if (type === "warning") {
                messageBox.style.backgroundColor = 'var(--warning)';
                messageBox.style.color = 'var(--heading)'; // Use dark text on yellow
            } else {
                messageBox.style.backgroundColor = 'var(--success)';
                messageBox.style.color = 'white';
            }
            messageBox.style.opacity = 1;

            if (messageBox.timeoutId) {
                clearTimeout(messageBox.timeoutId);
            }
            messageBox.timeoutId = setTimeout(() => {
                messageBox.style.opacity = 0;
                setTimeout(() => { messageBox.style.display = 'none';}, 500);
            }, 5000);
        }

        // --- THEME SWITCH LOGIC ---
        const themeSwitch = document.getElementById('theme-switch');
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeSwitch.checked = true;
        }
        themeSwitch.addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            }
        });

        // --- INITIALIZE FORM ---
        updateFormOptions();
    });
    </script>
</body>
</html>

