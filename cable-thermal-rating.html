<!DOCTYPE html>
<html lang="en"> 
<head>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');   
    </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cable Ampacity Calculator - Design Calculators - Electrical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- MathJax for LaTeX rendering -->
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        /* Basic CSS Variables for a consistent theme (Blue-based) */
        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #0056b3; /* Darker Blue */
            --accent-color: #28a745; /* Green for success/highlight */
            --bg-color: #f8f9fa; /* Light background */
            --card-bg: #ffffff; /* White card background */
            --text-color: #343a40; /* Dark grey text */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #212529; /* Even darker footer */
            --border-color: #dee2e6;
            --card-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --hover-color: #e9ecef;
            --input-bg: #ffffff;
            --input-border: #ced4da;
            --button-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --primary-color: #66b3ff; /* Lighter Blue for dark mode */
            --secondary-color: #3385ff;
            --accent-color: #2ecc71; /* Green */
            --bg-color: #2c3e50; /* Dark blue-grey */
            --card-bg: #34495e; /* Slightly lighter dark blue-grey */
            --text-color: #ecf0f1; /* Light text */
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #4a627a;
            --card-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.4);
            --hover-color: #4a627a;
            --input-bg: #4a627a;
            --input-border: #6c88a4;
            --button-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.5s ease-in-out, color 0.5s ease-in-out;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        header {
            background-color: var(--header-bg); /* Solid color, as per original */
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
            animation: fadeInDown 1s ease-out;
        }

        header h1 {
            margin: 0;
            font-size: 2.8em;
            color: var(--primary-color); /* Primary color for H1 */
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1.1em;
            color: #bdc3c7; /* Original subtitle color */
        }

        main {
            flex: 1;
            padding: 30px 0;
            animation: fadeInUp 1s ease-out 0.3s forwards;
            opacity: 0; /* Start hidden for animation */
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .tool-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.2);
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color); /* Reverted to 2px */
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 2em;
            text-align: center;
        }

        .tool-description {
            margin-bottom: 30px;
            color: var(--text-color);
            font-size: 1.1em;
            text-align: justify;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 25px;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            font-weight: bold;
            box-shadow: var(--button-shadow);
        }

        .back-button i {
            margin-right: 8px;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            font-size: 1.3em;
            transition: color 0.3s ease-in-out;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 -0.5rem 1rem rgba(0, 0, 0, 0.15);
            margin-top: 40px;
            animation: fadeInUp 1s ease-out 0.5s forwards;
            opacity: 0; /* Start hidden for animation */
        }
        
        footer .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
            gap: 20px;
        }

        footer .disclaimer, footer .social-share, footer .credit {
            flex: 1 1 280px;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.05);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }

        footer .disclaimer h3, footer .social-share h3, footer .credit h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.4em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        footer .credit p {
            font-size: 0.95em;
            color: #bdc3c7;
            margin: 10px 0;
        }

        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.4em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #EA4335; }

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 1.05em;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-color);
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); /* Blue shadow for focus */
            outline: none;
        }
        
        .form-row {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1 1 calc(50% - 12.5px); /* Adjusted for gap */
            min-width: 250px; /* Ensure minimum width for smaller screens */
        }
        
        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 20px;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: var(--button-shadow);
            width: auto; /* Allow button to size naturally */
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .calculate-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }

        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        
        .result-container {
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            opacity: 0; /* Start hidden for animation */
            transition: opacity 0.6s ease-out; /* Only opacity transition */
            border: 1px solid var(--border-color);
        }
        
        .result-container.show {
            opacity: 1;
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners on table */
        }
        
        .result-table th, .result-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            color: var(--primary-color);
            text-transform: uppercase;
            font-size: 0.95em;
        }

        .result-table tbody tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color);
            transition: background-color 0.3s ease-in-out;
        }
        
        .standard-reference {
            margin-top: 25px;
            font-style: italic;
            font-size: 0.95rem;
            background-color: var(--hover-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--primary-color);
            color: var(--text-color);
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 8px;
            cursor: help;
            font-size: 0.9em;
            transition: transform 0.2s ease-in-out;
        }

        .info-icon:hover {
            transform: scale(1.2);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            font-size: 0.85em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, background-color 0.3s ease-in-out;
            display: none;
            min-width: 250px;
            text-align: center;
        }

        /* Styles for calculation details */
        #calculation-details {
            background-color: var(--hover-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            font-size: 0.95em;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
        }
        #calculation-details h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
            text-align: center;
        }
        #calculation-details p.formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px dashed var(--primary-color);
        }
        #calculation-details p.calculation-step {
            font-family: 'Courier New', monospace;
            background-color: var(--hover-color);
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid var(--accent-color);
        }
        #calculation-details ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 15px;
        }
        #calculation-details ul li {
            margin-bottom: 8px;
            padding-left: 25px;
            position: relative;
        }
        #calculation-details ul li::before {
            content: "\f058"; /* FontAwesome check-circle icon */
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            color: var(--accent-color);
            position: absolute;
            left: 0;
            top: 0;
        }

        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            header .subtitle {
                font-size: 0.9em;
            }
            .theme-toggle {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }
            .tool-container, .calculator-form, .result-container {
                padding: 20px;
            }
            .tool-container h2 {
                font-size: 1.6em;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .form-row .form-group {
                flex: 1 1 100%;
                min-width: unset;
            }
            .back-button {
                width: 100%;
                justify-content: center;
            }
            footer .container {
                flex-direction: column;
                align-items: center;
            }
            footer .disclaimer, footer .social-share, footer .credit {
                flex: 1 1 100%;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            header {
                padding: 15px 0;
            }
            header h1 {
                font-size: 1.8em;
            }
            .back-button {
                padding: 10px 15px;
                font-size: 0.9em;
            }
            .calculate-btn {
                padding: 12px 20px;
                font-size: 1em;
            }
            .result-table th, .result-table td {
                padding: 10px;
                font-size: 0.9em;
            }
            .tooltip .tooltiptext {
                width: 180px;
                margin-left: -90px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy ！ Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        
        <div class="tool-container">
            <h2>Cable Ampacity Calculator</h2>
            
            <div class="tool-description">
                <p>This tool calculates the current-carrying capacity (ampacity) of electrical cables based on recognized international standards. It considers various factors such as conductor material, insulation type, installation method, ambient temperature, and grouping effects to provide a corrected ampacity value. Additionally, it provides estimates for **Voltage Drop** and **Short-Circuit Current Withstand**, crucial for comprehensive cable sizing and protection in industrial systems. The calculation adheres to principles outlined in **IEC 60364-5-52 (Low-voltage electrical installations - Part 5-52: Selection and erection of electrical equipment - Wiring systems)** and **NEC (NFPA 70) (National Electrical Code)**, ensuring compliance with industry best practices.</p>
            </div>
        
            <div class="calculator-form">
                <form id="ampacity-form">
                    <!-- Standard and General Inputs -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="standard">Standard <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the electrical standard to base the calculation on. IEC and NEC have different reference conditions and tables.</span></span></label>
                            <select id="standard" required>
                                <option value="iec">IEC 60364-5-52</option>
                                <option value="nec">NEC (NFPA 70)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conductor-material">Conductor Material <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Copper has higher conductivity and ampacity than Aluminum for the same size.</span></span></label>
                            <select id="conductor-material" required>
                                <option value="copper">Copper</option>
                                <option value="aluminum">Aluminum</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Cable Specifications -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conductor-size">Conductor Size <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Cross-sectional area of the conductor. Select the appropriate unit based on the chosen standard.</span></span></label>
                            <select id="conductor-size" required></select>
                        </div>
                        <div class="form-group">
                            <label for="insulation-type">Insulation Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The maximum operating temperature of the insulation material is a key factor. XLPE/EPR can withstand higher temperatures than PVC.</span></span></label>
                            <select id="insulation-type" required>
                                <option value="pvc">PVC (70℃)</option>
                                <option value="xlpe">XLPE/EPR (90℃)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Installation Conditions -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="installation-method">Installation Method <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">How the cable is installed. Heat dissipation varies significantly between methods (e.g., in air vs. buried).</span></span></label>
                            <select id="installation-method" required></select>
                        </div>
                        <div class="form-group">
                            <label for="ambient-temp">Ambient Temperature (℃) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The temperature of the surrounding medium (air or ground) where the cable is installed. Higher ambient temperatures reduce ampacity.</span></span></label>
                            <input type="number" id="ambient-temp" value="30" step="1" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="num-circuits">Number of Circuits/Cables Grouped <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">When multiple cables are grouped, their mutual heating reduces individual ampacity. Enter the total number of cables in the group.</span></span></label>
                            <input type="number" id="num-circuits" value="1" min="1" step="1" required>
                        </div>
                        <div class="form-group" id="soil-resistivity-group">
                            <label for="soil-resistivity">Soil Thermal Resistivity (K·m/W) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">A measure of how well soil dissipates heat. Typical value is 2.5. Dry, sandy soil has higher resistivity (poorer heat dissipation).</span></span></label>
                            <input type="number" id="soil-resistivity" value="2.5" step="0.1" required>
                        </div>
                    </div>
                    
                    <!-- New: Depth of Burial Input -->
                    <div class="form-row">
                        <div class="form-group" id="depth-of-burial-group">
                            <label for="depth-of-burial">Depth of Burial (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The depth at which the cable is buried. Deeper burial can reduce ampacity due to less efficient heat dissipation. Typical values range from 0.5m to 1.5m.</span></span></label>
                            <input type="number" id="depth-of-burial" value="0.7" step="0.1" min="0.1" required>
                        </div>
                    </div>

                    <!-- New Section: Voltage Drop Calculation Inputs -->
                    <h4 class="section-title" style="margin-top: 40px;">Voltage Drop Calculation Parameters</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="load-current">Load Current (A) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The actual current drawn by the load connected to the cable. Used for voltage drop calculation.</span></span></label>
                            <input type="number" id="load-current" value="100" min="0.1" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="system-voltage-vd">System Voltage (V) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The nominal line-to-line voltage of the system. Used for voltage drop percentage calculation.</span></span></label>
                            <input type="number" id="system-voltage-vd" value="400" min="1" step="1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cable-length">Cable Length (m) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The one-way length of the cable run. Longer cables result in higher voltage drop.</span></span></label>
                            <input type="number" id="cable-length" value="50" min="1" step="1" required>
                        </div>
                        <div class="form-group">
                            <label for="phase-type">System Phase Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select if the system is single-phase or three-phase. This affects the voltage drop calculation formula.</span></span></label>
                            <select id="phase-type" required>
                                <option value="single-phase">Single-Phase</option>
                                <option value="three-phase">Three-Phase</option>
                            </select>
                        </div>
                    </div>

                    <!-- New Section: Short-Circuit Current Withstand Calculation Inputs -->
                    <h4 class="section-title" style="margin-top: 40px;">Short-Circuit Current Withstand Parameters</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fault-duration">Fault Duration (seconds) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The duration of the short-circuit fault, typically determined by the upstream protective device's clearing time.</span></span></label>
                            <input type="number" id="fault-duration" value="0.1" min="0.01" step="0.01" required>
                        </div>
                    </div>

                    <button type="button" id="calculate-btn" class="calculate-btn">Calculate Ampacity & More</button>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Cable Ampacity Results</h3>
                <div id="calculation-details">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <h3>Credit</h3>
                <p>Developed by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share">
                <h3>Share This Tool</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Cable%20Ampacity%20Calculator" target="_blank" class="social-btn linkedin"><i class="fab fa-linkedin"></i></a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook"><i class="fab fa-facebook"></i></a>
                    <a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20Cable%20Ampacity%20Calculator!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter"><i class="fab fa-twitter"></i></a>
                    <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20Cable%20Ampacity%20Calculator!%20https://designcalculators.co.in" target="_blank" class="social-btn whatsapp"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Cable%20Ampacity%20Calculator" target="_blank" class="social-btn reddit"><i class="fab fa-reddit"></i></a>
                    <a href="#" id="email-share-btn" class="social-btn email"><i class="fas fa-envelope"></i></a>
                </div>
            </div>
        </div>
    </footer>
    
    <div id="custom-message-box"></div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- DATABASE & DATA TABLES ---
        // These tables are simplified representations based on common values from standards.
        // In a real-world, comprehensive tool, these would be much larger and more detailed,
        // potentially fetched from a backend or a larger JSON file.

        // IEC Base Ampacity (Table 52-B1 of IEC 60364-5-52) - Amps
        // Reference: 30℃ ambient air, 90℃ conductor temp (XLPE), single circuit, 3-core cable in conduit
        const iecBaseAmpacity = {
            copper: { // Conductor: Copper
                xlpe: { // Insulation: XLPE (90C)
                    '1.5': 21, '2.5': 28, '4': 38, '6': 49, '10': 68, '16': 90,
                    '25': 118, '35': 147, '50': 175, '70': 222, '95': 269, '120': 310,
                    '150': 354, '185': 404, '240': 477, '300': 550, '400': 650, '500': 750, '630': 870 // Added larger sizes
                },
                pvc: { // Insulation: PVC (70C)
                    '1.5': 16, '2.5': 22, '4': 30, '6': 38, '10': 53, '16': 70,
                    '25': 92, '35': 114, '50': 136, '70': 172, '95': 209, '120': 240,
                    '150': 275, '185': 314, '240': 370, '300': 428, '400': 500, '500': 570, '630': 650 // Added larger sizes
                }
            },
            aluminum: { // Conductor: Aluminum
                xlpe: {
                    '2.5': 22, '4': 30, '6': 38, '10': 53, '16': 70, '25': 92,
                    '35': 114, '50': 136, '70': 172, '95': 209, '120': 240,
                    '150': 275, '185': 314, '240': 370, '300': 428, '400': 500, '500': 570, '630': 650 // Added larger sizes
                },
                pvc: {
                    '2.5': 17, '4': 23, '6': 30, '10': 41, '16': 55, '25': 72,
                    '35': 89, '50': 106, '70': 134, '95': 163, '120': 187,
                    '150': 214, '185': 244, '240': 288, '300': 333, '400': 390, '500': 440, '630': 500 // Added larger sizes
                }
            }
        };

        // NEC Base Ampacity (Table 310.16) - Amps
        // Reference: 30℃ ambient air, 3 conductors in raceway
        const necBaseAmpacity = {
            copper: {
                xlpe: { // 90C column (THHN, XHHW-2, etc.)
                    '14': 25, '12': 30, '10': 40, '8': 55, '6': 75, '4': 95, '3': 110,
                    '2': 130, '1': 150, '1/0': 170, '2/0': 195, '3/0': 225, '4/0': 260,
                    '250': 290, '300': 320, '350': 350, '400': 380, '500': 430, '600': 475, '700': 520, '750': 535, '800': 555, '1000': 610 // Added larger sizes
                },
                pvc: { // 75C column (THW, RHW, etc. - most common termination rating)
                    '14': 20, '12': 25, '10': 35, '8': 50, '6': 65, '4': 85, '3': 100,
                    '2': 115, '1': 130, '1/0': 150, '2/0': 175, '3/0': 200, '4/0': 230,
                    '250': 255, '300': 285, '350': 310, '400': 335, '500': 380, '600': 420, '700': 455, '750': 470, '800': 490, '1000': 545 // Added larger sizes
                }
            },
            aluminum: {
                xlpe: { // 90C column
                    '12': 25, '10': 35, '8': 45, '6': 60, '4': 75, '3': 85, '2': 100,
                    '1': 115, '1/0': 135, '2/0': 150, '3/0': 175, '4/0': 205,
                    '250': 230, '300': 255, '350': 280, '400': 305, '500': 350, '600': 385, '700': 420, '750': 435, '800': 450, '1000': 500 // Added larger sizes
                },
                pvc: { // 75C column
                    '12': 20, '10': 30, '8': 40, '6': 50, '4': 65, '3': 75, '2': 90,
                    '1': 100, '1/0': 120, '2/0': 135, '3/0': 155, '4/0': 180,
                    '250': 205, '300': 230, '350': 250, '400': 270, '500': 310, '600': 340, '700': 370, '750': 385, '800': 400, '1000': 445 // Added larger sizes
                }
            }
        };
        
        // Correction Factors (Ka) for Ambient Air Temp (Based on 30℃ reference)
        // More granular data for better accuracy
        const tempCorrectionFactors = {
            pvc: { // 70C insulation
                '20': 1.08, '25': 1.04, '30': 1.00, '35': 0.96, '40': 0.91,
                '45': 0.87, '50': 0.82, '55': 0.76, '60': 0.71, '65': 0.65, '70': 0.58
            },
            xlpe: { // 90C insulation
                '20': 1.08, '25': 1.04, '30': 1.00, '35': 0.96, '40': 0.91,
                '45': 0.87, '50': 0.82, '55': 0.76, '60': 0.71, '65': 0.65, '70': 0.58,
                '75': 0.50, '80': 0.41, '85': 0.32, '90': 0.22
            }
        };

        // Grouping Correction Factors (Kg) - More detailed for 1-42 conductors
        // Based on IEC 60364-5-52 Table B.52.17 and NEC Table 310.15(B)(3)(a) principles.
        const groupingCorrectionFactors = {
            '1': 1.00, '2': 0.80, '3': 0.70, '4': 0.65, '5': 0.60,
            '6': 0.57, '7': 0.54, '8': 0.52, '9': 0.50, '10': 0.48,
            '11': 0.47, '12': 0.46, '13': 0.45, '14': 0.44, '15': 0.43,
            '16': 0.42, '17': 0.41, '18': 0.40, '19': 0.39, '20': 0.38,
            '21': 0.37, '22': 0.36, '23': 0.35, '24': 0.34, '25': 0.33,
            '26': 0.32, '27': 0.31, '28': 0.30, '29': 0.29, '30': 0.28,
            '31': 0.27, '32': 0.26, '33': 0.25, '34': 0.24, '35': 0.23,
            '36': 0.22, '37': 0.21, '38': 0.20, '39': 0.19, '40': 0.18,
            '41': 0.17, '42': 0.16 // Max for this simplified table, beyond this, factors become very low
        };
        
        // Soil Thermal Resistivity Correction Factors (Kp) (Ref: IEC, 20℃ ground temp, 2.5 K·m/W reference)
        // More granular data
        const soilResistivityCorrectionFactors = {
            '0.5': 1.25, '1.0': 1.18, '1.5': 1.10, '2.0': 1.05, '2.5': 1.00,
            '3.0': 0.96, '3.5': 0.92, '4.0': 0.88, '4.5': 0.84, '5.0': 0.80
        };

        // Depth of Burial Correction Factors (Kd) - More granular (Ref: IEC, for direct buried cables)
        // Reference depth is typically 0.7m. Values vary with soil type and cable type.
        const depthCorrectionFactors = {
            '0.3': 1.10, '0.4': 1.07, '0.5': 1.05, '0.6': 1.02, '0.7': 1.00,
            '0.8': 0.98, '0.9': 0.96, '1.0': 0.95, '1.1': 0.93, '1.2': 0.92,
            '1.3': 0.90, '1.4': 0.89, '1.5': 0.88, '1.6': 0.87, '1.7': 0.86,
            '1.8': 0.85, '1.9': 0.84, '2.0': 0.83 // Extended depth range
        };

        // Conductor Resistance and Reactance (Ohms/km at 75℃/90℃) - Simplified for common sizes
        // These values are highly dependent on temperature, frequency, and construction.
        // For accurate results, refer to manufacturer data or detailed standards.
        const conductorImpedance = {
            copper: {
                iec: { // mm2
                    '1.5': { R: 12.1, X: 0.09 }, '2.5': { R: 7.41, X: 0.09 }, '4': { R: 4.61, X: 0.09 },
                    '6': { R: 3.08, X: 0.09 }, '10': { R: 1.83, X: 0.09 }, '16': { R: 1.15, X: 0.09 },
                    '25': { R: 0.734, X: 0.08 }, '35': { R: 0.524, X: 0.08 }, '50': { R: 0.387, X: 0.08 },
                    '70': { R: 0.272, X: 0.08 }, '95': { R: 0.206, X: 0.08 }, '120': { R: 0.161, X: 0.08 },
                    '150': { R: 0.129, X: 0.08 }, '185': { R: 0.106, X: 0.07 }, '240': { R: 0.0801, X: 0.07 },
                    '300': { R: 0.0641, X: 0.07 }, '400': { R: 0.0480, X: 0.07 }, '500': { R: 0.0384, X: 0.06 },
                    '630': { R: 0.0304, X: 0.06 }
                },
                nec: { // AWG/kcmil
                    '14': { R: 8.28, X: 0.08 }, '12': { R: 5.21, X: 0.08 }, '10': { R: 3.28, X: 0.08 },
                    '8': { R: 2.07, X: 0.08 }, '6': { R: 1.30, X: 0.08 }, '4': { R: 0.82, X: 0.08 },
                    '3': { R: 0.65, X: 0.08 }, '2': { R: 0.51, X: 0.08 }, '1': { R: 0.41, X: 0.08 },
                    '1/0': { R: 0.32, X: 0.08 }, '2/0': { R: 0.26, X: 0.08 }, '3/0': { R: 0.20, X: 0.08 },
                    '4/0': { R: 0.16, X: 0.08 }, '250': { R: 0.13, X: 0.08 }, '300': { R: 0.11, X: 0.08 },
                    '350': { R: 0.09, X: 0.08 }, '400': { R: 0.08, X: 0.08 }, '500': { R: 0.06, X: 0.08 },
                    '600': { R: 0.05, X: 0.08 }, '700': { R: 0.04, X: 0.08 }, '750': { R: 0.04, X: 0.08 },
                    '800': { R: 0.03, X: 0.08 }, '1000': { R: 0.03, X: 0.08 }
                }
            },
            aluminum: {
                iec: { // mm2
                    '2.5': { R: 12.1, X: 0.09 }, '4': { R: 7.41, X: 0.09 }, '6': { R: 4.61, X: 0.09 },
                    '10': { R: 3.08, X: 0.09 }, '16': { R: 1.83, X: 0.09 }, '25': { R: 1.15, X: 0.09 },
                    '35': { R: 0.734, X: 0.08 }, '50': { R: 0.524, X: 0.08 }, '70': { R: 0.387, X: 0.08 },
                    '95': { R: 0.272, X: 0.08 }, '120': { R: 0.206, X: 0.08 }, '150': { R: 0.161, X: 0.08 },
                    '185': { R: 0.129, X: 0.08 }, '240': { R: 0.106, X: 0.07 }, '300': { R: 0.0801, X: 0.07 },
                    '400': { R: 0.0641, X: 0.07 }, '500': { R: 0.0480, X: 0.07 }, '630': { R: 0.0384, X: 0.06 }
                },
                nec: { // AWG/kcmil
                    '12': { R: 8.28, X: 0.08 }, '10': { R: 5.21, X: 0.08 }, '8': { R: 3.28, X: 0.08 },
                    '6': { R: 2.07, X: 0.08 }, '4': { R: 1.30, X: 0.08 }, '3': { R: 0.98, X: 0.08 },
                    '2': { R: 0.78, X: 0.08 }, '1': { R: 0.62, X: 0.08 }, '1/0': { R: 0.49, X: 0.08 },
                    '2/0': { R: 0.39, X: 0.08 }, '3/0': { R: 0.31, X: 0.08 }, '4/0': { R: 0.25, X: 0.08 },
                    '250': { R: 0.20, X: 0.08 }, '300': { R: 0.17, X: 0.08 }, '350': { R: 0.14, X: 0.08 },
                    '400': { R: 0.12, X: 0.08 }, '500': { R: 0.10, X: 0.08 }, '600': { R: 0.08, X: 0.08 },
                    '700': { R: 0.07, X: 0.08 }, '750': { R: 0.06, X: 0.08 }, '800': { R: 0.06, X: 0.08 },
                    '1000': { R: 0.05, X: 0.08 }
                }
            }
        };

        // K-factors for Short-Circuit Withstand (kA^2s/mm^4 or kA^2s/MCM^2)
        // From IEC 60909 and IEEE 242 (Buff Book) principles.
        // These values are approximations; actual values depend on specific cable construction,
        // initial and final temperatures, and material properties.
        const kFactorsShortCircuit = {
            copper: {
                pvc: 0.012, // For 70℃ insulation
                xlpe: 0.015 // For 90℃ insulation
            },
            aluminum: {
                pvc: 0.007, // For 70℃ insulation
                xlpe: 0.009 // For 90℃ insulation
            }
        };

        // --- UI ELEMENT REFERENCES ---
        const standardSelect = document.getElementById('standard');
        const conductorMaterialSelect = document.getElementById('conductor-material');
        const conductorSizeSelect = document.getElementById('conductor-size');
        const insulationTypeSelect = document.getElementById('insulation-type');
        const installationMethodSelect = document.getElementById('installation-method');
        const ambientTempInput = document.getElementById('ambient-temp');
        const numCircuitsInput = document.getElementById('num-circuits');
        const soilResistivityInput = document.getElementById('soil-resistivity');
        const soilResistivityGroup = document.getElementById('soil-resistivity-group');
        const depthOfBurialInput = document.getElementById('depth-of-burial'); 
        const depthOfBurialGroup = document.getElementById('depth-of-burial-group'); 
        const loadCurrentInput = document.getElementById('load-current'); // New
        const systemVoltageVdInput = document.getElementById('system-voltage-vd'); // New
        const cableLengthInput = document.getElementById('cable-length'); // New
        const phaseTypeSelect = document.getElementById('phase-type'); // New
        const faultDurationInput = document.getElementById('fault-duration'); // New
        const calculateBtn = document.getElementById('calculate-btn');
        const resultContainer = document.getElementById('result-container');
        const resultTableBody = document.getElementById('result-table-body');
        const calculationDetailsDiv = document.getElementById('calculation-details');
        const standardReferenceDiv = document.getElementById('standard-reference');
        const emailShareBtn = document.getElementById('email-share-btn'); 

        // --- DYNAMIC FORM LOGIC ---

        const iecSizes = ['1.5', '2.5', '4', '6', '10', '16', '25', '35', '50', '70', '95', '120', '150', '185', '240', '300', '400', '500', '630'];
        const necSizes = ['14', '12', '10', '8', '6', '4', '3', '2', '1', '1/0', '2/0', '3/0', '4/0', '250', '300', '350', '400', '500', '600', '700', '750', '800', '1000'];
        const iecInstallMethods = {
            'A1': 'Insulated conductors in conduit in a thermally insulated wall',
            'B1': 'Insulated conductors in conduit on a wooden wall',
            'C': 'Single-core or multi-core cable on a wooden wall',
            'E': 'Multi-core cable in free air (on perforated tray/ladder)',
            'F': 'Single-core cables, touching, in free air (on perforated tray/ladder)',
            'D1': 'Multi-core cable in conduit in the ground',
            'D2': 'Multi-core cable directly buried'
        };
        const necInstallMethods = {
            'in_raceway': 'In raceway or cable, in free air',
            'in_tray_ventilated': 'In ventilated cable tray (metallic or FRP), free air',
            'direct_burial': 'Direct burial'
        };

        function updateFormOptions() {
            const standard = standardSelect.value;
            
            // Update Conductor Sizes
            conductorSizeSelect.innerHTML = '';
            const sizes = standard === 'iec' ? iecSizes : necSizes;
            const unit = standard === 'iec' ? 'mm²' : 'AWG/kcmil';
            document.querySelector('label[for="conductor-size"]').innerHTML = `Conductor Size (${unit}) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Cross-sectional area of the conductor. Select the appropriate unit based on the chosen standard.</span></span>`;
            sizes.forEach(size => {
                const option = document.createElement('option');
                option.value = size;
                option.textContent = size;
                conductorSizeSelect.appendChild(option);
            });

            // Update Insulation Type options (NEC 75C for PVC)
            if (standard === 'nec') {
                document.querySelector('option[value="pvc"]').textContent = 'PVC (75℃)';
            } else {
                document.querySelector('option[value="pvc"]').textContent = 'PVC (70℃)';
            }

            // Update Installation Methods
            installationMethodSelect.innerHTML = '';
            const methods = standard === 'iec' ? iecInstallMethods : necInstallMethods;
            for (const key in methods) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = methods[key];
                installationMethodSelect.appendChild(option);
            }
            
            // Show/hide soil resistivity and depth of burial based on installation method
            updateBurialVisibility();
        }
        
        function updateBurialVisibility() {
            const method = installationMethodSelect.value;
            const isBuried = method.includes('D') || method.includes('burial');

            if (isBuried) {
                soilResistivityGroup.style.display = 'block';
                soilResistivityInput.setAttribute('required', 'true');
                depthOfBurialGroup.style.display = 'block';
                depthOfBurialInput.setAttribute('required', 'true');
            } else {
                soilResistivityGroup.style.display = 'none';
                soilResistivityInput.removeAttribute('required');
                depthOfBurialGroup.style.display = 'none';
                depthOfBurialInput.removeAttribute('required');
            }
        }

        // --- EVENT LISTENERS ---
        standardSelect.addEventListener('change', updateFormOptions);
        insulationTypeSelect.addEventListener('change', updateFormOptions); // Update insulation text on change
        installationMethodSelect.addEventListener('change', updateBurialVisibility);
        calculateBtn.addEventListener('click', calculateAmpacity);

        // --- HELPER FUNCTIONS FOR INTERPOLATION ---
        function interpolateFactor(table, value) {
            const keys = Object.keys(table).map(parseFloat).sort((a, b) => a - b);
            
            // If value is outside range, use the closest boundary value
            if (value <= keys[0]) return table[keys[0]];
            if (value >= keys[keys.length - 1]) return table[keys[keys.length - 1]];

            // Find the two closest keys
            let lowerKey = keys[0];
            let upperKey = keys[keys.length - 1];
            for (let i = 0; i < keys.length - 1; i++) {
                if (value >= keys[i] && value <= keys[i+1]) {
                    lowerKey = keys[i];
                    upperKey = keys[i+1];
                    break;
                }
            }

            const lowerValue = table[lowerKey];
            const upperValue = table[upperKey];

            // Linear interpolation
            return lowerValue + (upperValue - lowerValue) * ((value - lowerKey) / (upperKey - lowerKey));
        }

        // --- CALCULATION LOGIC ---
        function calculateAmpacity() {
            // 1. Get all inputs
            const standard = standardSelect.value;
            const material = conductorMaterialSelect.value;
            const size = conductorSizeSelect.value;
            const insulation = insulationTypeSelect.value;
            const installMethod = installationMethodSelect.value;
            const ambientTemp = parseFloat(ambientTempInput.value);
            const numCircuits = parseInt(numCircuitsInput.value);
            const soilResistivity = parseFloat(soilResistivityInput.value);
            const depthOfBurial = parseFloat(depthOfBurialInput.value);
            const loadCurrent = parseFloat(loadCurrentInput.value); // New
            const systemVoltageVd = parseFloat(systemVoltageVdInput.value); // New
            const cableLength = parseFloat(cableLengthInput.value); // New
            const phaseType = phaseTypeSelect.value; // New
            const faultDuration = parseFloat(faultDurationInput.value); // New

            // 2. Input Validation
            if (isNaN(ambientTemp) || isNaN(numCircuits) || isNaN(loadCurrent) || isNaN(systemVoltageVd) || isNaN(cableLength) || isNaN(faultDuration)) {
                displayMessage("Please fill all required fields with valid numbers.", "error");
                return;
            }
            if (numCircuits < 1 || numCircuits > 42) { // Max circuits for grouping factor table
                displayMessage("Number of circuits must be between 1 and 42 for accurate grouping factor. For more, consult specific tables.", "warning");
                // Continue calculation with max factor if outside range
            }
            // Ambient temperature validation
            const tempKeys = Object.keys(tempCorrectionFactors[insulation]).map(parseFloat);
            const minTemp = Math.min(...tempKeys);
            const maxTemp = Math.max(...tempKeys);
            if (ambientTemp < minTemp || ambientTemp > maxTemp) {
                displayMessage(`Ambient temperature (${ambientTemp}℃) is outside the typical range (${minTemp}℃ to ${maxTemp}℃) for standard correction factors. Results may be less accurate.`, "warning");
            }

            const isBuried = installationMethodSelect.value.includes('D') || installationMethodSelect.value.includes('burial');
            if (isBuried && (isNaN(soilResistivity) || isNaN(depthOfBurial))) {
                displayMessage("For buried installations, please provide valid numbers for Soil Thermal Resistivity and Depth of Burial.", "error");
                return;
            }
            if (isBuried) {
                const soilResKeys = Object.keys(soilResistivityCorrectionFactors).map(parseFloat);
                const minSoilRes = Math.min(...soilResKeys);
                const maxSoilRes = Math.max(...soilResKeys);
                if (soilResistivity < minSoilRes || soilResistivity > maxSoilRes) {
                    displayMessage(`Soil Thermal Resistivity (${soilResistivity} K·m/W) is outside the typical range (${minSoilRes} to ${maxSoilRes}). Results may be less accurate.`, "warning");
                }

                const depthKeys = Object.keys(depthCorrectionFactors).map(parseFloat);
                const minDepth = Math.min(...depthKeys);
                const maxDepth = Math.max(...depthKeys);
                if (depthOfBurial < minDepth || depthOfBurial > maxDepth) {
                    displayMessage(`Depth of Burial (${depthOfBurial} m) is outside the typical range (${minDepth}m to ${maxDepth}m). Results may be less accurate.`, "warning");
                }
            }

            // 3. Look up Base Ampacity (Ib)
            const baseAmpacityTable = standard === 'iec' ? iecBaseAmpacity : necBaseAmpacity;
            let Ib_raw = 0;
            try {
                Ib_raw = baseAmpacityTable[material][insulation][size];
                if (!Ib_raw) throw new Error();
            } catch (e) {
                displayMessage(`Base ampacity data not found for the selected combination: Conductor Material (${material}), Insulation Type (${insulation}), Size (${size}). Please check your inputs.`, "error");
                return;
            }

            let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
            
            // Add installation factor for trays (simplified for demonstration)
            let installFactor = 1.0;
            let installNote = '';
            if ((standard === 'iec' && (installMethod === 'E' || installMethod === 'F')) || (standard === 'nec' && installMethod === 'in_tray_ventilated')) {
                // This is a simplified example. Real factors depend on tray type, fill, etc.
                installFactor = 1.08; // Example factor for better cooling on trays compared to conduit
                installNote = `<li>Installation Method Factor (k<sub>install</sub>) for '${iecInstallMethods[installMethod] || necInstallMethods[installMethod]}': <strong>${installFactor}</strong> (applied to base ampacity due to improved heat dissipation).</li>`;
            }
            
            let Ib_adjusted_for_install = Ib_raw * installFactor;

            calculationHtml += `<p class="formula">$$ I_{z} = I_{b,raw} \\times k_{install} \\times k_{temp} \\times k_{group} \\times k_{soil} \\times k_{depth} $$</p>`;
            calculationHtml += `<ul><li>Raw Base Ampacity (I<sub>b,raw</sub>) for size ${size} ${standard === 'iec' ? 'mm²' : 'AWG/kcmil'} ${material} cable with ${insulation.toUpperCase()} insulation: <strong>${Ib_raw} A</strong>.</li>${installNote}</ul>`;
            
            // 4. Determine Correction Factors
            // Temperature Correction (k_temp) - using interpolation
            let k_temp = interpolateFactor(tempCorrectionFactors[insulation], ambientTemp);
            calculationHtml += `<ul><li>Ambient Temperature Correction Factor (k<sub>temp</sub>) for ${ambientTemp}℃ (interpolated from standard tables) is <strong>${k_temp.toFixed(3)}</strong>.</li></ul>`;

            // Grouping Correction (k_group) - using interpolation for intermediate values if needed, but primarily direct lookup
            let k_group = 1.0;
            if (numCircuits > 1) {
                // Ensure numCircuits doesn't exceed the max key in groupingCorrectionFactors
                const effectiveNumCircuits = Math.min(numCircuits, Math.max(...Object.keys(groupingCorrectionFactors).map(Number)));
                k_group = interpolateFactor(groupingCorrectionFactors, effectiveNumCircuits);
                calculationHtml += `<ul><li>Grouping Correction Factor (k<sub>group</sub>) for ${numCircuits} circuits (interpolated/looked up) is <strong>${k_group.toFixed(3)}</strong>.</li></ul>`;
            } else {
                calculationHtml += `<ul><li>Grouping Correction Factor (k<sub>group</sub>) is <strong>1.0</strong> (single circuit, no grouping effect).</li></ul>`;
            }

            // Soil Resistivity Correction (k_soil) and Depth of Burial Correction (k_depth)
            let k_soil = 1.0;
            let k_depth = 1.0;

            if (isBuried) {
                k_soil = interpolateFactor(soilResistivityCorrectionFactors, soilResistivity);
                calculationHtml += `<ul><li>Soil Thermal Resistivity Correction Factor (k<sub>soil</sub>) for ${soilResistivity} K·m/W (interpolated) is <strong>${k_soil.toFixed(3)}</strong>.</li></ul>`;

                k_depth = interpolateFactor(depthCorrectionFactors, depthOfBurial);
                calculationHtml += `<ul><li>Depth of Burial Correction Factor (k<sub>depth</sub>) for ${depthOfBurial} m (interpolated) is <strong>${k_depth.toFixed(3)}</strong>.</li></ul>`;

            } else {
                calculationHtml += `<ul><li>Soil Thermal Resistivity Correction Factor (k<sub>soil</sub>) is <strong>1.0</strong> (cable not buried).</li></ul>`;
                calculationHtml += `<ul><li>Depth of Burial Correction Factor (k<sub>depth</sub>) is <strong>1.0</strong> (cable not buried).</li></ul>`;
            }
            
            // 5. Calculate Final Ampacity (Iz)
            const Iz = Ib_adjusted_for_install * k_temp * k_group * k_soil * k_depth;
            
            calculationHtml += `<p class="calculation-step">
                I<sub>z</sub> = ${Ib_raw} A ${installFactor !== 1.0 ? `× ${installFactor.toFixed(3)} ` : ''}× ${k_temp.toFixed(3)} × ${k_group.toFixed(3)} × ${k_soil.toFixed(3)} × ${k_depth.toFixed(3)} = <strong>${Iz.toFixed(2)} A</strong>
            </p>`;

            // --- Voltage Drop Calculation ---
            let voltageDropV = 0;
            let voltageDropPercent = 0;
            let R_per_km, X_per_km; // Resistance and Reactance per kilometer

            try {
                const impedanceData = conductorImpedance[material][standard][size];
                if (!impedanceData) throw new Error("Impedance data not found.");
                R_per_km = impedanceData.R;
                X_per_km = impedanceData.X;
            } catch (e) {
                displayMessage(`Impedance data not found for voltage drop calculation for selected conductor size/material.`, "warning");
                R_per_km = 0; X_per_km = 0; // Set to 0 to avoid breaking calculation
            }

            const R_total = R_per_km * (cableLength / 1000); // Total resistance for cable length
            const X_total = X_per_km * (cableLength / 1000); // Total reactance for cable length

            // Assuming power factor of 0.8 lagging for industrial loads (common)
            const powerFactor = 0.8;
            const cosPhi = powerFactor;
            const sinPhi = Math.sqrt(1 - (cosPhi * cosPhi)); // For lagging PF

            if (phaseType === 'single-phase') {
                // Single-phase voltage drop formula (simplified)
                // VD = 2 * I * (R * cos(phi) + X * sin(phi))
                voltageDropV = 2 * loadCurrent * (R_total * cosPhi + X_total * sinPhi);
            } else { // Three-phase
                // Three-phase voltage drop formula (simplified)
                // VD = sqrt(3) * I * (R * cos(phi) + X * sin(phi))
                voltageDropV = Math.sqrt(3) * loadCurrent * (R_total * cosPhi + X_total * sinPhi);
            }
            
            voltageDropPercent = (voltageDropV / systemVoltageVd) * 100;

            calculationHtml += `<h4>Voltage Drop Calculation:</h4>`;
            calculationHtml += `<p>Voltage drop is the reduction in electrical potential along the length of a conductor due to its impedance. Excessive voltage drop can lead to poor equipment performance. This calculation is a simplified approximation.</p>`;
            calculationHtml += `<ul>
                                    <li>Conductor Resistance (R) per km: ${R_per_km.toFixed(3)} Ω/km</li>
                                    <li>Conductor Reactance (X) per km: ${X_per_km.toFixed(3)} Ω/km</li>
                                    <li>Total Resistance for ${cableLength} m: R<sub>total</sub> = ${R_total.toFixed(3)} Ω</li>
                                    <li>Total Reactance for ${cableLength} m: X<sub>total</sub> = ${X_total.toFixed(3)} Ω</li>
                                    <li>Assumed Power Factor (cos φ): ${powerFactor.toFixed(2)} (lagging)</li>
                                </ul>`;
            if (phaseType === 'single-phase') {
                calculationHtml += `<p class="formula">$$ \\Delta V = 2 \\times I_{load} \\times (R_{total} \\cos\\phi + X_{total} \\sin\\phi) $$</p>`;
                calculationHtml += `<p class="calculation-step">
                                    $\\Delta V = 2 \\times ${loadCurrent} A \\times (${R_total.toFixed(3)} \\Omega \\times ${cosPhi.toFixed(2)} + ${X_total.toFixed(3)} \\Omega \\times ${sinPhi.toFixed(2)}) = ${voltageDropV.toFixed(2)} V$
                                    </p>`;
            } else {
                calculationHtml += `<p class="formula">$$ \\Delta V = \\sqrt{3} \\times I_{load} \\times (R_{total} \\cos\\phi + X_{total} \\sin\\phi) $$</p>`;
                calculationHtml += `<p class="calculation-step">
                                    $\\Delta V = \\sqrt{3} \\times ${loadCurrent} A \\times (${R_total.toFixed(3)} \\Omega \\times ${cosPhi.toFixed(2)} + ${X_total.toFixed(3)} \\Omega \\times ${sinPhi.toFixed(2)}) = ${voltageDropV.toFixed(2)} V$
                                    </p>`;
            }
            calculationHtml += `<p class="formula">$$ \\%VD = \\frac{\\Delta V}{V_{system}} \\times 100 $$</p>`;
            calculationHtml += `<p class="calculation-step">
                                    $\\text{%VD} = \\frac{${voltageDropV.toFixed(2)} V}{${systemVoltageVd} V} \\times 100 = ${voltageDropPercent.toFixed(2)} \\%$
                                    </p>`;
            
            if (voltageDropPercent > 3) { // Typical recommended max voltage drop for feeders
                calculationHtml += `<p class="text-red-600 dark:text-red-400 font-bold">Warning: Voltage drop (${voltageDropPercent.toFixed(2)}%) exceeds the typical recommended maximum (e.g., 3% for feeders). Consider increasing conductor size or reducing cable length.</p>`;
            }


            // --- Short-Circuit Current Withstand Calculation ---
            let shortCircuitWithstandkA = 0;
            let kFactor = 0;
            
            try {
                kFactor = kFactorsShortCircuit[material][insulation];
                if (!kFactor) throw new Error("K-factor data not found.");
            } catch (e) {
                displayMessage(`K-factor data not found for short-circuit withstand calculation for selected conductor material/insulation.`, "warning");
                kFactor = 0; // Set to 0 to avoid breaking calculation
            }

            // Convert conductor size to mm^2 for calculation if NEC standard is selected
            let conductorSizeSqMm = parseFloat(size);
            if (standard === 'nec') {
                // Approximate conversion for AWG/kcmil to mm^2
                const necToIecConversion = {
                    '14': 2.08, '12': 3.31, '10': 5.26, '8': 8.37, '6': 13.3, '4': 21.2, '3': 26.7, '2': 33.6,
                    '1': 42.4, '1/0': 53.5, '2/0': 67.4, '3/0': 85.0, '4/0': 107.2,
                    '250': 126.7, '300': 152.0, '350': 177.3, '400': 202.7, '500': 253.3,
                    '600': 304.0, '700': 354.7, '750': 380.0, '800': 405.3, '1000': 506.7
                };
                conductorSizeSqMm = necToIecConversion[size];
                if (!conductorSizeSqMm) {
                    displayMessage(`Conductor size conversion to mm² for short-circuit calculation not found for ${size} AWG/kcmil.`, "warning");
                    conductorSizeSqMm = 1; // Default to a small value to prevent division by zero
                }
            }

            // Short-Circuit Current Withstand Formula (simplified adiabatic heating)
            // I_sc = (A * k) / sqrt(t)
            // Where: I_sc = short-circuit current (kA)
            //        A = conductor cross-sectional area (mm^2)
            //        k = material constant (from tables)
            //        t = fault duration (seconds)
            if (faultDuration > 0 && conductorSizeSqMm > 0) {
                shortCircuitWithstandkA = (conductorSizeSqMm * kFactor) / Math.sqrt(faultDuration);
            } else {
                shortCircuitWithstandkA = 0; // Cannot calculate with zero or negative duration/size
            }

            calculationHtml += `<h4>Short-Circuit Current Withstand Calculation:</h4>`;
            calculationHtml += `<p>The short-circuit current withstand rating is the maximum current a cable can safely carry for a specified duration without damaging its insulation. This calculation is based on simplified adiabatic heating models.</p>`;
            calculationHtml += `<ul>
                                    <li>Conductor Cross-sectional Area (A): ${conductorSizeSqMm.toFixed(2)} mm²</li>
                                    <li>K-factor for ${material.charAt(0).toUpperCase() + material.slice(1)} ${insulation.toUpperCase()} insulation: ${kFactor.toFixed(4)}</li>
                                    <li>Fault Duration (t): ${faultDuration.toFixed(2)} s</li>
                                </ul>`;
            calculationHtml += `<p class="formula">$$ I_{sc,withstand} = \\frac{A \\times k}{\\sqrt{t}} $$</p>`;
            calculationHtml += `<p class="calculation-step">
                                    $I_{sc,withstand} = \\frac{${conductorSizeSqMm.toFixed(2)} \\text{ mm}^2 \\times ${kFactor.toFixed(4)}}{\\sqrt{${faultDuration.toFixed(2)} \\text{ s}}} = ${shortCircuitWithstandkA.toFixed(2)} \\text{ kA}$
                                    </p>`;
            
            // 6. Display Results
            calculationDetailsDiv.innerHTML = calculationHtml;
            // Trigger MathJax rendering for the new content
            if (window.MathJax) {
                window.MathJax.typesetPromise([calculationDetailsDiv]);
            }

            resultTableBody.innerHTML = '';
            addResultRow("Selected Standard", standard.toUpperCase() === 'IEC' ? 'IEC 60364-5-52' : 'NEC (NFPA 70)');
            addResultRow("Conductor Material", material.charAt(0).toUpperCase() + material.slice(1));
            addResultRow("Conductor Size", `${size} ${standard === 'iec' ? 'mm²' : 'AWG/kcmil'}`);
            addResultRow("Insulation Type", insulation.toUpperCase() === 'XLPE' ? 'XLPE/EPR (90℃)' : 'PVC (70℃/75℃)');
            addResultRow("Installation Method", installationMethodSelect.options[installationMethodSelect.selectedIndex].text);
            addResultRow("Ambient Temperature", `${ambientTemp}℃`);
            addResultRow("Number of Grouped Circuits", numCircuits);
            if (isBuried) {
                addResultRow("Soil Thermal Resistivity", `${soilResistivity} K·m/W`);
                addResultRow("Depth of Burial", `${depthOfBurial} m`);
            }
            addResultRow("Base Ampacity (I<sub>b,raw</sub>)", `${Ib_raw} A`);
            if (installFactor !== 1.0) {
                addResultRow("Installation Factor (k<sub>install</sub>)", installFactor.toFixed(3));
            }
            addResultRow("Temperature Correction (k<sub>temp</sub>)", k_temp.toFixed(3));
            addResultRow("Grouping Correction (k<sub>group</sub>)", k_group.toFixed(3));
            if (isBuried) {
                addResultRow("Soil Resistivity Correction (k<sub>soil</sub>)", k_soil.toFixed(3));
                addResultRow("Depth of Burial Correction (k<sub>depth</sub>)", k_depth.toFixed(3));
            }
            addResultRow("<strong>Final Corrected Ampacity (I<sub>z</sub>)</strong>", `<strong>${Iz.toFixed(2)} A</strong>`);
            
            addResultRow("--- Voltage Drop Results ---", "");
            addResultRow("Load Current", `${loadCurrent} A`);
            addResultRow("System Voltage", `${systemVoltageVd} V`);
            addResultRow("Cable Length", `${cableLength} m`);
            addResultRow("Phase Type", phaseType.replace('-', ' ').charAt(0).toUpperCase() + phaseType.replace('-', ' ').slice(1));
            addResultRow("Voltage Drop", `${voltageDropV.toFixed(2)} V`);
            addResultRow("Voltage Drop Percentage", `${voltageDropPercent.toFixed(2)} %`);

            addResultRow("--- Short-Circuit Withstand Results ---", "");
            addResultRow("Fault Duration", `${faultDuration} s`);
            addResultRow("Short-Circuit Withstand Current", `${shortCircuitWithstandkA.toFixed(2)} kA`);


            standardReferenceDiv.innerHTML = `Calculation is based on methodologies and simplified data derived from:
                <ul>
                    <li><strong>IEC 60364-5-52:2009</strong> (Low-voltage electrical installations - Part 5-52: Selection and erection of electrical equipment - Wiring systems), particularly tables related to current-carrying capacities and correction factors.</li>
                    <li><strong>NEC (NFPA 70)</strong> (National Electrical Code), specifically referencing Table 310.16 for allowable ampacities and relevant adjustment/correction factors.</li>
                    <li><strong>IEC 60909</strong> and <strong>IEEE Std 242 (Buff Book)</strong> principles for short-circuit current withstand.</li>
                    <li>General electrical engineering principles for voltage drop calculations.</li>
                </ul>
                <p><strong>Disclaimer:</strong> This tool provides an estimate; always refer to the complete official standards, manufacturer data, and local codes for accurate design, safety verification, and compliance. For complex industrial systems, specialized electrical engineering software and professional consultation are highly recommended.</p>`;

            resultContainer.style.display = 'block';
            // Add 'show' class to trigger animation
            setTimeout(() => {
                resultContainer.classList.add('show');
                resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 50); // Small delay to ensure display:block applies first
            
            // Update the email share link with current results
            const emailSubject = encodeURIComponent("Cable Ampacity & Sizing Calculation Results from Design Calculators");
            const emailBody = encodeURIComponent(
                `I found this useful electrical tools website: https://designcalculators.co.in\n\n` +
                `Here are some details about the Cable Ampacity Calculation I performed:\n` +
                `- Standard: ${standard.toUpperCase() === 'IEC' ? 'IEC 60364-5-52' : 'NEC (NFPA 70)'}\n` +
                `- Conductor Material: ${material.charAt(0).toUpperCase() + material.slice(1)}\n` +
                `- Conductor Size: ${size} ${standard === 'iec' ? 'mm²' : 'AWG/kcmil'}\n` +
                `- Insulation Type: ${insulation.toUpperCase() === 'XLPE' ? 'XLPE/EPR (90℃)' : 'PVC (70℃/75℃)'}\n` +
                `- Installation Method: ${installationMethodSelect.options[installationMethodSelect.selectedIndex].text}\n` +
                `- Ambient Temperature: ${ambientTemp}℃\n` +
                `- Number of Grouped Circuits: ${numCircuits}\n` +
                (isBuried ? `- Soil Thermal Resistivity: ${soilResistivity} K·m/W\n` : '') +
                (isBuried ? `- Depth of Burial: ${depthOfBurial} m\n` : '') +
                `- Base Ampacity (Ib,raw): ${Ib_raw} A\n` +
                (installFactor !== 1.0 ? `- Installation Factor (k_install): ${installFactor.toFixed(3)}\n` : '') +
                `- Temperature Correction (k_temp): ${k_temp.toFixed(3)}\n` +
                `- Grouping Correction (k_group): ${k_group.toFixed(3)}\n` +
                (isBuried ? `- Soil Resistivity Correction (k_soil): ${k_soil.toFixed(3)}\n` : '') +
                (isBuried ? `- Depth of Burial Correction (k_depth): ${k_depth.toFixed(3)}\n` : '') +
                `- Final Corrected Ampacity (Iz): ${Iz.toFixed(2)} A\n\n` +
                `--- Voltage Drop Results ---\n` +
                `- Load Current: ${loadCurrent} A\n` +
                `- System Voltage: ${systemVoltageVd} V\n` +
                `- Cable Length: ${cableLength} m\n` +
                `- Phase Type: ${phaseType.replace('-', ' ').charAt(0).toUpperCase() + phaseType.replace('-', ' ').slice(1)}\n` +
                `- Voltage Drop: ${voltageDropV.toFixed(2)} V (${voltageDropPercent.toFixed(2)} %)\n\n` +
                `--- Short-Circuit Withstand Results ---\n` +
                `- Fault Duration: ${faultDuration} s\n` +
                `- Short-Circuit Withstand Current: ${shortCircuitWithstandkA.toFixed(2)} kA\n\n` +
                `Please note: This is a simplified calculation for educational purposes and should not be used for actual engineering design or compliance.`
            );
            emailShareBtn.href = `mailto:?subject=${emailSubject}&body=${emailBody}`;
        }
        
        function addResultRow(parameter, value) {
            const row = resultTableBody.insertRow();
            const paramCell = row.insertCell();
            const valueCell = row.insertCell();
            paramCell.innerHTML = parameter;
            valueCell.innerHTML = value;
        }
        
        function displayMessage(message, type = "info") {
            const messageBox = document.getElementById('custom-message-box');
            messageBox.textContent = message;
            messageBox.style.display = 'block';

            if (type === "error") {
                messageBox.style.backgroundColor = '#dc3545'; // Red
            } else if (type === "warning") {
                messageBox.style.backgroundColor = '#ffc107'; // Amber
                messageBox.style.color = '#333';
            } else {
                messageBox.style.backgroundColor = '#28a745'; // Green
                messageBox.style.color = 'white';
            }
            messageBox.style.opacity = 1;

            // Clear any existing timeout to prevent multiple messages overlapping
            if (messageBox.timeoutId) {
                clearTimeout(messageBox.timeoutId);
            }

            messageBox.timeoutId = setTimeout(() => {
                messageBox.style.opacity = 0;
                setTimeout(() => { messageBox.style.display = 'none';}, 500); // Wait for fade out then hide
            }, 5000);
        }

        // --- THEME SWITCH LOGIC ---
        const themeSwitch = document.getElementById('theme-switch');
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeSwitch.checked = true;
        }

        themeSwitch.addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            }
        });

        // --- INITIALIZE FORM ---
        updateFormOptions();
    });
    </script>
</body>

</html>
