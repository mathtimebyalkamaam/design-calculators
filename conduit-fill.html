<!DOCTYPE html>
<html lang="en"> 
<head>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');   
    </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Conduit Fill Calculator - Design Calculators - Electrical</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                processHtmlClass: 'math-content', // Process elements with this class
                ignoreHtmlClass: 'no-mathjax'      // Ignore elements with this class
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --input-bg: #ffffff;
            --input-border-focus: #4CAF50;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.3);
            --hover-color: #446688;
            --input-bg: #446688;
            --input-border-focus: #4CAF50;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh; /* Ensure full height */
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            width: 100%; /* Ensure responsiveness */
            box-sizing: border-box; /* Include padding in width */
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
            animation: fadeInDown 1s ease-out;
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            flex: 1; /* Allow main content to grow and push footer down */
            padding: 20px 0;
            animation: fadeInUp 1s ease-out 0.3s forwards; /* Add animation */
            opacity: 0; /* Start hidden for animation */
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Add transition */
        }

        .tool-container:hover {
            transform: translateY(-5px); /* Lift effect on hover */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* Enhanced shadow on hover */
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center; /* Center heading */
        }
        /* Ensure H2 is visible in dark mode */
        body.dark-mode .tool-container h2 {
            color: white; /* Explicitly set to white for visibility */
            border-bottom-color: white;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
            text-align: justify; /* Justify text */
        }

        .back-button {
            display: inline-flex; /* Use flex for icon and text alignment */
            align-items: center;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* Add transitions */
            font-weight: bold; /* Make text bolder */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Add shadow */
        }

        .back-button i {
            margin-right: 8px;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px); /* Lift effect on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); /* Enhanced shadow on hover */
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px; /* Space between icon and switch */
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            font-size: 1.3em; /* Larger icons */
            transition: color 0.3s;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            animation: fadeInUp 1s ease-out 0.5s forwards; /* Add animation */
            opacity: 0; /* Start hidden for animation */
        }

        footer .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
            gap: 20px;
        }

        footer .disclaimer, footer .social-share, footer .credit {
            flex: 1 1 280px;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.05);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }

        footer .disclaimer h3,
        footer .social-share h3,
        footer .credit h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.4em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
        }

        footer .credit p {
            font-size: 0.95em;
            color: #bdc3c7;
            margin: 10px 0;
        }

        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .social-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #EA4335; } /* Added email button color */

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color); /* Ensure label text is visible */
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--input-border-focus);
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.5); /* Primary color with transparency */
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1 1 200px;
        }
        
        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: auto; /* Allow button to size naturally */
            margin-left: auto; /* Center the button */
            margin-right: auto; /* Center the button */
        }
        
        .calculate-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .calculate-btn .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }

        .calculate-btn.loading .spinner {
            display: inline-block;
        }

        .calculate-btn.loading {
            cursor: not-allowed;
            opacity: 0.8;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center; /* Center heading */
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        /* Ensure H3 is visible in dark mode */
        body.dark-mode .result-container h3 {
            color: white; /* Explicitly set to white for visibility */
            border-bottom-color: white;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px; /* Rounded corners for table */
            overflow: hidden; /* Ensures rounded corners apply */
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color); /* Ensure text color changes */
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            text-transform: uppercase; /* Uppercase table headers */
            font-size: 0.95em;
            color: var(--primary-color); /* Primary color for table headers */
        }

        .result-table tbody tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.02); /* Light stripe effect */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color);
            transition: background-color 0.3s ease-in-out;
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color); /* Ensure visibility in dark mode */
            background-color: var(--hover-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--primary-color);
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: transform 0.2s ease-in-out;
        }
        .info-icon:hover {
            transform: scale(1.1);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px; /* Increased width for more text */
            background-color: #333; /* Dark background */
            color: #fff; /* White text */
            text-align: center;
            border-radius: 8px;
            padding: 10px; /* Increased padding */
            position: absolute;
            z-index: 10; /* Higher z-index */
            bottom: 125%;
            left: 50%;
            margin-left: -140px; /* Half of new width */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.3;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add shadow */
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, background-color 0.3s ease-in-out;
            display: none; /* Hidden by default */
            min-width: 300px;
            text-align: center;
        }
        #custom-message-box.error { background-color: #dc3545; } /* Red */
        #custom-message-box.warning { background-color: #ffc107; color: #333; } /* Amber */
        #custom-message-box.info { background-color: #28a745; } /* Green */

        /* Styles for detailed calculation steps and tips */
        .detailed-calculations, .conduit-fill-tips {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--hover-color); /* A lighter background for contrast */
            color: var(--text-color); /* Ensure text visibility */
            animation: fadeIn 0.8s ease-out; /* Add fade-in animation */
        }

        body.dark-mode .detailed-calculations, body.dark-mode .conduit-fill-tips {
            background-color: #3a475a; /* Darker background for contrast in dark mode */
            border-color: #6a7a8f;
        }

        .detailed-calculations h4, .conduit-fill-tips h4 {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary-color); /* Highlight heading */
        }
        body.dark-mode .detailed-calculations h4, body.dark-mode .conduit-fill-tips h4 {
            color: var(--primary-color); /* Use lighter primary color in dark mode */
        }

        .detailed-calculations p, .conduit-fill-tips p, .conduit-fill-tips ul {
            margin-bottom: 5px;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .conduit-fill-tips ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        .detailed-calculations strong, .conduit-fill-tips strong {
            color: var(--secondary-color); /* Highlight key terms in formulas */
        }
        body.dark-mode .detailed-calculations strong, body.dark-mode .conduit-fill-tips strong {
            color: var(--primary-color); /* Use lighter primary color for highlights in dark mode */
        }

        /* MathJax rendered formulas will have the desired styling */
        .formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px dashed var(--primary-color);
        }
        body.dark-mode .formula {
            background-color: rgba(255,255,255,0.05);
        }

        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(0,0,0,0.03); /* Light tint for steps */
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid var(--accent-color); /* Accent color left border */
        }
        body.dark-mode .calculation-step {
            background-color: rgba(255,255,255,0.03);
        }

        .detailed-calculations .calculation-step:last-child {
            border-bottom: none; /* No border after the last step */
        }

        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .message-box-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        .input-focus-animation:focus {
            box-shadow: 0 0 0 3px var(--input-border-focus);
            transition: box-shadow 0.3s ease-in-out;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            header .subtitle {
                font-size: 0.9em;
            }
            .theme-toggle {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }
            .tool-container, .calculator-form, .result-container {
                padding: 20px;
            }
            .tool-container h2 {
                font-size: 1.6em;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .form-row .form-group {
                flex: 1 1 100%;
                min-width: unset;
            }
            .back-button {
                width: 100%;
                justify-content: center;
            }
            footer .container {
                flex-direction: column;
                align-items: center;
            }
            footer .disclaimer, footer .social-share, footer .credit {
                flex: 1 1 100%;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            header {
                padding: 15px 0;
            }
            header h1 {
                font-size: 1.8em;
            }
            .back-button {
                padding: 10px 15px;
                font-size: 0.9em;
            }
            .calculate-btn {
                padding: 12px 20px;
                font-size: 1em;
            }
            .result-table th, .result-table td {
                padding: 10px;
                font-size: 0.9em;
            }
            .tooltip .tooltiptext {
                width: 180px;
                margin-left: -90px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy ！ Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Assuming you have an index.html for main tools list, linking back to it -->
        <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        
        <div class="tool-container">
            <h2>Advanced Conduit Fill Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator determines the maximum number of **conductors or cables** that can be safely installed in a conduit, based on industry standards like NEC/IEEE or IEC. Proper conduit fill ensures efficient **cable** installation, allows for heat dissipation, and facilitates future maintenance.</p>
            </div>
        
            <div class="calculator-form">
                <form id="conduit-fill-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="standard">Standard <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the electrical standard to use for calculations (e.g., National Electrical Code (NEC) for North America, or International Electrotechnical Commission (IEC) for international).</span></span></label>
                            <select id="standard" required class="input-focus-animation">
                                <option value="nec">NEC / IEEE (North America)</option>
                                <option value="iec">IEC (International)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conduit-internal-area">Conduit Cross Sectional Area (mm²) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the internal cross-sectional area of the conduit in square millimeters (mm²). This value can be found in electrical code tables (e.g., NEC Chapter 9, Table 4) or manufacturer specifications. For 4" PVC, typical values are around 7400-8100 mm².</span></span></label>
                            <input type="number" id="conduit-internal-area" min="0.01" step="0.01" value="7800.00" class="input-focus-animation" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="num-conductors">Number of Conductors/Cables <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The actual number of individual conductors or multi-conductor cables you plan to install in the conduit. This affects the allowable fill percentage.</span></span></label>
                            <input type="number" id="num-conductors" min="1" step="1" value="3" class="input-focus-animation" required>
                        </div>
                        <div class="form-group">
                            <label for="conductor-type">Conductor Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select if you are installing individual conductors or a multi-conductor cable. This affects how the total area is calculated.</span></span></label>
                            <select id="conductor-type" required class="input-focus-animation">
                                <option value="individual">Individual Conductors</option>
                                <option value="multi-conductor">Multi-Conductor Cable</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="conductor-size-unit">Conductor Size Unit <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Select the unit for conductor size (AWG/kcmil for NEC, mm² for IEC).</span></span></label>
                            <select id="conductor-size-unit" required class="input-focus-animation">
                                <option value="awg">AWG / kcmil (for NEC)</option>
                                <option value="mm2">mm² (for IEC)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conductor-size">Conductor Size <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The nominal size of each individual conductor or the overall equivalent size for a multi-conductor cable. The actual outer diameter varies by size and insulation type.</span></span></label>
                            <select id="conductor-size" required class="input-focus-animation">
                                <!-- Options will be populated dynamically based on conductor-size-unit -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="insulation-type">Conductor Insulation Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">The insulation type affects the conductor's overall outer diameter.</span></span></label>
                            <select id="insulation-type" required class="input-focus-animation">
                                <!-- Options will be populated dynamically based on standard and unit -->
                            </select>
                        </div>
                        <div class="form-group" id="multi-cable-od-group" style="display: none;">
                            <label for="multi-cable-od">Multi-Conductor Cable Outer Diameter (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">Enter the actual measured or specified outer diameter of the multi-conductor cable, including its jacket. This is crucial for accurate fill calculations for bundled cables.</span></span></label>
                            <input type="number" id="multi-cable-od" min="0.1" step="0.1" value="25.0" class="input-focus-animation">
                        </div>
                    </div>
                    
                    <button type="button" id="calculate-conduit-fill-btn" class="calculate-btn">
                        Calculate Conduit Fill <span class="spinner"></span>
                    </button>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Conduit Fill Results</h3>
                <div id="detailed-calculations" class="detailed-calculations mt-6 math-content">
                    <h3>Detailed Calculation Steps</h3>
                    <!-- Detailed calculation steps will be dynamically inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div class="conduit-fill-tips mt-6">
                    <h3>Important Considerations for Conduit Fill Design</h3>
                    <p>Proper conduit fill is essential for the safety, efficiency, and longevity of electrical installations. Adhering to standards ensures:</p>
                    <ul>
                        <li><strong>Heat Dissipation:</strong> Overfilled conduits can lead to excessive heat buildup, degrading insulation and potentially causing fires.</li>
                        <li><strong>Ease of Installation:</strong> Proper fill percentages allow conductors/cables to be pulled through the conduit without damage to insulation.</li>
                        <li><strong>Future Maintenance/Upgrades:</strong> Adequate space facilitates adding or removing conductors/cables in the future.</li>
                        <li><strong>Mechanical Protection:</strong> Conduits protect conductors/cables from physical damage and environmental factors.</li>
                    </ul>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400"><em>Conduit fill calculations are a critical part of electrical design. This tool provides an estimate based on common standards. Always refer to the latest editions of the National Electrical Code (NEC) for North American installations or the International Electrotechnical Commission (IEC) standards (e.g., IEC 60364-5-52) for international applications, and consult local electrical codes and qualified professionals for definitive requirements and complex scenarios.</em></p>
                </div>
                <div class="standard-reference" id="standard-reference-text">
                    <p>Conduit fill calculations are based on principles from the National Electrical Code (NEC) Chapter 9, Tables 4 & 5 (for North American practices) or equivalent International Electrotechnical Commission (IEC) standards such as IEC 60364-5-52. These standards ensure safe installation by limiting the conductor fill area, which is crucial for cable integrity, heat dissipation, and ease of installation and removal. Always refer to the latest editions of relevant local and international electrical codes for definitive requirements.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <h3>Credit</h3>
                <p>Developed by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share">
                <h3>Share This Tool</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Advanced%20Conduit%20Fill%20Calculator" target="_blank" class="social-btn linkedin"><i class="fab fa-linkedin"></i></a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook"><i class="fab fa-facebook"></i></a>
                    <a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20Advanced%20Conduit%20Fill%20Calculator!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter"><i class="fab fa-twitter"></i></a>
                    <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20Advanced%20Conduit%20Fill%20Calculator!%20https://designcalculators.co.in" target="_blank" class="social-btn whatsapp"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Advanced%20Conduit%20Fill%20Calculator" target="_blank" class="social-btn reddit"><i class="fab fa-reddit"></i></a>
                    <a href="#" id="email-share-btn" class="social-btn email"><i class="fas fa-envelope"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box -->
    <div id="custom-message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-conduit-fill-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReferenceText = document.getElementById('standard-reference-text');
            const detailedCalculationsDiv = document.getElementById('detailed-calculations');
            const conduitFillTipsDiv = document.querySelector('.conduit-fill-tips');

            const standardSelect = document.getElementById('standard');
            const conduitInternalAreaInput = document.getElementById('conduit-internal-area');
            const numConductorsInput = document.getElementById('num-conductors');
            const conductorTypeSelect = document.getElementById('conductor-type'); // New: Conductor Type
            const conductorSizeUnitSelect = document.getElementById('conductor-size-unit');
            const conductorSizeSelect = document.getElementById('conductor-size');
            const insulationTypeSelect = document.getElementById('insulation-type');
            const multiCableOdGroup = document.getElementById('multi-cable-od-group'); // New: Multi-conductor OD group
            const multiCableOdInput = document.getElementById('multi-cable-od'); // New: Multi-conductor OD input

            // Data for Conductor Outer Areas (in mm2) based on insulation type
            // Note: These are simplified/approximate values for demonstration and may vary by specific manufacturer/standard.
            // For real-world applications, consult official NEC/IEC tables (e.g., NEC Chapter 9, Table 5, or IEC 60364-5-52).
            const conductorAreas = {
                'awg': { // For NEC/IEEE
                    'thhn': {
                        '14': 5.7, '12': 7.5, '10': 11.2, '8': 16.5, '6': 22.0,
                        '4': 31.7, '2': 48.7, '1/0': 76.9, '2/0': 97.4, '3/0': 123.0,
                        '4/0': 156.0, '250': 200.0, '350': 260.0, '500': 350.0, '600': 420.0,
                        '750': 500.0, '1000': 600.0
                    },
                    'xhhw': { // Often slightly larger OD than THHN for same gauge
                        '14': 6.5, '12': 8.3, '10': 12.5, '8': 18.0, '6': 24.0,
                        '4': 34.0, '2': 52.0, '1/0': 82.0, '2/0': 104.0, '3/0': 130.0,
                        '4/0': 165.0, '250': 215.0, '350': 280.0, '500': 370.0, '600': 440.0,
                        '750': 520.0, '1000': 620.0
                    },
                    'thw': { // Larger OD
                        '14': 7.0, '12': 9.0, '10': 13.5, '8': 20.0, '6': 27.0,
                        '4': 39.0, '2': 60.0, '1/0': 95.0, '2/0': 120.0, '3/0': 150.0,
                        '4/0': 190.0, '250': 245.0, '350': 320.0, '500': 430.0, '600': 500.0,
                        '750': 590.0, '1000': 700.0
                    }
                },
                'mm2': { // For IEC
                    'pvc_iec': {
                        '1.5': 6.16, '2.5': 8.04, '4': 10.75, '6': 13.85, '10': 22.9,
                        '16': 36.3, '25': 52.8, '35': 67.9, '50': 84.9, '70': 107.5,
                        '95': 136.9, '120': 167.0, '150': 199.9, '185': 237.8, '240': 295.6,
                        '300': 359.7, '400': 452.4, '500': 550.0, '630': 680.0
                    },
                    'xlpe_iec': { // Often similar or slightly smaller OD than PVC_IEC for same cross-sectional area
                        '1.5': 5.7, '2.5': 7.5, '4': 10.0, '6': 13.0, '10': 21.5,
                        '16': 34.0, '25': 49.5, '35': 64.0, '50': 80.0, '70': 100.0,
                        '95': 130.0, '120': 160.0, '150': 190.0, '185': 230.0, '240': 285.0,
                        '300': 345.0, '400': 430.0, '500': 520.0, '630': 640.0
                    }
                }
            };

            // Populate conductor size options based on standard and unit
            function updateConductorSizeOptions() {
                const selectedStandard = standardSelect.value;
                const selectedUnit = conductorSizeUnitSelect.value;
                const selectedInsulation = insulationTypeSelect.value;
                const conductorType = conductorTypeSelect.value; // Get conductor type

                conductorSizeSelect.innerHTML = ''; // Clear existing options

                let sizes;
                if (conductorType === 'individual') {
                    if (selectedStandard === 'nec' && selectedUnit === 'awg') {
                        sizes = Object.keys(conductorAreas['awg'][selectedInsulation] || conductorAreas['awg']['thhn']);
                    } else if (selectedStandard === 'iec' && selectedUnit === 'mm2') {
                        sizes = Object.keys(conductorAreas['mm2'][selectedInsulation] || conductorAreas['mm2']['pvc_iec']);
                    } else {
                        sizes = [];
                        displayMessage("Selected standard and conductor unit combination is not supported for individual conductors. Please select 'AWG/kcmil' for NEC or 'mm²' for IEC.", "warning");
                    }
                } else { // multi-conductor cable, size selection is less relevant, but keep for consistency if needed
                    sizes = ['N/A']; // Indicate that size selection is not applicable for multi-conductor OD input
                }

                if (sizes.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'No sizes available';
                    option.disabled = true;
                    option.selected = true;
                    conductorSizeSelect.appendChild(option);
                    return;
                }

                sizes.forEach(size => {
                    const option = document.createElement('option');
                    option.value = size;
                    option.textContent = size + (selectedUnit === 'awg' ? ' AWG/kcmil' : ' mm²');
                    conductorSizeSelect.appendChild(option);
                });

                // Set a default selected value if available
                if (conductorType === 'individual') {
                    if (sizes.includes('12') && selectedUnit === 'awg') {
                        conductorSizeSelect.value = '12';
                    } else if (sizes.includes('2.5') && selectedUnit === 'mm2') {
                        conductorSizeSelect.value = '2.5';
                    } else if (sizes.length > 0) {
                        conductorSizeSelect.value = sizes[0]; // Select the first available size
                    }
                } else {
                    conductorSizeSelect.value = 'N/A';
                }
            }

            // Populate insulation types based on standard and unit
            function updateInsulationTypeOptions() {
                const selectedStandard = standardSelect.value;
                const selectedUnit = conductorSizeUnitSelect.value;
                const conductorType = conductorTypeSelect.value; // Get conductor type

                insulationTypeSelect.innerHTML = '';
                multiCableOdGroup.style.display = 'none'; // Hide by default

                let insulationTypes;
                if (conductorType === 'individual') {
                    if (selectedStandard === 'nec' && selectedUnit === 'awg') {
                        insulationTypes = ['thhn', 'xhhw', 'thw'];
                    } else if (selectedStandard === 'iec' && selectedUnit === 'mm2') {
                        insulationTypes = ['pvc_iec', 'xlpe_iec'];
                    } else {
                        insulationTypes = [];
                    }
                    insulationTypeSelect.disabled = false; // Enable insulation type for individual
                } else { // Multi-conductor cable
                    insulationTypes = ['N/A']; // Insulation type is less relevant for overall OD
                    insulationTypeSelect.disabled = true; // Disable insulation type for multi-conductor
                    multiCableOdGroup.style.display = 'block'; // Show multi-conductor OD input
                }

                insulationTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type.toUpperCase().replace('_IEC', ' (IEC)');
                    insulationTypeSelect.appendChild(option);
                });

                // Set default insulation type
                if (conductorType === 'individual') {
                    if (selectedStandard === 'nec') {
                        insulationTypeSelect.value = 'thhn';
                    } else {
                        insulationTypeSelect.value = 'pvc_iec';
                    }
                } else {
                    insulationTypeSelect.value = 'N/A';
                }

                // Update conductor sizes after insulation types are updated
                updateConductorSizeOptions();
            }

            // Event listeners for standard and conductor size unit changes
            standardSelect.addEventListener('change', function() {
                // If NEC is selected, force AWG/kcmil unit
                if (standardSelect.value === 'nec') {
                    conductorSizeUnitSelect.value = 'awg';
                } else { // If IEC is selected, force mm2 unit
                    conductorSizeUnitSelect.value = 'mm2';
                }
                updateInsulationTypeOptions(); // Update insulation first
            });

            conductorSizeUnitSelect.addEventListener('change', function() {
                // Ensure consistency: if unit changes, and it conflicts with standard, adjust standard
                if (conductorSizeUnitSelect.value === 'awg' && standardSelect.value !== 'nec') {
                    standardSelect.value = 'nec';
                } else if (conductorSizeUnitSelect.value === 'mm2' && standardSelect.value !== 'iec') {
                    standardSelect.value = 'iec';
                }
                updateInsulationTypeOptions(); // Update insulation then conductor sizes
            });
            insulationTypeSelect.addEventListener('change', updateConductorSizeOptions);
            conductorTypeSelect.addEventListener('change', updateInsulationTypeOptions); // New: Listen to conductor type change

            // Initial population
            updateInsulationTypeOptions(); // This will also call updateConductorSizeOptions

            calculateBtn.addEventListener('click', function() {
                // Show spinner and disable button
                calculateBtn.classList.add('loading');
                calculateBtn.disabled = true;

                // Get input values
                const standard = standardSelect.value;
                const conduitInternalArea = parseFloat(conduitInternalAreaInput.value);
                const numConductors = parseInt(numConductorsInput.value);
                const conductorType = conductorTypeSelect.value; // Get conductor type
                const conductorSizeUnit = conductorSizeUnitSelect.value;
                const conductorSize = conductorSizeSelect.value;
                const insulationType = insulationTypeSelect.value;
                const multiCableOd = parseFloat(multiCableOdInput.value); // Get multi-conductor OD

                // Input validation
                if (isNaN(numConductors) || numConductors <= 0) {
                    displayMessage("Please enter a valid number of conductors/cables (must be a positive integer).", "error", true);
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }
                if (isNaN(conduitInternalArea) || conduitInternalArea <= 0) {
                    displayMessage("Please enter a valid positive value for Conduit Cross Sectional Area.", "error", true);
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }
                if (conductorType === 'individual' && (!conductorSize || !insulationType)) {
                    displayMessage("Please select all required fields for individual conductors (size and insulation type).", "error", true);
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }
                if (conductorType === 'multi-conductor' && (isNaN(multiCableOd) || multiCableOd <= 0)) {
                    displayMessage("Please enter a valid positive value for Multi-Conductor Cable Outer Diameter.", "error", true);
                    calculateBtn.classList.remove('loading');
                    calculateBtn.disabled = false;
                    return;
                }

                // --- Conduit Fill Calculation Logic ---
                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';

                // Step 1: Get Conduit Internal Area (now directly from input)
                calculationHtml += `<p><strong>1. Determine Conduit Cross Sectional Area:</strong></p>`;
                calculationHtml += `<p>The internal cross-sectional area of the conduit is directly provided by you. This value is critical for determining how much space is available for conductors/cables and is typically obtained from standardized tables (e.g., NEC Chapter 9, Table 4) or manufacturer specifications based on the conduit type and trade size.</p>`;
                calculationHtml += `<p class="calculation-step">
                    A<sub>conduit</sub> = ${conduitInternalArea.toFixed(2)} mm²
                </p>`;

                // Step 2: Get Individual Conductor/Cable Area
                let individualCableArea;
                let conductorDescription;

                if (conductorType === 'individual') {
                    const conductorLookupKey = conductorSize;
                    if (conductorAreas[conductorSizeUnit] && conductorAreas[conductorSizeUnit][insulationType] && conductorAreas[conductorSizeUnit][insulationType][conductorLookupKey]) {
                        individualCableArea = conductorAreas[conductorSizeUnit][insulationType][conductorLookupKey];
                        conductorDescription = `Individual Conductor (Size: ${conductorSize} ${conductorSizeUnit.toUpperCase() === 'AWG' ? 'AWG/kcmil' : 'mm²'}, Insulation: ${insulationType.toUpperCase().replace('_IEC', ' (IEC)')})`;
                    } else {
                        displayMessage(`Conductor area data not found for selected unit (${conductorSizeUnit}), insulation (${insulationType}) and size (${conductorSize}).`, "error", true);
                        calculateBtn.classList.remove('loading');
                        calculateBtn.disabled = false;
                        return;
                    }
                } else { // Multi-conductor cable
                    // Area of a circle = π * (diameter/2)^2 = π * (OD^2) / 4
                    individualCableArea = Math.PI * Math.pow(multiCableOd / 2, 2);
                    conductorDescription = `Multi-Conductor Cable (Outer Diameter: ${multiCableOd} mm)`;
                }

                calculationHtml += `<p><strong>2. Determine Individual Conductor/Cable Area:</strong></p>`;
                calculationHtml += `<p>The area of each conductor or the overall multi-conductor cable, including its insulation/jacket, determines its space requirement. This value is obtained from standardized tables (e.g., NEC Chapter 9, Table 5, or IEC 60364-5-52) for individual conductors, or calculated from the outer diameter for multi-conductor cables.</p>`;
                if (conductorType === 'individual') {
                    calculationHtml += `<p class="formula">$$A_{\\text{conductor}} = \\text{Value from Code Table}$$</p>`;
                    calculationHtml += `<ul>
                        <li>Conductor Size: ${conductorSize} ${conductorSizeUnit.toUpperCase() === 'AWG' ? 'AWG/kcmil' : 'mm²'}</li>
                        <li>Insulation Type: ${insulationType.toUpperCase().replace('_IEC', ' (IEC)')}</li>
                    </ul>`;
                } else {
                    calculationHtml += `<p class="formula">$$A_{\\text{cable}} = \\pi \\times \\left( \\frac{OD}{2} \\right)^2 $$</p>`;
                    calculationHtml += `<ul>
                        <li>Multi-Conductor Cable Outer Diameter (OD): ${multiCableOd.toFixed(2)} mm</li>
                    </ul>`;
                }
                calculationHtml += `<p class="calculation-step">
                    A<sub>${conductorType === 'individual' ? 'conductor' : 'cable'}</sub> = ${individualCableArea.toFixed(2)} mm²
                </p>`;

                // Step 3: Calculate Total Conductor/Cable Area
                const totalCableArea = individualCableArea * numConductors;
                calculationHtml += `<p><strong>3. Calculate Total Conductors/Cables Area:</strong></p>`;
                calculationHtml += `<p>This is the sum of the areas of all individual conductors or multi-conductor cables planned for installation. It represents the total space occupied by the conductors/cables.</p>`;
                calculationHtml += `<p class="formula">$$A_{\\text{total}} = N_{\\text{items}} \\times A_{\\text{item}}$$</p>`;
                calculationHtml += `<ul>
                    <li>Number of Conductors/Cables ($N_{\\text{items}}$) = ${numConductors}</li>
                    <li>Individual Conductor/Cable Area ($A_{\\text{item}}$) = ${individualCableArea.toFixed(2)} mm²</li>
                </ul>`;
                calculationHtml += `<p class="calculation-step">
                    A<sub>total</sub> = ${numConductors} × ${individualCableArea.toFixed(2)} = ${totalCableArea.toFixed(2)} mm²
                </p>`;

                // Step 4: Determine Allowable Fill Percentage based on Standard and Number of Conductors/Cables
                let fillPercentage;
                let fillPercentageExplanation = '';
                if (standard === 'nec') {
                    if (numConductors === 1) {
                        fillPercentage = 0.53; // 53% for 1 conductor/cable
                        fillPercentageExplanation = "For one conductor or cable in a conduit, the NEC allows a maximum fill of 53% of the conduit's total cross-sectional area.";
                    } else if (numConductors === 2) {
                        fillPercentage = 0.31; // 31% for 2 conductors/cables
                        fillPercentageExplanation = "For two conductors or cables in a conduit, the NEC allows a maximum fill of 31% of the conduit's total cross-sectional area.";
                    } else { // 3 or more conductors/cables
                        fillPercentage = 0.40; // 40% for 3+ conductors/cables
                        fillPercentageExplanation = "For three or more conductors or cables in a conduit, the NEC allows a maximum fill of 40% of the conduit's total cross-sectional area. This ensures adequate space for pulling cables and dissipating heat.";
                    }
                } else { // IEC standard (simplified)
                    // IEC typically uses a 40-50% fill for power cables, but can vary.
                    // For simplicity, we'll use a general 40% as a common conservative value.
                    fillPercentage = 0.40;
                    fillPercentageExplanation = "IEC standards, while sometimes varying by national annex, commonly use a general fill factor around 40-50% for power cables in conduits to ensure safe installation and operation.";
                }

                calculationHtml += `<p><strong>4. Determine Allowable Fill Percentage:</strong></p>`;
                calculationHtml += `<p>${fillPercentageExplanation}</p>`;
                calculationHtml += `<p class="formula">$$\\text{Allowable Fill Percentage} = \\text{Value from Code Table/Rule}$$</p>`;
                calculationHtml += `<ul>
                    <li>Selected Standard: ${standard.toUpperCase() === 'NEC' ? 'NEC / IEEE' : 'IEC'}</li>
                    <li>Number of Conductors/Cables: ${numConductors}</li>
                </ul>`;
                calculationHtml += `<p class="calculation-step">
                    Allowable Fill Percentage = ${ (fillPercentage * 100).toFixed(0) }%
                </p>`;

                // Step 5: Calculate Allowed Conduit Fill Area
                const allowedFillArea = conduitInternalArea * fillPercentage;
                calculationHtml += `<p><strong>5. Calculate Allowed Conduit Fill Area:</strong></p>`;
                calculationHtml += `<p>This is the maximum cross-sectional area within the conduit that can be occupied by conductors/cables, based on the determined fill percentage.</p>`;
                calculationHtml += `<p class="formula">$$A_{\\text{allowed}} = A_{\\text{conduit}} \\times \\text{Fill Percentage}$$</p>`;
                calculationHtml += `<ul>
                    <li>Conduit Cross Sectional Area ($A_{\\text{conduit}}$) = ${conduitInternalArea.toFixed(2)} mm²</li>
                    <li>Allowable Fill Percentage = ${(fillPercentage * 100).toFixed(0)}%</li>
                </ul>`;
                calculationHtml += `<p class="calculation-step">
                    A<sub>allowed</sub> = ${conduitInternalArea.toFixed(2)} × ${fillPercentage.toFixed(2)} = ${allowedFillArea.toFixed(2)} mm²
                </p>`;

                // Step 6: Determine Compliance and Maximum Cables
                let complianceStatus = 'Compliant';
                let remainingArea = allowedFillArea - totalCableArea;
                let maxCables = Math.floor(allowedFillArea / individualCableArea);
                
                if (totalCableArea > allowedFillArea) {
                    complianceStatus = 'NOT Compliant - Overfilled';
                    displayMessage("Warning: Conduit is overfilled! Please choose a larger conduit or fewer/smaller conductors/cables.", "warning", true);
                } else {
                    displayMessage("Conduit fill is compliant. Installation is permissible.", "info");
                }
                
                if (remainingArea < 0) remainingArea = 0; // Don't show negative remaining area

                calculationHtml += `<p><strong>6. Determine Compliance and Maximum Conductors/Cables:</strong></p>`;
                calculationHtml += `<p>By comparing the total area occupied by conductors/cables with the allowable fill area, we can determine if the conduit is properly sized. We also calculate the maximum number of conductors/cables of the specified size that could fit, without exceeding the allowable fill.</p>`;
                calculationHtml += `<p class="formula">$$\\text{Compliance} = \\begin{cases} \\text{Compliant} & \\text{if } A_{\\text{total}} \\le A_{\\text{allowed}} \\\\ \\text{Not Compliant} & \\text{if } A_{\\text{total}} > A_{\\text{allowed}} \\end{cases}$$</p>`;
                calculationHtml += `<p class="formula">$$\\text{Max Cables} = \\lfloor \\frac{A_{\\text{allowed}}}{A_{\\text{item}}} \\rfloor$$</p>`;
                calculationHtml += `<ul>
                    <li>Total Conductors/Cables Area ($A_{\\text{total}}$) = ${totalCableArea.toFixed(2)} mm²</li>
                    <li>Allowed Conduit Fill Area ($A_{\\text{allowed}}$) = ${allowedFillArea.toFixed(2)} mm²</li>
                </ul>`;
                calculationHtml += `<p class="calculation-step">
                    Status: ${complianceStatus}
                </p>`;
                calculationHtml += `<p class="calculation-step">
                    Maximum conductors/cables of this size: ${maxCables}
                </p>`;

                detailedCalculationsDiv.innerHTML = calculationHtml;
                // Trigger MathJax to render the new content
                if (window.MathJax) {
                    window.MathJax.typesetPromise([detailedCalculationsDiv]);
                }

                // Display summarized results in the table
                resultTableBody.innerHTML = ''; // Clear previous results
                
                function addResultRow(parameter, value) {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.textContent = parameter;
                    valueCell.textContent = value;
                }

                addResultRow("Selected Standard", standard.toUpperCase() === 'NEC' ? 'NEC / IEEE' : 'IEC');
                addResultRow("Conduit Cross Sectional Area (User Provided)", conduitInternalArea.toFixed(2) + " mm²");
                addResultRow("Conductor/Cable Type", conductorType === 'individual' ? 'Individual Conductors' : 'Multi-Conductor Cable');
                if (conductorType === 'individual') {
                    addResultRow("Conductor Size (Each)", conductorSize + (conductorSizeUnit === 'awg' ? ' AWG/kcmil' : ' mm²'));
                    addResultRow("Conductor Insulation Type", insulationType.toUpperCase().replace('_IEC', ' (IEC)'));
                    addResultRow("Individual Conductor Area", individualCableArea.toFixed(2) + " mm²");
                } else {
                    addResultRow("Multi-Conductor Cable Outer Diameter", multiCableOd.toFixed(2) + " mm");
                    addResultRow("Individual Cable Area (Calculated)", individualCableArea.toFixed(2) + " mm²");
                }
                addResultRow("Number of Conductors/Cables to Install", numConductors);
                addResultRow("Total Conductors/Cables Area", totalCableArea.toFixed(2) + " mm²");
                addResultRow("Allowable Fill Percentage", (fillPercentage * 100).toFixed(0) + "%");
                addResultRow("Allowed Conduit Fill Area", allowedFillArea.toFixed(2) + " mm²");
                addResultRow("Remaining Conduit Area", remainingArea.toFixed(2) + " mm²");
                addResultRow("Compliance Status", complianceStatus);
                addResultRow("Maximum Conductors/Cables of This Size", maxCables);

                standardReferenceText.innerHTML = `<p>Conduit fill calculations are based on principles from the National Electrical Code (NEC) Chapter 9, Tables 4 & 5 (for North American practices) or equivalent International Electrotechnical Commission (IEC) standards such as IEC 60364-5-52. These standards ensure safe installation by limiting the conductor fill area, which is crucial for cable integrity, heat dissipation, and ease of installation and removal. Always refer to the latest editions of relevant local and international electrical codes for definitive requirements.</p>`;
                conduitFillTipsDiv.style.display = 'block'; // Ensure tips are visible
                resultContainer.style.display = 'block';
                resultContainer.scrollIntoView({ behavior: 'smooth' }); // Scroll to results

                // Update the email share link with current results
                const emailShareBtn = document.getElementById('email-share-btn'); // Get the email share button here
                const emailSubject = encodeURIComponent("Advanced Conduit Fill Calculation Results from Electrical Tools Hub");
                const emailBody = encodeURIComponent(
                    `I found this useful electrical tools website: https://designcalculators.co.in\n\n` +
                    `Here are some details about the Advanced Conduit Fill Calculation I performed:\n` +
                    `- Selected Standard: ${standard.toUpperCase() === 'NEC' ? 'NEC / IEEE' : 'IEC'}\n` +
                    `- Conduit Cross Sectional Area: ${conduitInternalArea.toFixed(2)} mm²\n` +
                    `- Conductor/Cable Type: ${conductorType === 'individual' ? 'Individual Conductors' : 'Multi-Conductor Cable'}\n` +
                    (conductorType === 'individual' ? `- Conductor Size (Each): ${conductorSize} ${conductorSizeUnit.toUpperCase() === 'AWG' ? 'AWG/kcmil' : 'mm²'}\n` : '') +
                    (conductorType === 'individual' ? `- Conductor Insulation Type: ${insulationType.toUpperCase().replace('_IEC', ' (IEC)')}\n` : '') +
                    (conductorType === 'individual' ? `- Individual Conductor Area: ${individualCableArea.toFixed(2)} mm²\n` : '') +
                    (conductorType === 'multi-conductor' ? `- Multi-Conductor Cable Outer Diameter: ${multiCableOd.toFixed(2)} mm\n` : '') +
                    (conductorType === 'multi-conductor' ? `- Individual Cable Area (Calculated): ${individualCableArea.toFixed(2)} mm²\n` : '') +
                    `- Number of Conductors/Cables to Install: ${numConductors}\n` +
                    `- Total Conductors/Cables Area: ${totalCableArea.toFixed(2)} mm²\n` +
                    `- Allowable Fill Percentage: ${(fillPercentage * 100).toFixed(0)}%\n` +
                    `- Allowed Conduit Fill Area: ${allowedFillArea.toFixed(2)} mm²\n` +
                    `- Remaining Conduit Area: ${remainingArea.toFixed(2)} mm²\n` +
                    `- Compliance Status: ${complianceStatus}\n` +
                    `- Maximum Conductors/Cables of This Size: ${maxCables}\n\n` +
                    `Please note: This is a simplified calculation for educational purposes and should not be used for actual engineering design or compliance.`
                );
                if (emailShareBtn) { // Defensive check
                    emailShareBtn.href = `mailto:?subject=${emailSubject}&body=${emailBody}`;
                } else {
                    console.error("Email share button element not found when trying to update its href.");
                }

                // Re-enable button and hide spinner immediately after calculations are done.
                calculateBtn.classList.remove('loading');
                calculateBtn.disabled = false;
            });

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info", animate = false) {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                // Remove previous type classes
                messageBox.classList.remove('error', 'warning', 'info', 'message-box-shake');
                messageBox.classList.add(type);
                if (animate) {
                    messageBox.classList.add('message-box-shake');
                }
                messageBox.style.display = 'block'; // Ensure it's visible before setting opacity
                messageBox.style.opacity = 1;

                // Clear any existing timeout to prevent multiple messages overlapping
                if (messageBox.timeoutId) {
                    clearTimeout(messageBox.timeoutId);
                }

                messageBox.timeoutId = setTimeout(() => {
                    messageBox.style.opacity = 0;
                    setTimeout(() => { messageBox.style.display = 'none';}, 500); // Wait for fade out then hide
                }, 5000);
            }

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                // Check for saved theme preference
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Initial state population for select elements
            updateInsulationTypeOptions(); // This will also call updateConductorSizeOptions
        });
    </script>
</body>

</html>

