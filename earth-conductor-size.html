<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-23Y1V450SR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-23Y1V450SR');   
    </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5936527763614780"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earthing Cable Sizing Calculator - Design Calculators - Electrical</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- MathJax configuration and loading -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                processHtmlClass: 'math-content', // Process elements with this class
                ignoreHtmlClass: 'no-mathjax'      // Ignore elements with this class
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* Basic CSS Variables for a consistent theme */
        :root {
            --primary-color: #4CAF50; /* Green */
            --secondary-color: #45a049; /* Darker Green */
            --accent-color: #FFC107; /* Amber */
            --bg-color: #f4f7f6; /* Light Greyish Green */
            --card-bg: #ffffff; /* White */
            --text-color: #333333; /* Dark Grey */
            --header-bg: #2C3E50; /* Dark Blue Grey */
            --footer-bg: #34495E; /* Slightly Lighter Dark Blue Grey */
            --border-color: #cccccc;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-color: #e2e6ea;
            --input-bg: #ffffff;
            --input-border-focus: #4CAF50;
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --button-hover-gradient: linear-gradient(45deg, var(--secondary-color), #3b8e3e);
            --reset-button-bg: #6c757d; /* Grey for reset */
            --reset-button-hover-bg: #5a6268; /* Darker grey */
            --clear-button-bg: #007bff; /* Blue for clear */
            --clear-button-hover-bg: #0056b3; /* Darker blue */
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --header-bg: #2c3e50;
            --footer-bg: #2c3e50;
            --border-color: #555555;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            --hover-color: #446688;
            --input-bg: #446688;
            --input-border-focus: #4CAF50;
            --button-gradient: linear-gradient(45deg, #3b8e3e, #4CAF50);
            --button-hover-gradient: linear-gradient(45deg, #4CAF50, #5cb85c);
            --reset-button-bg: #495057;
            --reset-button-hover-bg: #3a4046;
            --clear-button-bg: #17a2b8; /* Cyan for dark mode clear */
            --clear-button-hover-bg: #138496;
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as specified */
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh; /* Ensure full height */
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            width: 100%; /* Ensure responsiveness */
            box-sizing: border-box; /* Include padding in width */
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative; /* For theme toggle positioning */
            animation: fadeInDown 1s ease-out;
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--primary-color);
        }

        header .subtitle {
            margin: 5px 0 0;
            font-size: 1em;
            color: #bdc3c7;
        }

        main {
            flex: 1; /* Allow main content to grow and push footer down */
            padding: 20px 0;
            animation: fadeInUp 1s ease-out 0.3s forwards; /* Add animation */
            opacity: 0; /* Start hidden for animation */
        }

        .tool-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Add transition */
        }

        .tool-container:hover {
            transform: translateY(-5px); /* Lift effect on hover */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* Enhanced shadow on hover */
        }

        .tool-container h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center; /* Center heading */
        }
        /* Ensure H2 is visible in dark mode */
        body.dark-mode .tool-container h2 {
            color: white; /* Explicitly set to white for visibility */
            border-bottom-color: white;
        }

        .tool-description {
            margin-bottom: 20px;
            color: var(--text-color);
            text-align: justify; /* Justify text */
        }

        .back-button {
            display: inline-flex; /* Use flex for icon and text alignment */
            align-items: center;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* Add transitions */
            font-weight: bold; /* Make text bolder */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Add shadow */
        }

        .back-button i {
            margin-right: 8px;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px); /* Lift effect on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); /* Enhanced shadow on hover */
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px; /* Space between icon and switch */
        }

        .theme-toggle .light-icon,
        .theme-toggle .dark-icon {
            color: white;
            font-size: 1.3em; /* Larger icons */
            transition: color 0.3s;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Footer Styling */
        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            animation: fadeInUp 1s ease-out 0.5s forwards; /* Add animation */
            opacity: 0; /* Start hidden for animation */
        }

        footer .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
            gap: 20px;
        }

        footer .disclaimer, footer .social-share, footer .credit {
            flex: 1 1 280px;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.05);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }

        footer .disclaimer h3,
        footer .social-share h3,
        footer .credit h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.4em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
        }

        footer .credit p {
            font-size: 0.95em;
            color: #bdc3c7;
            margin: 10px 0;
        }

        footer .disclaimer p {
            font-size: 0.95em;
            color: #bdc3c7;
        }

        .social-buttons {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            font-size: 1.2em;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .social-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .social-btn.linkedin { background-color: #0A66C2; }
        .social-btn.facebook { background-color: #1877F2; }
        .social-btn.twitter { background-color: #1DA1F2; }
        .social-btn.whatsapp { background-color: #25D366; }
        .social-btn.reddit { background-color: #FF4500; }
        .social-btn.email { background-color: #EA4335; } /* Added email button color */

        /* Styles for Calculator Forms and Results */
        .calculator-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color); /* Ensure label text is visible */
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--input-border-focus);
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.5); /* Primary color with transparency */
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1 1 200px;
        }
        
        .calculate-btn {
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 12px 30px; /* Increased padding for better appearance */
            border-radius: 25px; /* More rounded */
            cursor: pointer;
            font-size: 1.1em; /* Slightly larger font */
            font-weight: bold;
            margin-top: 25px; /* More space above button */
            transition: background 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            width: auto; /* Allow button to size based on content and padding */
            min-width: 220px; /* Ensure a minimum width for consistency */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* More pronounced shadow */
            letter-spacing: 0.5px;
            text-transform: uppercase;
            display: flex; /* Use flex for icon and text alignment */
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .calculate-btn:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-5px) scale(1.02); /* Lift and slightly scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
        }

        .calculate-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .calculate-btn .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }

        .calculate-btn.loading .spinner {
            display: inline-block;
        }

        .calculate-btn.loading {
            cursor: not-allowed;
            opacity: 0.8;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            display: none; /* Hidden by default */
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center; /* Center heading */
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        /* Ensure H3 is visible in dark mode */
        body.dark-mode .result-container h3 {
            color: white; /* Explicitly set to white for visibility */
            border-bottom-color: white;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px; /* Rounded corners for table */
            overflow: hidden; /* Ensures rounded corners apply */
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color); /* Ensure text color changes */
        }
        
        .result-table th {
            background-color: var(--hover-color);
            font-weight: bold;
            text-transform: uppercase; /* Uppercase table headers */
            font-size: 0.95em;
            color: var(--primary-color); /* Primary color for table headers */
        }

        .result-table tbody tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.02); /* Light stripe effect */
        }

        .result-table tbody tr:hover {
            background-color: var(--hover-color);
            transition: background-color 0.3s ease-in-out;
        }
        
        .standard-reference {
            margin-top: 20px;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color); /* Ensure visibility in dark mode */
            background-color: var(--hover-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--primary-color);
        }
        
        .info-icon {
            color: var(--primary-color);
            margin-left: 5px;
            cursor: help;
            transition: transform 0.2s ease-in-out;
        }
        .info-icon:hover {
            transform: scale(1.1);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px; /* Increased width for more text */
            background-color: #333; /* Dark background */
            color: #fff; /* White text */
            text-align: center;
            border-radius: 8px;
            padding: 10px; /* Increased padding */
            position: absolute;
            z-index: 10; /* Higher z-index */
            bottom: 125%;
            left: 50%;
            margin-left: -140px; /* Half of new width */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.3;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add shadow */
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Custom message box style */
        #custom-message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, background-color 0.3s ease-in-out;
            display: none; /* Hidden by default */
            min-width: 300px;
            text-align: center;
        }
        #custom-message-box.error { background-color: #dc3545; } /* Red */
        #custom-message-box.warning { background-color: #ffc107; color: #333; } /* Amber */
        #custom-message-box.info { background-color: #28a745; } /* Green */

        /* Styles for detailed calculation steps and tips */
        .detailed-calculations, .conduit-fill-tips {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--hover-color); /* A lighter background for contrast */
            color: var(--text-color); /* Ensure text visibility */
            animation: fadeIn 0.8s ease-out; /* Add fade-in animation */
        }

        body.dark-mode .detailed-calculations, body.dark-mode .conduit-fill-tips {
            background-color: #3a475a; /* Darker background for contrast in dark mode */
            border-color: #6a7a8f;
        }

        .detailed-calculations h4, .conduit-fill-tips h4 {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary-color); /* Highlight heading */
        }
        body.dark-mode .detailed-calculations h4, body.dark-mode .conduit-fill-tips h4 {
            color: var(--primary-color); /* Use lighter primary color in dark mode */
        }

        .detailed-calculations p, .conduit-fill-tips p, .conduit-fill-tips ul {
            margin-bottom: 5px;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .conduit-fill-tips ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        .detailed-calculations strong, .conduit-fill-tips strong {
            color: var(--secondary-color); /* Highlight key terms in formulas */
        }
        body.dark-mode .detailed-calculations strong, body.dark-mode .conduit-fill-tips strong {
            color: var(--primary-color); /* Use lighter primary color for highlights in dark mode */
        }

        /* MathJax rendered formulas will have the desired styling */
        .formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 1.2em;
            text-align: center;
            padding: 12px 0;
            background-color: var(--hover-color);
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px dashed var(--primary-color);
        }
        body.dark-mode .formula {
            background-color: rgba(255,255,255,0.05);
        }

        .calculation-step {
            font-family: 'Courier New', monospace;
            background-color: rgba(0,0,0,0.03); /* Light tint for steps */
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid var(--accent-color); /* Accent color left border */
        }
        body.dark-mode .calculation-step {
            background-color: rgba(255,255,255,0.03);
        }

        .detailed-calculations .calculation-step:last-child {
            border-bottom: none; /* No border after the last step */
        }

        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .message-box-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        .input-focus-animation:focus {
            box-shadow: 0 0 0 3px var(--input-border-focus);
            transition: box-shadow 0.3s ease-in-out;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            header .subtitle {
                font-size: 0.9em;
            }
            .theme-toggle {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }
            .tool-container, .calculator-form, .result-container {
                padding: 20px;
            }
            .tool-container h2 {
                font-size: 1.6em;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .form-row .form-group {
                flex: 1 1 100%;
                min-width: unset;
            }
            .back-button {
                width: 100%;
                justify-content: center;
            }
            footer .container {
                flex-direction: column;
                align-items: center;
            }
            footer .disclaimer, footer .social-share, footer .credit {
                flex: 1 1 100%;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            header {
                padding: 15px 0;
            }
            header h1 {
                font-size: 1.8em;
            }
            .back-button {
                padding: 10px 15px;
                font-size: 0.9em;
            }
            .calculate-btn {
                padding: 12px 20px;
                font-size: 1em;
            }
            .result-table th, .result-table td {
                padding: 10px;
                font-size: 0.9em;
            }
            .tooltip .tooltiptext {
                width: 180px;
                margin-left: -90px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Design Calculators - Electrical</h1>
            <p class="subtitle">Electrical Calculations Made Easy ！ Learn with Every Step</p>
            <div class="theme-toggle">
                <span class="light-icon"><i class="fas fa-sun"></i></span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch">
                    <span class="slider round"></span>
                </label>
                <span class="dark-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </header>

    <main class="container">
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <a href="indexEle.html" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tools</a>
        </div>
        
        <div class="tool-container">
            <h2>Earthing Cable Sizing Calculator</h2>
            
            <div class="tool-description">
                <p>This calculator determines the minimum required cross-sectional area for protective earthing (grounding) conductors based on fault current, fault duration, and conductor material properties. It applies the adiabatic equation as per international standards like <a href="https://webstore.iec.ch/publication/4207" target="_blank">IEC 60364-5-54</a> and principles from <a href="https://standards.ieee.org/standard/80-2013.html" target="_blank">IEEE Std 80</a>.</p>
            </div>
        
            <div class="calculator-form">
                <form id="earthing-sizing-form">
                    <div class="unit-selector">
                        <label for="unit-system">Select Units:</label>
                        <select id="unit-system">
                            <option value="metric">Metric (kA, s, °C, mm²)</option>
                            <option value="imperial">Imperial (kA, s, °F, AWG/kcmil)</option>
                        </select>
                    </div>

                    <!-- Fault Current Parameters -->
                    <div class="form-section">
                        <h3>Fault Current Parameters</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fault-current-ka" id="label-fault-current-ka">Fault Current (kA) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-fault-current-ka">The RMS symmetrical fault current expected to flow through the earthing conductor during a short circuit. This is typically obtained from a short-circuit study.</span></span></label>
                                <input type="number" id="fault-current-ka" min="0.01" step="0.01" value="10" required>
                            </div>
                            <div class="form-group">
                                <label for="fault-duration-s" id="label-fault-duration-s">Fault Duration (s) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-fault-duration-s">The maximum time (in seconds) for which the fault current is expected to flow before being cleared by the upstream protective device (e.g., circuit breaker, fuse). Typical values range from 0.1s to 5s.</span></span></label>
                                <input type="number" id="fault-duration-s" min="0.01" step="0.01" value="0.5" required>
                            </div>
                        </div>
                    </div>

                    <!-- Conductor Material & Temperature Properties -->
                    <div class="form-section">
                        <h3>Conductor Material & Temperature Properties</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="conductor-material" id="label-conductor-material">Conductor Material <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-conductor-material">The material of the earthing conductor (e.g., Copper, Aluminum, Steel). Different materials have distinct thermal and electrical properties affecting their fault current capacity.</span></span></label>
                                <select id="conductor-material" required>
                                    <option value="copper">Copper</option>
                                    <option value="aluminum">Aluminum</option>
                                    <option value="steel">Steel (Galvanized)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="initial-temp-c" id="label-initial-temp-c">Initial Conductor Temperature (°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-initial-temp-c">The maximum normal operating temperature of the earthing conductor just before a fault occurs. This is typically the ambient temperature or the conductor's steady-state temperature under normal load. This value is $T_1$ in the adiabatic equation. It is crucial for determining the conductor\'s thermal capacity during a fault.</span></span></label>
                                <input type="number" id="initial-temp-c" value="30" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="final-temp-c" id="label-final-temp-c">Final Conductor Temperature (°C) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-final-temp-c">The maximum allowable temperature the conductor can reach during a short-circuit fault without sustaining damage. This value depends on the conductor material and any insulation. For bare conductors, it's typically higher (e.g., 300°C for bare copper, 500°C for steel). For insulated conductors, it's limited by the insulation's thermal withstand capability (e.g., 200°C for PVC, 250°C for XLPE). This value is $T_2$ in the adiabatic equation and defines the upper thermal limit for safe operation during a fault.</span></span></label>
                                <input type="number" id="final-temp-c" value="200" step="0.1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="conductor-type" id="label-conductor-type">Conductor Type <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-conductor-type">Select whether the earthing conductor is a round cable or a flat bar/strip.</span></span></label>
                                <select id="conductor-type" required>
                                    <option value="cable">Cable (Round)</option>
                                    <option value="flat-bar">Flat Bar/Strip</option>
                                </select>
                            </div>
                        </div>
                        <div id="flat-bar-fields" class="conductor-type-fields hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="preferred-bar-width" id="label-preferred-bar-width">Preferred Bar Width (mm) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-preferred-bar-width">Enter a standard width for the flat bar (e.g., 25, 50, 75mm). The calculator will determine the required thickness. Leave blank for default (50mm in Metric, 2 inches in Imperial).</span></span></label>
                                    <input type="number" id="preferred-bar-width" min="1" step="1" placeholder="e.g., 50" >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Safety Factor -->
                    <div class="form-section">
                        <h3>Safety Factor</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="safety-factor">Safety Factor (%) <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext">An additional percentage applied to the calculated area to account for uncertainties, future expansions, or conservative design practices. Typical values are 10-25%.</span></span></label>
                                <input type="number" id="safety-factor" min="0" step="1" value="15" required>
                            </div>
                        </div>
                    </div>

                    <div class="button-wrapper">
                        <button type="button" id="calculate-earthing-btn" class="calculate-btn">Calculate</button>
                        <button type="button" id="reset-form-btn" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Form</button>
                    </div>
                </form>
            </div>
            
            <div id="result-container" class="result-container">
                <h3>Earthing Cable Sizing Results</h3>
                <div id="calculation-details" class="detailed-calculations mt-6 math-content">
                    <!-- Calculation steps will be inserted here -->
                </div>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- Results will be dynamically inserted here -->
                    </tbody>
                </table>
                <div style="display: flex; justify-content: center; margin-top: 20px;">
                    <button type="button" id="clear-results-btn" class="clear-results-btn"><i class="fas fa-times-circle"></i> Clear Results</button>
                </div>
                <div id="conductor-type-recommendations" class="standard-reference" style="display: none;">
                    <h4>Conductor Type Recommendations</h4>
                    <p>Choosing between a round cable and a flat bar/strip for earthing depends on various factors including fault current levels, installation environment, mechanical protection, and cost. Both types are widely used and recognized by international standards.</p>
                    <h5>Cables (Round Conductors)</h5>
                    <ul>
                        <li><strong>Pros:</strong>
                            <ul>
                                <li><strong>Flexibility:</strong> Easier to route in conduits, trays, and tight spaces.</li>
                                <li><strong>Cost-Effective:</strong> Often more economical for smaller cross-sectional areas.</li>
                                <li><strong>Insulation:</strong> Readily available with various insulation types for different environments.</li>
                                <li><strong>Common:</strong> Widely used for equipment earthing, protective earth (PE) conductors within circuits.</li>
                            </ul>
                        </li>
                        <li><strong>Cons:</strong>
                            <ul>
                                <li><strong>Heat Dissipation:</strong> Less surface area per unit volume compared to flat bars, which can limit their short-circuit current carrying capacity for very high fault levels.</li>
                                <li><strong>Mechanical Protection:</strong> May require additional mechanical protection in exposed areas.</li>
                            </ul>
                        </li>
                    </ul>
                    <h5>Flat Bars/Strips (Busbars)</h5>
                    <ul>
                        <li><strong>Pros:</strong>
                            <ul>
                                <li><strong>High Current Capacity:</strong> Excellent for carrying very high fault currents due to larger surface area for heat dissipation.</li>
                                <li><strong>Mechanical Strength:</strong> More robust and resistant to mechanical damage, suitable for main earthing bars, earth grids, and substation grounding.</li>
                                <li><strong>Neat Installation:</strong> Provides a clean and organized appearance for main earthing systems.</li>
                                <li><strong>Lower Resistance:</strong> Can offer lower impedance paths for high-frequency currents (skin effect).</li>
                            </ul>
                        </li>
                        <li><strong>Cons:</strong>
                            <ul>
                                <li><strong>Flexibility:</strong> Less flexible, making installation more challenging in complex routes.</li>
                                <li><strong>Space Requirement:</strong> Requires more space for installation compared to cables of equivalent current rating.</li>
                                <li><strong>Cost:</strong> Can be more expensive than cables for equivalent cross-sectional areas, especially for smaller sizes.</li>
                                <li><strong>Connections:</strong> Requires specialized connectors and careful jointing.</li>
                            </ul>
                        </li>
                    </ul>
                    <p><strong>Recommendation:</strong> For general equipment earthing and protective conductors within electrical installations, **cables** are typically preferred due to their flexibility and ease of installation. For main earthing busbars, substation grounding, and applications involving very high prospective fault currents, **flat bars/strips** are generally recommended due to their superior thermal and mechanical characteristics.</p>
                </div>
                <div class="standard-reference" id="standard-reference">
                    <!-- Standard reference text will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="disclaimer">
                <h3>Disclaimer</h3>
                <p>Disclaimer: Always verify calculation results against applicable engineering standards and guidelines.</p>
            </div>
            <div class="credit">
                <h3>Credit</h3>
                <p>Developed by A Sharma</p>
                <p>&copy; 2025 Design Calculators</p>
            </div>
            <div class="social-share">
                <h3>Share This Tool</h3>
                <div class="social-buttons">
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://designcalculators.co.in&title=Earthing%20Cable%20Sizing%20Calculator" target="_blank" class="social-btn linkedin"><i class="fab fa-linkedin"></i></a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://designcalculators.co.in" target="_blank" class="social-btn facebook"><i class="fab fa-facebook"></i></a>
                    <a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20Advanced%20Earthing%20Cable%20Sizing%20Calculator!&url=https://designcalculators.co.in" target="_blank" class="social-btn twitter"><i class="fab fa-twitter"></i></a>
                    <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20Advanced%20Earthing%20Cable%20Sizing%20Calculator!%20https://designcalculators.co.in" target="_blank" class="social-btn whatsapp"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://www.reddit.com/submit?url=https://designcalculators.co.in&title=Advanced%20Earthing%20Cable%20Sizing%20Calculator" target="_blank" class="social-btn reddit"><i class="fab fa-reddit"></i></a>
                    <!-- Update mailto share if present -->
                    <a href="mailto:?subject=Check out Design Calculators - Electrical!&body=I found this amazing Earthing Cable Sizing Calculator and other electrical tools: https://designcalculators.co.in" class="social-btn email">
    <i class="fas fa-envelope"></i>
</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Custom Message Box -->
    <div id="custom-message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateEarthingBtn = document.getElementById('calculate-earthing-btn');
            const resetFormBtn = document.getElementById('reset-form-btn');
            const clearResultsBtn = document.getElementById('clear-results-btn');
            const resultContainer = document.getElementById('result-container');
            const resultTableBody = document.getElementById('result-table-body');
            const standardReference = document.getElementById('standard-reference');
            const calculationDetailsDiv = document.getElementById('calculation-details');
            const unitSystemSelect = document.getElementById('unit-system');
            const conductorTypeSelect = document.getElementById('conductor-type');
            const flatBarFields = document.getElementById('flat-bar-fields');
            const conductorTypeRecommendations = document.getElementById('conductor-type-recommendations');
            const emailShareBtn = document.getElementById('email-share-btn'); // Get the email share button

            // Default values for resetting form
            const defaultValues = {
                'fault-current-ka': 10,
                'fault-duration-s': 0.5,
                'conductor-material': 'copper',
                'initial-temp-c': 30,
                'final-temp-c': 200,
                'safety-factor': 15,
                'conductor-type': 'cable',
                'preferred-bar-width': '', // This will be empty for default
            };

            // Conductor material properties (Metric values)
            const materialProperties = {
                'copper': {
                    rho_20: 1.724e-8, // Resistivity at 20°C (Ohm-m)
                    beta: 234.5,     // Reciprocal of temperature coefficient of resistance at 0°C
                    Q_c: 3.45e6,     // Volumetric heat capacity (J/m3K)
                    default_final_temp_c: 200 // Default for insulated copper
                },
                'aluminum': {
                    rho_20: 2.826e-8, // Resistivity at 20°C (Ohm-m)
                    beta: 228.1,     // Reciprocal of temperature coefficient of resistance at 0°C
                    Q_c: 2.42e6,     // Volumetric heat capacity (J/m3K)
                    default_final_temp_c: 150 // Default for insulated aluminum
                },
                'steel': { // Galvanized steel, approximate values
                    rho_20: 13.8e-8, // Resistivity at 20°C (Ohm-m) - highly variable
                    beta: 200,       // Reciprocal of temperature coefficient of resistance at 0°C - approximate
                    Q_c: 3.9e6,      // Volumetric heat capacity (J/m3K) - approximate
                    default_final_temp_c: 300 // Default for steel
                }
            };

            // Standard cable sizes for recommendation (mm^2)
            // This list can be expanded based on common regional standards
            const standardMetricSizes = [1.5, 2.5, 4, 6, 10, 16, 25, 35, 50, 70, 95, 120, 150, 185, 240, 300, 400, 500, 630, 800, 1000];
            // Approximate AWG/kcmil equivalents for common metric sizes
            const metricToImperialSizes = {
                1.5: '16 AWG', 2.5: '14 AWG', 4: '12 AWG', 6: '10 AWG', 16: '6 AWG',
                25: '4 AWG', 35: '2 AWG', 50: '1/0 AWG', 70: '2/0 AWG', 95: '3/0 AWG', 120: '4/0 AWG',
                150: '300 kcmil', 185: '350 kcmil', 240: '500 kcmil', 300: '600 kcmil',
                400: '800 kcmil', 500: '1000 kcmil', 630: '1250 kcmil', 800: '1500 kcmil', 1000: '2000 kcmil'
            };


            // Conversion Factors (Metric to Imperial)
            const CONVERSION_FACTORS = {
                C_to_F_val: (c) => (c * 9/5) + 32,
                F_to_C_val: (f) => (f - 32) * 5/9,
                mm2_to_kcmil: 1.9735, // 1 mm2 = 1.9735 kcmil (approx)
                kcmil_to_mm2: 0.5067, // 1 kcmil = 0.5067 mm2 (approx)
                mm_to_inch: 0.0393701, // 1 mm = 0.0393701 inch
                inch_to_mm: 25.4 // 1 inch = 25.4 mm
            };

            // Labels and Tooltips for dynamic updating
            const unitSensitiveElements = {
                labels: {
                    'fault-current-ka': { metric: 'Fault Current (kA)', imperial: 'Fault Current (kA)' },
                    'fault-duration-s': { metric: 'Fault Duration (s)', imperial: 'Fault Duration (s)' },
                    'initial-temp-c': { metric: 'Initial Conductor Temperature (°C)', imperial: 'Initial Conductor Temperature (°F)' },
                    'final-temp-c': { metric: 'Final Conductor Temperature (°C)', imperial: 'Final Conductor Temperature (°F)' },
                    'preferred-bar-width': { metric: 'Preferred Bar Width (mm)', imperial: 'Preferred Bar Width (inch)' }
                },
                tooltips: {
                    'fault-current-ka': { metric: 'The RMS symmetrical fault current expected to flow through the earthing conductor during a short circuit. This is typically obtained from a short-circuit study.', imperial: 'The RMS symmetrical fault current expected to flow through the earthing conductor during a short circuit. This is typically obtained from a short-circuit study.' },
                    'fault-duration-s': { metric: 'The maximum time (in seconds) for which the fault current is expected to flow before being cleared by the upstream protective device (e.g., circuit breaker, fuse). Typical values range from 0.1s to 5s.', imperial: 'The maximum time (in seconds) for which the fault current is expected to flow before being cleared by the upstream protective device (e.g., circuit breaker, fuse). Typical values range from 0.1s to 5s.' },
                    'initial-temp-c': { metric: 'The maximum normal operating temperature of the earthing conductor just before a fault occurs. This is typically the ambient temperature or the conductor\'s steady-state temperature under normal load. This value is $T_1$ in the adiabatic equation. It is crucial for determining the conductor\'s thermal capacity during a fault.', imperial: 'The maximum normal operating temperature of the earthing conductor just before a fault occurs. This is typically the ambient temperature or the conductor\'s steady-state temperature under normal load. This value is $T_1$ in the adiabatic equation. It is crucial for determining the conductor\'s thermal capacity during a fault.' },
                    'final-temp-c': { metric: 'The maximum allowable temperature the conductor can reach during a short-circuit fault without sustaining damage. This value depends on the conductor material and any insulation. For bare conductors, it\'s typically higher (e.g., 300°C for bare copper, 500°C for steel). For insulated conductors, it\'s limited by the insulation\'s thermal withstand capability (e.g., 200°C for PVC, 250°C for XLPE). This value is $T_2$ in the adiabatic equation and defines the upper thermal limit for safe operation during a fault.', imperial: 'The maximum allowable temperature the conductor can reach during a short-circuit fault without sustaining damage. This value depends on the conductor material and any insulation. For bare conductors, it\'s typically higher (e.g., 572°F for bare copper, 932°F for steel). For insulated conductors, it\'s limited by the insulation\'s thermal withstand capability (e.g., 392°F for PVC, 482°F for XLPE). This value is $T_2$ in the adiabatic equation and defines the upper thermal limit for safe operation during a fault.' },
                    'conductor-type': { metric: 'Select whether the earthing conductor is a round cable or a flat bar/strip.', imperial: 'Select whether the earthing conductor is a round cable or a flat bar/strip.' },
                    'preferred-bar-width': { metric: 'Enter a standard width for the flat bar (e.g., 25, 50, 75mm). The calculator will determine the required thickness. Leave blank for default (50mm in Metric, 2 inches in Imperial).', imperial: 'Enter a standard width for the flat bar (e.g., 1, 2, 3 inches). The calculator will determine the required thickness. Leave blank for default (2 inches).' }
                }
            };

            // Function to update all labels and tooltips based on selected unit system
            function updateUnitLabelsAndTooltips(unitSystem) {
                // Update general labels and tooltips
                for (const id in unitSensitiveElements.labels) {
                    const labelElement = document.getElementById(`label-${id}`);
                    // Re-create the tooltip HTML to ensure MathJax is re-rendered if needed
                    if (labelElement) {
                        labelElement.innerHTML = unitSensitiveElements.labels[id][unitSystem] + ` <span class="tooltip"><i class="fas fa-info-circle info-icon"></i><span class="tooltiptext" id="tooltip-${id}">${unitSensitiveElements.tooltips[id][unitSystem]}</span></span>`;
                        // Trigger MathJax typesetting for the new tooltip content
                        if (window.MathJax) {
                            const tooltipSpan = document.getElementById(`tooltip-${id}`);
                            if (tooltipSpan) {
                                window.MathJax.typesetPromise([tooltipSpan]);
                            }
                        }
                    }
                }

                // Update input values for temperature conversion
                const initialTempInput = document.getElementById('initial-temp-c');
                const finalTempInput = document.getElementById('final-temp-c');
                let currentInitialTemp = parseFloat(initialTempInput.value);
                let currentFinalTemp = parseFloat(finalTempInput.value);

                if (unitSystem === 'imperial') {
                    initialTempInput.value = CONVERSION_FACTORS.C_to_F_val(currentInitialTemp).toFixed(1);
                    finalTempInput.value = CONVERSION_FACTORS.C_to_F_val(currentFinalTemp).toFixed(1);
                } else { // metric
                    initialTempInput.value = CONVERSION_FACTORS.F_to_C_val(currentInitialTemp).toFixed(1);
                    finalTempInput.value = CONVERSION_FACTORS.F_to_C_val(currentFinalTemp).toFixed(1);
                }

                // Update bar dimensions if flat bar fields are visible
                const preferredBarWidthInput = document.getElementById('preferred-bar-width');
                if (flatBarFields.classList.contains('hidden') === false && preferredBarWidthInput.value !== '') {
                    let currentWidth = parseFloat(preferredBarWidthInput.value);

                    if (unitSystem === 'imperial') {
                        preferredBarWidthInput.value = (currentWidth * CONVERSION_FACTORS.mm_to_inch).toFixed(2);
                        preferredBarWidthInput.step = '0.01';
                    } else { // metric
                        preferredBarWidthInput.value = (currentWidth * CONVERSION_FACTORS.inch_to_mm).toFixed(0);
                        preferredBarWidthInput.step = '1';
                    }
                }
            }

            // Event listener for conductor material change to update default final temperature
            document.getElementById('conductor-material').addEventListener('change', function() {
                const material = this.value;
                const finalTempInput = document.getElementById('final-temp-c');
                let newDefaultFinalTempC = materialProperties[material].default_final_temp_c;

                if (unitSystemSelect.value === 'imperial') {
                    finalTempInput.value = CONVERSION_FACTORS.C_to_F_val(newDefaultFinalTempC).toFixed(1);
                } else {
                    finalTempInput.value = newDefaultFinalTempC.toFixed(1);
                }
            });

            // Event listener for conductor type change to show/hide flat bar fields
            conductorTypeSelect.addEventListener('change', function() {
                if (this.value === 'flat-bar') {
                    flatBarFields.classList.remove('hidden');
                    // Enable inputs for flat bar
                    Array.from(flatBarFields.querySelectorAll('input')).forEach(input => input.disabled = false);
                } else {
                    flatBarFields.classList.add('hidden');
                    Array.from(flatBarFields.querySelectorAll('input')).forEach(input => input.disabled = true);
                }
                updateUnitLabelsAndTooltips(unitSystemSelect.value); // Update units for newly visible fields
            });


            calculateEarthingBtn.addEventListener('click', calculateEarthingSize);
            resetFormBtn.addEventListener('click', resetForm);
            clearResultsBtn.addEventListener('click', clearResults); // New event listener
            unitSystemSelect.addEventListener('change', (event) => updateUnitLabelsAndTooltips(event.target.value));

            function clearResults() {
                resultContainer.classList.remove('show');
                resultTableBody.innerHTML = '';
                calculationDetailsDiv.innerHTML = '';
                standardReference.innerHTML = '';
                conductorTypeRecommendations.style.display = 'none';
                displayMessage("Results cleared.", "info");
            }

            function resetForm() {
                // Reset standard inputs
                for (const id in defaultValues) {
                    const input = document.getElementById(id);
                    if (input) {
                        input.value = defaultValues[id];
                    }
                }
                // Manually trigger change for conductor material to update final temp
                document.getElementById('conductor-material').dispatchEvent(new Event('change'));
                // Manually trigger change for conductor type to update visibility
                document.getElementById('conductor-type').dispatchEvent(new Event('change'));

                // Reset unit system to Metric
                unitSystemSelect.value = 'metric';
                updateUnitLabelsAndTooltips('metric'); // Apply metric units

                // Clear results
                clearResults(); // Use the new clearResults function

                displayMessage("Form reset to default values.", "info");
            }

            // Function to display messages (replaces alert())
            function displayMessage(message, type = "info") {
                let messageBox = document.getElementById('custom-message-box');
                if (!messageBox) {
                    messageBox = document.createElement('div');
                    messageBox.id = 'custom-message-box';
                    messageBox.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        padding: 15px 25px;
                        border-radius: 8px;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                        z-index: 1000;
                        font-weight: bold;
                        color: white;
                        opacity: 0;
                        transition: opacity 0.5s ease-in-out, transform 0.3s ease-out;
                        display: flex; /* Use flex for centering text */
                        align-items: center;
                        justify-content: center;
                        min-width: 250px; /* Ensure it's wide enough */
                    `;
                    document.body.appendChild(messageBox);
                }

                messageBox.textContent = message;
                // Remove previous type classes
                messageBox.classList.remove('error', 'warning', 'info');
                if (type === "error") {
                    messageBox.classList.add('error');
                } else if (type === "warning") {
                    messageBox.classList.add('warning');
                } else {
                    messageBox.classList.add('info');
                }
                messageBox.style.display = 'flex'; // Ensure it's visible before setting opacity
                messageBox.style.opacity = 1;
                messageBox.style.transform = 'translateX(-50%) translateY(0)'; // Bring to position

                // Clear any existing timeout to prevent multiple messages overlapping
                if (messageBox.timeoutId) {
                    clearTimeout(messageBox.timeoutId);
                }

                messageBox.timeoutId = setTimeout(() => {
                    messageBox.style.opacity = 0;
                    messageBox.style.transform = 'translateX(-50%) translateY(-20px)'; // Fade out and move up
                    setTimeout(() => { messageBox.style.display = 'none';}, 500); // Wait for fade out then hide
                }, 5000);
            }

            function calculateEarthingSize() {
                // Show spinner and disable button
                calculateEarthingBtn.classList.add('loading');
                calculateEarthingBtn.disabled = true;

                const currentUnitSystem = unitSystemSelect.value;

                // 1. Get inputs and convert to Metric (if Imperial) for calculation
                let faultCurrentKA = parseFloat(document.getElementById('fault-current-ka').value);
                const faultDurationS = parseFloat(document.getElementById('fault-duration-s').value);
                const conductorMaterial = document.getElementById('conductor-material').value;
                let initialTempC = parseFloat(document.getElementById('initial-temp-c').value);
                let finalTempC = parseFloat(document.getElementById('final-temp-c').value);
                const safetyFactor = parseFloat(document.getElementById('safety-factor').value);
                const conductorType = document.getElementById('conductor-type').value;

                let preferredBarWidthInput = document.getElementById('preferred-bar-width').value;
                let preferredBarWidthMM;

                // Determine preferredBarWidthMM based on input and unit system
                if (preferredBarWidthInput === '') {
                    preferredBarWidthMM = (currentUnitSystem === 'metric' ? 50 : 2 * CONVERSION_FACTORS.inch_to_mm); // Default values
                } else {
                    preferredBarWidthMM = parseFloat(preferredBarWidthInput);
                    if (currentUnitSystem === 'imperial') {
                        preferredBarWidthMM *= CONVERSION_FACTORS.inch_to_mm; // Convert to mm for calculation
                    }
                }

                // Convert temperatures to Celsius if input is Fahrenheit
                if (currentUnitSystem === 'imperial') {
                    initialTempC = CONVERSION_FACTORS.F_to_C_val(initialTempC);
                    finalTempC = CONVERSION_FACTORS.F_to_C_val(finalTempC);
                }

                // Input Validation
                if (isNaN(faultCurrentKA) || faultCurrentKA <= 0) {
                    displayMessage("Please enter a valid positive Fault Current.", "error");
                    calculateEarthingBtn.classList.remove('loading');
                    calculateEarthingBtn.disabled = false;
                    return;
                }
                if (isNaN(faultDurationS) || faultDurationS <= 0) {
                    displayMessage("Please enter a valid positive Fault Duration.", "error");
                    calculateEarthingBtn.classList.remove('loading');
                    calculateEarthingBtn.disabled = false;
                    return;
                }
                if (isNaN(initialTempC) || isNaN(finalTempC) || initialTempC >= finalTempC) {
                    displayMessage("Please enter valid Initial and Final Temperatures. Final temperature must be greater than initial temperature.", "error");
                    calculateEarthingBtn.classList.remove('loading');
                    calculateEarthingBtn.disabled = false;
                    return;
                }
                if (isNaN(safetyFactor) || safetyFactor < 0) {
                    displayMessage("Please enter a valid non-negative Safety Factor.", "error");
                    calculateEarthingBtn.classList.remove('loading');
                    calculateEarthingBtn.disabled = false;
                    return;
                }
                if (conductorType === 'flat-bar') {
                    if (isNaN(preferredBarWidthMM) || preferredBarWidthMM <= 0) {
                        displayMessage("Internal error: Preferred Bar Width is invalid after default/conversion. Please report this.", "error"); // Should not happen with new default logic
                        calculateEarthingBtn.classList.remove('loading');
                        calculateEarthingBtn.disabled = false;
                        return;
                    }
                }

                // Get material properties
                const materialProps = materialProperties[conductorMaterial];
                if (!materialProps) {
                    displayMessage("Selected conductor material properties not found.", "error");
                    calculateEarthingBtn.classList.remove('loading');
                    calculateEarthingBtn.disabled = false;
                    return;
                }

                const rho_20 = materialProps.rho_20; // Resistivity at 20°C (Ohm-m)
                const beta = materialProps.beta;     // Reciprocal of temperature coefficient of resistance at 0°C
                const Q_c = materialProps.Q_c;       // Volumetric heat capacity (J/m3K)

                // Convert fault current from kA to A
                const faultCurrentA = faultCurrentKA * 1000;

                let calculationHtml = '<h4>Detailed Calculation Steps:</h4>';
                resultTableBody.innerHTML = ''; // Clear previous results
                resultContainer.classList.remove('show'); // Hide previous results for animation
                conductorTypeRecommendations.style.display = 'none'; // Hide recommendations initially

                // Helper function to add rows to the result table
                function addResultRow(parameter, value) {
                    const row = resultTableBody.insertRow();
                    const paramCell = row.insertCell();
                    const valueCell = row.insertCell();
                    paramCell.innerHTML = parameter;
                    valueCell.innerHTML = value;
                }

                // 1. Calculate k factor
                // Ensure Math.log is used correctly for natural logarithm
                const k_factor_numerator = Q_c * Math.log((beta + finalTempC) / (beta + initialTempC));
                const k_factor_denominator = rho_20 * (beta + initialTempC);
                const k_factor_squared = k_factor_numerator / k_factor_denominator;
                const k_factor = Math.sqrt(k_factor_squared);

                calculationHtml += `<p><strong>1. Calculate 'k' Factor:</strong></p>`;
                calculationHtml += `<p>The 'k' factor accounts for the material properties and the initial and final temperatures of the conductor during a short circuit. It is derived from the adiabatic heating equation.</p>`;
                calculationHtml += `<p class="formula">$$k = \\sqrt{\\frac{Q_c \\ln\\left(\\frac{\\beta + T_2}{\\beta + T_1}\\right)}{\\rho_{20}(\\beta + T_1)}}$$</p>`;
                calculationHtml += `<p class="calculation-step">For ${conductorMaterial}:</p>`;
                calculationHtml += `<p class="calculation-step">$\\rho_{20}$ = ${rho_20.toExponential(3)} &Omega;m</p>`;
                calculationHtml += `<p class="calculation-step">$\\beta$ = ${beta.toFixed(1)}</p>`;
                calculationHtml += `<p class="calculation-step">$Q_c$ = ${Q_c.toExponential(3)} J/m<sup>3</sup>K</p>`;
                calculationHtml += `<p class="calculation-step">$T_1$ = ${initialTempC.toFixed(1)} °C</p>`;
                calculationHtml += `<p class="calculation-step">$T_2$ = ${finalTempC.toFixed(1)} °C</p>`;
                calculationHtml += `<p class="calculation-step">k = &radic;[(${Q_c.toExponential(3)} x ln((${beta.toFixed(1)} + ${finalTempC.toFixed(1)}) / (${beta.toFixed(1)} + ${initialTempC.toFixed(1)}))) / (${rho_20.toExponential(3)} x (${beta.toFixed(1)} + ${initialTempC.toFixed(1)}))] = ${k_factor.toFixed(2)}</p>`;


                // 2. Calculate Minimum Cross-sectional Area (S)
                const minAreaMM2 = (faultCurrentA * Math.sqrt(faultDurationS)) / k_factor;

                calculationHtml += `<p><strong>2. Calculate Minimum Cross-sectional Area (S):</strong></p>`;
                calculationHtml += `<p>The minimum cross-sectional area is calculated using the adiabatic equation, ensuring the conductor can safely carry the fault current for the specified duration without exceeding its final temperature limit.</p>`;
                calculationHtml += `<p class="formula">$$S = \\frac{I_k \\sqrt{t}}{k}$$</p>`;
                calculationHtml += `<p class="calculation-step">$I_k$ = ${faultCurrentA.toFixed(0)} A</p>`;
                calculationHtml += `<p class="calculation-step">$t$ = ${faultDurationS.toFixed(2)} s</p>`;
                calculationHtml += `<p class="calculation-step">k = ${k_factor.toFixed(2)}</p>`;
                calculationHtml += `<p class="calculation-step">S = (${faultCurrentA.toFixed(0)} A x &radic;${faultDurationS.toFixed(2)} s) / ${k_factor.toFixed(2)} = ${minAreaMM2.toFixed(2)} mm<sup>2</sup></p>`;

                // 3. Apply Safety Factor
                const finalAreaMM2 = minAreaMM2 * (1 + safetyFactor / 100);
                calculationHtml += `<p><strong>3. Apply Safety Factor:</strong></p>`;
                calculationHtml += `<p>A safety factor is applied to the calculated minimum area to provide an additional margin for safety, future changes, and to align with conservative engineering practices.</p>`;
                calculationHtml += `<p class="formula">$$S_{\\text{final}} = S_{\\text{min}} \\times \\left(1 + \\frac{\\text{Safety Factor}}{100}\\right)$$</p>`;
                calculationHtml += `<p class="calculation-step">S<sub>final</sub> = ${minAreaMM2.toFixed(2)} mm<sup>2</sup> x (1 + ${safetyFactor}/100) = ${finalAreaMM2.toFixed(2)} mm<sup>2</sup></p>`;

                // 4. Recommend Standard Cable Size / Flat Bar Dimensions
                let recommendedSizeDisplay = '';
                if (conductorType === 'cable') {
                    let recommendedSizeMM2 = null;
                    for (let i = 0; i < standardMetricSizes.length; i++) {
                        if (standardMetricSizes[i] >= finalAreaMM2) {
                            recommendedSizeMM2 = standardMetricSizes[i];
                            break;
                        }
                    }
                    if (recommendedSizeMM2 === null) {
                        recommendedSizeMM2 = standardMetricSizes[standardMetricSizes.length - 1]; // If larger than max, suggest largest
                        displayMessage("Calculated cable size exceeds standard tabulated values. Consider using the largest available standard size or multiple conductors.", "warning");
                    }

                    if (currentUnitSystem === 'imperial') {
                        const recommendedSizeImperial = metricToImperialSizes[recommendedSizeMM2] || (recommendedSizeMM2 * CONVERSION_FACTORS.mm2_to_kcmil).toFixed(0) + ' kcmil';
                        recommendedSizeDisplay = `<strong>${recommendedSizeImperial} (approx. ${recommendedSizeMM2.toFixed(2)} mm²)</strong>`;
                    } else {
                        recommendedSizeDisplay = `<strong>${recommendedSizeMM2.toFixed(2)} mm²</strong>`;
                    }
                } else { // flat-bar
                    const calculatedThicknessMM = finalAreaMM2 / preferredBarWidthMM;
                    
                    let barRecommendation = '';
                    if (currentUnitSystem === 'imperial') {
                        // Display imperial thickness with more precision
                        barRecommendation = `Suggested bar dimensions: <strong>${(preferredBarWidthMM * CONVERSION_FACTORS.mm_to_inch).toFixed(2)} inch (W) x ${(calculatedThicknessMM * CONVERSION_FACTORS.mm_to_inch).toFixed(4)} inch (T)</strong>`;
                    } else {
                        // Display metric thickness with more precision
                        barRecommendation = `Suggested bar dimensions: <strong>${preferredBarWidthMM.toFixed(0)} mm (W) x ${calculatedThicknessMM.toFixed(3)} mm (T)</strong>`;
                    }
                    
                    if (calculatedThicknessMM < 1) { // Arbitrary small thickness, adjust as per practical limits
                        barRecommendation += `<br><span style="color: ${getComputedStyle(document.documentElement).getPropertyValue('--accent-color')};"><em>Note: The calculated thickness is very small. Consider increasing the preferred bar width or using multiple smaller bars.</em></span>`;
                    } else if (calculatedThicknessMM > 10) { // Arbitrary large thickness
                        barRecommendation += `<br><span style="color: ${getComputedStyle(document.documentElement).getPropertyValue('--accent-color')};"><em>Note: The calculated thickness is quite large. Consider increasing the preferred bar width or using multiple smaller bars.</em></span>`;
                    }
                    recommendedSizeDisplay = barRecommendation;
                }

                // Display Results
                calculationDetailsDiv.innerHTML = calculationHtml;
                // Ensure MathJax renders the formulas after they are added to the DOM
                if (window.MathJax) {
                    window.MathJax.typesetPromise([calculationDetailsDiv]).then(() => {
                        console.log("MathJax typesetting complete.");
                    }).catch((err) => console.error("MathJax typesetting failed", err));
                }

                resultTableBody.innerHTML = '';
                addResultRow("Calculated 'k' Factor", `${k_factor.toFixed(2)}`);
                addResultRow("Minimum Required Area", `${minAreaMM2.toFixed(2)} mm²`);
                addResultRow("Final Required Area (with Safety Factor)", `<strong>${finalAreaMM2.toFixed(2)} mm²</strong>`);
                addResultRow("<strong>Recommended Conductor Size/Dimensions</strong>", recommendedSizeDisplay);
                
                let standardRefText = "Earthing conductor sizing is a critical aspect of electrical safety design, ensuring that protective devices can operate effectively during fault conditions without damaging the earthing system. The adiabatic equation is a fundamental principle recognized by international standards such as <a href=\"https://webstore.iec.ch/publication/4207\" target=\"_blank\">IEC 60364-5-54 (Electrical installations of buildings - Part 5-54: Selection and erection of electrical equipment - Earthing arrangements and protective conductors)</a> and <a href=\"https://standards.ieee.org/standard/80-2013.html\" target=\"_blank\">IEEE Std 80 (Guide for Safety in AC Substation Grounding)</a>. This tool provides an estimate; always refer to the complete official standards and consult with a qualified electrical engineer for final design and safety verification, especially considering local regulations and specific installation conditions.";
                standardReference.innerHTML = standardRefText;

                conductorTypeRecommendations.style.display = 'block'; // Show recommendations
                resultContainer.style.display = 'block';
                setTimeout(() => {
                    resultContainer.classList.add('show');
                    resultContainer.scrollIntoView({ behavior: 'smooth' });
                }, 10);

                // Re-enable button and hide spinner immediately after calculations are done.
                calculateEarthingBtn.classList.remove('loading');
                calculateEarthingBtn.disabled = false;

                // Update the email share link with current results
                const emailSubject = encodeURIComponent("Earthing Cable Sizing Calculation Results from Design Calculators - Electrical");
                const emailBody = encodeURIComponent(
                    `I found this useful electrical tools website: https://electricaltoolshub.com\n\n` +
                    `Here are some details about the Earthing Cable Sizing Calculation I performed:\n` +
                    `- Fault Current: ${faultCurrentKA} kA\n` +
                    `- Fault Duration: ${faultDurationS} s\n` +
                    `- Conductor Material: ${conductorMaterial}\n` +
                    `- Initial Temperature: ${initialTempC.toFixed(1)} °C\n` +
                    `- Final Temperature: ${finalTempC.toFixed(1)} °C\n` +
                    `- Safety Factor: ${safetyFactor}%\n` +
                    `- Conductor Type: ${conductorType}\n` +
                    (conductorType === 'flat-bar' ? `- Preferred Bar Width: ${preferredBarWidthInput} ${currentUnitSystem === 'metric' ? 'mm' : 'inch'}\n` : '') +
                    `- Calculated 'k' Factor: ${k_factor.toFixed(2)}\n` +
                    `- Minimum Required Area: ${minAreaMM2.toFixed(2)} mm²\n` +
                    `- Final Required Area (with Safety Factor): ${finalAreaMM2.toFixed(2)} mm²\n` +
                    `- Recommended Conductor Size/Dimensions: ${recommendedSizeDisplay.replace(/<[^>]*>/g, '')}\n\n` + // Remove HTML tags for plain text email
                    `Please note: This is a simplified calculation for educational purposes and should not be used for actual engineering design or compliance.`
                );
                if (emailShareBtn) { // Defensive check
                    emailShareBtn.href = `mailto:?subject=${emailSubject}&body=${emailBody}`;
                } else {
                    console.error("Email share button element not found when trying to update its href.");
                }
            }

            // Theme switch logic
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeSwitch.checked = true;
                }

                themeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Initial fade-in for form sections
            const formSections = document.querySelectorAll('.form-section');
            formSections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('fade-in');
                }, 100 * index); // Staggered fade-in
            });

            // Initial unit display and conductor type field visibility
            updateUnitLabelsAndTooltips(unitSystemSelect.value);
            conductorTypeSelect.dispatchEvent(new Event('change')); // Trigger initial display for flat bar fields
        });
    </script>
</body>

</html>


